<?xml version="1.0" encoding="utf-8" ?>
<otrs_package version="1.1">
    <Name>KIXCore</Name>
    <Version>5.0.5</Version>
    <Vendor>c.a.p.e. IT GmbH</Vendor>
    <URL>http://www.cape-it.de/</URL>
    <License>GNU AFFERO GENERAL PUBLIC LICENSE Version 3, November 2007</License>
    <ChangeLog Version="5.0.5" Date="2016-08-02 08:45:56">CR:  T2016070490000433 (added changes from OTRS 5.0.11); Bugfix:  T2016071990000558 (documentation and post install information contain referenced to old kix.ManageMultipleCustomPackages.pl).</ChangeLog>
    <ChangeLog Version="5.0.4" Date="2016-05-31 16:31:51">CR: T2016051790002376 (added changes from OTRS 5.0.10).</ChangeLog>
    <ChangeLog Version="5.0.3" Date="2016-05-02 19:47:12">CR: T2016041290000665 (added changes from OTRS 5.0.9); Bugfix: T2016041990000974 (template include paths restricted). </ChangeLog>
    <ChangeLog Version="5.0.2" Date="2016-03-30 09:53:26">CR: T2016033090000507 (OTRS-Bug!! Internal Server Error in AdminPackageManager), T2016032290000764 (added changes from OTRS 5.0.8).</ChangeLog>
    <ChangeLog Version="5.0.1" Date="2016-03-01 18:02:57">CR: T2016022390000719 (added changes from OTRS 5.0.7).</ChangeLog>
    <ChangeLog Version="5.0.0" Date="2016-01-29 18:36:36">First public release of KIXCore for OTRS 5.0. </ChangeLog>
    <ChangeLog Version="4.99.81" Date="2016-01-23 11:58:23">Second beta-release. </ChangeLog>
    <ChangeLog Version="4.99.80" Date="2016-01-08 18:30:40">First beta-release.</ChangeLog>
    <Description Lang="en">KIXCore - Core package for KIX tsunami framework.</Description>
    <Description Lang="de">KIXCore - Kernpaket fuer den KIX Tsunami-Ansatz.</Description>
    <Framework>5.0.11</Framework>
    <IntroInstall Lang="en" Title="Install Information" Type="pre">
        &lt;br/&gt;
        &lt;strong&gt;WELCOME&lt;/strong&gt;
        &lt;br/&gt;
        &lt;br/&gt;
        You are about to install the OTRS module KIXCore. This package provides a more flexible and more general approach for extensions of extensions than the common Custom-folder of OTRS itself.&lt;br/&gt;
        &lt;br/&gt;
        &lt;br/&gt;
        &lt;strong&gt;Recommended perl modules:&lt;/strong&gt;
        &lt;br/&gt;
        &lt;br/&gt;
        &lt;ul&gt;
        &lt;li&gt;Data::Compare - required if you want to keep track of SysConfig changes, e.g. what was changed by which user. However, the other parts of this OTRS-extensions will work without it.&lt;/li&gt;
        &lt;li&gt;Cache::Memcached::Fast - required if you want to use Memcached for internal caching.&lt;/li&gt;
        &lt;/ul&gt;
        &lt;br/&gt;
        &lt;br/&gt;
        &lt;strong&gt;Important Advice:&lt;/strong&gt;&lt;br/&gt;
        &lt;br/&gt;
        This package requires that the user which installs the package (i.e. webserver user) has got write permissions on file Config.pm and apache2-perl-startup.pl. If this is not the case, the installation will fail.You should then try to run &quot;bin/otrs.Console.pl Admin::MultipleCustomPackages::Register --package-name KIXCore --priority 000&quot; in order to get this extension running.&lt;br/&gt;
        &lt;br/&gt;
        &lt;br/&gt;
        &lt;br/&gt;
        c.a.p.e. IT ...easy.&lt;br/&gt;
        &lt;br/&gt;
    </IntroInstall>
    <IntroInstall Lang="en" Title="Installation Information" Type="post">
        &lt;br/&gt;
        &lt;strong&gt;Important Advice:&lt;/strong&gt;
        &lt;br/&gt;
        &lt;br/&gt;
        If you are using OTRS with modperl, the webserver must be restarted now. Please do this before you continue the use of this OTRS installation.
        &lt;br/&gt;
        &lt;br/&gt;
        &lt;strong&gt;Notice&lt;/strong&gt;
        &lt;br/&gt;
        &lt;br/&gt;
        If you want to have a explanation how this extension works, please have a look at the documentation provided in doc-directory.
        &lt;br/&gt;
        &lt;br/&gt;
        c.a.p.e. IT ...easy.&lt;br/&gt;
        &lt;br/&gt;
    </IntroInstall>
    <IntroUninstall Lang="en" Title="Uninstallation Information" Type="pre">
        &lt;br/&gt;
        &lt;strong&gt;WELCOME&lt;/strong&gt;
        &lt;br/&gt;
        &lt;br/&gt;
        You are about to UNINSTALL the KIXCore extensions package for OTRS.&lt;br/&gt;
        &lt;br/&gt;
        &lt;br/&gt;
        c.a.p.e. IT ...easy.&lt;br/&gt;
        &lt;br/&gt;
    </IntroUninstall>
    <IntroUpgrade Lang="en" Title="Upgrade Information" Type="pre">
        &lt;br/&gt;
        &lt;strong&gt;WELCOME&lt;/strong&gt;
        &lt;br/&gt;
        &lt;br/&gt;
        You are about to upgrade the KIXCore extensions package for OTRS.&lt;br/&gt;
        &lt;br/&gt;
        &lt;br/&gt;
        c.a.p.e. IT ...easy.&lt;br/&gt;
        &lt;br/&gt;
    </IntroUpgrade>
    <CodeInstall Type="post">

        # create the package name
        my $CodeModule = 'var::packagesetup::' . $Param{Structure}-&gt;{Name}-&gt;{Content};

        $Kernel::OM-&gt;Get($CodeModule)-&gt;CodeInstall();

    </CodeInstall>
    <CodeUpgrade Type="post">

        # create the package name
        my $CodeModule = 'var::packagesetup::' . $Param{Structure}-&gt;{Name}-&gt;{Content};

        # discard internally stored object, so that the next access to object creates them newly
        $Kernel::OM-&gt;ObjectsDiscard(
            Objects            =&gt; [$CodeModule],
            ForcePackageReload =&gt; 1,
        );

        $Kernel::OM-&gt;Get($CodeModule)-&gt;CodeUpgrade();

    </CodeUpgrade>
    <CodeUninstall Type="pre">

        # create the package name
        my $CodeModule = 'var::packagesetup::' . $Param{Structure}-&gt;{Name}-&gt;{Content};

        $Kernel::OM-&gt;Get($CodeModule)-&gt;CodeUninstall();

    </CodeUninstall>
    <CodeReinstall Type="post">

        # create the package name
        my $CodeModule = 'var::packagesetup::' . $Param{Structure}-&gt;{Name}-&gt;{Content};

        $Kernel::OM-&gt;Get($CodeModule)-&gt;CodeReinstall();

    </CodeReinstall>
    <BuildDate>2016-08-02 08:45:56</BuildDate>
    <BuildHost>cvs.intra.cape-it.de</BuildHost>
    <Filelist>
        <File Location="doc/CHANGES_KIXCore.md" Permission="644" Encode="Base64">IyBDaGFuZ2UgbG9nIG9mIEtJWENvcmUKKiBDb3B5cmlnaHQgKEMpIDIwMDYtMjAxNiBjLmEucC5lLiBJVCBHbWJILCBodHRwOi8vd3d3LmNhcGUtaXQuZGUvCiogJElkOiBDSEFOR0VTX0tJWENvcmUubWQsdiAxLjc0IDIwMTYvMDgvMDIgMDY6NDQ6NDIgcmJvIEV4cCAkCgojNS4wLjUgKDIwMTYvMDgvMDIpCiAqICgyMDE2LzA3LzE5KSAtIEJ1Z2ZpeDogVDIwMTYwNzE5OTAwMDA1NTggKGRvY3VtZW50YXRpb24gYW5kIHBvc3QgaW5zdGFsbCBpbmZvcm1hdGlvbiBjb250YWluIHJlZmVyZW5jZWQgdG8gb2xkIGtpeC5NYW5hZ2VNdWx0aXBsZUN1c3RvbVBhY2thZ2VzLnBsKSAocmJvKQogKiAoMjAxNi8wNy8wNSkgLSBDUjogVDIwMTYwNzA0OTAwMDA0MzMgKGFkZGVkIGNoYW5nZXMgZnJvbSBPVFJTIDUuMC4xMSkgKGRkb2VyZmZlbCkKCiM1LjAuNCAoMjAxNi8wNS8zMSkKICogKDIwMTYvMDQvMjcpIC0gQ1I6IFQyMDE2MDUxNzkwMDAyMzc2IChhZGRlZCBjaGFuZ2VzIGZyb20gT1RSUyA1LjAuMTApIChkZG9lcmZmZWwpCgojNS4wLjMgKDIwMTYvMDUvMDIpCiAqICgyMDE2LzA0LzI3KSAtIEJ1Z2ZpeDogVDIwMTYwNDE5OTAwMDA5NzQgKHRlbXBsYXRlIGluY2x1ZGUgcGF0aHMgcmVzdHJpY3RlZCkgKGRkb2VyZmZlbCkKICogKDIwMTYvMDQvMTIpIC0gQ1I6IFQyMDE2MDQxMjkwMDAwNjY1IChhZGRlZCBjaGFuZ2VzIGZyb20gT1RSUyA1LjAuOSkgKGRkb2VyZmZlbCkKCiM1LjAuMiAoMjAxNi8wMy8zMCkKICogKDIwMTYvMDMvMzApIC0gQ1I6IFQyMDE2MDMzMDkwMDAwNTA3IChPVFJTLUJ1ZyEhIEludGVybmFsIFNlcnZlciBFcnJvciBpbiBBZG1pblBhY2thZ2VNYW5hZ2VyKSAocmJvKQogKiAoMjAxNi8wMy8yMykgLSBDUjogVDIwMTYwMzIyOTAwMDA3NjQgKGFkZGVkIGNoYW5nZXMgZnJvbSBPVFJTIDUuMC44KSAoZGRvZXJmZmVsKQoKIzUuMC4xICgyMDE2LzAzLzAxKQogKiAoMjAxNi8wMi8yNSkgLSBDUjogVDIwMTYwMjIzOTAwMDA3MTkgKGFkZGVkIGNoYW5nZXMgZnJvbSBPVFJTIDUuMC43KSAoZGRvZXJmZmVsKQoKIzUuMC4wICgyMDE2LzAxLzI5KQogKiAoMjAxNi8wMS8yOSkgLSBDUjogZmlyc3QgcHJvZHVjdGl2ZSByZWxlYXNlIGZvciBPVFJTIDUuMCAocmJvKQoKIzQuOTkuODEgKDIwMTYvMDEvMjMpCiAqICgyMDE2LzAxLzIzKSAtIENSOiBzZWNvbmQgYmV0YS1yZWxlYXNlIChyYm8pCiAqICgyMDE2LzAxLzIwKSAtIENSOiBUMjAxNjAxMTk5MDAwMDU0MSAoYWRkZWQgY2hhbmdlcyBmcm9tIE9UUlMgNS4wLjYpIChkZG9lcmZmZWwpCgojNC45OS44MCAoMjAxNi8wMS8wOCkKICogKDIwMTYvMDEvMDgpIC0gQ1I6IGZpcnN0IGJldGEtcmVsZWFzZSAocmJvKQogKiAoMjAxNS8xMi8wMikgLSBDUjogVDIwMTUxMTE2OTAwMDA1MjEgKGFkZGVkIGNoYW5nZXMgZnJvbSBPVFJTIDUuMC40KSAoZGRvZXJmZmVsKQogKiAoMjAxNS8xMi8wMikgLSBCdWdmaXg6IFQyMDE1MTIwMTkwMDAxMDkxICh1bmRlZmluZWQgRW5jb2RlT2JqZWN0IGluIE1lbWNhY2hlZC5wbSkgKHJibykKICogKDIwMTUvMTEvMTkpIC0gQ1I6IFQyMDE1MTExNjkwMDAwNTIxIChhZGRlZCBjaGFuZ2VzIGZyb20gT1RSUyA1LjAuMikgKGRkb2VyZmZlbCkKICogKDIwMTUvMTAvMDUpIC0gQ1I6IFQyMDE1MTAwNTkwMDAwMjIxIChubyBjaGFuZ2VzIG5lZWRlZCB0byBhZGQgY2hhbmdlcyBmcm9tIE9UUlMgNC4wLjEzKSAoZGRvZXJmZmVsKQogKiAoMjAxNS8wOS8xNikgLSBDUjogVDIwMTUwOTE2OTAwMDAzMDEgKGFkZGVkIGNoYW5nZXMgZnJvbSBPVFJTIDQuMC4xMikgKGRkb2VyZmZlbCkKICogKDIwMTUvMDkvMDEpIC0gQnVnZml4OiBUMjAxNTA4MTM5MDAwMDUxNCAobWlzc2luZyBNYWluT2JqZWN0IGluIFN5c0NvbmZpZy5wbSkgKHJibykKICogKDIwMTUvMDgvMTApIC0gQ1I6IFQyMDE1MDgwNjkwMDAwMzg2IChhZGRlZCBjaGFuZ2VzIGZyb20gT1RSUyA0LjAuMTEpIChkZG9lcmZmZWwpCiAqICgyMDE1LzA3LzIwKSAtIENSOiBUMjAxNTA3MTQ5MDAwMDQwNyAobm8gY2hhbmdlcyBuZWVkZWQgdG8gYWRkIGNoYW5nZXMgZnJvbSBPVFJTIDQuMC4xMCkgKGRkb2VyZmZlbCkKICogKDIwMTUvMDYvMzApIC0gQnVnZml4OiBUMjAxNTA2MzA5MDAwMDMwNyAobWlzc2luZyBkZXBlbmRlbmNpZXMpIChkZG9lcmZmZWwpCiAqICgyMDE1LzA2LzI1KSAtIENSOiBUMjAxNTA2MjM5MDAwMDM3NSAoYWRkZWQgY2hhbmdlcyBmcm9tIE9UUlMgNC4wLjkpIChkZG9lcmZmZWwpCiAqICgyMDE1LzA2LzAyKSAtIEJ1Z2ZpeDogVDIwMTUwNTA2OTAwMDAzMDEgKGxvZyBlcnJvciBpbnN0YWxsaW5nIHBhY2thZ2VzKSAoZGRvZXJmZmVsKQogKiAoMjAxNS8wNS8xMikgLSBDUjogVDIwMTUwNTEyOTAwMDA0MTQgKGFkZGVkIGNoYW5nZXMgZnJvbSBPVFJTIDQuMC44KSAoZGRvZXJmZmVsKQoKIzQuMC4wICgyMDE1LzA1LzA0KQogKiAoMjAxNS8wNS8wNCkgLSBDUjogZmlyc3QgcHJvZHVjdGl2ZSByZWxlYXNlIGZvciBPVFJTIDQuMCAocmJvKQoKIzMuOTkuODIgKDIwMTUvMDQvMzApCiAqICgyMDE1LzA0LzMwKSAtIENSOiB0aGlyZCBiZXRhLXJlbGVhc2UgKHJibykKICogKDIwMTUvMDQvMzApIC0gQnVnZml4OiBUMjAxNTA0Mjg5MDAwMTQ2NyAoaW1wb3NzaWJsZSB0byByZWdpc3RlciBtdWx0aXBsZSBLSVggY3VzdG9tIHBhY2thZ2VzIHdpdGggc2FtZSBwcmlvKSAocmJvKQogKiAoMjAxNS8wNC8yOCkgLSBCdWdmaXg6IFQyMDE1MDQyODkwMDAxNDQ5IChhY3Rpb25zIFJlYnVpbGQgYW5kIENsZWFuVXBDb25maWdQbSBtaXhlZCB1cCBpbiBraXguTWFuYWdlTXVsdGlwbGVDdXN0b21QYWNrYWdlcy5wbCkgKHJibykKCiMzLjk5LjgxICgyMDE1LzA0LzIxKQogKiAoMjAxNS8wNC8yMSkgLSBDUjogc2Vjb25kIGJldGEtcmVsZWFzZSAocmJvKQogKiAoMjAxNS8wNC8xNykgLSBCdWdmaXg6IFQyMDE1MDQxNzkwMDAwNTc4IChyZWdleHAgaW4gb3V0cHV0IGZpbHRlciB0ZW1wbGF0ZSBkZWZpbml0aW9uIGRvZXNuJ3QgYWx3YXlzIG1hdGNoKSAocmJvKQoKIzMuOTkuODAgKDIwMTUvMDQvMDUpCiAqICgyMDE1LzA0LzA1KSAtIENSOiBmaXJzdCBiZXRhLXJlbGVhc2UgKHJibykKICogKDIwMTUvMDQvMDEpIC0gQ1I6IFQyMDE0MTEyNjkwMDAwNDc4IChhZGRlZCBjaGFuZ2VzIGZyb20gT1RSUyA0LjAuNykgKGRkb2VyZmZlbCkKICogKDIwMTUvMDMvMTcpIC0gQ1I6IFQyMDE1MDMxNzkwMDAwNDYzIChzbWFydCBkYXRlIG9wdGlvbnMgcmVtb3ZlZCkgKGRkb2VyZmZlbCkKICogKDIwMTUvMDIvMjYpIC0gQ1I6IFQyMDE0MTEyNjkwMDAwNDc4IChubyBjaGFuZ2VzIG5lZWRlZCB0byBhZGQgY2hhbmdlcyBmcm9tIE9UUlMgNC4wLjYpIChkZG9lcmZmZWwpCiAqICgyMDE1LzAyLzAzKSAtIEJ1Z2ZpeDogVDIwMTUwMjAzOTAwMDAzNDggKGZvcm1hdCBhbmQgZGF0ZSBtaXNzaW5nIGluIGRhdGVwaWNrZXIgb2JqZWN0KSAoZGRvZXJmZmVsKQogKiAoMjAxNS8wMi8wMykgLSBDUjogVDIwMTUwMjAyOTAwMDA3MDYgKHVzaW5nIHJlZ2V4cCBmb3Igb3V0cHV0IGZpbHRlciB0ZW1wbGF0ZSBkZWZpbml0aW9uKSAoZGRvZXJmZmVsKQogKiAoMjAxNS8wMi8wMykgLSBDUjogVDIwMTUwMjAyOTAwMDA2OTkgKGR0bCBjYWNoZSByZW1vdmVkKSAoZGRvZXJmZmVsKQogKiAoMjAxNS8wMi8wMikgLSBDUjogVDIwMTUwMjAyOTAwMDA3MTUgKHVwZGF0ZWQgY29weXJpZ2h0IGhlYWRlcnMpIChkZG9lcmZmZWwpCiAqICgyMDE1LzAxLzI3KSAtIENSOiBUMjAxNDExMjY5MDAwMDQ3OCAoYWRkZWQgY2hhbmdlcyBmcm9tIE9UUlMgNC4wLjUpIChkZG9lcmZmZWwpCiAqICgyMDE0LzExLzI3KSAtIENSOiBUMjAxNDExMjY5MDAwMDQ3OCAoYWRkZWQgY2hhbmdlcyBmcm9tIE9UUlMgNC4wLjEpIChkZG9lcmZmZWwpCiAqICgyMDE0LzExLzA3KSAtIENSOiBUMjAxNDExMDc5MDAwMDM3MSAobm8gY2hhbmdlcyBuZWVkZWQgdG8gYWRkIGNoYW5nZXMgZnJvbSBPVFJTIDMuMy4xMCkgKGRkb2VyZmZlbCkKICogKDIwMTQvMTAvMzEpIC0gQnVnZml4OiBUMjAxNDEwMjg5MDAwMDQ2NyAoU3lzQ29uZmlnIGNoYW5nZSBsb2dnaW5nIGRvZXMgYWx3YXlzIHVzZSBVc2VySUQgMSkgKHJibykKICogKDIwMTQvMDkvMTEpIC0gQ1I6IFQyMDE0MDkxMDkwMDAwNjI3IChhZGRlZCBjaGFuZ2VzIGZyb20gT1RSUyAzLjMuOSkgKGRkb2VyZmZlbCkKICogKDIwMTQvMDYvMjUpIC0gQ1I6IFQyMDE0MDYyNDkwMDAwMzg0IChubyBjaGFuZ2VzIG5lZWRlZCB0byBhZGQgY2hhbmdlcyBmcm9tIE9UUlMgMy4zLjgpIChkZG9lcmZmZWwpCgojMy4wLjIgKDIwMTQvMDUvMzApCiAqICgyMDE0LzA1LzE0KSAtIENSOiBUMjAxNDA1MTM5MDAwMDU3NiAoYWRkZWQgY2hhbmdlcyBmcm9tIE9UUlMgMy4zLjcpIChkZG9lcmZmZWwpCgojMy4wLjEgKDIwMTQvMDQvMjUpCiAqICgyMDE0LzA0LzIyKSAtIEJ1Z2ZpeDogVDIwMTQwNDA5OTAwMDA0NjEgKHdyb25nIGxvZyBwcmVmaXggaW4ga2l4Lk1hbmFnZU11bHRpcGxlQ3VzdG9tZXJQYWNrYWdlcy5wbCkgKHJibykKICogKDIwMTQvMDQvMDkpIC0gQ1I6IFQyMDE0MDQwMjkwMDAwMzAyIChhZGRlZCBjaGFuZ2VzIGZyb20gT1RSUyAzLjMuNikgKGRkb2VyZmZlbCkKICogKDIwMTQvMDIvMjYpIC0gQ1I6IFQyMDE0MDIyNTkwMDAwMzA4IChhZGRlZCBjaGFuZ2VzIGZyb20gT1RSUyAzLjMuNSkgKGRkb2VyZmZlbCkKCiMzLjAuMCAoMjAxNC8wMi8xMSkKICogKDIwMTQvMDIvMTEpIC0gQ1I6IGZpcnN0IHByb2R1Y3RpdmUgcmVsZWFzZSBmb3IgT1RSUyAzLjMgKHJibykKCiMyLjk5LjgzICgyMDE0LzAyLzAxKQogKiAoMjAxNC8wMi8wMSkgLSBDUjogZm91cnRoIGJldGEtcmVsZWFzZSBmb3IgT1RSUyAzLjMgKHJibykKICogKDIwMTQvMDEvMjkpIC0gQ1I6IFQyMDE0MDEyOTkwMDAwNTgxIChhZGRlZCBjaGFuZ2VzIGZyb20gT1RSUyAzLjMuNCkgKGRkb2VyZmZlbCkKCiMyLjk5LjgyICgyMDE0LzAxLzIwKQogKiAoMjAxNC8wMS8yMCkgLSBDUjogdGhpcmQgYmV0YS1yZWxlYXNlIGZvciBPVFJTIDMuMyAocmJvKQogKiAoMjAxNC8wMS8xNikgLSBDUjogVDIwMTQwMTE2OTAwMDAyNTYgKG92ZXJyaWRhYmxlIFFEYXRhIGNoYXJhY3RlciBsaW1pdHMpIChyYm8pCiAqICgyMDE0LzAxLzE2KSAtIENSOiBhZGRlZCBjaGFuZ2VzIGZyb20gT1RSUyAzLjMuMyAoZGRvZXJmZmVsKQogKiAoMjAxNC8wMS8xNSkgLSBDUjogVDIwMTQwMTE1OTAwMDAzOTIgKG92ZXJyaWRhYmxlIFRUTHMgZm9yIE1lbWNhY2hlZCBiYWNrZW5kKSAocmJvKQoKIzIuOTkuODEgKDIwMTQvMDEvMDcpCiAqICgyMDE0LzAxLzA3KSAtIENSOiBzZWNvbmQgYmV0YS1yZWxlYXNlIGZvciBPVFJTIDMuMyAocmJvKQogKiAoMjAxNC8wMS8wNykgLSBDUjogVDIwMTQwMTA3OTAwMDAzODEgKHByZS1jcmVhdGVkIGxvYWRlciBjYWNoZXMpIChyYm8pCgojMi45OS44MCAoMjAxMy8xMi8yOCkKICogKDIwMTMvMTIvMjgpIC0gQ1I6IGZpcnN0IGJldGEtcmVsZWFzZSBmb3IgT1RSUyAzLjMgKHJibykKICogKDIwMTMvMTIvMTYpIC0gQnVnZml4OiBUMjAxMzA5MTA5MDAwMDQ4NyAodW5pbnN0YWxsIG9mIHNvbWUgcGFja2FnZXMgbm90IHBvc3NpYmxlIG9uIENMSSkgKHJibykKICogKDIwMTMvMTIvMDUpIC0gQ1I6IGFkZGVkIGNoYW5nZXMgZnJvbSBPVFJTIDMuMy4yIChkZG9lcmZmZWwpCiAqICgyMDEzLzExLzE0KSAtIENSOiBhZGRlZCBjaGFuZ2VzIGZyb20gT1RSUyAzLjMuMSAoZGRvZXJmZmVsKQogKiAoMjAxMy8xMS8wNikgLSBDUjogYWRkZWQgY2hhbmdlcyBmcm9tIE9UUlMgMy4zLjAgcmMgMSAoZGRvZXJmZmVsKQogKiAoMjAxMy8xMC8yOCkgLSBDUjogYWRkZWQgY2hhbmdlcyBmcm9tIE9UUlMgMy4zLjAgYmV0YSA1IChkZG9lcmZmZWwpCiAqICgyMDEzLzEwLzIxKSAtIENSOiBhZGRlZCBjaGFuZ2VzIGZyb20gT1RSUyAzLjMuMCBiZXRhIDQgKGRkb2VyZmZlbCkKICogKDIwMTMvMTAvMjQpIC0gQ1I6IFQyMDEzMTAyNDkwMDAwMzc4IChvcHRpb25hbCB1c2FnZSBvZiAiQ2FjaGVkT2JqZWN0cyIgaW4gTWVtY2FjaGVkLnBtKSAocmJvKQogKiAoMjAxMy8xMC8yNCkgLSBCdWdmaXg6IFQyMDEzMTAxODkwMDAwMzI2IChjaGFuZ2VkIE1lbWNhY2hlZC5wbSB0byB1c2UgTUQ1IGNhY2hlIGtleXMpIChyYm8pCiAqICgyMDEzLzEwLzE1KSAtIENSOiBUMjAxMzEwMDk5MDAwMDE3NCAoYWRkZWQgY2hhbmdlcyBmcm9tIE9UUlMgMy4yLjExKSAoZGRvZXJmZmVsKQogKiAoMjAxMy8wOS8yNykgLSBCdWdmaXg6IFQyMDEzMDkyNzkwMDAwMzQ4IChmYXEucGwgbXVzdCBub3QgYmUgY2hhbmdlZCBieSBraXguTWFuYWdlTXVsdGlwbGVDdXN0b21QYWNrYWdlcy5wbCkgKHJibykKICogKDIwMTMvMDgvMjkpIC0gQ1I6IFQyMDEzMDgyOTkwMDAwMzkxIChhZGRlZCBjaGFuZ2VzIGZyb20gT1RSUyAzLjIuMTApIChkZG9lcmZmZWwpCiAqICgyMDEzLzA3LzExKSAtIENSOiBUMjAxMzA3MTE5MDAwMDE5NCAoYWRkZWQgY2hhbmdlcyBmcm9tIE9UUlMgMy4yLjkpIChkZG9lcmZmZWwpCiAqICgyMDEzLzA2LzE5KSAtIENSOiAoYWRkZWQgY2hhbmdlcyBmcm9tIE9UUlMgMy4yLjgpIChkZG9lcmZmZWwpCgojMi4wLjAgKDIwMTMvMDYvMTMpCiAqICgyMDEzLzA2LzEzKSAtIENSOiBmaXJzdCBwcm9kdWN0aXZlIHJlbGVhc2UgZm9yIE9UUlMgMy4yIChyYm8pCgojMS45OS44MyAoMjAxMy8wNi8xMSkKICogKDIwMTMvMDYvMTEpIC0gQ1I6IGZvdXJ0aCBiZXRhLXJlbGVhc2UgKHJibykKICogKDIwMTMvMDYvMTApIC0gQ1I6IFQyMDEzMDYwNjkwMDAwNjk3IChhZGQgQ29uZmlndXJlQ2FsbEhvbWUgZnVuY3Rpb25hbGl0eSkgKGRkb2VyZmZlbCkKCiMxLjk5LjgyICgyMDEzLzA1LzE2KQogKiAoMjAxMy8wNS8xNikgLSBDUjogdGhpcmQgYmV0YS1yZWxlYXNlIChyYm8pCiAqICgyMDEzLzA1LzA3KSAtIEJ1Z2ZpeDogVDIwMTMwNDI2OTAwMDAyOTcgKHNob3cgY29ycmVjdCBsYXlvdXQgaWYgbWluaWZpZWQgaXMgZGlzYWJsZWQpIChkZG9lcmZmZWwpCiAqICgyMDEzLzA1LzA2KSAtIENSOiAoYWRkZWQgY2hhbmdlcyBmcm9tIE9UUlMgMy4yLjYpIChkZG9lcmZmZWwpCgojMS45OS44MSAoMjAxMy8wNS8wNCkKICogKDIwMTMvMDUvMDQpIC0gQ1I6IHNlY29uZCBiZXRhLXJlbGVhc2UgKHJibykKICogKDIwMTMvMDQvMjIpIC0gQ1I6IChhZGRlZCBjaGFuZ2VzIGZyb20gT1RSUyAzLjIuNSkgKGRkb2VyZmZlbCkKCiMxLjk5LjgwICgyMDEzLzA0LzIwKQogKiAoMjAxMy8wNC8yMCkgLSBDUjogZmlyc3QgYmV0YS1yZWxlYXNlIChyYm8pCiAqICgyMDEzLzAzLzI1KSAtIENSOiAoYWRkZWQgY2hhbmdlcyBmcm9tIE9UUlMgMy4yLjMpIChkZG9lcmZmZWwpCiAqICgyMDEzLzAzLzIyKSAtIENSOiBUMjAxMzAzMjI5MDAwMDI3OSAoaW1wcm92ZWQgaGFuZGxpbmcgb2YgQ3VzdG9tUGFja2FnZXMpIChyYm8pCiAqICgyMDEzLzAzLzIwKSAtIENSOiBUMjAxMzAyMjY5MDAwMDUwNCAoZnVydGhlciBvcHRpbWl6YXRpb25zIG9mIGludGVybmFsIGNhY2hlcyAtIGFkZGVkIGFkdmFuY2VkIERUTCBjYWNoaW5nKSAocmJvKQogKiAoMjAxMy8wMy8xOCkgLSBDUjogVDIwMTMwMjI2OTAwMDA1MDQgKGZ1cnRoZXIgb3B0aW1pemF0aW9ucyBvZiBpbnRlcm5hbCBjYWNoZXMgLSBleHRlbmRlZCBtZW1jYWNoZWQgdG9vbHMpIChyYm8pCiAqICgyMDEzLzAzLzEzKSAtIENSOiBUMjAxMzAyMjY5MDAwMDUwNCAoZnVydGhlciBvcHRpbWl6YXRpb25zIG9mIGludGVybmFsIGNhY2hlcyAtIGNsZWFudXAgb3B0aW1pemF0aW9uIGFuZCBhZGRlZCBtZW1jYWNoZWQgdG9vbHMpIChyYm8pCiAqICgyMDEzLzAzLzA1KSAtIENSOiBUMjAxMzAyMjY5MDAwMDUwNCAoZnVydGhlciBvcHRpbWl6YXRpb25zIG9mIGludGVybmFsIGNhY2hlcykgKHJibykKICogKDIwMTMvMDMvMDQpIC0gQ1I6IFQyMDEzMDIyNjkwMDAwNTA0ICh1cGRhdGVkIHJlcXVpcmVkIHBlcmwgcGFja2FnZXMgbm90ZSBpbiBJbnRyb0luc3RhbGwpIChhbGl0dmlub3ZhKQogKiAoMjAxMy8wMy8wNCkgLSBDUjogVDIwMTMwMjI2OTAwMDA1MDQgKG9wdGltaXphdGlvbnMgb2YgaW50ZXJuYWwgY2FjaGVzKSAoYWxpdHZpbm92YSkKICogKDIwMTMvMDIvMjUpIC0gQ1I6IFQyMDEzMDIyMDkwMDAwMjAyIChtb2RpZmljYXRpb25zIGZvciBmcmFtZXdvcmsgT1RSUyAzLjIueCkgKGFsaXR2aW5vdmEpCgojMS4xLjgxICgyMDEzLzAyL3h4KQogKiAoMjAxMy8wMi8xOSkgLSBCdWdmaXg6IFQyMDEzMDIxODkwMDAwMTI3IChtaXNzaW5nIGljb25zIGluIHF1ZXVlIHRyZWUgdmlldykgKGRkb2VyZmZlbCkKICogKDIwMTMvMDIvMTUpIC0gQnVnZml4OiBUMjAxMzAyMTU5MDAwMDMzOCAoY3NzLWNhY2hlIG5vdCBkZWxldGVkIGJ5IG90cnMuTG9hZGVyQ2FjaGUucGwpIChyYm8pCiAqICgyMDEzLzAyLzE1KSAtIEJ1Z2ZpeDogVDIwMTMwMjE1OTAwMDAxMTQgKGZhdWx0eSBjcmVhdGlvbiBhbmQgaGFuZGxpbmcgb2YgY3NzLWNhY2hlKSAocmJvKQoKIzEuMS44MCAoMjAxMy8wMi8xNCkKICogKDIwMTMvMDIvMTQpIC0gQ1I6IGZpcnN0IGJldGEtcmVsZWFzZSAocmJvKQogKiAoMjAxMy8wMS8xNikgLSBDUjogVDIwMTMwMTE1OTAwMDA3MDUgKHRzdW5hbWkgZnJhbWV3b3JrIGZvciBza2lucykgKGRkb2VyZmZlbCkKICogKDIwMTMvMDEvMDMpIC0gQ1I6IFQyMDEzMDEwMzkwMDAxODM0IChhZGRlZCBjaGFuZ2VzIGZyb20gT1RSUyAzLjEuMTIpIChkZG9lcmZmZWwpCiAqICgyMDEyLzExLzE0KSAtIENSOiBUMjAxMjExMTM5MDAwMDIxOSAodHN1bmFtaSBmcmFtZXdvcmsgZm9yIGphdmFzY3JpcHQpIChkZG9lcmZmZWwpCiAqICgyMDEyLzEwLzIyKSAtIENSOiAoYWRkZWQgY2hhbmdlcyBmcm9tIE9UUlMgMy4xLjExKSAoZGRvZXJmZmVsKQogKiAoMjAxMi8wOS8yMSkgLSBDUjogKG1vZGlmaWNhdGlvbnMgZm9yIE9UUlMgMy4xLjEwKSAocmFibykKCiMxLjEuMCAoMjAxMi8wNy8zMSkKICogKDIwMTIvMDMvMTMpIC0gQ1I6IFQyMDEyMDIyNzkwMDAwMjgyIChtb2RpZmljYXRpb25zIGZvciBPVFJTIDMuMS54KSAoYWxpdHZpbm92YSkKCiMxLjAuMyAoMjAxMi8wMi8xNSkKICogKDIwMTIvMDIvMTUpIC0gQnVnZml4OiBUMjAxMTEyMDg5MDAwMDIyOSAoZG91YmxlIGVudHJ5IG9mIGNvbmNsdWRpbmcgMSBpbiBjb25maWcucG0pIChkZG9lcmZmZWwpCiAqICgyMDEyLzAyLzE0KSAtIEJ1Z2ZpeDogVDIwMTIwMjA2OTAwMDAzMzkgKENvbmZpZ3VyYXRpb24gZXhwb3J0IGNhdXNlcyBlcnJvciBpbiBBZ2VudFN0YXRzKSAoZGRvZXJmZmVsKQogKiAoMjAxMi8wMS8yNCkgLSBCdWdmaXg6IFQyMDEyMDExODkwMDAwNDg5IChXZWJGcm9udGVuZCBlcnJvciB3aXRoIHVzZSBvZiBIb3N0QmFzZWRUaGVtZXMpIChkZG9lcmZmZWwpCiAqICgyMDEyLzAxLzE2KSAtIEJ1Z2ZpeDogVDIwMTIwMTExOTAwMDAzNTggKFN5c0NvbmZpZ0l0ZW1VcGRhdGUgb25seSB1c2VkIGlmIFN5c0NvbmZpZ0xvZ2dpbmctRXZlbnQgYWN0aXZlKSAoZGRvZXJmZmVsKQogKiAoMjAxMS8xMi8wNSkgLSBCdWdmaXg6IFQyMDExMTIwNTkwMDAwMjI1IChjb25zaWRlcmVkIHBhdGhzIGZvciBzeXNjb25maWctb3B0aW9ucykgKG1hYmEpCgojMS4wLjIgKDIwMTEvMTEvMTEpCiAqICgyMDExLzExLzAyKSAtIEJ1Z2ZpeDogVDIwMTExMTAyOTAwMDA0MTEgKHVzZWQgd3JvbmcgcGF0aCkgKHNtZWhsaWcpCiAqICgyMDExLzEwLzI4KSAtIEJ1Z2ZpeDogVDIwMTExMDI4OTAwMDAzMDEgKG9yZGVyIG9mIExheW91dC1FeHRlbnNpb25zKSAobWFiYSkKCiMxLjAuMSAoMjAxMS8xMC8yNSkKICogKDIwMTEvMTAvMjUpIC0gQ1I6IChhZGRlZCBjaGFuZ2VzIGZyb20gT1RSUyAzLjAuMTEpIChzbWVobGlnKQogKiAoMjAxMS8xMC8wNykgLSBCdWdmaXg6IFN5c0NvbmZpZyBsb2dnaW5nIChwcmV2ZW50IGxvZyBlbnRyaWVzKSAobWFiYSkKICogKDIwMTEvMDkvMTkpIC0gQ1I6IEtJWFV0aWxzLnBtIChyZW1vdmVkIG5vdCBuZWVkZWQgRmlsZTo6QmFzZW5hbWUpIChtYWJhKQoKIzEuMC4wICgyMDExLzA5LzE1KQogKiAoMjAxMS8wOS8xNSkgLSBDUjogZmlyc3QgcHJvZHVjdGl2ZSByZWxlYXNlLiAodHRvKQoKIzAuOS44MSAoMjAxMS8wOS8xMikKICogKDIwMTEvMDkvMTIpIC0gQ1I6IHNlY29uZCBiZXRhLXJlbGVhc2UgKHJibykKICogKDIwMTEvMDgvMzApIC0gQ1I6IG1vdmVkIGtpeC5DaGVja01vZHVsZXMucGwgdG8gS0lYNE9UUlMgKG1hYmEpCiAqICgyMDExLzA4LzI0KSAtIENSOiByZW1vdmVkIGNhY2hpbmcgZm9yIHRlbXBsYXRlIGZpbGUgcGF0aCAodHRvKQoKIzAuOS44MCAoMjAxMS8wOC8xOSkKICogKDIwMTEvMDgvMTkpIC0gQ1I6IGZpcnN0IGJldGEtcmVsZWFzZQoKIzAuNS4xMiAoMjAxMS8wOC8xNikKICogKDIwMTEvMDgvMTEpIC0gQ1I6IGFkZGVkIGNhY2hpbmcgZm9yIHRlbXBsYXRlIGZpbGUgcGF0aCAodHRvKQogKiAoMjAxMS8wOC8wNSkgLSBCdWdmaXg6IGhhbmRsZSBmb3Igb3RycyBob21lLXBhdGggKHByZXZlbnQgZG91YmxlIC8pIChtYWJhKQogKiAoMjAxMS8wOC8wNSkgLSBDUjogbW9kaWZpZWQvYWRkZWQgcG9zdCBpbnN0YWxsYXRpb24gYWR2aWNlICh0dG8pCgojMC41LjExICgyMDExLzA4LzA0KQogKiAoMjAxMS8wOC8wNCkgLSBCdWdmaXg6IGZhbGxiYWNrIHRvIFVzZXJJRCAxIGluIFN5c0NvbmZpZ0l0ZW1VcGRhdGUgZXZlbnQgaGFuZGxlciBjYWxsICh0dG8pCiAqICgyMDExLzA4LzA0KSAtIENSOiBMYXlvdXRMb2FkZXIgc3VwcG9ydHMgdHN1bmFtaSBmcmFtZXdvcmsgbm93LCBza2luIEtJWDRPVFJTIGlzbid0IG5lZWRlZCBhbnkgbG9uZ2VyIChyYm8pCiAqICgyMDExLzA4LzAyKSAtIEJ1Z2ZpeDogc3RhdHMgZXhwb3J0IGFuZCBpbXBvcnQgZG9lcyBub3Qgc3VwcG9ydCBLSVggdHN1bmFtaSBmcmFtZXdvcmsgKG1hYmEpCgojMC41LjEwICgyMDExLzA4LzAxKQogKiAoMjAxMS8wOC8wMSkgLSBDUjogZXh0ZW5kZWQgU3lzQ29uZmlnIGxldmVscyAobWFiYSkKICogKDIwMTEvMDgvMDEpIC0gQ1I6IGNoYW5nZWQgY3VzdG9tIG1vZHVsZXMgcGF0aCB0byBhYnNvbHV0ZSBwYXRoIGluIENvbmZpZy5wbSAodHRvKQogKiAoMjAxMS8wOC8wMSkgLSBDUjogYWRkZWQgU09QTSBwcmUtaW5zdGFsbCBpbmZvcm1hdGlvbiAobWFiYSkKICogKDIwMTEvMDcvMjkpIC0gQ1I6IHJlbW92ZWQgRGF0YTo6Q29tcGFyZSBmcm9tIHJlcXVpcmVkIHBlcmwgbW9kdWxlcyB0aHVzIG1ha2luZyBTeXNDb25maWcgY2hhbmdlIGhpc3Rvcnkgb3B0aW9uYWwgKHR0bykKCiMwLjUuOSAoMjAxMS8wNy8yOCkKICogKDIwMTEvMDcvMjcpIC0gQ1I6IGNoYW5nZWQgc3ViIG5ldyB0byBzYXZlIEtJWFV0aWxzIGZyb20gbWlzc2luZyBvYmplY3RzIChtYWJhKQogKiAoMjAxMS8wNy8yNykgLSBCdWdmaXg6IG5vIHBhcmFtZXRlciByZXBsYWNpbmcgaW4gZXJyb3Igbm90aWNlcyAobWFiYSkKCiMwLjUuOCAoMjAxMS8wNy8yMCkKICogKDIwMTEvMDcvMjUpIC0gQ1I6IGNoYW5nZXMgZm9yIHBlcmwgY3JpdGljIChzbWVobGlnKQogKiAoMjAxMS8wNy8yMCkgLSBCdWdmaXg6IHVzZSBsaWIgaW4gYXBhY2hlMi1wZXJsLXN0YXJ0dXAucGwgKHNtZWhsaWcpCgojMC41LjcgKDIwMTEvMDcvMTgpCiAqICgyMDExLzA3LzE1KSAtIENSOiBhZGRlZCBjaGFuZ2VzIGZyb20gT1RSUyAzLjAuOSAobWFiYSkKICogKDIwMTEvMDYvMjcpIC0gQ1I6IGFkZGVkIGNoZWNrIGZvciByZXF1aXJlZCBwZXJsIG1vZHVsZXMgKG1hYmEpCiAqICgyMDExLzA2LzIyKSAtIENSOiBjaGFuZ2VkIFN5c0NvbmZpZyBldmVudCAiQ29uZmlnSXRlbVVwZGF0ZSIgdG8gIlN5c0NvbmZpZ0l0ZW1VcGRhdGUiIChyYm8pCiAqICgyMDExLzA2LzE1KSAtIENSOiBhZGRlZCBTeXNDb25maWcgZXZlbnRzIChhdCB0aGUgbW9tZW50IG9ubHkgIkNvbmZpZ0l0ZW1VcGRhdGUiKSAocmJvKQogKiAoMjAxMS8wNi8wNykgLSBDUjogaW1wcm92ZWQgdHJhbnNsYXRpb24gaGFuZGxpbmcgKHBlcmZvcm1hbmNlOyBhbGxvdyBvdmVyd3JpdGluZykgKG1hYmEpCiAqICgyMDExLzA2LzA2KSAtIENSOiBpbXByb3ZlZCBoYW5kbGluZyBmb3Igc3RhdGljIHN0YXRzIChtYWJhKQoKIzAuNS42ICgyMDExLzA1LzEwKQogKiAoMjAxMS8wNS8xMCkgLSBDUjogYWRkZWQgYWN0aW9uICJMaXN0IiB0byBvdHJzLk1hbmFnZU11bHRpcGxlQ3VzdG9tUGFja2FnZXMucGwKICogKDIwMTEvMDUvMTApIC0gQ1I6IGFkZGVkIG1vZGlmaWNhdGlvbnMgZm9yIE9UUlMgMy4wLjcKICogKDIwMTEvMDUvMDUpIC0gQnVnZml4OiBpbmNvbXBsZXRlIEhUTUwtcXVvdGUgaW4gc29wbQogKiAoMjAxMS8wNC8yMSkgLSBCdWdmaXg6IHVzZSBvZiB1bmluaXRpYWxpemVkIHZhcmlhYmxlCgojMC41LjUgKDIwMTEvMDQvMjEpCiAqICgyMDExLzA0LzE4KSAtIENSOiBhZGRlZCB0c3VuYW1pIGFwcHJvYWNoIGZvciBzdGF0aXN0aWNzCgojMC41LjQgKDIwMTEvMDQvMTEpCiAqICgyMDExLzA0LzExKSAtIEJ1Z2ZpeDogVDIwMTEwNDExOTAwMDAxODUgKENvbmZpZy5wbSByZXdyaXRlIHJlZ2V4cCBjb3VsZCBjYXVzZSB3cm9uZyBtYXRjaCkKICogKDIwMTEvMDMvMjgpIC0gQnVnZml4OiB1c2Ugb2YgdW5pbml0aWFsaXplZCB2YXJpYWJsZQoKIzAuNS4zICgyMDExLzAzLzI4KQogKiAoMjAxMS8wMy8yOCkgLSBCdWdmaXg6IHVzZSBvZiB1bmluaXRpYWxpemVkIHZhcmlhYmxlCgojMC41LjIgKDIwMTEvMDMvMjgpCiAqICgyMDExLzAzLzI4KSAtIENSOiBtb2RpZmljYXRpb24gb2YgQElOQyB1cG9uIHBhY2thZ2UgcmVnaXN0cmF0aW9uIHRvIGFsbG93IHVzYWdlIG9mIGN1c3RvbSBtb2R1bGVzIGluIENvZGVJbnN0YWxsLgogKiAoMjAxMS8wMy8yNSkgLSBCdWdmaXg6IGFkZGVkIG1vZGlmaWNhdGlvbiBvZiBhcGFjaGUyLXBlcmwtc3RhcnR1cC5wbC4KCiMwLjUuMSAoMjAxMS8wMy8yNSkKICogKDIwMTEvMDMvMjMpIC0gQnVnZml4OiBjYWxsIG9mIHJlbmFtZWQgbWV0aG9kIGluIExpbmtPYmplY3QuCgojMC41LjAgKDIwMTEvMDMvMjIpCiAqICgyMDExLzAzLzIxKSAtIENSOiBhZGRlZCBjb21tYW5kIGxpbmUgdG9vbCB0byBtYW5hZ2UgcmVnaXN0ZXJlZCBwYWNrYWdlcwogKiAoMjAxMS8wMy8yMSkgLSBDUjogcmV3b3JrZWQgS0lYVXRpbHMKICogKDIwMTEvMDMvMjEpIC0gQ1I6IGNoYW5nZWQgdHN1bmFtaSBhcHByb2FjaCB0byAidXNlIGxpYiIKICogKDIwMTEvMDMvMTQpIC0gQ1I6IGNoYW5nZWQgcGFja2FnZSBzZXR1cCBpbml0aWFsaXphdGlvbiBpbiBTT1BNCiAqICgyMDExLzAzLzExKSAtIENSOiBhZGRlZCBjcmVhdGlvbiBhbmQgdXNpbmcgb2YgZ2xvYmFsIHJlcG9zaXRvcnkgZmlsZQogKiAoMjAxMS8wMy8xMCkgLSBpbml0aWFsIGNvbW1pdAo=</File>
        <File Location="doc/en/KIXCore.pod" Permission="644" Encode="Base64">IyAkSWQ6IEtJWENvcmUucG9kLHYgMS45IDIwMTYvMDcvMTkgMDk6MjQ6MjkgcmJvIEV4cCAkCgo9aGVhZDEgR2VuZXJhbAoKVGhpcyBwYWNrYWdlIHByb3ZpZGVzIGEgbW9yZSBmbGV4aWJsZSBhbmQgbW9yZSBnZW5lcmFsIGFwcHJvYWNoIGZvciBleHRlbnNpb25zIG9mIGV4dGVuc2lvbnMgdGhhbiB0aGUgY29tbW9uICJDdXN0b20iLWZvbGRlciBvZiBPVFJTIGl0c2VsZi4gS0lYQ29yZSAoYXMgdGhlIGN1c3RvbSBmb2xkZXIgaXRzZWxmKSBpcyB0aGUgY29udGludWVkIGRldmVsb3BtZW50IG9mIHRoZSBwcmV2aW91cyB0c3VuYW1pIGFwcHJvYWNoIHRvIGV4dGVuZCBvdGhlciBPVFJTLWV4dGVuc2lvbnMuIEVtcGxveWluZyAidXNlIGxpYiIgaW5zdGVhZCBvZiAidW5zaGlmdCBASU5DIiBwcm92aWRlcyBtb3JlIHN0YWJpbGl0eSBhbmQgcmVkdWNlZCBjb21wbGV4aXR5LiBUaGVyZWZvcmUgZWFjaCBleHRlbnNpb24gcmVxdWlyZXMgYSBtb2RpZmljYXRpb24gb2YgS2VybmVsL0NvbmZpZy5wbSBhbmQgc2NyaXB0cy9hcGFjaGUyLXBlcmwtc3RhcnR1cC5wbC4gVGhpcyBjYW4gYmUgZG9uZSBhdXRvbWF0aWNhbGx5IGJ5IEtJWFV0aWxzOjpSZWdpc3RlckN1c3RvbVBhY2thZ2UuIEVhY2ggdGltZSBhIG5ldyBjdXN0b20gZm9sZGVyIGlzIHJlZ2lzdGVyZWQsIGEgYmFja3VwIG9mIHRoZSBtb2RpZmllZCBmaWxlIENvbmZpZy5wbSBvciBhcGFjaGUyLXBlcmwtc3RhcnR1cC5wbCB3aXRoIGEgdGltZXN0YW1wIHN1ZmZpeCBpcyB3cml0dGVuLgoKWW91IGNhbiB1c2UgdGhlIGZvbGxvd2luZyBPVFJTIGNvbnNvbGUgY29tbWFuZHMgdG8gbGlzdCBjdXN0b20gZm9sZGVycywgcmVnaXN0ZXIgb3IgdW5yZWdpc3RlciBhIGN1c3RvbSBmb2xkZXIgYnV0IGFjdHVhbGx5IHRoaXMgc2hvdWxkIGJlIGRvbmUgYnkgdGhlIHBhY2thZ2UgaW5zdGFsbGF0aW9uIHByb2Nlc3M6Cgo9aXRlbSAqIEFkbWluOjpNdWx0aXBsZUN1c3RvbVBhY2thZ2VzOjpMaXN0Cj1pdGVtICogQWRtaW46Ok11bHRpcGxlQ3VzdG9tUGFja2FnZXM6OlJlYnVpbGQKPWl0ZW0gKiBBZG1pbjo6TXVsdGlwbGVDdXN0b21QYWNrYWdlczo6UmVnaXN0ZXIKPWl0ZW0gKiBBZG1pbjo6TXVsdGlwbGVDdXN0b21QYWNrYWdlczo6VW5yZWdpc3RlcgoKSU1QT1JUQU5UOiBpZiB5b3UncmUgdXNpbmcgbW9kLXBlcmwgYSB3ZWJzZXJ2ZXIgcmVzdGFydCBpcyByZXF1aXJlZCBhZnRlciB0aGUgbW9kaWZpY2F0aW9uIG9mIGFwYWNoZTItcGVybC1zdGFydHVwLiBPdGhlcndpc2UsIG5vIGZ1cnRoZXIgY3VzdG9tIHBhY2thZ2VzIGluIHlvdXIgY3VzdG9tIG1vZGlmaWNhdGlvbiB3aWxsIGJlIGZvdW5kLiBVc2luZyBhIGZ1bmN0aW9uIG9mIHlvdXIgY3VzdG9tIGV4dGVuc2lvbiB1cG9uIGluc3RhbGxhdGlvbiAodHlwZSAicG9zdCIpIHdpbGwgTk9UIHdvcmssIHNpbmNlIEBJTkMgZG9lcyBub3QgY29udGFpbiB5b3VyIGN1c3RvbSBkaXJlY3RvcnkgeWV0LiBJbiBvcmRlciB0byB1c2UgY3VzdG9tIGZ1bmN0aW9ucyBpbW1lZGlhdGVseSBvbiBpbnN0YWxsYXRpb24geW91IG5lZWQgdG8gaW5zdGFsbCB0aGUgZXh0ZW5zaW9uIHZpYSBjb21tYW5kIGxpbmUuCgpUaGUgY29tbW9uIGZvbGRlciAiQ3VzdG9tIiBhbGxvd3MgdG8gb3ZlcndyaXRlIGFuIGV4aXN0aW5nIGZpbGUgb2YgYW4gYWxyZWFkeSBpbnN0YWxsZWQgcGFja2FnZSBvbmNlLiBJZiB5b3UgaW5zdGFsbGVkIGFub3RoZXIgZXh0ZW5zaW9uLCB5b3Ugd291bGQgZW5jb3VudGVyIHRoZSBzYW1lIHByb2JsZW0gYXMgaWYgeW91IGhhZCBubyAiQ3VzdG9tIiBmb2xkZXIuIFRoaXMgZHJhd2JhY2sgaXMgcmVzb2x2ZWQgd2l0aCBLSVhDb3JlLiBGdXJ0aGVybW9yZSB0aGUgY29tbW9uIEN1c3RvbS1mb2xkZXIgb2YgT1RSUyBkb2VzIG5vdCBhZmZlY3QgZm9sbG93aW5nIGZpbGVzL2l0ZW1zICh5ZXQpLiBCeSBleHRlbmRpbmcgdGhlIGN1c3RvbS1mb2xkZXIgYXBwcm9hY2ggaXQgaXMgcG9zc2libGUgdG8gZWFzaWx5IGRpcy0gYW5kIGVuYWJsZSB3aG9sZSBPVFJTLWV4dGVuc2lvbnMgYnkgdW4tL3JlZ2lzdGVyaW5nIHRoZSBjb3JyZXNwb25kaW5nIGN1c3RvbSBmb2xkZXIuCgo9b3ZlciA0Cgo9aXRlbSAqIEtlcm5lbDo6U3lzdGVtOjpLSVhVdGlscwoKPW92ZXIgOAoKY29udGFpbnMgbWV0aG9kcyB0byB1bi0vcmVnaXN0ZXIgY3VzdG9tIHBhY2thZ2VzIGFuZCBhZGQvZGVsZXRlIG1vZGlmaWNhdGlvbnMgdG8vZnJvbSBLZXJuZWwvQ29uZmlnLnBtIGFuZCBzY3JpcHRzL2FwYWNoZTItcGVybC1zdGFydHVwLnBsCgo9YmFjawoKPWl0ZW0gKiBLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Cgo9b3ZlciA4Cgpjb250YWlucyBtb2RpZmljYXRpb25zIHRvIHBsYWNlIGFuZCBhY2Nlc3MgdGVtcGxhdGUgZmlsZXMgYW5kIHRvIGxvYWQgc3ViIGxheW91dCBmaWxlcwoKPWJhY2sKCj1pdGVtICogS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dExvYWRlcgoKPW92ZXIgOAoKY29udGFpbnMgbW9kaWZpY2F0aW9ucyB0byB1c2UgS0lYIHBhdGhzIGZvciBza2lucwoKPWJhY2sKCj1pdGVtICogS2VybmVsOjpTeXN0ZW06OkxpbmtPYmplY3QKCj1vdmVyIDgKCnJlcXVpcmVkIG1vZGlmaWNhdGlvbiBzaW5jZSBtb2R1bGUgc2VhcmNoZXMgTGlua09iamVjdCBiYWNrZW5kcyBub3QgYmFzZWQgb24gQElOQyBidXQgb24gaGFyZCBjb2RlZCBmaWxlIHBhdGhzIC0gc2hvdWxkIGJlIGZleGVkIGluIGZ1dHVyZSBPVFJTIHJlbGVhc2VzCgo9YmFjawoKPWl0ZW0gKiBLZXJuZWw6OlN5c3RlbTo6U3lzQ29uZmlnCgo9b3ZlciA4Cgpjb250YWlucyBtb2RpZmljYXRpb25zIHRvIHBsYWNlIHhtbC1jb25maWd1cmF0aW9uIGZpbGVzIGluIGN1c3RvbSBmb2xkZXJzCgo9YmFjawoKPWl0ZW0gKiBLZXJuZWw6OlN5c3RlbTo6U3RhdHMKCj1vdmVyIDgKCmNvbnRhaW5zIG1vZGlmaWNhdGlvbnMgdG8gcGxhY2UgYW5kIGFjY2VzcyBzdGF0aWMgYW5kIGR5bmFtaWMgc3RhdHMgaW4gY3VzdG9tIGZvbGRlcnMKCj1iYWNrCgo9aXRlbSAqIEtlcm5lbDo6TGFuZ3VhZ2UKCj1vdmVyIDgKCmNvbnRhaW5zIG1vZGlmaWNhdGlvbnMgdG8gKHJlLSlwbGFjZSB0cmFuc2xhdGlvbiBmaWxlcyBieSBjdXN0b20gcGFja2FnZXMKCj1iYWNrCgo9aXRlbSAqIEN1c3RvbWVySGVhZGVyLmR0bCwgQ3VzdG9tZXJMb2dpbiwgZHRsLCBMb2dpbi5kdGwKCj1vdmVyIDgKCmNvbnRhaW4gbW9kaWZpY2F0aW9ucyB0byBidWlsZCBjb3JyZWN0IHBhdGhzIGluIGxpbmtzIHRvIGNzcyBhbnMganMgZmlsZXMgKG5lZWRlZCBmb3IgdHN1bmFtaSBhcHByb2FjaCkuCgo9YmFjawoKPWJhY2sKCj1oZWFkMSBDb3B5cmlnaHQKCktJWENvcmUgd3JpdHRlbi9lZGl0ZWQgYnk6Cgo9b3ZlciA0Cgo9aXRlbSAqIFJlbmUoZG90KUJvZWhtKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKCj1pdGVtICogTWFydGluKGRvdClCYWx6YXJlayhhdCljYXBlKGRhc2gpaXQoZG90KWRlCgo9aXRlbSAqIFRvcnN0ZW4oZG90KVRoYXUoYXQpY2FwZShkYXNoKWl0KGRvdClkZQoKPWl0ZW0gKiBBbm5hKGRvdClMaXR2aW5vdmEoYXQpY2FwZShkYXNoKWl0KGRvdClkZQoKPWJhY2sKClRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEFHUEwpLiBJZiB5b3UgZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9hZ3BsLnR4dC4KCj1jdXQK</File>
        <File Location="Kernel/System/KIXUtils.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwNi0yMDE2IGMuYS5wLmUuIElUIEdtYkgsIGh0dHA6Ly93d3cuY2FwZS1pdC5kZQojCiMgUHJvdmlkZXMgbWV0aG9kcyByZXF1aXJlZCBmb3IgcmVnaXN0cmF0aW9uIG9mIEtJWC1tb2R1bGVzIGFuZCBvdGhlciB1c2VmdWxsCiMgbWV0aG9kcyB3aGljaCBhcmUgaGFyZCB0byBhc3NpZ24gdG8gc29tZSBzcGVjaWZpYyBvYmplY3QuCiMKIyB3cml0dGVuL2VkaXRlZCBieToKIyAqIFRvcnN0ZW4oZG90KVRoYXUoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojICogUmVuZShkb3QpQm9laG0oYXQpY2FwZShkYXNoKWl0KGRvdClkZQojICogU3RlZmFuKGRvdClNZWhsaWcoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojICogTWFydGluKGRvdClCYWx6YXJlayhhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMgKiBGcmFuayhkb3QpT2JlcmVuZGVyKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIERvcm90aGVhKGRvdClEb2VyZmZlbChhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMgKiBBbm5hKGRvdClMaXR2aW5vdmEoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojCiMgLS0KIyAkSWQ6IEtJWFV0aWxzLnBtLHYgMS4yNSAyMDE2LzAxLzIwIDEzOjQ0OjQ1IGRkb2VyZmZlbCBFeHAgJAojICogRG9yb3RoZWEoZG90KURvZXJmZmVsKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIwojIC0tCiMgVGhpcyBzb2Z0d2FyZSBjb21lcyB3aXRoIEFCU09MVVRFTFkgTk8gV0FSUkFOVFkuIEZvciBkZXRhaWxzLCBzZWUKIyB0aGUgZW5jbG9zZWQgZmlsZSBDT1BZSU5HIGZvciBsaWNlbnNlIGluZm9ybWF0aW9uIChBR1BMKS4gSWYgeW91CiMgZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9hZ3BsLnR4dC4KIyAtLQoKcGFja2FnZSBLZXJuZWw6OlN5c3RlbTo6S0lYVXRpbHM7Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7Cgp1c2UgRmlsZTo6Q29weTsKCm91ciBAT2JqZWN0RGVwZW5kZW5jaWVzID0gKAogICAgJ0tlcm5lbDo6U3lzdGVtOjpEQicsCiAgICAnS2VybmVsOjpTeXN0ZW06OlRpbWUnLAopOwoKPWl0ZW0gbmV3KCkKCmNyZWF0ZSBhbiBvYmplY3QKCiAgICB1c2UgS2VybmVsOjpTeXN0ZW06Ok9iamVjdE1hbmFnZXI7CiAgICBsb2NhbCAkS2VybmVsOjpPTSA9IEtlcm5lbDo6U3lzdGVtOjpPYmplY3RNYW5hZ2VyLT5uZXcoKTsKICAgIG15ICRQYWNrYWdlT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlBhY2thZ2UnKTsKCj1jdXQKCnN1YiBuZXcgewogICAgbXkgKCAkVHlwZSwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGFsbG9jYXRlIG5ldyBoYXNoIGZvciBvYmplY3QKICAgIG15ICRTZWxmID0ge307CiAgICBibGVzcyggJFNlbGYsICRUeXBlICk7CgogICAgIyBnZXQgbmVlZGVkIG9iamVjdHMKICAgICRTZWxmLT57Q29uZmlnT2JqZWN0fSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CiAgICAkU2VsZi0+e01haW5PYmplY3R9ICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpOwogICAgJFNlbGYtPntUaW1lT2JqZWN0fSAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpbWUnKTsKCiAgICAkU2VsZi0+e0tJWEZSQU1FV09SS1NUUklOR19TVEFSVH0gPSAnIy0tLS0tLS0tLS0tIEtJWCB0c3VuYW1pIGZyYW1ld29yayAtLS0tLS0tLS0tLSc7CiAgICAkU2VsZi0+e0tJWEZSQU1FV09SS1NUUklOR19FTkR9ICAgPSAnIy0tLS0tLS0tLS0tIEVPIEtJWCB0c3VuYW1pIGZyYW1ld29yayAtLS0tLS0tLS0tLSc7CgogICAgJFNlbGYtPntLSVhGUkFNRVdPUktTVFJJTkd9ID0gIlxuIgogICAgICAgIC4gJFNlbGYtPntLSVhGUkFNRVdPUktTVFJJTkdfU1RBUlR9CiAgICAgICAgLiAiXG4iCiAgICAgICAgLiAnIyBDdXN0b21QYWNrYWdlTGlicyB+IycKICAgICAgICAuICJcbiIKICAgICAgICAuICcjIEVPIEN1c3RvbVBhY2thZ2VMaWJzIH4jJwogICAgICAgIC4gIlxuIgogICAgICAgIC4gJFNlbGYtPntLSVhGUkFNRVdPUktTVFJJTkdfRU5EfQogICAgICAgIC4gIlxuIjsKCiAgICAkU2VsZi0+e0tJWEZSQU1FV09SS1NUUklOR19NT0RQRVJMfSA9ICJcbiIKICAgICAgICAuICRTZWxmLT57S0lYRlJBTUVXT1JLU1RSSU5HX1NUQVJUfQogICAgICAgIC4gIlxuIgogICAgICAgIC4gJyMgQ3VzdG9tUGFja2FnZUxpYnMgfiMnCiAgICAgICAgLiAiXG4iCiAgICAgICAgLiAnIyBFTyBDdXN0b21QYWNrYWdlTGlicyB+IycKICAgICAgICAuICJcbiIKICAgICAgICAuICRTZWxmLT57S0lYRlJBTUVXT1JLU1RSSU5HX0VORH0KICAgICAgICAuICJcbiI7CgogICAgcmV0dXJuICRTZWxmOwp9Cgo9aXRlbSBSZWdpc3RlckN1c3RvbVBhY2thZ2UoKQoKICAgIG15ICRWYXIgPSAkS0lYVXRpbHNPYmplY3QtPlJlZ2lzdGVyQ3VzdG9tUGFja2FnZSgKICAgICAgICBQYWNrYWdlTmFtZSA9PiAiS0lYX0lUU00iLAogICAgICAgIFByaW9yaXR5ICAgID0+ICIxMjM0IiwKICAgICk7Cgo9Y3V0CgpzdWIgUmVnaXN0ZXJDdXN0b21QYWNrYWdlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBtYW5kYXRvcnkgcGFyYW1ldGVycwogICAgZm9yIChxdyhQYWNrYWdlTmFtZSBQcmlvcml0eSkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JF99ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZyggUHJpb3JpdHkgPT4gJ2Vycm9yJywgTWVzc2FnZSA9PiAiTmVlZCAkXyEiICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgbXkgJEN1c3RvbVBhY2thZ2VzID0gJFNlbGYtPkdldFJlZ2lzdGVyZWRDdXN0b21QYWNrYWdlcygpOwoKICAgICNkZWxldGUgY3VycmVudCBjb25maWd1cmF0aW9uIGZvciB0aGlzIHBhY2thZ2UuLi4KICAgIGlmICggJEN1c3RvbVBhY2thZ2VzICYmIHJlZigkQ3VzdG9tUGFja2FnZXMpIG5lICdIQVNIJyApIHsKICAgICAgICBmb3IgbXkgJEN1cnJQcmlvICgga2V5cyggJXskQ3VzdG9tUGFja2FnZXN9ICkgKSB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICRDdXN0b21QYWNrYWdlcy0+eyRDdXJyUHJpb30KICAgICAgICAgICAgICAgICYmICggJEN1c3RvbVBhY2thZ2VzLT57JEN1cnJQcmlvfSBlcSAkUGFyYW17UGFja2FnZU5hbWV9ICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgZGVsZXRlKCAkQ3VzdG9tUGFja2FnZXMtPnskQ3VyclByaW99ICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBzZXQgKG5ldykgcHJpb3JpdHkgZm9yIHRoaXMgcGFja2FnZS4uLgogICAgJEN1c3RvbVBhY2thZ2VzLT57ICRQYXJhbXtQcmlvcml0eX0uJzo6Jy4kUGFyYW17UGFja2FnZU5hbWV9IH0gPSAkUGFyYW17UGFja2FnZU5hbWV9OwoKICAgICRTZWxmLT5TZXRSZWdpc3RlcmVkQ3VzdG9tUGFja2FnZXMoIEN1c3RvbVBhY2thZ2VzID0+ICRDdXN0b21QYWNrYWdlcywgKTsKCiAgICByZXR1cm4gMTsKfQoKPWl0ZW0gVW5SZWdpc3RlckN1c3RvbVBhY2thZ2UoKQoKICAgUmVtb3ZlcyBhIHRzdW5hbWktZXh0ZW5zaW9uIGZyb20gdGhlIEtJWF9QYWNrYWdlcyBmaWxlLgoKICAgbXkgJFZhciA9ICRLSVhVdGlsc09iamVjdC0+VW5SZWdpc3RlckN1c3RvbVBhY2thZ2UoICJLSVhfSVRTTSIgKTsKCj1jdXQKCnN1YiBVblJlZ2lzdGVyQ3VzdG9tUGFja2FnZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbWFuZGF0b3J5IHBhcmFtZXRlcnMKICAgIGZvciAocXcoUGFja2FnZU5hbWUpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyRffSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coIFByaW9yaXR5ID0+ICdlcnJvcicsIE1lc3NhZ2UgPT4gIk5lZWQgJF8hIiApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIG15ICRDdXN0b21QYWNrYWdlcyA9ICRTZWxmLT5HZXRSZWdpc3RlcmVkQ3VzdG9tUGFja2FnZXMoKTsKCiAgICByZXR1cm4gaWYgKCAhJEN1c3RvbVBhY2thZ2VzIHx8IHJlZigkQ3VzdG9tUGFja2FnZXMpIG5lICdIQVNIJyApOwoKICAgIGZvciBteSAkQ3VyclByaW8gKCBrZXlzKCAleyRDdXN0b21QYWNrYWdlc30gKSApIHsKICAgICAgICBpZiAoCiAgICAgICAgICAgICRDdXN0b21QYWNrYWdlcy0+eyRDdXJyUHJpb30KICAgICAgICAgICAgJiYgKCAkQ3VzdG9tUGFja2FnZXMtPnskQ3VyclByaW99IGVxICRQYXJhbXtQYWNrYWdlTmFtZX0gKQogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICBkZWxldGUoICRDdXN0b21QYWNrYWdlcy0+eyRDdXJyUHJpb30gKTsKICAgICAgICB9CiAgICB9CgogICAgJFNlbGYtPlNldFJlZ2lzdGVyZWRDdXN0b21QYWNrYWdlcyggQ3VzdG9tUGFja2FnZXMgPT4gJEN1c3RvbVBhY2thZ2VzLCApOwoKICAgIHJldHVybiAxOwp9Cgo9aXRlbSBHZXRSZWdpc3RlcmVkQ3VzdG9tUGFja2FnZXMoKQoKICAgUmV0dXJucyBhIGhhc2ggcmVmIGNvbnRhaW5pbmcgYWxsIHJlZ2lzdGVyZWQgY3VzdG9tIHBhY2thZ2VzLiBLZXkgZGVub3RlcyB0aGUgcHJpb3JpdHkgb2YgdGhlIHBhY2thZ2UgKHZhbHVlKSBvcmRlci4KCiAgIG15ICVDdXN0b21QYWNrYWdlTGlzdCA9ICRLSVhVdGlsc09iamVjdC0+R2V0UmVnaXN0ZXJlZEN1c3RvbVBhY2thZ2VzKAogICAgICAgUmVzdWx0ID0+ICdBUlJBWScsICNvcHRpb25hbCAtIHJldHVybnMgc29ydGVkIGxpc3Qgb2YgY3VzdG9tIHBhY2thZ2VzIGluc3RlYWQgb2YgaGFzaCByZWYKICAgKTsKCj1jdXQKCnN1YiBHZXRSZWdpc3RlcmVkQ3VzdG9tUGFja2FnZXMgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKICAgIG15ICVSZXRWYWwgPSAoKTsKCiAgICBteSAkSG9tZSA9ICRTZWxmLT57Q29uZmlnT2JqZWN0fS0+R2V0KCdIb21lJyk7CiAgICBpZiAoICRIb21lICF+IG17Xi4qXC8kfXggKSB7CiAgICAgICAgJEhvbWUgLj0gJy8nOwogICAgfQogICAgbXkgJEtJWFBhY2thZ2VGaWxlID0gJEhvbWUgLiAnS0lYQ29yZS9DdXN0b21QYWNrYWdlcy5jZmcnOwoKICAgIGlmICggb3BlbiggbXkgJEZILCAnPCcsICRLSVhQYWNrYWdlRmlsZSApICkgewogICAgICAgIHdoaWxlICg8JEZIPikgewogICAgICAgICAgICBteSAkTGluZSA9ICRfOwogICAgICAgICAgICBjaG9tcCgkTGluZSk7CiAgICAgICAgICAgIG5leHQgaWYgKCAkTGluZSAhfiAvKC4rKTo6KC4rKS8gKTsKICAgICAgICAgICAgJFJldFZhbHskTGluZX0gPSAkMjsKICAgICAgICB9CiAgICAgICAgY2xvc2UoJEZIKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnbm90aWNlJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIktJWC1JbnN0YWxsOiBjb3VsZCBub3QgcmVhZCA8JEtJWFBhY2thZ2VGaWxlPiAtIHVzaW5nIGVtcHR5IGhhc2guIiwKICAgICAgICApOwogICAgfQoKICAgIGlmICggJFBhcmFte1Jlc3VsdH0gJiYgJFBhcmFte1Jlc3VsdH0gZXEgJ0FSUkFZJyApIHsKICAgICAgICBteSBAUmVzdWx0ID0gcXd7fTsKICAgICAgICBmb3IgbXkgJEN1cnJLZXkgKCBzb3J0KCBrZXlzKCVSZXRWYWwpICkgKSB7CiAgICAgICAgICAgIHB1c2goIEBSZXN1bHQsICRSZXRWYWx7JEN1cnJLZXl9ICk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBAUmVzdWx0OwogICAgfQoKICAgIHJldHVybiBcJVJldFZhbDsKfQoKPWl0ZW0gU2V0UmVnaXN0ZXJlZEN1c3RvbVBhY2thZ2VzKCkKCiAgIFdyaXRlcyB0aGUgQ3VzdG9tUGFja2FnZSBjb25maWd1cmF0aW9uIHRvIGZpbGUgLSBhdXRvbWF0aWNhbGx5IGFkZHMgY3VzdG9tIHBhY2thZ2UgIktJWENvcmUiIGF0IHByaW9yaXR5ICIwMDAwIi4KCiAgIG15ICRSZXN1bHQgPSAkS0lYVXRpbHNPYmplY3QtPlNldFJlZ2lzdGVyZWRDdXN0b21QYWNrYWdlcygKICAgICAgIEN1c3RvbVBhY2thZ2VzID0+ICRIYXNoUmVmLAogICApOwoKPWN1dAoKc3ViIFNldFJlZ2lzdGVyZWRDdXN0b21QYWNrYWdlcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwogICAgbXkgJFJlc3VsdCA9IDA7CgogICAgIyBjaGVjayBtYW5kYXRvcnkgcGFyYW1ldGVycwogICAgZm9yIChxdyhDdXN0b21QYWNrYWdlcykpIHsKICAgICAgICBpZiAoICEkUGFyYW17JF99ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZyggUHJpb3JpdHkgPT4gJ2Vycm9yJywgTWVzc2FnZSA9PiAiTmVlZCAkXyEiICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgbXkgJEhvbWUgPSAkU2VsZi0+e0NvbmZpZ09iamVjdH0tPkdldCgnSG9tZScpOwogICAgaWYgKCAkSG9tZSAhfiBte14uKlwvJH14ICkgewogICAgICAgICRIb21lIC49ICcvJzsKICAgIH0KICAgIG15ICRLSVhQYWNrYWdlRmlsZSA9ICRIb21lIC4gJ0tJWENvcmUvQ3VzdG9tUGFja2FnZXMuY2ZnJzsKCiAgICAjIGJhY2t1cCBvbGQgY29uZmlnCiAgICBpZiAoICEkUGFyYW17UmVidWlsZH0gKSB7CiAgICAgICAgbXkgKCAkcywgJG0sICRoLCAkRCwgJE0sICRZICkgPSAkU2VsZi0+e1RpbWVPYmplY3R9LT5TeXN0ZW1UaW1lMkRhdGUoCiAgICAgICAgICAgIFN5c3RlbVRpbWUgPT4gJFNlbGYtPntUaW1lT2JqZWN0fS0+U3lzdGVtVGltZSgpLAogICAgICAgICk7CiAgICAgICAgJE0gPSBzcHJpbnRmICclMDJkJywgJE07CiAgICAgICAgJEQgPSBzcHJpbnRmICclMDJkJywgJEQ7CiAgICAgICAgJGggPSBzcHJpbnRmICclMDJkJywgJGg7CiAgICAgICAgJG0gPSBzcHJpbnRmICclMDJkJywgJG07CiAgICAgICAgbXkgJFRpbWVzdGFtcFN1ZmZpeCA9ICIkWS0kTS0kRCIgLiAiXyRoLSRtIjsKICAgICAgICBjb3B5KCAkS0lYUGFja2FnZUZpbGUsICIkS0lYUGFja2FnZUZpbGUuUHJlQ3VzdG9tUGFja2FnZVJlZ2lzdHJhdGlvbi4kVGltZXN0YW1wU3VmZml4IiApOwogICAgfQoKICAgICMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICMgdXBkYXRlIHN0b3JhZ2UgZm9yIGN1c3RvbSBwYWNrYWdlcyBpbiA8T1RSU19IT01FPi9LSVhDb3JlL0N1c3RvbVBhY2thZ2VzLi4uCgogICAgIyBlbmZvcmNlICJLSVhDb3JlIiBjdXN0b20gcGFja2FnZS4uLgogICAgJFBhcmFte0N1c3RvbVBhY2thZ2VzfS0+eycwMDAwOjpLSVhDb3JlJ30gPSAnS0lYQ29yZSc7CgogICAgaWYgKCBvcGVuKCBteSAkRkgsICc+JywgJEtJWFBhY2thZ2VGaWxlICkgKSB7CiAgICAgICAgbXkgJEZpbGVDb250ZW50ID0gJyc7CiAgICAgICAgZm9yIG15ICRDdXJyUHJpb0tleSAoIHNvcnQga2V5cyAleyAkUGFyYW17Q3VzdG9tUGFja2FnZXN9IH0gKSB7CiAgICAgICAgICAgICRGaWxlQ29udGVudCAuPSAkQ3VyclByaW9LZXkgLiAiXG4iOwogICAgICAgIH0KICAgICAgICBwcmludCAkRkggJEZpbGVDb250ZW50OwogICAgICAgIGNsb3NlKCRGSCk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIktJWC1JbnN0YWxsOiBjb3VsZCBub3Qgd3JpdGUgPCRLSVhQYWNrYWdlRmlsZT4gISIsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIHVwZGF0ZSBvdXIgQ29uZmlnLnBtCiAgICAkU2VsZi0+X1VwZGF0ZUNvbmZpZ1BtKAogICAgICAgICVQYXJhbSwKICAgICAgICBIb21lID0+ICRIb21lLAogICAgKTsKCiAgICAjIHVwZGF0ZSBvdXIgYXBhY2hlIHBlcmwgc3RhcnR1cCBzY3JpcHQKICAgICRTZWxmLT5fVXBkYXRlQXBhY2hlUGVybFN0YXJ0dXAoCiAgICAgICAgJVBhcmFtLAogICAgICAgIEhvbWUgPT4gJEhvbWUsCiAgICApOwoKICAgICMgdXBkYXRlIG91ciBjZ2ktYmluIHNjcmlwdHMKICAgICRTZWxmLT5fVXBkYXRlQ0dJU2NyaXB0cygKICAgICAgICAlUGFyYW0sCiAgICAgICAgSG9tZSA9PiAkSG9tZSwKICAgICk7CgogICAgIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgIyBjaGFuZ2UgQElOQyB0byBhbGxvdyB1c2FnZSBvZiBjdXN0b20gbW9kdWxlcyBpbiBDb2RlSW5zdGFsbC4uLgogICAgIyAhISEgVGhpcyBkb2VzIG5vdCB3b3JrIHdpdGggbW9kX3BlcmwpICEhIQogICAgZm9yIG15ICRDdXJyUHJpb0tleSAoIHNvcnQga2V5cyAleyAkUGFyYW17Q3VzdG9tUGFja2FnZXN9IH0gKSB7CiAgICAgICAgdW5zaGlmdCggQElOQywgJEhvbWUgLiAkUGFyYW17Q3VzdG9tUGFja2FnZXN9LT57JEN1cnJQcmlvS2V5fSApOwogICAgfQoKICAgIHJldHVybiAkUmVzdWx0Owp9Cgo9aXRlbSBDbGVhblVwQ29uZmlnUG0oKQoKICAgUmVtb3ZlcyBmaWxlIGNyZWF0ZWQgYnkgS0lYQ29yZSByZS0vaW5zdGFsbGF0aW9uIGFuZCBhbGwgcmVsYXRlZCBsaW5lcyBmcm9tIEtlcm5lbC9Db25maWcucG0gYW5kIHNjcmlwdHMvYXBhY2hlMi1wZXJsLXN0YXJ0dXAucGwuCgogICBteSAkUmVzdWx0ID0gJEtJWFV0aWxzT2JqZWN0LT5DbGVhblVwQ29uZmlnUG0oKTsKCj1jdXQKCnN1YiBDbGVhblVwQ29uZmlnUG0gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKICAgIG15ICRSZXN1bHQgPSAwOwoKICAgIG15ICRIb21lID0gJFNlbGYtPntDb25maWdPYmplY3R9LT5HZXQoJ0hvbWUnKTsKICAgIGlmICggJEhvbWUgIX4gbXteLipcLyR9eCApIHsKICAgICAgICAkSG9tZSAuPSAnLyc7CiAgICB9CiAgICBteSAkS0lYUGFja2FnZUZpbGUgPSAkSG9tZSAuICdLSVhDb3JlL0N1c3RvbVBhY2thZ2VzLmNmZyc7CgogICAgIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgIyBkZWxldGUgc3RvcmFnZSBmb3IgY3VzdG9tIHBhY2thZ2VzIGluIDxPVFJTX0hPTUU+L0tJWENvcmUvQ3VzdG9tUGFja2FnZXMuLi4KICAgIGlmICggdW5saW5rKCRLSVhQYWNrYWdlRmlsZSkgKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdub3RpY2UnLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiS0lYLUluc3RhbGw6IGRlbGV0ZWQgPCRLSVhQYWNrYWdlRmlsZT4gISIsCiAgICAgICAgKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiS0lYLUluc3RhbGw6IGNvdWxkIG5vdCBkZWxldGUgPCRLSVhQYWNrYWdlRmlsZT4gISIsCiAgICAgICAgKTsKICAgIH0KCiAgICAjLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAjIHVwZGF0ZSB1c2UgbGliIGNvbmZpZ3VyYXRpb24gZm9yIGN1c3RvbSBwYWNrYWdlcyBDb25maWcucG0uLi4KICAgIG15ICRDb25maWdGaWxlID0gJEhvbWUgLiAnS2VybmVsL0NvbmZpZy5wbSc7CgogICAgIyBnZXQgY3VycmVudCBDb25maWcucG0gY29udGVudAogICAgbXkgJENvbmZpZ0ZpbGVDb250ZW50T3JpZyA9ICcnOwogICAgbXkgJENvbmZpZ0ZpbGVDb250ZW50TmV3ICA9ICcnOwoKICAgIGlmICggb3BlbiggbXkgJElOLCAnPCcsICRDb25maWdGaWxlICkgKSB7CiAgICAgICAgd2hpbGUgKCBteSAkTGluZSA9IDwkSU4+ICkgewogICAgICAgICAgICAkQ29uZmlnRmlsZUNvbnRlbnRPcmlnIC49ICRMaW5lOwogICAgICAgIH0KICAgICAgICBjbG9zZSgkSU4pOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDb3VsZCBub3Qgb3BlbiBmaWxlICRDb25maWdGaWxlISIsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgJENvbmZpZ0ZpbGVDb250ZW50TmV3ID0gJENvbmZpZ0ZpbGVDb250ZW50T3JpZzsKICAgICRDb25maWdGaWxlQ29udGVudE5ldyA9fgogICAgICAgIHN7JFNlbGYtPntLSVhGUkFNRVdPUktTVFJJTkdfU1RBUlR9KC4rKSRTZWxmLT57S0lYRlJBTUVXT1JLU1RSSU5HX0VORH19e31tc2c7CgogICAgIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgIyBhZGQgbmV3IGNvbnRlbnQgdG8gQ29uZmlnLnBtCiAgICBpZiAoIGxlbmd0aCgkQ29uZmlnRmlsZUNvbnRlbnROZXcpICkgewoKICAgICAgICBpZiAoIG9wZW4oIG15ICRPVVQsICc+JywgJENvbmZpZ0ZpbGUgKSApIHsKCiAgICAgICAgICAgIGJpbm1vZGUoJE9VVCk7CiAgICAgICAgICAgIHByaW50ICRPVVQgJENvbmZpZ0ZpbGVDb250ZW50TmV3OwogICAgICAgICAgICBjbG9zZSgkT1VUKTsKCiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ25vdGljZScsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiVXBkYXRlZCAkQ29uZmlnRmlsZS4iLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgJFJlc3VsdCA9IDE7CgogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkNvdWxkIG5vdCBvcGVuIG9yIGVkaXQgZmlsZSAkQ29uZmlnRmlsZSEiLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAjIHVwZGF0ZSB1c2UgbGliIGNvbmZpZ3VyYXRpb24gZm9yIGN1c3RvbSBwYWNrYWdlcyBhcGFjaGUyLXBlcmwtc3RhcnR1cC5wbAogICAgbXkgJEFwYWNoZTJQZXJsU3RhcnRVcEZpbGUgPSAkSG9tZSAuICdzY3JpcHRzL2FwYWNoZTItcGVybC1zdGFydHVwLnBsJzsKCiAgICAjIGdldCBjdXJyZW50IENvbmZpZy5wbSBjb250ZW50CiAgICBteSAkQXBhY2hlMlBlcmxTdGFydFVwRmlsZUNvbnRlbnRPcmlnID0gJyc7CiAgICBteSAkQXBhY2hlMlBlcmxTdGFydFVwRmlsZUNvbnRlbnROZXcgID0gJyc7CgogICAgaWYgKCBvcGVuKCBteSAkSU4sICc8JywgJEFwYWNoZTJQZXJsU3RhcnRVcEZpbGUgKSApIHsKICAgICAgICB3aGlsZSAoIG15ICRMaW5lID0gPCRJTj4gKSB7CiAgICAgICAgICAgICRBcGFjaGUyUGVybFN0YXJ0VXBGaWxlQ29udGVudE9yaWcgLj0gJExpbmU7CiAgICAgICAgfQogICAgICAgIGNsb3NlKCRJTik7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkNvdWxkIG5vdCBvcGVuIGZpbGUgJEFwYWNoZTJQZXJsU3RhcnRVcEZpbGUhIiwKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAkQXBhY2hlMlBlcmxTdGFydFVwRmlsZUNvbnRlbnROZXcgPSAkQXBhY2hlMlBlcmxTdGFydFVwRmlsZUNvbnRlbnRPcmlnOwogICAgJEFwYWNoZTJQZXJsU3RhcnRVcEZpbGVDb250ZW50TmV3ID1+CiAgICAgICAgc3skU2VsZi0+e0tJWEZSQU1FV09SS1NUUklOR19TVEFSVH0oLispJFNlbGYtPntLSVhGUkFNRVdPUktTVFJJTkdfRU5EfX17fW1zZzsKCiAgICAjLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAjIGFkZCBuZXcgY29udGVudCB0byBhcGFjaGUyLXBlcmwtc3RhcnR1cC5wbAogICAgaWYgKCBsZW5ndGgoJEFwYWNoZTJQZXJsU3RhcnRVcEZpbGVDb250ZW50TmV3KSApIHsKCiAgICAgICAgaWYgKCBvcGVuKCBteSAkT1VULCAnPicsICRBcGFjaGUyUGVybFN0YXJ0VXBGaWxlICkgKSB7CgogICAgICAgICAgICBiaW5tb2RlKCRPVVQpOwogICAgICAgICAgICBwcmludCAkT1VUICRBcGFjaGUyUGVybFN0YXJ0VXBGaWxlQ29udGVudE5ldzsKICAgICAgICAgICAgY2xvc2UoJE9VVCk7CgogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdub3RpY2UnLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIlVwZGF0ZWQgJEFwYWNoZTJQZXJsU3RhcnRVcEZpbGUuIiwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICRSZXN1bHQgPSAxOwoKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDb3VsZCBub3Qgb3BlbiBvciBlZGl0IGZpbGUgJEFwYWNoZTJQZXJsU3RhcnRVcEZpbGUhIiwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuICRSZXN1bHQ7Cn0KCj1pdGVtIFJlYnVpbGRDb25maWcoKQoKICAgIG15ICRWYXIgPSAkS0lYVXRpbHNPYmplY3QtPlJlYnVpbGRDb25maWcoKTsKCj1jdXQKCnN1YiBSZWJ1aWxkQ29uZmlnIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJEN1c3RvbVBhY2thZ2VzID0gJFNlbGYtPkdldFJlZ2lzdGVyZWRDdXN0b21QYWNrYWdlcygpOwogICAgJFNlbGYtPlNldFJlZ2lzdGVyZWRDdXN0b21QYWNrYWdlcyggQ3VzdG9tUGFja2FnZXMgPT4gJEN1c3RvbVBhY2thZ2VzLCBSZWJ1aWxkID0+IDEgKTsKCiAgICByZXR1cm4gMTsKfQoKPWl0ZW0gX1VwZGF0ZUNvbmZpZ1BtKCkKCiAgICBteSAkVmFyID0gJEtJWFV0aWxzT2JqZWN0LT5fVXBkYXRlQ29uZmlnUG0oCiAgICAgICAgSG9tZSA9PiAnLi4uJwogICAgKTsKCj1jdXQKCnN1YiBfVXBkYXRlQ29uZmlnUG0gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKICAgIG15ICRSZXN1bHQgPSAwOwoKICAgICMgY2hlY2sgbWFuZGF0b3J5IHBhcmFtZXRlcnMKICAgIGZvciAocXcoSG9tZSkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JF99ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZyggUHJpb3JpdHkgPT4gJ2Vycm9yJywgTWVzc2FnZSA9PiAiTmVlZCAkXyEiICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgbXkgJEhvbWUgPSAkUGFyYW17SG9tZX07CgogICAgIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgIyB1cGRhdGUgdXNlIGxpYiBjb25maWd1cmF0aW9uIGZvciBjdXN0b20gcGFja2FnZXMgQ29uZmlnLnBtLi4uCiAgICBteSAkQ29uZmlnRmlsZSA9ICRIb21lIC4gJ0tlcm5lbC9Db25maWcucG0nOwoKICAgICMgZ2V0IGN1cnJlbnQgQ29uZmlnLnBtIGNvbnRlbnQKICAgIG15ICRDb25maWdGaWxlQ29udGVudE9yaWcgICA9ICcnOwogICAgbXkgJENvbmZpZ0ZpbGVDb250ZW50TmV3ICAgID0gJyc7CiAgICBteSAkUGFja2FnZUNvbmZpZ0xpbmUgICAgICAgPSAwOwogICAgbXkgJFBhY2thZ2VDb25maWdMaW5lc0ZvdW5kID0gMDsKCiAgICBpZiAoIG9wZW4oIG15ICRJTiwgJzwnLCAkQ29uZmlnRmlsZSApICkgewogICAgICAgIHdoaWxlICggbXkgJExpbmUgPSA8JElOPiApIHsKICAgICAgICAgICAgaWYgKCAkTGluZSA9fiAvXHMqIyBDdXN0b21QYWNrYWdlTGlicyB+I1xzJCI7LyApIHsKICAgICAgICAgICAgICAgICRQYWNrYWdlQ29uZmlnTGluZXNGb3VuZCA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJENvbmZpZ0ZpbGVDb250ZW50T3JpZyAuPSAkTGluZTsKCiAgICAgICAgfQogICAgICAgIGNsb3NlKCRJTik7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkNvdWxkIG5vdCBvcGVuIGZpbGUgJENvbmZpZ0ZpbGUhIiwKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGlmIG5vIGxpbmVzIGxpa2UgIiMgQ3VzdG9tUGFja2FnZUxpYnMgfiMiIGZvdW5kLCBhZGQgY29tcGxldGUgS0lYRlJBTUVXT1JLU1RSSU5HIHN0cmluZy4uLgogICAgaWYgKCAhJFBhY2thZ2VDb25maWdMaW5lc0ZvdW5kICkgewogICAgICAgICRDb25maWdGaWxlQ29udGVudE9yaWcgPX4gcy8xO1xzKiQvL2d4OwogICAgICAgICRDb25maWdGaWxlQ29udGVudE5ldyA9ICRDb25maWdGaWxlQ29udGVudE9yaWcgLiAkU2VsZi0+e0tJWEZSQU1FV09SS1NUUklOR30gLiAiXG4xOyI7CiAgICB9CgogICAgIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgIyBnZXQgbmV3IGFkZGl0aW9uYWwgQ29uZmlnLnBtIGNvbnRlbnQKICAgIG15ICRDdXN0b21QYWNrYWdlTGliU2FtcGxlICAgICAgICAgICAgID0gJ3VzZSBsaWIgIicgLiAkSG9tZSAuICc8UEFDS0FHRU5BTUU+IjsnIC4gIlxuIjsKICAgIG15ICRDb25maWdGaWxlQ29udGVudEN1c3RvbVBhY2thZ2VMaWJzID0gJyMgQ3VzdG9tUGFja2FnZUxpYnMgfiMnIC4gIlxuIjsKCiAgICBmb3IgbXkgJEN1cnJQcmlvS2V5ICggc29ydCBrZXlzICV7ICRQYXJhbXtDdXN0b21QYWNrYWdlc30gfSApIHsKICAgICAgICAkQ29uZmlnRmlsZUNvbnRlbnRDdXN0b21QYWNrYWdlTGlicyAuPSAkQ3VzdG9tUGFja2FnZUxpYlNhbXBsZTsKICAgICAgICAkQ29uZmlnRmlsZUNvbnRlbnRDdXN0b21QYWNrYWdlTGlicyA9fgogICAgICAgICAgICBzLzxQQUNLQUdFTkFNRT4vJFBhcmFte0N1c3RvbVBhY2thZ2VzfS0+eyRDdXJyUHJpb0tleX0vZzsKICAgIH0KCiAgICAkQ29uZmlnRmlsZUNvbnRlbnRDdXN0b21QYWNrYWdlTGlicyAuPSAiIyBFTyBDdXN0b21QYWNrYWdlTGlicyB+IyI7CgogICAgJENvbmZpZ0ZpbGVDb250ZW50TmV3ID1+CiAgICAgICAgc3sjIEN1c3RvbVBhY2thZ2VMaWJzIH4jKC4rKSMgRU8gQ3VzdG9tUGFja2FnZUxpYnMgfiN9eyRDb25maWdGaWxlQ29udGVudEN1c3RvbVBhY2thZ2VMaWJzfW1zZzsKCiAgICAjLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAjIGFkZCBuZXcgY29udGVudCB0byBDb25maWcucG0KICAgIGlmICggbGVuZ3RoKCRDb25maWdGaWxlQ29udGVudE5ldykgKSB7CgogICAgICAgIGlmICggb3BlbiggbXkgJE9VVCwgJz4nLCAkQ29uZmlnRmlsZSApICkgewoKICAgICAgICAgICAgYmlubW9kZSgkT1VUKTsKICAgICAgICAgICAgcHJpbnQgJE9VVCAkQ29uZmlnRmlsZUNvbnRlbnROZXc7CiAgICAgICAgICAgIGNsb3NlKCRPVVQpOwoKICAgICAgICAgICAgbXkgKCAkcywgJG0sICRoLCAkRCwgJE0sICRZICkgPSAkU2VsZi0+e1RpbWVPYmplY3R9LT5TeXN0ZW1UaW1lMkRhdGUoCiAgICAgICAgICAgICAgICBTeXN0ZW1UaW1lID0+ICRTZWxmLT57VGltZU9iamVjdH0tPlN5c3RlbVRpbWUoKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJE0gPSBzcHJpbnRmICclMDJkJywgJE07CiAgICAgICAgICAgICREID0gc3ByaW50ZiAnJTAyZCcsICREOwogICAgICAgICAgICAkaCA9IHNwcmludGYgJyUwMmQnLCAkaDsKICAgICAgICAgICAgJG0gPSBzcHJpbnRmICclMDJkJywgJG07CiAgICAgICAgICAgIG15ICRUaW1lc3RhbXBTdWZmaXggPSAiJFktJE0tJEQiIC4gIl8kaC0kbSI7CiAgICAgICAgICAgIGlmICggb3BlbiggJE9VVCwgJz4nLCAiJENvbmZpZ0ZpbGUuUHJlQ3VzdG9tUGFja2FnZVJlZ2lzdHJhdGlvbi4kVGltZXN0YW1wU3VmZml4IiApICkgewogICAgICAgICAgICAgICAgYmlubW9kZSgkT1VUKTsKICAgICAgICAgICAgICAgIHByaW50ICRPVVQgJENvbmZpZ0ZpbGVDb250ZW50T3JpZzsKICAgICAgICAgICAgICAgIGNsb3NlKCRPVVQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdub3RpY2UnLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIlVwZGF0ZWQgJENvbmZpZ0ZpbGUuIiwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICRSZXN1bHQgPSAxOwoKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDb3VsZCBub3Qgb3BlbiBvciBlZGl0IGZpbGUgJENvbmZpZ0ZpbGUhIiwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuICRSZXN1bHQ7Cn0KCj1pdGVtIF9VcGRhdGVBcGFjaGVQZXJsU3RhcnR1cCgpCgogICAgbXkgJFZhciA9ICRLSVhVdGlsc09iamVjdC0+X1VwZGF0ZUFwYWNoZVBlcmxTdGFydHVwKAogICAgICAgIEhvbWUgPT4gJy4uLicKICAgICk7Cgo9Y3V0CgpzdWIgX1VwZGF0ZUFwYWNoZVBlcmxTdGFydHVwIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CiAgICBteSAkUmVzdWx0ID0gMDsKCiAgICAjIGNoZWNrIG1hbmRhdG9yeSBwYXJhbWV0ZXJzCiAgICBmb3IgKHF3KEhvbWUpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyRffSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coIFByaW9yaXR5ID0+ICdlcnJvcicsIE1lc3NhZ2UgPT4gIk5lZWQgJF8hIiApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIG15ICRIb21lID0gJFBhcmFte0hvbWV9OwoKICAgICMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICMgdXBkYXRlIHVzZSBsaWIgY29uZmlndXJhdGlvbiBmb3IgY3VzdG9tIHBhY2thZ2VzIGFwYWNoZTItcGVybC1zdGFydHVwLnBsLi4uCiAgICBteSAkQXBhY2hlMlBlcmxTdGFydFVwID0gJEhvbWUgLiAnc2NyaXB0cy9hcGFjaGUyLXBlcmwtc3RhcnR1cC5wbCc7CgogICAgIyBnZXQgY3VycmVudCBhcGFjaGUyLXBlcmwtc3RhcnR1cC5wbCBjb250ZW50CiAgICBteSAkQXBhY2hlMlBlcmxTdGFydFVwQ29udGVudE9yaWcgPSAnJzsKICAgIG15ICRBcGFjaGUyUGVybFN0YXJ0VXBDb250ZW50TmV3ICA9ICcnOwogICAgbXkgJFBhdGhQcmVmaXggICAgICAgICAgICAgICAgICAgID0gJEhvbWU7CiAgICAkUGF0aFByZWZpeCA9fiBzL1wvJC8vOyAgICAjIG5lZWRlZCBmb3IgcmVnZXgKICAgIG15ICRQYWNrYWdlQ29uZmlnTGluZSAgICAgICA9IDA7CiAgICBteSAkUGFja2FnZUNvbmZpZ0xpbmVzRm91bmQgPSAwOwoKICAgIGlmICggb3BlbiggbXkgJElOLCAnPCcsICRBcGFjaGUyUGVybFN0YXJ0VXAgKSApIHsKICAgICAgICB3aGlsZSAoIG15ICRMaW5lID0gPCRJTj4gKSB7CiAgICAgICAgICAgIGlmICggJExpbmUgPX4gL1xzKiMgQ3VzdG9tUGFja2FnZUxpYnMgfiNccyQiOy8gKSB7CiAgICAgICAgICAgICAgICAkUGFja2FnZUNvbmZpZ0xpbmVzRm91bmQgPSAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRBcGFjaGUyUGVybFN0YXJ0VXBDb250ZW50T3JpZyAuPSAkTGluZTsKCiAgICAgICAgfQogICAgICAgIGNsb3NlKCRJTik7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkNvdWxkIG5vdCBvcGVuIGZpbGUgJEFwYWNoZTJQZXJsU3RhcnRVcCEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgaWYgbm8gbGluZXMgbGlrZSAiIyBDdXN0b21QYWNrYWdlTGlicyB+IyIgZm91bmQsIGFkZCBjb21wbGV0ZSBLSVhGUkFNRVdPUktTVFJJTkcgc3RyaW5nLi4uCiAgICBpZiAoICEkUGFja2FnZUNvbmZpZ0xpbmVzRm91bmQgKSB7CiAgICAgICAgJEFwYWNoZTJQZXJsU3RhcnRVcENvbnRlbnROZXcgPSAkQXBhY2hlMlBlcmxTdGFydFVwQ29udGVudE9yaWc7CiAgICAgICAgJFNlbGYtPntLSVhGUkFNRVdPUktTVFJJTkdfTU9EUEVSTH0KICAgICAgICAgICAgPSAndXNlIGxpYiAiJyAuICRQYXRoUHJlZml4IC4gJy9DdXN0b20iOycgLiAiXG4iIC4gJFNlbGYtPntLSVhGUkFNRVdPUktTVFJJTkdfTU9EUEVSTH07CiAgICAgICAgJEFwYWNoZTJQZXJsU3RhcnRVcENvbnRlbnROZXcKICAgICAgICAgICAgPX4gc3t1c2UgbGliICIkUGF0aFByZWZpeC9DdXN0b20iO317JFNlbGYtPntLSVhGUkFNRVdPUktTVFJJTkdfTU9EUEVSTH19bXNnOwogICAgfQoKICAgICMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICMgZ2V0IG5ldyBhZGRpdGlvbmFsIGFwYWNoZTItcGVybC1zdGFydHVwLnBsIGNvbnRlbnQKICAgIG15ICRDdXN0b21QYWNrYWdlTGliU2FtcGxlID0gIlxuIgogICAgICAgIC4gJ3VzZSBsaWIgIicgLiAkUGF0aFByZWZpeCAuICcvPFBBQ0tBR0VOQU1FPiI7JzsKICAgIG15ICRBcGFjaGUyUGVybFN0YXJ0VXBDb250ZW50Q3VzdG9tUGFja2FnZUxpYnMgPSAiIyBDdXN0b21QYWNrYWdlTGlicyB+IyI7CgogICAgZm9yIG15ICRDdXJyUHJpb0tleSAoIHNvcnQga2V5cyAleyAkUGFyYW17Q3VzdG9tUGFja2FnZXN9IH0gKSB7CiAgICAgICAgJEFwYWNoZTJQZXJsU3RhcnRVcENvbnRlbnRDdXN0b21QYWNrYWdlTGlicyAuPSAkQ3VzdG9tUGFja2FnZUxpYlNhbXBsZTsKICAgICAgICAkQXBhY2hlMlBlcmxTdGFydFVwQ29udGVudEN1c3RvbVBhY2thZ2VMaWJzID1+CiAgICAgICAgICAgIHMvPFBBQ0tBR0VOQU1FPi8kUGFyYW17Q3VzdG9tUGFja2FnZXN9LT57JEN1cnJQcmlvS2V5fS9nOwogICAgfQoKICAgICRBcGFjaGUyUGVybFN0YXJ0VXBDb250ZW50Q3VzdG9tUGFja2FnZUxpYnMgLj0gIiMgRU8gQ3VzdG9tUGFja2FnZUxpYnMgfiMiOwoKICAgICRBcGFjaGUyUGVybFN0YXJ0VXBDb250ZW50TmV3ID1+CiAgICAgICAgc3sjIEN1c3RvbVBhY2thZ2VMaWJzIH4jKC4rKSMgRU8gQ3VzdG9tUGFja2FnZUxpYnMgfiN9eyRBcGFjaGUyUGVybFN0YXJ0VXBDb250ZW50Q3VzdG9tUGFja2FnZUxpYnN9bXNnOwoKICAgICMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICMgYWRkIG5ldyBjb250ZW50IHRvIGFwYWNoZTItcGVybC1zdGFydHVwLnBsCiAgICBpZiAoIGxlbmd0aCgkQXBhY2hlMlBlcmxTdGFydFVwQ29udGVudE5ldykgKSB7CgogICAgICAgIGlmICggb3BlbiggbXkgJE9VVCwgJz4nLCAkQXBhY2hlMlBlcmxTdGFydFVwICkgKSB7CgogICAgICAgICAgICBiaW5tb2RlKCRPVVQpOwogICAgICAgICAgICBwcmludCAkT1VUICRBcGFjaGUyUGVybFN0YXJ0VXBDb250ZW50TmV3OwogICAgICAgICAgICBjbG9zZSgkT1VUKTsKCiAgICAgICAgICAgIG15ICggJHMsICRtLCAkaCwgJEQsICRNLCAkWSApID0gJFNlbGYtPntUaW1lT2JqZWN0fS0+U3lzdGVtVGltZTJEYXRlKAogICAgICAgICAgICAgICAgU3lzdGVtVGltZSA9PiAkU2VsZi0+e1RpbWVPYmplY3R9LT5TeXN0ZW1UaW1lKCksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRNID0gc3ByaW50ZiAnJTAyZCcsICRNOwogICAgICAgICAgICAkRCA9IHNwcmludGYgJyUwMmQnLCAkRDsKICAgICAgICAgICAgJGggPSBzcHJpbnRmICclMDJkJywgJGg7CiAgICAgICAgICAgICRtID0gc3ByaW50ZiAnJTAyZCcsICRtOwogICAgICAgICAgICBteSAkVGltZXN0YW1wU3VmZml4ID0gIiRZLSRNLSREIiAuICJfJGgtJG0iOwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBvcGVuKAogICAgICAgICAgICAgICAgICAgICRPVVQsICc+JywgIiRBcGFjaGUyUGVybFN0YXJ0VXAuUHJlQ3VzdG9tUGFja2FnZVJlZ2lzdHJhdGlvbi4kVGltZXN0YW1wU3VmZml4IgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBiaW5tb2RlKCRPVVQpOwogICAgICAgICAgICAgICAgcHJpbnQgJE9VVCAkQXBhY2hlMlBlcmxTdGFydFVwQ29udGVudE9yaWc7CiAgICAgICAgICAgICAgICBjbG9zZSgkT1VUKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnbm90aWNlJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJVcGRhdGVkICRBcGFjaGUyUGVybFN0YXJ0VXAuIiwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICRSZXN1bHQgPSAxOwoKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDb3VsZCBub3Qgb3BlbiBvciBlZGl0IGZpbGUgJEFwYWNoZTJQZXJsU3RhcnRVcCEiLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gJFJlc3VsdDsKfQoKPWl0ZW0gX1VwZGF0ZUNHSVNjcmlwdHMoKQoKICAgIG15ICRWYXIgPSAkS0lYVXRpbHNPYmplY3QtPl9VcGRhdGVDR0lTY3JpcHRzKAogICAgICAgIEhvbWUgPT4gJy4uLicKICAgICk7Cgo9Y3V0CgpzdWIgX1VwZGF0ZUNHSVNjcmlwdHMgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKICAgIG15ICRSZXN1bHQgPSAwOwoKICAgICMgY2hlY2sgbWFuZGF0b3J5IHBhcmFtZXRlcnMKICAgIGZvciAocXcoSG9tZSkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JF99ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZyggUHJpb3JpdHkgPT4gJ2Vycm9yJywgTWVzc2FnZSA9PiAiTmVlZCAkXyEiICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgbXkgJEhvbWUgPSAkUGFyYW17SG9tZX07CgogICAgIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgIyB1cGRhdGUgdXNlIGxpYiBjb25maWd1cmF0aW9uIGZvciBhbGwgQ0dJIHBsIHNjcmlwdHMuLi4KICAgIG9wZW5kaXIoIERJUiwgIiRIb21lL2Jpbi9jZ2ktYmluIiApOwogICAgbXkgQFNjcmlwdEZpbGVzID0gZ3JlcCB7L14uKlwucGwkL2d9IHJlYWRkaXIoRElSKTsKICAgIGNsb3NlZGlyKERJUik7CgogICAgZm9yZWFjaCBteSAkU2NyaXB0RmlsZSAoQFNjcmlwdEZpbGVzKSB7CiAgICAgICAgIyBpZ25vcmUgZmFxLnBsCiAgICAgICAgbmV4dCBpZiAkU2NyaXB0RmlsZSBlcSAnZmFxLnBsJzsKCiAgICAgICAgbXkgJFNjcmlwdEZpbGUgPSAiJEhvbWUvYmluL2NnaS1iaW4vJFNjcmlwdEZpbGUiOwoKICAgICAgICAjIGdldCBjdXJyZW50IGZpbGUgY29udGVudAogICAgICAgIG15ICRTY3JpcHRGaWxlQ29udGVudE9yaWcgPSAnJzsKICAgICAgICBteSAkU2NyaXB0RmlsZUNvbnRlbnROZXcgID0gJyc7CiAgICAgICAgbXkgJFBhdGhQcmVmaXggICAgICAgICAgICA9ICRIb21lOwogICAgICAgICRQYXRoUHJlZml4ID1+IHMvXC8kLy87ICAgICMgbmVlZGVkIGZvciByZWdleAogICAgICAgIG15ICRQYWNrYWdlQ29uZmlnTGluZSAgICAgICA9IDA7CiAgICAgICAgbXkgJFBhY2thZ2VDb25maWdMaW5lc0ZvdW5kID0gMDsKCiAgICAgICAgaWYgKCBvcGVuKCBteSAkSU4sICc8JywgJFNjcmlwdEZpbGUgKSApIHsKICAgICAgICAgICAgd2hpbGUgKCBteSAkTGluZSA9IDwkSU4+ICkgewogICAgICAgICAgICAgICAgaWYgKCAkTGluZSA9fiAvXHMqIyBDdXN0b21QYWNrYWdlTGlicyB+I1xzJCI7LyApIHsKICAgICAgICAgICAgICAgICAgICAkUGFja2FnZUNvbmZpZ0xpbmVzRm91bmQgPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJFNjcmlwdEZpbGVDb250ZW50T3JpZyAuPSAkTGluZTsKCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2xvc2UoJElOKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDb3VsZCBub3Qgb3BlbiBmaWxlICRTY3JpcHRGaWxlISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIG5leHQ7CiAgICAgICAgfQoKICAgICAgICAjIGlmIG5vIGxpbmVzIGxpa2UgIiMgQ3VzdG9tUGFja2FnZUxpYnMgfiMiIGZvdW5kLCBhZGQgY29tcGxldGUgS0lYRlJBTUVXT1JLU1RSSU5HIHN0cmluZy4uLgogICAgICAgIGlmICggISRQYWNrYWdlQ29uZmlnTGluZXNGb3VuZCApIHsKICAgICAgICAgICAgJFNjcmlwdEZpbGVDb250ZW50TmV3ID0gJFNjcmlwdEZpbGVDb250ZW50T3JpZzsKICAgICAgICAgICAgJFNjcmlwdEZpbGVDb250ZW50TmV3ID1+CiAgICAgICAgICAgICAgICBze3VzZSBsaWIgIlwkQmluLy4uLy4uL0N1c3RvbSI7fXt1c2UgbGliICJcJEJpbi8uLi8uLi9DdXN0b20iO1xuJFNlbGYtPntLSVhGUkFNRVdPUktTVFJJTkd9fW1zZzsKICAgICAgICB9CgogICAgICAgICMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAjIGdldCBuZXcgYWRkaXRpb25hbCBmaWxlIGNvbnRlbnQKICAgICAgICBteSAkQ3VzdG9tUGFja2FnZUxpYlNhbXBsZSAgICAgICAgICAgICA9ICd1c2UgbGliICInIC4gJEhvbWUgLiAnPFBBQ0tBR0VOQU1FPiI7JyAuICJcbiI7CiAgICAgICAgbXkgJFNjcmlwdEZpbGVDb250ZW50Q3VzdG9tUGFja2FnZUxpYnMgPSAnIyBDdXN0b21QYWNrYWdlTGlicyB+IycgLiAiXG4iOwoKICAgICAgICBmb3IgbXkgJEN1cnJQcmlvS2V5ICggc29ydCBrZXlzICV7ICRQYXJhbXtDdXN0b21QYWNrYWdlc30gfSApIHsKICAgICAgICAgICAgJFNjcmlwdEZpbGVDb250ZW50Q3VzdG9tUGFja2FnZUxpYnMgLj0gJEN1c3RvbVBhY2thZ2VMaWJTYW1wbGU7CiAgICAgICAgICAgICRTY3JpcHRGaWxlQ29udGVudEN1c3RvbVBhY2thZ2VMaWJzID1+CiAgICAgICAgICAgICAgICBzLzxQQUNLQUdFTkFNRT4vJFBhcmFte0N1c3RvbVBhY2thZ2VzfS0+eyRDdXJyUHJpb0tleX0vZzsKICAgICAgICB9CgogICAgICAgICRTY3JpcHRGaWxlQ29udGVudEN1c3RvbVBhY2thZ2VMaWJzIC49ICIjIEVPIEN1c3RvbVBhY2thZ2VMaWJzIH4jIjsKCiAgICAgICAgJFNjcmlwdEZpbGVDb250ZW50TmV3ID1+CiAgICAgICAgICAgIHN7IyBDdXN0b21QYWNrYWdlTGlicyB+IyguKykjIEVPIEN1c3RvbVBhY2thZ2VMaWJzIH4jfXskU2NyaXB0RmlsZUNvbnRlbnRDdXN0b21QYWNrYWdlTGlic31tc2c7CgogICAgICAgICMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAjIGFkZCBuZXcgY29udGVudCB0byBmaWxlCiAgICAgICAgaWYgKCBsZW5ndGgoJFNjcmlwdEZpbGVDb250ZW50TmV3KSApIHsKCiAgICAgICAgICAgIGlmICggb3BlbiggbXkgJE9VVCwgJz4nLCAkU2NyaXB0RmlsZSApICkgewoKICAgICAgICAgICAgICAgIGJpbm1vZGUoJE9VVCk7CiAgICAgICAgICAgICAgICBwcmludCAkT1VUICRTY3JpcHRGaWxlQ29udGVudE5ldzsKICAgICAgICAgICAgICAgIGNsb3NlKCRPVVQpOwoKICAgICAgICAgICAgICAgIG15ICggJHMsICRtLCAkaCwgJEQsICRNLCAkWSApID0gJFNlbGYtPntUaW1lT2JqZWN0fS0+U3lzdGVtVGltZTJEYXRlKAogICAgICAgICAgICAgICAgICAgIFN5c3RlbVRpbWUgPT4gJFNlbGYtPntUaW1lT2JqZWN0fS0+U3lzdGVtVGltZSgpLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICRNID0gc3ByaW50ZiAnJTAyZCcsICRNOwogICAgICAgICAgICAgICAgJEQgPSBzcHJpbnRmICclMDJkJywgJEQ7CiAgICAgICAgICAgICAgICAkaCA9IHNwcmludGYgJyUwMmQnLCAkaDsKICAgICAgICAgICAgICAgICRtID0gc3ByaW50ZiAnJTAyZCcsICRtOwogICAgICAgICAgICAgICAgbXkgJFRpbWVzdGFtcFN1ZmZpeCA9ICIkWS0kTS0kRCIgLiAiXyRoLSRtIjsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICBvcGVuKCAkT1VULCAnPicsICIkU2NyaXB0RmlsZS5QcmVDdXN0b21QYWNrYWdlUmVnaXN0cmF0aW9uLiRUaW1lc3RhbXBTdWZmaXgiICkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgYmlubW9kZSgkT1VUKTsKICAgICAgICAgICAgICAgICAgICBwcmludCAkT1VUICRTY3JpcHRGaWxlQ29udGVudE9yaWc7CiAgICAgICAgICAgICAgICAgICAgY2xvc2UoJE9VVCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ25vdGljZScsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIlVwZGF0ZWQgJFNjcmlwdEZpbGUuIiwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgJFJlc3VsdCA9IDE7CgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiQ291bGQgbm90IG9wZW4gb3IgZWRpdCBmaWxlICRTY3JpcHRGaWxlISIsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAkUmVzdWx0Owp9CgoxOwo=</File>
        <File Location="KIXCore/Kernel/Language.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDE2IE9UUlMgQUcsIGh0dHA6Ly9vdHJzLmNvbS8KIyBLSVhDb3JlLUV4dGVuc2lvbnMgQ29weXJpZ2h0IChDKSAyMDA2LTIwMTYgYy5hLnAuZS4gSVQgR21iSCwgaHR0cDovL3d3dy5jYXBlLWl0LmRlCiMKIyB3cml0dGVuL2VkaXRlZCBieToKIyAqIFRvcnN0ZW4oZG90KVRoYXUoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojICogTWFydGluKGRvdClCYWx6YXJlayhhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMgKiBBbm5hKGRvdClMaXR2aW5vdmEoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojICogRG9yb3RoZWEoZG90KURvZXJmZmVsKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAtLQojICRJZDogTGFuZ3VhZ2UucG0sdiAxLjE2IDIwMTYvMDQvMTMgMTI6MTc6MjUgZGRvZXJmZmVsIEV4cCAkCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEFHUEwpLiBJZiB5b3UKIyBkaWQgbm90IHJlY2VpdmUgdGhpcyBmaWxlLCBzZWUgaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2FncGwudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6TGFuZ3VhZ2U7Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7Cgp1c2UgdmFycyBxdyhASVNBKTsKCnVzZSBFeHBvcnRlciBxdyhpbXBvcnQpOwpvdXIgQEVYUE9SVF9PSyA9IHF3KFRyYW5zbGF0YWJsZSk7ICAgICMjIG5vIGNyaXRpYwoKb3VyIEBPYmplY3REZXBlbmRlbmNpZXMgPSAoCiAgICAnS2VybmVsOjpDb25maWcnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpMb2cnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpNYWluJywKICAgICdLZXJuZWw6OlN5c3RlbTo6VGltZScsCik7CgpteSBAREFZUyA9IHF3L1N1biBNb24gVHVlIFdlZCBUaHUgRnJpIFNhdC87Cm15IEBNT05TID0gcXcvSmFuIEZlYiBNYXIgQXByIE1heSBKdW4gSnVsIEF1ZyBTZXAgT2N0IE5vdiBEZWMvOwoKPWhlYWQxIE5BTUUKCktlcm5lbDo6TGFuZ3VhZ2UgLSBnbG9iYWwgbGFuZ3VhZ2UgaW50ZXJmYWNlCgo9aGVhZDEgU1lOT1BTSVMKCkFsbCBsYW5ndWFnZSBmdW5jdGlvbnMuCgo9aGVhZDEgUFVCTElDIElOVEVSRkFDRQoKPW92ZXIgNAoKPWN1dAoKPWl0ZW0gbmV3KCkKCmNyZWF0ZSBhIGxhbmd1YWdlIG9iamVjdC4gRG8gbm90IHVzZSBpdCBkaXJlY3RseSwgaW5zdGVhZCB1c2U6CgogICAgdXNlIEtlcm5lbDo6U3lzdGVtOjpPYmplY3RNYW5hZ2VyOwogICAgbG9jYWwgJEtlcm5lbDo6T00gPSBLZXJuZWw6OlN5c3RlbTo6T2JqZWN0TWFuYWdlci0+bmV3KAogICAgICAgICdLZXJuZWw6Okxhbmd1YWdlJyA9PiB7CiAgICAgICAgICAgIFVzZXJMYW5ndWFnZSA9PiAnZGUnLAogICAgICAgIH0sCiAgICApOwogICAgbXkgJExhbmd1YWdlT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpMYW5ndWFnZScpOwoKPWN1dAoKc3ViIG5ldyB7CiAgICBteSAoICRUeXBlLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgYWxsb2NhdGUgbmV3IGhhc2ggZm9yIG9iamVjdAogICAgbXkgJFNlbGYgPSB7JVBhcmFtfTsKICAgIGJsZXNzKCAkU2VsZiwgJFR5cGUgKTsKCiAgICAjIDA9b2ZmOyAxPW9uOyAyPWdldCBhbGwgbm90IHRyYW5zbGF0ZWQgd29yZHM7IDM9Z2V0IGFsbCByZXF1ZXN0cwogICAgJFNlbGYtPntEZWJ1Z30gPSAwOwoKICAgICMgZ2V0IG5lZWRlZCBvYmplY3QKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwogICAgbXkgJE1haW5PYmplY3QgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyk7CgogICAgIyBjaGVjayBpZiBMYW5ndWFnZURlYnVnIGlzIGNvbmZpZ3VyZWQKICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdMYW5ndWFnZURlYnVnJykgKSB7CiAgICAgICAgJFNlbGYtPntMYW5ndWFnZURlYnVnfSA9IDE7CiAgICB9CgogICAgIyB1c2VyIGxhbmd1YWdlCiAgICAkU2VsZi0+e1VzZXJMYW5ndWFnZX0gPSAkUGFyYW17VXNlckxhbmd1YWdlfQogICAgICAgIHx8ICRDb25maWdPYmplY3QtPkdldCgnRGVmYXVsdExhbmd1YWdlJykKICAgICAgICB8fCAnZW4nOwoKICAgICMgY2hlY2sgaWYgbGFuZ3VhZ2UgaXMgY29uZmlndXJlZAogICAgbXkgJUxhbmd1YWdlcyA9ICV7ICRDb25maWdPYmplY3QtPkdldCgnRGVmYXVsdFVzZWRMYW5ndWFnZXMnKSB9OwogICAgaWYgKCAhJExhbmd1YWdlc3sgJFNlbGYtPntVc2VyTGFuZ3VhZ2V9IH0gKSB7CiAgICAgICAgJFNlbGYtPntVc2VyTGFuZ3VhZ2V9ID0gJ2VuJzsKICAgIH0KCiAgICAjIHRha2UgdGltZSB6b25lCiAgICAkU2VsZi0+e1RpbWVab25lfSA9ICRQYXJhbXtVc2VyVGltZVpvbmV9IHx8ICRQYXJhbXtUaW1lWm9uZX0gfHwgMDsKCiAgICAjIERlYnVnCiAgICBpZiAoICRTZWxmLT57RGVidWd9ID4gMCApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ0RlYnVnJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIlVzZXJMYW5ndWFnZSA9ICRTZWxmLT57VXNlckxhbmd1YWdlfSIsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGxvYWQgdGV4dCBjYXRhbG9nIC4uLgogICAgaWYgKCAhJE1haW5PYmplY3QtPlJlcXVpcmUoIktlcm5lbDo6TGFuZ3VhZ2U6OiRTZWxmLT57VXNlckxhbmd1YWdlfSIpICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnRXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiU29ycnksIGNhbid0IGxvY2F0ZSBvciBsb2FkIEtlcm5lbDo6TGFuZ3VhZ2U6OiRTZWxmLT57VXNlckxhbmd1YWdlfSAiCiAgICAgICAgICAgICAgICAuICJ0cmFuc2xhdGlvbiEgQ2hlY2sgdGhlIEtlcm5lbC9MYW5ndWFnZS8kU2VsZi0+e1VzZXJMYW5ndWFnZX0ucG0gKHBlcmwgLWN3KSEiLAogICAgICAgICk7CiAgICB9CgogICAgIyBhZGQgbW9kdWxlIHRvIElTQQogICAgQElTQSA9ICgiS2VybmVsOjpMYW5ndWFnZTo6JFNlbGYtPntVc2VyTGFuZ3VhZ2V9Iik7CgogICAgIyBleGVjdXRlIHRyYW5zbGF0aW9uIG1hcAogICAgaWYgKCBldmFsIHsgJFNlbGYtPkRhdGEoKSB9ICkgewoKICAgICAgICAjIGRlYnVnIGluZm8KICAgICAgICBpZiAoICRTZWxmLT57RGVidWd9ID4gMCApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnRGVidWcnLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIktlcm5lbDo6TGFuZ3VhZ2U6OiRTZWxmLT57VXNlckxhbmd1YWdlfSBsb2FkIC4uLiBkb25lLiIsCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgbG9hZCBhY3Rpb24gdGV4dCBjYXRhbG9nIC4uLgogICAgbXkgJEN1c3RvbVRyYW5zbGF0aW9uTW9kdWxlID0gJyc7CgogICAgIyBkbyBub3QgaW5jbHVkZSBhZGRpdGlvbiB0cmFuc2xhdGlvbiBmaWxlcywgYSBuZXcgdHJhbnNsYXRpb24gZmlsZSBnZXRzIGNyZWF0ZWQKICAgIGlmICggISRQYXJhbXtUcmFuc2xhdGlvbkZpbGV9ICkgewoKICAgICAgICAjIGxvb2tpbmcgdG8gYWRkaXRpb24gdHJhbnNsYXRpb24gZmlsZXMKICAgICAgICAjIEtJWENvcmUtY2FwZUlUCiAgICAgICAgIyBteSAkSG9tZSAgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0hvbWUnKSAuICcvJzsKICAgICAgICAjIG15IEBGaWxlcyA9ICRNYWluT2JqZWN0LT5EaXJlY3RvcnlSZWFkKAogICAgICAgICMgICAgIERpcmVjdG9yeSA9PiAkSG9tZSAuICJLZXJuZWwvTGFuZ3VhZ2UvIiwKICAgICAgICAjICAgICBGaWx0ZXIgICAgPT4gIiRTZWxmLT57VXNlckxhbmd1YWdlfV8qLnBtIiwKICAgICAgICAjICk7CiAgICAgICAgbXkgQEZpbGVzOwogICAgICAgIGZvciBteSAkRGlyICggcmV2ZXJzZSBASU5DICkgewogICAgICAgICAgICBteSAkTGFuZ0RpciA9ICIkRGlyL0tlcm5lbC9MYW5ndWFnZS8iOwogICAgICAgICAgICAkTGFuZ0RpciA9fiBzJ1xzJ1xccydnOwogICAgICAgICAgICBpZiAoIC1lICIkTGFuZ0RpciIgKSB7CiAgICAgICAgICAgICAgICBteSBAS0lYRmlsZXMgPSAkTWFpbk9iamVjdC0+RGlyZWN0b3J5UmVhZCgKICAgICAgICAgICAgICAgICAgICBEaXJlY3RvcnkgPT4gJExhbmdEaXIsCiAgICAgICAgICAgICAgICAgICAgRmlsdGVyICAgID0+ICIkU2VsZi0+e1VzZXJMYW5ndWFnZX1fKi5wbSIsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcHVzaCBARmlsZXMsIEBLSVhGaWxlczsKCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgRU8gS0lYQ29yZS1jYXBlSVQKCiAgICAgICAgRklMRToKICAgICAgICBmb3IgbXkgJEZpbGUgKEBGaWxlcykgewoKICAgICAgICAgICAgIyBnZXQgbW9kdWxlIG5hbWUgYmFzZWQgb24gZmlsZSBuYW1lCiAgICAgICAgICAgICMgS0lYQ29yZS1jYXBlSVQKICAgICAgICAgICAgIyAkRmlsZSA9fiBzL14kSG9tZSguKilcLnBtJC8kMS9nOwogICAgICAgICAgICAkIEZpbGUgPX4gcy8uKihLZXJuZWxcL0xhbmd1YWdlXC8uKilcLnBtJC8kMS9nOwoKICAgICAgICAgICAgIyBFTyBLSVhDb3JlLWNhcGVJVAoKICAgICAgICAgICAgJEZpbGUgPX4gcy9cL1wvL1wvL2c7CiAgICAgICAgICAgICRGaWxlID1+IHMvXC8vOjovZzsKCiAgICAgICAgICAgICMgaWdub3JlIGxhbmd1YWdlIHRyYW5zbGF0aW9uIGZpbGVzIGxpa2UgKGVuX0dCLCBlbl9DQSwgLi4uKQogICAgICAgICAgICBuZXh0IEZJTEUgaWYgJEZpbGUgPX4gLy4uXy4uJC87CgogICAgICAgICAgICAjIHJlbWVtYmVyIGN1c3RvbSBmaWxlcyB0byBsb2FkIGF0IGxlYXN0CiAgICAgICAgICAgIGlmICggJEZpbGUgPX4gL19DdXN0b20kLyApIHsKICAgICAgICAgICAgICAgICRDdXN0b21UcmFuc2xhdGlvbk1vZHVsZSA9ICRGaWxlOwogICAgICAgICAgICAgICAgbmV4dCBGSUxFOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGxvYWQgdHJhbnNsYXRpb24gbW9kdWxlCiAgICAgICAgICAgIGlmICggISRNYWluT2JqZWN0LT5SZXF1aXJlKCRGaWxlKSApIHsKICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdFcnJvcicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIlNvcnJ5LCBjYW4ndCBsb2FkICRGaWxlISAiIC4gIkNoZWNrIHRoZSAkRmlsZSAocGVybCAtY3cpISIsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgbmV4dCBGSUxFOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGFkZCBtb2R1bGUgdG8gSVNBCiAgICAgICAgICAgIEBJU0EgPSAoJEZpbGUpOwoKICAgICAgICAgICAgIyBleGVjdXRlIHRyYW5zbGF0aW9uIG1hcAogICAgICAgICAgICBpZiAoIGV2YWwgeyAkU2VsZi0+RGF0YSgpIH0gKSB7CgogICAgICAgICAgICAgICAgIyBkZWJ1ZyBpbmZvCiAgICAgICAgICAgICAgICBpZiAoICRTZWxmLT57RGVidWd9ID4gMCApIHsKICAgICAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ0RlYnVnJywKICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIiRGaWxlIGxvYWQgLi4uIGRvbmUuIiwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGxvYWQgY3VzdG9tIHRleHQgY2F0YWxvZyAuLi4KICAgICAgICBpZiAoICRDdXN0b21UcmFuc2xhdGlvbk1vZHVsZSAmJiAkTWFpbk9iamVjdC0+UmVxdWlyZSgkQ3VzdG9tVHJhbnNsYXRpb25Nb2R1bGUpICkgewoKICAgICAgICAgICAgIyBhZGQgbW9kdWxlIHRvIElTQQogICAgICAgICAgICBASVNBID0gKCRDdXN0b21UcmFuc2xhdGlvbk1vZHVsZSk7CgogICAgICAgICAgICAjIGV4ZWN1dGUgdHJhbnNsYXRpb24gbWFwCiAgICAgICAgICAgIGlmICggZXZhbCB7ICRTZWxmLT5EYXRhKCkgfSApIHsKCiAgICAgICAgICAgICAgICAjIGRlYnVnIGluZm8KICAgICAgICAgICAgICAgIGlmICggJFNlbGYtPntEZWJ1Z30gPiAwICkgewogICAgICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnRGVidWcnLAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiS2VybmVsOjpMYW5ndWFnZTo6JFNlbGYtPntVc2VyTGFuZ3VhZ2V9X0N1c3RvbSBsb2FkIC4uLiBkb25lLiIsCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAjIGlmIG5vIHJldHVybiBjaGFyc2V0IGlzIGdpdmVuLCB1c2UgcmVjb21tZW5kZWQgcmV0dXJuIGNoYXJzZXQKICAgIGlmICggISRTZWxmLT57UmV0dXJuQ2hhcnNldH0gKSB7CiAgICAgICAgJFNlbGYtPntSZXR1cm5DaGFyc2V0fSA9ICRTZWxmLT5HZXRSZWNvbW1lbmRlZENoYXJzZXQoKTsKICAgIH0KCiAgICAjIGdldCBzb3VyY2UgZmlsZSBjaGFyc2V0CiAgICAjIHdoYXQgY2hhcnNldCBzaG91bGQgSSB1c2UgKHRha2UgaXQgZnJvbSB0cmFuc2xhdGlvbiBmaWxlKSEKICAgIGlmICggJFNlbGYtPntDaGFyc2V0fSAmJiByZWYgJFNlbGYtPntDaGFyc2V0fSBlcSAnQVJSQVknICkgewogICAgICAgICRTZWxmLT57VHJhbnNsYXRpb25DaGFyc2V0fSA9ICRTZWxmLT57Q2hhcnNldH0tPlstMV07CiAgICB9CgogICAgcmV0dXJuICRTZWxmOwp9Cgo9aXRlbSBUcmFuc2xhdGFibGUoKQoKdGhpcyBpcyBhIG5vLW9wIHRvIG1hcmsgYSB0ZXh0IGFzIHRyYW5zbGF0YWJsZSBpbiB0aGUgUGVybCBjb2RlLgoKPWN1dAoKc3ViIFRyYW5zbGF0YWJsZSB7CiAgICByZXR1cm4gc2hpZnQ7Cn0KCj1pdGVtIFRyYW5zbGF0ZSgpCgp0cmFuc2xhdGUgYSB0ZXh0IHdpdGggcGxhY2Vob2xkZXJzLgoKICAgICAgICBteSAkVGV4dCA9ICRMYW5ndWFnZU9iamVjdC0+VHJhbnNsYXRlKCdIZWxsbyAlcyEnLCAnd29ybGQnKTsKCj1jdXQKCnN1YiBUcmFuc2xhdGUgewogICAgbXkgKCAkU2VsZiwgJFRleHQsIEBQYXJhbWV0ZXJzICkgPSBAXzsKCiAgICAkVGV4dCAvLz0gJyc7CgogICAgJFRleHQgPSAkU2VsZi0+e1RyYW5zbGF0aW9ufS0+eyRUZXh0fSB8fCAkVGV4dDsKCiAgICByZXR1cm4gJFRleHQgaWYgIUBQYXJhbWV0ZXJzOwoKICAgIGZvciAoIDAgLi4gJCNQYXJhbWV0ZXJzICkgewogICAgICAgIHJldHVybiAkVGV4dCBpZiAhZGVmaW5lZCAkUGFyYW1ldGVyc1skX107CiAgICAgICAgJFRleHQgPX4gcy9cJShzfGQpLyRQYXJhbWV0ZXJzWyRfXS87CiAgICB9CgogICAgcmV0dXJuICRUZXh0Owp9Cgo9aXRlbSBHZXQoKQoKV0FSTklORzogVEhJUyBNRVRIT0QgSVMgREVQUkVDQVRFRCBBTkQgV0lMTCBCRSBSRU1PVkVEIElOIEZVVFVSRSBWRVJTSU9OIE9GIE9UUlMhIFVTRSBUcmFuc2xhdGUoKSBJTlNURUFELgoKVHJhbnNsYXRlIGEgc3RyaW5nLgoKICAgIG15ICRUZXh0ID0gJExhbmd1YWdlT2JqZWN0LT5HZXQoJ0hlbGxvJyk7CgogICAgRXhhbXBsZTogKHRoZSBxdW90aW5nIGxvb2tzIHN0cmFuZ2UsIGJ1dCBpcyBpbiBmYWN0IGNvcnJlY3QhKQoKICAgIG15ICRTdHJpbmcgPSAnSGlzdG9yeTo6TmV3VGlja2V0IiwgIjIwMTEwMzExMTAwMDAwMjMiLCAiUG9zdG1hc3RlciIsICIzIG5vcm1hbCIsICJvcGVuIiwgIjknOwoKICAgIG15ICRUcmFuc2xhdGVkU3RyaW5nID0gJExhbmd1YWdlT2JqZWN0LT5UcmFuc2xhdGUoICRTdHJpbmcgKTsKCj1jdXQKCnN1YiBHZXQgewogICAgbXkgKCAkU2VsZiwgJFdoYXQgKSA9IEBfOwoKICAgICMgY2hlY2sKICAgIHJldHVybiBpZiAhZGVmaW5lZCAkV2hhdDsKICAgIHJldHVybiAnJyBpZiAkV2hhdCBlcSAnJzsKCiAgICAjIGNoZWNrIGR5biBzcGFjZXMKICAgIG15IEBEeW47CiAgICBpZiAoICRXaGF0ICYmICRXaGF0ID1+IC9eKC4rPykiLFxzezAsMX0iKC4qPykkLyApIHsKICAgICAgICAkV2hhdCA9ICQxOwogICAgICAgIEBEeW4gPSBzcGxpdCggLyIsXHN7MCwxfSIvLCAkMiApOwogICAgfQoKICAgICMgY2hlY2sgd2FudGVkIHBhcmFtIGFuZCByZXR1cm5zIHRoZQogICAgIyBsb29rdXAgb3IgdGhlIGVuZ2xpc2ggZGF0YQogICAgaWYgKCAkU2VsZi0+e1RyYW5zbGF0aW9ufS0+eyRXaGF0fSApIHsKCiAgICAgICAgIyBEZWJ1ZwogICAgICAgIGlmICggJFNlbGYtPntEZWJ1Z30gPiAzICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdEZWJ1ZycsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiLT5HZXQoJyRXaGF0JykgPSAoJyRTZWxmLT57VHJhbnNsYXRpb259LT57JFdoYXR9JykuIiwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIG15ICRUZXh0ID0gJFNlbGYtPntUcmFuc2xhdGlvbn0tPnskV2hhdH07CiAgICAgICAgaWYgKEBEeW4pIHsKICAgICAgICAgICAgQ09VTlQ6CiAgICAgICAgICAgIGZvciAoIDAgLi4gJCNEeW4gKSB7CgogICAgICAgICAgICAgICAgIyBiZSBjYXJlZnVsICREeW5bJF9dIGNhbiBiZSAwISBidWcjMzgyNgogICAgICAgICAgICAgICAgbGFzdCBDT1VOVCBpZiAhZGVmaW5lZCAkRHluWyRfXTsKCiAgICAgICAgICAgICAgICBpZiAoICREeW5bJF9dID1+IC9UaW1lXCgoLiopXCkvICkgewogICAgICAgICAgICAgICAgICAgICREeW5bJF9dID0gJFNlbGYtPlRpbWUoCiAgICAgICAgICAgICAgICAgICAgICAgIEFjdGlvbiA9PiAnR0VUJywKICAgICAgICAgICAgICAgICAgICAgICAgRm9ybWF0ID0+ICQxLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgJFRleHQgPX4gcy9cJShzfGQpLyREeW5bJF9dLzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRUZXh0ID1+IHMvXCUoc3xkKS8kRHluWyRfXS87CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAkVGV4dDsKICAgIH0KCiAgICAjIHdhcm4gaWYgdGhlIHZhbHVlIGlzIG5vdCBkZWYKICAgIGlmICggJFNlbGYtPntEZWJ1Z30gPiAxICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZGVidWcnLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiLT5HZXQoJyRXaGF0JykgSXMgbm90IHRyYW5zbGF0ZWQhISEiLAogICAgICAgICk7CiAgICB9CgogICAgaWYgKCAkU2VsZi0+e0xhbmd1YWdlRGVidWd9ICkgewogICAgICAgIHByaW50IFNUREVSUiAiTm8gdHJhbnNsYXRpb24gYXZhaWxhYmxlIGZvciAnJFdoYXQnXG4iOwogICAgfQoKICAgIGlmIChARHluKSB7CiAgICAgICAgQ09VTlQ6CiAgICAgICAgZm9yICggMCAuLiAkI0R5biApIHsKCiAgICAgICAgICAgICMgYmUgY2FyZWZ1bCAkRHluWyRfXSBjYW4gYmUgMCEgYnVnIzM4MjYKICAgICAgICAgICAgbGFzdCBDT1VOVCBpZiAhZGVmaW5lZCAkRHluWyRfXTsKCiAgICAgICAgICAgIGlmICggJER5blskX10gPX4gL1RpbWVcKCguKilcKS8gKSB7CiAgICAgICAgICAgICAgICAkRHluWyRfXSA9ICRTZWxmLT5UaW1lKAogICAgICAgICAgICAgICAgICAgIEFjdGlvbiA9PiAnR0VUJywKICAgICAgICAgICAgICAgICAgICBGb3JtYXQgPT4gJDEsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgJFdoYXQgPX4gcy9cJShzfGQpLyREeW5bJF9dLzsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRXaGF0ID1+IHMvXCUoc3xkKS8kRHluWyRfXS87CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuICRXaGF0Owp9Cgo9aXRlbSBGb3JtYXRUaW1lU3RyaW5nKCkKCmZvcm1hdHMgYSB0aW1lc3RhbXAgYWNjb3JkaW5nIHRvIHRoZSBzcGVjaWZpZWQgZGF0ZSBmb3JtYXQgZm9yIHRoZSBjdXJyZW50Cmxhbmd1YWdlIChsb2NhbGUpLgoKICAgIG15ICREYXRlID0gJExhbmd1YWdlT2JqZWN0LT5Gb3JtYXRUaW1lU3RyaW5nKAogICAgICAgICcyMDA5LTEyLTEyIDEyOjEyOjEyJywgICMgdGltZXN0YW1wCiAgICAgICAgJ0RhdGVGb3JtYXQnLCAgICAgICAgICAgIyB3aGljaCBkYXRlIGZvcm1hdCB0byB1c2UsIGUuIGcuIERhdGVGb3JtYXRMb25nCiAgICAgICAgMCwgICAgICAgICAgICAgICAgICAgICAgIyBvcHRpb25hbCwgaGlkZXMgdGhlIHNlY29uZHMgZnJvbSB0aGUgdGltZSBvdXRwdXQKICAgICk7CgpQbGVhc2Ugbm90ZSB0aGF0IHRoZSBUaW1lWm9uZSB3aWxsIG5vdCBiZSBhcHBsaWVkIGluIHRoZSBjYXNlIG9mIERhdGVGb3JtYXRTaG9ydCAoZGF0ZSBvbmx5KQp0byBhdm9pZCBzd2l0Y2hpbmcgdG8gYW5vdGhlciBkYXRlLgoKSWYgeW91IG9ubHkgcGFzcyBhbiBJU08gZGF0ZSAoJzIwMDktMTItMTInKSwgaXQgd2lsbCBiZSByZXR1cm5lZCB1bmNoYW5nZWQuCkludmFsaWQgc3RyaW5ncyB3aWxsIGFsc28gYmUgcmV0dXJuZWQgd2l0aCBhbiBlcnJvciBsb2dnZWQuCgo9Y3V0CgpzdWIgRm9ybWF0VGltZVN0cmluZyB7CiAgICBteSAoICRTZWxmLCAkU3RyaW5nLCAkQ29uZmlnLCAkU2hvcnQgKSA9IEBfOwoKICAgIHJldHVybiAnJyBpZiAhJFN0cmluZzsKCiAgICAkQ29uZmlnIHx8PSAnRGF0ZUZvcm1hdCc7CiAgICAkU2hvcnQgIHx8PSAwOwoKICAgICMgVmFsaWQgdGltZXN0YW1wCiAgICBpZiAoICRTdHJpbmcgPX4gLyhcZHs0fSktKFxkezJ9KS0oXGR7Mn0pXHMoXGR7Mn0pOihcZHsyfSk6KFxkezJ9KS8gKSB7CiAgICAgICAgbXkgKCAkWSwgJE0sICRELCAkaCwgJG0sICRzICkgPSAoICQxLCAkMiwgJDMsICQ0LCAkNSwgJDYgKTsKICAgICAgICBteSAkV0Q7ICAgICMgZGF5IG9mIHdlZWsKCiAgICAgICAgbXkgJFJldHVyblN0cmluZyA9ICRTZWxmLT57JENvbmZpZ30gfHwgIiRDb25maWcgbmVlZHMgdG8gYmUgdHJhbnNsYXRlZCEiOwoKICAgICAgICAjIGdldCB0aW1lIG9iamVjdAogICAgICAgIG15ICRUaW1lT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpbWUnKTsKCiAgICAgICAgbXkgJFRpbWVTdGFtcCA9ICRUaW1lT2JqZWN0LT5UaW1lU3RhbXAyU3lzdGVtVGltZSgKICAgICAgICAgICAgU3RyaW5nID0+ICIkWS0kTS0kRCAkaDokbTokcyIsCiAgICAgICAgKTsKCiAgICAgICAgIyBBZGQgdXNlciB0aW1lIHpvbmUgZGlmZiwgYnV0IG9ubHkgaWYgd2UgYWN0dWFsbHkgZGlzcGxheSB0aGUgdGltZSEKICAgICAgICAjIE90aGVyd2lzZSB0aGUgZGF0ZSBtaWdodCBiZSBvZmYgYnkgb25lIGRheSBiZWNhdXNlIG9mIHRoZSBUaW1lWm9uZSBkaWZmLgogICAgICAgIGlmICggJFNlbGYtPntUaW1lWm9uZX0gJiYgJENvbmZpZyBuZSAnRGF0ZUZvcm1hdFNob3J0JyApIHsKICAgICAgICAgICAgJFRpbWVTdGFtcCA9ICRUaW1lU3RhbXAgKyAoICRTZWxmLT57VGltZVpvbmV9ICogNjAgKiA2MCApOwogICAgICAgIH0KCiAgICAgICAgKCAkcywgJG0sICRoLCAkRCwgJE0sICRZLCAkV0QgKSA9ICRUaW1lT2JqZWN0LT5TeXN0ZW1UaW1lMkRhdGUoCiAgICAgICAgICAgIFN5c3RlbVRpbWUgPT4gJFRpbWVTdGFtcCwKICAgICAgICApOwoKICAgICAgICBpZiAoJFNob3J0KSB7CiAgICAgICAgICAgICRSZXR1cm5TdHJpbmcgPX4gcy9cJVQvJGg6JG0vZzsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRSZXR1cm5TdHJpbmcgPX4gcy9cJVQvJGg6JG06JHMvZzsKICAgICAgICB9CiAgICAgICAgJFJldHVyblN0cmluZyA9fiBzL1wlRC8kRC9nOwogICAgICAgICRSZXR1cm5TdHJpbmcgPX4gcy9cJU0vJE0vZzsKICAgICAgICAkUmV0dXJuU3RyaW5nID1+IHMvXCVZLyRZL2c7CgogICAgICAgICRSZXR1cm5TdHJpbmcgPX4gc3soXCVBKX17ZGVmaW5lZCAkV0QgPyAkU2VsZi0+VHJhbnNsYXRlKCREQVlTWyRXRF0pIDogJyc7fWVneDsKICAgICAgICAkUmV0dXJuU3RyaW5nCiAgICAgICAgICAgID1+IHN7KFwlQil9eyhkZWZpbmVkICRNICYmICRNID1+IG0vXlxkKyQvKSA/ICRTZWxmLT5UcmFuc2xhdGUoJE1PTlNbJE0tMV0pIDogJyc7fWVneDsKCiAgICAgICAgaWYgKCAkU2VsZi0+e1RpbWVab25lfSAmJiAkQ29uZmlnIG5lICdEYXRlRm9ybWF0U2hvcnQnICkgewogICAgICAgICAgICByZXR1cm4gJFJldHVyblN0cmluZyAuICIgKCRTZWxmLT57VGltZVpvbmV9KSI7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkUmV0dXJuU3RyaW5nOwogICAgfQoKICAgICMgSW52YWxpZCBzdHJpbmcgcGFzc2VkPyAoZG9uJ3QgbG9nIGZvciBJU08gZGF0ZXMpCiAgICBpZiAoICRTdHJpbmcgIX4gL14oXGR7Mn06XGR7Mn06XGR7Mn0pJC8gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdub3RpY2UnLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiTm8gRm9ybWF0VGltZVN0cmluZygpIHRyYW5zbGF0aW9uIGZvdW5kIGZvciAnJFN0cmluZycgc3RyaW5nISIsCiAgICAgICAgKTsKICAgIH0KCiAgICByZXR1cm4gJFN0cmluZzsKCn0KCj1pdGVtIEdldFJlY29tbWVuZGVkQ2hhcnNldCgpCgpERVBSRUNBVEVELiBEb24ndCB1c2UgdGhpcyBmdW5jdGlvbiBhbnkgbW9yZSwgJ3V0Zi04JyBpcyBhbHdheXMgdGhlIGludGVybmFsIGNoYXJzZXQuCgpSZXR1cm5zIHRoZSByZWNvbW1lbmRlZCBjaGFyc2V0IGZvciBmcm9udGVuZCAoYmFzZWQgb24gdHJhbnNsYXRpb24KZmlsZSBvciB1dGYtOCkuCgogICAgbXkgJENoYXJzZXQgPSAkTGFuZ3VhZ2VPYmplY3QtPkdldFJlY29tbWVuZGVkQ2hhcnNldCgpLgoKPWN1dAoKc3ViIEdldFJlY29tbWVuZGVkQ2hhcnNldCB7CiAgICBteSAkU2VsZiA9IHNoaWZ0OwoKICAgIHJldHVybiAndXRmLTgnOwp9Cgo9aXRlbSBHZXRQb3NzaWJsZUNoYXJzZXRzKCkKClJldHVybnMgYW4gYXJyYXkgb2YgcG9zc2libGUgY2hhcnNldHMgKGJhc2VkIG9uIHRyYW5zbGF0aW9uIGZpbGUpLgoKICAgIG15IEBDaGFyc2V0cyA9ICRMYW5ndWFnZU9iamVjdC0+R2V0UG9zc2libGVDaGFyc2V0cygpLgoKPWN1dAoKc3ViIEdldFBvc3NpYmxlQ2hhcnNldHMgewogICAgbXkgJFNlbGYgPSBzaGlmdDsKCiAgICByZXR1cm4gQHsgJFNlbGYtPntDaGFyc2V0fSB9IGlmICRTZWxmLT57Q2hhcnNldH07CiAgICByZXR1cm47Cn0KCj1pdGVtIFRpbWUoKQoKUmV0dXJucyBhIHRpbWUgc3RyaW5nIGluIGxhbmd1YWdlIGZvcm1hdCAoYmFzZWQgb24gdHJhbnNsYXRpb24gZmlsZSkuCgogICAgJFRpbWUgPSAkTGFuZ3VhZ2VPYmplY3QtPlRpbWUoCiAgICAgICAgQWN0aW9uID0+ICdHRVQnLAogICAgICAgIEZvcm1hdCA9PiAnRGF0ZUZvcm1hdCcsCiAgICApOwoKICAgICRUaW1lTG9uZyA9ICRMYW5ndWFnZU9iamVjdC0+VGltZSgKICAgICAgICBBY3Rpb24gPT4gJ0dFVCcsCiAgICAgICAgRm9ybWF0ID0+ICdEYXRlRm9ybWF0TG9uZycsCiAgICApOwoKICAgICRUaW1lTG9uZyA9ICRMYW5ndWFnZU9iamVjdC0+VGltZSgKICAgICAgICBBY3Rpb24gPT4gJ1JFVFVSTicsCiAgICAgICAgRm9ybWF0ID0+ICdEYXRlRm9ybWF0TG9uZycsCiAgICAgICAgWWVhciAgID0+IDE5NzcsCiAgICAgICAgTW9udGggID0+IDEwLAogICAgICAgIERheSAgICA9PiAyNywKICAgICAgICBIb3VyICAgPT4gMjAsCiAgICAgICAgTWludXRlID0+IDEwLAogICAgICAgIFNlY29uZCA9PiAwNSwKICAgICk7CgpUaGVzZSB0YWdzIGFyZSBzdXBwb3J0ZWQ6ICVBPVdlZWtEYXk7JUI9TG9uZ01vbnRoOyVUPVRpbWU7JUQ9RGF5OyVNPU1vbnRoOyVZPVllYXI7CgpOb3RlIHRoYXQgJUEgb25seSB3b3JrcyBjb3JyZWN0bHkgd2l0aCBBY3Rpb24gR0VULCBpdCBtaWdodCBiZSBkcm9wcGVkIG90aGVyd2lzZS4KCkFsc28gbm90ZSB0aGF0IGl0IGlzIGFsc28gcG9zc2libGUgdG8gcGFzcyBIVE1MIHN0cmluZ3MgZm9yIGRhdGUgaW5wdXQ6CgogICAgJFRpbWVMb25nID0gJExhbmd1YWdlT2JqZWN0LT5UaW1lKAogICAgICAgIEFjdGlvbiA9PiAnUkVUVVJOJywKICAgICAgICBGb3JtYXQgPT4gJ0RhdGVJbnB1dEZvcm1hdExvbmcnLAogICAgICAgIE1vZGUgICA9PiAnTm90TnVtZXJpYycsCiAgICAgICAgWWVhciAgID0+ICc8aW5wdXQgdmFsdWU9IjIwMTQiLz4nLAogICAgICAgIE1vbnRoICA9PiAnPGlucHV0IHZhbHVlPSIxIi8+JywKICAgICAgICBEYXkgICAgPT4gJzxpbnB1dCB2YWx1ZT0iMTAiLz4nLAogICAgICAgIEhvdXIgICA9PiAnPGlucHV0IHZhbHVlPSIxMSIvPicsCiAgICAgICAgTWludXRlID0+ICc8aW5wdXQgdmFsdWU9IjEyIi8+JywKICAgICAgICBTZWNvbmQgPT4gJzxpbnB1dCB2YWx1ZT0iMTMiLz4nLAogICAgKTsKCk5vdGUgdGhhdCAlQiBtYXkgbm90IHdvcmsgaW4gTm9uTnVtZXJpYyBtb2RlLgoKPWN1dAoKc3ViIFRpbWUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgZm9yIChxdyhBY3Rpb24gRm9ybWF0KSkgewogICAgICAgIGlmICggISRQYXJhbXskX30gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICRfISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CiAgICBteSAkUmV0dXJuU3RyaW5nID0gJFNlbGYtPnsgJFBhcmFte0Zvcm1hdH0gfSB8fCAnTmVlZCB0byBiZSB0cmFuc2xhdGVkISc7CiAgICBteSAoICRzLCAkbSwgJGgsICRELCAkTSwgJFksICRXRCwgJFlELCAkRFNUICk7CgogICAgIyBzZXQgb3IgZ2V0IHRpbWUKICAgIGlmICggbGMgJFBhcmFte0FjdGlvbn0gZXEgJ2dldCcgKSB7CgogICAgICAgICMgZ2V0IHRpbWUgb2JqZWN0CiAgICAgICAgbXkgJFRpbWVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGltZScpOwoKICAgICAgICAoICRzLCAkbSwgJGgsICRELCAkTSwgJFksICRXRCwgJFlELCAkRFNUICkgPSAkVGltZU9iamVjdC0+U3lzdGVtVGltZTJEYXRlKAogICAgICAgICAgICBTeXN0ZW1UaW1lID0+ICRUaW1lT2JqZWN0LT5TeXN0ZW1UaW1lKCksCiAgICAgICAgKTsKICAgIH0KICAgIGVsc2lmICggbGMgJFBhcmFte0FjdGlvbn0gZXEgJ3JldHVybicgKSB7CiAgICAgICAgJHMgPSAkUGFyYW17U2Vjb25kfSB8fCAwOwogICAgICAgICRtID0gJFBhcmFte01pbnV0ZX0gfHwgMDsKICAgICAgICAkaCA9ICRQYXJhbXtIb3VyfSAgIHx8IDA7CiAgICAgICAgJEQgPSAkUGFyYW17RGF5fSAgICB8fCAwOwogICAgICAgICRNID0gJFBhcmFte01vbnRofSAgfHwgMDsKICAgICAgICAkWSA9ICRQYXJhbXtZZWFyfSAgIHx8IDA7CiAgICB9CgogICAgIyBkbyByZXBsYWNlCiAgICBpZiAoICggbGMgJFBhcmFte0FjdGlvbn0gZXEgJ2dldCcgKSB8fCAoIGxjICRQYXJhbXtBY3Rpb259IGVxICdyZXR1cm4nICkgKSB7CiAgICAgICAgbXkgJFRpbWUgPSAnJzsKICAgICAgICBpZiAoICRQYXJhbXtNb2RlfSAmJiAkUGFyYW17TW9kZX0gPX4gL15Ob3ROdW1lcmljJC9pICkgewogICAgICAgICAgICBpZiAoICEkcyApIHsKICAgICAgICAgICAgICAgICRUaW1lID0gIiRoOiRtIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRUaW1lID0gIiRoOiRtOiRzIjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFRpbWUgPSBzcHJpbnRmKCAiJTAyZDolMDJkOiUwMmQiLCAkaCwgJG0sICRzICk7CiAgICAgICAgICAgICREICAgID0gc3ByaW50ZiggIiUwMmQiLCAgICAgICAgICAgJEQgKTsKICAgICAgICAgICAgJE0gICAgPSBzcHJpbnRmKCAiJTAyZCIsICAgICAgICAgICAkTSApOwogICAgICAgIH0KICAgICAgICAkUmV0dXJuU3RyaW5nID1+IHMvXCVULyRUaW1lL2c7CiAgICAgICAgJFJldHVyblN0cmluZyA9fiBzL1wlRC8kRC9nOwogICAgICAgICRSZXR1cm5TdHJpbmcgPX4gcy9cJU0vJE0vZzsKICAgICAgICAkUmV0dXJuU3RyaW5nID1+IHMvXCVZLyRZL2c7CiAgICAgICAgJFJldHVyblN0cmluZyA9fiBzL1wlWS8kWS9nOwogICAgICAgICRSZXR1cm5TdHJpbmcgPX4gc3soXCVBKX17ZGVmaW5lZCAkV0QgPyAkU2VsZi0+VHJhbnNsYXRlKCREQVlTWyRXRF0pIDogJyc7fWVneDsKICAgICAgICAkUmV0dXJuU3RyaW5nCiAgICAgICAgICAgID1+IHN7KFwlQil9eyhkZWZpbmVkICRNICYmICRNID1+IG0vXlxkKyQvKSA/ICRTZWxmLT5UcmFuc2xhdGUoJE1PTlNbJE0tMV0pIDogJyc7fWVneDsKICAgICAgICByZXR1cm4gJFJldHVyblN0cmluZzsKICAgIH0KCiAgICByZXR1cm4gJFJldHVyblN0cmluZzsKfQoKMTsKCj1iYWNrCgo9aGVhZDEgVEVSTVMgQU5EIENPTkRJVElPTlMKClRoaXMgc29mdHdhcmUgaXMgcGFydCBvZiB0aGUgT1RSUyBwcm9qZWN0IChMPGh0dHA6Ly9vdHJzLm9yZy8+KS4KClRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCnRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEFHUEwpLiBJZiB5b3UKZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIEw8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2FncGwudHh0Pi4KCj1jdXQK</File>
        <File Location="KIXCore/Kernel/Config/Files/KIXCore_Cache.xml" Permission="644" Encode="Base64">PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPG90cnNfY29uZmlnIHZlcnNpb249IjEuMCIgaW5pdD0iS0lYRnJhbWV3b3JrIj4KICAgIDxDVlM+JElkOiBLSVhDb3JlX0NhY2hlLnhtbCx2IDEuMTEgMjAxNS8wMi8wMyAwNzowMjoyOCBkZG9lcmZmZWwgRXhwICQ8L0NWUz4KCiAgICA8Q29uZmlnSXRlbSBOYW1lPSJDYWNoZTo6TW9kdWxlOjpNZW1jYWNoZWQjIyNTZXJ2ZXJzIiBSZXF1aXJlZD0iMCIgVmFsaWQ9IjEiPgogICAgICAgIDxEZXNjcmlwdGlvbiBUcmFuc2xhdGFibGU9IjEiPkRlZmluZXMgdGhlIG1lbWNhY2hlZCBzZXJ2ZXJzLjwvRGVzY3JpcHRpb24+CiAgICAgICAgPEdyb3VwPktJWENvcmU8L0dyb3VwPgogICAgICAgIDxTdWJHcm91cD5Db3JlOjpDYWNoZTwvU3ViR3JvdXA+CiAgICAgICAgPFNldHRpbmc+CiAgICAgICAgICAgIDxBcnJheT4KICAgICAgICAgICAgICAgIDxJdGVtPmxvY2FsaG9zdDoxMTIxMTwvSXRlbT4KICAgICAgICAgICAgPC9BcnJheT4KICAgICAgICA8L1NldHRpbmc+CiAgICA8L0NvbmZpZ0l0ZW0+CgogICAgPENvbmZpZ0l0ZW0gTmFtZT0iQ2FjaGU6Ok1vZHVsZTo6TWVtY2FjaGVkIyMjUGFyYW1ldGVycyIgUmVxdWlyZWQ9IjAiIFZhbGlkPSIxIj4KICAgICAgICA8RGVzY3JpcHRpb24gVHJhbnNsYXRhYmxlPSIxIj5EZWZpbmVzIGFsbCB0aGUgKGFkZGl0aW9uYWwpIG1lbWNhY2hlZCBwYXJhbWV0ZXJzLjwvRGVzY3JpcHRpb24+CiAgICAgICAgPEdyb3VwPktJWENvcmU8L0dyb3VwPgogICAgICAgIDxTdWJHcm91cD5Db3JlOjpDYWNoZTwvU3ViR3JvdXA+CiAgICAgICAgPFNldHRpbmc+CiAgICAgICAgICAgIDxIYXNoPgogICAgICAgICAgICAgICAgPEl0ZW0gS2V5PSJub3dhaXQiPjE8L0l0ZW0+CiAgICAgICAgICAgICAgICA8SXRlbSBLZXk9InV0ZjgiPjE8L0l0ZW0+CiAgICAgICAgICAgIDwvSGFzaD4KICAgICAgICA8L1NldHRpbmc+CiAgICA8L0NvbmZpZ0l0ZW0+CgogICAgPENvbmZpZ0l0ZW0gTmFtZT0iQ2FjaGU6Ok1vZHVsZTo6TWVtY2FjaGVkIyMjQ2FjaGVNZXRhSW5mbyIgUmVxdWlyZWQ9IjAiIFZhbGlkPSIxIj4KICAgICAgICA8RGVzY3JpcHRpb24gVHJhbnNsYXRhYmxlPSIxIj5EZWZpbmVzIGlmIG1ldGEgaW5mbyBhYm91dCB0aGUgY2FjaGVkIG9iamVjdHMgc2hvdWxkIGJlIHN0b3JlZC48L0Rlc2NyaXB0aW9uPgogICAgICAgIDxHcm91cD5LSVhDb3JlPC9Hcm91cD4KICAgICAgICA8U3ViR3JvdXA+Q29yZTo6Q2FjaGU8L1N1Ykdyb3VwPgogICAgICAgIDxTZXR0aW5nPgogICAgICAgICAgICA8T3B0aW9uIFNlbGVjdGVkSUQ9IjEiPgogICAgICAgICAgICAgICAgPEl0ZW0gS2V5PSIwIj5ObzwvSXRlbT4KICAgICAgICAgICAgICAgIDxJdGVtIEtleT0iMSI+WWVzPC9JdGVtPgogICAgICAgICAgICA8L09wdGlvbj4KICAgICAgICA8L1NldHRpbmc+CiAgICA8L0NvbmZpZ0l0ZW0+CgogICAgPENvbmZpZ0l0ZW0gTmFtZT0iQ2FjaGU6Ok1vZHVsZTo6TWVtY2FjaGVkIyMjT3ZlcnJpZGVUVEwiIFJlcXVpcmVkPSIwIiBWYWxpZD0iMSI+CiAgICAgICAgPERlc2NyaXB0aW9uIFRyYW5zbGF0YWJsZT0iMSI+QWxsb3dzIG92ZXJyaWRpbmcgb2Ygb2JqZWN0L2NhY2hlIHR5cGUgcmVsYXRlZCBUVExzLjwvRGVzY3JpcHRpb24+CiAgICAgICAgPEdyb3VwPktJWENvcmU8L0dyb3VwPgogICAgICAgIDxTdWJHcm91cD5Db3JlOjpDYWNoZTwvU3ViR3JvdXA+CiAgICAgICAgPFNldHRpbmc+CiAgICAgICAgICAgIDxIYXNoPgogICAgICAgICAgICA8L0hhc2g+CiAgICAgICAgPC9TZXR0aW5nPgogICAgPC9Db25maWdJdGVtPgoKICAgIDxDb25maWdJdGVtIE5hbWU9IkxvYWRlcjo6UHJlQ3JlYXRlZENhY2hlcyIgUmVxdWlyZWQ9IjEiIFZhbGlkPSIxIj4KICAgICAgICA8RGVzY3JpcHRpb24gTGFuZz0iZW4iPlByZS1jcmVhdGUgbG9hZGVyIGNhY2hlLjwvRGVzY3JpcHRpb24+CiAgICAgICAgPEdyb3VwPktJWENvcmU8L0dyb3VwPgogICAgICAgIDxTdWJHcm91cD5Db3JlOjpXZWI8L1N1Ykdyb3VwPgogICAgICAgIDxTZXR0aW5nPgogICAgICAgICAgICA8T3B0aW9uIFNlbGVjdGVkSUQ9IjAiPgogICAgICAgICAgICAgICAgPEl0ZW0gS2V5PSIwIj5ObzwvSXRlbT4KICAgICAgICAgICAgICAgIDxJdGVtIEtleT0iMSI+WWVzPC9JdGVtPgogICAgICAgICAgICA8L09wdGlvbj4KICAgICAgICA8L1NldHRpbmc+CiAgICA8L0NvbmZpZ0l0ZW0+CgoKPC9vdHJzX2NvbmZpZz4K</File>
        <File Location="KIXCore/Kernel/Config/Files/KIXCore_ConfigureCallHome.xml" Permission="644" Encode="Base64">PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPG90cnNfY29uZmlnIHZlcnNpb249IjEuMS4wIiBpbml0PSJBcHBsaWNhdGlvbiI+CiAgICA8Q1ZTPiRJZDogS0lYQ29yZV9Db25maWd1cmVDYWxsSG9tZS54bWwsdiAxLjIgMjAxNi8wMi8yNSAwODo0MjozNiBkZG9lcmZmZWwgRXhwICQ8L0NWUz4KCiAgICA8Q29uZmlnSXRlbSBOYW1lPSJQYWNrYWdlOjpDb25maWd1cmVDYWxsSG9tZVZlcmlmaWNhdGlvblBhdGgiIFJlcXVpcmVkPSIwIiBWYWxpZD0iMCI+CiAgICAgICAgPERlc2NyaXB0aW9uIFRyYW5zbGF0YWJsZT0iMSI+RW5hYmxlcyB0aGUgdW5yZXF1ZXN0ZWQgYXV0b21hdGljIGNvbW11bmljYXRpb24gb2YgaW5zdGFsbGVkIHBhY2thZ2VzIGFuZCBvdGhlciBzeXN0ZW0gZGV0YWlscyB0byB0aGUgcGF0aC48L0Rlc2NyaXB0aW9uPgogICAgICAgIDxHcm91cD5GcmFtZXdvcms8L0dyb3VwPgogICAgICAgIDxTdWJHcm91cD5Db3JlOjpQYWNrYWdlPC9TdWJHcm91cD4KICAgICAgICA8U2V0dGluZz4KICAgICAgICAgICAgPFN0cmluZyBSZWdleD0iIj5odHRwczovL3Bhdi5vdHJzLmNvbS9vdHJzL3B1YmxpYy5wbDwvU3RyaW5nPgogICAgICAgIDwvU2V0dGluZz4KICAgIDwvQ29uZmlnSXRlbT4KCjwvb3Ryc19jb25maWc+Cg==</File>
        <File Location="KIXCore/Kernel/Language/de_KIXCore.pm" Permission="644" Encode="Base64">IyAtLQojIEtlcm5lbC9MYW5ndWFnZS9kZV9LSVhDb3JlIC0gcHJvdmlkZXMgZ2VybWFuIGxhbmd1YWdlIHRyYW5zbGF0aW9uCiMgQ29weXJpZ2h0IChDKSAyMDA2LTIwMTYgYy5hLnAuZS4gSVQgR21iSCwgaHR0cDovL3d3dy5jYXBlLWl0LmRlCiMKIyB3cml0dGVuL2VkaXRlZCBieToKIyAqIEJlYXRyaWNlKGRvdClNdWVsbGVyKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIERvcm90aGVhKGRvdClEb2VyZmZlbChhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMgKiBSZW5lKGRvdClCb2VobShhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMKIyAtLQojICRJZDogZGVfS0lYQ29yZS5wbSx2IDEuMyAyMDE2LzAxLzIwIDEzOjQ0OjQ5IGRkb2VyZmZlbCBFeHAgJAojIC0tCiMgVGhpcyBzb2Z0d2FyZSBjb21lcyB3aXRoIEFCU09MVVRFTFkgTk8gV0FSUkFOVFkuIEZvciBkZXRhaWxzLCBzZWUKIyB0aGUgZW5jbG9zZWQgZmlsZSBDT1BZSU5HIGZvciBsaWNlbnNlIGluZm9ybWF0aW9uIChBR1BMKS4gSWYgeW91CiMgZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9hZ3BsLnR4dC4KIyAtLQpwYWNrYWdlIEtlcm5lbDo6TGFuZ3VhZ2U6OmRlX0tJWENvcmU7Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7CnVzZSB1dGY4OwoKc3ViIERhdGEgewogICAgbXkgJFNlbGYgPSBzaGlmdDsKCiAgICBteSAkTGFuZyA9ICRTZWxmLT57VHJhbnNsYXRpb259OwoKICAgIHJldHVybiBpZiByZWYgJExhbmcgbmUgJ0hBU0gnOwoKICAgICMgJCRTVEFSVCQkCgogICAgJExhbmctPnsKICAgICAgICAnaW5mb3JtYXRpb246IGV2ZW4gdGhvdWdoIHRoaXMgcGFja2FnZSBpcyBub3QgY2VydGlmaWVkIGJ5IE9UUlMgR3JvdXAsIHRoaXMgZG9lcyBOT1QgbWVhbiB0aGF0IHlvdSBzaG91bGQgTk9UIHVzZSBpdC4nCiAgICAgICAgfQogICAgICAgID0gJ1Bha2V0IGlzdCB6d2FyIG5pY2h0IGR1cmNoIE9UUlMgR3J1cHBlIHZlcmlmaXppZXJ0IC0gZGFzIGJlZGV1dGV0IGFiZXIgTklDSFQsIGRhc3MgZGllc2VzIFBha2V0IG5pY2h0IHZlcndlbmRldCB3ZXJkZW4ga2FubiBvZGVyIGRhcmYuJzsKICAgICRMYW5nLT57CiAgICAgICAgJ0Rpc2FibGVzIHRoZSB1bnJlcXVlc3RlZCBhdXRvbWF0aWMgY29tbXVuaWNhdGlvbiBvZiBpbnN0YWxsZWQgcGFja2FnZXMgYW5kIG90aGVyIHN5c3RlbSBkZXRhaWxzIHRvIE9UUlMgQUcuJwogICAgICAgIH0KICAgICAgICA9ICdEZWFrdGl2aWVydCBkaWUgdW5hdWZnZWZvcmRlcnRlIGF1dG9tYXRpc2NoZSBLb21tdW5pa2F0aW9uLCBkZXIgaW5zdGFsbGllcnRlbiBQYWtldGUgdW5kIGFuZGVyZXIgU3lzdGVtLURldGFpbHMsIHp1ciBPVFJTIEFHLic7CiAgICAkTGFuZy0+ewogICAgICAgICdFbmFibGVzIHRoZSB1bnJlcXVlc3RlZCBhdXRvbWF0aWMgY29tbXVuaWNhdGlvbiBvZiBpbnN0YWxsZWQgcGFja2FnZXMgYW5kIG90aGVyIHN5c3RlbSBkZXRhaWxzIHRvIHRoZSBwYXRoLicKICAgICAgICB9CiAgICAgICAgPSAnQWt0aXZpZXJ0IGRpZSB1bmF1ZmdlZm9yZGVydGUgYXV0b21hdGlzY2hlIEtvbW11bmlrYXRpb24sIGRlciBpbnN0YWxsaWVydGVuIFBha2V0ZSB1bmQgYW5kZXJlciBTeXN0ZW0tRGV0YWlscywgenVtIGFuZ2VnZWJlbmVuIFBmYWQuJzsKICAgICRMYW5nLT57CiAgICAgICAgJ0V2ZW4gdGhvdWdoIHRoaXMgcGFja2FnZSBpcyBub3QgY2VydGlmaWVkIGJ5IE9UUlMgR3JvdXAsIHRoaXMgZG9lcyBOT1QgbWVhbiB0aGF0IHlvdSBzaG91bGQgTk9UIHVzZSBpdC4nCiAgICAgICAgfQogICAgICAgID0gJ0RhcyBQYWtldCBpc3QgendhciBuaWNodCBkdXJjaCBPVFJTIEdydXBwZSB2ZXJpZml6aWVydCAtIGRhcyBiZWRldXRldCBhYmVyIE5JQ0hULCBkYXNzIGRpZXNlcyBQYWtldCBuaWNodCB2ZXJ3ZW5kZXQgd2VyZGVuIGthbm4gb2RlciBkYXJmLic7CgogICAgJExhbmctPnsnUHJlLWNyZWF0ZSBsb2FkZXIgY2FjaGUuJ30gPSAnTG9hZGVyY2FjaGUgdm9yZ2VuZXJpZXJlbi4nOwoKICAgICMgJCRTVE9QJCQKCiAgICByZXR1cm4gMDsKfQoKMTsK</File>
        <File Location="KIXCore/Kernel/Modules/AdminPackageManager.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDE2IE9UUlMgQUcsIGh0dHA6Ly9vdHJzLmNvbS8KIyBLSVhDb3JlLUV4dGVuc2lvbnMgQ29weXJpZ2h0IChDKSAyMDA2LTIwMTYgYy5hLnAuZS4gSVQgR21iSCwgaHR0cDovL3d3dy5jYXBlLWl0LmRlCiMKIyB3cml0dGVuL2VkaXRlZCBieToKIyAqIEJlYXRyaWNlKGRvdClNdWVsbGVyKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIERvcm90aGVhKGRvdClEb2VyZmZlbChhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMgKiBUb3JzdGVuKGRvdClUaGF1KGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIwojIC0tCiMgVGhpcyBzb2Z0d2FyZSBjb21lcyB3aXRoIEFCU09MVVRFTFkgTk8gV0FSUkFOVFkuIEZvciBkZXRhaWxzLCBzZWUKIyB0aGUgZW5jbG9zZWQgZmlsZSBDT1BZSU5HIGZvciBsaWNlbnNlIGluZm9ybWF0aW9uIChBR1BMKS4gSWYgeW91CiMgZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9hZ3BsLnR4dC4KIyAtLQoKcGFja2FnZSBLZXJuZWw6Ok1vZHVsZXM6OkFkbWluUGFja2FnZU1hbmFnZXI7CiMjIG5vZmlsdGVyKFRpZHlBbGw6OlBsdWdpbjo6T1RSUzo6UGVybDo6REJPYmplY3QpCgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7Cgp1c2UgS2VybmVsOjpTeXN0ZW06OlZhcmlhYmxlQ2hlY2sgcXcoOmFsbCk7CnVzZSBLZXJuZWw6Okxhbmd1YWdlIHF3KFRyYW5zbGF0YWJsZSk7CgpvdXIgJE9iamVjdE1hbmFnZXJEaXNhYmxlZCA9IDE7CgpzdWIgbmV3IHsKICAgIG15ICggJFR5cGUsICVQYXJhbSApID0gQF87CgogICAgIyBhbGxvY2F0ZSBuZXcgaGFzaCBmb3Igb2JqZWN0CiAgICBteSAkU2VsZiA9IHslUGFyYW19OwogICAgYmxlc3MoICRTZWxmLCAkVHlwZSApOwoKICAgICMgY2hlY2sgaWYgY2xvdWQgc2VydmljZXMgYXJlIGRpc2FibGVkCiAgICAkU2VsZi0+e0Nsb3VkU2VydmljZXNEaXNhYmxlZH0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ0Nsb3VkU2VydmljZXM6OkRpc2FibGVkJykgfHwgMDsKCiAgICByZXR1cm4gJFNlbGY7Cn0KCnN1YiBSdW4gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgIG15ICRTb3VyY2UgPSAkU2VsZi0+e1VzZXJSZXBvc2l0b3J5fSB8fCAnJzsKICAgIG15ICVFcnJvcnM7CgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgIyBjaGVjayBtb2QgcGVybCB2ZXJzaW9uIGFuZCBBcGFjaGU6OlJlbG9hZAogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwoKICAgIGlmICggZXhpc3RzICRFTlZ7TU9EX1BFUkx9ICkgewogICAgICAgIGlmICggZGVmaW5lZCAkbW9kX3Blcmw6OlZFUlNJT04gKSB7ICAgICMjIG5vIGNyaXRpYwogICAgICAgICAgICBpZiAoICRtb2RfcGVybDo6VkVSU0lPTiA+PSAxLjk5ICkgeyAgICAjIyBubyBjcml0aWMKCiAgICAgICAgICAgICAgICAjIGNoZWNrIGlmIEFwYWNoZTo6UmVsb2FkIGlzIGxvYWRlZAogICAgICAgICAgICAgICAgbXkgJEFwYWNoZVJlbG9hZCA9IDA7CiAgICAgICAgICAgICAgICBmb3IgbXkgJE1vZHVsZSAoIHNvcnQga2V5cyAlSU5DICkgewogICAgICAgICAgICAgICAgICAgICRNb2R1bGUgPX4gcy9cLy86Oi9nOwogICAgICAgICAgICAgICAgICAgICRNb2R1bGUgPX4gcy9cLnBtJC8vZzsKICAgICAgICAgICAgICAgICAgICBpZiAoICRNb2R1bGUgZXEgJ0FwYWNoZTo6UmVsb2FkJyB8fCAkTW9kdWxlIGVxICdBcGFjaGUyOjpSZWxvYWQnICkgewogICAgICAgICAgICAgICAgICAgICAgICAkQXBhY2hlUmVsb2FkID0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoICEkQXBhY2hlUmVsb2FkICkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvclNjcmVlbigKICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU29ycnksIEFwYWNoZTo6UmVsb2FkIGlzIG5lZWRlZCBhcyBQZXJsTW9kdWxlIGFuZCBQZXJsSW5pdEhhbmRsZXIgaW4gQXBhY2hlIGNvbmZpZyBmaWxlLiBTZWUgYWxzbyBzY3JpcHRzL2FwYWNoZTItaHR0cGQuaW5jbHVkZS5jb25mLiBBbHRlcm5hdGl2ZWx5LCB5b3UgY2FuIHVzZSB0aGUgY29tbWFuZCBsaW5lIHRvb2wgYmluL290cnMuQ29uc29sZS5wbCB0byBpbnN0YWxsIHBhY2thZ2VzIScKICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgICMgc2VjdXJlIG1vZGUgbWVzc2FnZSAoZG9uJ3QgYWxsb3cgdGhpcyBhY3Rpb24gdW50aWwgc2VjdXJlIG1vZGUgaXMgZW5hYmxlZCkKICAgIGlmICggISRDb25maWdPYmplY3QtPkdldCgnU2VjdXJlTW9kZScpICkgewogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5TZWN1cmVNb2RlKCk7CiAgICB9CgogICAgbXkgJFBhY2thZ2VPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6UGFja2FnZScpOwogICAgbXkgJFBhcmFtT2JqZWN0ICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0Jyk7CiAgICBteSAkTWFpbk9iamVjdCAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyk7CgogICAgIyBLSVhDb3JlLWNhcGVJVAogICAgIyBzZXQgdmFyaWFibGUgYWJvdXQgc3lzY29uZmlnCiAgICBteSAkQ29uZmlndXJlQ2FsbEhvbWUKICAgICAgICA9ICRDb25maWdPYmplY3QtPkdldCgnUGFja2FnZTo6Q29uZmlndXJlQ2FsbEhvbWVWZXJpZmljYXRpb25QYXRoJyk7CgogICAgIyBFTyBLSVhDb3JlLWNhcGVJVAoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgdmlldyBkaWZmIGZpbGUKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgIGlmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdWaWV3RGlmZicgKSB7CiAgICAgICAgbXkgJE5hbWUgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnTmFtZScgKSAgICB8fCAnJzsKICAgICAgICBteSAkVmVyc2lvbiA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdWZXJzaW9uJyApIHx8ICcnOwogICAgICAgIG15ICRMb2NhdGlvbiA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdMb2NhdGlvbicgKTsKCiAgICAgICAgIyBnZXQgcGFja2FnZQogICAgICAgIG15ICRQYWNrYWdlID0gJFBhY2thZ2VPYmplY3QtPlJlcG9zaXRvcnlHZXQoCiAgICAgICAgICAgIE5hbWUgICAgPT4gJE5hbWUsCiAgICAgICAgICAgIFZlcnNpb24gPT4gJFZlcnNpb24sCiAgICAgICAgICAgIFJlc3VsdCAgPT4gJ1NDQUxBUicsCiAgICAgICAgKTsKICAgICAgICBpZiAoICEkUGFja2FnZSApIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yU2NyZWVuKAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoJ05vIHN1Y2ggcGFja2FnZSEnKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgbXkgJVN0cnVjdHVyZSA9ICRQYWNrYWdlT2JqZWN0LT5QYWNrYWdlUGFyc2UoIFN0cmluZyA9PiAkUGFja2FnZSApOwogICAgICAgIG15ICRGaWxlID0gJyc7CiAgICAgICAgaWYgKCByZWYgJFN0cnVjdHVyZXtGaWxlbGlzdH0gZXEgJ0FSUkFZJyApIHsKICAgICAgICAgICAgZm9yIG15ICRIYXNoICggQHsgJFN0cnVjdHVyZXtGaWxlbGlzdH0gfSApIHsKICAgICAgICAgICAgICAgIGlmICggJEhhc2gtPntMb2NhdGlvbn0gZXEgJExvY2F0aW9uICkgewogICAgICAgICAgICAgICAgICAgICRGaWxlID0gJEhhc2gtPntDb250ZW50fTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBteSAkTG9jYWxGaWxlID0gJENvbmZpZ09iamVjdC0+R2V0KCdIb21lJykgLiAiLyRMb2NhdGlvbiI7CgogICAgICAgICMgZG8gbm90IGFsbG93IHRvIHJlYWQgZmlsZSB3aXRoIGluY2x1ZGluZyAuLiBwYXRoIChzZWN1cml0eSByZWxhdGVkKQogICAgICAgICRMb2NhbEZpbGUgPX4gcy9cLlwuLy9nOwogICAgICAgIGlmICggISRGaWxlICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0ZpbGVEaWZmJywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgIExvY2F0aW9uID0+ICRMb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICBOYW1lICAgICA9PiAkTmFtZSwKICAgICAgICAgICAgICAgICAgICBWZXJzaW9uICA9PiAkVmVyc2lvbiwKICAgICAgICAgICAgICAgICAgICBEaWZmICAgICA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoICdObyBzdWNoIGZpbGUgJXMgaW4gcGFja2FnZSEnLCAkTG9jYWxGaWxlICksCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICEtZSAkTG9jYWxGaWxlICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0ZpbGVEaWZmJywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgIExvY2F0aW9uID0+ICRMb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICBOYW1lICAgICA9PiAkTmFtZSwKICAgICAgICAgICAgICAgICAgICBWZXJzaW9uICA9PiAkVmVyc2lvbiwKICAgICAgICAgICAgICAgICAgICBEaWZmICAgICA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9CiAgICAgICAgICAgICAgICAgICAgICAgIC0+VHJhbnNsYXRlKCAnTm8gc3VjaCBmaWxlICVzIGluIGxvY2FsIGZpbGUgc3lzdGVtIScsICRMb2NhbEZpbGUgKSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggLWUgJExvY2FsRmlsZSApIHsKICAgICAgICAgICAgbXkgJENvbnRlbnQgPSAkTWFpbk9iamVjdC0+RmlsZVJlYWQoCiAgICAgICAgICAgICAgICBMb2NhdGlvbiA9PiAkTG9jYWxGaWxlLAogICAgICAgICAgICAgICAgTW9kZSAgICAgPT4gJ2Jpbm1vZGUnLAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoJENvbnRlbnQpIHsKICAgICAgICAgICAgICAgICRNYWluT2JqZWN0LT5SZXF1aXJlKCdUZXh0OjpEaWZmJyk7CiAgICAgICAgICAgICAgICBteSAkRGlmZiA9IFRleHQ6OkRpZmY6OmRpZmYoIFwkRmlsZSwgJENvbnRlbnQsIHsgU1RZTEUgPT4gJ09sZFN0eWxlJyB9ICk7CiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICJGaWxlRGlmZiIsCiAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIExvY2F0aW9uID0+ICRMb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgPT4gJE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIFZlcnNpb24gID0+ICRWZXJzaW9uLAogICAgICAgICAgICAgICAgICAgICAgICBEaWZmICAgICA9PiAkRGlmZiwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gIkZpbGVEaWZmIiwKICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgTG9jYXRpb24gPT4gJExvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICBOYW1lICAgICA9PiAkTmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgVmVyc2lvbiAgPT4gJFZlcnNpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIERpZmYgICAgID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSggJ0NhblwndCByZWFkICVzIScsICRMb2NhbEZpbGUgKSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+SGVhZGVyKCk7CiAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5OYXZpZ2F0aW9uQmFyKCk7CiAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQWRtaW5QYWNrYWdlTWFuYWdlcicsCiAgICAgICAgKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigpOwogICAgICAgIHJldHVybiAkT3V0cHV0OwogICAgfQoKICAgIG15ICREQk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgdmlldyBwYWNrYWdlCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnVmlldycgKSB7CiAgICAgICAgbXkgJE5hbWUgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnTmFtZScgKSAgICB8fCAnJzsKICAgICAgICBteSAkVmVyc2lvbiA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdWZXJzaW9uJyApIHx8ICcnOwogICAgICAgIG15ICRMb2NhdGlvbiA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdMb2NhdGlvbicgKTsKICAgICAgICBteSAlRnJvbnRlbmQ7CgogICAgICAgICMgZ2V0IHBhY2thZ2UKICAgICAgICBteSAkUGFja2FnZSA9ICRQYWNrYWdlT2JqZWN0LT5SZXBvc2l0b3J5R2V0KAogICAgICAgICAgICBOYW1lICAgID0+ICROYW1lLAogICAgICAgICAgICBWZXJzaW9uID0+ICRWZXJzaW9uLAogICAgICAgICAgICBSZXN1bHQgID0+ICdTQ0FMQVInLAogICAgICAgICk7CiAgICAgICAgaWYgKCAhJFBhY2thZ2UgKSB7CiAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvclNjcmVlbigKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gVHJhbnNsYXRhYmxlKCdObyBzdWNoIHBhY2thZ2UhJyksCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIHBhcnNlIHBhY2thZ2UKICAgICAgICBteSAlU3RydWN0dXJlID0gJFBhY2thZ2VPYmplY3QtPlBhY2thZ2VQYXJzZSggU3RyaW5nID0+ICRQYWNrYWdlICk7CgogICAgICAgICMgS0lYQ29yZS1jYXBlSVQKICAgICAgICAjICMgb25saW5lIHZlcmlmaWNhdGlvbgogICAgICAgICMgbXkgJFZlcmlmaWVkID0gJFBhY2thZ2VPYmplY3QtPlBhY2thZ2VWZXJpZnkoCiAgICAgICAgIyAgICAgUGFja2FnZSAgID0+ICRQYWNrYWdlLAogICAgICAgICMgICAgIFN0cnVjdHVyZSA9PiBcJVN0cnVjdHVyZSwKICAgICAgICAjICkgfHwgJ3ZlcmlmaWVkJzsKICAgICAgICAjIG15ICVWZXJpZnlJbmZvID0gJFBhY2thZ2VPYmplY3QtPlBhY2thZ2VWZXJpZnlJbmZvKCk7CiAgICAgICAgIyAjIHRyYW5zbGF0ZSBkZXNjcmlwdGlvbgogICAgICAgICMgaWYgKCAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9ICkgewogICAgICAgICMgICAgICRWZXJpZnlJbmZve0Rlc2NyaXB0aW9ufSA9ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPkdldCgKICAgICAgICAjICAgICAgICAgJFZlcmlmeUluZm97RGVzY3JpcHRpb259CiAgICAgICAgIyAgICAgKTsKICAgICAgICAjIH0KICAgICAgICAjIGNoZWNrIGlmIHZlcmlmaWNhdGlvbiBpcyBlbmFibGVkCiAgICAgICAgbXkgJFZlcmlmaWVkOwogICAgICAgIG15ICVWZXJpZnlJbmZvOwoKICAgICAgICBpZiAoJENvbmZpZ3VyZUNhbGxIb21lKSB7CgogICAgICAgICAgICAjIG9ubGluZSB2ZXJpZmljYXRpb24KICAgICAgICAgICAgJFZlcmlmaWVkID0gJFBhY2thZ2VPYmplY3QtPlBhY2thZ2VWZXJpZnkoCiAgICAgICAgICAgICAgICBQYWNrYWdlICAgPT4gJFBhY2thZ2UsCiAgICAgICAgICAgICAgICBTdHJ1Y3R1cmUgPT4gXCVTdHJ1Y3R1cmUsCiAgICAgICAgKSB8fCAndW5rbm93bic7CiAgICAgICAgJVZlcmlmeUluZm8gPSAkUGFja2FnZU9iamVjdC0+UGFja2FnZVZlcmlmeUluZm8oKTsKCiAgICAgICAgICAgICMgdHJhbnNsYXRlIGRlc2NyaXB0aW9uCiAgICAgICAgICAgIGlmICggJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fSApIHsKICAgICAgICAgICAgJFZlcmlmeUluZm97RGVzY3JpcHRpb259ID0gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICRWZXJpZnlJbmZve0Rlc2NyaXB0aW9ufQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBFTyBLSVhDb3JlLWNhcGVJVAoKICAgICAgICAjIGRlcGxveSBjaGVjawogICAgICAgIG15ICREZXBsb3llZCA9ICRQYWNrYWdlT2JqZWN0LT5EZXBsb3lDaGVjaygKICAgICAgICAgICAgTmFtZSAgICA9PiAkTmFtZSwKICAgICAgICAgICAgVmVyc2lvbiA9PiAkVmVyc2lvbiwKICAgICAgICApOwogICAgICAgIG15ICVEZXBsb3lJbmZvID0gJFBhY2thZ2VPYmplY3QtPkRlcGxveUNoZWNrSW5mbygpOwogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdQYWNrYWdlJywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAlUGFyYW0sICVGcm9udGVuZCwKICAgICAgICAgICAgICAgIE5hbWUgICAgPT4gJE5hbWUsCiAgICAgICAgICAgICAgICBWZXJzaW9uID0+ICRWZXJzaW9uLAogICAgICAgICAgICB9LAogICAgICAgICk7CgogICAgICAgIG15IEBSZXBvc2l0b3J5TGlzdCA9ICRQYWNrYWdlT2JqZWN0LT5SZXBvc2l0b3J5TGlzdCgKICAgICAgICAgICAgUmVzdWx0ID0+ICdzaG9ydCcsCiAgICAgICAgKTsKCiAgICAgICAgIyBpZiB2aXNpYmxlIHByb3BlcnR5IGlzIG5vdCBlbmFibGUsIHJldHVybiBlcnJvciBzY3JlZW4KICAgICAgICBpZiAoCiAgICAgICAgICAgIGRlZmluZWQgJFN0cnVjdHVyZXtQYWNrYWdlSXNWaXNpYmxlfQogICAgICAgICAgICAmJiBleGlzdHMgJFN0cnVjdHVyZXtQYWNrYWdlSXNWaXNpYmxlfS0+e0NvbnRlbnR9CiAgICAgICAgICAgICYmICEkU3RydWN0dXJle1BhY2thZ2VJc1Zpc2libGV9LT57Q29udGVudH0KICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yU2NyZWVuKAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoJ05vIHN1Y2ggcGFja2FnZSEnKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIFBBQ0tBR0VBQ1RJT046CiAgICAgICAgZm9yIG15ICRQYWNrYWdlQWN0aW9uIChxdyhEb3dubG9hZExvY2FsIFJlYnVpbGQgUmVpbnN0YWxsKSkgewoKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgJFBhY2thZ2VBY3Rpb24gZXEgJ0Rvd25sb2FkTG9jYWwnCiAgICAgICAgICAgICAgICAmJiAoCiAgICAgICAgICAgICAgICAgICAgZGVmaW5lZCAkU3RydWN0dXJle1BhY2thZ2VJc0Rvd25sb2FkYWJsZX0KICAgICAgICAgICAgICAgICAgICAmJiBleGlzdHMgJFN0cnVjdHVyZXtQYWNrYWdlSXNEb3dubG9hZGFibGV9LT57Q29udGVudH0KICAgICAgICAgICAgICAgICAgICAmJiAhJFN0cnVjdHVyZXtQYWNrYWdlSXNEb3dubG9hZGFibGV9LT57Q29udGVudH0KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbmV4dCBQQUNLQUdFQUNUSU9OOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1BhY2thZ2UnIC4gJFBhY2thZ2VBY3Rpb24sCiAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICAgICAgJUZyb250ZW5kLAogICAgICAgICAgICAgICAgICAgIE5hbWUgICAgPT4gJE5hbWUsCiAgICAgICAgICAgICAgICAgICAgVmVyc2lvbiA9PiAkVmVyc2lvbiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIGNoZWNrIGlmIGZpbGUgaXMgcmVxdWVzdGVkCiAgICAgICAgaWYgKCRMb2NhdGlvbikgewogICAgICAgICAgICBpZiAoIHJlZiAkU3RydWN0dXJle0ZpbGVsaXN0fSBlcSAnQVJSQVknICkgewogICAgICAgICAgICAgICAgZm9yIG15ICRIYXNoICggQHsgJFN0cnVjdHVyZXtGaWxlbGlzdH0gfSApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoICRIYXNoLT57TG9jYXRpb259IGVxICRMb2NhdGlvbiApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkF0dGFjaG1lbnQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaWxlbmFtZSAgICA9PiAkTG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb250ZW50VHlwZSA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnRlbnQgICAgID0+ICRIYXNoLT57Q29udGVudH0sCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIG15IEBEYXRhYmFzZUJ1ZmZlcjsKCiAgICAgICAgIyBjb3JyZWN0IGFueSAnZG9zLXN0eWxlJyBsaW5lIGVuZGluZ3MgLSBodHRwOi8vYnVncy5vdHJzLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9OTgzOAogICAgICAgICR7JFBhY2thZ2V9ID1+IHN7XHJcbn17XG59eG1zZzsKCiAgICAgICAgIyBjcmVhdGUgTUQ1IHN1bSBhbmQgYWRkIGl0IGludG8gZXhpc3RpbmcgcGFja2FnZSBzdHJ1Y3R1cmUKICAgICAgICBteSAkTUQ1c3VtID0gJE1haW5PYmplY3QtPk1ENXN1bSggU3RyaW5nID0+ICRQYWNrYWdlICk7CgogICAgICAgICRTdHJ1Y3R1cmV7TUQ1c3VtfSA9IHsKICAgICAgICAgICAgVGFnICAgICA9PiAnTUQ1c3VtJywKICAgICAgICAgICAgQ29udGVudCA9PiAkTUQ1c3VtLAogICAgICAgIH07CgogICAgICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICVTdHJ1Y3R1cmUgKSB7CgogICAgICAgICAgICBpZiAoIHJlZiAkU3RydWN0dXJleyRLZXl9IGVxICdIQVNIJyApIHsKCiAgICAgICAgICAgICAgICBpZiAoICRLZXkgPX4gL14oRGVzY3JpcHRpb258RmlsZWxpc3QpJC8gKSB7CiAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gIlBhY2thZ2VJdGVtJEtleSIsCiAgICAgICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGFnID0+ICRLZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAleyAkU3RydWN0dXJleyRLZXl9IH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzaWYgKCAkS2V5ID1+IC9eRGF0YWJhc2UoSW5zdGFsbHxSZWluc3RhbGx8VXBncmFkZXxVbmluc3RhbGwpJC8gKSB7CgogICAgICAgICAgICAgICAgICAgIGZvciBteSAkVHlwZSAocXcocHJlIHBvc3QpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBteSAkSGFzaCAoIEB7ICRTdHJ1Y3R1cmV7JEtleX0tPnskVHlwZX0gfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJEhhc2gtPntUYWdUeXBlfSBlcSAnU3RhcnQnICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJEhhc2gtPntUYWd9ID1+IC9eVGFibGUvICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gIlBhY2thZ2VJdGVtRGF0YWJhc2UiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJXskSGFzaH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGFnTmFtZSA9PiAkS2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFR5cGUgICAgPT4gJFR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2ggQERhdGFiYXNlQnVmZmVyLCAkSGFzaDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAiUGFja2FnZUl0ZW1EYXRhYmFzZVN1YiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAleyRIYXNofSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUYWdOYW1lID0+ICRLZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoIEBEYXRhYmFzZUJ1ZmZlciwgJEhhc2g7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkSGFzaC0+e1RhZ30gPX4gL15UYWJsZS8gJiYgJEhhc2gtPntUYWdUeXBlfSBlcSAnRW5kJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoIEBEYXRhYmFzZUJ1ZmZlciwgJEhhc2g7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXkgQFNRTCA9ICREQk9iamVjdC0+U1FMUHJvY2Vzc29yKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhYmFzZSA9PiBcQERhdGFiYXNlQnVmZmVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteSBAU1FMUG9zdCA9ICREQk9iamVjdC0+U1FMUHJvY2Vzc29yUG9zdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2ggQFNRTCwgQFNRTFBvc3Q7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRTUUwgKEBTUUwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICJQYWNrYWdlSXRlbURhdGFiYXNlU1FMIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRhZ05hbWUgPT4gJEtleSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTUUwgICAgID0+ICRTUUwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBARGF0YWJhc2VCdWZmZXIgPSAoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdQYWNrYWdlSXRlbUdlbmVyaWMnLAogICAgICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRhZyA9PiAkS2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJXsgJFN0cnVjdHVyZXskS2V5fSB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNpZiAoIHJlZiAkU3RydWN0dXJleyRLZXl9IGVxICdBUlJBWScgKSB7CgogICAgICAgICAgICAgICAgZm9yIG15ICRIYXNoICggQHsgJFN0cnVjdHVyZXskS2V5fSB9ICkgewogICAgICAgICAgICAgICAgICAgIGlmICggJEtleSA9fiAvXihEZXNjcmlwdGlvbnxDaGFuZ2VMb2cpJC8gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAiUGFja2FnZUl0ZW0kS2V5IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICV7JEhhc2h9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRhZyA9PiAkS2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzaWYgKCAkS2V5ID1+IC9eQ29kZS8gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRIYXNoLT57Q29udGVudH0gPSAkTGF5b3V0T2JqZWN0LT5Bc2NpaTJIdG1sKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGV4dCAgICAgICAgICAgPT4gJEhhc2gtPntDb250ZW50fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhUTUxSZXN1bHRNb2RlID0+IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOZXdMaW5lICAgICAgICA9PiA3MiwKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICJQYWNrYWdlSXRlbUNvZGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGFnID0+ICRLZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJXskSGFzaH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2lmICggJEtleSA9fiAvXihJbnRybykvICkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRIYXNoLT57Rm9ybWF0fSAmJiAkSGFzaC0+e0Zvcm1hdH0gPX4gL3BsYWluL2kgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkSGFzaC0+e0NvbnRlbnR9ID0gJzxwcmUgY2xhc3M9ImNvbnRlbnRib2R5Ij4nIC4gJEhhc2gtPntDb250ZW50fSAuICc8L3ByZT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAiUGFja2FnZUl0ZW1JbnRybyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAleyRIYXNofSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUYWcgPT4gJEtleSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2lmICggJEhhc2gtPntUYWd9ID1+IC9eKEZpbGUpJC8gKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAjIGFkZCBodW1hbiByZWFkYWJsZSBmaWxlIHNpemUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkSGFzaC0+e1NpemV9ICkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgcmVtb3ZlIG1ldGEgZGF0YSBpbiBmaWxlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkSGFzaC0+e1NpemV9ID4gKCAxMDI0ICogMTAyNCApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRIYXNoLT57U2l6ZX0gPSBzcHJpbnRmICIlLjFmIE1CeXRlcyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICggJEhhc2gtPntTaXplfSAvICggMTAyNCAqIDEwMjQgKSApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzaWYgKCAkSGFzaC0+e1NpemV9ID4gMTAyNCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkSGFzaC0+e1NpemV9ID0gc3ByaW50ZiAiJS4xZiBLQnl0ZXMiLCAoICggJEhhc2gtPntTaXplfSAvIDEwMjQgKSApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEhhc2gtPntTaXplfSA9ICRIYXNoLT57U2l6ZX0gLiAnIEJ5dGVzJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gIlBhY2thZ2VJdGVtRmlsZWxpc3RGaWxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgICAgPT4gJE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmVyc2lvbiA9PiAkVmVyc2lvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAleyRIYXNofSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgICAgICAjIGNoZWNrIGlmIGlzIHBvc3NpYmxlIHRvIGRvd25sb2FkIGZpbGVzCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICFkZWZpbmVkICRTdHJ1Y3R1cmV7UGFja2FnZUlzRG93bmxvYWRhYmxlfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmluZWQgJFN0cnVjdHVyZXtQYWNrYWdlSXNEb3dubG9hZGFibGV9LT57Q29udGVudH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiAkU3RydWN0dXJle1BhY2thZ2VJc0Rvd25sb2FkYWJsZX0tPntDb250ZW50fSBlcSAnMScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAiUGFja2FnZUl0ZW1GaWxlbGlzdEZpbGVMaW5rIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSAgICA9PiAkTmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmVyc2lvbiA9PiAkVmVyc2lvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJXskSGFzaH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJERlcGxveUluZm97RmlsZX0tPnsgJEhhc2gtPntMb2NhdGlvbn0gfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJERlcGxveUluZm97RmlsZX0tPnsgJEhhc2gtPntMb2NhdGlvbn0gfSA9fiAvZGlmZmVyZW50LyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAiUGFja2FnZUl0ZW1GaWxlbGlzdEZpbGVOb3RlRGlmZiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSAgICA9PiAkTmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZlcnNpb24gPT4gJFZlcnNpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAleyRIYXNofSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJERlcGxveUluZm97RmlsZX0tPnsgJEhhc2gtPntMb2NhdGlvbn0gfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEljb24gICAgPT4gJ0ljb25Ob3RSZWFkeScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICJQYWNrYWdlSXRlbUZpbGVsaXN0RmlsZU5vdGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgICAgPT4gJE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWZXJzaW9uID0+ICRWZXJzaW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJXskSGFzaH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICREZXBsb3lJbmZve0ZpbGV9LT57ICRIYXNoLT57TG9jYXRpb259IH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJY29uICAgID0+ICdJY29uTm90UmVhZHlHcmV5JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAiUGFja2FnZUl0ZW1GaWxlbGlzdEZpbGVOb3RlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSAgICA9PiAkTmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmVyc2lvbiA9PiAkVmVyc2lvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJXskSGFzaH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJ29rJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSWNvbiAgICA9PiAnSWNvblJlYWR5JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICJQYWNrYWdlSXRlbUdlbmVyaWMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJXskSGFzaH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGFnID0+ICRLZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+SGVhZGVyKCk7CiAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5OYXZpZ2F0aW9uQmFyKCk7CiAgICAgICAgaWYgKCAhJERlcGxveWVkICkgewogICAgICAgICAgICBteSAkUHJpb3JpdHkgPSAnRXJyb3InOwogICAgICAgICAgICBteSAkTWVzc2FnZSAgPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9CiAgICAgICAgICAgICAgICAtPlRyYW5zbGF0ZSgiUGFja2FnZSBub3QgY29ycmVjdGx5IGRlcGxveWVkISBQbGVhc2UgcmVpbnN0YWxsIHRoZSBwYWNrYWdlLiIpOwogICAgICAgICAgICBpZiAoICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnUGFja2FnZTo6QWxsb3dMb2NhbE1vZGlmaWNhdGlvbnMnKSApIHsKICAgICAgICAgICAgICAgICRQcmlvcml0eSA9ICdOb3RpY2UnOwogICAgICAgICAgICAgICAgJE1lc3NhZ2UgID0gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCJQYWNrYWdlIGhhcyBsb2NhbGx5IG1vZGlmaWVkIGZpbGVzLiIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5vdGlmeSgKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICRQcmlvcml0eSwKICAgICAgICAgICAgICAgIERhdGEgICAgID0+ICIkTmFtZSAkVmVyc2lvbiAtICRNZXNzYWdlIiwKICAgICAgICAgICAgICAgIExpbmsgICAgID0+ICRMYXlvdXRPYmplY3QtPntCYXNlbGlua30KICAgICAgICAgICAgICAgICAgICAuICdBY3Rpb249QWRtaW5QYWNrYWdlTWFuYWdlcjtTdWJhY3Rpb249VmlldztOYW1lPScKICAgICAgICAgICAgICAgICAgICAuICROYW1lCiAgICAgICAgICAgICAgICAgICAgLiAnO1ZlcnNpb249JwogICAgICAgICAgICAgICAgICAgIC4gJFZlcnNpb24sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBpZiAoICRWZXJpZmllZCBuZSAndmVyaWZpZWQnICkgewoKICAgICAgICAgICAgIyBLSVhDb3JlLWNhcGVJVAogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5vdGlmeSgKCiMgS0lYQ29yZS1jYXBlSVQKIyBQcmlvcml0eSA9PiAnRXJyb3InLAojIERhdGEgICAgID0+ICIkTmFtZSAkVmVyc2lvbiAtICIKIyAgICAgICAgICAgICAgICAgICAuICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKIyAgICAgICAgICAgICAgICAgICAgIlBhY2thZ2Ugbm90IHZlcmlmaWVkIGJ5IHRoZSBPVFJTIEdyb3VwISBJdCBpcyByZWNvbW1lbmRlZCBub3QgdG8gdXNlIHRoaXMgcGFja2FnZS4iCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnSW5mb3JtYXRpb24nLAogICAgICAgICAgICAgICAgRGF0YSAgICAgPT4gIiROYW1lICRWZXJzaW9uIC0gIgogICAgICAgICAgICAgICAgICAgIC4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCJUaGlzIHBhY2thZ2UgaXMgbm90IGNlcnRpZmllZCBieSBPVFJTIEdyb3VwLCB3aGljaCBkb2VzIG5vdCBtZWFuIGl0IGlzIG9mIGluZmVyaW9yIHF1YWxpdHkgdGhhbiBwcm9kdWN0cyBvZiB0aGUgT1RSUyBHcm91cC4iKSwKCiAgICAgICAgICAgICAgICAjIEVPIEtJWENvcmUtY2FwZUlUCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk91dHB1dCgKICAgICAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdBZG1pblBhY2thZ2VNYW5hZ2VyJywKICAgICAgICApOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCk7CiAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICB9CgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgIyB2aWV3IHJlbW90ZSBwYWNrYWdlCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnVmlld1JlbW90ZScgKSB7CiAgICAgICAgbXkgJEZpbGUgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnRmlsZScgKSB8fCAnJzsKICAgICAgICBteSAkTG9jYXRpb24gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnTG9jYXRpb24nICk7CiAgICAgICAgbXkgJUZyb250ZW5kOwoKICAgICAgICAjIGRvd25sb2FkIHBhY2thZ2UKICAgICAgICBteSAkUGFja2FnZSA9ICRQYWNrYWdlT2JqZWN0LT5QYWNrYWdlT25saW5lR2V0KAogICAgICAgICAgICBTb3VyY2UgPT4gJFNvdXJjZSwKICAgICAgICAgICAgRmlsZSAgID0+ICRGaWxlLAogICAgICAgICk7CgogICAgICAgIGlmICggISRQYWNrYWdlICkgewogICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RXJyb3JTY3JlZW4oIE1lc3NhZ2UgPT4gJ05vIHN1Y2ggcGFja2FnZSEnICk7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggc3Vic3RyKCAkUGFja2FnZSwgMCwgbGVuZ3RoKCdFcnJvck1lc3NhZ2U6JykgKSBlcSAnRXJyb3JNZXNzYWdlOicgKSB7CgogICAgICAgICAgICAjIGFuIGVycm9yIGZyb20gdGhlIFBhY2thZ2U6OkNsb3VkRmlsZUdldCBmdW5jdGlvbgogICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RXJyb3JTY3JlZW4oIE1lc3NhZ2UgPT4gJFBhY2thZ2UgKTsKICAgICAgICB9CiAgICAgICAgbXkgJVN0cnVjdHVyZSA9ICRQYWNrYWdlT2JqZWN0LT5QYWNrYWdlUGFyc2UoIFN0cmluZyA9PiAkUGFja2FnZSApOwogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdQYWNrYWdlJywKICAgICAgICAgICAgRGF0YSA9PiB7ICVQYXJhbSwgJUZyb250ZW5kLCB9LAogICAgICAgICk7CgogICAgICAgICMgYWxsb3cgdG8gZG93bmxvYWQgb25seSBpZiBwYWNrYWdlIGlzIGFsbG93IHRvIGRvIGl0CiAgICAgICAgaWYgKAogICAgICAgICAgICAhZGVmaW5lZCAkU3RydWN0dXJle1BhY2thZ2VJc0Rvd25sb2FkYWJsZX0KICAgICAgICAgICAgfHwgKAogICAgICAgICAgICAgICAgZGVmaW5lZCAkU3RydWN0dXJle1BhY2thZ2VJc0Rvd25sb2FkYWJsZX0tPntDb250ZW50fQogICAgICAgICAgICAgICAgJiYgJFN0cnVjdHVyZXtQYWNrYWdlSXNEb3dubG9hZGFibGV9LT57Q29udGVudH0gZXEgJzEnCiAgICAgICAgICAgICkKICAgICAgICAgICAgKQogICAgICAgIHsKCiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnUGFja2FnZURvd25sb2FkUmVtb3RlJywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICVQYXJhbSwgJUZyb250ZW5kLAogICAgICAgICAgICAgICAgICAgIEZpbGUgPT4gJEZpbGUsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBjaGVjayBpZiBmaWxlIGlzIHJlcXVlc3RlZAogICAgICAgIGlmICgkTG9jYXRpb24pIHsKICAgICAgICAgICAgaWYgKCByZWYgJFN0cnVjdHVyZXtGaWxlbGlzdH0gZXEgJ0FSUkFZJyApIHsKICAgICAgICAgICAgICAgIGZvciBteSAkSGFzaCAoIEB7ICRTdHJ1Y3R1cmV7RmlsZWxpc3R9IH0gKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCAkSGFzaC0+e0xvY2F0aW9ufSBlcSAkTG9jYXRpb24gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5BdHRhY2htZW50KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRmlsZW5hbWUgICAgPT4gJExvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29udGVudFR5cGUgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb250ZW50ICAgICA9PiAkSGFzaC0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBteSBARGF0YWJhc2VCdWZmZXI7CiAgICAgICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJVN0cnVjdHVyZSApIHsKICAgICAgICAgICAgaWYgKCByZWYgJFN0cnVjdHVyZXskS2V5fSBlcSAnSEFTSCcgKSB7CiAgICAgICAgICAgICAgICBpZiAoICRLZXkgPX4gL14oRGVzY3JpcHRpb258RmlsZWxpc3QpJC8gKSB7CiAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gIlBhY2thZ2VJdGVtJEtleSIsCiAgICAgICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGFnID0+ICRLZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAleyAkU3RydWN0dXJleyRLZXl9IH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzaWYgKCAkS2V5ID1+IC9eRGF0YWJhc2UoSW5zdGFsbHxSZWluc3RhbGx8VXBncmFkZXxVbmluc3RhbGwpJC8gKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRUeXBlIChxdyhwcmUgcG9zdCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRIYXNoICggQHsgJFN0cnVjdHVyZXskS2V5fS0+eyRUeXBlfSB9ICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkSGFzaC0+e1RhZ1R5cGV9IGVxICdTdGFydCcgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkSGFzaC0+e1RhZ30gPX4gL15UYWJsZS8gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAiUGFja2FnZUl0ZW1EYXRhYmFzZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAleyRIYXNofSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUYWdOYW1lID0+ICRLZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVHlwZSAgICA9PiAkVHlwZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCBARGF0YWJhc2VCdWZmZXIsICRIYXNoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICJQYWNrYWdlSXRlbURhdGFiYXNlU3ViIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICV7JEhhc2h9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRhZ05hbWUgPT4gJEtleSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2ggQERhdGFiYXNlQnVmZmVyLCAkSGFzaDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRIYXNoLT57VGFnfSA9fiAvXlRhYmxlLyAmJiAkSGFzaC0+e1RhZ1R5cGV9IGVxICdFbmQnICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2ggQERhdGFiYXNlQnVmZmVyLCAkSGFzaDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteSBAU1FMID0gJERCT2JqZWN0LT5TUUxQcm9jZXNzb3IoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERhdGFiYXNlID0+IFxARGF0YWJhc2VCdWZmZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15IEBTUUxQb3N0ID0gJERCT2JqZWN0LT5TUUxQcm9jZXNzb3JQb3N0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCBAU1FMLCBAU1FMUG9zdDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgbXkgJFNRTCAoQFNRTCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gIlBhY2thZ2VJdGVtRGF0YWJhc2VTUUwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGFnTmFtZSA9PiAkS2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNRTCAgICAgPT4gJFNRTCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEBEYXRhYmFzZUJ1ZmZlciA9ICgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1BhY2thZ2VJdGVtR2VuZXJpYycsCiAgICAgICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGFnID0+ICRLZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAleyAkU3RydWN0dXJleyRLZXl9IH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2lmICggcmVmICRTdHJ1Y3R1cmV7JEtleX0gZXEgJ0FSUkFZJyApIHsKICAgICAgICAgICAgICAgIGZvciBteSAkSGFzaCAoIEB7ICRTdHJ1Y3R1cmV7JEtleX0gfSApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoICRLZXkgPX4gL14oRGVzY3JpcHRpb258Q2hhbmdlTG9nKSQvICkgewogICAgICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gIlBhY2thZ2VJdGVtJEtleSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAleyRIYXNofSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUYWcgPT4gJEtleSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2lmICggJEtleSA9fiAvXkNvZGUvICkgewogICAgICAgICAgICAgICAgICAgICAgICAkSGFzaC0+e0NvbnRlbnR9ID0gJExheW91dE9iamVjdC0+QXNjaWkySHRtbCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHQgICAgICAgICAgID0+ICRIYXNoLT57Q29udGVudH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIVE1MUmVzdWx0TW9kZSA9PiAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmV3TGluZSAgICAgICAgPT4gNzIsCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAiUGFja2FnZUl0ZW1Db2RlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRhZyA9PiAkS2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICV7JEhhc2h9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNpZiAoICRLZXkgPX4gL14oSW50cm8pLyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkSGFzaC0+e0Zvcm1hdH0gJiYgJEhhc2gtPntGb3JtYXR9ID1+IC9wbGFpbi9pICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEhhc2gtPntDb250ZW50fSA9ICc8cHJlIGNsYXNzPSJjb250ZW50Ym9keSI+JyAuICRIYXNoLT57Q29udGVudH0gLiAnPC9wcmU+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gIlBhY2thZ2VJdGVtSW50cm8iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJXskSGFzaH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGFnID0+ICRLZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNpZiAoICRIYXNoLT57VGFnfSA9fiAvXihGaWxlKSQvICkgewoKICAgICAgICAgICAgICAgICAgICAgICAgIyBhZGQgaHVtYW4gcmVhZGFibGUgZmlsZSBzaXplCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJEhhc2gtPntTaXplfSApIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHJlbW92ZSBtZXRhIGRhdGEgaW4gZmlsZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJEhhc2gtPntTaXplfSA+ICggMTAyNCAqIDEwMjQgKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkSGFzaC0+e1NpemV9ID0gc3ByaW50ZiAiJS4xZiBNQnl0ZXMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoICRIYXNoLT57U2l6ZX0gLyAoIDEwMjQgKiAxMDI0ICkgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2lmICggJEhhc2gtPntTaXplfSA+IDEwMjQgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEhhc2gtPntTaXplfSA9IHNwcmludGYgIiUuMWYgS0J5dGVzIiwgKCAoICRIYXNoLT57U2l6ZX0gLyAxMDI0ICkgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRIYXNoLT57U2l6ZX0gPSAkSGFzaC0+e1NpemV9IC4gJyBCeXRlcyc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdQYWNrYWdlSXRlbUZpbGVsaXN0RmlsZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lICAgID0+ICRTdHJ1Y3R1cmV7TmFtZX0tPntDb250ZW50fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWZXJzaW9uID0+ICRTdHJ1Y3R1cmV7VmVyc2lvbn0tPntDb250ZW50fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaWxlICAgID0+ICRGaWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICV7JEhhc2h9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICMgY2hlY2sgaWYgaXMgcG9zc2libGUgdG8gZG93bmxvYWQgZmlsZXMKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIWRlZmluZWQgJFN0cnVjdHVyZXtQYWNrYWdlSXNEb3dubG9hZGFibGV9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmaW5lZCAkU3RydWN0dXJle1BhY2thZ2VJc0Rvd25sb2FkYWJsZX0tPntDb250ZW50fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmICRTdHJ1Y3R1cmV7UGFja2FnZUlzRG93bmxvYWRhYmxlfS0+e0NvbnRlbnR9IGVxICcxJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICJQYWNrYWdlSXRlbUZpbGVsaXN0RmlsZUxpbmsiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lICAgID0+ICRTdHJ1Y3R1cmV7TmFtZX0tPntDb250ZW50fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmVyc2lvbiA9PiAkU3RydWN0dXJle1ZlcnNpb259LT57Q29udGVudH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpbGUgICAgPT4gJEZpbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICV7JEhhc2h9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1BhY2thZ2VJdGVtR2VuZXJpYycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAleyRIYXNofSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUYWcgPT4gJEtleSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5hdmlnYXRpb25CYXIoKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk91dHB1dCgKICAgICAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdBZG1pblBhY2thZ2VNYW5hZ2VyJywKICAgICAgICApOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCk7CiAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICB9CgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgIyBkb3dubG9hZCBwYWNrYWdlCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBlbHNpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnRG93bmxvYWQnICkgewogICAgICAgIG15ICROYW1lICAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ05hbWUnICkgICAgfHwgJyc7CiAgICAgICAgbXkgJFZlcnNpb24gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnVmVyc2lvbicgKSB8fCAnJzsKCiAgICAgICAgIyBnZXQgcGFja2FnZQogICAgICAgIG15ICRQYWNrYWdlID0gJFBhY2thZ2VPYmplY3QtPlJlcG9zaXRvcnlHZXQoCiAgICAgICAgICAgIE5hbWUgICAgPT4gJE5hbWUsCiAgICAgICAgICAgIFZlcnNpb24gPT4gJFZlcnNpb24sCiAgICAgICAgKTsKICAgICAgICBpZiAoICEkUGFja2FnZSApIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yU2NyZWVuKAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoJ05vIHN1Y2ggcGFja2FnZSEnKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkF0dGFjaG1lbnQoCiAgICAgICAgICAgIENvbnRlbnQgICAgID0+ICRQYWNrYWdlLAogICAgICAgICAgICBDb250ZW50VHlwZSA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywKICAgICAgICAgICAgRmlsZW5hbWUgICAgPT4gIiROYW1lLSRWZXJzaW9uLm9wbSIsCiAgICAgICAgICAgIFR5cGUgICAgICAgID0+ICdhdHRhY2htZW50JywKICAgICAgICApOwogICAgfQoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgZG93bmxvYWQgcmVtb3RlIHBhY2thZ2UKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgIGVsc2lmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdEb3dubG9hZFJlbW90ZScgKSB7CiAgICAgICAgbXkgJEZpbGUgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnRmlsZScgKSB8fCAnJzsKCiAgICAgICAgIyBkb3dubG9hZCBwYWNrYWdlCiAgICAgICAgbXkgJFBhY2thZ2UgPSAkUGFja2FnZU9iamVjdC0+UGFja2FnZU9ubGluZUdldCgKICAgICAgICAgICAgU291cmNlID0+ICRTb3VyY2UsCiAgICAgICAgICAgIEZpbGUgICA9PiAkRmlsZSwKICAgICAgICApOwoKICAgICAgICAjIGNoZWNrCiAgICAgICAgaWYgKCAhJFBhY2thZ2UgKSB7CiAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvclNjcmVlbigKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gVHJhbnNsYXRhYmxlKCdObyBzdWNoIHBhY2thZ2UhJyksCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5BdHRhY2htZW50KAogICAgICAgICAgICBDb250ZW50ICAgICA9PiAkUGFja2FnZSwKICAgICAgICAgICAgQ29udGVudFR5cGUgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgIEZpbGVuYW1lICAgID0+ICRGaWxlLAogICAgICAgICAgICBUeXBlICAgICAgICA9PiAnYXR0YWNobWVudCcsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICAjIGNoYW5nZSByZXBvc2l0b3J5CiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBlbHNpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnQ2hhbmdlUmVwb3NpdG9yeScgKSB7CgogICAgICAgICMgY2hhbGxlbmdlIHRva2VuIGNoZWNrIGZvciB3cml0ZSBhY3Rpb24KICAgICAgICAkTGF5b3V0T2JqZWN0LT5DaGFsbGVuZ2VUb2tlbkNoZWNrKCk7CgogICAgICAgIG15ICRTb3VyY2UgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnU291cmNlJyApIHx8ICcnOwogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpBdXRoU2Vzc2lvbicpLT5VcGRhdGVTZXNzaW9uSUQoCiAgICAgICAgICAgIFNlc3Npb25JRCA9PiAkU2VsZi0+e1Nlc3Npb25JRH0sCiAgICAgICAgICAgIEtleSAgICAgICA9PiAnVXNlclJlcG9zaXRvcnknLAogICAgICAgICAgICBWYWx1ZSAgICAgPT4gJFNvdXJjZSwKICAgICAgICApOwogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCggT1AgPT4gIkFjdGlvbj0kU2VsZi0+e0FjdGlvbn0iICk7CiAgICB9CgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgIyBpbnN0YWxsIHBhY2thZ2UKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgIGVsc2lmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdJbnN0YWxsJyApIHsKCiAgICAgICAgIyBjaGFsbGVuZ2UgdG9rZW4gY2hlY2sgZm9yIHdyaXRlIGFjdGlvbgogICAgICAgICRMYXlvdXRPYmplY3QtPkNoYWxsZW5nZVRva2VuQ2hlY2soKTsKCiAgICAgICAgbXkgJE5hbWUgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnTmFtZScgKSAgICB8fCAnJzsKICAgICAgICBteSAkVmVyc2lvbiA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdWZXJzaW9uJyApIHx8ICcnOwoKICAgICAgICAjIGdldCBwYWNrYWdlCiAgICAgICAgbXkgJFBhY2thZ2UgPSAkUGFja2FnZU9iamVjdC0+UmVwb3NpdG9yeUdldCgKICAgICAgICAgICAgTmFtZSAgICA9PiAkTmFtZSwKICAgICAgICAgICAgVmVyc2lvbiA9PiAkVmVyc2lvbiwKICAgICAgICAgICAgUmVzdWx0ICA9PiAnU0NBTEFSJywKICAgICAgICApOwoKICAgICAgICByZXR1cm4gJFNlbGYtPl9JbnN0YWxsSGFuZGxpbmcoIFBhY2thZ2UgPT4gJFBhY2thZ2UgKTsKICAgIH0KCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICAjIGluc3RhbGwgcmVtb3RlIHBhY2thZ2UKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgIGVsc2lmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdJbnN0YWxsUmVtb3RlJyApIHsKCiAgICAgICAgIyBjaGFsbGVuZ2UgdG9rZW4gY2hlY2sgZm9yIHdyaXRlIGFjdGlvbgogICAgICAgICRMYXlvdXRPYmplY3QtPkNoYWxsZW5nZVRva2VuQ2hlY2soKTsKCiAgICAgICAgbXkgJEZpbGUgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnRmlsZScgKSB8fCAnJzsKCiAgICAgICAgIyBkb3dubG9hZCBwYWNrYWdlCiAgICAgICAgbXkgJFBhY2thZ2UgPSAkUGFja2FnZU9iamVjdC0+UGFja2FnZU9ubGluZUdldCgKICAgICAgICAgICAgU291cmNlID0+ICRTb3VyY2UsCiAgICAgICAgICAgIEZpbGUgICA9PiAkRmlsZSwKICAgICAgICApOwoKICAgICAgICByZXR1cm4gJFNlbGYtPl9JbnN0YWxsSGFuZGxpbmcoCiAgICAgICAgICAgIFBhY2thZ2UgPT4gJFBhY2thZ2UsCiAgICAgICAgICAgIFNvdXJjZSAgPT4gJFNvdXJjZSwKICAgICAgICAgICAgRmlsZSAgICA9PiAkRmlsZSwKICAgICAgICApOwogICAgfQoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgdXBncmFkZSByZW1vdGUgcGFja2FnZQogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgZWxzaWYgKCAkU2VsZi0+e1N1YmFjdGlvbn0gZXEgJ1VwZ3JhZGVSZW1vdGUnICkgewoKICAgICAgICAjIGNoYWxsZW5nZSB0b2tlbiBjaGVjayBmb3Igd3JpdGUgYWN0aW9uCiAgICAgICAgJExheW91dE9iamVjdC0+Q2hhbGxlbmdlVG9rZW5DaGVjaygpOwoKICAgICAgICBteSAkRmlsZSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdGaWxlJyApIHx8ICcnOwoKICAgICAgICAjIGRvd25sb2FkIHBhY2thZ2UKICAgICAgICBteSAkUGFja2FnZSA9ICRQYWNrYWdlT2JqZWN0LT5QYWNrYWdlT25saW5lR2V0KAogICAgICAgICAgICBGaWxlICAgPT4gJEZpbGUsCiAgICAgICAgICAgIFNvdXJjZSA9PiAkU291cmNlLAogICAgICAgICk7CgogICAgICAgIHJldHVybiAkU2VsZi0+X1VwZ3JhZGVIYW5kbGluZygKICAgICAgICAgICAgUGFja2FnZSA9PiAkUGFja2FnZSwKICAgICAgICAgICAgRmlsZSAgICA9PiAkRmlsZSwKICAgICAgICAgICAgU291cmNlICA9PiAkU291cmNlLAogICAgICAgICk7CiAgICB9CgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgIyByZWluc3RhbGwgcGFja2FnZQogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgZWxzaWYgKCAkU2VsZi0+e1N1YmFjdGlvbn0gZXEgJ1JlaW5zdGFsbCcgKSB7CgogICAgICAgICMgY2hhbGxlbmdlIHRva2VuIGNoZWNrIGZvciB3cml0ZSBhY3Rpb24KICAgICAgICAkTGF5b3V0T2JqZWN0LT5DaGFsbGVuZ2VUb2tlbkNoZWNrKCk7CgogICAgICAgIG15ICROYW1lICAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ05hbWUnICkgICAgfHwgJyc7CiAgICAgICAgbXkgJFZlcnNpb24gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnVmVyc2lvbicgKSB8fCAnJzsKICAgICAgICBteSAkSW50cm9SZWluc3RhbGxQcmUgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnSW50cm9SZWluc3RhbGxQcmUnICkKICAgICAgICAgICAgfHwgJyc7CgogICAgICAgICMgZ2V0IHBhY2thZ2UKICAgICAgICBteSAkUGFja2FnZSA9ICRQYWNrYWdlT2JqZWN0LT5SZXBvc2l0b3J5R2V0KAogICAgICAgICAgICBOYW1lICAgID0+ICROYW1lLAogICAgICAgICAgICBWZXJzaW9uID0+ICRWZXJzaW9uLAogICAgICAgICAgICBSZXN1bHQgID0+ICdTQ0FMQVInLAogICAgICAgICk7CiAgICAgICAgaWYgKCAhJFBhY2thZ2UgKSB7CiAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvclNjcmVlbigKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gVHJhbnNsYXRhYmxlKCdObyBzdWNoIHBhY2thZ2UhJyksCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIGNoZWNrIGlmIHdlIGhhdmUgdG8gc2hvdyByZWluc3RhbGwgaW50cm8gcHJlCiAgICAgICAgbXkgJVN0cnVjdHVyZSA9ICRQYWNrYWdlT2JqZWN0LT5QYWNrYWdlUGFyc2UoCiAgICAgICAgICAgIFN0cmluZyA9PiAkUGFja2FnZSwKICAgICAgICApOwoKICAgICAgICAjIGludHJvIHNjcmVlbgogICAgICAgIG15ICVEYXRhOwogICAgICAgIGlmICggJFN0cnVjdHVyZXtJbnRyb1JlaW5zdGFsbH0gKSB7CiAgICAgICAgICAgICVEYXRhID0gJFNlbGYtPl9NZXNzYWdlR2V0KAogICAgICAgICAgICAgICAgSW5mbyA9PiAkU3RydWN0dXJle0ludHJvUmVpbnN0YWxsfSwKICAgICAgICAgICAgICAgIFR5cGUgPT4gJ3ByZScKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgaWYgKCAlRGF0YSAmJiAhJEludHJvUmVpbnN0YWxsUHJlICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0ludHJvJywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICAgICAlRGF0YSwKICAgICAgICAgICAgICAgICAgICBTdWJhY3Rpb24gPT4gJFNlbGYtPntTdWJhY3Rpb259LAogICAgICAgICAgICAgICAgICAgIFR5cGUgICAgICA9PiAnSW50cm9SZWluc3RhbGxQcmUnLAogICAgICAgICAgICAgICAgICAgIE5hbWUgICAgICA9PiAkU3RydWN0dXJle05hbWV9LT57Q29udGVudH0sCiAgICAgICAgICAgICAgICAgICAgVmVyc2lvbiAgID0+ICRTdHJ1Y3R1cmV7VmVyc2lvbn0tPntDb250ZW50fSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnSW50cm9DYW5jZWwnLAogICAgICAgICAgICApOwogICAgICAgICAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+SGVhZGVyKCk7CiAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+TmF2aWdhdGlvbkJhcigpOwogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk91dHB1dCgKICAgICAgICAgICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQWRtaW5QYWNrYWdlTWFuYWdlcicsCiAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgPT4gXCVQYXJhbSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Gb290ZXIoKTsKICAgICAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICAgICAgfQoKICAgICAgICAjIHJlaW5zdGFsbCBzY3JlZW4KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdSZWluc3RhbGwnLAogICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgICAgIE5hbWUgICAgPT4gJFN0cnVjdHVyZXtOYW1lfS0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgICAgIFZlcnNpb24gPT4gJFN0cnVjdHVyZXtWZXJzaW9ufS0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgbXkgJE91dHB1dCA9ICRMYXlvdXRPYmplY3QtPkhlYWRlcigpOwogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5hdmlnYXRpb25CYXIoKTsKICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gJ0FkbWluUGFja2FnZU1hbmFnZXInLAogICAgICAgICAgICApOwogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigpOwogICAgICAgICAgICByZXR1cm4gJE91dHB1dDsKICAgICAgICB9CiAgICB9CgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgIyByZWluc3RhbGwgYWN0aW9uIHBhY2thZ2UKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgIGVsc2lmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdSZWluc3RhbGxBY3Rpb24nICkgewoKICAgICAgICAjIGNoYWxsZW5nZSB0b2tlbiBjaGVjayBmb3Igd3JpdGUgYWN0aW9uCiAgICAgICAgJExheW91dE9iamVjdC0+Q2hhbGxlbmdlVG9rZW5DaGVjaygpOwoKICAgICAgICBteSAkTmFtZSAgICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdOYW1lJyApICAgIHx8ICcnOwogICAgICAgIG15ICRWZXJzaW9uID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1ZlcnNpb24nICkgfHwgJyc7CiAgICAgICAgbXkgJEludHJvUmVpbnN0YWxsUG9zdCA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdJbnRyb1JlaW5zdGFsbFBvc3QnICkKICAgICAgICAgICAgfHwgJyc7CgogICAgICAgICMgZ2V0IHBhY2thZ2UKICAgICAgICBteSAkUGFja2FnZSA9ICRQYWNrYWdlT2JqZWN0LT5SZXBvc2l0b3J5R2V0KAogICAgICAgICAgICBOYW1lICAgID0+ICROYW1lLAogICAgICAgICAgICBWZXJzaW9uID0+ICRWZXJzaW9uLAogICAgICAgICk7CiAgICAgICAgaWYgKCAhJFBhY2thZ2UgKSB7CiAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvclNjcmVlbigKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gVHJhbnNsYXRhYmxlKCdObyBzdWNoIHBhY2thZ2UhJyksCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIGNoZWNrIGlmIHdlIGhhdmUgdG8gc2hvdyByZWluc3RhbGwgaW50cm8gcHJlCiAgICAgICAgbXkgJVN0cnVjdHVyZSA9ICRQYWNrYWdlT2JqZWN0LT5QYWNrYWdlUGFyc2UoCiAgICAgICAgICAgIFN0cmluZyA9PiAkUGFja2FnZSwKICAgICAgICApOwoKICAgICAgICAjIGludHJvIHNjcmVlbgogICAgICAgIGlmICggISRQYWNrYWdlT2JqZWN0LT5QYWNrYWdlUmVpbnN0YWxsKCBTdHJpbmcgPT4gJFBhY2thZ2UgKSApIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yU2NyZWVuKCk7CiAgICAgICAgfQogICAgICAgIG15ICVEYXRhOwogICAgICAgIGlmICggJFN0cnVjdHVyZXtJbnRyb1JlaW5zdGFsbH0gKSB7CiAgICAgICAgICAgICVEYXRhID0gJFNlbGYtPl9NZXNzYWdlR2V0KAogICAgICAgICAgICAgICAgSW5mbyA9PiAkU3RydWN0dXJle0ludHJvUmVpbnN0YWxsfSwKICAgICAgICAgICAgICAgIFR5cGUgPT4gJ3Bvc3QnCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGlmICggJURhdGEgJiYgISRJbnRyb1JlaW5zdGFsbFBvc3QgKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnSW50cm8nLAogICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgICAgICVEYXRhLAogICAgICAgICAgICAgICAgICAgIFN1YmFjdGlvbiA9PiAnJywKICAgICAgICAgICAgICAgICAgICBUeXBlICAgICAgPT4gJ0ludHJvUmVpbnN0YWxsUG9zdCcsCiAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgID0+ICROYW1lLAogICAgICAgICAgICAgICAgICAgIFZlcnNpb24gICA9PiAkVmVyc2lvbiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoKTsKICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5OYXZpZ2F0aW9uQmFyKCk7CiAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgICAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdBZG1pblBhY2thZ2VNYW5hZ2VyJywKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Gb290ZXIoKTsKICAgICAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICAgICAgfQoKICAgICAgICAjIHJlZGlyZWN0CiAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KCBPUCA9PiAiQWN0aW9uPSRTZWxmLT57QWN0aW9ufSIgKTsKICAgIH0KCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICAjIHVuaW5zdGFsbCBwYWNrYWdlCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBlbHNpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnVW5pbnN0YWxsJyApIHsKCiAgICAgICAgIyBjaGFsbGVuZ2UgdG9rZW4gY2hlY2sgZm9yIHdyaXRlIGFjdGlvbgogICAgICAgICRMYXlvdXRPYmplY3QtPkNoYWxsZW5nZVRva2VuQ2hlY2soKTsKCiAgICAgICAgbXkgJE5hbWUgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnTmFtZScgKSAgICB8fCAnJzsKICAgICAgICBteSAkVmVyc2lvbiA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdWZXJzaW9uJyApIHx8ICcnOwogICAgICAgIG15ICRJbnRyb1VuaW5zdGFsbFByZSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdJbnRyb1VuaW5zdGFsbFByZScgKQogICAgICAgICAgICB8fCAnJzsKCiAgICAgICAgIyBnZXQgcGFja2FnZQogICAgICAgIG15ICRQYWNrYWdlID0gJFBhY2thZ2VPYmplY3QtPlJlcG9zaXRvcnlHZXQoCiAgICAgICAgICAgIE5hbWUgICAgPT4gJE5hbWUsCiAgICAgICAgICAgIFZlcnNpb24gPT4gJFZlcnNpb24sCiAgICAgICAgICAgIFJlc3VsdCAgPT4gJ1NDQUxBUicsCiAgICAgICAgKTsKICAgICAgICBpZiAoICEkUGFja2FnZSApIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yU2NyZWVuKAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoJ05vIHN1Y2ggcGFja2FnZSEnKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgY2hlY2sgaWYgd2UgaGF2ZSB0byBzaG93IHVuaW5zdGFsbCBpbnRybyBwcmUKICAgICAgICBteSAlU3RydWN0dXJlID0gJFBhY2thZ2VPYmplY3QtPlBhY2thZ2VQYXJzZSgKICAgICAgICAgICAgU3RyaW5nID0+ICRQYWNrYWdlLAogICAgICAgICk7CgogICAgICAgICMgaW50cm8gc2NyZWVuCiAgICAgICAgbXkgJURhdGE7CiAgICAgICAgaWYgKCAkU3RydWN0dXJle0ludHJvVW5pbnN0YWxsfSApIHsKICAgICAgICAgICAgJURhdGEgPSAkU2VsZi0+X01lc3NhZ2VHZXQoCiAgICAgICAgICAgICAgICBJbmZvID0+ICRTdHJ1Y3R1cmV7SW50cm9Vbmluc3RhbGx9LAogICAgICAgICAgICAgICAgVHlwZSA9PiAncHJlJwogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBpZiAoICVEYXRhICYmICEkSW50cm9Vbmluc3RhbGxQcmUgKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnSW50cm8nLAogICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgICAgICVEYXRhLAogICAgICAgICAgICAgICAgICAgIFN1YmFjdGlvbiA9PiAkU2VsZi0+e1N1YmFjdGlvbn0sCiAgICAgICAgICAgICAgICAgICAgVHlwZSAgICAgID0+ICdJbnRyb1VuaW5zdGFsbFByZScsCiAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgID0+ICRTdHJ1Y3R1cmV7TmFtZX0tPntDb250ZW50fSwKICAgICAgICAgICAgICAgICAgICBWZXJzaW9uICAgPT4gJFN0cnVjdHVyZXtWZXJzaW9ufS0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdJbnRyb0NhbmNlbCcsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoKTsKICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5OYXZpZ2F0aW9uQmFyKCk7CiAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgICAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdBZG1pblBhY2thZ2VNYW5hZ2VyJywKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Gb290ZXIoKTsKICAgICAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICAgICAgfQoKICAgICAgICAjIHVuaW5zdGFsbCBzY3JlZW4KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdVbmluc3RhbGwnLAogICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgICAgIE5hbWUgICAgPT4gJFN0cnVjdHVyZXtOYW1lfS0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgICAgIFZlcnNpb24gPT4gJFN0cnVjdHVyZXtWZXJzaW9ufS0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgbXkgJE91dHB1dCA9ICRMYXlvdXRPYmplY3QtPkhlYWRlcigpOwogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5hdmlnYXRpb25CYXIoKTsKICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gJ0FkbWluUGFja2FnZU1hbmFnZXInLAogICAgICAgICAgICApOwogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigpOwogICAgICAgICAgICByZXR1cm4gJE91dHB1dDsKICAgICAgICB9CiAgICB9CgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgIyB1bmluc3RhbGwgYWN0aW9uIHBhY2thZ2UKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgIGVsc2lmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdVbmluc3RhbGxBY3Rpb24nICkgewoKICAgICAgICAjIGNoYWxsZW5nZSB0b2tlbiBjaGVjayBmb3Igd3JpdGUgYWN0aW9uCiAgICAgICAgJExheW91dE9iamVjdC0+Q2hhbGxlbmdlVG9rZW5DaGVjaygpOwoKICAgICAgICBteSAkTmFtZSAgICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdOYW1lJyApICAgIHx8ICcnOwogICAgICAgIG15ICRWZXJzaW9uID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1ZlcnNpb24nICkgfHwgJyc7CiAgICAgICAgbXkgJEludHJvVW5pbnN0YWxsUG9zdCA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdJbnRyb1VuaW5zdGFsbFBvc3QnICkKICAgICAgICAgICAgfHwgJyc7CgogICAgICAgICMgZ2V0IHBhY2thZ2UKICAgICAgICBteSAkUGFja2FnZSA9ICRQYWNrYWdlT2JqZWN0LT5SZXBvc2l0b3J5R2V0KAogICAgICAgICAgICBOYW1lICAgID0+ICROYW1lLAogICAgICAgICAgICBWZXJzaW9uID0+ICRWZXJzaW9uLAogICAgICAgICk7CiAgICAgICAgaWYgKCAhJFBhY2thZ2UgKSB7CiAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvclNjcmVlbigKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gVHJhbnNsYXRhYmxlKCdObyBzdWNoIHBhY2thZ2UhJyksCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIHBhcnNlIHBhY2thZ2UKICAgICAgICBteSAlU3RydWN0dXJlID0gJFBhY2thZ2VPYmplY3QtPlBhY2thZ2VQYXJzZSgKICAgICAgICAgICAgU3RyaW5nID0+ICRQYWNrYWdlLAogICAgICAgICk7CgogICAgICAgICMgdW5zaW5zdGFsbCB0aGUgcGFja2FnZQogICAgICAgIGlmICggISRQYWNrYWdlT2JqZWN0LT5QYWNrYWdlVW5pbnN0YWxsKCBTdHJpbmcgPT4gJFBhY2thZ2UgKSApIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yU2NyZWVuKCk7CiAgICAgICAgfQoKICAgICAgICAjIGludHJvIHNjcmVlbgogICAgICAgIG15ICVEYXRhOwogICAgICAgIGlmICggJFN0cnVjdHVyZXtJbnRyb1VuaW5zdGFsbH0gKSB7CiAgICAgICAgICAgICVEYXRhID0gJFNlbGYtPl9NZXNzYWdlR2V0KAogICAgICAgICAgICAgICAgSW5mbyA9PiAkU3RydWN0dXJle0ludHJvVW5pbnN0YWxsfSwKICAgICAgICAgICAgICAgIFR5cGUgPT4gJ3Bvc3QnCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGlmICggJURhdGEgJiYgISRJbnRyb1VuaW5zdGFsbFBvc3QgKSB7CiAgICAgICAgICAgIG15ICVEYXRhID0gJFNlbGYtPl9NZXNzYWdlR2V0KCBJbmZvID0+ICRTdHJ1Y3R1cmV7SW50cm9Vbmluc3RhbGxQb3N0fSApOwogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0ludHJvJywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICAgICAlRGF0YSwKICAgICAgICAgICAgICAgICAgICBTdWJhY3Rpb24gPT4gJycsCiAgICAgICAgICAgICAgICAgICAgVHlwZSAgICAgID0+ICdJbnRyb1VuaW5zdGFsbFBvc3QnLAogICAgICAgICAgICAgICAgICAgIE5hbWUgICAgICA9PiAkTmFtZSwKICAgICAgICAgICAgICAgICAgICBWZXJzaW9uICAgPT4gJFZlcnNpb24sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwogICAgICAgICAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+SGVhZGVyKCk7CiAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+TmF2aWdhdGlvbkJhcigpOwogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk91dHB1dCgKICAgICAgICAgICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQWRtaW5QYWNrYWdlTWFuYWdlcicsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCk7CiAgICAgICAgICAgIHJldHVybiAkT3V0cHV0OwogICAgICAgIH0KCiAgICAgICAgIyByZWRpcmVjdAogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCggT1AgPT4gIkFjdGlvbj0kU2VsZi0+e0FjdGlvbn0iICk7CiAgICB9CgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgIyBpbnN0YWxsIHBhY2thZ2UKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgIGVsc2lmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdJbnN0YWxsVXBsb2FkJyApIHsKCiAgICAgICAgIyBjaGFsbGVuZ2UgdG9rZW4gY2hlY2sgZm9yIHdyaXRlIGFjdGlvbgogICAgICAgICRMYXlvdXRPYmplY3QtPkNoYWxsZW5nZVRva2VuQ2hlY2soKTsKCiAgICAgICAgbXkgJEZvcm1JRCA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdGb3JtSUQnICkgfHwgJyc7CiAgICAgICAgbXkgJVVwbG9hZFN0dWZmID0gJFBhcmFtT2JqZWN0LT5HZXRVcGxvYWRBbGwoCiAgICAgICAgICAgIFBhcmFtID0+ICdGaWxlVXBsb2FkJywKICAgICAgICApOwoKICAgICAgICBteSAkVXBsb2FkQ2FjaGVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpVcGxvYWRDYWNoZScpOwoKICAgICAgICAjIHNhdmUgcGFja2FnZSBpbiB1cGxvYWQgY2FjaGUKICAgICAgICBpZiAoJVVwbG9hZFN0dWZmKSB7CiAgICAgICAgICAgIG15ICRBZGRlZCA9ICRVcGxvYWRDYWNoZU9iamVjdC0+Rm9ybUlEQWRkRmlsZSgKICAgICAgICAgICAgICAgIEZvcm1JRCA9PiAkRm9ybUlELAogICAgICAgICAgICAgICAgJVVwbG9hZFN0dWZmLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBpZiBmaWxlIGdvdCBub3QgYWRkZWQgdG8gc3RvcmFnZQogICAgICAgICAgICAjIChlLiBnLiBiZWNhdXNlIG9mIDEgTUIgbWF4X2FsbG93ZWRfcGFja2V0IE15U1FMIHByb2JsZW0pCiAgICAgICAgICAgIGlmICggISRBZGRlZCApIHsKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBnZXQgcGFja2FnZSBmcm9tIHVwbG9hZCBjYWNoZQogICAgICAgIGVsc2UgewogICAgICAgICAgICBteSBAQXR0YWNobWVudERhdGEgPSAkVXBsb2FkQ2FjaGVPYmplY3QtPkZvcm1JREdldEFsbEZpbGVzRGF0YSgKICAgICAgICAgICAgICAgIEZvcm1JRCA9PiAkRm9ybUlELAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoICFAQXR0YWNobWVudERhdGEgfHwgKCAkQXR0YWNobWVudERhdGFbMF0gJiYgISV7ICRBdHRhY2htZW50RGF0YVswXSB9ICkgKSB7CiAgICAgICAgICAgICAgICAkRXJyb3Jze0ZpbGVVcGxvYWRJbnZhbGlkfSA9ICdTZXJ2ZXJFcnJvcic7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAlVXBsb2FkU3R1ZmYgPSAleyAkQXR0YWNobWVudERhdGFbMF0gfTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoICElRXJyb3JzICkgewogICAgICAgICAgICBteSAkRmVlZGJhY2sgPSAkUGFja2FnZU9iamVjdC0+UGFja2FnZUlzSW5zdGFsbGVkKCBTdHJpbmcgPT4gJFVwbG9hZFN0dWZme0NvbnRlbnR9ICk7CgogICAgICAgICAgICBpZiAoJEZlZWRiYWNrKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJFNlbGYtPl9VcGdyYWRlSGFuZGxpbmcoCiAgICAgICAgICAgICAgICAgICAgUGFja2FnZSA9PiAkVXBsb2FkU3R1ZmZ7Q29udGVudH0sCiAgICAgICAgICAgICAgICAgICAgRm9ybUlEICA9PiAkRm9ybUlELAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJFNlbGYtPl9JbnN0YWxsSGFuZGxpbmcoCiAgICAgICAgICAgICAgICBQYWNrYWdlID0+ICRVcGxvYWRTdHVmZntDb250ZW50fSwKICAgICAgICAgICAgICAgIEZvcm1JRCAgPT4gJEZvcm1JRCwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgIyByZWJ1aWxkIHBhY2thZ2UKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgIGVsc2lmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdSZWJ1aWxkUGFja2FnZScgKSB7CgogICAgICAgICMgY2hhbGxlbmdlIHRva2VuIGNoZWNrIGZvciB3cml0ZSBhY3Rpb24KICAgICAgICAkTGF5b3V0T2JqZWN0LT5DaGFsbGVuZ2VUb2tlbkNoZWNrKCk7CgogICAgICAgIG15ICROYW1lICAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ05hbWUnICkgICAgfHwgJyc7CiAgICAgICAgbXkgJFZlcnNpb24gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnVmVyc2lvbicgKSB8fCAnJzsKCiAgICAgICAgIyBnZXQgcGFja2FnZQogICAgICAgIG15ICRQYWNrYWdlID0gJFBhY2thZ2VPYmplY3QtPlJlcG9zaXRvcnlHZXQoCiAgICAgICAgICAgIE5hbWUgICAgPT4gJE5hbWUsCiAgICAgICAgICAgIFZlcnNpb24gPT4gJFZlcnNpb24sCiAgICAgICAgICAgIFJlc3VsdCAgPT4gJ1NDQUxBUicsCiAgICAgICAgKTsKICAgICAgICBpZiAoICEkUGFja2FnZSApIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yU2NyZWVuKAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoJ05vIHN1Y2ggcGFja2FnZSEnKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgbXkgJVN0cnVjdHVyZSA9ICRQYWNrYWdlT2JqZWN0LT5QYWNrYWdlUGFyc2UoCiAgICAgICAgICAgIFN0cmluZyA9PiAkUGFja2FnZSwKICAgICAgICApOwogICAgICAgIG15ICRGaWxlID0gJFBhY2thZ2VPYmplY3QtPlBhY2thZ2VCdWlsZCglU3RydWN0dXJlKTsKICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+QXR0YWNobWVudCgKICAgICAgICAgICAgQ29udGVudCAgICAgPT4gJEZpbGUsCiAgICAgICAgICAgIENvbnRlbnRUeXBlID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICBGaWxlbmFtZSAgICA9PiAiJE5hbWUtJFZlcnNpb24tcmVidWlsZC5vcG0iLAogICAgICAgICAgICBUeXBlICAgICAgICA9PiAnYXR0YWNobWVudCcsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICAjIG92ZXJ2aWV3CiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBteSAlRnJvbnRlbmQ7CiAgICBteSAlTmVlZFJlaW5zdGFsbDsKICAgIG15ICVMaXN0OwogICAgbXkgJE91dHB1dE5vdGlmeSA9ICcnOwogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1BhY2thZ2U6OlJlcG9zaXRvcnlMaXN0JykgKSB7CiAgICAgICAgJUxpc3QgPSAleyAkQ29uZmlnT2JqZWN0LT5HZXQoJ1BhY2thZ2U6OlJlcG9zaXRvcnlMaXN0JykgfTsKICAgIH0KICAgIG15ICVSZXBvc2l0b3J5Um9vdDsKICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdQYWNrYWdlOjpSZXBvc2l0b3J5Um9vdCcpICkgewogICAgICAgICVSZXBvc2l0b3J5Um9vdCA9ICRQYWNrYWdlT2JqZWN0LT5QYWNrYWdlT25saW5lUmVwb3NpdG9yaWVzKCk7CiAgICB9CgogICAgIyBzaG93IGNsb3VkIHJlcG8gaWYgc3lzdGVtIGlzIHJlZ2lzdGVyZWQKICAgIG15ICRSZXBvc2l0b3J5Q2xvdWRMaXN0OwogICAgbXkgJFJlZ2lzdHJhdGlvblN0YXRlID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlN5c3RlbURhdGEnKS0+U3lzdGVtRGF0YUdldCgKICAgICAgICBLZXkgPT4gJ1JlZ2lzdHJhdGlvbjo6U3RhdGUnLAogICAgKSB8fCAnJzsKICAgIGlmICggJFJlZ2lzdHJhdGlvblN0YXRlIGVxICdyZWdpc3RlcmVkJyAmJiAhJFNlbGYtPntDbG91ZFNlcnZpY2VzRGlzYWJsZWR9ICkgewoKICAgICAgICAkUmVwb3NpdG9yeUNsb3VkTGlzdCA9CiAgICAgICAgICAgICRQYWNrYWdlT2JqZWN0LT5SZXBvc2l0b3J5Q2xvdWRMaXN0KCBOb0NhY2hlID0+IDEgKTsKICAgIH0KCiAgICAjIGluIGNhc2UgU291cmNlIGlzIHByZXNlbnQgb24gcmVwb3NpdG9yeSBjbG91ZCBsaXN0CiAgICAjIHRoZSBjYWxsIGZvciByZXRyaWV2aW5nIGRhdGEgYWJvdXQgaXQsIHNob3VsZCBiZSBwZXJmb3JtZWQKICAgICMgdXNpbmcgdGhlIENsb3VkU2VydmljZSBiYWNrZW5kCiAgICBteSAkRnJvbUNsb3VkID0gKCAkUmVwb3NpdG9yeUNsb3VkTGlzdC0+eyRTb3VyY2V9ID8gMSA6IDAgKTsKCiAgICAkRnJvbnRlbmR7U291cmNlTGlzdH0gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICBEYXRhICAgICAgICA9PiB7ICVMaXN0LCAlUmVwb3NpdG9yeVJvb3QsICV7JFJlcG9zaXRvcnlDbG91ZExpc3R9LCB9LAogICAgICAgIE5hbWUgICAgICAgID0+ICdTb3VyY2UnLAogICAgICAgIFRpdGxlICAgICAgID0+ICdSZXBvc2l0b3J5IExpc3QnLAogICAgICAgIE1heCAgICAgICAgID0+IDQwLAogICAgICAgIFRyYW5zbGF0aW9uID0+IDAsCiAgICAgICAgU2VsZWN0ZWRJRCAgPT4gJFNvdXJjZSwKICAgICAgICBDbGFzcyAgICAgICA9PiAiTW9kZXJuaXplIFcxMDBwYyIsCiAgICApOwogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnT3ZlcnZpZXcnLAogICAgICAgIERhdGEgPT4geyAlUGFyYW0sICVGcm9udGVuZCwgfSwKICAgICk7CiAgICBpZiAoJFNvdXJjZSkgewoKICAgICAgICBteSBATGlzdCA9ICRQYWNrYWdlT2JqZWN0LT5QYWNrYWdlT25saW5lTGlzdCgKICAgICAgICAgICAgVVJMICAgICAgID0+ICRTb3VyY2UsCiAgICAgICAgICAgIExhbmcgICAgICA9PiAkTGF5b3V0T2JqZWN0LT57VXNlckxhbmd1YWdlfSwKICAgICAgICAgICAgRnJvbUNsb3VkID0+ICRGcm9tQ2xvdWQsCiAgICAgICAgKTsKICAgICAgICBpZiAoICFATGlzdCApIHsKICAgICAgICAgICAgJE91dHB1dE5vdGlmeSAuPSAkTGF5b3V0T2JqZWN0LT5Ob3RpZnkoCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnRXJyb3InLAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoICEkT3V0cHV0Tm90aWZ5ICkgewogICAgICAgICAgICAgICAgJE91dHB1dE5vdGlmeSAuPSAkTGF5b3V0T2JqZWN0LT5Ob3RpZnkoCiAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ0luZm8nLAogICAgICAgICAgICAgICAgICAgIEluZm8gICAgID0+IFRyYW5zbGF0YWJsZSgnTm8gcGFja2FnZXMgb3Igbm8gbmV3IHBhY2thZ2VzIGZvdW5kIGluIHNlbGVjdGVkIHJlcG9zaXRvcnkuJyksCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnTm9EYXRhRm91bmRNc2cnLAogICAgICAgICAgICAgICAgRGF0YSA9PiB7fSwKICAgICAgICAgICAgKTsKCiAgICAgICAgfQoKICAgICAgICBmb3IgbXkgJERhdGEgKEBMaXN0KSB7CgogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1Nob3dSZW1vdGVQYWNrYWdlJywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICV7JERhdGF9LAogICAgICAgICAgICAgICAgICAgIFNvdXJjZSA9PiAkU291cmNlLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgc2hvdyBkb2N1bWVudGF0aW9uIGxpbmsKICAgICAgICAgICAgbXkgJURvY0ZpbGUgPSAkU2VsZi0+X0RvY3VtZW50YXRpb25HZXQoIEZpbGVsaXN0ID0+ICREYXRhLT57RmlsZWxpc3R9ICk7CiAgICAgICAgICAgIGlmICglRG9jRmlsZSkgewogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnU2hvd1JlbW90ZVBhY2thZ2VEb2N1bWVudGF0aW9uJywKICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgJXskRGF0YX0sCiAgICAgICAgICAgICAgICAgICAgICAgIFNvdXJjZSA9PiAkU291cmNlLAogICAgICAgICAgICAgICAgICAgICAgICAlRG9jRmlsZSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCAkRGF0YS0+e1VwZ3JhZGV9ICkgewogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnU2hvd1JlbW90ZVBhY2thZ2VVcGdyYWRlJywKICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgJXskRGF0YX0sCiAgICAgICAgICAgICAgICAgICAgICAgIFNvdXJjZSA9PiAkU291cmNlLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2lmICggISREYXRhLT57SW5zdGFsbGVkfSApIHsKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1Nob3dSZW1vdGVQYWNrYWdlSW5zdGFsbCcsCiAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICV7JERhdGF9LAogICAgICAgICAgICAgICAgICAgICAgICBTb3VyY2UgPT4gJFNvdXJjZSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAjIGlmIHRoZXJlIGFyZSBubyByZW1vdGUgcGFja2FnZXMgdG8gc2hvdywgYSBtc2cgaXMgZGlzcGxheWVkCiAgICBlbHNlIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnTm9EYXRhRm91bmRNc2cnLAogICAgICAgICAgICBEYXRhID0+IHt9LAogICAgICAgICk7CiAgICB9CgogICAgbXkgQFJlcG9zaXRvcnlMaXN0ID0gJFBhY2thZ2VPYmplY3QtPlJlcG9zaXRvcnlMaXN0KCk7CgogICAgIyByZW1vdmUgbm90IHZpc2libGUgcGFja2FnZXMKICAgIEBSZXBvc2l0b3J5TGlzdCA9IG1hcCB7CiAgICAgICAgKAogICAgICAgICAgICAhZGVmaW5lZCAkXy0+e1BhY2thZ2VJc1Zpc2libGV9CiAgICAgICAgICAgICAgICB8fCAoICRfLT57UGFja2FnZUlzVmlzaWJsZX0tPntDb250ZW50fSAmJiAkXy0+e1BhY2thZ2VJc1Zpc2libGV9LT57Q29udGVudH0gZXEgJzEnICkKICAgICAgICAgICAgKQogICAgICAgICAgICA/ICRfCiAgICAgICAgICAgIDogKCkKICAgIH0gQFJlcG9zaXRvcnlMaXN0OwoKICAgICMgaWYgdGhlcmUgYXJlIG5vIGxvY2FsIHBhY2thZ2VzIHRvIHNob3csIGEgbXNnIGlzIGRpc3BsYXllZAogICAgaWYgKCAhQFJlcG9zaXRvcnlMaXN0ICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdOb0RhdGFGb3VuZE1zZzInLAogICAgICAgICk7CiAgICB9CgogICAgIyBLSVhDb3JlLWNhcGVJVAogICAgIyAjIHZlcmlmeSBwYWNrYWdlcyBpZiB3ZSBoYXZlIHNvbWUKICAgICMgbXkgJVZlcmlmaWNhdGlvbkRhdGE7CiAgICAjIGlmIChAUmVwb3NpdG9yeUxpc3QpIHsKICAgICMgICAgICVWZXJpZmljYXRpb25EYXRhID0gJFBhY2thZ2VPYmplY3QtPlBhY2thZ2VWZXJpZnlBbGwoKTsKICAgIG15ICVWZXJpZmljYXRpb25EYXRhOwogICAgaWYgKCRDb25maWd1cmVDYWxsSG9tZSkgewogICAgICAgIGlmIChAUmVwb3NpdG9yeUxpc3QpIHsKICAgICAgICAgICAgJVZlcmlmaWNhdGlvbkRhdGEgPSAkUGFja2FnZU9iamVjdC0+UGFja2FnZVZlcmlmeUFsbCgpOwogICAgICAgIH0KICAgIH0KCiAgICAjIEVPIEtJWENvcmUtY2FwZUlUCgogICAgbXkgJU5vdFZlcmlmaWVkUGFja2FnZXM7CiAgICBteSAlVW5rbm93blZlcmZpY2F0aW9uUGFja2FnZXM7CgogICAgZm9yIG15ICRQYWNrYWdlIChAUmVwb3NpdG9yeUxpc3QpIHsKCiAgICAgICAgbXkgJURhdGEgPSAkU2VsZi0+X01lc3NhZ2VHZXQoIEluZm8gPT4gJFBhY2thZ2UtPntEZXNjcmlwdGlvbn0gKTsKCiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1Nob3dMb2NhbFBhY2thZ2UnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICV7JFBhY2thZ2V9LAogICAgICAgICAgICAgICAgJURhdGEsCiAgICAgICAgICAgICAgICBOYW1lICAgID0+ICRQYWNrYWdlLT57TmFtZX0tPntDb250ZW50fSwKICAgICAgICAgICAgICAgIFZlcnNpb24gPT4gJFBhY2thZ2UtPntWZXJzaW9ufS0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgVmVuZG9yICA9PiAkUGFja2FnZS0+e1ZlbmRvcn0tPntDb250ZW50fSwKICAgICAgICAgICAgICAgIFVSTCAgICAgPT4gJFBhY2thZ2UtPntVUkx9LT57Q29udGVudH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKCiAgICAgICAgaWYgKAogICAgICAgICAgICAkVmVyaWZpY2F0aW9uRGF0YXsgJFBhY2thZ2UtPntOYW1lfS0+e0NvbnRlbnR9IH0KICAgICAgICAgICAgJiYgJFZlcmlmaWNhdGlvbkRhdGF7ICRQYWNrYWdlLT57TmFtZX0tPntDb250ZW50fSB9IGVxICd2ZXJpZmllZCcKICAgICAgICAgICAgJiYgISRTZWxmLT57Q2xvdWRTZXJ2aWNlc0Rpc2FibGVkfQogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1Nob3dMb2NhbFBhY2thZ2VWZXJpZnlMb2dvJywKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgc2hvdyBkb2N1bWVudGF0aW9uIGxpbmsKICAgICAgICBteSAlRG9jRmlsZSA9ICRTZWxmLT5fRG9jdW1lbnRhdGlvbkdldCggRmlsZWxpc3QgPT4gJFBhY2thZ2UtPntGaWxlbGlzdH0gKTsKICAgICAgICBpZiAoJURvY0ZpbGUpIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdTaG93TG9jYWxQYWNrYWdlRG9jdW1lbnRhdGlvbicsCiAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICBOYW1lICAgID0+ICRQYWNrYWdlLT57TmFtZX0tPntDb250ZW50fSwKICAgICAgICAgICAgICAgICAgICBWZXJzaW9uID0+ICRQYWNrYWdlLT57VmVyc2lvbn0tPntDb250ZW50fSwKICAgICAgICAgICAgICAgICAgICAlRG9jRmlsZSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBpZiAoICRQYWNrYWdlLT57U3RhdHVzfSBlcSAnaW5zdGFsbGVkJyApIHsKCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICFkZWZpbmVkICRQYWNrYWdlLT57UGFja2FnZUlzUmVtb3ZhYmxlfQogICAgICAgICAgICAgICAgfHwgKAogICAgICAgICAgICAgICAgICAgIGRlZmluZWQgJFBhY2thZ2UtPntQYWNrYWdlSXNSZW1vdmFibGV9LT57Q29udGVudH0KICAgICAgICAgICAgICAgICAgICAmJiAkUGFja2FnZS0+e1BhY2thZ2VJc1JlbW92YWJsZX0tPntDb250ZW50fSBlcSAnMScKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewoKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1Nob3dMb2NhbFBhY2thZ2VVbmluc3RhbGwnLAogICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAleyRQYWNrYWdlfSwKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSAgICA9PiAkUGFja2FnZS0+e05hbWV9LT57Q29udGVudH0sCiAgICAgICAgICAgICAgICAgICAgICAgIFZlcnNpb24gPT4gJFBhY2thZ2UtPntWZXJzaW9ufS0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgICAgICAgICBWZW5kb3IgID0+ICRQYWNrYWdlLT57VmVuZG9yfS0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgICAgICAgICBVUkwgICAgID0+ICRQYWNrYWdlLT57VVJMfS0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAhJFBhY2thZ2VPYmplY3QtPkRlcGxveUNoZWNrKAogICAgICAgICAgICAgICAgICAgIE5hbWUgICAgPT4gJFBhY2thZ2UtPntOYW1lfS0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgICAgIFZlcnNpb24gPT4gJFBhY2thZ2UtPntWZXJzaW9ufS0+e0NvbnRlbnR9CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICROZWVkUmVpbnN0YWxseyAkUGFja2FnZS0+e05hbWV9LT57Q29udGVudH0gfSA9ICRQYWNrYWdlLT57VmVyc2lvbn0tPntDb250ZW50fTsKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1Nob3dMb2NhbFBhY2thZ2VSZWluc3RhbGwnLAogICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAleyRQYWNrYWdlfSwKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSAgICA9PiAkUGFja2FnZS0+e05hbWV9LT57Q29udGVudH0sCiAgICAgICAgICAgICAgICAgICAgICAgIFZlcnNpb24gPT4gJFBhY2thZ2UtPntWZXJzaW9ufS0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgICAgICAgICBWZW5kb3IgID0+ICRQYWNrYWdlLT57VmVuZG9yfS0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgICAgICAgICBVUkwgICAgID0+ICRQYWNrYWdlLT57VVJMfS0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1Nob3dMb2NhbFBhY2thZ2VJbnN0YWxsJywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICV7JFBhY2thZ2V9LAogICAgICAgICAgICAgICAgICAgIE5hbWUgICAgPT4gJFBhY2thZ2UtPntOYW1lfS0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgICAgIFZlcnNpb24gPT4gJFBhY2thZ2UtPntWZXJzaW9ufS0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgICAgIFZlbmRvciAgPT4gJFBhY2thZ2UtPntWZW5kb3J9LT57Q29udGVudH0sCiAgICAgICAgICAgICAgICAgICAgVVJMICAgICA9PiAkUGFja2FnZS0+e1VSTH0tPntDb250ZW50fSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBpZiAoCiAgICAgICAgICAgICRWZXJpZmljYXRpb25EYXRheyAkUGFja2FnZS0+e05hbWV9LT57Q29udGVudH0gfQogICAgICAgICAgICAmJiAkVmVyaWZpY2F0aW9uRGF0YXsgJFBhY2thZ2UtPntOYW1lfS0+e0NvbnRlbnR9IH0gZXEgJ25vdF92ZXJpZmllZCcKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgJE5vdFZlcmlmaWVkUGFja2FnZXN7ICRQYWNrYWdlLT57TmFtZX0tPntDb250ZW50fSB9ID0gJFBhY2thZ2UtPntWZXJzaW9ufS0+e0NvbnRlbnR9OwogICAgICAgIH0KICAgICAgICBlbHNpZiAoCiAgICAgICAgICAgICRWZXJpZmljYXRpb25EYXRheyAkUGFja2FnZS0+e05hbWV9LT57Q29udGVudH0gfQogICAgICAgICAgICAmJiAkVmVyaWZpY2F0aW9uRGF0YXsgJFBhY2thZ2UtPntOYW1lfS0+e0NvbnRlbnR9IH0gZXEgJ3Vua25vd24nCiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgICRVbmtub3duVmVyZmljYXRpb25QYWNrYWdlc3sgJFBhY2thZ2UtPntOYW1lfS0+e0NvbnRlbnR9IH0gPSAkUGFja2FnZS0+e1ZlcnNpb259LT57Q29udGVudH07CiAgICAgICAgfQoKICAgIH0KCiAgICAjIHNob3cgZmlsZSB1cGxvYWQKICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdQYWNrYWdlOjpGaWxlVXBsb2FkJykgKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ092ZXJ2aWV3RmlsZVVwbG9hZCcsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgRm9ybUlEID0+ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlVwbG9hZENhY2hlJyktPkZvcm1JRENyZWF0ZSgpLAogICAgICAgICAgICAgICAgJUVycm9ycywKICAgICAgICAgICAgfSwKICAgICAgICApOwoKICAgICAgICAjIGNoZWNrIGlmIHdlJ3JlIG9uIE15U1FMIGFuZCBzaG93IGEgbWF4X2FsbG93ZWRfcGFja2V0IG5vdGljZQogICAgICAgICMgaWYgdGhlIGFjdHVhbCB2YWx1ZSBmb3IgdGhpcyBzZXR0aW5nIGlzIHRvbyBsb3cKICAgICAgICBpZiAoICREQk9iamVjdC0+eydEQjo6VHlwZSd9IGVxICdteXNxbCcgKSB7CgogICAgICAgICAgICAjIGNoZWNrIHRoZSBhY3R1YWwgc2V0dGluZwogICAgICAgICAgICAkREJPYmplY3QtPlByZXBhcmUoCiAgICAgICAgICAgICAgICBTUUwgPT4gIlNIT1cgdmFyaWFibGVzIFdIRVJFIFZhcmlhYmxlX25hbWUgPSAnbWF4X2FsbG93ZWRfcGFja2V0JyIsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBteSAkTWF4QWxsb3dlZFBhY2tldCAgICAgICAgICAgID0gMDsKICAgICAgICAgICAgbXkgJE1heEFsbG93ZWRQYWNrZXRSZWNvbW1lbmRlZCA9IDIwOwogICAgICAgICAgICB3aGlsZSAoIG15IEBEYXRhID0gJERCT2JqZWN0LT5GZXRjaHJvd0FycmF5KCkgKSB7CiAgICAgICAgICAgICAgICBpZiAoICREYXRhWzFdICkgewogICAgICAgICAgICAgICAgICAgICRNYXhBbGxvd2VkUGFja2V0ID0gJERhdGFbMV0gLyAxMDI0IC8gMTAyNDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCAkTWF4QWxsb3dlZFBhY2tldCA8ICRNYXhBbGxvd2VkUGFja2V0UmVjb21tZW5kZWQgKSB7CiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdEYXRhYmFzZVBhY2thZ2VTaXplV2FybmluZycsCiAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIE1heEFsbG93ZWRQYWNrZXQgICAgICAgICAgICA9PiAkTWF4QWxsb3dlZFBhY2tldCwKICAgICAgICAgICAgICAgICAgICAgICAgTWF4QWxsb3dlZFBhY2tldFJlY29tbWVuZGVkID0+ICRNYXhBbGxvd2VkUGFja2V0UmVjb21tZW5kZWQsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBGZWF0dXJlQWRkb25zCiAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnUGFja2FnZTo6U2hvd0ZlYXR1cmVBZGRvbnMnKSApIHsKCiAgICAgICAgbXkgJEZlYXR1cmVBZGRvbkRhdGE7CiAgICAgICAgaWYgKCAhJFNlbGYtPntDbG91ZFNlcnZpY2VzRGlzYWJsZWR9ICkgewogICAgICAgICAgICAkRmVhdHVyZUFkZG9uRGF0YSA9ICRTZWxmLT5fR2V0RmVhdHVyZUFkZG9uRGF0YSgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCByZWYgJEZlYXR1cmVBZGRvbkRhdGEgZXEgJ0FSUkFZJyAmJiBzY2FsYXIgQHskRmVhdHVyZUFkZG9uRGF0YX0gPiAwICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0ZlYXR1cmVBZGRvbkxpc3QnLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgZm9yIG15ICRJdGVtICggQHskRmVhdHVyZUFkZG9uRGF0YX0gKSB7CiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdGZWF0dXJlQWRkb25EYXRhJywKICAgICAgICAgICAgICAgICAgICBEYXRhID0+ICRJdGVtLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBpZiAoICRTZWxmLT57Q2xvdWRTZXJ2aWNlc0Rpc2FibGVkfSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnQ2xvdWRTZXJ2aWNlc1dhcm5pbmcnLAogICAgICAgICk7CiAgICB9CgogICAgbXkgJE91dHB1dCA9ICRMYXlvdXRPYmplY3QtPkhlYWRlcigpOwogICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5OYXZpZ2F0aW9uQmFyKCk7CiAgICAkT3V0cHV0IC49ICRPdXRwdXROb3RpZnk7CiAgICBmb3IgbXkgJFJlaW5zdGFsbEtleSAoIHNvcnQga2V5cyAlTmVlZFJlaW5zdGFsbCApIHsKCiAgICAgICAgbXkgJFByaW9yaXR5ID0gJ0Vycm9yJzsKICAgICAgICBteSAkTWVzc2FnZSAgPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9CiAgICAgICAgICAgIC0+VHJhbnNsYXRlKCJQYWNrYWdlIG5vdCBjb3JyZWN0bHkgZGVwbG95ZWQhIFBsZWFzZSByZWluc3RhbGwgdGhlIHBhY2thZ2UuIik7CiAgICAgICAgaWYgKCAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ1BhY2thZ2U6OkFsbG93TG9jYWxNb2RpZmljYXRpb25zJykgKSB7CiAgICAgICAgICAgICRQcmlvcml0eSA9ICdOb3RpY2UnOwogICAgICAgICAgICAkTWVzc2FnZSAgPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoIlBhY2thZ2UgaGFzIGxvY2FsbHkgbW9kaWZpZWQgZmlsZXMuIik7CiAgICAgICAgfQoKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5vdGlmeSgKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJFByaW9yaXR5LAogICAgICAgICAgICBEYXRhICAgICA9PiAiJFJlaW5zdGFsbEtleSAkTmVlZFJlaW5zdGFsbHskUmVpbnN0YWxsS2V5fSAtICRNZXNzYWdlIiwKICAgICAgICAgICAgTGluayAgICAgPT4gJExheW91dE9iamVjdC0+e0Jhc2VsaW5rfQogICAgICAgICAgICAgICAgLiAnQWN0aW9uPUFkbWluUGFja2FnZU1hbmFnZXI7U3ViYWN0aW9uPVZpZXc7TmFtZT0nCiAgICAgICAgICAgICAgICAuICRSZWluc3RhbGxLZXkKICAgICAgICAgICAgICAgIC4gJztWZXJzaW9uPScKICAgICAgICAgICAgICAgIC4gJE5lZWRSZWluc3RhbGx7JFJlaW5zdGFsbEtleX0sCiAgICAgICAgKTsKICAgIH0KCiAgICBWRVJJRklDQVRJT046CiAgICBmb3IgbXkgJFBhY2thZ2UgKCBzb3J0IGtleXMgJU5vdFZlcmlmaWVkUGFja2FnZXMgKSB7CgogICAgICAgIG5leHQgVkVSSUZJQ0FUSU9OIGlmICEkUGFja2FnZTsKICAgICAgICBuZXh0IFZFUklGSUNBVElPTiBpZiAhJE5vdFZlcmlmaWVkUGFja2FnZXN7JFBhY2thZ2V9OwoKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5vdGlmeSgKCiMgS0lYQ29yZS1jYXBlSVQKIyBQcmlvcml0eSA9PiAnRXJyb3InLAojIERhdGEgICAgID0+ICIkUGFja2FnZSAkTm90VmVyaWZpZWRQYWNrYWdlc3skUGFja2FnZX0gLSAiCiMgICAgIC4gJyRUZXh0eyJQYWNrYWdlIG5vdCB2ZXJpZmllZCBieSB0aGUgT1RSUyBHcm91cCEgSXQgaXMgcmVjb21tZW5kZWQgbm90IHRvIHVzZSB0aGlzIHBhY2thZ2UuIn0nLAogICAgICAgICAgICBQcmlvcml0eSA9PiAnSW5mb3JtYXRpb24nLAogICAgICAgICAgICBEYXRhICAgICA9PiAiJFBhY2thZ2UgJE5vdFZlcmlmaWVkUGFja2FnZXN7JFBhY2thZ2V9IC0gIgogICAgICAgICAgICAgICAgLiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoIlRoaXMgcGFja2FnZSBpcyBub3QgY2VydGlmaWVkIGJ5IE9UUlMgR3JvdXAsIHdoaWNoIGRvZXMgbm90IG1lYW4gaXQgaXMgb2YgaW5mZXJpb3IgcXVhbGl0eSB0aGFuIHByb2R1Y3RzIG9mIHRoZSBPVFJTIEdyb3VwLiIpLAoKICAgICAgICAgICAgIyBFTyBLSVhDb3JlLWNhcGVJVAogICAgICAgICk7CiAgICB9CgogICAgaWYgKCAhJFNlbGYtPntDbG91ZFNlcnZpY2VzRGlzYWJsZWR9ICkgewoKICAgICAgICBWRVJJRklDQVRJT046CiAgICAgICAgZm9yIG15ICRQYWNrYWdlICggc29ydCBrZXlzICVVbmtub3duVmVyZmljYXRpb25QYWNrYWdlcyApIHsKCiAgICAgICAgICAgIG5leHQgVkVSSUZJQ0FUSU9OIGlmICEkUGFja2FnZTsKICAgICAgICAgICAgbmV4dCBWRVJJRklDQVRJT04gaWYgISRVbmtub3duVmVyZmljYXRpb25QYWNrYWdlc3skUGFja2FnZX07CgogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5vdGlmeSgKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdFcnJvcicsCiAgICAgICAgICAgICAgICBEYXRhICAgICA9PiAiJFBhY2thZ2UgJFVua25vd25WZXJmaWNhdGlvblBhY2thZ2VzeyRQYWNrYWdlfSAtICIKICAgICAgICAgICAgICAgICAgICAuICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICAgICAiUGFja2FnZSBub3QgdmVyaWZpZWQgZHVlIGEgY29tbXVuaWNhdGlvbiBpc3N1ZSB3aXRoIHZlcmlmaWNhdGlvbiBzZXJ2ZXIhIgogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQWRtaW5QYWNrYWdlTWFuYWdlcicsCiAgICApOwogICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Gb290ZXIoKTsKICAgIHJldHVybiAkT3V0cHV0Owp9CgpzdWIgX01lc3NhZ2VHZXQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkVGl0bGUgICAgICAgPSAnJzsKICAgIG15ICREZXNjcmlwdGlvbiA9ICcnOwogICAgbXkgJFVzZSAgICAgICAgID0gMDsKCiAgICBteSAkTGFuZ3VhZ2UgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JyktPntVc2VyTGFuZ3VhZ2V9CiAgICAgICAgfHwgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdEZWZhdWx0TGFuZ3VhZ2UnKTsKCiAgICBpZiAoICRQYXJhbXtJbmZvfSApIHsKICAgICAgICBUQUc6CiAgICAgICAgZm9yIG15ICRUYWcgKCBAeyAkUGFyYW17SW5mb30gfSApIHsKICAgICAgICAgICAgaWYgKCAkUGFyYW17VHlwZX0gKSB7CiAgICAgICAgICAgICAgICBuZXh0IFRBRyBpZiAkVGFnLT57VHlwZX0gIX4gL14kUGFyYW17VHlwZX0vaTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkVXNlID0gMTsKICAgICAgICAgICAgaWYgKCAkVGFnLT57Rm9ybWF0fSAmJiAkVGFnLT57Rm9ybWF0fSA9fiAvcGxhaW4vaSApIHsKICAgICAgICAgICAgICAgICRUYWctPntDb250ZW50fSA9ICc8cHJlIGNsYXNzPSJjb250ZW50Ym9keSI+JyAuICRUYWctPntDb250ZW50fSAuICc8L3ByZT4nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggISREZXNjcmlwdGlvbiAmJiAkVGFnLT57TGFuZ30gZXEgJ2VuJyApIHsKICAgICAgICAgICAgICAgICREZXNjcmlwdGlvbiA9ICRUYWctPntDb250ZW50fTsKICAgICAgICAgICAgICAgICRUaXRsZSAgICAgICA9ICRUYWctPntUaXRsZX07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICggJFRhZy0+e0xhbmd9IGVxICRMYW5ndWFnZSApIHsKICAgICAgICAgICAgICAgICREZXNjcmlwdGlvbiA9ICRUYWctPntDb250ZW50fTsKICAgICAgICAgICAgICAgICRUaXRsZSAgICAgICA9ICRUYWctPntUaXRsZX07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCAhJERlc2NyaXB0aW9uICYmICRVc2UgKSB7CiAgICAgICAgICAgIGZvciBteSAkVGFnICggQHsgJFBhcmFte0luZm99IH0gKSB7CiAgICAgICAgICAgICAgICBpZiAoICEkRGVzY3JpcHRpb24gKSB7CiAgICAgICAgICAgICAgICAgICAgJERlc2NyaXB0aW9uID0gJFRhZy0+e0NvbnRlbnR9OwogICAgICAgICAgICAgICAgICAgICRUaXRsZSAgICAgICA9ICRUYWctPntUaXRsZX07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gaWYgISREZXNjcmlwdGlvbiAmJiAhJFRpdGxlOwogICAgcmV0dXJuICgKICAgICAgICBEZXNjcmlwdGlvbiA9PiAkRGVzY3JpcHRpb24sCiAgICAgICAgVGl0bGUgICAgICAgPT4gJFRpdGxlLAogICAgKTsKfQoKc3ViIF9Eb2N1bWVudGF0aW9uR2V0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgcmV0dXJuIGlmICEkUGFyYW17RmlsZWxpc3R9OwogICAgcmV0dXJuIGlmIHJlZiAkUGFyYW17RmlsZWxpc3R9IG5lICdBUlJBWSc7CgogICAgIyBmaW5kIHRoZSBjb3JyZWN0IHVzZXIgbGFuZ3VhZ2UgZG9jdW1lbnRhdGlvbiBmaWxlCiAgICBteSAkRG9jdW1lbnRhdGlvbkZpbGVVc2VyTGFuZ3VhZ2U7CgogICAgIyBmaW5kIHRoZSBjb3JyZWN0IGRlZmF1bHQgbGFuZ3VhZ2UgZG9jdW1lbnRhdGlvbiBmaWxlCiAgICBteSAkRG9jdW1lbnRhdGlvbkZpbGVEZWZhdWx0TGFuZ3VhZ2U7CgogICAgIyBmaW5kIHRoZSBjb3JyZWN0IGVuIGRvY3VtZW50YXRpb24gZmlsZQogICAgbXkgJERvY3VtZW50YXRpb25GaWxlOwoKICAgICMgcmVtZW1iZXIgZmFsbGJhY2sgZmlsZQogICAgbXkgJERvY3VtZW50YXRpb25GaWxlRmFsbGJhY2s7CgogICAgIyBnZXQgZGVmYXVsdCBsYW5ndWFnZQogICAgbXkgJERlZmF1bHRMYW5ndWFnZSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnRGVmYXVsdExhbmd1YWdlJyk7CgogICAgIyBmaW5kIGRvY3VtZW50YXRpb24gZmlsZXMKICAgIEZJTEU6CiAgICBmb3IgbXkgJEZpbGUgKCBAeyAkUGFyYW17RmlsZWxpc3R9IH0gKSB7CgogICAgICAgIG5leHQgRklMRSBpZiAhJEZpbGU7CiAgICAgICAgbmV4dCBGSUxFIGlmICEkRmlsZS0+e0xvY2F0aW9ufTsKCiAgICAgICAgbXkgKCAkRGlyLCAkRmlsZW5hbWUgKSA9ICRGaWxlLT57TG9jYXRpb259ID1+IG17IFxBIGRvYy8gKCAuKyApIC8gKCAuKz8gLnBkZiApIH14bXNpOwoKICAgICAgICBuZXh0IEZJTEUgaWYgISREaXI7CiAgICAgICAgbmV4dCBGSUxFIGlmICEkRmlsZW5hbWU7CgogICAgICAgICMgdGFrZSB1c2VyIGxhbmd1YWdlIGZpcnN0CiAgICAgICAgaWYgKCAkRGlyIGVxICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKS0+e1VzZXJMYW5ndWFnZX0gKSB7CiAgICAgICAgICAgICREb2N1bWVudGF0aW9uRmlsZVVzZXJMYW5ndWFnZSA9ICRGaWxlLT57TG9jYXRpb259OwogICAgICAgIH0KCiAgICAgICAgIyB0YWtlIGRlZmF1bHQgbGFuZ3VhZ2UgbmV4dAogICAgICAgIGVsc2lmICggJERpciBlcSAkRGVmYXVsdExhbmd1YWdlICkgewogICAgICAgICAgICAkRG9jdW1lbnRhdGlvbkZpbGVEZWZhdWx0TGFuZ3VhZ2UgPSAkRmlsZS0+e0xvY2F0aW9ufTsKICAgICAgICB9CgogICAgICAgICMgdGFrZSBlbiBsYW5ndWFnZSBuZXh0CiAgICAgICAgZWxzaWYgKCAkRGlyIGVxICdlbicgJiYgISREb2N1bWVudGF0aW9uRmlsZSApIHsKICAgICAgICAgICAgJERvY3VtZW50YXRpb25GaWxlID0gJEZpbGUtPntMb2NhdGlvbn07CiAgICAgICAgfQoKICAgICAgICAjIHJlbWVtYmVyIGZhbGxiYWNrIGZpbGUKICAgICAgICAkRG9jdW1lbnRhdGlvbkZpbGVGYWxsYmFjayA9ICRGaWxlLT57TG9jYXRpb259OwogICAgfQoKICAgICMgc2V0IGZhbGxiYWNrIGZpbGUgKGlmIGV4aXN0cykgYXMgZG9jdW1lbnRhdGlvbiBmaWxlCiAgICBteSAlRG9jOwogICAgaWYgKCREb2N1bWVudGF0aW9uRmlsZVVzZXJMYW5ndWFnZSkgewogICAgICAgICREb2N7TG9jYXRpb259ID0gJERvY3VtZW50YXRpb25GaWxlVXNlckxhbmd1YWdlOwogICAgfQogICAgZWxzaWYgKCREb2N1bWVudGF0aW9uRmlsZURlZmF1bHRMYW5ndWFnZSkgewogICAgICAgICREb2N7TG9jYXRpb259ID0gJERvY3VtZW50YXRpb25GaWxlRGVmYXVsdExhbmd1YWdlOwogICAgfQogICAgZWxzaWYgKCREb2N1bWVudGF0aW9uRmlsZSkgewogICAgICAgICREb2N7TG9jYXRpb259ID0gJERvY3VtZW50YXRpb25GaWxlOwogICAgfQogICAgZWxzaWYgKCREb2N1bWVudGF0aW9uRmlsZUZhbGxiYWNrKSB7CiAgICAgICAgJERvY3tMb2NhdGlvbn0gPSAkRG9jdW1lbnRhdGlvbkZpbGVGYWxsYmFjazsKICAgIH0KICAgIHJldHVybiAlRG9jOwp9CgpzdWIgX0luc3RhbGxIYW5kbGluZyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgIyBjaGVjayBuZWVkZWQgcGFyYW1zCiAgICBpZiAoICEkUGFyYW17UGFja2FnZX0gKSB7CiAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yU2NyZWVuKAogICAgICAgICAgICBNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgnTm8gc3VjaCBwYWNrYWdlIScpLAogICAgICAgICk7CiAgICB9CgogICAgbXkgJFBhcmFtT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpOwoKICAgICMgcmVkaXJlY3QgYWZ0ZXIgZmluaXNoaW5nIGluc3RhbGxhdGlvbgogICAgaWYgKCAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnSW50cm9JbnN0YWxsUG9zdCcgKSApIHsKICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+UmVkaXJlY3QoIE9QID0+ICJBY3Rpb249JFNlbGYtPntBY3Rpb259IiApOwogICAgfQoKICAgIG15ICRJbnRyb0luc3RhbGxQcmUgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnSW50cm9JbnN0YWxsUHJlJyApICAgIHx8ICcnOwogICAgbXkgJEludHJvSW5zdGFsbFZlbmRvciA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdJbnRyb0luc3RhbGxWZW5kb3InICkgfHwgJyc7CgogICAgbXkgJFBhY2thZ2VPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6UGFja2FnZScpOwoKICAgICMgcGFyc2UgcGFja2FnZQogICAgbXkgJVN0cnVjdHVyZSA9ICRQYWNrYWdlT2JqZWN0LT5QYWNrYWdlUGFyc2UoIFN0cmluZyA9PiAkUGFyYW17UGFja2FnZX0gKTsKCiAgICAjIEtJWENvcmUtY2FwZUlUCiAgICAjICMgb25saW5lIHZlcmlmaWNhdGlvbgogICAgIyBteSAkVmVyaWZpZWQgPSAkUGFja2FnZU9iamVjdC0+UGFja2FnZVZlcmlmeSgKICAgICMgICAgIFBhY2thZ2UgICA9PiAkUGFyYW17UGFja2FnZX0sCiAgICAjICAgICBTdHJ1Y3R1cmUgPT4gXCVTdHJ1Y3R1cmUsCiAgICAjICkgfHwgJ3ZlcmlmaWVkJzsKICAgICMgbXkgJVZlcmlmeUluZm8gPSAkUGFja2FnZU9iamVjdC0+UGFja2FnZVZlcmlmeUluZm8oKTsKICAgICMgIyB0cmFuc2xhdGUgZGVzY3JpcHRpb24KICAgICMgaWYgKCAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9ICkgewogICAgIyAgICAgJFZlcmlmeUluZm97RGVzY3JpcHRpb259ID0gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+R2V0KAogICAgIyAgICAgICAgICRWZXJpZnlJbmZve0Rlc2NyaXB0aW9ufQogICAgIyAgICAgKTsKICAgICMgfQogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CiAgICBteSAkQ29uZmlndXJlQ2FsbEhvbWUKICAgICAgICA9ICRDb25maWdPYmplY3QtPkdldCgnUGFja2FnZTo6Q29uZmlndXJlQ2FsbEhvbWVWZXJpZmljYXRpb25QYXRoJyk7CiAgICBteSAkVmVyaWZpZWQgPSAnJzsKICAgIG15ICVWZXJpZnlJbmZvOwogICAgaWYgKCRDb25maWd1cmVDYWxsSG9tZSkgewogICAgICAgICRWZXJpZmllZCA9ICRQYWNrYWdlT2JqZWN0LT5QYWNrYWdlVmVyaWZ5KAogICAgICAgICAgICBQYWNrYWdlICAgPT4gJFBhcmFte1BhY2thZ2V9LAogICAgICAgICAgICBTdHJ1Y3R1cmUgPT4gXCVTdHJ1Y3R1cmUsCiAgICAgICAgKSB8fCAndmVyaWZpZWQnOwogICAgICAgICVWZXJpZnlJbmZvID0gJFBhY2thZ2VPYmplY3QtPlBhY2thZ2VWZXJpZnlJbmZvKCk7CgogICAgICAgICMgdHJhbnNsYXRlIGRlc2NyaXB0aW9uCiAgICAgICAgaWYgKCAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9ICkgewogICAgICAgICAgICAkVmVyaWZ5SW5mb3tEZXNjcmlwdGlvbn0gPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5HZXQoCiAgICAgICAgICAgICAgICAkVmVyaWZ5SW5mb3tEZXNjcmlwdGlvbn0KICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgIyBFTyBLSVhDb3JlLWNhcGVJVAoKICAgICMgdmVuZG9yIHNjcmVlbgogICAgaWYgKCAhJEludHJvSW5zdGFsbFZlbmRvciAmJiAhJEludHJvSW5zdGFsbFByZSAmJiAkVmVyaWZpZWQgbmUgJ3ZlcmlmaWVkJyApIHsKCiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0ludHJvJywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICAlVmVyaWZ5SW5mbywKICAgICAgICAgICAgICAgIFN1YmFjdGlvbiA9PiAkU2VsZi0+e1N1YmFjdGlvbn0sCiAgICAgICAgICAgICAgICBUeXBlICAgICAgPT4gJ0ludHJvSW5zdGFsbFZlbmRvcicsCiAgICAgICAgICAgICAgICBOYW1lICAgICAgPT4gJFN0cnVjdHVyZXtOYW1lfS0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgVmVyc2lvbiAgID0+ICRTdHJ1Y3R1cmV7VmVyc2lvbn0tPntDb250ZW50fSwKICAgICAgICAgICAgfSwKICAgICAgICApOwoKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnSW50cm9DYW5jZWwnLAogICAgICAgICk7CgogICAgICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5hdmlnYXRpb25CYXIoKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk91dHB1dCgKICAgICAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdBZG1pblBhY2thZ2VNYW5hZ2VyJywKICAgICAgICApOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCk7CiAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICB9CgogICAgIyBpbnRybyBzY3JlZW4KICAgIG15ICVEYXRhOwogICAgaWYgKCAkU3RydWN0dXJle0ludHJvSW5zdGFsbH0gKSB7CiAgICAgICAgJURhdGEgPSAkU2VsZi0+X01lc3NhZ2VHZXQoCiAgICAgICAgICAgIEluZm8gPT4gJFN0cnVjdHVyZXtJbnRyb0luc3RhbGx9LAogICAgICAgICAgICBUeXBlID0+ICdwcmUnCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGdldCBjbG91ZCByZXBvc2l0b3JpZXMKICAgIG15ICRSZXBvc2l0b3J5Q2xvdWRMaXN0OwogICAgaWYgKCAhJFNlbGYtPntDbG91ZFNlcnZpY2VzRGlzYWJsZWR9ICkgewogICAgICAgICRSZXBvc2l0b3J5Q2xvdWRMaXN0ID0gJFBhY2thZ2VPYmplY3QtPlJlcG9zaXRvcnlDbG91ZExpc3QoKTsKICAgIH0KCiAgICAjIGluIGNhc2UgU291cmNlIGlzIHByZXNlbnQgb24gcmVwb3NpdG9yeSBjbG91ZCBsaXN0CiAgICAjIHRoZSBwYWNrYWdlIHNob3VsZCBiZSByZXRyaWV2ZWQgdXNpbmcgdGhlIENsb3VkU2VydmljZSBiYWNrZW5kCiAgICBteSAkRnJvbUNsb3VkID0gMDsKICAgIGlmICggJFBhcmFte1NvdXJjZX0gJiYgJFJlcG9zaXRvcnlDbG91ZExpc3QtPnsgJFBhcmFte1NvdXJjZX0gfSApIHsKICAgICAgICAkRnJvbUNsb3VkID0gMTsKICAgIH0KCiAgICAjIGludHJvIGJlZm9yZSBpbnN0YWxsYXRpb24KICAgIGlmICggJURhdGEgJiYgISRJbnRyb0luc3RhbGxQcmUgKSB7CgogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdJbnRybycsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgJURhdGEsCiAgICAgICAgICAgICAgICBTdWJhY3Rpb24gPT4gJFNlbGYtPntTdWJhY3Rpb259LAogICAgICAgICAgICAgICAgVHlwZSAgICAgID0+ICdJbnRyb0luc3RhbGxQcmUnLAogICAgICAgICAgICAgICAgTmFtZSAgICAgID0+ICRTdHJ1Y3R1cmV7TmFtZX0tPntDb250ZW50fSwKICAgICAgICAgICAgICAgIFZlcnNpb24gICA9PiAkU3RydWN0dXJle1ZlcnNpb259LT57Q29udGVudH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKCiAgICAgICAgaWYgKCAkVmVyaWZpZWQgZXEgJ3ZlcmlmaWVkJyAmJiAhJFNlbGYtPntDbG91ZFNlcnZpY2VzRGlzYWJsZWR9ICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ09UUlNWZXJpZnlMb2dvJywKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdJbnRyb0NhbmNlbCcsCiAgICAgICAgKTsKICAgICAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+SGVhZGVyKCk7CiAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5OYXZpZ2F0aW9uQmFyKCk7CiAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQWRtaW5QYWNrYWdlTWFuYWdlcicsCiAgICAgICAgKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigpOwogICAgICAgIHJldHVybiAkT3V0cHV0OwogICAgfQoKICAgICMgaW5zdGFsbCBwYWNrYWdlCiAgICBlbHNpZiAoCiAgICAgICAgJFBhY2thZ2VPYmplY3QtPlBhY2thZ2VJbnN0YWxsKAogICAgICAgICAgICBTdHJpbmcgICAgPT4gJFBhcmFte1BhY2thZ2V9LAogICAgICAgICAgICBGcm9tQ2xvdWQgPT4gJEZyb21DbG91ZAogICAgICAgICkKICAgICAgICApCiAgICB7CgogICAgICAgICMgaW50cm8gc2NyZWVuCiAgICAgICAgbXkgJURhdGE7CiAgICAgICAgaWYgKCAkU3RydWN0dXJle0ludHJvSW5zdGFsbH0gKSB7CiAgICAgICAgICAgICVEYXRhID0gJFNlbGYtPl9NZXNzYWdlR2V0KAogICAgICAgICAgICAgICAgSW5mbyA9PiAkU3RydWN0dXJle0ludHJvSW5zdGFsbH0sCiAgICAgICAgICAgICAgICBUeXBlID0+ICdwb3N0JwogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBpZiAoJURhdGEpIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdJbnRybycsCiAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICAgICAgJURhdGEsCiAgICAgICAgICAgICAgICAgICAgU3ViYWN0aW9uID0+ICdJbnN0YWxsJywKICAgICAgICAgICAgICAgICAgICBUeXBlICAgICAgPT4gJ0ludHJvSW5zdGFsbFBvc3QnLAogICAgICAgICAgICAgICAgICAgIE5hbWUgICAgICA9PiAkU3RydWN0dXJle05hbWV9LT57Q29udGVudH0sCiAgICAgICAgICAgICAgICAgICAgVmVyc2lvbiAgID0+ICRTdHJ1Y3R1cmV7VmVyc2lvbn0tPntDb250ZW50fSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBpZiAoICRWZXJpZmllZCBlcSAndmVyaWZpZWQnICkgewogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnT1RSU1ZlcmlmeUxvZ28nLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbXkgJE91dHB1dCA9ICRMYXlvdXRPYmplY3QtPkhlYWRlcigpOwogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5hdmlnYXRpb25CYXIoKTsKICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gJ0FkbWluUGFja2FnZU1hbmFnZXInLAogICAgICAgICAgICApOwogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigpOwogICAgICAgICAgICByZXR1cm4gJE91dHB1dDsKICAgICAgICB9CgogICAgICAgICMgcmVkaXJlY3QKICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+UmVkaXJlY3QoIE9QID0+ICJBY3Rpb249JFNlbGYtPntBY3Rpb259IiApOwogICAgfQoKICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvclNjcmVlbigpOwp9CgpzdWIgX1VwZ3JhZGVIYW5kbGluZyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgIyBjaGVjayBuZWVkZWQgcGFyYW1zCiAgICBpZiAoICEkUGFyYW17UGFja2FnZX0gKSB7CiAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yU2NyZWVuKAogICAgICAgICAgICBNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgnTm8gc3VjaCBwYWNrYWdlIScpLAogICAgICAgICk7CiAgICB9CgogICAgbXkgJFBhcmFtT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpOwoKICAgICMgcmVkaXJlY3QgYWZ0ZXIgZmluaXNoaW5nIHVwZ3JhZGUKICAgIGlmICggJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0ludHJvVXBncmFkZVBvc3QnICkgKSB7CiAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KCBPUCA9PiAiQWN0aW9uPSRTZWxmLT57QWN0aW9ufSIgKTsKICAgIH0KCiAgICBteSAkSW50cm9VcGdyYWRlUHJlID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0ludHJvVXBncmFkZVByZScgKSB8fCAnJzsKCiAgICBteSAkUGFja2FnZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpQYWNrYWdlJyk7CgogICAgIyBjaGVjayBpZiB3ZSBoYXZlIHRvIHNob3cgdXBncmFkZSBpbnRybyBwcmUKICAgIG15ICVTdHJ1Y3R1cmUgPSAkUGFja2FnZU9iamVjdC0+UGFja2FnZVBhcnNlKAogICAgICAgIFN0cmluZyA9PiAkUGFyYW17UGFja2FnZX0sCiAgICApOwoKICAgICMgaW50cm8gc2NyZWVuCiAgICBteSAlRGF0YTsKICAgIGlmICggJFN0cnVjdHVyZXtJbnRyb1VwZ3JhZGV9ICkgewogICAgICAgICVEYXRhID0gJFNlbGYtPl9NZXNzYWdlR2V0KAogICAgICAgICAgICBJbmZvID0+ICRTdHJ1Y3R1cmV7SW50cm9VcGdyYWRlfSwKICAgICAgICAgICAgVHlwZSA9PiAncHJlJwogICAgICAgICk7CiAgICB9CiAgICBpZiAoICVEYXRhICYmICEkSW50cm9VcGdyYWRlUHJlICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdJbnRybycsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgJURhdGEsCiAgICAgICAgICAgICAgICBTdWJhY3Rpb24gPT4gJFNlbGYtPntTdWJhY3Rpb259LAogICAgICAgICAgICAgICAgVHlwZSAgICAgID0+ICdJbnRyb1VwZ3JhZGVQcmUnLAogICAgICAgICAgICAgICAgTmFtZSAgICAgID0+ICRTdHJ1Y3R1cmV7TmFtZX0tPntDb250ZW50fSwKICAgICAgICAgICAgICAgIFZlcnNpb24gICA9PiAkU3RydWN0dXJle1ZlcnNpb259LT57Q29udGVudH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnSW50cm9DYW5jZWwnLAogICAgICAgICk7CiAgICAgICAgbXkgJE91dHB1dCA9ICRMYXlvdXRPYmplY3QtPkhlYWRlcigpOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+TmF2aWdhdGlvbkJhcigpOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gJ0FkbWluUGFja2FnZU1hbmFnZXInLAogICAgICAgICk7CiAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Gb290ZXIoKTsKICAgICAgICByZXR1cm4gJE91dHB1dDsKICAgIH0KCiAgICAjIHVwZ3JhZGUKICAgIGVsc2lmICggJFBhY2thZ2VPYmplY3QtPlBhY2thZ2VVcGdyYWRlKCBTdHJpbmcgPT4gJFBhcmFte1BhY2thZ2V9ICkgKSB7CgogICAgICAgICMgaW50cm8gc2NyZWVuCiAgICAgICAgbXkgJURhdGE7CiAgICAgICAgaWYgKCAkU3RydWN0dXJle0ludHJvVXBncmFkZX0gKSB7CiAgICAgICAgICAgICVEYXRhID0gJFNlbGYtPl9NZXNzYWdlR2V0KAogICAgICAgICAgICAgICAgSW5mbyA9PiAkU3RydWN0dXJle0ludHJvVXBncmFkZX0sCiAgICAgICAgICAgICAgICBUeXBlID0+ICdwb3N0JwogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBpZiAoJURhdGEpIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdJbnRybycsCiAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICAgICAgJURhdGEsCiAgICAgICAgICAgICAgICAgICAgU3ViYWN0aW9uID0+ICcnLAogICAgICAgICAgICAgICAgICAgIFR5cGUgICAgICA9PiAnSW50cm9VcGdyYWRlUG9zdCcsCiAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgID0+ICRTdHJ1Y3R1cmV7TmFtZX0tPntDb250ZW50fSwKICAgICAgICAgICAgICAgICAgICBWZXJzaW9uICAgPT4gJFN0cnVjdHVyZXtWZXJzaW9ufS0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgbXkgJE91dHB1dCA9ICRMYXlvdXRPYmplY3QtPkhlYWRlcigpOwogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5hdmlnYXRpb25CYXIoKTsKICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gJ0FkbWluUGFja2FnZU1hbmFnZXInLAogICAgICAgICAgICApOwogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigpOwogICAgICAgICAgICByZXR1cm4gJE91dHB1dDsKICAgICAgICB9CgogICAgICAgICMgcmVkaXJlY3QKICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+UmVkaXJlY3QoIE9QID0+ICJBY3Rpb249JFNlbGYtPntBY3Rpb259IiApOwogICAgfQoKICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvclNjcmVlbigpOwp9CgpzdWIgX0dldEZlYXR1cmVBZGRvbkRhdGEgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkTGFuZ3VhZ2UgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JyktPntVc2VyTGFuZ3VhZ2V9OwoKICAgICMgY2xlYW51cCBtYWluIGxhbmd1YWdlIGZvciBsYW5ndWFnZXMgbGlrZSBlc19NWCAoZXMgaW4gdGhpcyBjYXNlKQogICAgJExhbmd1YWdlID0gc3Vic3RyICRMYW5ndWFnZSwgMCwgMjsKCiAgICBteSAkQ2FjaGVLZXkgID0gIkZlYXR1cmVBZGRvbkRhdGE6OiRMYW5ndWFnZSI7CiAgICBteSAkQ2FjaGVUVEwgID0gNjAgKiA2MCAqIDI0OyAgICAgICAgICAgICAgICAgICAgIyAxIGRheQogICAgbXkgJENhY2hlVHlwZSA9ICdQYWNrYWdlTWFuYWdlcic7CgogICAgbXkgJENhY2hlT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyk7CiAgICBteSAkQ2FjaGVSZXN1bHQgPSAkQ2FjaGVPYmplY3QtPkdldCgKICAgICAgICBUeXBlID0+ICRDYWNoZVR5cGUsCiAgICAgICAgS2V5ICA9PiAkQ2FjaGVLZXksCiAgICApOwoKICAgIHJldHVybiAkQ2FjaGVSZXN1bHQgaWYgcmVmICRDYWNoZVJlc3VsdCBlcSAnQVJSQVknOwoKICAgIG15ICRDbG91ZFNlcnZpY2UgPSAnUHVibGljRmVlZHMnOwogICAgbXkgJE9wZXJhdGlvbiAgICA9ICdGQU9GZWVkJzsKCiAgICAjIHByZXBhcmUgY2xvdWQgc2VydmljZSByZXF1ZXN0CiAgICBteSAlUmVxdWVzdFBhcmFtcyA9ICgKICAgICAgICBSZXF1ZXN0RGF0YSA9PiB7CiAgICAgICAgICAgICRDbG91ZFNlcnZpY2UgPT4gWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIE9wZXJhdGlvbiA9PiAkT3BlcmF0aW9uLAogICAgICAgICAgICAgICAgICAgIERhdGEgICAgICA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIExhbmd1YWdlID0+ICRMYW5ndWFnZSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgXSwKICAgICAgICB9LAogICAgKTsKCiAgICBteSAkQ2xvdWRTZXJ2aWNlT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNsb3VkU2VydmljZTo6QmFja2VuZDo6UnVuJyk7CgogICAgIyBkaXNwYXRjaCB0aGUgY2xvdWQgc2VydmljZSByZXF1ZXN0CiAgICBteSAkUmVxdWVzdFJlc3VsdCA9ICRDbG91ZFNlcnZpY2VPYmplY3QtPlJlcXVlc3QoJVJlcXVlc3RQYXJhbXMpOwoKICAgICMgYXMgdGhpcyBpcyB0aGUgb25seSBvcGVyYXRpb24gYW4gdW5zdWNjZXNzZnVsIHJlcXVlc3QgbWVhbnMgdGhhdCB0aGUgb3BlcmF0aW9uIHdhcyBhbHNvCiAgICAjIHVuc3VjY2Vzc2Z1bAogICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoJFJlcXVlc3RSZXN1bHQpICkgewogICAgICAgIHJldHVybiBUcmFuc2xhdGFibGUoJ0NhblwndCBjb25uZWN0IHRvIE9UUlMgRmVhdHVyZSBBZGQtb24gbGlzdCBzZXJ2ZXIhJyk7CiAgICB9CgogICAgbXkgJE9wZXJhdGlvblJlc3VsdCA9ICRDbG91ZFNlcnZpY2VPYmplY3QtPk9wZXJhdGlvblJlc3VsdEdldCgKICAgICAgICBSZXF1ZXN0UmVzdWx0ID0+ICRSZXF1ZXN0UmVzdWx0LAogICAgICAgIENsb3VkU2VydmljZSAgPT4gJENsb3VkU2VydmljZSwKICAgICAgICBPcGVyYXRpb24gICAgID0+ICRPcGVyYXRpb24sCiAgICApOwoKICAgIGlmICggIUlzSGFzaFJlZldpdGhEYXRhKCRPcGVyYXRpb25SZXN1bHQpICkgewogICAgICAgIHJldHVybiBUcmFuc2xhdGFibGUoJ0NhblwndCBnZXQgT1RSUyBGZWF0dXJlIEFkZC1vbiBsaXN0IGZyb20gc2VydmVyIScpOwogICAgfQogICAgZWxzaWYgKCAhJE9wZXJhdGlvblJlc3VsdC0+e1N1Y2Nlc3N9ICkgewogICAgICAgIHJldHVybiAkT3BlcmF0aW9uUmVzdWx0LT57RXJyb3JNZXNzYWdlfSB8fCBUcmFuc2xhdGFibGUoJ0NhblwndCBnZXQgT1RSUyBGZWF0dXJlIEFkZC1vbiBmcm9tIHNlcnZlciEnKTsKICAgIH0KCiAgICBteSAkRkFPRmVlZCA9ICRPcGVyYXRpb25SZXN1bHQtPntEYXRhfS0+e0ZBT3N9OwoKICAgIHJldHVybiBpZiAhSXNBcnJheVJlZldpdGhEYXRhKCRGQU9GZWVkKTsKCiAgICAjIHNldCBjYWNoZQogICAgJENhY2hlT2JqZWN0LT5TZXQoCiAgICAgICAgVHlwZSAgPT4gJENhY2hlVHlwZSwKICAgICAgICBLZXkgICA9PiAkQ2FjaGVLZXksCiAgICAgICAgVmFsdWUgPT4gJEZBT0ZlZWQsCiAgICAgICAgVFRMICAgPT4gJENhY2hlVFRMLAogICAgKTsKCiAgICByZXR1cm4gJEZBT0ZlZWQ7Cn0KCjE7Cg==</File>
        <File Location="KIXCore/Kernel/Output/HTML/Layout.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDE2IE9UUlMgQUcsIGh0dHA6Ly9vdHJzLmNvbS8KIyBLSVhDb3JlLUV4dGVuc2lvbnMgQ29weXJpZ2h0IChDKSAyMDA2LTIwMTYgYy5hLnAuZS4gSVQgR21iSCwgaHR0cDovL3d3dy5jYXBlLWl0LmRlCiMKIyB3cml0dGVuL2VkaXRlZCBieToKIyAqIFJlbmUoZG90KUJvZWhtKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIFRvcnN0ZW4oZG90KVRoYXUoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojICogTWFydGluKGRvdClCYWx6YXJlayhhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMgKiBTdGVmYW4oZG90KU1laGxpZyhhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMgKiBEb3JvdGhlYShkb3QpRG9lcmZmZWwoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojICogQW5uYShkb3QpTGl0dmlub3ZhKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIFJhbGYoZG90KUJvZWhtKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAtLQojICRJZDogTGF5b3V0LnBtLHYgMS41MyAyMDE2LzA3LzA1IDExOjM3OjUzIGRkb2VyZmZlbCBFeHAgJAojIC0tCiMgVGhpcyBzb2Z0d2FyZSBjb21lcyB3aXRoIEFCU09MVVRFTFkgTk8gV0FSUkFOVFkuIEZvciBkZXRhaWxzLCBzZWUKIyB0aGUgZW5jbG9zZWQgZmlsZSBDT1BZSU5HIGZvciBsaWNlbnNlIGluZm9ybWF0aW9uIChBR1BMKS4gSWYgeW91CiMgZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9hZ3BsLnR4dC4KIyAtLQoKcGFja2FnZSBLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0OwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIFN0b3JhYmxlOwp1c2UgVVJJOjpFc2NhcGUgcXcoKTsKCnVzZSB2YXJzIHF3KEBJU0EpOwoKdXNlIEtlcm5lbDo6U3lzdGVtOjpUaW1lOwp1c2UgS2VybmVsOjpTeXN0ZW06OlZhcmlhYmxlQ2hlY2sgcXcoOmFsbCk7CnVzZSBLZXJuZWw6Okxhbmd1YWdlIHF3KFRyYW5zbGF0YWJsZSk7CgpvdXIgQE9iamVjdERlcGVuZGVuY2llcyA9ICgKICAgICdLZXJuZWw6OkNvbmZpZycsCiAgICAnS2VybmVsOjpMYW5ndWFnZScsCiAgICAnS2VybmVsOjpTeXN0ZW06OkF1dGhTZXNzaW9uJywKICAgICdLZXJuZWw6OlN5c3RlbTo6Q2hhdCcsCiAgICAnS2VybmVsOjpTeXN0ZW06OkVuY29kZScsCiAgICAnS2VybmVsOjpTeXN0ZW06OkhUTUxVdGlscycsCiAgICAnS2VybmVsOjpTeXN0ZW06OkpTT04nLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpMb2cnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpNYWluJywKICAgICdLZXJuZWw6OlN5c3RlbTo6T1RSU0J1c2luZXNzJywKICAgICdLZXJuZWw6OlN5c3RlbTo6U3lzdGVtTWFpbnRlbmFuY2UnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpUaW1lJywKICAgICdLZXJuZWw6OlN5c3RlbTo6VXNlcicsCiAgICAnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcsCiAgICAnS2VybmVsOjpTeXN0ZW06Okdyb3VwJywKKTsKCj1oZWFkMSBOQU1FCgpLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0IC0gYWxsIGdlbmVyaWMgaHRtbCBmdW5jdGlvbnMKCj1oZWFkMSBTWU5PUFNJUwoKQWxsIGdlbmVyaWMgaHRtbCBmdW5jdGlvbnMuIEUuIGcuIHRvIGdldCBvcHRpb25zIGZpZWxkcywgdGVtcGxhdGUgcHJvY2Vzc2luZywgLi4uCgo9aGVhZDEgUFVCTElDIElOVEVSRkFDRQoKPW92ZXIgNAoKPWN1dAoKPWl0ZW0gbmV3KCkKCmNyZWF0ZSBhIG5ldyBvYmplY3QuIERvIG5vdCB1c2UgaXQgZGlyZWN0bHksIGluc3RlYWQgdXNlOgoKICAgIHVzZSBLZXJuZWw6OlN5c3RlbTo6T2JqZWN0TWFuYWdlcjsKICAgIGxvY2FsICRLZXJuZWw6Ok9NID0gS2VybmVsOjpTeXN0ZW06Ok9iamVjdE1hbmFnZXItPm5ldygKICAgICAgICAnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcgPT4gewogICAgICAgICAgICBMYW5nICAgID0+ICdkZScsCiAgICAgICAgfSwKICAgICk7CiAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKRnJvbSB0aGUgd2ViIGluc3RhbGxlciwgYSBzcGVjaWFsIE9wdGlvbiBDPEluc3RhbGxlck9ubHk+IGlzIHBhc3NlZAp0byBpbmRpY2F0ZSB0aGF0IGEgZGF0YWJhc2UgY29ubmVjdGlvbiBpcyBub3QgeWV0IGF2YWlsYWJsZS4KCiAgICB1c2UgS2VybmVsOjpTeXN0ZW06Ok9iamVjdE1hbmFnZXI7CiAgICBsb2NhbCAkS2VybmVsOjpPTSA9IEtlcm5lbDo6U3lzdGVtOjpPYmplY3RNYW5hZ2VyLT5uZXcoCiAgICAgICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnID0+IHsKICAgICAgICAgICAgSW5zdGFsbGVyT25seSA9PiAxLAogICAgICAgIH0sCiAgICApOwogICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCj1jdXQKCnN1YiBuZXcgewogICAgbXkgKCAkVHlwZSwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGFsbG9jYXRlIG5ldyBoYXNoIGZvciBvYmplY3QKICAgIG15ICRTZWxmID0geyVQYXJhbX07CiAgICBibGVzcyggJFNlbGYsICRUeXBlICk7CgogICAgIyBzZXQgZGVidWcKICAgICRTZWxmLT57RGVidWd9ID0gMDsKCiAgICAjIHJlc2V0IGJsb2NrIGRhdGEKICAgIGRlbGV0ZSAkU2VsZi0+e0Jsb2NrRGF0YX07CgogICAgIyBlbXB0eSBhY3Rpb24gaWYgbm90IGRlZmluZWQKICAgICRTZWxmLT57QWN0aW9ufSA9ICcnIGlmICFkZWZpbmVkICRTZWxmLT57QWN0aW9ufTsKCiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICAjIGdldC9zZXQgc29tZSBjb21tb24gcGFyYW1zCiAgICBpZiAoICEkU2VsZi0+e1VzZXJUaGVtZX0gKSB7CiAgICAgICAgJFNlbGYtPntVc2VyVGhlbWV9ID0gJENvbmZpZ09iamVjdC0+R2V0KCdEZWZhdWx0VGhlbWUnKTsKICAgIH0KCiAgICAjIFdlJ2xsIGtlZXAgb25lIGRlZmF1bHQgVGltZU9iamVjdCBhbmQgb25lIGZvciB0aGUgdXNlcidzIHRpbWUgem9uZSAoaWYgbmVlZGVkKQogICAgJFNlbGYtPntUaW1lT2JqZWN0fSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaW1lJyk7CgogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpbWVab25lVXNlcicpICYmICRTZWxmLT57VXNlclRpbWVab25lfSApIHsKICAgICAgICAkU2VsZi0+e1VzZXJUaW1lT2JqZWN0fSA9IEtlcm5lbDo6U3lzdGVtOjpUaW1lLT5uZXcoICV7JFNlbGZ9ICk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkU2VsZi0+e1VzZXJUaW1lT2JqZWN0fSA9ICRTZWxmLT57VGltZU9iamVjdH07CiAgICAgICAgJFNlbGYtPntVc2VyVGltZVpvbmV9ICAgPSAnJzsKICAgIH0KCiAgICAjIERldGVybWluZSB0aGUgbGFuZ3VhZ2UgdG8gdXNlIGJhc2VkIG9uIHRoZSBicm93c2VyIHNldHRpbmcsIGlmIHRoZXJlCiAgICAjICAgaXMgbm9uZSB5ZXQuCiAgICBpZiAoICEkU2VsZi0+e1VzZXJMYW5ndWFnZX0gKSB7CiAgICAgICAgbXkgQEJyb3dzZXJMYW5ndWFnZXMgPSBzcGxpdCAvXHMqLFxzKi8sICRTZWxmLT57TGFuZ30gfHwgJEVOVntIVFRQX0FDQ0VQVF9MQU5HVUFHRX0gfHwgJyc7CiAgICAgICAgbXkgJURhdGEgPSAleyAkQ29uZmlnT2JqZWN0LT5HZXQoJ0RlZmF1bHRVc2VkTGFuZ3VhZ2VzJykgfTsKICAgICAgICBMQU5HVUFHRToKICAgICAgICBmb3IgbXkgJEJyb3dzZXJMYW5nIChAQnJvd3Nlckxhbmd1YWdlcykgewogICAgICAgICAgICBmb3IgbXkgJExhbmd1YWdlICggcmV2ZXJzZSBzb3J0IGtleXMgJURhdGEgKSB7CgogICAgICAgICAgICAgICAgIyBjaGVjayB4eF9YWCBhbmQgeHgtWFggdHlwZQogICAgICAgICAgICAgICAgbXkgJExhbmd1YWdlT3RoZXJUeXBlID0gJExhbmd1YWdlOwogICAgICAgICAgICAgICAgJExhbmd1YWdlT3RoZXJUeXBlID1+IHMvXy8tLzsKICAgICAgICAgICAgICAgIGlmICggJEJyb3dzZXJMYW5nID1+IC9eKCRMYW5ndWFnZXwkTGFuZ3VhZ2VPdGhlclR5cGUpL2kgKSB7CiAgICAgICAgICAgICAgICAgICAgJFNlbGYtPntVc2VyTGFuZ3VhZ2V9ID0gJExhbmd1YWdlOwogICAgICAgICAgICAgICAgICAgIGxhc3QgTEFOR1VBR0U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCAhJFNlbGYtPntVc2VyTGFuZ3VhZ2V9ICkgewogICAgICAgICAgICAgICAgZm9yIG15ICRMYW5ndWFnZSAoIHJldmVyc2Ugc29ydCBrZXlzICVEYXRhICkgewoKICAgICAgICAgICAgICAgICAgICAjIElmIEJyb3dzZXIgcmVxdWVzdHMgJ3ZpJywgYWxzbyBvZmZlciAndmlfVkknIGV2ZW4gdGhvdWdoIHdlIGRvbid0IGhhdmUgJ3ZpJwogICAgICAgICAgICAgICAgICAgIGlmICggJExhbmd1YWdlID1+IG0vXiRCcm93c2VyTGFuZy9zbXhpICkgewogICAgICAgICAgICAgICAgICAgICAgICAkU2VsZi0+e1VzZXJMYW5ndWFnZX0gPSAkTGFuZ3VhZ2U7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QgTEFOR1VBR0U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICRTZWxmLT57VXNlckxhbmd1YWdlfSB8fD0gJENvbmZpZ09iamVjdC0+R2V0KCdEZWZhdWx0TGFuZ3VhZ2UnKSB8fCAnZW4nOwogICAgfQoKICAgICMgY3JlYXRlIGxhbmd1YWdlIG9iamVjdAogICAgaWYgKCAhJFNlbGYtPntMYW5ndWFnZU9iamVjdH0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPk9iamVjdFBhcmFtQWRkKAogICAgICAgICAgICAnS2VybmVsOjpMYW5ndWFnZScgPT4gewogICAgICAgICAgICAgICAgVXNlclRpbWVab25lID0+ICRTZWxmLT57VXNlclRpbWVab25lfSwKICAgICAgICAgICAgICAgIFVzZXJMYW5ndWFnZSA9PiAkU2VsZi0+e1VzZXJMYW5ndWFnZX0sCiAgICAgICAgICAgICAgICBBY3Rpb24gICAgICAgPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICAgICAgJFNlbGYtPntMYW5ndWFnZU9iamVjdH0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Okxhbmd1YWdlJyk7CiAgICB9CgogICAgIyBzZXQgY2hhcnNldCBpZiB0aGVyZSBpcyBubyBjaGFyc2V0IGdpdmVuCiAgICAkU2VsZi0+e1VzZXJDaGFyc2V0fSA9ICd1dGYtOCc7CiAgICAkU2VsZi0+e0NoYXJzZXR9ICAgICA9ICRTZWxmLT57VXNlckNoYXJzZXR9OyAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGp1c3QgZm9yIGNvbXBhdC4KICAgICRTZWxmLT57U2Vzc2lvbklEfSAgID0gJFBhcmFte1Nlc3Npb25JRH0gfHwgJyc7CiAgICAkU2VsZi0+e1Nlc3Npb25OYW1lfSA9ICRQYXJhbXtTZXNzaW9uTmFtZX0gfHwgJ1Nlc3Npb25JRCc7CiAgICAkU2VsZi0+e0NHSUhhbmRsZX0gICA9ICRFTlZ7U0NSSVBUX05BTUV9IHx8ICdOby0kRU5WeyJTQ1JJUFRfTkFNRSJ9JzsKCiAgICAjIGJhc2VsaW5rCiAgICAkU2VsZi0+e0Jhc2VsaW5rfSA9ICRTZWxmLT57Q0dJSGFuZGxlfSAuICc/JzsKICAgICRTZWxmLT57VGltZX0gICAgID0gJFNlbGYtPntMYW5ndWFnZU9iamVjdH0tPlRpbWUoCiAgICAgICAgQWN0aW9uID0+ICdHRVQnLAogICAgICAgIEZvcm1hdCA9PiAnRGF0ZUZvcm1hdCcsCiAgICApOwogICAgJFNlbGYtPntUaW1lTG9uZ30gPSAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VGltZSgKICAgICAgICBBY3Rpb24gPT4gJ0dFVCcsCiAgICAgICAgRm9ybWF0ID0+ICdEYXRlRm9ybWF0TG9uZycsCiAgICApOwoKICAgICMgc2V0IHRleHQgZGlyZWN0aW9uCiAgICAkU2VsZi0+e1RleHREaXJlY3Rpb259ID0gJFNlbGYtPntMYW5ndWFnZU9iamVjdH0tPntUZXh0RGlyZWN0aW9ufTsKCiAgICAjIGNoZWNrIEZyb250ZW5kOjpPdXRwdXQ6OkZpbHRlckVsZW1lbnRQb3N0CiAgICAkU2VsZi0+e0ZpbHRlckVsZW1lbnRQb3N0fSA9IHt9OwoKICAgIG15ICVGaWx0ZXJFbGVtZW50UG9zdCA9ICV7ICRDb25maWdPYmplY3QtPkdldCgnRnJvbnRlbmQ6Ok91dHB1dDo6RmlsdGVyRWxlbWVudFBvc3QnKSAvLyB7fSB9OwoKICAgIEZJTFRFUjoKICAgIGZvciBteSAkRmlsdGVyICggc29ydCBrZXlzICVGaWx0ZXJFbGVtZW50UG9zdCApIHsKCiAgICAgICAgIyBleHRyYWN0IGZpbHRlciBjb25maWcKICAgICAgICBteSAkRmlsdGVyQ29uZmlnID0gJEZpbHRlckVsZW1lbnRQb3N0eyRGaWx0ZXJ9OwoKICAgICAgICBuZXh0IEZJTFRFUiBpZiAhJEZpbHRlckNvbmZpZyB8fCByZWYgJEZpbHRlckNvbmZpZyBuZSAnSEFTSCc7CgogICAgICAgICMgZXh0cmFjdCB0ZW1wbGF0ZSBsaXN0CiAgICAgICAgbXkgJVRlbXBsYXRlTGlzdCA9ICV7ICRGaWx0ZXJDb25maWctPntUZW1wbGF0ZXN9IHx8IHt9IH07CgogICAgICAgIGlmICggISVUZW1wbGF0ZUxpc3QgfHwgJFRlbXBsYXRlTGlzdHtBTEx9ICkgewoKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gPDxFT0YsCiRGaWx0ZXJDb25maWctPntNb2R1bGV9IHdpbGwgYmUgaWdub3JlZCBiZWNhdXNlIGl0IHdhbnRzIHRvIG9wZXJhdGUgb24gYWxsIHRlbXBsYXRlcyBvciBkb2VzIG5vdCBzcGVjaWZ5IGEgdGVtcGxhdGUgbGlzdC4KRU9GCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBuZXh0IEZJTFRFUjsKICAgICAgICB9CgogICAgICAgICRTZWxmLT57RmlsdGVyRWxlbWVudFBvc3R9LT57JEZpbHRlcn0gPSAkRmlsdGVyRWxlbWVudFBvc3R7JEZpbHRlcn07CiAgICB9CgogICAgIyBjaGVjayBGcm9udGVuZDo6T3V0cHV0OjpGaWx0ZXJDb250ZW50CiAgICAkU2VsZi0+e0ZpbHRlckNvbnRlbnR9ID0gJENvbmZpZ09iamVjdC0+R2V0KCdGcm9udGVuZDo6T3V0cHV0OjpGaWx0ZXJDb250ZW50Jyk7CgogICAgIyBjaGVjayBGcm9udGVuZDo6T3V0cHV0OjpGaWx0ZXJUZXh0CiAgICAkU2VsZi0+e0ZpbHRlclRleHR9ID0gJENvbmZpZ09iamVjdC0+R2V0KCdGcm9udGVuZDo6T3V0cHV0OjpGaWx0ZXJUZXh0Jyk7CgogICAgIyBjaGVjayBicm93c2VyCiAgICAkU2VsZi0+e0Jyb3dzZXJ9ICAgICAgICA9ICdVbmtub3duJzsKICAgICRTZWxmLT57QnJvd3NlclZlcnNpb259ID0gMDsKICAgICRTZWxmLT57UGxhdGZvcm19ICAgICAgID0gJyc7CiAgICAkU2VsZi0+e0lzTW9iaWxlfSAgICAgICA9IDA7CgogICAgJFNlbGYtPntCcm93c2VySmF2YVNjcmlwdFN1cHBvcnR9ID0gMTsKICAgICRTZWxmLT57QnJvd3NlclJpY2hUZXh0fSAgICAgICAgICA9IDE7CgogICAgbXkgJEh0dHBVc2VyQWdlbnQgPSAoIGRlZmluZWQgJEVOVntIVFRQX1VTRVJfQUdFTlR9ID8gbGMgJEVOVntIVFRQX1VTRVJfQUdFTlR9IDogJycgKTsKCiAgICBpZiAoICEkSHR0cFVzZXJBZ2VudCApIHsKICAgICAgICAkU2VsZi0+e0Jyb3dzZXJ9ID0gJ1Vua25vd24gLSBubyAkRU5WeyJIVFRQX1VTRVJfQUdFTlQifSc7CiAgICB9CiAgICBlbHNpZiAoJEh0dHBVc2VyQWdlbnQpIHsKCiAgICAgICAgIyBjaGVjaywgaWYgd2UgYXJlIG9uIGEgbW9iaWxlIHBsYXRmb3JtLgogICAgICAgICMgdGFibGV0cyBhcmUgaGFuZGxlZCBsaWtlIGRlc2t0b3BzCiAgICAgICAgIyBvbmx5IHBob25lcyBhcmUgIm1vYmlsZSIKICAgICAgICBpZiAoICRIdHRwVXNlckFnZW50ID1+IC9tb2JpbGUvICkgewogICAgICAgICAgICAkU2VsZi0+e0lzTW9iaWxlfSA9IDE7CiAgICAgICAgfQoKICAgICAgICAjIGFuZHJvaWQKICAgICAgICBpZiAoICRIdHRwVXNlckFnZW50ID1+IC9hbmRyb2lkLyApIHsKICAgICAgICAgICAgJFNlbGYtPntQbGF0Zm9ybX0gPSAnQW5kcm9pZCc7CiAgICAgICAgfQoKICAgICAgICAjIGVkZ2UgLyBzcGFydGFuCiAgICAgICAgaWYgKCAkSHR0cFVzZXJBZ2VudCA9fiAvZWRnZS8gKSB7CiAgICAgICAgICAgICRTZWxmLT57QnJvd3Nlcn0gPSAnRWRnZSc7CiAgICAgICAgfQoKICAgICAgICAjIG1zaWUKICAgICAgICBlbHNpZiAoCiAgICAgICAgICAgICRIdHRwVXNlckFnZW50ID1+IC9tc2llXHMoWzAtOS5dKykvCiAgICAgICAgICAgIHx8ICRIdHRwVXNlckFnZW50ID1+IC9pbnRlcm5ldFxzZXhwbG9yZXJcLyhbMC05Ll0rKS8KICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgJFNlbGYtPntCcm93c2VyfSA9ICdNU0lFJzsKCiAgICAgICAgICAgIGlmICggJDEgPX4gLyhcZCspXC4oXGQrKS8gKSB7CiAgICAgICAgICAgICAgICAkU2VsZi0+e0Jyb3dzZXJNYWpvclZlcnNpb259ID0gJDE7CiAgICAgICAgICAgICAgICAkU2VsZi0+e0Jyb3dzZXJNaW5vclZlcnNpb259ID0gJDI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgb2xkZXIgd2luZG93cyBtb2JpbGUgcGhvbmVzICh1bnRpbCBJRTkpLCB0aGF0IHN0aWxsIGhhdmUgJ01TSUUnIGluIHRoZSB1c2VyIGFnZW50IHN0cmluZwogICAgICAgICAgICBpZiAoICRTZWxmLT57SXNNb2JpbGV9ICkgewogICAgICAgICAgICAgICAgJFNlbGYtPntQbGF0Zm9ybX0gPSAnV2luZG93cyBQaG9uZSc7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgbW9iaWxlIGllCiAgICAgICAgZWxzaWYgKCAkSHR0cFVzZXJBZ2VudCA9fiAvaWVtb2JpbGUvICkgewogICAgICAgICAgICAkU2VsZi0+e0Jyb3dzZXJ9ICA9ICdNU0lFJzsKICAgICAgICAgICAgJFNlbGYtPntQbGF0Zm9ybX0gPSAnV2luZG93cyBQaG9uZSc7CiAgICAgICAgfQoKICAgICAgICAjIG1vYmlsZSBpZSAoc2Vjb25kIHRyeSkKICAgICAgICBlbHNpZiAoICRIdHRwVXNlckFnZW50ID1+IC90cmlkZW50LyApIHsKICAgICAgICAgICAgJFNlbGYtPntCcm93c2VyfSA9ICdNU0lFJzsKCiAgICAgICAgICAgIGlmICggJEh0dHBVc2VyQWdlbnQgPX4gL3J2OihbMC05XSkrXC4oWzAtOV0pKy8gKSB7CiAgICAgICAgICAgICAgICAkU2VsZi0+e0Jyb3dzZXJNYWpvclZlcnNpb259ID0gJDI7CiAgICAgICAgICAgICAgICAkU2VsZi0+e0Jyb3dzZXJNaW5vclZlcnNpb259ID0gJDM7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgaU9TCiAgICAgICAgZWxzaWYgKCAkSHR0cFVzZXJBZ2VudCA9fiAvKGlwYWR8aXBob25lfGlwb2QpLyApIHsKICAgICAgICAgICAgJFNlbGYtPntQbGF0Zm9ybX0gPSAnaU9TJzsKICAgICAgICAgICAgJFNlbGYtPntCcm93c2VyfSAgPSAnU2FmYXJpJzsKCiAgICAgICAgICAgIGlmICggJEh0dHBVc2VyQWdlbnQgPX4gLyhpcGFkfGlwaG9uZXxpcG9kKTsuKmNwdS4qb3MgKFswLTldKylfLyApIHsKICAgICAgICAgICAgICAgICRTZWxmLT57QnJvd3NlclZlcnNpb259ID0gJDI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICggJEh0dHBVc2VyQWdlbnQgPX4gL2NyaW9zLyApIHsKICAgICAgICAgICAgICAgICRTZWxmLT57QnJvd3Nlcn0gPSAnQ2hyb21lJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBSaWNoVGV4dCBpcyBzdXBwb3J0ZWQgaW4gaU9TNisuCiAgICAgICAgICAgIGlmICggJFNlbGYtPntCcm93c2VyVmVyc2lvbn0gPj0gNiApIHsKICAgICAgICAgICAgICAgICRTZWxmLT57QnJvd3NlclJpY2hUZXh0fSA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkU2VsZi0+e0Jyb3dzZXJSaWNoVGV4dH0gPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIHNhZmFyaQogICAgICAgIGVsc2lmICggJEh0dHBVc2VyQWdlbnQgPX4gL3NhZmFyaS8gKSB7CgogICAgICAgICAgICAjIGNocm9tZQogICAgICAgICAgICBpZiAoICRIdHRwVXNlckFnZW50ID1+IC9jaHJvbWUvICkgewogICAgICAgICAgICAgICAgJFNlbGYtPntCcm93c2VyfSA9ICdDaHJvbWUnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJFNlbGYtPntCcm93c2VyfSA9ICdTYWZhcmknOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGtvbnF1ZXJvcgogICAgICAgIGVsc2lmICggJEh0dHBVc2VyQWdlbnQgPX4gL2tvbnF1ZXJvci8gKSB7CiAgICAgICAgICAgICRTZWxmLT57QnJvd3Nlcn0gPSAnS29ucXVlcm9yJzsKCiAgICAgICAgICAgICMgb24ga29ucXVlcmVyIGRpc2FibGUgcmljaCB0ZXh0IGVkaXRvcgogICAgICAgICAgICAkU2VsZi0+e0Jyb3dzZXJSaWNoVGV4dH0gPSAwOwogICAgICAgIH0KCiAgICAgICAgIyBmaXJlZm94CiAgICAgICAgZWxzaWYgKCAkSHR0cFVzZXJBZ2VudCA9fiAvZmlyZWZveC8gKSB7CiAgICAgICAgICAgICRTZWxmLT57QnJvd3Nlcn0gPSAnRmlyZWZveCc7CiAgICAgICAgfQoKICAgICAgICAjIG9wZXJhCiAgICAgICAgZWxzaWYgKCAkSHR0cFVzZXJBZ2VudCA9fiAvXm9wZXJhLiovICkgewogICAgICAgICAgICAkU2VsZi0+e0Jyb3dzZXJ9ID0gJ09wZXJhJzsKICAgICAgICB9CgogICAgICAgICMgbmV0c2NhcGUKICAgICAgICBlbHNpZiAoICRIdHRwVXNlckFnZW50ID1+IC9uZXRzY2FwZS8gKSB7CiAgICAgICAgICAgICRTZWxmLT57QnJvd3Nlcn0gPSAnTmV0c2NhcGUnOwogICAgICAgIH0KCiAgICAgICAgIyB3M20KICAgICAgICBlbHNpZiAoICRIdHRwVXNlckFnZW50ID1+IC9edzNtLiovICkgewogICAgICAgICAgICAkU2VsZi0+e0Jyb3dzZXJ9ICAgICAgICAgICAgICAgICAgPSAndzNtJzsKICAgICAgICAgICAgJFNlbGYtPntCcm93c2VySmF2YVNjcmlwdFN1cHBvcnR9ID0gMDsKICAgICAgICB9CgogICAgICAgICMgbHlueAogICAgICAgIGVsc2lmICggJEh0dHBVc2VyQWdlbnQgPX4gL15seW54LiovICkgewogICAgICAgICAgICAkU2VsZi0+e0Jyb3dzZXJ9ICAgICAgICAgICAgICAgICAgPSAnTHlueCc7CiAgICAgICAgICAgICRTZWxmLT57QnJvd3NlckphdmFTY3JpcHRTdXBwb3J0fSA9IDA7CiAgICAgICAgfQoKICAgICAgICAjIGxpbmtzCiAgICAgICAgZWxzaWYgKCAkSHR0cFVzZXJBZ2VudCA9fiAvXmxpbmtzLiovICkgewogICAgICAgICAgICAkU2VsZi0+e0Jyb3dzZXJ9ID0gJ0xpbmtzJzsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRTZWxmLT57QnJvd3Nlcn0gPSAnVW5rbm93biAtICcgLiAkSHR0cFVzZXJBZ2VudDsKICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBtb2JpbGUgZGV2aWNlcyB0byBkaXNhYmxlIHJpY2h0ZXh0IHN1cHBvcnQKICAgIGlmICgKICAgICAgICAkU2VsZi0+e0lzTW9iaWxlfQogICAgICAgICYmICRTZWxmLT57UGxhdGZvcm19IG5lICdpT1MnCiAgICAgICAgJiYgJFNlbGYtPntQbGF0Zm9ybX0gbmUgJ0FuZHJvaWQnCiAgICAgICAgJiYgJFNlbGYtPntQbGF0Zm9ybX0gbmUgJ1dpbmRvd3MgUGhvbmUnCiAgICAgICAgKQogICAgewogICAgICAgICRTZWxmLT57QnJvd3NlclJpY2hUZXh0fSA9IDA7CiAgICB9CgogICAgIyBjaGVjayBpZiByaWNoIHRleHQgY2FuIGJlIGFjdGl2ZQogICAgaWYgKCAhJFNlbGYtPntCcm93c2VySmF2YVNjcmlwdFN1cHBvcnR9IHx8ICEkU2VsZi0+e0Jyb3dzZXJSaWNoVGV4dH0gKSB7CiAgICAgICAgJENvbmZpZ09iamVjdC0+U2V0KAogICAgICAgICAgICBLZXkgICA9PiAnRnJvbnRlbmQ6OlJpY2hUZXh0JywKICAgICAgICAgICAgVmFsdWUgPT4gMCwKICAgICAgICApOwogICAgfQoKICAgICMgY2hlY2sgaWYgcmljaCB0ZXh0IGlzIGFjdGl2ZQogICAgaWYgKCAhJENvbmZpZ09iamVjdC0+R2V0KCdGcm9udGVuZDo6UmljaFRleHQnKSApIHsKICAgICAgICAkU2VsZi0+e0Jyb3dzZXJSaWNoVGV4dH0gPSAwOwogICAgfQoKICAgICMgY2hlY2sgaWYgc3BlbGwgY2hlY2sgc2hvdWxkIGJlIGFjdGl2ZQogICAgaWYgKCAkU2VsZi0+e0Jyb3dzZXJKYXZhU2NyaXB0U3VwcG9ydH0gJiYgJENvbmZpZ09iamVjdC0+R2V0KCdTcGVsbENoZWNrZXInKSApIHsKICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnRnJvbnRlbmQ6OlJpY2hUZXh0JykgKSB7CiAgICAgICAgICAgICRTZWxmLT57QnJvd3NlclNwZWxsQ2hlY2tlcklubGluZX0gPSAxOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFNlbGYtPntCcm93c2VyU3BlbGxDaGVja2VyfSA9IDE7CiAgICAgICAgfQogICAgfQoKICAgICMgbG9hZCB0aGVtZQogICAgbXkgJFRoZW1lID0gJFNlbGYtPntVc2VyVGhlbWV9IHx8ICRDb25maWdPYmplY3QtPkdldCgnRGVmYXVsdFRoZW1lJykgfHwgVHJhbnNsYXRhYmxlKCdTdGFuZGFyZCcpOwoKICAgICMgZm9yY2UgYSB0aGVtZSBiYXNlZCBvbiBob3N0IG5hbWUKICAgIG15ICREZWZhdWx0VGhlbWVIb3N0QmFzZWQgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0RlZmF1bHRUaGVtZTo6SG9zdEJhc2VkJyk7CiAgICBpZiAoICREZWZhdWx0VGhlbWVIb3N0QmFzZWQgJiYgJEVOVntIVFRQX0hPU1R9ICkgewoKICAgICAgICBUSEVNRToKICAgICAgICBmb3IgbXkgJFJlZ0V4cCAoIHNvcnQga2V5cyAleyREZWZhdWx0VGhlbWVIb3N0QmFzZWR9ICkgewoKICAgICAgICAgICAgIyBkbyBub3QgdXNlIGVtcHR5IHJlZ2V4cCBvciB0aGVtZSBkaXJlY3RvcmllcwogICAgICAgICAgICBuZXh0IFRIRU1FIGlmICEkUmVnRXhwOwogICAgICAgICAgICBuZXh0IFRIRU1FIGlmICRSZWdFeHAgZXEgJyc7CiAgICAgICAgICAgIG5leHQgVEhFTUUgaWYgISREZWZhdWx0VGhlbWVIb3N0QmFzZWQtPnskUmVnRXhwfTsKCiAgICAgICAgICAgICMgY2hlY2sgaWYgcmVnZXhwIGlzIG1hdGNoaW5nCiAgICAgICAgICAgIGlmICggJEVOVntIVFRQX0hPU1R9ID1+IC8kUmVnRXhwL2kgKSB7CiAgICAgICAgICAgICAgICAkVGhlbWUgPSAkRGVmYXVsdFRoZW1lSG9zdEJhc2VkLT57JFJlZ0V4cH07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBsb2NhdGUgdGVtcGxhdGUgZmlsZXMKICAgICRTZWxmLT57VGVtcGxhdGVEaXJ9ICAgICAgICAgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RlbXBsYXRlRGlyJykgLiAnL0hUTUwvVGVtcGxhdGVzLycgLiAkVGhlbWU7CiAgICAkU2VsZi0+e1N0YW5kYXJkVGVtcGxhdGVEaXJ9ID0gJENvbmZpZ09iamVjdC0+R2V0KCdUZW1wbGF0ZURpcicpIC4gJy9IVE1ML1RlbXBsYXRlcy8nIC4gJ1N0YW5kYXJkJzsKCiAgICAjIENoZWNrIGlmICdTdGFuZGFyZCcgZmFsbGJhY2sgZXhpc3RzCiAgICBpZiAoICEtZSAkU2VsZi0+e1N0YW5kYXJkVGVtcGxhdGVEaXJ9ICkgewogICAgICAgICRTZWxmLT5GYXRhbERpZSgKICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgIk5vIGV4aXN0aW5nIHRlbXBsYXRlIGRpcmVjdG9yeSBmb3VuZCAoJyRTZWxmLT57VGVtcGxhdGVEaXJ9JykhIENoZWNrIHlvdXIgSG9tZSBpbiBLZXJuZWwvQ29uZmlnLnBtLiIKICAgICAgICApOwogICAgfQoKICAgICMgS0lYQ29yZS1jYXBlSVQKICAgIG15ICRUaGVtZVBhdGggICA9ICRTZWxmLT57VGVtcGxhdGVEaXJ9OwogICAgbXkgJEhvbWVEaXIgICAgID0gJENvbmZpZ09iamVjdC0+R2V0KCdIb21lJyk7CiAgICBteSAkVGhlbWVLSVhEaXIgPSAnJzsKICAgICRUaGVtZVBhdGggPX4gcy8kSG9tZURpci8vZzsKCiAgICBmb3IgbXkgJFRoZW1lRGlyIChASU5DKSB7CiAgICAgICAgJFRoZW1lS0lYRGlyID0gJFRoZW1lRGlyIC4gJFRoZW1lUGF0aDsKICAgICAgICBsYXN0IGlmICggLWUgJFRoZW1lS0lYRGlyICkKICAgIH0KCiAgICAjIGlmICggIS1lICRTZWxmLT57VGVtcGxhdGVEaXJ9ICkgewogICAgaWYgKCAhLWUgKCAkVGhlbWVLSVhEaXIgfHwgJFNlbGYtPntUZW1wbGF0ZURpcn0gKSApIHsKCiAgICAgICAgIyBFTyBLSVhDb3JlLWNhcGVJVAogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAiTm8gZXhpc3RpbmcgdGVtcGxhdGUgZGlyZWN0b3J5IGZvdW5kICgnJFNlbGYtPntUZW1wbGF0ZURpcn0nKSEuCiAgICAgICAgICAgICAgICBEZWZhdWx0IHRoZW1lIHVzZWQgaW5zdGVhZC4iLAogICAgICAgICk7CgogICAgICAgICMgU2V0IFRlbXBsYXRlRGlyIHRvICdTdGFuZGFyZCcgYXMgYSBmYWxsYmFjay4KICAgICAgICAkVGhlbWUgPSAnU3RhbmRhcmQnOwogICAgICAgICRTZWxmLT57VGVtcGxhdGVEaXJ9ID0gJFNlbGYtPntTdGFuZGFyZFRlbXBsYXRlRGlyfTsKICAgIH0KCiAgICAkU2VsZi0+e0N1c3RvbVRlbXBsYXRlRGlyfSAgICAgICAgID0gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21UZW1wbGF0ZURpcicpIC4gJy9IVE1ML1RlbXBsYXRlcy8nIC4gJFRoZW1lOwogICAgJFNlbGYtPntDdXN0b21TdGFuZGFyZFRlbXBsYXRlRGlyfSA9ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tVGVtcGxhdGVEaXInKSAuICcvSFRNTC9UZW1wbGF0ZXMvJyAuICdTdGFuZGFyZCc7CgogICAgIyBnZXQgbWFpbiBvYmplY3QKICAgIG15ICRNYWluT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKTsKCiAgICAjIGxvYWQgc3ViIGxheW91dCBmaWxlcwogICAgIyBLSVhDb3JlLWNhcGVJVAogICAgbXkgJExheW91dFBhdGggICAgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RlbXBsYXRlRGlyJykgLiAnL0hUTUwvTGF5b3V0JzsKICAgIG15ICRIb21lICAgICAgICAgID0gJENvbmZpZ09iamVjdC0+R2V0KCdIb21lJyk7CiAgICBteSAkTGF5b3V0UGF0aEtJWCA9ICRMYXlvdXRQYXRoOwogICAgJExheW91dFBhdGhLSVggPX4gcy8kSG9tZS8vZzsKICAgIG15ICVMYXlvdXRGaWxlcyA9ICgpOwoKICAgIGZvciBteSAkSU5DRGlyICggcmV2ZXJzZSBASU5DICkgewogICAgICAgIG15ICRMYXlvdXREaXIgPSAkSU5DRGlyOwogICAgICAgICRMYXlvdXREaXIgPX4gcydccydcXHMnZzsKICAgICAgICBteSAkTmV3RGlyID0gIiRMYXlvdXREaXIkTGF5b3V0UGF0aEtJWCI7CiAgICAgICAgaWYgKCAtZSAiJE5ld0RpciIgKSB7CiAgICAgICAgICAgIG15IEBOZXdGaWxlcyA9ICRNYWluT2JqZWN0LT5EaXJlY3RvcnlSZWFkKAogICAgICAgICAgICAgICAgRGlyZWN0b3J5ID0+ICROZXdEaXIsCiAgICAgICAgICAgICAgICBGaWx0ZXIgICAgPT4gJyoucG0nLAogICAgICAgICAgICApOwogICAgICAgICAgICBmb3IgbXkgJE5ld0ZpbGUgKEBOZXdGaWxlcykgewogICAgICAgICAgICAgICAgaWYgKCAoICROZXdGaWxlICF+IC9MYXlvdXQucG0kLyApICYmICFleGlzdHMoICRMYXlvdXRGaWxlc3skTmV3RmlsZX0gKSApIHsKCiAgICAgICAgICAgICAgICAgICAgJE5ld0ZpbGUgPX4gc3tcQS4qXC8oLis/KS5wbVx6fXskMX14bXM7CiAgICAgICAgICAgICAgICAgICAgbXkgJE5ld0NsYXNzTmFtZSA9ICJLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0OjokTmV3RmlsZSI7CiAgICAgICAgICAgICAgICAgICAgaWYgKCAhJE1haW5PYmplY3QtPlJlcXVpcmVCYXNlQ2xhc3MoJE5ld0NsYXNzTmFtZSkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRTZWxmLT5GYXRhbERpZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gIkNvdWxkIG5vdCBsb2FkIGNsYXNzIEtlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQ6OiROZXdGaWxlLiIsCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRMYXlvdXRGaWxlc3skTmV3RmlsZX0gPSAkTmV3RmlsZTsKICAgICAgICAgICAgICAgICAgICBwdXNoIEBJU0EsICJLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0OjokTmV3RmlsZSI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBFTyBLSVhDb3JlLWNhcGVJVAoKICAgIG15ICROZXdEaXIgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RlbXBsYXRlRGlyJykgLiAnL0hUTUwvTGF5b3V0JzsKICAgIGlmICggLWUgJE5ld0RpciApIHsKICAgICAgICBteSBATmV3RmlsZXMgPSAkTWFpbk9iamVjdC0+RGlyZWN0b3J5UmVhZCgKICAgICAgICAgICAgRGlyZWN0b3J5ID0+ICROZXdEaXIsCiAgICAgICAgICAgIEZpbHRlciAgICA9PiAnKi5wbScsCiAgICAgICAgKTsKICAgICAgICBmb3IgbXkgJE5ld0ZpbGUgKEBOZXdGaWxlcykgewoKICAgICAgICAgICAgIyBLSVhDb3JlLWNhcGVJVAogICAgICAgICAgICAjIGlmICggJE5ld0ZpbGUgIX4gL0xheW91dC5wbSQvICkgewogICAgICAgICAgICBpZiAoICggJE5ld0ZpbGUgIX4gL0xheW91dC5wbSQvICkgJiYgIWV4aXN0cyggJExheW91dEZpbGVzeyROZXdGaWxlfSApICkgewoKICAgICAgICAgICAgICAgICMgRU8gS0lYQ29yZS1jYXBlSVQKCiAgICAgICAgICAgICAgICAkTmV3RmlsZSA9fiBze1xBLipcLyguKz8pLnBtXHp9eyQxfXhtczsKICAgICAgICAgICAgICAgIG15ICROZXdDbGFzc05hbWUgPSAiS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dDo6JE5ld0ZpbGUiOwogICAgICAgICAgICAgICAgaWYgKCAhJE1haW5PYmplY3QtPlJlcXVpcmVCYXNlQ2xhc3MoJE5ld0NsYXNzTmFtZSkgKSB7CiAgICAgICAgICAgICAgICAgICAgJFNlbGYtPkZhdGFsRGllKAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICJDb3VsZCBub3QgbG9hZCBjbGFzcyBLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0OjokTmV3RmlsZS4iLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBLSVhDb3JlLWNhcGVJVAogICAgICAgICAgICAgICAgJExheW91dEZpbGVzeyROZXdGaWxlfSA9ICROZXdGaWxlOwogICAgICAgICAgICAgICAgcHVzaCBASVNBLCAiS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dDo6JE5ld0ZpbGUiOwoKICAgICAgICAgICAgICAgICMgRU8gS0lYQ29yZS1jYXBlSVQKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBpZiAoICRTZWxmLT57U2Vzc2lvbklEfSAmJiAkU2VsZi0+e1VzZXJDaGFsbGVuZ2VUb2tlbn0gKSB7CiAgICAgICAgJFNlbGYtPntDaGFsbGVuZ2VUb2tlblBhcmFtfSA9ICJDaGFsbGVuZ2VUb2tlbj0kU2VsZi0+e1VzZXJDaGFsbGVuZ2VUb2tlbn07IjsKICAgIH0KCiAgICByZXR1cm4gJFNlbGY7Cn0KCnN1YiBTZXRFbnYgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBmb3IgKHF3KEtleSBWYWx1ZSkpIHsKICAgICAgICBpZiAoICFkZWZpbmVkICRQYXJhbXskX30gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICRfISIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJFNlbGYtPkZhdGFsRXJyb3IoKTsKICAgICAgICB9CiAgICB9CiAgICAkU2VsZi0+e0Vudk5ld1JlZn0tPnsgJFBhcmFte0tleX0gfSA9ICRQYXJhbXtWYWx1ZX07CiAgICByZXR1cm4gMTsKfQoKPWl0ZW0gQmxvY2soKQoKdXNlIGEgZHRsIGJsb2NrCgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnUm93JywKICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgVGltZSAgICAgPT4gJFJvd1swXSwKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJFJvd1sxXSwKICAgICAgICAgICAgRmFjaWxpdHkgPT4gJFJvd1syXSwKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJFJvd1szXSwKICAgICAgICB9LAogICAgKTsKCj1jdXQKCnN1YiBCbG9jayB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIGlmICggISRQYXJhbXtOYW1lfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgTmFtZSEnCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBwdXNoIEB7ICRTZWxmLT57QmxvY2tEYXRhfSB9LAogICAgICAgIHsKICAgICAgICBOYW1lID0+ICRQYXJhbXtOYW1lfSwKICAgICAgICBEYXRhID0+ICRQYXJhbXtEYXRhfSwKICAgICAgICB9Owp9Cgo9aXRlbSBKU09ORW5jb2RlKCkKCkVuY29kZSBwZXJsIGRhdGEgc3RydWN0dXJlIHRvIEpTT04gc3RyaW5nCgogICAgbXkgJEpTT04gPSAkTGF5b3V0T2JqZWN0LT5KU09ORW5jb2RlKAogICAgICAgIERhdGEgICAgICAgID0+ICREYXRhLAogICAgICAgIE5vUXVvdGVzICAgID0+IDB8MSwgIyBvcHRpb25hbDogbm8gZG91YmxlIHF1b3RlcyBhdCB0aGUgc3RhcnQgYW5kIHRoZSBlbmQgb2YgSlNPTiBzdHJpbmcKICAgICk7Cgo9Y3V0CgpzdWIgSlNPTkVuY29kZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgZm9yIG5lZWRlZCBkYXRhCiAgICByZXR1cm4gaWYgIWRlZmluZWQgJFBhcmFte0RhdGF9OwoKICAgICMgZ2V0IEpTT04gZW5jb2RlZCBkYXRhCiAgICBteSAkSlNPTiA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpKU09OJyktPkVuY29kZSgKICAgICAgICBEYXRhID0+ICRQYXJhbXtEYXRhfSwKICAgICkgfHwgJyIiJzsKCiAgICAjIHJlbW92ZSB0cmFpbGluZyBhbmQgdHJhaWxpbmcgZG91YmxlIHF1b3RlcyBpZiByZXF1ZXN0ZWQKICAgIGlmICggJFBhcmFte05vUXVvdGVzfSApIHsKICAgICAgICAkSlNPTiA9fiBzeyBcQSAiKC4qKSIgXHogfXskMX1zbXg7CiAgICB9CgogICAgcmV0dXJuICRKU09OOwp9Cgo9aXRlbSBSZWRpcmVjdCgpCgpyZXR1cm4gaHRtbCBmb3IgYnJvd3NlciB0byByZWRpcmVjdAoKICAgIG15ICRIVE1MID0gJExheW91dE9iamVjdC0+UmVkaXJlY3QoCiAgICAgICAgT1AgPT4gIkFjdGlvbj1BZG1pblVzZXJHcm91cDtTdWJhY3Rpb249VXNlcjtJRD0kVXNlcklEIiwKICAgICk7CgogICAgbXkgJEhUTUwgPSAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCgKICAgICAgICBFeHRVUkwgPT4gImh0dHA6Ly9zb21lLmV4YW1wbGUuY29tLyIsCiAgICApOwoKRHVyaW5nIGxvZ2luIGFjdGlvbiwgQzxMb2dpbiA9PiAxPiBzaG91bGQgYmUgcGFzc2VkIHRvIFJlZGlyZWN0KCksCndoaWNoIGluZGljYXRlcyB0aGF0IGlmIHRoZSBicm93c2VyIGhhcyBjb29raWUgc3VwcG9ydCwgaXQgaXMgT0sKZm9yIHRoZSBzZXNzaW9uIGNvb2tpZSB0byBiZSBub3QgeWV0IHNldC4KCj1jdXQKCnN1YiBSZWRpcmVjdCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgICMgYWRkIGNvb2tpZXMgaWYgZXhpc3RzCiAgICBteSAkQ29va2llcyA9ICcnOwogICAgaWYgKCAkU2VsZi0+e1NldENvb2tpZXN9ICYmICRDb25maWdPYmplY3QtPkdldCgnU2Vzc2lvblVzZUNvb2tpZScpICkgewogICAgICAgIGZvciAoIHNvcnQga2V5cyAleyAkU2VsZi0+e1NldENvb2tpZXN9IH0gKSB7CiAgICAgICAgICAgICRDb29raWVzIC49ICJTZXQtQ29va2llOiAkU2VsZi0+e1NldENvb2tpZXN9LT57JF99XG4iOwogICAgICAgIH0KICAgIH0KCiAgICAjIGNyZWF0ZSAmIHJldHVybiBvdXRwdXQKICAgIGlmICggJFBhcmFte0V4dFVSTH0gKSB7CgogICAgICAgICMgZXh0ZXJuYWwgcmVkaXJlY3QKICAgICAgICAkUGFyYW17UmVkaXJlY3R9ID0gJFBhcmFte0V4dFVSTH07CiAgICAgICAgcmV0dXJuICRDb29raWVzCiAgICAgICAgICAgIC4gJFNlbGYtPk91dHB1dCgKICAgICAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdSZWRpcmVjdCcsCiAgICAgICAgICAgIERhdGEgICAgICAgICA9PiBcJVBhcmFtCiAgICAgICAgICAgICk7CiAgICB9CgogICAgIyBzZXQgYmFzZWxpbmsKICAgICRQYXJhbXtSZWRpcmVjdH0gPSAkU2VsZi0+e0Jhc2VsaW5rfTsKCiAgICBpZiAoICRQYXJhbXtPUH0gKSB7CgogICAgICAgICMgRmlsdGVyIG91dCBoYXphcmRvdXMgY2hhcmFjdGVycwogICAgICAgIGlmICggJFBhcmFte09QfSA9fiBze1x4MDB9e31zbXhnICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAnU29tZW9uZSB0cmllcyB0byB1c2UgYSBudWxsIGJ5dGVzIChceDAwKSBjaGFyYWN0ZXIgaW4gcmVkaXJlY3QhJywKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIGlmICggJFBhcmFte09QfSA9fiBze1xyfXt9c214ZyApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ1NvbWVvbmUgdHJpZXMgdG8gdXNlIGEgY2FycmlhZ2UgcmV0dXJuIGNoYXJhY3RlciBpbiByZWRpcmVjdCEnLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgaWYgKCAkUGFyYW17T1B9ID1+IHN7XG59e31zbXhnICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAnU29tZW9uZSB0cmllcyB0byB1c2UgYSBuZXdsaW5lIGNoYXJhY3RlciBpbiByZWRpcmVjdCEnLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBpbnRlcm5hbCByZWRpcmVjdAogICAgICAgICRQYXJhbXtPUH0gPX4gcy9eLipcPyguKz8pJC8kMS87CiAgICAgICAgJFBhcmFte1JlZGlyZWN0fSAuPSAkUGFyYW17T1B9OwogICAgfQoKICAgICMgY2hlY2sgaWYgSUlTIDYgaXMgdXNlZCwgYWRkIGFic29sdXRlIHVybCBmb3IgSUlTIHdvcmthcm91bmQKICAgICMgc2VlIGFsc286CiAgICAjICBvIGh0dHA6Ly9idWdzLm90cnMub3JnL3Nob3dfYnVnLmNnaT9pZD0yMjMwCiAgICAjICBvIGh0dHA6Ly9idWdzLm90cnMub3JnL3Nob3dfYnVnLmNnaT9pZD05ODM1CiAgICAjICBvIGh0dHA6Ly9zdXBwb3J0Lm1pY3Jvc29mdC5jb20vZGVmYXVsdC5hc3B4P3NjaWQ9a2I7ZW4tdXM7MjIxMTU0CiAgICBpZiAoICRFTlZ7U0VSVkVSX1NPRlRXQVJFfSA9fiAvXm1pY3Jvc29mdFwtaWlzXC82L2kgKSB7CiAgICAgICAgbXkgJEhvc3QgPSAkRU5We0hUVFBfSE9TVH0gfHwgJENvbmZpZ09iamVjdC0+R2V0KCdGUUROJyk7CiAgICAgICAgbXkgJEh0dHBUeXBlID0gJENvbmZpZ09iamVjdC0+R2V0KCdIdHRwVHlwZScpOwogICAgICAgICRQYXJhbXtSZWRpcmVjdH0gPSAkSHR0cFR5cGUgLiAnOi8vJyAuICRIb3N0IC4gJFBhcmFte1JlZGlyZWN0fTsKICAgIH0KICAgIG15ICRPdXRwdXQgPSAkQ29va2llcwogICAgICAgIC4gJFNlbGYtPk91dHB1dCgKICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gJ1JlZGlyZWN0JywKICAgICAgICBEYXRhICAgICAgICAgPT4gXCVQYXJhbQogICAgICAgICk7CgogICAgIyBhZGQgc2Vzc2lvbiBpZCB0byByZWRpcmVjdCBpZiBubyBjb29raWUgaXMgZW5hYmxlZAogICAgaWYgKCAhJFNlbGYtPntTZXNzaW9uSURDb29raWV9ICYmICEoICRTZWxmLT57QnJvd3Nlckhhc0Nvb2tpZX0gJiYgJFBhcmFte0xvZ2lufSApICkgewoKICAgICAgICAjIHJld3JpdGUgbG9jYXRpb24gaGVhZGVyCiAgICAgICAgJE91dHB1dCA9fiBzewogICAgICAgICAgICAobG9jYXRpb246XHMpKC4qKQogICAgICAgIH0KICAgICAgICB7CiAgICAgICAgICAgIG15ICRTdGFydCAgPSAkMTsKICAgICAgICAgICAgbXkgJFRhcmdldCA9ICQyOwogICAgICAgICAgICBteSAkRW5kID0gJyc7CiAgICAgICAgICAgIGlmICgkVGFyZ2V0ID1+IC9eKC4rPykjKHwuKz8pJC8pIHsKICAgICAgICAgICAgICAgICRUYXJnZXQgPSAkMTsKICAgICAgICAgICAgICAgICRFbmQgPSAiIyQyIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoJFRhcmdldCA9fiAvaHR0cC9pIHx8ICEkU2VsZi0+e1Nlc3Npb25JRH0pIHsKICAgICAgICAgICAgICAgICIkU3RhcnQkVGFyZ2V0JEVuZCI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoJFRhcmdldCA9fiAvKFw/fCYpJC8pIHsKICAgICAgICAgICAgICAgICAgICAiJFN0YXJ0JFRhcmdldCRTZWxmLT57U2Vzc2lvbk5hbWV9PSRTZWxmLT57U2Vzc2lvbklEfSRFbmQiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzaWYgKCRUYXJnZXQgIX4gL1w/LykgewogICAgICAgICAgICAgICAgICAgICIkU3RhcnQkVGFyZ2V0PyRTZWxmLT57U2Vzc2lvbk5hbWV9PSRTZWxmLT57U2Vzc2lvbklEfSRFbmQiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzaWYgKCRUYXJnZXQgPX4gL1w/LykgewogICAgICAgICAgICAgICAgICAgICIkU3RhcnQkVGFyZ2V0JiRTZWxmLT57U2Vzc2lvbk5hbWV9PSRTZWxmLT57U2Vzc2lvbklEfSRFbmQiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgIiRTdGFydCRUYXJnZXQ/JiRTZWxmLT57U2Vzc2lvbk5hbWV9PSRTZWxmLT57U2Vzc2lvbklEfSRFbmQiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfWllZ3g7CiAgICB9CiAgICByZXR1cm4gJE91dHB1dDsKfQoKc3ViIExvZ2luIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBzZXQgQWN0aW9uIHBhcmFtZXRlciBmb3IgdGhlIGxvYWRlcgogICAgJFNlbGYtPntBY3Rpb259ID0gJ0xvZ2luJzsKCiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICBteSAkT3V0cHV0ID0gJyc7CiAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnU2Vzc2lvblVzZUNvb2tpZScpICkgewoKICAgICAgICAjIGFsd2F5cyBzZXQgYSBjb29raWUsIHNvIHRoYXQgYXQgdGhlIHRpbWUgdGhlIHVzZXIgc3VibWl0cwogICAgICAgICMgdGhlIHBhc3N3b3JkLCB3ZSBrbm93IGFscmVhZHkgaWYgdGhlIGJyb3dzZXIgc3VwcG9ydHMgY29va2llcy4KICAgICAgICAjICggdGhlIHNlc3Npb24gY29va2llIGlzbid0IGF2YWlsYWJsZSBhdCB0aGF0IHRpbWUgKS4KICAgICAgICBteSAkQ29va2llU2VjdXJlQXR0cmlidXRlID0gMDsKICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnSHR0cFR5cGUnKSBlcSAnaHR0cHMnICkgewoKICAgICAgICAgICAgIyBSZXN0cmljdCBDb29raWUgdG8gSFRUUFMgaWYgaXQgaXMgdXNlZC4KICAgICAgICAgICAgJENvb2tpZVNlY3VyZUF0dHJpYnV0ZSA9IDE7CiAgICAgICAgfQogICAgICAgICRTZWxmLT57U2V0Q29va2llc30tPntPVFJTQnJvd3Nlckhhc0Nvb2tpZX0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0JyktPlNldENvb2tpZSgKICAgICAgICAgICAgS2V5ICAgICAgPT4gJ09UUlNCcm93c2VySGFzQ29va2llJywKICAgICAgICAgICAgVmFsdWUgICAgPT4gMSwKICAgICAgICAgICAgRXhwaXJlcyAgPT4gJzF5JywKICAgICAgICAgICAgUGF0aCAgICAgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdTY3JpcHRBbGlhcycpLAogICAgICAgICAgICBTZWN1cmUgICA9PiAkQ29va2llU2VjdXJlQXR0cmlidXRlLAogICAgICAgICAgICBIdHRwT25seSA9PiAxLAogICAgICAgICk7CiAgICB9CgogICAgIyBhZGQgY29va2llcyBpZiBleGlzdHMKICAgIGlmICggJFNlbGYtPntTZXRDb29raWVzfSAmJiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1Nlc3Npb25Vc2VDb29raWUnKSApIHsKICAgICAgICBmb3IgKCBzb3J0IGtleXMgJXsgJFNlbGYtPntTZXRDb29raWVzfSB9ICkgewogICAgICAgICAgICAkT3V0cHV0IC49ICJTZXQtQ29va2llOiAkU2VsZi0+e1NldENvb2tpZXN9LT57JF99XG4iOwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCBtZXNzYWdlIG9mIHRoZSBkYXkKICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdTaG93TW90ZCcpICkgewogICAgICAgICRQYXJhbXtNb3RkfSA9ICRTZWxmLT5PdXRwdXQoCiAgICAgICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnTW90ZCcsCiAgICAgICAgICAgIERhdGEgICAgICAgICA9PiBcJVBhcmFtCiAgICAgICAgKTsKICAgIH0KCiAgICAjIEdlbmVyYXRlIHRoZSBtaW5pZmllZCBDU1MgYW5kIEphdmFTY3JpcHQgZmlsZXMgYW5kIHRoZSB0YWdzIHJlZmVyZW5jaW5nIHRoZW0gKHNlZSBMYXlvdXRMb2FkZXIpCiAgICAkU2VsZi0+TG9hZGVyQ3JlYXRlQWdlbnRDU1NDYWxscygpOwogICAgJFNlbGYtPkxvYWRlckNyZWF0ZUFnZW50SlNDYWxscygpOwoKICAgICMgQWRkIGhlYWRlciBsb2dvLCBpZiBjb25maWd1cmVkCiAgICBpZiAoIGRlZmluZWQgJENvbmZpZ09iamVjdC0+R2V0KCdBZ2VudExvZ28nKSApIHsKICAgICAgICBteSAlQWdlbnRMb2dvID0gJXsgJENvbmZpZ09iamVjdC0+R2V0KCdBZ2VudExvZ28nKSB9OwogICAgICAgIG15ICVEYXRhOwoKICAgICAgICBmb3IgbXkgJENTU1N0YXRlbWVudCAoIHNvcnQga2V5cyAlQWdlbnRMb2dvICkgewogICAgICAgICAgICBpZiAoICRDU1NTdGF0ZW1lbnQgZXEgJ1VSTCcgKSB7CiAgICAgICAgICAgICAgICBteSAkV2ViUGF0aCA9ICcnOwogICAgICAgICAgICAgICAgaWYgKCAkQWdlbnRMb2dveyRDU1NTdGF0ZW1lbnR9ICF+IC8oaHR0cHxmdHB8aHR0cHMpOlwvL2kgKSB7CiAgICAgICAgICAgICAgICAgICAgJFdlYlBhdGggPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0Zyb250ZW5kOjpXZWJQYXRoJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkRGF0YXsnVVJMJ30gPSAndXJsKCcgLiAkV2ViUGF0aCAuICRBZ2VudExvZ297JENTU1N0YXRlbWVudH0gLiAnKSc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkRGF0YXskQ1NTU3RhdGVtZW50fSA9ICRBZ2VudExvZ297JENTU1N0YXRlbWVudH07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnSGVhZGVyTG9nb0NTUycsCiAgICAgICAgICAgIERhdGEgPT4gXCVEYXRhLAogICAgICAgICk7CiAgICB9CgogICAgIyBhZGQgbG9naW4gbG9nbywgaWYgY29uZmlndXJlZAogICAgaWYgKCBkZWZpbmVkICRDb25maWdPYmplY3QtPkdldCgnQWdlbnRMb2dpbkxvZ28nKSApIHsKICAgICAgICBteSAlQWdlbnRMb2dpbkxvZ28gPSAleyAkQ29uZmlnT2JqZWN0LT5HZXQoJ0FnZW50TG9naW5Mb2dvJykgfTsKICAgICAgICBteSAlRGF0YTsKCiAgICAgICAgZm9yIG15ICRDU1NTdGF0ZW1lbnQgKCBzb3J0IGtleXMgJUFnZW50TG9naW5Mb2dvICkgewogICAgICAgICAgICBpZiAoICRDU1NTdGF0ZW1lbnQgZXEgJ1VSTCcgKSB7CiAgICAgICAgICAgICAgICBteSAkV2ViUGF0aCA9ICRDb25maWdPYmplY3QtPkdldCgnRnJvbnRlbmQ6OldlYlBhdGgnKTsKICAgICAgICAgICAgICAgICREYXRheydVUkwnfSA9ICd1cmwoJyAuICRXZWJQYXRoIC4gJEFnZW50TG9naW5Mb2dveyRDU1NTdGF0ZW1lbnR9IC4gJyknOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJERhdGF7JENTU1N0YXRlbWVudH0gPSAkQWdlbnRMb2dpbkxvZ297JENTU1N0YXRlbWVudH07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnTG9naW5Mb2dvQ1NTJywKICAgICAgICAgICAgRGF0YSA9PiBcJURhdGEsCiAgICAgICAgKTsKCiAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdMb2dpbkxvZ28nCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGdldCBzeXN0ZW0gbWFpbnRlbmFuY2Ugb2JqZWN0CiAgICBteSAkU3lzdGVtTWFpbnRlbmFuY2VPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6U3lzdGVtTWFpbnRlbmFuY2UnKTsKCiAgICBteSAkQWN0aXZlTWFpbnRlbmFuY2UgPSAkU3lzdGVtTWFpbnRlbmFuY2VPYmplY3QtPlN5c3RlbU1haW50ZW5hbmNlSXNBY3RpdmUoKTsKCiAgICAjIGNoZWNrIGlmIHN5c3RlbSBtYWludGVuYW5jZSBpcyBhY3RpdmUKICAgIGlmICgkQWN0aXZlTWFpbnRlbmFuY2UpIHsKICAgICAgICBteSAkU3lzdGVtTWFpbnRlbmFuY2VEYXRhID0gJFN5c3RlbU1haW50ZW5hbmNlT2JqZWN0LT5TeXN0ZW1NYWludGVuYW5jZUdldCgKICAgICAgICAgICAgSUQgICAgID0+ICRBY3RpdmVNYWludGVuYW5jZSwKICAgICAgICAgICAgVXNlcklEID0+IDEsCiAgICAgICAgKTsKCiAgICAgICAgaWYgKCAkU3lzdGVtTWFpbnRlbmFuY2VEYXRhLT57U2hvd0xvZ2luTWVzc2FnZX0gKSB7CgogICAgICAgICAgICBteSAkTG9naW5NZXNzYWdlID0KICAgICAgICAgICAgICAgICRTeXN0ZW1NYWludGVuYW5jZURhdGEtPntMb2dpbk1lc3NhZ2V9CiAgICAgICAgICAgICAgICB8fCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1N5c3RlbU1haW50ZW5hbmNlOjpJc0FjdGl2ZURlZmF1bHRMb2dpbk1lc3NhZ2UnKQogICAgICAgICAgICAgICAgfHwgIlN5c3RlbSBtYWludGVuYW5jZSBpcyBhY3RpdmUsIG5vdCBwb3NzaWJsZSB0byBwZXJmb3JtIGEgbG9naW4hIjsKCiAgICAgICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1N5c3RlbU1haW50ZW5hbmNlJywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgIExvZ2luTWVzc2FnZSA9PiAkTG9naW5NZXNzYWdlLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgIyBzaG93IHByZWxvZ2luIGJsb2NrLCBpZiBpbiBwcmVsb2dpbiBtb2RlIChlLmcuIFNTTyBsb2dpbikKICAgIGlmICggZGVmaW5lZCAkUGFyYW17J01vZGUnfSAmJiAkUGFyYW17J01vZGUnfSBlcSAnUHJlTG9naW4nICkgewogICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnUHJlTG9naW4nLAogICAgICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGlmIG5vdCBpbiBQcmVMb2dpbiBtb2RlLCBzaG93IG5vcm1hbCBsb2dpbiBmb3JtCiAgICBlbHNlIHsKCiAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdMb2dpbkJveCcsCiAgICAgICAgICAgIERhdGEgPT4gXCVQYXJhbSwKICAgICAgICApOwoKICAgICAgICAjIHNob3cgMiBmYWN0b3IgcGFzc3dvcmQgaW5wdXQgaWYgd2UgaGF2ZSBhdCBsZWFzdCBvbmUgYmFja2VuZCBlbmFibGVkCiAgICAgICAgQ09VTlQ6CiAgICAgICAgZm9yIG15ICRDb3VudCAoICcnLCAxIC4uIDEwICkgewogICAgICAgICAgICBuZXh0IENPVU5UIGlmICEkQ29uZmlnT2JqZWN0LT5HZXQoIkF1dGhUd29GYWN0b3JNb2R1bGUkQ291bnQiKTsKCiAgICAgICAgICAgICMgaWYgbm8gZW1wdHkgc2hhcmVkIHNlY3JldHMgYXJlIGFsbG93ZWQsIGlucHV0IGlzIG1hbmRhdG9yeQogICAgICAgICAgICBteSAlTWFuZGF0b3J5T3B0aW9uczsKICAgICAgICAgICAgaWYgKCAhJENvbmZpZ09iamVjdC0+R2V0KCJBdXRoVHdvRmFjdG9yTW9kdWxlJHtDb3VudH06OkFsbG93RW1wdHlTZWNyZXQiKSApIHsKICAgICAgICAgICAgICAgICVNYW5kYXRvcnlPcHRpb25zID0gKAogICAgICAgICAgICAgICAgICAgIE1hbmRhdG9yeUNsYXNzICAgPT4gJ01hbmRhdG9yeScsCiAgICAgICAgICAgICAgICAgICAgVmFsaWRhdGVSZXF1aXJlZCA9PiAnVmFsaWRhdGVfUmVxdWlyZWQnLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnQXV0aFR3b0ZhY3RvcicsCiAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICAgICAgJU1hbmRhdG9yeU9wdGlvbnMsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCVNYW5kYXRvcnlPcHRpb25zKSB7CiAgICAgICAgICAgICAgICAkU2VsZi0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnQXV0aFR3b0ZhY3Rvck1hbmRhdG9yeScsCiAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGFzdCBDT1VOVDsKICAgICAgICB9CgogICAgICAgICMgZ2V0IGxvc3QgcGFzc3dvcmQKICAgICAgICBpZiAoCiAgICAgICAgICAgICRDb25maWdPYmplY3QtPkdldCgnTG9zdFBhc3N3b3JkJykKICAgICAgICAgICAgJiYgJENvbmZpZ09iamVjdC0+R2V0KCdBdXRoTW9kdWxlJykgZXEgJ0tlcm5lbDo6U3lzdGVtOjpBdXRoOjpEQicKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnTG9zdFBhc3N3b3JkTGluaycsCiAgICAgICAgICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAkU2VsZi0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdMb3N0UGFzc3dvcmQnLAogICAgICAgICAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIGNyZWF0ZSAmIHJldHVybiBvdXRwdXQKICAgICRPdXRwdXQgLj0gJFNlbGYtPk91dHB1dCgKICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gJ0xvZ2luJywKICAgICAgICBEYXRhICAgICAgICAgPT4gXCVQYXJhbQogICAgKTsKCiAgICAjIHJlbW92ZSB0aGUgdmVyc2lvbiB0YWcgZnJvbSB0aGUgaGVhZGVyIGlmIGNvbmZpZ3VyZWQKICAgICRTZWxmLT5fRGlzYWJsZUJhbm5lckNoZWNrKCBPdXRwdXRSZWYgPT4gXCRPdXRwdXQgKTsKCiAgICByZXR1cm4gJE91dHB1dDsKfQoKc3ViIENoYWxsZW5nZVRva2VuQ2hlY2sgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIHJldHVybiBpZiBmZWF0dXJlIGlzIGRpc2FibGVkCiAgICByZXR1cm4gMSBpZiAhJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdTZXNzaW9uQ1NSRlByb3RlY3Rpb24nKTsKCiAgICAjIGdldCBjaGFsbGVuZ2UgdG9rZW4gYW5kIGNoZWNrIGl0CiAgICBteSAkQ2hhbGxlbmdlVG9rZW4gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0JyktPkdldFBhcmFtKCBQYXJhbSA9PiAnQ2hhbGxlbmdlVG9rZW4nICkgfHwgJyc7CgogICAgIyBjaGVjayByZWd1bGFyIENoYWxsZW5nZVRva2VuCiAgICByZXR1cm4gMSBpZiAkQ2hhbGxlbmdlVG9rZW4gZXEgJFNlbGYtPntVc2VyQ2hhbGxlbmdlVG9rZW59OwoKICAgICMgY2hlY2sgQ2hhbGxlbmdlVG9rZW4gb2YgYWxsIG93biBzZXNzaW9ucwogICAgbXkgJFNlc3Npb25PYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6QXV0aFNlc3Npb24nKTsKICAgIG15IEBTZXNzaW9ucyAgICAgID0gJFNlc3Npb25PYmplY3QtPkdldEFsbFNlc3Npb25JRHMoKTsKCiAgICBTRVNTSU9OOgogICAgZm9yIG15ICRTZXNzaW9uSUQgKEBTZXNzaW9ucykgewogICAgICAgIG15ICVEYXRhID0gJFNlc3Npb25PYmplY3QtPkdldFNlc3Npb25JRERhdGEoIFNlc3Npb25JRCA9PiAkU2Vzc2lvbklEICk7CiAgICAgICAgbmV4dCBTRVNTSU9OIGlmICEkRGF0YXtVc2VySUR9OwogICAgICAgIG5leHQgU0VTU0lPTiBpZiAkRGF0YXtVc2VySUR9IG5lICRTZWxmLT57VXNlcklEfTsKICAgICAgICBuZXh0IFNFU1NJT04gaWYgISREYXRhe1VzZXJDaGFsbGVuZ2VUb2tlbn07CgogICAgICAgICMgY2hlY2sgQ2hhbGxlbmdlVG9rZW4KICAgICAgICByZXR1cm4gMSBpZiAkQ2hhbGxlbmdlVG9rZW4gZXEgJERhdGF7VXNlckNoYWxsZW5nZVRva2VufTsKICAgIH0KCiAgICAjIG5vIHZhbGlkIHRva2VuIGZvdW5kCiAgICBpZiAoICRQYXJhbXtUeXBlfSAmJiBsYyAkUGFyYW17VHlwZX0gZXEgJ2N1c3RvbWVyJyApIHsKICAgICAgICAkU2VsZi0+Q3VzdG9tZXJGYXRhbEVycm9yKAogICAgICAgICAgICBNZXNzYWdlID0+ICdJbnZhbGlkIENoYWxsZW5nZSBUb2tlbiEnLAogICAgICAgICk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkU2VsZi0+RmF0YWxFcnJvcigKICAgICAgICAgICAgTWVzc2FnZSA9PiAnSW52YWxpZCBDaGFsbGVuZ2UgVG9rZW4hJywKICAgICAgICApOwogICAgfQoKICAgIHJldHVybjsKfQoKc3ViIEZhdGFsRXJyb3IgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIFByZXZlbnQgZW5kbGVzcyByZWN1cnNpb24gaW4gY2FzZSBvZiBwcm9ibGVtcyB3aXRoIFRlbXBsYXRlIGVuZ2luZS4KICAgIHJldHVybiBpZiAoICRTZWxmLT57SW5GYXRhbEVycm9yfSsrICk7CgogICAgaWYgKCAkUGFyYW17TWVzc2FnZX0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIENhbGxlciAgID0+IDEsCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICRQYXJhbXtNZXNzYWdlfSwKICAgICAgICApOwogICAgfQogICAgbXkgJE91dHB1dCA9ICRTZWxmLT5IZWFkZXIoCiAgICAgICAgQXJlYSAgPT4gJ0Zyb250ZW5kJywKICAgICAgICBUaXRsZSA9PiAnRmF0YWwgRXJyb3InCiAgICApOwogICAgJE91dHB1dCAuPSAkU2VsZi0+RXJyb3IoJVBhcmFtKTsKICAgICRPdXRwdXQgLj0gJFNlbGYtPkZvb3RlcigpOwogICAgJFNlbGYtPlByaW50KCBPdXRwdXQgPT4gXCRPdXRwdXQgKTsKICAgIGV4aXQ7Cn0KCnN1YiBTZWN1cmVNb2RlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJE91dHB1dCA9ICRTZWxmLT5IZWFkZXIoCiAgICAgICAgQXJlYSAgPT4gJ0Zyb250ZW5kJywKICAgICAgICBUaXRsZSA9PiAnU2VjdXJlIE1vZGUnCiAgICApOwogICAgJE91dHB1dCAuPSAkU2VsZi0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQWRtaW5TZWN1cmVNb2RlJywKICAgICAgICBEYXRhICAgICAgICAgPT4gXCVQYXJhbQogICAgKTsKICAgICRPdXRwdXQgLj0gJFNlbGYtPkZvb3RlcigpOwogICAgcmV0dXJuICRPdXRwdXQ7Cn0KCnN1YiBGYXRhbERpZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIGlmICggJFBhcmFte01lc3NhZ2V9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBDYWxsZXIgICA9PiAxLAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAkUGFyYW17TWVzc2FnZX0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGdldCBiYWNrZW5kIGVycm9yIG1lc3NhZ2VzCiAgICBmb3IgKHF3KE1lc3NhZ2UgVHJhY2ViYWNrKSkgewogICAgICAgIG15ICRCYWNrZW5kID0gJ0JhY2tlbmQnIC4gJF87CiAgICAgICAgJFBhcmFteyRCYWNrZW5kfSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+R2V0TG9nRW50cnkoCiAgICAgICAgICAgIFR5cGUgPT4gJ0Vycm9yJywKICAgICAgICAgICAgV2hhdCA9PiAkXwogICAgICAgICkgfHwgJyc7CiAgICAgICAgJFBhcmFteyRCYWNrZW5kfSA9ICRTZWxmLT5Bc2NpaTJIdG1sKAogICAgICAgICAgICBUZXh0ICAgICAgICAgICA9PiAkUGFyYW17JEJhY2tlbmR9LAogICAgICAgICAgICBIVE1MUmVzdWx0TW9kZSA9PiAxLAogICAgICAgICk7CiAgICB9CiAgICBpZiAoICEkUGFyYW17TWVzc2FnZX0gKSB7CiAgICAgICAgJFBhcmFte01lc3NhZ2V9ID0gJFBhcmFte0JhY2tlbmRNZXNzYWdlfTsKICAgIH0KICAgIGRpZSAkUGFyYW17TWVzc2FnZX07Cn0KCnN1YiBFcnJvclNjcmVlbiB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRPdXRwdXQgPSAkU2VsZi0+SGVhZGVyKCBUaXRsZSA9PiAnRXJyb3InICk7CiAgICAkT3V0cHV0IC49ICRTZWxmLT5FcnJvciglUGFyYW0pOwogICAgJE91dHB1dCAuPSAkU2VsZi0+Rm9vdGVyKCk7CiAgICByZXR1cm4gJE91dHB1dDsKfQoKc3ViIEVycm9yIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgYmFja2VuZCBlcnJvciBtZXNzYWdlcwogICAgZm9yIChxdyhNZXNzYWdlIFRyYWNlYmFjaykpIHsKICAgICAgICBteSAkQmFja2VuZCA9ICdCYWNrZW5kJyAuICRfOwogICAgICAgICRQYXJhbXskQmFja2VuZH0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkdldExvZ0VudHJ5KAogICAgICAgICAgICBUeXBlID0+ICdFcnJvcicsCiAgICAgICAgICAgIFdoYXQgPT4gJF8KICAgICAgICApIHx8ICcnOwogICAgfQogICAgaWYgKCAhJFBhcmFte0JhY2tlbmRNZXNzYWdlfSAmJiAhJFBhcmFte0JhY2tlbmRUcmFjZWJhY2t9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAkUGFyYW17TWVzc2FnZX0gfHwgJz8nLAogICAgICAgICk7CiAgICAgICAgZm9yIChxdyhNZXNzYWdlIFRyYWNlYmFjaykpIHsKICAgICAgICAgICAgbXkgJEJhY2tlbmQgPSAnQmFja2VuZCcgLiAkXzsKICAgICAgICAgICAgJFBhcmFteyRCYWNrZW5kfSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+R2V0TG9nRW50cnkoCiAgICAgICAgICAgICAgICBUeXBlID0+ICdFcnJvcicsCiAgICAgICAgICAgICAgICBXaGF0ID0+ICRfCiAgICAgICAgICAgICkgfHwgJyc7CiAgICAgICAgfQogICAgfQogICAgaWYgKCAhJFBhcmFte01lc3NhZ2V9ICkgewogICAgICAgICRQYXJhbXtNZXNzYWdlfSA9ICRQYXJhbXtCYWNrZW5kTWVzc2FnZX07CiAgICB9CiAgICAkUGFyYW17TWVzc2FnZX0gPX4gcy9eKC57MjAwfSkuKiQvJHsxfVsuLi5dL2dzOwoKICAgIGlmICggJFBhcmFte0JhY2tlbmRUcmFjZWJhY2t9ICkgewogICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnU2hvd0JhY2tlbmRUcmFjZWJhY2snLAogICAgICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGNyZWF0ZSAmIHJldHVybiBvdXRwdXQKICAgIGlmICggJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdTZWN1cmVNb2RlJykgKSB7CiAgICAgICAgJFBhcmFte09UUlNCdXNpbmVzc0lzSW5zdGFsbGVkfSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpPVFJTQnVzaW5lc3MnKS0+T1RSU0J1c2luZXNzSXNJbnN0YWxsZWQoKTsKICAgIH0KCiAgICAjIGNyZWF0ZSAmIHJldHVybiBvdXRwdXQKICAgIHJldHVybiAkU2VsZi0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnRXJyb3InLAogICAgICAgIERhdGEgICAgICAgICA9PiBcJVBhcmFtCiAgICApOwp9CgpzdWIgV2FybmluZyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IGJhY2tlbmQgZXJyb3IgbWVzc2FnZXMKICAgICRQYXJhbXtCYWNrZW5kTWVzc2FnZX0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkdldExvZ0VudHJ5KAogICAgICAgIFR5cGUgPT4gJ05vdGljZScsCiAgICAgICAgV2hhdCA9PiAnTWVzc2FnZScsCiAgICAgICAgKQogICAgICAgIHx8ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+R2V0TG9nRW50cnkoCiAgICAgICAgVHlwZSA9PiAnRXJyb3InLAogICAgICAgIFdoYXQgPT4gJ01lc3NhZ2UnLAogICAgICAgICkgfHwgJyc7CgogICAgaWYgKCAhJFBhcmFte01lc3NhZ2V9ICkgewogICAgICAgICRQYXJhbXtNZXNzYWdlfSA9ICRQYXJhbXtCYWNrZW5kTWVzc2FnZX07CiAgICB9CgogICAgIyBjcmVhdGUgJiByZXR1cm4gb3V0cHV0CiAgICByZXR1cm4gJFNlbGYtPk91dHB1dCgKICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gJ1dhcm5pbmcnLAogICAgICAgIERhdGEgICAgICAgICA9PiBcJVBhcmFtCiAgICApOwp9Cgo9aXRlbSBOb3RpZnkoKQoKY3JlYXRlIG5vdGlmeSBsaW5lcwoKICAgIGluZm9zLCB0aGUgdGV4dCB3aWxsIGJlIHRyYW5zbGF0ZWQKCiAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+Tm90aWZ5KAogICAgICAgIFByaW9yaXR5ID0+ICdXYXJuaW5nJywKICAgICAgICBJbmZvID0+ICdTb21lIEluZm8gTWVzc2FnZScsCiAgICApOwoKICAgIGRhdGEgd2l0aCBsaW5rLCB0aGUgdGV4dCB3aWxsIGJlIHRyYW5zbGF0ZWQKCiAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+Tm90aWZ5KAogICAgICAgIFByaW9yaXR5ICA9PiAnV2FybmluZycsCiAgICAgICAgRGF0YSAgICAgID0+ICdUZW1wbGF0ZSBjb250ZW50JywKICAgICAgICBMaW5rICAgICAgPT4gJ2h0dHA6Ly9leGFtcGxlLmNvbS8nLAogICAgICAgIExpbmtDbGFzcyA9PiAnc29tZV9DU1NfY2xhc3MnLCAgICAgICAgICAgICAgIyBvcHRpb25hbAogICAgKTsKCiAgICBlcnJvcnMsIHRoZSB0ZXh0IHdpbGwgYmUgdHJhbnNsYXRlZAoKICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5Ob3RpZnkoCiAgICAgICAgUHJpb3JpdHkgPT4gJ0Vycm9yJywKICAgICAgICBJbmZvID0+ICdTb21lIEVycm9yIE1lc3NhZ2UnLAogICAgKTsKCiAgICBlcnJvcnMgZnJvbSBsb2cgYmFja2VuZCwgaWYgbm8gZXJyb3IgZXh0aXN0cywgYSAnJyB3aWxsIGJlIHJldHVybmVkCgogICAgbXkgJE91dHB1dCA9ICRMYXlvdXRPYmplY3QtPk5vdGlmeSgKICAgICAgICBQcmlvcml0eSA9PiAnRXJyb3InLAogICAgKTsKCj1jdXQKCnN1YiBOb3RpZnkgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNyZWF0ZSAmIHJldHVybiBvdXRwdXQKICAgIGlmICggISRQYXJhbXtJbmZvfSAmJiAhJFBhcmFte0RhdGF9ICkgewogICAgICAgICRQYXJhbXtCYWNrZW5kTWVzc2FnZX0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkdldExvZ0VudHJ5KAogICAgICAgICAgICBUeXBlID0+ICdOb3RpY2UnLAogICAgICAgICAgICBXaGF0ID0+ICdNZXNzYWdlJywKICAgICAgICAgICAgKQogICAgICAgICAgICB8fCAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkdldExvZ0VudHJ5KAogICAgICAgICAgICBUeXBlID0+ICdFcnJvcicsCiAgICAgICAgICAgIFdoYXQgPT4gJ01lc3NhZ2UnLAogICAgICAgICAgICApIHx8ICcnOwoKICAgICAgICAkUGFyYW17SW5mb30gPSAkUGFyYW17QmFja2VuZE1lc3NhZ2V9OwoKICAgICAgICAjIHJldHVybiBpZiB3ZSBoYXZlIG5vdGhpbmcgdG8gc2hvdwogICAgICAgIHJldHVybiAnJyBpZiAhJFBhcmFte0luZm99OwogICAgfQoKICAgIG15ICRCb3hDbGFzcyA9ICdOb3RpY2UnOwoKICAgIGlmICggJFBhcmFte0luZm99ICkgewogICAgICAgICRQYXJhbXtJbmZvfSA9fiBzL1xuLy9nOwogICAgfQogICAgaWYgKCAkUGFyYW17UHJpb3JpdHl9ICYmICRQYXJhbXtQcmlvcml0eX0gZXEgJ0Vycm9yJyApIHsKICAgICAgICAkQm94Q2xhc3MgPSAnRXJyb3InOwogICAgfQogICAgZWxzaWYgKCAkUGFyYW17UHJpb3JpdHl9ICYmICRQYXJhbXtQcmlvcml0eX0gZXEgJ1N1Y2Nlc3MnICkgewogICAgICAgICRCb3hDbGFzcyA9ICdTdWNjZXNzJzsKICAgIH0KICAgIGVsc2lmICggJFBhcmFte1ByaW9yaXR5fSAmJiAkUGFyYW17UHJpb3JpdHl9IGVxICdJbmZvJyApIHsKICAgICAgICAkQm94Q2xhc3MgPSAnSW5mbyc7CiAgICB9CgogICAgaWYgKCAkUGFyYW17TGlua30gKSB7CiAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdMaW5rU3RhcnQnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIExpbmtTdGFydCA9PiAkUGFyYW17TGlua30sCiAgICAgICAgICAgICAgICBMaW5rQ2xhc3MgPT4gJFBhcmFte0xpbmtDbGFzc30gfHwgJycsCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KICAgIGlmICggJFBhcmFte0RhdGF9ICkgewogICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnRGF0YScsCiAgICAgICAgICAgIERhdGEgPT4gXCVQYXJhbSwKICAgICAgICApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdUZXh0JywKICAgICAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgICAgICk7CiAgICB9CiAgICBpZiAoICRQYXJhbXtMaW5rfSApIHsKICAgICAgICAkU2VsZi0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0xpbmtTdG9wJywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBMaW5rU3RvcCA9PiAnPC9hPicsCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KICAgIHJldHVybiAkU2VsZi0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnTm90aWZ5JywKICAgICAgICBEYXRhICAgICAgICAgPT4gewogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgIEJveENsYXNzID0+ICRCb3hDbGFzcywKICAgICAgICB9LAogICAgKTsKfQoKPWl0ZW0gSGVhZGVyKCkKCmdlbmVyYXRlcyB0aGUgSFRNTCBmb3IgdGhlIHBhZ2UgYmVnaW4gaW4gdGhlIEFnZW50IGludGVyZmFjZS4KCiAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+SGVhZGVyKAogICAgICAgIFR5cGUgICAgICAgICAgICAgID0+ICdTbWFsbCcsICAgICAgICAgICAgICAgICMgKG9wdGlvbmFsKSAnJyAoRGVmYXVsdCwgZnVsbCBoZWFkZXIpIG9yICdTbWFsbCcgKGJsYW5rIGhlYWRlcikKICAgICAgICBTaG93VG9vbGJhckl0ZW1zICA9PiAwLCAgICAgICAgICAgICAgICAgICAgICAjIChvcHRpb25hbCkgZGVmYXVsdCAxICgwfDEpCiAgICAgICAgU2hvd1ByZWZMaW5rICAgICAgPT4gMCwgICAgICAgICAgICAgICAgICAgICAgIyAob3B0aW9uYWwpIGRlZmF1bHQgMSAoMHwxKQogICAgICAgIFNob3dMb2dvdXRCdXR0b24gID0+IDAsICAgICAgICAgICAgICAgICAgICAgICMgKG9wdGlvbmFsKSBkZWZhdWx0IDEgKDB8MSkKICAgICk7Cgo9Y3V0CgpzdWIgSGVhZGVyIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJFR5cGUgPSAkUGFyYW17VHlwZX0gfHwgJyc7CgogICAgIyBjaGVjayBwYXJhbXMKICAgIGlmICggIWRlZmluZWQgJFBhcmFte1Nob3dUb29sYmFySXRlbXN9ICkgewogICAgICAgICRQYXJhbXtTaG93VG9vbGJhckl0ZW1zfSA9IDE7CiAgICB9CgogICAgaWYgKCAhZGVmaW5lZCAkUGFyYW17U2hvd1ByZWZMaW5rfSApIHsKICAgICAgICAkUGFyYW17U2hvd1ByZWZMaW5rfSA9IDE7CiAgICB9CgogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgIyBkbyBub3Qgc2hvdyBwcmVmZXJlbmNlcyBsaW5rIGlmIHRoZSBwcmVmZXJlbmNlcyBtb2R1bGUgaXMgZGlzYWJsZWQKICAgIG15ICRNb2R1bGVzID0gJENvbmZpZ09iamVjdC0+R2V0KCdGcm9udGVuZDo6TW9kdWxlJyk7CiAgICBpZiAoICEkTW9kdWxlcy0+e0FnZW50UHJlZmVyZW5jZXN9ICkgewogICAgICAgICRQYXJhbXtTaG93UHJlZkxpbmt9ID0gMDsKICAgIH0KCiAgICBpZiAoICFkZWZpbmVkICRQYXJhbXtTaG93TG9nb3V0QnV0dG9ufSApIHsKICAgICAgICAkUGFyYW17U2hvd0xvZ291dEJ1dHRvbn0gPSAxOwogICAgfQoKICAgICMgc2V0IHJ0bCBpZiBuZWVkZWQKICAgIGlmICggJFNlbGYtPntUZXh0RGlyZWN0aW9ufSAmJiAkU2VsZi0+e1RleHREaXJlY3Rpb259IGVxICdydGwnICkgewogICAgICAgICRQYXJhbXtCb2R5Q2xhc3N9ID0gJ1JUTCc7CiAgICB9CiAgICBlbHNpZiAoICRDb25maWdPYmplY3QtPkdldCgnRnJvbnRlbmQ6OkRlYnVnTW9kZScpICkgewogICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnRGVidWdSVExCdXR0b24nLAogICAgICAgICk7CiAgICB9CgogICAgIyBHZW5lcmF0ZSB0aGUgbWluaWZpZWQgQ1NTIGFuZCBKYXZhU2NyaXB0IGZpbGVzIGFuZCB0aGUgdGFncyByZWZlcmVuY2luZyB0aGVtIChzZWUgTGF5b3V0TG9hZGVyKQogICAgJFNlbGYtPkxvYWRlckNyZWF0ZUFnZW50Q1NTQ2FsbHMoKTsKCiAgICBteSAlQWdlbnRMb2dvOwoKICAgICMgY2hlY2sgaWYgd2UgbmVlZCB0byBkaXNwbGF5IGEgY3VzdG9tIGxvZ28gZm9yIHRoZSBzZWxlY3RlZCBza2luCiAgICBteSAkQWdlbnRMb2dvQ3VzdG9tID0gJENvbmZpZ09iamVjdC0+R2V0KCdBZ2VudExvZ29DdXN0b20nKTsKICAgIGlmICgKICAgICAgICAkU2VsZi0+e1NraW5TZWxlY3RlZH0KICAgICAgICAmJiAkQWdlbnRMb2dvQ3VzdG9tCiAgICAgICAgJiYgSXNIYXNoUmVmV2l0aERhdGEoJEFnZW50TG9nb0N1c3RvbSkKICAgICAgICAmJiAkQWdlbnRMb2dvQ3VzdG9tLT57ICRTZWxmLT57U2tpblNlbGVjdGVkfSB9CiAgICAgICAgKQogICAgewogICAgICAgICVBZ2VudExvZ28gPSAleyAkQWdlbnRMb2dvQ3VzdG9tLT57ICRTZWxmLT57U2tpblNlbGVjdGVkfSB9IH07CiAgICB9CgogICAgIyBPdGhlcndpc2Ugc2hvdyBkZWZhdWx0IGhlYWRlciBsb2dvLCBpZiBjb25maWd1cmVkCiAgICBlbHNpZiAoIGRlZmluZWQgJENvbmZpZ09iamVjdC0+R2V0KCdBZ2VudExvZ28nKSApIHsKICAgICAgICAlQWdlbnRMb2dvID0gJXsgJENvbmZpZ09iamVjdC0+R2V0KCdBZ2VudExvZ28nKSB9OwogICAgfQoKICAgIGlmICggJUFnZW50TG9nbyAmJiBrZXlzICVBZ2VudExvZ28gKSB7CgogICAgICAgIG15ICVEYXRhOwogICAgICAgIGZvciBteSAkQ1NTU3RhdGVtZW50ICggc29ydCBrZXlzICVBZ2VudExvZ28gKSB7CiAgICAgICAgICAgIGlmICggJENTU1N0YXRlbWVudCBlcSAnVVJMJyApIHsKICAgICAgICAgICAgICAgIG15ICRXZWJQYXRoID0gJyc7CiAgICAgICAgICAgICAgICBpZiAoICRBZ2VudExvZ297JENTU1N0YXRlbWVudH0gIX4gLyhodHRwfGZ0cHxodHRwcyk6XC8vaSApIHsKICAgICAgICAgICAgICAgICAgICAkV2ViUGF0aCA9ICRDb25maWdPYmplY3QtPkdldCgnRnJvbnRlbmQ6OldlYlBhdGgnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICREYXRheydVUkwnfSA9ICd1cmwoJyAuICRXZWJQYXRoIC4gJEFnZW50TG9nb3skQ1NTU3RhdGVtZW50fSAuICcpJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICREYXRheyRDU1NTdGF0ZW1lbnR9ID0gJEFnZW50TG9nb3skQ1NTU3RhdGVtZW50fTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdIZWFkZXJMb2dvQ1NTJywKICAgICAgICAgICAgRGF0YSA9PiBcJURhdGEsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGFkZCBjb29raWVzIGlmIGV4aXN0cwogICAgbXkgJE91dHB1dCA9ICcnOwogICAgaWYgKCAkU2VsZi0+e1NldENvb2tpZXN9ICYmICRDb25maWdPYmplY3QtPkdldCgnU2Vzc2lvblVzZUNvb2tpZScpICkgewogICAgICAgIGZvciAoIHNvcnQga2V5cyAleyAkU2VsZi0+e1NldENvb2tpZXN9IH0gKSB7CiAgICAgICAgICAgICRPdXRwdXQgLj0gIlNldC1Db29raWU6ICRTZWxmLT57U2V0Q29va2llc30tPnskX31cbiI7CiAgICAgICAgfQogICAgfQoKICAgIG15ICRGaWxlID0gJFBhcmFte0ZpbGVuYW1lfSB8fCAkU2VsZi0+e0FjdGlvbn0gfHwgJ3Vua25vd24nOwoKICAgICMgc2V0IGZpbGUgbmFtZSBmb3IgInNhdmUgcGFnZSBhcyIKICAgICRQYXJhbXtDb250ZW50RGlzcG9zaXRpb259ID0gImZpbGVuYW1lPVwiJEZpbGUuaHRtbFwiIjsKCiAgICAjIGFyZWEgYW5kIHRpdGxlCiAgICBpZiAoICEkUGFyYW17QXJlYX0gKSB7CiAgICAgICAgJFBhcmFte0FyZWF9ID0gKAogICAgICAgICAgICBkZWZpbmVkICRTZWxmLT57QWN0aW9ufQogICAgICAgICAgICA/ICRDb25maWdPYmplY3QtPkdldCgnRnJvbnRlbmQ6Ok1vZHVsZScpLT57ICRTZWxmLT57QWN0aW9ufSB9LT57TmF2QmFyTmFtZX0KICAgICAgICAgICAgOiAnJwogICAgICAgICk7CiAgICB9CiAgICBpZiAoICEkUGFyYW17VGl0bGV9ICkgewogICAgICAgICRQYXJhbXtUaXRsZX0gPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0Zyb250ZW5kOjpNb2R1bGUnKS0+eyAkU2VsZi0+e0FjdGlvbn0gfS0+e1RpdGxlfQogICAgICAgICAgICB8fCAnJzsKICAgIH0KICAgIGZvciBteSAkV29yZCAocXcoVmFsdWUgVGl0bGUgQXJlYSkpIHsKICAgICAgICBpZiAoICRQYXJhbXskV29yZH0gKSB7CiAgICAgICAgICAgICRQYXJhbXtUaXRsZUFyZWF9IC49ICRTZWxmLT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoICRQYXJhbXskV29yZH0gKSAuICcgLSAnOwogICAgICAgIH0KICAgIH0KCiAgICBteSAkTWFpbk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyk7CgogICAgIyBydW4gaGVhZGVyIG1ldGEgbW9kdWxlcwogICAgbXkgJEhlYWRlck1ldGFNb2R1bGUgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0Zyb250ZW5kOjpIZWFkZXJNZXRhTW9kdWxlJyk7CiAgICBpZiAoIHJlZiAkSGVhZGVyTWV0YU1vZHVsZSBlcSAnSEFTSCcgKSB7CiAgICAgICAgbXkgJUpvYnMgPSAleyRIZWFkZXJNZXRhTW9kdWxlfTsKCiAgICAgICAgTU9EVUxFOgogICAgICAgIGZvciBteSAkSm9iICggc29ydCBrZXlzICVKb2JzICkgewoKICAgICAgICAgICAgIyBsb2FkIGFuZCBydW4gbW9kdWxlCiAgICAgICAgICAgIG5leHQgTU9EVUxFIGlmICEkTWFpbk9iamVjdC0+UmVxdWlyZSggJEpvYnN7JEpvYn0tPntNb2R1bGV9ICk7CiAgICAgICAgICAgIG15ICRPYmplY3QgPSAkSm9ic3skSm9ifS0+e01vZHVsZX0tPm5ldygKICAgICAgICAgICAgICAgICV7JFNlbGZ9LAogICAgICAgICAgICAgICAgTGF5b3V0T2JqZWN0ID0+ICRTZWxmLAogICAgICAgICAgICApOwogICAgICAgICAgICBuZXh0IE1PRFVMRSBpZiAhJE9iamVjdDsKICAgICAgICAgICAgJE9iamVjdC0+UnVuKCAlUGFyYW0sIENvbmZpZyA9PiAkSm9ic3skSm9ifSApOwogICAgICAgIH0KICAgIH0KCiAgICAjIHJ1biB0b29sIGJhciBpdGVtIG1vZHVsZXMKICAgIGlmICggJFNlbGYtPntVc2VySUR9ICYmICRTZWxmLT57VXNlclR5cGV9IGVxICdVc2VyJyApIHsKICAgICAgICBteSAkVG9vbEJhck1vZHVsZSA9ICRDb25maWdPYmplY3QtPkdldCgnRnJvbnRlbmQ6OlRvb2xCYXJNb2R1bGUnKTsKICAgICAgICBpZiAoICRQYXJhbXtTaG93VG9vbGJhckl0ZW1zfSAmJiByZWYgJFRvb2xCYXJNb2R1bGUgZXEgJ0hBU0gnICkgewoKICAgICAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnVG9vbEJhcicsCiAgICAgICAgICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBteSAlTW9kdWxlczsKICAgICAgICAgICAgbXkgJUpvYnMgPSAleyRUb29sQmFyTW9kdWxlfTsKCiAgICAgICAgICAgICMgZ2V0IGdyb3VwIG9iamVjdAogICAgICAgICAgICBteSAkR3JvdXBPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6R3JvdXAnKTsKCiAgICAgICAgICAgIE1PRFVMRToKICAgICAgICAgICAgZm9yIG15ICRKb2IgKCBzb3J0IGtleXMgJUpvYnMgKSB7CgogICAgICAgICAgICAgICAgIyBsb2FkIGFuZCBydW4gbW9kdWxlCiAgICAgICAgICAgICAgICBuZXh0IE1PRFVMRSBpZiAhJE1haW5PYmplY3QtPlJlcXVpcmUoICRKb2JzeyRKb2J9LT57TW9kdWxlfSApOwogICAgICAgICAgICAgICAgbXkgJE9iamVjdCA9ICRKb2JzeyRKb2J9LT57TW9kdWxlfS0+bmV3KAogICAgICAgICAgICAgICAgICAgICV7JFNlbGZ9LCAgICAjIFVzZXJJRCBldGMuCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgbmV4dCBNT0RVTEUgaWYgISRPYmplY3Q7CgogICAgICAgICAgICAgICAgbXkgJFRvb2xCYXJBY2Nlc3NPazsKCiAgICAgICAgICAgICAgICAjIGlmIGdyb3VwIHJlc3RyaWN0aW9uIGZvciB0b29sLWJhciBpcyBzZXQsIGNoZWNrIHVzZXIgcGVybWlzc2lvbgogICAgICAgICAgICAgICAgaWYgKCAkSm9ic3skSm9ifS0+e0dyb3VwfSApIHsKCiAgICAgICAgICAgICAgICAgICAgIyByZW1vdmUgd2hpdGUtc3BhY2VzCiAgICAgICAgICAgICAgICAgICAgJEpvYnN7JEpvYn0tPntHcm91cH0gPX4gc3tcc317fXhtc2c7CgogICAgICAgICAgICAgICAgICAgICMgZ2V0IGdyb3VwIGNvbmZpZ3VyYXRpb25zCiAgICAgICAgICAgICAgICAgICAgbXkgQEl0ZW1zID0gc3BsaXQoICc7JywgJEpvYnN7JEpvYn0tPntHcm91cH0gKTsKCiAgICAgICAgICAgICAgICAgICAgSVRFTToKICAgICAgICAgICAgICAgICAgICBmb3IgbXkgJEl0ZW0gKEBJdGVtcykgewoKICAgICAgICAgICAgICAgICAgICAgICAgIyBzcGxpdCB2YWx1ZXMgaW50byBwZXJtaXNzaW9uIGFuZCBncm91cAogICAgICAgICAgICAgICAgICAgICAgICBteSAoICRQZXJtaXNzaW9uLCAkR3JvdXBOYW1lICkgPSBzcGxpdCggJzonLCAkSXRlbSApOwoKICAgICAgICAgICAgICAgICAgICAgICAgIyBsb2cgYW4gZXJyb3IgaWYgbm90IHZhbGlkIHNldHRpbmcKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhJFBlcm1pc3Npb24gfHwgISRHcm91cE5hbWUgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJJbnZhbGlkIGNvbmZpZyBmb3IgVG9vbEJhck1vZHVsZSAkSm9iIC0gS2V5IEdyb3VwOiAnJEl0ZW0nISAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4gIk5lZWQgc29tZXRoaW5nIGxpa2UgJ1Blcm1pc3Npb246R3JvdXA7JyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAjIGdldCBncm91cHMgZm9yIGN1cnJlbnQgdXNlcgogICAgICAgICAgICAgICAgICAgICAgICBteSAlR3JvdXBzID0gJEdyb3VwT2JqZWN0LT5QZXJtaXNzaW9uVXNlckdldCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUeXBlICAgPT4gJFBlcm1pc3Npb24sCiAgICAgICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgICAgICAjIG5leHQgam9iIGlmIHVzZXIgaGF2ZSBub3QgZ3JvdXBzCiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQgSVRFTSBpZiAhJUdyb3VwczsKCiAgICAgICAgICAgICAgICAgICAgICAgICMgY2hlY2sgdXNlciBiZWxvbmdzIHRvIHRoZSBjb3JyZWN0IGdyb3VwCiAgICAgICAgICAgICAgICAgICAgICAgIG15ICVHcm91cHNSZXZlcnNlID0gcmV2ZXJzZSAlR3JvdXBzOwogICAgICAgICAgICAgICAgICAgICAgICBuZXh0IElURU0gaWYgISRHcm91cHNSZXZlcnNleyRHcm91cE5hbWV9OwoKICAgICAgICAgICAgICAgICAgICAgICAgJFRvb2xCYXJBY2Nlc3NPayA9IDE7CgogICAgICAgICAgICAgICAgICAgICAgICBsYXN0IElURU07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAjIGdvIHRvIHRoZSBuZXh0IG1vZHVsZSBpZiBub3QgcGVybWlzc2lvbnMKICAgICAgICAgICAgICAgICAgICAjIGZvciB0aGUgY3VycmVudCBvbmUKICAgICAgICAgICAgICAgICAgICBuZXh0IE1PRFVMRSBpZiAhJFRvb2xCYXJBY2Nlc3NPazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAlTW9kdWxlcyA9ICggJE9iamVjdC0+UnVuKCAlUGFyYW0sIENvbmZpZyA9PiAkSm9ic3skSm9ifSApLCAlTW9kdWxlcyApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHNob3cgdG9vbCBiYXIgaXRlbXMKICAgICAgICAgICAgTU9EVUxFOgogICAgICAgICAgICBmb3IgbXkgJEtleSAoIHNvcnQga2V5cyAlTW9kdWxlcyApIHsKICAgICAgICAgICAgICAgIG5leHQgTU9EVUxFIGlmICEleyAkTW9kdWxlc3skS2V5fSB9OwogICAgICAgICAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJE1vZHVsZXN7JEtleX0tPntCbG9ja30sCiAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICV7ICRNb2R1bGVzeyRLZXl9IH0sCiAgICAgICAgICAgICAgICAgICAgICAgIEFjY2Vzc0tleVJlZmVyZW5jZSA9PiAkTW9kdWxlc3skS2V5fS0+e0FjY2Vzc0tleX0KICAgICAgICAgICAgICAgICAgICAgICAgPyAiICgkTW9kdWxlc3skS2V5fS0+e0FjY2Vzc0tleX0pIgogICAgICAgICAgICAgICAgICAgICAgICA6ICcnLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIHNob3cgbG9nZ2VkIGluIG5vdGljZQogICAgICAgIGlmICggJFBhcmFte1Nob3dQcmVmTGlua30gKSB7CiAgICAgICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0xvZ2luJywKICAgICAgICAgICAgICAgIERhdGEgPT4gXCVQYXJhbSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0xvZ2luV2l0aG91dExpbmsnLAogICAgICAgICAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBzaG93IGxvZ291dCBidXR0b24gKGlmIHJlZ2lzdGVyZWQpCiAgICAgICAgaWYgKAogICAgICAgICAgICAkUGFyYW17U2hvd0xvZ291dEJ1dHRvbn0KICAgICAgICAgICAgJiYgJENvbmZpZ09iamVjdC0+R2V0KCdGcm9udGVuZDo6TW9kdWxlJyktPntMb2dvdXR9CiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0xvZ291dCcsCiAgICAgICAgICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgY3JlYXRlICYgcmV0dXJuIG91dHB1dAogICAgJE91dHB1dCAuPSAkU2VsZi0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAiSGVhZGVyJFR5cGUiLAogICAgICAgIERhdGEgICAgICAgICA9PiBcJVBhcmFtCiAgICApOwoKICAgICMgcmVtb3ZlIHRoZSB2ZXJzaW9uIHRhZyBmcm9tIHRoZSBoZWFkZXIgaWYgY29uZmlndXJlZAogICAgJFNlbGYtPl9EaXNhYmxlQmFubmVyQ2hlY2soIE91dHB1dFJlZiA9PiBcJE91dHB1dCApOwoKICAgIHJldHVybiAkT3V0cHV0Owp9CgpzdWIgRm9vdGVyIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJFR5cGUgICAgICAgICAgPSAkUGFyYW17VHlwZX0gICAgICAgICAgIHx8ICcnOwogICAgbXkgJEhhc0RhdGVwaWNrZXIgPSAkU2VsZi0+e0hhc0RhdGVwaWNrZXJ9IHx8IDA7CgogICAgIyBHZW5lcmF0ZSB0aGUgbWluaWZpZWQgQ1NTIGFuZCBKYXZhU2NyaXB0IGZpbGVzIGFuZCB0aGUgdGFncyByZWZlcmVuY2luZyB0aGVtIChzZWUgTGF5b3V0TG9hZGVyKQogICAgJFNlbGYtPkxvYWRlckNyZWF0ZUFnZW50SlNDYWxscygpOwoKICAgICMgZ2V0IGRhdGVwaWNrZXIgZGF0YSwgaWYgbmVlZGVkIGluIG1vZHVsZQogICAgaWYgKCRIYXNEYXRlcGlja2VyKSB7CiAgICAgICAgbXkgJFZhY2F0aW9uRGF5cyAgICAgPSAkU2VsZi0+RGF0ZXBpY2tlckdldFZhY2F0aW9uRGF5cygpOwogICAgICAgIG15ICRWYWNhdGlvbkRheXNKU09OID0gJFNlbGYtPkpTT05FbmNvZGUoCiAgICAgICAgICAgIERhdGEgPT4gJFZhY2F0aW9uRGF5cywKICAgICAgICApOwoKICAgICAgICBteSAkVGV4dERpcmVjdGlvbiA9ICRTZWxmLT57TGFuZ3VhZ2VPYmplY3R9LT57VGV4dERpcmVjdGlvbn0gfHwgJyc7CgogICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnRGF0ZXBpY2tlckRhdGEnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIFZhY2F0aW9uRGF5cyAgPT4gJFZhY2F0aW9uRGF5c0pTT04sCiAgICAgICAgICAgICAgICBJc1JUTExhbmd1YWdlID0+ICggJFRleHREaXJlY3Rpb24gZXEgJ3J0bCcgKSA/IDEgOiAwLAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgIyBOZXdUaWNrZXRJbk5ld1dpbmRvdwogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ05ld1RpY2tldEluTmV3V2luZG93OjpFbmFibGVkJykgKSB7CiAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdOZXdUaWNrZXRJbk5ld1dpbmRvdycsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIEF1dG9Db21wbGV0ZS1Db25maWcKICAgIG15ICRBdXRvY29tcGxldGVDb25maWcgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0F1dG9Db21wbGV0ZTo6QWdlbnQnKTsKCiAgICBmb3IgbXkgJENvbmZpZ0VsZW1lbnQgKCBzb3J0IGtleXMgJXskQXV0b2NvbXBsZXRlQ29uZmlnfSApIHsKICAgICAgICAkQXV0b2NvbXBsZXRlQ29uZmlnLT57JENvbmZpZ0VsZW1lbnR9LT57QnV0dG9uVGV4dH0KICAgICAgICAgICAgPSAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCAkQXV0b2NvbXBsZXRlQ29uZmlnLT57JENvbmZpZ0VsZW1lbnR9LT57QnV0dG9uVGV4dH0gKTsKICAgIH0KCiAgICBteSAkQXV0b2NvbXBsZXRlQ29uZmlnSlNPTiA9ICRTZWxmLT5KU09ORW5jb2RlKAogICAgICAgIERhdGEgPT4gJEF1dG9jb21wbGV0ZUNvbmZpZywKICAgICk7CgogICAgJFNlbGYtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJ0F1dG9Db21wbGV0ZUNvbmZpZycsCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgIEF1dG9jb21wbGV0ZUNvbmZpZyA9PiAkQXV0b2NvbXBsZXRlQ29uZmlnSlNPTiwKICAgICAgICB9LAogICAgKTsKCiAgICAjIFNlYXJjaCBmcm9udGVuZCAoSmF2YVNjcmlwdCkKICAgIG15ICRTZWFyY2hGcm9udGVuZENvbmZpZyA9ICRDb25maWdPYmplY3QtPkdldCgnRnJvbnRlbmQ6OlNlYXJjaDo6SmF2YVNjcmlwdCcpOwoKICAgICMgZ2V0IHRhcmdldCBqYXZhc2NyaXB0IGZ1bmN0aW9uCiAgICBteSAkSlNDYWxsID0gJyc7CgogICAgaWYgKCAkU2VhcmNoRnJvbnRlbmRDb25maWcgJiYgJFNlbGYtPntBY3Rpb259ICkgewogICAgICAgIGZvciBteSAkR3JvdXAgKCBzb3J0IGtleXMgJXskU2VhcmNoRnJvbnRlbmRDb25maWd9ICkgewogICAgICAgICAgICBSRUdFWFA6CiAgICAgICAgICAgIGZvciBteSAkUmVnRXhwICggc29ydCBrZXlzICV7ICRTZWFyY2hGcm9udGVuZENvbmZpZy0+eyRHcm91cH0gfSApIHsKICAgICAgICAgICAgICAgIGlmICggJFNlbGYtPntBY3Rpb259ID1+IC8kUmVnRXhwLyApIHsKICAgICAgICAgICAgICAgICAgICAkSlNDYWxsID0gJFNlYXJjaEZyb250ZW5kQ29uZmlnLT57JEdyb3VwfS0+eyRSZWdFeHB9OwogICAgICAgICAgICAgICAgICAgIGxhc3QgUkVHRVhQOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICRTZWxmLT5CbG9jaygKICAgICAgICBOYW1lID0+ICdTZWFyY2hGcm9udGVuZENvbmZpZycsCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgIFNlYXJjaEZyb250ZW5kQ29uZmlnID0+ICRKU0NhbGwsCiAgICAgICAgfSwKICAgICk7CgogICAgIyBCYW5uZXIKICAgIGlmICggISRDb25maWdPYmplY3QtPkdldCgnU2VjdXJlOjpEaXNhYmxlQmFubmVyJykgKSB7CiAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdCYW5uZXInLAogICAgICAgICk7CiAgICB9CgogICAgIyBEb24ndCBjaGVjayBmb3IgYnVzaW5lc3MgcGFja2FnZSBpZiB0aGUgZGF0YWJhc2Ugd2FzIG5vdCB5ZXQgY29uZmlndXJlZCAoaW4gdGhlIGluc3RhbGxlcikKICAgIGlmICggJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdTZWN1cmVNb2RlJykgKSB7CiAgICAgICAgJFBhcmFte09UUlNCdXNpbmVzc0lzSW5zdGFsbGVkfSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpPVFJTQnVzaW5lc3MnKS0+T1RSU0J1c2luZXNzSXNJbnN0YWxsZWQoKTsKICAgIH0KCiAgICAjIGNyZWF0ZSAmIHJldHVybiBvdXRwdXQKICAgIHJldHVybiAkU2VsZi0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAiRm9vdGVyJFR5cGUiLAogICAgICAgIERhdGEgICAgICAgICA9PiBcJVBhcmFtCiAgICApOwp9CgpzdWIgUHJpbnQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIHJ1biBvdXRwdXQgY29udGVudCBmaWx0ZXJzCiAgICBpZiAoICRTZWxmLT57RmlsdGVyQ29udGVudH0gJiYgcmVmICRTZWxmLT57RmlsdGVyQ29udGVudH0gZXEgJ0hBU0gnICkgewoKICAgICAgICAjIGV4dHJhY3QgZmlsdGVyIGxpc3QKICAgICAgICBteSAlRmlsdGVyTGlzdCA9ICV7ICRTZWxmLT57RmlsdGVyQ29udGVudH0gfTsKCiAgICAgICAgbXkgJE1haW5PYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpOwoKICAgICAgICBGSUxURVI6CiAgICAgICAgZm9yIG15ICRGaWx0ZXIgKCBzb3J0IGtleXMgJUZpbHRlckxpc3QgKSB7CgogICAgICAgICAgICAjIGV4dHJhY3QgZmlsdGVyIGNvbmZpZwogICAgICAgICAgICBteSAkRmlsdGVyQ29uZmlnID0gJEZpbHRlckxpc3R7JEZpbHRlcn07CgogICAgICAgICAgICBuZXh0IEZJTFRFUiBpZiAhJEZpbHRlckNvbmZpZzsKICAgICAgICAgICAgbmV4dCBGSUxURVIgaWYgcmVmICRGaWx0ZXJDb25maWcgbmUgJ0hBU0gnOwoKICAgICAgICAgICAgIyBleHRyYWN0IHRlbXBsYXRlIGxpc3QKICAgICAgICAgICAgbXkgJFRlbXBsYXRlTGlzdCA9ICRGaWx0ZXJDb25maWctPntUZW1wbGF0ZXN9OwoKICAgICAgICAgICAgIyBjaGVjayB0ZW1wbGF0ZSBsaXN0CiAgICAgICAgICAgIGlmICggISRUZW1wbGF0ZUxpc3QgfHwgcmVmICRUZW1wbGF0ZUxpc3QgbmUgJ0hBU0gnIHx8ICEleyRUZW1wbGF0ZUxpc3R9ICkgewoKICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICAgICAiUGxlYXNlIGFkZCBhIHRlbXBsYXRlIGxpc3QgdG8gb3V0cHV0IGZpbHRlciAkRmlsdGVyQ29uZmlnLT57TW9kdWxlfSAiCiAgICAgICAgICAgICAgICAgICAgICAgIC4gInRvIGltcHJvdmUgcGVyZm9ybWFuY2UuIFVzZSBBTEwgaWYgT3V0cHV0RmlsdGVyIHNob3VsZCBtb2RpZnkgYWxsICIKICAgICAgICAgICAgICAgICAgICAgICAgLiAidGVtcGxhdGVzIG9mIHRoZSBzeXN0ZW0gKGRlcHJlY2F0ZWQpLiIsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGNoZWNrIHRlbXBsYXRlIGxpc3QKICAgICAgICAgICAgaWYgKCAkUGFyYW17VGVtcGxhdGVGaWxlfSAmJiByZWYgJFRlbXBsYXRlTGlzdCBlcSAnSEFTSCcgJiYgISRUZW1wbGF0ZUxpc3QtPntBTEx9ICkgewogICAgICAgICAgICAgICAgbmV4dCBGSUxURVIgaWYgISRUZW1wbGF0ZUxpc3QtPnsgJFBhcmFte1RlbXBsYXRlRmlsZX0gfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbmV4dCBGSUxURVIgaWYgISRNYWluT2JqZWN0LT5SZXF1aXJlKCAkRmlsdGVyQ29uZmlnLT57TW9kdWxlfSApOwoKICAgICAgICAgICAgIyBjcmVhdGUgbmV3IGluc3RhbmNlCiAgICAgICAgICAgIG15ICRPYmplY3QgPSAkRmlsdGVyQ29uZmlnLT57TW9kdWxlfS0+bmV3KAogICAgICAgICAgICAgICAgJXskU2VsZn0sCiAgICAgICAgICAgICAgICBMYXlvdXRPYmplY3QgPT4gJFNlbGYsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBuZXh0IEZJTFRFUiBpZiAhJE9iamVjdDsKCiAgICAgICAgICAgICMgcnVuIG91dHB1dCBmaWx0ZXIKICAgICAgICAgICAgJE9iamVjdC0+UnVuKAogICAgICAgICAgICAgICAgJXskRmlsdGVyQ29uZmlnfSwKICAgICAgICAgICAgICAgIERhdGEgICAgICAgICA9PiAkUGFyYW17T3V0cHV0fSwKICAgICAgICAgICAgICAgIFRlbXBsYXRlRmlsZSA9PiAkUGFyYW17VGVtcGxhdGVGaWxlfSB8fCAnJywKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgIyBUaGVyZSBzZWVtcyB0byBiZSBhIGJ1ZyBpbiBGYXN0Q0dJIHRoYXQgaXQgY2Fubm90IGhhbmRsZSB1bmljb2RlIG91dHB1dCBwcm9wZXJseS4KICAgICMgICBXb3JrIGFyb3VuZCB0aGlzIGJ5IGNvbnZlcnRpbmcgdG8gYW4gdXRmOCBieXRlIHN0cmVhbSBpbnN0ZWFkLgogICAgIyAgIFNlZSBhbHNvIGh0dHA6Ly9idWdzLm90cnMub3JnL3Nob3dfYnVnLmNnaT9pZD02Mjg0IGFuZAogICAgIyAgIGh0dHA6Ly9idWdzLm90cnMub3JnL3Nob3dfYnVnLmNnaT9pZD05ODAyLgogICAgaWYgKCAkSU5DeydDR0kvRmFzdC5wbSd9IHx8ICRFTlZ7RkNHSV9ST0xFfSB8fCAkRU5We0ZDR0lfU09DS0VUX1BBVEh9ICkgeyAgICAjIGFyZSB3ZSBvbiBGQ0dJPwogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpFbmNvZGUnKS0+RW5jb2RlT3V0cHV0KCAkUGFyYW17T3V0cHV0fSApOwogICAgICAgIGJpbm1vZGUgU1RET1VULCAnOmJ5dGVzJzsKICAgIH0KCiAgICBwcmludCAkeyAkUGFyYW17T3V0cHV0fSB9OwoKICAgIHJldHVybiAxOwp9Cgo9aXRlbSBBc2NpaTJIdG1sKCkKCmNvbnZlcnQgYXNjaWkgdG8gaHRtbCBzdHJpbmcKCiAgICBteSAkSFRNTCA9ICRMYXlvdXRPYmplY3QtPkFzY2lpMkh0bWwoCiAgICAgICAgVGV4dCAgICAgICAgICAgID0+ICdTb21lIDw+IFRlc3QgPGZvbnQgY29sb3I9InJlZCI+VGVzdDwvZm9udD4nLAogICAgICAgIE1heCAgICAgICAgICAgICA9PiAyMCwgICAgICAgIyBtYXggMjAgY2hhcnMgZm9sb3dlZCBieSBbLi5dCiAgICAgICAgVk1heCAgICAgICAgICAgID0+IDE1LCAgICAgICAjIGZpcnN0IDE1IGxpbmVzCiAgICAgICAgTmV3TGluZSAgICAgICAgID0+IDAsICAgICAgICAjIG1vdmUgXHIgdG8gXG4KICAgICAgICBIVE1MUmVzdWx0TW9kZSAgPT4gMCwgICAgICAgICMgcmVwbGFjZSAiICIgd2l0aCAmbmJzcDsKICAgICAgICBTdHJpcEVtcHR5TGluZXMgPT4gMCwKICAgICAgICBUeXBlICAgICAgICAgICAgPT4gJ05vcm1hbCcsICMgSlNUZXh0IG9yIE5vcm1hbCB0ZXh0CiAgICAgICAgTGlua0ZlYXR1cmUgICAgID0+IDAsICAgICAgICAjIGRvIHNvbWUgVVJMIGRldGVjdGlvbnMKICAgICk7CgphbHNvIHN0cmluZyByZWYgaXMgcG9zc2libGUKCiAgICBteSAkSFRNTFN0cmluZ1JlZiA9ICRMYXlvdXRPYmplY3QtPkFzY2lpMkh0bWwoCiAgICAgICAgVGV4dCA9PiBcJFN0cmluZywKICAgICk7Cgo9Y3V0CgpzdWIgQXNjaWkySHRtbCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHBhcmFtCiAgICByZXR1cm4gJycgaWYgIWRlZmluZWQgJFBhcmFte1RleHR9OwoKICAgICMgY2hlY2sgdGV4dAogICAgbXkgJFRleHRTY2FsYXI7CiAgICBteSAkVGV4dDsKICAgIGlmICggIXJlZiAkUGFyYW17VGV4dH0gKSB7CiAgICAgICAgJFRleHRTY2FsYXIgPSAxOwogICAgICAgICRUZXh0ICAgICAgID0gXCRQYXJhbXtUZXh0fTsKICAgIH0KICAgIGVsc2lmICggcmVmICRQYXJhbXtUZXh0fSBlcSAnU0NBTEFSJyApIHsKICAgICAgICAkVGV4dCA9ICRQYXJhbXtUZXh0fTsKICAgIH0KICAgIGVsc2UgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnSW52YWxpZCByZWYgIicgLiByZWYgJFBhcmFte1RleHR9IC4gJyIgb2YgVGV4dCBwYXJhbSEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuICcnOwogICAgfQoKICAgICMgcnVuIG91dHB1dCBmaWx0ZXIgdGV4dAogICAgbXkgQEZpbHRlcnM7CiAgICBpZiAoICRQYXJhbXtMaW5rRmVhdHVyZX0gJiYgJFNlbGYtPntGaWx0ZXJUZXh0fSAmJiByZWYgJFNlbGYtPntGaWx0ZXJUZXh0fSBlcSAnSEFTSCcgKSB7CgogICAgICAgICMgZXh0cmFjdCBmaWx0ZXIgbGlzdAogICAgICAgIG15ICVGaWx0ZXJMaXN0ID0gJXsgJFNlbGYtPntGaWx0ZXJUZXh0fSB9OwoKICAgICAgICBteSAkTWFpbk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyk7CgogICAgICAgIEZJTFRFUjoKICAgICAgICBmb3IgbXkgJEZpbHRlciAoIHNvcnQga2V5cyAlRmlsdGVyTGlzdCApIHsKCiAgICAgICAgICAgICMgZXh0cmFjdCBmaWx0ZXIgY29uZmlnCiAgICAgICAgICAgIG15ICRGaWx0ZXJDb25maWcgPSAkRmlsdGVyTGlzdHskRmlsdGVyfTsKCiAgICAgICAgICAgIG5leHQgRklMVEVSIGlmICEkRmlsdGVyQ29uZmlnOwogICAgICAgICAgICBuZXh0IEZJTFRFUiBpZiByZWYgJEZpbHRlckNvbmZpZyBuZSAnSEFTSCc7CgogICAgICAgICAgICAjIGV4dHJhY3QgdGVtcGxhdGUgbGlzdAogICAgICAgICAgICBteSAkVGVtcGxhdGVMaXN0ID0gJEZpbHRlckNvbmZpZy0+e1RlbXBsYXRlc307CgogICAgICAgICAgICAjIGNoZWNrIHRlbXBsYXRlIGxpc3QKICAgICAgICAgICAgaWYgKCAhJFRlbXBsYXRlTGlzdCB8fCByZWYgJFRlbXBsYXRlTGlzdCBuZSAnSEFTSCcgfHwgISV7JFRlbXBsYXRlTGlzdH0gKSB7CgogICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAgICAgICAgICJQbGVhc2UgYWRkIGEgdGVtcGxhdGUgbGlzdCB0byBvdXRwdXQgZmlsdGVyICRGaWx0ZXJDb25maWctPntNb2R1bGV9ICIKICAgICAgICAgICAgICAgICAgICAgICAgLiAidG8gaW1wcm92ZSBwZXJmb3JtYW5jZS4gVXNlIEFMTCBpZiBPdXRwdXRGaWx0ZXIgc2hvdWxkIG1vZGlmeSBhbGwgIgogICAgICAgICAgICAgICAgICAgICAgICAuICJ0ZW1wbGF0ZXMgb2YgdGhlIHN5c3RlbSAoZGVwcmVjYXRlZCkuIiwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgY2hlY2sgdGVtcGxhdGUgbGlzdAogICAgICAgICAgICBpZiAoICRQYXJhbXtUZW1wbGF0ZUZpbGV9ICYmIHJlZiAkVGVtcGxhdGVMaXN0IGVxICdIQVNIJyAmJiAhJFRlbXBsYXRlTGlzdC0+e0FMTH0gKSB7CiAgICAgICAgICAgICAgICBuZXh0IEZJTFRFUiBpZiAhJFRlbXBsYXRlTGlzdC0+eyAkUGFyYW17VGVtcGxhdGVGaWxlfSB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICAkU2VsZi0+RmF0YWxEaWUoKSBpZiAhJE1haW5PYmplY3QtPlJlcXVpcmUoICRGaWx0ZXJDb25maWctPntNb2R1bGV9ICk7CgogICAgICAgICAgICAjIGNyZWF0ZSBuZXcgaW5zdGFuY2UKICAgICAgICAgICAgbXkgJE9iamVjdCA9ICRGaWx0ZXJDb25maWctPntNb2R1bGV9LT5uZXcoCiAgICAgICAgICAgICAgICAleyRTZWxmfSwKICAgICAgICAgICAgICAgIExheW91dE9iamVjdCA9PiAkU2VsZiwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIG5leHQgRklMVEVSIGlmICEkT2JqZWN0OwoKICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgIEBGaWx0ZXJzLAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIE9iamVjdCA9PiAkT2JqZWN0LAogICAgICAgICAgICAgICAgICAgIEZpbHRlciA9PiAkRmlsdGVyQ29uZmlnLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgcHJlIHJ1bgogICAgICAgIGZvciBteSAkRmlsdGVyIChARmlsdGVycykgewoKICAgICAgICAgICAgJFRleHQgPSAkRmlsdGVyLT57T2JqZWN0fS0+UHJlKAogICAgICAgICAgICAgICAgRmlsdGVyID0+ICRGaWx0ZXItPntGaWx0ZXJ9LAogICAgICAgICAgICAgICAgRGF0YSAgID0+ICRUZXh0LAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIG1heCB3aWR0aAogICAgaWYgKCAkUGFyYW17TWF4fSAmJiBsZW5ndGggJHskVGV4dH0gPiAkUGFyYW17TWF4fSApIHsKICAgICAgICAkeyRUZXh0fSA9IHN1YnN0ciggJHskVGV4dH0sIDAsICRQYXJhbXtNYXh9IC0gNSApIC4gJ1suLi5dJzsKICAgIH0KCiAgICAjIG5ld2xpbmUKICAgIGlmICggJFBhcmFte05ld0xpbmV9ICYmIGxlbmd0aCggJHskVGV4dH0gKSA8IDE0MF8wMDAgKSB7CiAgICAgICAgJHskVGV4dH0gPX4gcy8oXG5ccnxcclxyXG58XHJcbikvXG4vZzsKICAgICAgICAkeyRUZXh0fSA9fiBzL1xyL1xuL2c7CiAgICAgICAgJHskVGV4dH0gPX4gcy8oLns0LCRQYXJhbXtOZXdMaW5lfX0pKD86XHN8XHopLyQxXG4vZ207CiAgICAgICAgbXkgJEZvcmNlTmV3TGluZSA9ICRQYXJhbXtOZXdMaW5lfSArIDEwOwogICAgICAgICR7JFRleHR9ID1+IHMvKC57JEZvcmNlTmV3TGluZX0pKC4rPykvJDFcbiQyL2c7CiAgICB9CgogICAgIyByZW1vdmUgdGFicwogICAgJHskVGV4dH0gPX4gcy9cdC8gL2c7CgogICAgIyBzdHJpcCBlbXB0eSBsaW5lcwogICAgaWYgKCAkUGFyYW17U3RyaXBFbXB0eUxpbmVzfSApIHsKICAgICAgICAkeyRUZXh0fSA9fiBzL15ccypcbi8vbWc7CiAgICB9CgogICAgIyBtYXggbGluZXMKICAgIGlmICggJFBhcmFte1ZNYXh9ICkgewogICAgICAgIG15IEBUZXh0TGlzdCA9IHNwbGl0KCAiXG4iLCAkeyRUZXh0fSApOwogICAgICAgICR7JFRleHR9ID0gJyc7CiAgICAgICAgbXkgJENvdW50ZXIgPSAxOwogICAgICAgIGZvciAoQFRleHRMaXN0KSB7CiAgICAgICAgICAgIGlmICggJENvdW50ZXIgPD0gJFBhcmFte1ZNYXh9ICkgewogICAgICAgICAgICAgICAgJHskVGV4dH0gLj0gJF8gLiAiXG4iOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRDb3VudGVyKys7CiAgICAgICAgfQogICAgICAgIGlmICggJENvdW50ZXIgPj0gJFBhcmFte1ZNYXh9ICkgewogICAgICAgICAgICAkeyRUZXh0fSAuPSAiWy4uLl1cbiI7CiAgICAgICAgfQogICAgfQoKICAgICMgaHRtbCBxdW90aW5nCiAgICAkeyRUZXh0fSA9fiBzLyYvJmFtcDsvZzsKICAgICR7JFRleHR9ID1+IHMvPC8mbHQ7L2c7CiAgICAkeyRUZXh0fSA9fiBzLz4vJmd0Oy9nOwogICAgJHskVGV4dH0gPX4gcy8iLyZxdW90Oy9nOwoKICAgICMgdGV4dCAtPiBodG1sIGZvcm1hdCBxdW90aW5nCiAgICBpZiAoICRQYXJhbXtMaW5rRmVhdHVyZX0gKSB7CiAgICAgICAgZm9yIG15ICRGaWx0ZXIgKEBGaWx0ZXJzKSB7CiAgICAgICAgICAgICRUZXh0ID0gJEZpbHRlci0+e09iamVjdH0tPlBvc3QoCiAgICAgICAgICAgICAgICBGaWx0ZXIgPT4gJEZpbHRlci0+e0ZpbHRlcn0sCiAgICAgICAgICAgICAgICBEYXRhICAgPT4gJFRleHQsCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgIGlmICggJFBhcmFte0hUTUxSZXN1bHRNb2RlfSApIHsKICAgICAgICAkeyRUZXh0fSA9fiBzL1xuLzxiclwvPlxuL2c7CiAgICAgICAgJHskVGV4dH0gPX4gcy8gIC8mbmJzcDsmbmJzcDsvZzsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtUeXBlfSAmJiAkUGFyYW17VHlwZX0gZXEgJ0pTVGV4dCcgKSB7CiAgICAgICAgJHskVGV4dH0gPX4gcy8nL1xcJy9nOwogICAgfQoKICAgIHJldHVybiAkVGV4dCBpZiByZWYgJFBhcmFte1RleHR9OwogICAgcmV0dXJuICR7JFRleHR9Owp9Cgo9aXRlbSBMaW5rUXVvdGUoKQoKc28gc29tZSBVUkwgbGluayBkZXRlY3Rpb25zCgogICAgbXkgJEhUTUxXaXRoTGlua3MgPSAkTGF5b3V0T2JqZWN0LT5MaW5rUXVvdGUoCiAgICAgICAgVGV4dCA9PiAkSFRNTFdpdGhPdXRMaW5rcywKICAgICk7CgphbHNvIHN0cmluZyByZWYgaXMgcG9zc2libGUKCiAgICBteSAkSFRNTFdpdGhMaW5rc1JlZiA9ICRMYXlvdXRPYmplY3QtPkxpbmtRdW90ZSgKICAgICAgICBUZXh0ID0+IFwkSFRNTFdpdGhPdXRMaW5rc1JlZiwKICAgICk7Cgo9Y3V0CgpzdWIgTGlua1F1b3RlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJFRleHQgICA9ICRQYXJhbXtUZXh0fSAgIHx8ICcnOwogICAgbXkgJFRhcmdldCA9ICRQYXJhbXtUYXJnZXR9IHx8ICdOZXdQYWdlJyAuIGludCggcmFuZCgxOTkpICk7CgogICAgIyBjaGVjayByZWYKICAgIG15ICRUZXh0U2NhbGFyOwogICAgaWYgKCAhcmVmICRUZXh0ICkgewogICAgICAgICRUZXh0U2NhbGFyID0gJFRleHQ7CiAgICAgICAgJFRleHQgICAgICAgPSBcJFRleHRTY2FsYXI7CiAgICB9CgogICAgIyBydW4gb3V0cHV0IGZpbHRlciB0ZXh0CiAgICBteSBARmlsdGVyczsKICAgIGlmICggJFNlbGYtPntGaWx0ZXJUZXh0fSAmJiByZWYgJFNlbGYtPntGaWx0ZXJUZXh0fSBlcSAnSEFTSCcgKSB7CgogICAgICAgICMgZXh0cmFjdCBmaWx0ZXIgbGlzdAogICAgICAgIG15ICVGaWx0ZXJMaXN0ID0gJXsgJFNlbGYtPntGaWx0ZXJUZXh0fSB9OwoKICAgICAgICBteSAkTWFpbk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyk7CgogICAgICAgIEZJTFRFUjoKICAgICAgICBmb3IgbXkgJEZpbHRlciAoIHNvcnQga2V5cyAlRmlsdGVyTGlzdCApIHsKCiAgICAgICAgICAgICMgZXh0cmFjdCBmaWx0ZXIgY29uZmlnCiAgICAgICAgICAgIG15ICRGaWx0ZXJDb25maWcgPSAkRmlsdGVyTGlzdHskRmlsdGVyfTsKCiAgICAgICAgICAgIG5leHQgRklMVEVSIGlmICEkRmlsdGVyQ29uZmlnOwogICAgICAgICAgICBuZXh0IEZJTFRFUiBpZiByZWYgJEZpbHRlckNvbmZpZyBuZSAnSEFTSCc7CgogICAgICAgICAgICAjIGV4dHJhY3QgdGVtcGxhdGUgbGlzdAogICAgICAgICAgICBteSAkVGVtcGxhdGVMaXN0ID0gJEZpbHRlckNvbmZpZy0+e1RlbXBsYXRlc307CgogICAgICAgICAgICAjIGNoZWNrIHRlbXBsYXRlIGxpc3QKICAgICAgICAgICAgaWYgKCAhJFRlbXBsYXRlTGlzdCB8fCByZWYgJFRlbXBsYXRlTGlzdCBuZSAnSEFTSCcgfHwgISV7JFRlbXBsYXRlTGlzdH0gKSB7CgogICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAgICAgICAgICJQbGVhc2UgYWRkIGEgdGVtcGxhdGUgbGlzdCB0byBvdXRwdXQgZmlsdGVyICRGaWx0ZXJDb25maWctPntNb2R1bGV9ICIKICAgICAgICAgICAgICAgICAgICAgICAgLiAidG8gaW1wcm92ZSBwZXJmb3JtYW5jZS4gVXNlIEFMTCBpZiBPdXRwdXRGaWx0ZXIgc2hvdWxkIG1vZGlmeSBhbGwgIgogICAgICAgICAgICAgICAgICAgICAgICAuICJ0ZW1wbGF0ZXMgb2YgdGhlIHN5c3RlbSAoZGVwcmVjYXRlZCkuIiwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgY2hlY2sgdGVtcGxhdGUgbGlzdAogICAgICAgICAgICBpZiAoICRQYXJhbXtUZW1wbGF0ZUZpbGV9ICYmIHJlZiAkVGVtcGxhdGVMaXN0IGVxICdIQVNIJyAmJiAhJFRlbXBsYXRlTGlzdC0+e0FMTH0gKSB7CiAgICAgICAgICAgICAgICBuZXh0IEZJTFRFUiBpZiAhJFRlbXBsYXRlTGlzdC0+eyAkUGFyYW17VGVtcGxhdGVGaWxlfSB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICAkU2VsZi0+RmF0YWxEaWUoKSBpZiAhJE1haW5PYmplY3QtPlJlcXVpcmUoICRGaWx0ZXJDb25maWctPntNb2R1bGV9ICk7CgogICAgICAgICAgICAjIGNyZWF0ZSBuZXcgaW5zdGFuY2UKICAgICAgICAgICAgbXkgJE9iamVjdCA9ICRGaWx0ZXJDb25maWctPntNb2R1bGV9LT5uZXcoCiAgICAgICAgICAgICAgICAleyRTZWxmfSwKICAgICAgICAgICAgICAgIExheW91dE9iamVjdCA9PiAkU2VsZiwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIG5leHQgRklMVEVSIGlmICEkT2JqZWN0OwoKICAgICAgICAgICAgcHVzaCBARmlsdGVycywgewogICAgICAgICAgICAgICAgT2JqZWN0ID0+ICRPYmplY3QsCiAgICAgICAgICAgICAgICBGaWx0ZXIgPT4gJEZpbHRlckNvbmZpZywKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9CgogICAgZm9yIG15ICRGaWx0ZXIgKEBGaWx0ZXJzKSB7CiAgICAgICAgJFRleHQgPSAkRmlsdGVyLT57T2JqZWN0fS0+UHJlKAogICAgICAgICAgICBGaWx0ZXIgPT4gJEZpbHRlci0+e0ZpbHRlcn0sCiAgICAgICAgICAgIERhdGEgICA9PiAkVGV4dAogICAgICAgICk7CiAgICB9CiAgICBmb3IgbXkgJEZpbHRlciAoQEZpbHRlcnMpIHsKICAgICAgICAkVGV4dCA9ICRGaWx0ZXItPntPYmplY3R9LT5Qb3N0KAogICAgICAgICAgICBGaWx0ZXIgPT4gJEZpbHRlci0+e0ZpbHRlcn0sCiAgICAgICAgICAgIERhdGEgICA9PiAkVGV4dAogICAgICAgICk7CiAgICB9CgogICAgIyBkbyBtYWlsIHRvIHF1b3RlCiAgICAkeyRUZXh0fSA9fiBzLyhtYWlsdG86Lis/KShcLlxzfFxzfFwpfFwifF18JykvPGEgaHJlZj1cIiQxXCI+JDE8XC9hPiQyL2dpOwoKICAgICMgY2hlY2sgcmVmICYmIHJldHVybiByZXN1bHQgbGlrZSBjYWxsZWQKICAgIGlmICgkVGV4dFNjYWxhcikgewogICAgICAgIHJldHVybiAkeyRUZXh0fTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHJldHVybiAkVGV4dDsKICAgIH0KfQoKPWl0ZW0gSFRNTExpbmtRdW90ZSgpCgpzbyBzb21lIFVSTCBsaW5rIGRldGVjdGlvbnMgaW4gSFRNTCBjb2RlCgogICAgbXkgJEhUTUxXaXRoTGlua3MgPSAkTGF5b3V0T2JqZWN0LT5IVE1MTGlua1F1b3RlKAogICAgICAgIFN0cmluZyA9PiAkSFRNTFN0cmluZywKICAgICk7CgphbHNvIHN0cmluZyByZWYgaXMgcG9zc2libGUKCiAgICBteSAkSFRNTFdpdGhMaW5rc1JlZiA9ICRMYXlvdXRPYmplY3QtPkhUTUxMaW5rUXVvdGUoCiAgICAgICAgU3RyaW5nID0+IFwkSFRNTFN0cmluZywKICAgICk7Cgo9Y3V0CgpzdWIgSFRNTExpbmtRdW90ZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIHJldHVybiAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6SFRNTFV0aWxzJyktPkxpbmtRdW90ZSgKICAgICAgICBTdHJpbmcgICAgPT4gJFBhcmFte1N0cmluZ30sCiAgICAgICAgVGFyZ2V0QWRkID0+IDEsCiAgICAgICAgVGFyZ2V0ICAgID0+ICdfYmxhbmsnLAogICAgKTsKfQoKPWl0ZW0gTGlua0VuY29kZSgpCgpwZXJmb3JtIFVSTCBlbmNvZGluZyBvbiBxdWVyeSBzdHJpbmcgcGFyYW1ldGVyIG5hbWVzIG9yIHZhbHVlcy4KCiAgICBteSAkUGFyYW1WYWx1ZUVuY29kZWQgPSAkTGF5b3V0T2JqZWN0LT5MaW5rRW5jb2RlKCRQYXJhbVZhbHVlKTsKCkRvbid0IGVuY29kZSBlbnRpcmUgVVJMcywgYmVjYXVzZSB0aGlzIHdpbGwgbWFrZSB0aGVtIGludmFsaWQKKD8sICYgYW5kIDsgd2lsbCBiZSBlbmNvZGVkIGFzIHdlbGwpLiBPbmx5IHBhc3Mgb25lIHBhcmFtZXRlciBuYW1lCm9yIHZhbHVlIGF0IGEgdGltZS4KCj1jdXQKCnN1YiBMaW5rRW5jb2RlIHsKICAgIG15ICggJFNlbGYsICRMaW5rICkgPSBAXzsKCiAgICByZXR1cm4gaWYgIWRlZmluZWQgJExpbms7CgogICAgcmV0dXJuIFVSSTo6RXNjYXBlOjp1cmlfZXNjYXBlX3V0ZjgoJExpbmspOwp9CgpzdWIgQ3VzdG9tZXJBZ2VJbkhvdXJzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJEFnZSA9IGRlZmluZWQoICRQYXJhbXtBZ2V9ICkgPyAkUGFyYW17QWdlfSA6IHJldHVybjsKICAgIG15ICRTcGFjZSAgICAgPSAkUGFyYW17U3BhY2V9IHx8ICc8YnIvPic7CiAgICBteSAkQWdlU3RyZyAgID0gJyc7CiAgICBteSAkSG91ckRzYyAgID0gVHJhbnNsYXRhYmxlKCdoJyk7CiAgICBteSAkTWludXRlRHNjID0gVHJhbnNsYXRhYmxlKCdtJyk7CiAgICBpZiAoICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnVGltZVNob3dDb21wbGV0ZURlc2NyaXB0aW9uJykgKSB7CiAgICAgICAgJEhvdXJEc2MgICA9IFRyYW5zbGF0YWJsZSgnaG91cicpOwogICAgICAgICRNaW51dGVEc2MgPSBUcmFuc2xhdGFibGUoJ21pbnV0ZScpOwogICAgfQogICAgaWYgKCAkQWdlID1+IC9eLSguKikvICkgewogICAgICAgICRBZ2UgICAgID0gJDE7CiAgICAgICAgJEFnZVN0cmcgPSAnLSc7CiAgICB9CgogICAgIyBnZXQgaG91cnMKICAgIGlmICggJEFnZSA+PSAzNjAwICkgewogICAgICAgICRBZ2VTdHJnIC49IGludCggKCAkQWdlIC8gMzYwMCApICkgLiAnICc7CiAgICAgICAgJEFnZVN0cmcgLj0gJFNlbGYtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgkSG91ckRzYyk7CiAgICAgICAgJEFnZVN0cmcgLj0gJFNwYWNlOwogICAgfQoKICAgICMgZ2V0IG1pbnV0ZXMgKGp1c3QgaWYgYWdlIDwgMSBkYXkpCiAgICBpZiAoICRBZ2UgPD0gMzYwMCB8fCBpbnQoICggJEFnZSAvIDYwICkgJSA2MCApICkgewogICAgICAgICRBZ2VTdHJnIC49IGludCggKCAkQWdlIC8gNjAgKSAlIDYwICkgLiAnICc7CiAgICAgICAgJEFnZVN0cmcgLj0gJFNlbGYtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgkTWludXRlRHNjKTsKICAgIH0KICAgIHJldHVybiAkQWdlU3RyZzsKfQoKc3ViIEN1c3RvbWVyQWdlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgbXkgJEFnZSA9IGRlZmluZWQoICRQYXJhbXtBZ2V9ICkgPyAkUGFyYW17QWdlfSA6IHJldHVybjsKICAgIG15ICRTcGFjZSAgICAgPSAkUGFyYW17U3BhY2V9IHx8ICc8YnIvPic7CiAgICBteSAkQWdlU3RyZyAgID0gJyc7CiAgICBteSAkRGF5RHNjICAgID0gVHJhbnNsYXRhYmxlKCdkJyk7CiAgICBteSAkSG91ckRzYyAgID0gVHJhbnNsYXRhYmxlKCdoJyk7CiAgICBteSAkTWludXRlRHNjID0gVHJhbnNsYXRhYmxlKCdtJyk7CiAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnVGltZVNob3dDb21wbGV0ZURlc2NyaXB0aW9uJykgKSB7CiAgICAgICAgJERheURzYyAgICA9IFRyYW5zbGF0YWJsZSgnZGF5Jyk7CiAgICAgICAgJEhvdXJEc2MgICA9IFRyYW5zbGF0YWJsZSgnaG91cicpOwogICAgICAgICRNaW51dGVEc2MgPSBUcmFuc2xhdGFibGUoJ21pbnV0ZScpOwogICAgfQogICAgaWYgKCAkQWdlID1+IC9eLSguKikvICkgewogICAgICAgICRBZ2UgICAgID0gJDE7CiAgICAgICAgJEFnZVN0cmcgPSAnLSc7CiAgICB9CgogICAgIyBnZXQgZGF5cwogICAgaWYgKCAkQWdlID49IDg2NDAwICkgewogICAgICAgICRBZ2VTdHJnIC49IGludCggKCAkQWdlIC8gMzYwMCApIC8gMjQgKSAuICcgJzsKICAgICAgICAkQWdlU3RyZyAuPSAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCREYXlEc2MpOwogICAgICAgICRBZ2VTdHJnIC49ICRTcGFjZTsKICAgIH0KCiAgICAjIGdldCBob3VycwogICAgaWYgKCAkQWdlID49IDM2MDAgKSB7CiAgICAgICAgJEFnZVN0cmcgLj0gaW50KCAoICRBZ2UgLyAzNjAwICkgJSAyNCApIC4gJyAnOwogICAgICAgICRBZ2VTdHJnIC49ICRTZWxmLT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoJEhvdXJEc2MpOwogICAgICAgICRBZ2VTdHJnIC49ICRTcGFjZTsKICAgIH0KCiAgICAjIGdldCBtaW51dGVzIChqdXN0IGlmIGFnZSA8IDEgZGF5KQogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpbWVTaG93QWx3YXlzTG9uZycpIHx8ICRBZ2UgPCA4NjQwMCApIHsKICAgICAgICAkQWdlU3RyZyAuPSBpbnQoICggJEFnZSAvIDYwICkgJSA2MCApIC4gJyAnOwogICAgICAgICRBZ2VTdHJnIC49ICRTZWxmLT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoJE1pbnV0ZURzYyk7CiAgICB9CiAgICByZXR1cm4gJEFnZVN0cmc7Cn0KCj1pdGVtIEJ1aWxkU2VsZWN0aW9uKCkKCmJ1aWxkIGEgSFRNTCBvcHRpb24gZWxlbWVudCBiYXNlZCBvbiBnaXZlbiBkYXRhCgogICAgbXkgJEhUTUwgPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICBEYXRhICAgICAgICAgICAgPT4gJEFycmF5UmVmLCAgICAgICAgICAgICAjIHVzZSAkSGFzaFJlZiwgJEFycmF5UmVmIG9yICRBcnJheUhhc2hSZWYgKHNlZSBiZWxvdykKICAgICAgICBOYW1lICAgICAgICAgICAgPT4gJ1RoZU5hbWUnLCAgICAgICAgICAgICAjIG5hbWUgb2YgZWxlbWVudAogICAgICAgIElEICAgICAgICAgICAgICA9PiAnSFRNTElEJywgICAgICAgICAgICAgICMgKG9wdGlvbmFsKSB0aGUgSFRNTCBJRCBmb3IgdGhpcyBlbGVtZW50LCBpZiBub3QgcHJvdmlkZWQsIHRoZSBuYW1lIHdpbGwgYmUgdXNlZCBhcyBJRCBhcyB3ZWxsCiAgICAgICAgTXVsdGlwbGUgICAgICAgID0+IDAsICAgICAgICAgICAgICAgICAgICAgIyAob3B0aW9uYWwpIGRlZmF1bHQgMCAoMHwxKQogICAgICAgIFNpemUgICAgICAgICAgICA9PiAxLCAgICAgICAgICAgICAgICAgICAgICMgKG9wdGlvbmFsKSBkZWZhdWx0IDEgZWxlbWVudCBzaXplCiAgICAgICAgQ2xhc3MgICAgICAgICAgID0+ICdjbGFzcycsICAgICAgICAgICAgICAgIyAob3B0aW9uYWwpIGEgY3NzIGNsYXNzLCBpbmNsdWRlICdNb2Rlcm5pemUnIHRvIGFjdGl2YXRlIElucHV0RmllbGRzCiAgICAgICAgRGlzYWJsZWQgICAgICAgID0+IDAsICAgICAgICAgICAgICAgICAgICAgIyAob3B0aW9uYWwpIGRlZmF1bHQgMCAoMHwxKSBkaXNhYmxlIHRoZSBlbGVtZW50CiAgICAgICAgQXV0b0NvbXBsZXRlICAgID0+ICdvZmYnLCAgICAgICAgICAgICAgICAgIyAob3B0aW9uYWwpCiAgICAgICAgT25DaGFuZ2UgICAgICAgID0+ICdqYXZhc2NyaXB0JywgICAgICAgICAgIyAob3B0aW9uYWwpCiAgICAgICAgT25DbGljayAgICAgICAgID0+ICdqYXZhc2NyaXB0JywgICAgICAgICAgIyAob3B0aW9uYWwpCgogICAgICAgIFNlbGVjdGVkSUQgICAgID0+IDEsICAgICAgICAgICAgICAgICAjIChvcHRpb25hbCkgdXNlIGludGVnZXIgb3IgYXJyYXlyZWYgKHVuYWJsZSB0byB1c2Ugd2l0aCBBcnJheUhhc2hSZWYpCiAgICAgICAgU2VsZWN0ZWRJRCAgICAgPT4gWzEsIDUsIDNdLCAgICAgICAgICMgKG9wdGlvbmFsKSB1c2UgaW50ZWdlciBvciBhcnJheXJlZiAodW5hYmxlIHRvIHVzZSB3aXRoIEFycmF5SGFzaFJlZikKICAgICAgICBTZWxlY3RlZFZhbHVlICA9PiAndGVzdCcsICAgICAgICAgICAgIyAob3B0aW9uYWwpIHVzZSBzdHJpbmcgb3IgYXJyYXlyZWYgKHVuYWJsZSB0byB1c2Ugd2l0aCBBcnJheUhhc2hSZWYpCiAgICAgICAgU2VsZWN0ZWRWYWx1ZSAgPT4gWyd0ZXN0JywgJ3Rlc3QxJ10sICMgKG9wdGlvbmFsKSB1c2Ugc3RyaW5nIG9yIGFycmF5cmVmICh1bmFibGUgdG8gdXNlIHdpdGggQXJyYXlIYXNoUmVmKQoKICAgICAgICBTb3J0ICAgICAgICAgICA9PiAnTnVtZXJpY1ZhbHVlJywgICAgIyAob3B0aW9uYWwpIChBbHBoYW51bWVyaWNWYWx1ZXxOdW1lcmljVmFsdWV8QWxwaGFudW1lcmljS2V5fE51bWVyaWNLZXl8VHJlZVZpZXd8SW5kaXZpZHVhbEtleXxJbmRpdmlkdWFsVmFsdWUpIHVuYWJsZSB0byB1c2Ugd2l0aCBBcnJheUhhc2hSZWYKICAgICAgICBTb3J0SW5kaXZpZHVhbCA9PiBbJ3NlYycsICdtaW4nXSAgICAgIyAob3B0aW9uYWwpIG9ubHkgc29ydCBpcyBzZXQgdG8gSW5kaXZpZHVhbEtleSBvciBJbmRpdmlkdWFsVmFsdWUKICAgICAgICBTb3J0UmV2ZXJzZSAgICA9PiAwLCAgICAgICAgICAgICAgICAgIyAob3B0aW9uYWwpIHJldmVyc2UgdGhlIGxpc3QKCiAgICAgICAgVHJhbnNsYXRpb24gICAgPT4gMSwgICAgICAgICAgICAgICAgICMgKG9wdGlvbmFsKSBkZWZhdWx0IDEgKDB8MSkgdHJhbnNsYXRlIHZhbHVlCiAgICAgICAgUG9zc2libGVOb25lICAgPT4gMCwgICAgICAgICAgICAgICAgICMgKG9wdGlvbmFsKSBkZWZhdWx0IDAgKDB8MSkgYWRkIGEgbGVhZGluZyBlbXB0eSBzZWxlY3Rpb24KICAgICAgICBUcmVlVmlldyAgICAgICA9PiAwLCAgICAgICAgICAgICAgICAgIyAob3B0aW9uYWwpIGRlZmF1bHQgMCAoMHwxKQogICAgICAgIERpc2FibGVkQnJhbmNoID0+ICdCcmFuY2gnLCAgICAgICAgICAjIChvcHRpb25hbCkgZGlzYWJsZSBhbGwgZWxlbWVudHMgb2YgdGhpcyBicmFuY2ggKHVzZSBzdHJpbmcgb3IgYXJyYXlyZWYpCiAgICAgICAgTWF4ICAgICAgICAgICAgPT4gMTAwLCAgICAgICAgICAgICAgICMgKG9wdGlvbmFsKSBkZWZhdWx0IDEwMCBtYXggc2l6ZSBvZiB0aGUgc2hvd24gdmFsdWUKICAgICAgICBIVE1MUXVvdGUgICAgICA9PiAwLCAgICAgICAgICAgICAgICAgIyAob3B0aW9uYWwpIGRlZmF1bHQgMSAoMHwxKSBkaXNhYmxlIGh0bWwgcXVvdGUKICAgICAgICBUaXRsZSAgICAgICAgICA9PiAnVG9vbHRpcCBUZXh0JywgICAgIyAob3B0aW9uYWwpIHN0cmluZyB3aWxsIGJlIHNob3duIGFzIFRvb2x0aXAgb24gbW91c2VvdmVyCiAgICAgICAgT3B0aW9uVGl0bGUgICAgPT4gMSwgICAgICAgICAgICAgICAgICMgKG9wdGlvbmFsKSBkZWZhdWx0IDAgKDB8MSkgc2hvdyB0aXRsZSBhdHRyaWJ1dGUgKHRoZSBvcHRpb24gdmFsdWUpIG9uIGV2ZXJ5IG9wdGlvbiBlbGVtZW50CgogICAgICAgIEZpbHRlcnMgPT4geyAgICAgICAgICAgICAgICAgICAgICAgICAjIChvcHRpb25hbCkgZmlsdGVyIGRhdGEsIHVzZWQgYnkgSW5wdXRGaWVsZHMKICAgICAgICAgICAgTGFzdE93bmVycyA9PiB7ICAgICAgICAgICAgICAgICAgIyBmaWx0ZXIgaWQKICAgICAgICAgICAgICAgIE5hbWUgICA9PiAnTGFzdCBvd25lcnMnLCAgICAgIyBuYW1lIG9mIHRoZSBmaWx0ZXIKICAgICAgICAgICAgICAgIFZhbHVlcyA9PiB7ICAgICAgICAgICAgICAgICAgIyBmaWx0ZXJlZCBkYXRhIHN0cnVjdHVyZQogICAgICAgICAgICAgICAgICAgIEtleTEgPT4gJ1ZhbHVlMScsCiAgICAgICAgICAgICAgICAgICAgS2V5MiA9PiAnVmFsdWUyJywKICAgICAgICAgICAgICAgICAgICBLZXkzID0+ICdWYWx1ZTMnLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIEFjdGl2ZSA9PiAxLCAgICAgICAgICAgICAgICAgIyAob3B0aW9uYWwpIGRlZmF1bHQgMCAoMHwxKSBtYWtlIHRoaXMgZmlsdGVyIGltbWVkaWF0ZWx5IGFjdGl2ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBJbnZvbHZlZEFnZW50cyA9PiB7CiAgICAgICAgICAgICAgICBOYW1lICAgPT4gJ0ludm9sdmVkIGluIHRoaXMgdGlja2V0JywKICAgICAgICAgICAgICAgIFZhbHVlcyA9PiBcJUhhc2hXaXRoRGF0YSwKICAgICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIEV4cGFuZEZpbHRlcnMgID0+IDEsICAgICAgICAgICAgICAgICAjIChvcHRpb25hbCkgZGVmYXVsdCAwICgwfDEpIGV4cGFuZCBmaWx0ZXJzIGxpc3QgYnkgZGVmYXVsdAogICAgKTsKCiAgICBteSAkSGFzaFJlZiA9IHsKICAgICAgICBLZXkxID0+ICdWYWx1ZTEnLAogICAgICAgIEtleTIgPT4gJ1ZhbHVlMicsCiAgICAgICAgS2V5MyA9PiAnVmFsdWUzJywKICAgIH07CgogICAgbXkgJEFycmF5UmVmID0gWwogICAgICAgICdLZXlWYWx1ZTEnLAogICAgICAgICdLZXlWYWx1ZTInLAogICAgICAgICdLZXlWYWx1ZTMnLAogICAgICAgICdLZXlWYWx1ZTQnLAogICAgXTsKCiAgICBteSAkQXJyYXlIYXNoUmVmID0gWwogICAgICAgIHsKICAgICAgICAgICAgS2V5ICAgPT4gJzEnLAogICAgICAgICAgICBWYWx1ZSA9PiAnVmFsdWUxJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgS2V5ICAgICAgPT4gJzInLAogICAgICAgICAgICBWYWx1ZSAgICA9PiAnVmFsdWUxOjpTdWJ2YWx1ZTEnLAogICAgICAgICAgICBTZWxlY3RlZCA9PiAxLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBLZXkgICA9PiAnMycsCiAgICAgICAgICAgIFZhbHVlID0+ICdWYWx1ZTE6OlN1YnZhbHVlMicsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIEtleSAgICAgID0+ICc0JywKICAgICAgICAgICAgVmFsdWUgICAgPT4gJ1ZhbHVlMicsCiAgICAgICAgICAgIERpc2FibGVkID0+IDEsCiAgICAgICAgfQogICAgXTsKCj1jdXQKCnN1YiBCdWlsZFNlbGVjdGlvbiB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgKHF3KE5hbWUgRGF0YSkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JF99ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkXyEiCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgIyBUaGUgcGFyYW1ldGVycyAnQWpheCcgYW5kICdPbkNoYW5nZScgYXJlIGV4Y2x1c2l2ZQogICAgaWYgKCAkUGFyYW17QWpheH0gJiYgJFBhcmFte09uQ2hhbmdlfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIlRoZSBwYXJhbWV0ZXJzICdPbkNoYW5nZScgYW5kICdBamF4JyBleGNsdWRlIGVhY2ggb3RoZXIhIgogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgc2V0IE9uQ2hhbmdlIGlmIEFKQVggaXMgdXNlZAogICAgaWYgKCAkUGFyYW17QWpheH0gKSB7CiAgICAgICAgaWYgKCAhJFBhcmFte0FqYXh9LT57RGVwZW5kfSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgRGVwZW5kIFBhcmFtIEFqYXggb3B0aW9uIScsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRTZWxmLT5GYXRhbEVycm9yKCk7CiAgICAgICAgfQogICAgICAgIGlmICggISRQYXJhbXtBamF4fS0+e1VwZGF0ZX0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdOZWVkIFVwZGF0ZSBQYXJhbSBBamF4IG9wdGlvbigpIScsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRTZWxmLT5GYXRhbEVycm9yKCk7CiAgICAgICAgfQogICAgICAgIG15ICRTZWxlY3RvciA9ICRQYXJhbXtJRH0gfHwgJFBhcmFte05hbWV9OwogICAgICAgICRQYXJhbXtPbkNoYW5nZX0gPSAiQ29yZS5BSkFYLkZvcm1VcGRhdGUoXCQoJyMiCiAgICAgICAgICAgIC4gJFNlbGVjdG9yIC4gIicpLCAnIiAuICRQYXJhbXtBamF4fS0+e1N1YmFjdGlvbn0gLiAiJywiCiAgICAgICAgICAgIC4gIiAnJFBhcmFte05hbWV9JywiCiAgICAgICAgICAgIC4gIiBbJyIKICAgICAgICAgICAgLiBqb2luKCAiJywgJyIsIEB7ICRQYXJhbXtBamF4fS0+e1VwZGF0ZX0gfSApIC4gIiddKTsiOwogICAgfQoKICAgICMgY3JlYXRlIE9wdGlvblJlZgogICAgbXkgJE9wdGlvblJlZiA9ICRTZWxmLT5fQnVpbGRTZWxlY3Rpb25PcHRpb25SZWZDcmVhdGUoJVBhcmFtKTsKCiAgICAjIGNyZWF0ZSBBdHRyaWJ1dGVSZWYKICAgIG15ICRBdHRyaWJ1dGVSZWYgPSAkU2VsZi0+X0J1aWxkU2VsZWN0aW9uQXR0cmlidXRlUmVmQ3JlYXRlKCVQYXJhbSk7CgogICAgIyBjcmVhdGUgRGF0YVJlZgogICAgbXkgJERhdGFSZWYgPSAkU2VsZi0+X0J1aWxkU2VsZWN0aW9uRGF0YVJlZkNyZWF0ZSgKICAgICAgICBEYXRhICAgICAgICAgPT4gJFBhcmFte0RhdGF9LAogICAgICAgIEF0dHJpYnV0ZVJlZiA9PiAkQXR0cmlidXRlUmVmLAogICAgICAgIE9wdGlvblJlZiAgICA9PiAkT3B0aW9uUmVmLAogICAgKTsKCiAgICAjIGNyZWF0ZSBGaWx0ZXJzUmVmCiAgICBteSBARmlsdGVyczsKICAgIG15ICRGaWx0ZXJBY3RpdmU7CiAgICBpZiAoICRQYXJhbXtGaWx0ZXJzfSApIHsKICAgICAgICBteSAkSW5kZXggPSAxOwogICAgICAgIGZvciBteSAkRmlsdGVyICggc29ydCBrZXlzICV7ICRQYXJhbXtGaWx0ZXJzfSB9ICkgewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAkUGFyYW17RmlsdGVyc30tPnskRmlsdGVyfS0+e05hbWV9CiAgICAgICAgICAgICAgICAmJiAkUGFyYW17RmlsdGVyc30tPnskRmlsdGVyfS0+e1ZhbHVlc30KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbXkgJEZpbHRlckRhdGEgPSAkU2VsZi0+X0J1aWxkU2VsZWN0aW9uRGF0YVJlZkNyZWF0ZSgKICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgPT4gJFBhcmFte0ZpbHRlcnN9LT57JEZpbHRlcn0tPntWYWx1ZXN9LAogICAgICAgICAgICAgICAgICAgIEF0dHJpYnV0ZVJlZiA9PiAkQXR0cmlidXRlUmVmLAogICAgICAgICAgICAgICAgICAgIE9wdGlvblJlZiAgICA9PiAkT3B0aW9uUmVmLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHB1c2ggQEZpbHRlcnMsIHsKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICRQYXJhbXtGaWx0ZXJzfS0+eyRGaWx0ZXJ9LT57TmFtZX0sCiAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiAkRmlsdGVyRGF0YSwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBpZiAoICRQYXJhbXtGaWx0ZXJzfS0+eyRGaWx0ZXJ9LT57QWN0aXZlfSApIHsKICAgICAgICAgICAgICAgICAgICAkRmlsdGVyQWN0aXZlID0gJEluZGV4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAnRWFjaCBGaWx0ZXIgbXVzdCBwcm92aWRlIE5hbWUgYW5kIFZhbHVlcyEnLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICRTZWxmLT5GYXRhbEVycm9yKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJEluZGV4Kys7CiAgICAgICAgfQogICAgICAgIEBGaWx0ZXJzID0gc29ydCB7ICRhLT57TmFtZX0gY21wICRiLT57TmFtZX0gfSBARmlsdGVyczsKICAgIH0KCiAgICAjIGdlbmVyYXRlIG91dHB1dAogICAgbXkgJFN0cmluZyA9ICRTZWxmLT5fQnVpbGRTZWxlY3Rpb25PdXRwdXQoCiAgICAgICAgQXR0cmlidXRlUmVmICA9PiAkQXR0cmlidXRlUmVmLAogICAgICAgIERhdGFSZWYgICAgICAgPT4gJERhdGFSZWYsCiAgICAgICAgT3B0aW9uVGl0bGUgICA9PiAkUGFyYW17T3B0aW9uVGl0bGV9LAogICAgICAgIFRyZWVWaWV3ICAgICAgPT4gJFBhcmFte1RyZWVWaWV3fSwKICAgICAgICBGaWx0ZXJzUmVmICAgID0+IFxARmlsdGVycywKICAgICAgICBGaWx0ZXJBY3RpdmUgID0+ICRGaWx0ZXJBY3RpdmUsCiAgICAgICAgRXhwYW5kRmlsdGVycyA9PiAkUGFyYW17RXhwYW5kRmlsdGVyc30sCiAgICApOwogICAgcmV0dXJuICRTdHJpbmc7Cn0KCnN1YiBOb1Blcm1pc3Npb24gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkV2l0aEhlYWRlciA9ICRQYXJhbXtXaXRoSGVhZGVyfSB8fCAneWVzJzsKCiAgICBpZiAoICEkUGFyYW17TWVzc2FnZX0gKSB7CiAgICAgICAgJFBhcmFte01lc3NhZ2V9ID0gJFNlbGYtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgJ1dlIGFyZSBzb3JyeSwgeW91IGRvIG5vdCBoYXZlIHBlcm1pc3Npb25zIGFueW1vcmUgdG8gYWNjZXNzIHRoaXMgdGlja2V0IGluIGl0cyBjdXJyZW50IHN0YXRlLiBZb3UgY2FuIHRha2Ugb25lIG9mIHRoZSBmb2xsb3dpbmcgYWN0aW9uczonCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGdldCBjb25maWcgb3B0aW9uIGZvciBwb3NzaWJsZSBuZXh0IGFjdGlvbnMKICAgIG15ICRQb3NzaWJsZU5leHRBY3Rpb25zID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdQb3NzaWJsZU5leHRBY3Rpb25zJyk7CgogICAgUE9TU0lCTEU6CiAgICBpZiAoIElzSGFzaFJlZldpdGhEYXRhKCRQb3NzaWJsZU5leHRBY3Rpb25zKSApIHsKICAgICAgICAkU2VsZi0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1Bvc3NpYmxlTmV4dEFjdGlvbkNvbnRhaW5lcicsCiAgICAgICAgKTsKICAgICAgICBmb3IgbXkgJEtleSAoIHNvcnQga2V5cyAleyRQb3NzaWJsZU5leHRBY3Rpb25zfSApIHsKICAgICAgICAgICAgbmV4dCBQT1NTSUJMRSBpZiAhJEtleTsKICAgICAgICAgICAgbmV4dCBQT1NTSUJMRSBpZiAhJFBvc3NpYmxlTmV4dEFjdGlvbnMtPnskS2V5fTsKCiAgICAgICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1Bvc3NpYmxlTmV4dEFjdGlvblJvdycsCiAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICBMaW5rICAgICAgICA9PiAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCAkUG9zc2libGVOZXh0QWN0aW9ucy0+eyRLZXl9ICksCiAgICAgICAgICAgICAgICAgICAgRGVzY3JpcHRpb24gPT4gJEtleSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgY3JlYXRlIG91dHB1dAogICAgbXkgJE91dHB1dDsKICAgICRPdXRwdXQgPSAkU2VsZi0+SGVhZGVyKCBUaXRsZSA9PiAnSW5zdWZmaWNpZW50IFJpZ2h0cycgKSBpZiAoICRXaXRoSGVhZGVyIGVxICd5ZXMnICk7CiAgICAkT3V0cHV0IC49ICRTZWxmLT5PdXRwdXQoCiAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdOb1Blcm1pc3Npb24nLAogICAgICAgIERhdGEgICAgICAgICA9PiBcJVBhcmFtCiAgICApOwogICAgJE91dHB1dCAuPSAkU2VsZi0+Rm9vdGVyKCkgaWYgKCAkV2l0aEhlYWRlciBlcSAneWVzJyApOwoKICAgICMgcmV0dXJuIG91dHB1dAogICAgcmV0dXJuICRPdXRwdXQ7Cn0KCj1pdGVtIFBlcm1pc3Npb24oKQoKY2hlY2sgaWYgYWNjZXNzIHRvIGEgZnJvbnRlbmQgbW9kdWxlIGV4aXN0cwoKICAgIG15ICRBY2Nlc3MgPSAkTGF5b3V0T2JqZWN0LT5QZXJtaXNzaW9uKAogICAgICAgIEFjdGlvbiA9PiAnQWRtaW5DdXN0b21lclVzZXInLAogICAgICAgIFR5cGUgICA9PiAncncnLCAjIHJvfHJ3IHBvc3NpYmxlCiAgICApOwoKPWN1dAoKc3ViIFBlcm1pc3Npb24gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBwYXJhbXMKICAgIGZvciAocXcoQWN0aW9uIFR5cGUpKSB7CiAgICAgICAgaWYgKCAhZGVmaW5lZCAkUGFyYW17JF99ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiR290IG5vICRfISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRTZWxmLT5GYXRhbEVycm9yKCk7CiAgICAgICAgfQogICAgfQoKICAgICMgY2hlY2sgaWYgaXQgaXMgcm98cncKICAgIG15ICVNYXAgPSAoCiAgICAgICAgcm8gPT4gJ0dyb3VwUm8nLAogICAgICAgIHJ3ID0+ICdHcm91cCcsCgogICAgKTsKICAgIG15ICRQZXJtaXNzaW9uID0gJE1hcHsgJFBhcmFte1R5cGV9IH07CiAgICByZXR1cm4gaWYgISRQZXJtaXNzaW9uOwoKICAgICMgZ2V0IGNvbmZpZyBvcHRpb24gZm9yIGZyb250ZW5kIG1vZHVsZQogICAgbXkgJENvbmZpZyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnRnJvbnRlbmQ6Ok1vZHVsZScpLT57ICRQYXJhbXtBY3Rpb259IH07CiAgICByZXR1cm4gaWYgISRDb25maWc7CgogICAgbXkgJEl0ZW0gPSAkQ29uZmlnLT57JFBlcm1pc3Npb259OwoKICAgICMgYXJyYXkgYWNjZXNzIHJlc3RyaWN0aW9uCiAgICBteSAkQWNjZXNzID0gMDsKICAgIGlmICggJEl0ZW0gJiYgcmVmICRJdGVtIGVxICdBUlJBWScgKSB7CiAgICAgICAgZm9yICggQHskSXRlbX0gKSB7CiAgICAgICAgICAgIG15ICRLZXkgPSAnVXNlcklzJyAuICRQZXJtaXNzaW9uIC4gJ1snIC4gJF8gLiAnXSc7CiAgICAgICAgICAgIGlmICggJFNlbGYtPnskS2V5fSAmJiAkU2VsZi0+eyRLZXl9IGVxICdZZXMnICkgewogICAgICAgICAgICAgICAgJEFjY2VzcyA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBzY2FsYXIgYWNjZXNzIHJlc3RyaWN0aW9uCiAgICBlbHNpZiAoJEl0ZW0pIHsKICAgICAgICBteSAkS2V5ID0gJ1VzZXJJcycgLiAkUGVybWlzc2lvbiAuICdbJyAuICRJdGVtIC4gJ10nOwogICAgICAgIGlmICggJFNlbGYtPnskS2V5fSAmJiAkU2VsZi0+eyRLZXl9IGVxICdZZXMnICkgewogICAgICAgICAgICAkQWNjZXNzID0gMTsKICAgICAgICB9CiAgICB9CgogICAgIyBubyBhY2Nlc3MgcmVzdHJpY3Rpb24KICAgIGVsc2lmICggISRDb25maWctPntHcm91cFJvfSAmJiAhJENvbmZpZy0+e0dyb3VwfSApIHsKICAgICAgICAkQWNjZXNzID0gMTsKICAgIH0KICAgIHJldHVybiAkQWNjZXNzOwp9CgpzdWIgQ2hlY2tNaW1lVHlwZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRPdXRwdXQgPSAnJzsKICAgIGlmICggISRQYXJhbXtBY3Rpb259ICkgewogICAgICAgICRQYXJhbXtBY3Rpb259ID0gJ1slIEVudigiQWN0aW9uIikgJV0nOwogICAgfQoKICAgICMgY2hlY2sgaWYgaXQgaXMgYSB0ZXh0L3BsYWluIGVtYWlsCiAgICBpZiAoICRQYXJhbXtNaW1lVHlwZX0gJiYgJFBhcmFte01pbWVUeXBlfSAhfiAvdGV4dFwvcGxhaW4vaSApIHsKICAgICAgICAkT3V0cHV0ID0gJzxwPjxpIGNsYXNzPSJzbWFsbCI+JwogICAgICAgICAgICAuICRTZWxmLT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoIlRoaXMgaXMgYSIpCiAgICAgICAgICAgIC4gIiAkUGFyYW17TWltZVR5cGV9ICIKICAgICAgICAgICAgLiAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCJlbWFpbCIpCiAgICAgICAgICAgIC4gJywgPGEgaHJlZj0iJwogICAgICAgICAgICAuICRTZWxmLT57QmFzZWxpbmt9CiAgICAgICAgICAgIC4gIkFjdGlvbj0kUGFyYW17QWN0aW9ufTtUaWNrZXRJRD0iCiAgICAgICAgICAgIC4gIiRQYXJhbXtUaWNrZXRJRH07QXJ0aWNsZUlEPSRQYXJhbXtBcnRpY2xlSUR9O1N1YmFjdGlvbj1TaG93SFRNTGVNYWlsXCIgIgogICAgICAgICAgICAuICd0YXJnZXQ9IkhUTUxlTWFpbCI+JwogICAgICAgICAgICAuICRTZWxmLT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoImNsaWNrIGhlcmUiKQogICAgICAgICAgICAuICc8L2E+ICcKICAgICAgICAgICAgLiAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCJ0byBvcGVuIGl0IGluIGEgbmV3IHdpbmRvdy4iKQogICAgICAgICAgICAuICc8L2k+PC9wPic7CiAgICB9CgogICAgIyBqdXN0IHRvIGJlIGNvbXBhdAogICAgZWxzaWYgKCAkUGFyYW17Qm9keX0gPX4gL148LkRPQ1RZUEVccytodG1sfF48SFRNTD4vaSApIHsKICAgICAgICAkT3V0cHV0ID0gJzxwPjxpIGNsYXNzPSJzbWFsbCI+JwogICAgICAgICAgICAuICRTZWxmLT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoIlRoaXMgaXMgYSIpCiAgICAgICAgICAgIC4gIiAkUGFyYW17TWltZVR5cGV9ICIKICAgICAgICAgICAgLiAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCJlbWFpbCIpCiAgICAgICAgICAgIC4gJywgPGEgaHJlZj0iJwogICAgICAgICAgICAuICRTZWxmLT57QmFzZWxpbmt9CiAgICAgICAgICAgIC4gJ0FjdGlvbj0kUGFyYW17QWN0aW9ufTtUaWNrZXRJRD0nCiAgICAgICAgICAgIC4gIiRQYXJhbXtUaWNrZXRJRH07QXJ0aWNsZUlEPSRQYXJhbXtBcnRpY2xlSUR9O1N1YmFjdGlvbj1TaG93SFRNTGVNYWlsXCIgIgogICAgICAgICAgICAuICd0YXJnZXQ9IkhUTUxlTWFpbCI+JwogICAgICAgICAgICAuICRTZWxmLT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoImNsaWNrIGhlcmUiKQogICAgICAgICAgICAuICc8L2E+ICcKICAgICAgICAgICAgLiAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCJ0byBvcGVuIGl0IGluIGEgbmV3IHdpbmRvdy4iKQogICAgICAgICAgICAuICc8L2k+PC9wPic7CiAgICB9CgogICAgIyByZXR1cm4gbm90ZSBzdHJpbmcKICAgIHJldHVybiAkT3V0cHV0Owp9CgpzdWIgUmV0dXJuVmFsdWUgewogICAgbXkgKCAkU2VsZiwgJFdoYXQgKSA9IEBfOwoKICAgIHJldHVybiAkU2VsZi0+eyRXaGF0fTsKfQoKPWl0ZW0gQXR0YWNobWVudCgpCgpyZXR1cm5zIGJyb3dzZXIgb3V0cHV0IHRvIGRpc3BsYXkvZG93bmxvYWQgYSBhdHRhY2htZW50CgogICAgJEhUTUwgPSAkTGF5b3V0T2JqZWN0LT5BdHRhY2htZW50KAogICAgICAgIFR5cGUgICAgICAgID0+ICdpbmxpbmUnLCAgICAgICAgIyBvcHRpb25hbCwgZGVmYXVsdDogYXR0YWNobWVudCwgcG9zc2libGU6IGlubGluZXxhdHRhY2htZW50CiAgICAgICAgRmlsZW5hbWUgICAgPT4gJ0ZpbGVOYW1lLnBuZycsICAjIG9wdGlvbmFsCiAgICAgICAgQ29udGVudFR5cGUgPT4gJ2ltYWdlL3BuZycsCiAgICAgICAgQ29udGVudCAgICAgPT4gJENvbnRlbnQsCiAgICApOwoKICAgIG9yIGZvciBBSkFYIGh0bWwgc25pcHBldHMKCiAgICAkSFRNTCA9ICRMYXlvdXRPYmplY3QtPkF0dGFjaG1lbnQoCiAgICAgICAgVHlwZSAgICAgICAgPT4gJ2lubGluZScsICAgICAgICAjIG9wdGlvbmFsLCBkZWZhdWx0OiBhdHRhY2htZW50LCBwb3NzaWJsZTogaW5saW5lfGF0dGFjaG1lbnQKICAgICAgICBGaWxlbmFtZSAgICA9PiAnRmlsZU5hbWUuaHRtbCcsICMgb3B0aW9uYWwKICAgICAgICBDb250ZW50VHlwZSA9PiAndGV4dC9odG1sJywKICAgICAgICBDaGFyc2V0ICAgICA9PiAndXRmLTgnLCAgICAgICAgICMgb3B0aW9uYWwKICAgICAgICBDb250ZW50ICAgICA9PiAkQ29udGVudCwKICAgICAgICBOb0NhY2hlICAgICA9PiAxLCAgICAgICAgICAgICAgICMgb3B0aW9uYWwKICAgICk7Cgo9Y3V0CgpzdWIgQXR0YWNobWVudCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHBhcmFtcwogICAgZm9yIChxdyhDb250ZW50IENvbnRlbnRUeXBlKSkgewogICAgICAgIGlmICggIWRlZmluZWQgJFBhcmFteyRffSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkdvdCBubyAkXyEiLAogICAgICAgICAgICApOwogICAgICAgICAgICAkU2VsZi0+RmF0YWxFcnJvcigpOwogICAgICAgIH0KICAgIH0KCiAgICAjIHJldHVybiBhdHRhY2htZW50CiAgICBteSAkT3V0cHV0ID0gJ0NvbnRlbnQtRGlzcG9zaXRpb246ICc7CiAgICBpZiAoICRQYXJhbXtUeXBlfSApIHsKICAgICAgICAkT3V0cHV0IC49ICRQYXJhbXtUeXBlfTsKICAgICAgICAkT3V0cHV0IC49ICc7ICc7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkT3V0cHV0IC49ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnQXR0YWNobWVudERvd25sb2FkVHlwZScpIHx8ICdhdHRhY2htZW50JzsKICAgICAgICAkT3V0cHV0IC49ICc7ICc7CiAgICB9CgogICAgaWYgKCAkUGFyYW17RmlsZW5hbWV9ICkgewoKICAgICAgICAjIElFIDEwKyBzdXBwb3J0cyB0aGlzCiAgICAgICAgbXkgJFVSTEVuY29kZWRGaWxlbmFtZSA9IFVSSTo6RXNjYXBlOjp1cmlfZXNjYXBlX3V0ZjgoICRQYXJhbXtGaWxlbmFtZX0gKTsKICAgICAgICAkT3V0cHV0IC49ICIgZmlsZW5hbWU9XCIkUGFyYW17RmlsZW5hbWV9XCI7IGZpbGVuYW1lKj11dGYtOCcnJFVSTEVuY29kZWRGaWxlbmFtZSI7CiAgICB9CiAgICAkT3V0cHV0IC49ICJcbiI7CgogICAgIyBnZXQgYXR0YWNobWVudCBzaXplCiAgICAkUGFyYW17U2l6ZX0gPSBieXRlczo6bGVuZ3RoKCAkUGFyYW17Q29udGVudH0gKTsKCiAgICAjIGFkZCBubyBjYWNoZSBoZWFkZXJzCiAgICBpZiAoICRQYXJhbXtOb0NhY2hlfSApIHsKICAgICAgICAkT3V0cHV0IC49ICJFeHBpcmVzOiBUdWUsIDEgSmFuIDE5ODAgMTI6MDA6MDAgR01UXG4iOwogICAgICAgICRPdXRwdXQgLj0gIkNhY2hlLUNvbnRyb2w6IG5vLWNhY2hlXG4iOwogICAgICAgICRPdXRwdXQgLj0gIlByYWdtYTogbm8tY2FjaGVcbiI7CiAgICB9CiAgICAkT3V0cHV0IC49ICJDb250ZW50LUxlbmd0aDogJFBhcmFte1NpemV9XG4iOwogICAgJE91dHB1dCAuPSAiWC1VQS1Db21wYXRpYmxlOiBJRT1lZGdlLGNocm9tZT0xXG4iOwoKICAgIGlmICggISRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnRGlzYWJsZUlGcmFtZU9yaWdpblJlc3RyaWN0ZWQnKSApIHsKICAgICAgICAkT3V0cHV0IC49ICJYLUZyYW1lLU9wdGlvbnM6IFNBTUVPUklHSU5cbiI7CiAgICB9CgogICAgaWYgKCAkUGFyYW17Q2hhcnNldH0gKSB7CiAgICAgICAgJE91dHB1dCAuPSAiQ29udGVudC1UeXBlOiAkUGFyYW17Q29udGVudFR5cGV9OyBjaGFyc2V0PSRQYXJhbXtDaGFyc2V0fTtcblxuIjsKICAgIH0KICAgIGVsc2UgewogICAgICAgICRPdXRwdXQgLj0gIkNvbnRlbnQtVHlwZTogJFBhcmFte0NvbnRlbnRUeXBlfVxuXG4iOwogICAgfQoKICAgICMgZGlzYWJsZSB1dGY4IGZsYWcsIHRvIHdyaXRlIGJpbmFyeSB0byBvdXRwdXQKICAgIG15ICRFbmNvZGVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RW5jb2RlJyk7CiAgICAkRW5jb2RlT2JqZWN0LT5FbmNvZGVPdXRwdXQoIFwkT3V0cHV0ICk7CiAgICAkRW5jb2RlT2JqZWN0LT5FbmNvZGVPdXRwdXQoIFwkUGFyYW17Q29udGVudH0gKTsKCiAgICAjIGZpeCBmb3IgZmlyZWZveCBIRUFEIHByb2JsZW0KICAgIGlmICggISRFTlZ7UkVRVUVTVF9NRVRIT0R9IHx8ICRFTlZ7UkVRVUVTVF9NRVRIT0R9IG5lICdIRUFEJyApIHsKICAgICAgICAkT3V0cHV0IC49ICRQYXJhbXtDb250ZW50fTsKICAgIH0KCiAgICAjIHJlc2V0IGJpbm1vZGUsIGRvbid0IHVzZSB1dGY4CiAgICBiaW5tb2RlIFNURE9VVCwgJzpieXRlcyc7CgogICAgcmV0dXJuICRPdXRwdXQ7Cn0KCj1pdGVtIFBhZ2VOYXZCYXIoKQoKZ2VuZXJhdGVzIGEgcGFnZSBuYXYgYmFyCgogICAgbXkgJVBhZ2VOYXZCYXIgPSAkTGF5b3V0T2JqZWN0LT5QYWdlTmF2QmFyKAogICAgICAgIExpbWl0ICAgICAgID0+IDEwMCwgICAgICAgICAjIG1hcmtzIHJlc3VsdCBvZiBUb3RhbEhpdHMgcmVkIGlmIExpbWl0IGlzIGdlcmF0ZXIgdGhlbiBBbGxIaXRzCiAgICAgICAgV2luZG93U2l6ZSAgPT4gMTUsICAgICAgICAgICMgbWF4IHNob3duIHBhZ2VzIHRvIGNsaWNrCiAgICAgICAgU3RhcnRIaXQgICAgPT4gMSwgICAgICAgICAgICMgc3RhcnQgdG8gc2hvdyBpdGVtcwogICAgICAgIFBhZ2VTaG93biAgID0+IDE1LCAgICAgICAgICAjIG51bWJlciBvZiBzaG93biBpdGVtcyBhIHBhZ2UKICAgICAgICBBbGxIaXRzICAgICA9PiA1NiwgICAgICAgICAgIyBudW1iZXIgb2YgdG90YWwgaGl0cwogICAgICAgIEFjdGlvbiAgICAgID0+ICdBZ2VudFhYWCcsICAjIGUuIGcuICdBY3Rpb249JyAuICRTZWxmLT57TGF5b3V0T2JqZWN0fS0+e0FjdGlvbn0KICAgICAgICBMaW5rICAgICAgICA9PiAkTGluaywgICAgICAgIyBlLiBnLiAnU3ViYWN0aW9uPVZpZXc7JwogICAgICAgIEFKQVhSZXBsYWNlID0+ICdJREVsZW1lbnQnLCAjIElERWxlbWVudCB3aGljaCBzaG91bGQgYmUgcmVwbGFjZWQKICAgICAgICBJRFByZWZpeCAgICA9PiAnVGlja2V0cycsICAgIyBQcmVmaXggZm9yIHRoZSBpZCBwYXJhbWV0ZXIKICAgICk7CgogICAgcmV0dXJuIHZhbHVlcyBvZiBoYXNoCgogICAgICAgIFRvdGFsSGl0cyAgIyB0b3RhbCBoaXRzCiAgICAgICAgUmVzdWx0ICAgICAjIHNob3duIGl0ZW1zIGUuIGcuICIxLTUiIG9yICIxNi0zMCIKICAgICAgICBTaXRlTmF2QmFyICMgaHRtbCBmb3IgcGFnZSBuYXYgYmFyIGUuIGcuICIxIDIgMyA0IgoKICAgICAgICBSZXN1bHRMb25nICAgICAjIHNob3duIGl0ZW1zIGUuIGcuICIxLTUgb2YgMzIiIG9yICIxNi0zMCBvZiA2NCIKICAgICAgICBTaXRlTmF2QmFyTG9uZyAjIGh0bWwgZm9yIHBhZ2UgbmF2IGJhciBlLiBnLiAiUGFnZTogMSAyIDMgNCIKCj1jdXQKCnN1YiBQYWdlTmF2QmFyIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJExpbWl0ID0gJFBhcmFte0xpbWl0fSB8fCAwOwogICAgJFBhcmFte0FsbEhpdHN9ICA9IDAgaWYgKCAhJFBhcmFte0FsbEhpdHN9ICk7CiAgICAkUGFyYW17U3RhcnRIaXR9ID0gMCBpZiAoICEkUGFyYW17QWxsSGl0c30gKTsKICAgIG15ICRQYWdlcyA9IGludCggKCAkUGFyYW17QWxsSGl0c30gLyAkUGFyYW17UGFnZVNob3dufSApICsgMC45OTk5OSApOwogICAgbXkgJFBhZ2UgID0gaW50KCAoICRQYXJhbXtTdGFydEhpdH0gLyAkUGFyYW17UGFnZVNob3dufSApICsgMC45OTk5OSApOwogICAgbXkgJFdpbmRvd1NpemUgPSAkUGFyYW17V2luZG93U2l6ZX0gfHwgNTsKICAgIG15ICRJRFByZWZpeCAgID0gJFBhcmFte0lEUHJlZml4fSAgIHx8ICdHZW5lcmljJzsKCiAgICAjIGJ1aWxkIFJlc3VsdHMgKDEtNSBvciAxNi0zMCkKICAgIGlmICggJFBhcmFte0FsbEhpdHN9ID49ICggJFBhcmFte1N0YXJ0SGl0fSArICRQYXJhbXtQYWdlU2hvd259ICkgKSB7CiAgICAgICAgJFBhcmFte1Jlc3VsdHN9ID0gJFBhcmFte1N0YXJ0SGl0fSAuICItIiAuICggJFBhcmFte1N0YXJ0SGl0fSArICRQYXJhbXtQYWdlU2hvd259IC0gMSApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJFBhcmFte1Jlc3VsdHN9ID0gIiRQYXJhbXtTdGFydEhpdH0tJFBhcmFte0FsbEhpdHN9IjsKICAgIH0KCiAgICAjIGNoZWNrIHRvdGFsIGhpdHMKICAgIGlmICggJExpbWl0ID09ICRQYXJhbXtBbGxIaXRzfSApIHsKICAgICAgICAkUGFyYW17VG90YWxIaXRzfSA9ICI8c3BhbiBjbGFzcz1cIlBhZ2luYXRpb25MaW1pdFwiPiRQYXJhbXtBbGxIaXRzfTwvc3Bhbj4iOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJFBhcmFte1RvdGFsSGl0c30gPSAkUGFyYW17QWxsSGl0c307CiAgICB9CgogICAgIyBidWlsZCBwYWdlIG5hdiBiYXIKICAgIG15ICRXaW5kb3dTdGFydCA9IHNwcmludGYoICIlLjBmIiwgKCAkUGFyYW17U3RhcnRIaXR9IC8gJFBhcmFte1BhZ2VTaG93bn0gKSApOwogICAgJFdpbmRvd1N0YXJ0ID0gaW50KCAoICRXaW5kb3dTdGFydCAvICRXaW5kb3dTaXplICkgKSArIDE7CiAgICAkV2luZG93U3RhcnQgPSAoICRXaW5kb3dTdGFydCAqICRXaW5kb3dTaXplICkgLSAoJFdpbmRvd1NpemUpOwogICAgbXkgJEFjdGlvbiA9ICRQYXJhbXtBY3Rpb259IHx8ICcnOwogICAgbXkgJExpbmsgICA9ICRQYXJhbXtMaW5rfSAgIHx8ICcnOwogICAgbXkgJEJhc2VsaW5rID0gIiRTZWxmLT57QmFzZWxpbmt9JEFjdGlvbjskTGluayI7CiAgICBteSAkaSAgICAgICAgPSAwOwogICAgd2hpbGUgKCAkaSA8PSAoICRQYWdlcyAtIDEgKSApIHsKICAgICAgICAkaSsrOwoKICAgICAgICAjIHNob3cgbm9ybWFsIHBhZ2UgMSwyLDMsLi4uCiAgICAgICAgaWYgKCAkaSA8PSAoICRXaW5kb3dTdGFydCArICRXaW5kb3dTaXplICkgJiYgJGkgPiAkV2luZG93U3RhcnQgKSB7CiAgICAgICAgICAgIG15ICRCYXNlbGlua0FsbCA9ICRCYXNlbGluawogICAgICAgICAgICAgICAgLiAiU3RhcnRXaW5kb3c9JFdpbmRvd1N0YXJ0O1N0YXJ0SGl0PSIKICAgICAgICAgICAgICAgIC4gKCAoICggJGkgLSAxICkgKiAkUGFyYW17UGFnZVNob3dufSApICsgMSApOwogICAgICAgICAgICBteSAkU2VsZWN0ZWRQYWdlID0gIiI7CiAgICAgICAgICAgIG15ICRQYWdlTnVtYmVyICAgPSAkaTsKCiAgICAgICAgICAgIGlmICggJFBhZ2UgPT0gJGkgKSB7CiAgICAgICAgICAgICAgICAkU2VsZWN0ZWRQYWdlID0gIiBjbGFzcz1cIlNlbGVjdGVkXCIiOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoICRQYXJhbXtBSkFYUmVwbGFjZX0gKSB7CiAgICAgICAgICAgICAgICAkU2VsZi0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnUGFnZUFqYXgnLAogICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBCYXNlbGlua0FsbCAgPT4gJEJhc2VsaW5rQWxsLAogICAgICAgICAgICAgICAgICAgICAgICBBamF4UmVwbGFjZSAgPT4gJFBhcmFte0FKQVhSZXBsYWNlfSwKICAgICAgICAgICAgICAgICAgICAgICAgUGFnZU51bWJlciAgID0+ICRQYWdlTnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICBJRFByZWZpeCAgICAgPT4gJElEUHJlZml4LAogICAgICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZFBhZ2UgPT4gJFNlbGVjdGVkUGFnZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1BhZ2UnLAogICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBCYXNlbGlua0FsbCAgPT4gJEJhc2VsaW5rQWxsLAogICAgICAgICAgICAgICAgICAgICAgICBQYWdlTnVtYmVyICAgPT4gJFBhZ2VOdW1iZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIElEUHJlZml4ICAgICA9PiAkSURQcmVmaXgsCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbGVjdGVkUGFnZSA9PiAkU2VsZWN0ZWRQYWdlCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgb3ZlciB3aW5kb3cgIj4+IiBhbmQgIj58IgogICAgICAgIGVsc2lmICggJGkgPiAoICRXaW5kb3dTdGFydCArICRXaW5kb3dTaXplICkgKSB7CiAgICAgICAgICAgIG15ICRTdGFydFdpbmRvdyAgICAgPSAkV2luZG93U3RhcnQgKyAkV2luZG93U2l6ZSArIDE7CiAgICAgICAgICAgIG15ICRMYXN0U3RhcnRXaW5kb3cgPSBpbnQoICRQYWdlcyAvICRXaW5kb3dTaXplICk7CiAgICAgICAgICAgIG15ICRCYXNlbGlua0FsbEJhY2sgPSAkQmFzZWxpbmsgLiAiU3RhcnRIaXQ9IiAuICggKCAkaSAtIDEgKSAqICRQYXJhbXtQYWdlU2hvd259ICsgMSApOwogICAgICAgICAgICBteSAkQmFzZWxpbmtBbGxOZXh0ID0gJEJhc2VsaW5rIC4gIlN0YXJ0SGl0PSIgLiAoICggJFBhcmFte1BhZ2VTaG93bn0gKiAoICRQYWdlcyAtIDEgKSApICsgMSApOwoKICAgICAgICAgICAgaWYgKCAkUGFyYW17QUpBWFJlcGxhY2V9ICkgewogICAgICAgICAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1BhZ2VGb3J3YXJkQWpheCcsCiAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhc2VsaW5rQWxsQmFjayA9PiAkQmFzZWxpbmtBbGxCYWNrLAogICAgICAgICAgICAgICAgICAgICAgICBCYXNlbGlua0FsbE5leHQgPT4gJEJhc2VsaW5rQWxsTmV4dCwKICAgICAgICAgICAgICAgICAgICAgICAgQWpheFJlcGxhY2UgICAgID0+ICRQYXJhbXtBSkFYUmVwbGFjZX0sCiAgICAgICAgICAgICAgICAgICAgICAgIElEUHJlZml4ICAgICAgICA9PiAkSURQcmVmaXgsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkU2VsZi0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnUGFnZUZvcndhcmQnLAogICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBCYXNlbGlua0FsbEJhY2sgPT4gJEJhc2VsaW5rQWxsQmFjaywKICAgICAgICAgICAgICAgICAgICAgICAgQmFzZWxpbmtBbGxOZXh0ID0+ICRCYXNlbGlua0FsbE5leHQsCiAgICAgICAgICAgICAgICAgICAgICAgIElEUHJlZml4ICAgICAgICA9PiAkSURQcmVmaXgsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRpID0gOTk5OTk5OTk7CiAgICAgICAgfQoKICAgICAgICAjIG92ZXIgd2luZG93ICI8PCIgYW5kICJ8PCIKICAgICAgICBlbHNpZiAoICRpIDwgJFdpbmRvd1N0YXJ0ICYmICggJGkgLSAxICkgPCAkUGFnZXMgKSB7CiAgICAgICAgICAgIG15ICRTdGFydFdpbmRvdyAgICAgPSAkV2luZG93U3RhcnQgLSAkV2luZG93U2l6ZSAtIDE7CiAgICAgICAgICAgIG15ICRCYXNlbGlua0FsbEJhY2sgPSAkQmFzZWxpbmsgLiAnU3RhcnRIaXQ9MTtTdGFydFdpbmRvdz0xJzsKICAgICAgICAgICAgbXkgJEJhc2VsaW5rQWxsTmV4dCA9ICRCYXNlbGluayAuICdTdGFydEhpdD0nIC4gKCAoICRXaW5kb3dTdGFydCAtIDEgKSAqICggJFBhcmFte1BhZ2VTaG93bn0gKSArIDEgKTsKCiAgICAgICAgICAgIGlmICggJFBhcmFte0FKQVhSZXBsYWNlfSApIHsKICAgICAgICAgICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdQYWdlQmFja0FqYXgnLAogICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBCYXNlbGlua0FsbEJhY2sgPT4gJEJhc2VsaW5rQWxsQmFjaywKICAgICAgICAgICAgICAgICAgICAgICAgQmFzZWxpbmtBbGxOZXh0ID0+ICRCYXNlbGlua0FsbE5leHQsCiAgICAgICAgICAgICAgICAgICAgICAgIEFqYXhSZXBsYWNlICAgICA9PiAkUGFyYW17QUpBWFJlcGxhY2V9LAogICAgICAgICAgICAgICAgICAgICAgICBJRFByZWZpeCAgICAgICAgPT4gJElEUHJlZml4LAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1BhZ2VCYWNrJywKICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgQmFzZWxpbmtBbGxCYWNrID0+ICRCYXNlbGlua0FsbEJhY2ssCiAgICAgICAgICAgICAgICAgICAgICAgIEJhc2VsaW5rQWxsTmV4dCA9PiAkQmFzZWxpbmtBbGxOZXh0LAogICAgICAgICAgICAgICAgICAgICAgICBJRFByZWZpeCAgICAgICAgPT4gJElEUHJlZml4LAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkaSA9ICRXaW5kb3dTdGFydCAtIDE7CiAgICAgICAgfQogICAgfQoKICAgICRQYXJhbXtTZWFyY2hOYXZCYXJ9ID0gJFNlbGYtPk91dHB1dCgKICAgICAgICBUZW1wbGF0ZUZpbGUgICA9PiAnUGFnaW5hdGlvbicsCiAgICAgICAgS2VlcFNjcmlwdFRhZ3MgPT4gJFBhcmFte0tlZXBTY3JpcHRUYWdzfSwKICAgICk7CgogICAgIyBvbmx5IHNob3cgdG90YWwgYW1vdW50IG9mIHBhZ2VzIGlmIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUKICAgIGlmICggJFBhZ2VzID4gMSApIHsKICAgICAgICAkUGFyYW17TmF2QmFyTG9uZ30gPSAiLSAiIC4gJFNlbGYtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgiUGFnZSIpIC4gIjogJFBhcmFte1NlYXJjaE5hdkJhcn0iOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJFBhcmFte1NlYXJjaE5hdkJhcn0gPSAnJzsKICAgIH0KCiAgICAjIHJldHVybiBkYXRhCiAgICByZXR1cm4gKAogICAgICAgIFRvdGFsSGl0cyAgPT4gJFBhcmFte1RvdGFsSGl0c30sCiAgICAgICAgUmVzdWx0ICAgICA9PiAkUGFyYW17UmVzdWx0c30sCiAgICAgICAgUmVzdWx0TG9uZyA9PiAiJFBhcmFte1Jlc3VsdHN9ICIKICAgICAgICAgICAgLiAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCJvZiIpCiAgICAgICAgICAgIC4gIiAkUGFyYW17VG90YWxIaXRzfSIsCiAgICAgICAgU2l0ZU5hdkJhciAgICAgPT4gJFBhcmFte1NlYXJjaE5hdkJhcn0sCiAgICAgICAgU2l0ZU5hdkJhckxvbmcgPT4gJFBhcmFte05hdkJhckxvbmd9LAogICAgICAgIExpbmsgICAgICAgICAgID0+ICRQYXJhbXtMaW5rfSwKICAgICk7Cn0KCnN1YiBOYXZpZ2F0aW9uQmFyIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgaWYgKCAhJFBhcmFte1R5cGV9ICkgewogICAgICAgICRQYXJhbXtUeXBlfSA9ICRTZWxmLT57TW9kdWxlUmVnfS0+e05hdkJhck5hbWV9IHx8ICdUaWNrZXQnOwogICAgfQoKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgICMgY3JlYXRlIG1lbnUgaXRlbXMKICAgIG15ICVOYXZCYXI7CiAgICBteSAkRnJvbnRlbmRNb2R1bGVDb25maWcgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0Zyb250ZW5kOjpNb2R1bGUnKTsKCiAgICBNT0RVTEU6CiAgICBmb3IgbXkgJE1vZHVsZSAoIHNvcnQga2V5cyAleyRGcm9udGVuZE1vZHVsZUNvbmZpZ30gKSB7CiAgICAgICAgbXkgJUhhc2ggPSAleyAkRnJvbnRlbmRNb2R1bGVDb25maWctPnskTW9kdWxlfSB9OwogICAgICAgIG5leHQgTU9EVUxFIGlmICEkSGFzaHtOYXZCYXJ9OwogICAgICAgIG5leHQgTU9EVUxFIGlmIHJlZiAkSGFzaHtOYXZCYXJ9IG5lICdBUlJBWSc7CgogICAgICAgIG15IEBJdGVtcyA9IEB7ICRIYXNoe05hdkJhcn0gfTsKCiAgICAgICAgSVRFTToKICAgICAgICBmb3IgbXkgJEl0ZW0gKEBJdGVtcykgewogICAgICAgICAgICBuZXh0IElURU0gaWYgISRJdGVtLT57TmF2QmFyfTsKICAgICAgICAgICAgJEl0ZW0tPntDU1N9ID0gJyc7CgogICAgICAgICAgICAjIGhpZ2hsaWdodCBhY3RpdmUgYXJlYSBsaW5rCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICggJEl0ZW0tPntUeXBlfSAmJiAkSXRlbS0+e1R5cGV9IGVxICdNZW51JyApCiAgICAgICAgICAgICAgICAmJiAoICRJdGVtLT57TmF2QmFyfSAmJiAkSXRlbS0+e05hdkJhcn0gZXEgJFBhcmFte1R5cGV9ICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJEl0ZW0tPntDU1N9IC49ICcgU2VsZWN0ZWQnOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGdldCBwZXJtaXNzaW9ucyBmcm9tIG1vZHVsZSBpZiBubyBwZXJtaXNzaW9ucyBhcmUgZGVmaW5lZCBmb3IgdGhlIGljb24KICAgICAgICAgICAgaWYgKCAhJEl0ZW0tPntHcm91cFJvfSAmJiAhJEl0ZW0tPntHcm91cH0gKSB7CiAgICAgICAgICAgICAgICBpZiAoICRIYXNoe0dyb3VwUm99ICkgewogICAgICAgICAgICAgICAgICAgICRJdGVtLT57R3JvdXBSb30gPSAkSGFzaHtHcm91cFJvfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICggJEhhc2h7R3JvdXB9ICkgewogICAgICAgICAgICAgICAgICAgICRJdGVtLT57R3JvdXB9ID0gJEhhc2h7R3JvdXB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGNoZWNrIHNob3duIHBlcm1pc3Npb24KICAgICAgICAgICAgbXkgJFNob3duID0gMDsKICAgICAgICAgICAgUEVSTUlTU0lPTjoKICAgICAgICAgICAgZm9yIG15ICRQZXJtaXNzaW9uIChxdyhHcm91cFJvIEdyb3VwKSkgewoKICAgICAgICAgICAgICAgICMgYXJyYXkgYWNjZXNzIHJlc3RyaWN0aW9uCiAgICAgICAgICAgICAgICBpZiAoICRJdGVtLT57JFBlcm1pc3Npb259ICYmIHJlZiAkSXRlbS0+eyRQZXJtaXNzaW9ufSBlcSAnQVJSQVknICkgewogICAgICAgICAgICAgICAgICAgIGZvciAoIEB7ICRJdGVtLT57JFBlcm1pc3Npb259IH0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG15ICRLZXkgPSAnVXNlcklzJyAuICRQZXJtaXNzaW9uIC4gJ1snIC4gJF8gLiAnXSc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJFNlbGYtPnskS2V5fSAmJiAkU2VsZi0+eyRLZXl9IGVxICdZZXMnICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFNob3duID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QgUEVSTUlTU0lPTjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIHNjYWxhciBhY2Nlc3MgcmVzdHJpY3Rpb24KICAgICAgICAgICAgICAgIGVsc2lmICggJEl0ZW0tPnskUGVybWlzc2lvbn0gKSB7CiAgICAgICAgICAgICAgICAgICAgbXkgJEtleSA9ICdVc2VySXMnIC4gJFBlcm1pc3Npb24gLiAnWycgLiAkSXRlbS0+eyRQZXJtaXNzaW9ufSAuICddJzsKICAgICAgICAgICAgICAgICAgICBpZiAoICRTZWxmLT57JEtleX0gJiYgJFNlbGYtPnskS2V5fSBlcSAnWWVzJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFNob3duID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdCBQRVJNSVNTSU9OOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIG5vIGFjY2VzcyByZXN0cmljdGlvbgogICAgICAgICAgICAgICAgZWxzaWYgKCAhJEl0ZW0tPntHcm91cFJvfSAmJiAhJEl0ZW0tPntHcm91cH0gKSB7CiAgICAgICAgICAgICAgICAgICAgJFNob3duID0gMTsKICAgICAgICAgICAgICAgICAgICBsYXN0IFBFUk1JU1NJT047CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbmV4dCBJVEVNIGlmICEkU2hvd247CgogICAgICAgICAgICAjIHNldCBwcmlvIG9mIGl0ZW0KICAgICAgICAgICAgbXkgJEtleSA9ICggJEl0ZW0tPntCbG9ja30gfHwgJycgKSAuIHNwcmludGYoICIlMDdkIiwgJEl0ZW0tPntQcmlvfSApOwogICAgICAgICAgICBDT1VOVDoKICAgICAgICAgICAgZm9yICggMSAuLiA1MSApIHsKICAgICAgICAgICAgICAgIGxhc3QgQ09VTlQgaWYgISROYXZCYXJ7JEtleX07CgogICAgICAgICAgICAgICAgJEl0ZW0tPntQcmlvfSsrOwogICAgICAgICAgICAgICAgJEtleSA9ICggJEl0ZW0tPntCbG9ja30gfHwgJycgKSAuIHNwcmludGYoICIlMDdkIiwgJEl0ZW0tPntQcmlvfSApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHNob3cgYXMgbWFpbiBtZW51CiAgICAgICAgICAgIGlmICggJEl0ZW0tPntUeXBlfSBlcSAnTWVudScgKSB7CiAgICAgICAgICAgICAgICAkTmF2QmFyeyRLZXl9ID0gJEl0ZW07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgc2hvdyBhcyBzdWIgb2YgbWFpbiBtZW51CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJE5hdkJhcntTdWJ9LT57ICRJdGVtLT57TmF2QmFyfSB9LT57JEtleX0gPSAkSXRlbTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBteSAkTWFpbk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyk7CgogICAgIyBydW4gbWVudSBpdGVtIG1vZHVsZXMKICAgIGlmICggcmVmICRDb25maWdPYmplY3QtPkdldCgnRnJvbnRlbmQ6Ok5hdkJhck1vZHVsZScpIGVxICdIQVNIJyApIHsKICAgICAgICBteSAlSm9icyA9ICV7ICRDb25maWdPYmplY3QtPkdldCgnRnJvbnRlbmQ6Ok5hdkJhck1vZHVsZScpIH07CgogICAgICAgIE1FTlVNT0RVTEU6CiAgICAgICAgZm9yIG15ICRKb2IgKCBzb3J0IGtleXMgJUpvYnMgKSB7CgogICAgICAgICAgICAjIGxvYWQgbW9kdWxlCiAgICAgICAgICAgIG5leHQgTUVOVU1PRFVMRSBpZiAhJE1haW5PYmplY3QtPlJlcXVpcmUoICRKb2JzeyRKb2J9LT57TW9kdWxlfSApOwogICAgICAgICAgICBteSAkT2JqZWN0ID0gJEpvYnN7JEpvYn0tPntNb2R1bGV9LT5uZXcoCiAgICAgICAgICAgICAgICAleyRTZWxmfSwKICAgICAgICAgICAgICAgIExheW91dE9iamVjdCA9PiAkU2VsZiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgbmV4dCBNRU5VTU9EVUxFIGlmICEkT2JqZWN0OwoKICAgICAgICAgICAgIyBydW4gbW9kdWxlCiAgICAgICAgICAgICVOYXZCYXIgPSAoCiAgICAgICAgICAgICAgICAlTmF2QmFyLAogICAgICAgICAgICAgICAgJE9iamVjdC0+UnVuKAogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICAgICBDb25maWcgPT4gJEpvYnN7JEpvYn0sCiAgICAgICAgICAgICAgICAgICAgTmF2QmFyID0+IFwlTmF2QmFyIHx8IHt9CiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIHNob3cgbmF2IGJhcgogICAgSVRFTToKICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICVOYXZCYXIgKSB7CiAgICAgICAgbmV4dCBJVEVNIGlmICRLZXkgZXEgJ1N1Yic7CiAgICAgICAgbmV4dCBJVEVNIGlmICEleyAkTmF2QmFyeyRLZXl9IH07CiAgICAgICAgbXkgJEl0ZW0gPSAkTmF2QmFyeyRLZXl9OwogICAgICAgICRJdGVtLT57TmFtZUZvcklEfSA9ICRJdGVtLT57TmFtZX07CiAgICAgICAgJEl0ZW0tPntOYW1lRm9ySUR9ID1+IHMvWyAmO10vL2lnOwogICAgICAgIG15ICRTdWIgPSAkTmF2QmFye1N1Yn0tPnsgJEl0ZW0tPntOYXZCYXJ9IH07CgogICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnSXRlbUFyZWEnLCAgICAjJE5hdkJhcnskX30tPntCbG9ja30gfHwgJ0l0ZW0nLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICUkSXRlbSwKICAgICAgICAgICAgICAgIEFjY2Vzc0tleVJlZmVyZW5jZSA9PiAkSXRlbS0+e0FjY2Vzc0tleX0gPyAiICgkSXRlbS0+e0FjY2Vzc0tleX0pIiA6ICcnLAogICAgICAgICAgICB9LAogICAgICAgICk7CgogICAgICAgICMgc2hvdyBzdWIgbWVudQogICAgICAgIG5leHQgSVRFTSBpZiAhJFN1YjsKICAgICAgICAkU2VsZi0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0l0ZW1BcmVhU3ViJywKICAgICAgICAgICAgRGF0YSA9PiAkSXRlbSwKICAgICAgICApOwogICAgICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICV7JFN1Yn0gKSB7CiAgICAgICAgICAgIG15ICRJdGVtU3ViID0gJFN1Yi0+eyRLZXl9OwogICAgICAgICAgICAkSXRlbVN1Yi0+e05hbWVGb3JJRH0gPSAkSXRlbVN1Yi0+e05hbWV9OwogICAgICAgICAgICAkSXRlbVN1Yi0+e05hbWVGb3JJRH0gPX4gcy9bICY7XS8vaWc7CiAgICAgICAgICAgICRJdGVtU3ViLT57TmFtZVRvcH0gPSAkSXRlbS0+e05hbWVGb3JJRH07CiAgICAgICAgICAgICRJdGVtU3ViLT57RGVzY3JpcHRpb259CiAgICAgICAgICAgICAgICB8fD0gJEl0ZW1TdWItPntOYW1lfTsgICAgIyB1c2UgJ25hbWUnIGFzIGZhbGxiYWNrLCB0aGlzIGlzIHNob3duIGFzIHRoZSBsaW5rIHRpdGxlCiAgICAgICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0l0ZW1BcmVhU3ViSXRlbScsICAgICMkSXRlbS0+e0Jsb2NrfSB8fCAnSXRlbScsCiAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAlJEl0ZW1TdWIsCiAgICAgICAgICAgICAgICAgICAgQWNjZXNzS2V5UmVmZXJlbmNlID0+ICRJdGVtU3ViLT57QWNjZXNzS2V5fSA/ICIgKCRJdGVtU3ViLT57QWNjZXNzS2V5fSkiIDogJycsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCB1c2VyIHByZWZlcmVuY2VzIGZvciBjdXN0b20gbmF2IGJhciBpdGVtIG9yZGVyaW5nCiAgICBteSAlVXNlclByZWZlcmVuY2VzID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlVzZXInKS0+R2V0UHJlZmVyZW5jZXMoCiAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICk7CgogICAgbXkgJE5hdmJhck9yZGVySXRlbXMgPSAkVXNlclByZWZlcmVuY2VzeydVc2VyTmF2QmFySXRlbXNPcmRlcid9IHx8ICcnOwogICAgJFNlbGYtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJ05hdmJhck9yZGVySXRlbXMnLAogICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAnTmF2YmFyT3JkZXJJdGVtcycgPT4gJE5hdmJhck9yZGVySXRlbXMsCiAgICAgICAgfSwKICAgICk7CgogICAgIyBzaG93IHNlYXJjaCBpY29uIGlmIGFueSBzZWFyY2ggcm91dGVyIGlzIGNvbmZpZ3VyZWQKICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoICRDb25maWdPYmplY3QtPkdldCgnRnJvbnRlbmQ6OlNlYXJjaCcpICkgKSB7CiAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdTZWFyY2hJY29uJywKICAgICAgICApOwogICAgfQoKICAgICMgY3JlYXRlICYgcmV0dXJuIG91dHB1dAogICAgbXkgJE91dHB1dCA9ICRTZWxmLT5PdXRwdXQoCiAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdBZ2VudE5hdmlnYXRpb25CYXInLAogICAgICAgIERhdGEgICAgICAgICA9PiBcJVBhcmFtCiAgICApOwoKICAgICMgcnVuIG5hdiBiYXIgb3V0cHV0IG1vZHVsZXMKICAgIG15ICROYXZCYXJPdXRwdXRNb2R1bGVDb25maWcgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0Zyb250ZW5kOjpOYXZCYXJPdXRwdXRNb2R1bGUnKTsKICAgIGlmICggcmVmICROYXZCYXJPdXRwdXRNb2R1bGVDb25maWcgZXEgJ0hBU0gnICkgewogICAgICAgIG15ICVKb2JzID0gJXskTmF2QmFyT3V0cHV0TW9kdWxlQ29uZmlnfTsKCiAgICAgICAgT1VUUFVUTU9EVUxFOgogICAgICAgIGZvciBteSAkSm9iICggc29ydCBrZXlzICVKb2JzICkgewoKICAgICAgICAgICAgIyBsb2FkIG1vZHVsZQogICAgICAgICAgICBuZXh0IE9VVFBVVE1PRFVMRSBpZiAhJE1haW5PYmplY3QtPlJlcXVpcmUoICRKb2JzeyRKb2J9LT57TW9kdWxlfSApOwogICAgICAgICAgICBteSAkT2JqZWN0ID0gJEpvYnN7JEpvYn0tPntNb2R1bGV9LT5uZXcoCiAgICAgICAgICAgICAgICAleyRTZWxmfSwKICAgICAgICAgICAgICAgIExheW91dE9iamVjdCA9PiAkU2VsZiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgbmV4dCBPVVRQVVRNT0RVTEUgaWYgISRPYmplY3Q7CgogICAgICAgICAgICAjIHJ1biBtb2R1bGUKICAgICAgICAgICAgJE91dHB1dCAuPSAkT2JqZWN0LT5SdW4oICVQYXJhbSwgQ29uZmlnID0+ICRKb2JzeyRKb2J9ICk7CiAgICAgICAgfQogICAgfQoKICAgICMgcnVuIG5vdGlmaWNhdGlvbiBtb2R1bGVzCiAgICBteSAkRnJvbnRlbmROb3RpZnlNb2R1bGVDb25maWcgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0Zyb250ZW5kOjpOb3RpZnlNb2R1bGUnKTsKICAgIGlmICggcmVmICRGcm9udGVuZE5vdGlmeU1vZHVsZUNvbmZpZyBlcSAnSEFTSCcgKSB7CiAgICAgICAgbXkgJUpvYnMgPSAleyRGcm9udGVuZE5vdGlmeU1vZHVsZUNvbmZpZ307CgogICAgICAgIE5PVElGSUNBVElPTk1PRFVMRToKICAgICAgICBmb3IgbXkgJEpvYiAoIHNvcnQga2V5cyAlSm9icyApIHsKCiAgICAgICAgICAgICMgbG9hZCBtb2R1bGUKICAgICAgICAgICAgbmV4dCBOT1RJRklDQVRJT05NT0RVTEUgaWYgISRNYWluT2JqZWN0LT5SZXF1aXJlKCAkSm9ic3skSm9ifS0+e01vZHVsZX0gKTsKICAgICAgICAgICAgbXkgJE9iamVjdCA9ICRKb2JzeyRKb2J9LT57TW9kdWxlfS0+bmV3KAogICAgICAgICAgICAgICAgJXskU2VsZn0sCiAgICAgICAgICAgICAgICBMYXlvdXRPYmplY3QgPT4gJFNlbGYsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIG5leHQgTk9USUZJQ0FUSU9OTU9EVUxFIGlmICEkT2JqZWN0OwoKICAgICAgICAgICAgIyBydW4gbW9kdWxlCiAgICAgICAgICAgICRPdXRwdXQgLj0gJE9iamVjdC0+UnVuKCAlUGFyYW0sIENvbmZpZyA9PiAkSm9ic3skSm9ifSApOwogICAgICAgIH0KICAgIH0KCiAgICAjIHJ1biBuYXYgYmFyIG1vZHVsZXMKICAgIGlmICggJFNlbGYtPntNb2R1bGVSZWd9LT57TmF2QmFyTW9kdWxlfSApIHsKCiAgICAgICAgIyBydW4gbmF2YmFyIG1vZHVsZXMKICAgICAgICBteSAlSm9icyA9ICV7ICRTZWxmLT57TW9kdWxlUmVnfS0+e05hdkJhck1vZHVsZX0gfTsKCiAgICAgICAgIyBsb2FkIG1vZHVsZQogICAgICAgIGlmICggISRNYWluT2JqZWN0LT5SZXF1aXJlKCAkSm9ic3tNb2R1bGV9ICkgKSB7CiAgICAgICAgICAgIHJldHVybiAkT3V0cHV0OwogICAgICAgIH0KCiAgICAgICAgbXkgJE9iamVjdCA9ICRKb2Jze01vZHVsZX0tPm5ldygKICAgICAgICAgICAgJXskU2VsZn0sCiAgICAgICAgICAgIExheW91dE9iamVjdCA9PiAkU2VsZiwKICAgICAgICApOwoKICAgICAgICBpZiAoICEkT2JqZWN0ICkgewogICAgICAgICAgICByZXR1cm4gJE91dHB1dDsKICAgICAgICB9CgogICAgICAgICMgcnVuIG1vZHVsZQogICAgICAgICRPdXRwdXQgLj0gJE9iamVjdC0+UnVuKCAlUGFyYW0sIENvbmZpZyA9PiBcJUpvYnMgKTsKICAgIH0KICAgIHJldHVybiAkT3V0cHV0Owp9CgpzdWIgVHJhbnNmb3JtRGF0ZVNlbGVjdGlvbiB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IGtleSBwcmVmaXgKICAgIG15ICRQcmVmaXggPSAkUGFyYW17UHJlZml4fSB8fCAnJzsKCiAgICAjIHRpbWUgem9uZSB0cmFuc2xhdGlvbiBpZiBuZWVkZWQKICAgIGlmICggJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdUaW1lWm9uZVVzZXInKSAmJiAkU2VsZi0+e1VzZXJUaW1lWm9uZX0gKSB7CiAgICAgICAgbXkgJFRpbWVTdGFtcCA9ICRTZWxmLT57VGltZU9iamVjdH0tPlRpbWVTdGFtcDJTeXN0ZW1UaW1lKAogICAgICAgICAgICBTdHJpbmcgPT4gJFBhcmFteyAkUHJlZml4IC4gJ1llYXInIH0gLiAnLScKICAgICAgICAgICAgICAgIC4gJFBhcmFteyAkUHJlZml4IC4gJ01vbnRoJyB9IC4gJy0nCiAgICAgICAgICAgICAgICAuICRQYXJhbXsgJFByZWZpeCAuICdEYXknIH0gLiAnICcKICAgICAgICAgICAgICAgIC4gKCAkUGFyYW17ICRQcmVmaXggLiAnSG91cicgfSAgIHx8IDAgKSAuICc6JwogICAgICAgICAgICAgICAgLiAoICRQYXJhbXsgJFByZWZpeCAuICdNaW51dGUnIH0gfHwgMCApCiAgICAgICAgICAgICAgICAuICc6MDAnLAogICAgICAgICk7CiAgICAgICAgJFRpbWVTdGFtcCA9ICRUaW1lU3RhbXAgLSAoICRTZWxmLT57VXNlclRpbWVab25lfSAqIDM2MDAgKTsKICAgICAgICAoCiAgICAgICAgICAgICRQYXJhbXsgJFByZWZpeCAuICdTZWNvbmQnIH0sCiAgICAgICAgICAgICRQYXJhbXsgJFByZWZpeCAuICdNaW51dGUnIH0sCiAgICAgICAgICAgICRQYXJhbXsgJFByZWZpeCAuICdIb3VyJyB9LAogICAgICAgICAgICAkUGFyYW17ICRQcmVmaXggLiAnRGF5JyB9LAogICAgICAgICAgICAkUGFyYW17ICRQcmVmaXggLiAnTW9udGgnIH0sCiAgICAgICAgICAgICRQYXJhbXsgJFByZWZpeCAuICdZZWFyJyB9CiAgICAgICAgKSA9ICRTZWxmLT57VXNlclRpbWVPYmplY3R9LT5TeXN0ZW1UaW1lMkRhdGUoIFN5c3RlbVRpbWUgPT4gJFRpbWVTdGFtcCApOwogICAgfQoKICAgICMgcmVzZXQgcHJlZml4CiAgICAkUGFyYW17UHJlZml4fSA9ICcnOwoKICAgIHJldHVybiAlUGFyYW07Cn0KCj1pdGVtIEJ1aWxkRGF0ZVNlbGVjdGlvbigpCgpidWlsZCB0aGUgSFRNTCBjb2RlIHRvIHJlcHJlc2VudCBhIGRhdGUgc2VsZWN0aW9uIGJhc2VkIG9uIHRoZSBnaXZlbiBkYXRhLgpEZXBlbmRpbmcgb24gdGhlIFN5c0NvbmZpZyBzZXR0aW5ncyB0aGUgY29udHJvbHMgdG8gc2V0IHRoZSBkYXRlIGNvdWxkIGJlIG11bHRpcGxlIHNlbGVjdCBvciBpbnB1dCBmaWVsZHMKCiAgICBteSAkSFRNTCA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkRGF0ZVNlbGVjdGlvbigKICAgICAgICBQcmVmaXggICAgICAgICAgID0+ICdzb21lIHByZWZpeCcsICAgICAgIyBvcHRpb25hbCwgKG5lZWRlZCB0byBzcGVjaWZ5IG90aGVyIHBhcmFtZXRlcnMpCiAgICAgICAgPFByZWZpeD5ZZWFyICAgICA9PiAyMDE1LCAgICAgICAgICAgICAgICMgb3B0aW9uYWwsIGRlZmF1bHRzIHRvIGN1cnJlbnQgeWVhciwgdXNlZCB0byBzZXQgdGhlIGluaXRpYWwgdmFsdWUKICAgICAgICA8UHJlZml4Pk1vbnRoICAgID0+IDYsICAgICAgICAgICAgICAgICAgIyBvcHRpb25hbCwgZGVmYXVsdHMgdG8gY3VycmVudCBtb250aCwgdXNlZCB0byBzZXQgdGhlIGluaXRpYWwgdmFsdWUKICAgICAgICA8UHJlZml4PkRheSAgICAgID0+IDksICAgICAgICAgICAgICAgICAgIyBvcHRpb25hbCwgZGVmYXVsdHMgdG8gY3VycmVudCBkYXksIHVzZWQgdG8gc2V0IHRoZSBpbml0aWFsIHZhbHVlCiAgICAgICAgPFByZWZpeD5Ib3VyICAgICA9PiAxMiwgICAgICAgICAgICAgICAgICMgb3B0aW9uYWwsIGRlZmF1bHRzIHRvIGN1cnJlbnQgaG91ciwgdXNlZCB0byBzZXQgdGhlIGluaXRpYWwgdmFsdWUKICAgICAgICA8UHJlZml4Pk1pbnV0ZSAgID0+IDI2LCAgICAgICAgICAgICAgICAgIyBvcHRpb25hbCwgZGVmYXVsdHMgdG8gY3VycmVudCBtaW51dGUsIHVzZWQgdG8gc2V0IHRoZSBpbml0aWFsIHZhbHVlCiAgICAgICAgPFByZWZpeD5TZWNvbmQgICA9PiA1OSwgICAgICAgICAgICAgICAgICMgb3B0aW9uYWwsIGRlZmF1bHRzIHRvIGN1cnJlbnQgc2Vjb25kLCB1c2VkIHRvIHNldCB0aGUgaW5pdGlhbCB2YWx1ZQogICAgICAgIDxQcmVmaXg+T3B0aW9uYWwgPT4gMSwgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsLCBkZWZhdWx0IDAsIHdoZW4gYWN0aXZlIGEgY2hlY2tib3ggaXMgaW5jbHVkZWQgdG8gc3BlY2lmeQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICAgaWYgdGhlIHZhbHVlcyBzaG91bGQgYmUgc2F2ZWQgb3Igbm90CiAgICAgICAgPFByZWZpeD5Vc2VkICAgICA9PiAxLCAgICAgICAgICAgICAgICAgICMgb3B0aW9uYWwsIGRlZmF1bHQgMCwgdXNlZCB0byBzZXQgdGhlIGluaXRpYWwgc3RhdGUgb2YgdGhlIGNoZWNrYm94CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgICBtZW50aW9uZWQgYWJvdmUKICAgICAgICA8UHJlZml4PlJlcXVpcmVkID0+IDEsICAgICAgICAgICAgICAgICAgIyBvcHRpb25hbCwgZGVmYXVsdCAwIChEZXByZWNhdGVkKQogICAgICAgIDxwcmVmaXg+Q2xhc3MgPT4gJ3NvbWUgY2xhc3MnLCAgICAgICAgICAjIG9wdGlvbmFsLCBzcGVjaWZ5IGFuIGFkZGl0aW9uYWwgY2xhc3MgdG8gdGhlIEhUTUwgZWxlbWVudHMKCiAgICAgICAgQXJlYSAgICAgPT4gJ3NvbWUgYXJlYScsICAgICAgICAgICAgICAgICMgb3B0aW9uYWwsIGRlZmF1bHQgJ0FnZW50JyAoRGVwcmVjYXRlZCkKICAgICAgICBEaWZmVGltZSA9PiAxMjMsICAgICAgICAgICAgICAgICAgICAgICAgIyBvcHRpb25hbCwgZGVmYXVsdCAwLCB1c2VkIHRvIHNldCB0aGUgaW5pdGlhbCB0aW1lIGluZmx1ZW5jaW5nIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICAgY3VycmVudCB0aW1lIChpbiBzZWNvbmRzKQogICAgICAgIE92ZXJyaWRlVGltZVpvbmUgICAgICAgID0+IDEsICAgICAgICAgICAjIG9wdGlvbmFsICgxIG9yIDApLCB3aGVuIGFjdGl2ZSB0aGUgdGltZSBpcyBub3QgdHJhbnNsYXRlZCB0byB0aGUgdXNlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICAgdGltZSB6b25lCiAgICAgICAgWWVhclBlcmlvZEZ1dHVyZSAgICAgICAgPT4gMywgICAgICAgICAgICMgb3B0aW9uYWwsIHVzZWQgdG8gZGVmaW5lIHRoZSBudW1iZXIgb2YgeWVhcnMgaW4gZnV0dXJlIHRvIGJlIGRpc3BsYXkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyAgIGluIHRoZSB5ZWFyIHNlbGVjdAogICAgICAgIFllYXJQZXJpb2RQYXN0ICAgICAgICAgID0+IDIsICAgICAgICAgICAjIG9wdGlvbmFsLCB1c2VkIHRvIGRlZmluZSB0aGUgbnVtYmVyIG9mIHllYXJzIGluIHBhc3QgdG8gYmUgZGlzcGxheQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICAgaW4gdGhlIHllYXIgc2VsZWN0CiAgICAgICAgWWVhckRpZmYgICAgICAgICAgICAgICAgPT4gMCwgICAgICAgICAgICMgb3B0aW9uYWwuIHVzZWQgdG8gZGVmaW5lIHRoZSBudW1iZXIgb2YgeWVhcnMgdG8gYmUgZGlzcGxheWVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgICBpbiB0aGUgeWVhciBzZWxlY3QgKGFsdGVybmF0aXZlbHkgdG8gWWVhclBlcmlvZEZ1dHVyZSBhbmQgWWVhclBlcmlvZFBhc3QpCiAgICAgICAgVmFsaWRhdGVEYXRlSW5GdXR1cmUgICAgPT4gMSwgICAgICAgICAgICMgb3B0aW9uYWwgKDEgb3IgMCksIHdoZW4gYWN0aXZlIHNldHMgYW4gc3BlY2lhbCBjbGFzcyB0byB2YWxpZGF0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICAgdGhhdCB0aGUgZGF0ZSBzZXQgaW4gdGhlIGNvbnRyb2xzIHRvIGJlIGluIHRoZSBmdXR1cmUKICAgICAgICBWYWxpZGF0ZURhdGVOb3RJbkZ1dHVyZSA9PiAxLCAgICAgICAgICAgIyBvcHRpb25hbCAoMSBvciAwKSwgd2hlbiBhY3RpdmUgc2V0cyBhbiBzcGVjaWFsIGNsYXNzIHRvIHZhbGlkYXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgICB0aGF0IHRoZSBkYXRlIHNldCBpbiB0aGUgY29udHJvbHMgbm90IHRvIGJlIGluIHRoZSBmdXR1cmUKCiAgICAgICAgQ2FsZW5kYXIgPT4gMiwgICAgICAgICAgICAgICAgICAgICAgICAgICMgb3B0aW9uYWwsIHVzZWQgdG8gZGVmaW5lIHRoZSBTeXNDb25maWcgY2FsZW5kYXIgb24gd2hpY2ggdGhlIERhdGVwaWNrZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyAgIHdpbGwgYmUgYmFzZWQgb24gdG8gc2hvdyB0aGUgdmFjYXRpb24gZGF5cyBhbmQgdGhlIHN0YXJ0IHdlZWsgZGF5CiAgICAgICAgRm9ybWF0ID0+ICdEYXRlSW1wdXRGb3JtYXQnLCAgICAgICAgICAgICMgb3B0aW9uYWwsIG9yICdEYXRlSW5wdXRGb3JtYXRMb25nJywgdXNlZCB0byBkZWZpbmUgaWYgb25seSBkYXRlIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgICBkYXRlL3RpbWUgY29tcG9uZW50cyBzaG91bGQgYmUgc2hvd24gKERhdGVJbnB1dEZvcm1hdExvbmcgc2hvd3MgZGF0ZS90aW1lKQogICAgICAgIFZhbGlkYXRlID0+IDEsICAgICAgICAgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsICgxIG9yIDApLCBkZWZpbmVzIGlmIHRoZSBkYXRlIHNlbGVjdGlvbiBzaG91bGQgYmUgdmFsaWRhdGVkIG9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgICBjbGllbnQgc2lkZSB3aXRoIEpTCiAgICAgICAgRGlzYWJsZWQgPT4gMSwgICAgICAgICAgICAgICAgICAgICAgICAgICMgb3B0aW9uYWwgKDEgb3IgMCksIHdoZW4gYWN0aXZlIHNlbGVjdCBhbmQgY2hlY2tib3ggY29udHJvbHMgZ2V0cyB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyAgIGRpc2FibGVkIGF0dHJpYnV0ZSBhbmQgaW5wdXQgZmllbGRzIGdldHMgdGhlIHJlYWQgb25seSBhdHRyaWJ1dGUKICAgICk7Cgo9Y3V0CgpzdWIgQnVpbGREYXRlU2VsZWN0aW9uIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgbXkgJERhdGVJbnB1dFN0eWxlID0gJENvbmZpZ09iamVjdC0+R2V0KCdUaW1lSW5wdXRGb3JtYXQnKTsKICAgIG15ICRQcmVmaXggICAgICAgICA9ICRQYXJhbXtQcmVmaXh9IHx8ICcnOwogICAgbXkgJERpZmZUaW1lICAgICAgID0gJFBhcmFte0RpZmZUaW1lfSB8fCAwOwogICAgbXkgJEZvcm1hdCAgICAgICAgID0gZGVmaW5lZCggJFBhcmFte0Zvcm1hdH0gKSA/ICRQYXJhbXtGb3JtYXR9IDogJ0RhdGVJbnB1dEZvcm1hdExvbmcnOwogICAgbXkgJEFyZWEgICAgICAgICAgID0gJFBhcmFte0FyZWF9IHx8ICdBZ2VudCc7CiAgICBteSAkT3B0aW9uYWwgICAgICAgPSAkUGFyYW17ICRQcmVmaXggLiAnT3B0aW9uYWwnIH0gfHwgMDsKICAgIG15ICRSZXF1aXJlZCAgICAgICA9ICRQYXJhbXsgJFByZWZpeCAuICdSZXF1aXJlZCcgfSB8fCAwOwogICAgbXkgJFVzZWQgICAgICAgICAgID0gJFBhcmFteyAkUHJlZml4IC4gJ1VzZWQnIH0gfHwgMDsKICAgIG15ICRDbGFzcyAgICAgICAgICA9ICRQYXJhbXsgJFByZWZpeCAuICdDbGFzcycgfSB8fCAnJzsKCiAgICAjIERlZmluZXMsIGlmIHRoZSBkYXRlIHNlbGVjdGlvbiBzaG91bGQgYmUgdmFsaWRhdGVkIG9uIGNsaWVudCBzaWRlIHdpdGggSlMKICAgIG15ICRWYWxpZGF0ZSA9ICRQYXJhbXtWYWxpZGF0ZX0gfHwgMDsKCiAgICAjIFZhbGlkYXRlIHRoYXQgdGhlIGRhdGUgaXMgaW4gdGhlIGZ1dHVyZSAoZS4gZy4gcGVuZGluZyB0aW1lcykKICAgIG15ICRWYWxpZGF0ZURhdGVJbkZ1dHVyZSAgICA9ICRQYXJhbXtWYWxpZGF0ZURhdGVJbkZ1dHVyZX0gICAgfHwgMDsKICAgIG15ICRWYWxpZGF0ZURhdGVOb3RJbkZ1dHVyZSA9ICRQYXJhbXtWYWxpZGF0ZURhdGVOb3RJbkZ1dHVyZX0gfHwgMDsKCiAgICBteSAoICRzLCAkbSwgJGgsICRELCAkTSwgJFkgKSA9ICRTZWxmLT57VXNlclRpbWVPYmplY3R9LT5TeXN0ZW1UaW1lMkRhdGUoCiAgICAgICAgU3lzdGVtVGltZSA9PiAkU2VsZi0+e1VzZXJUaW1lT2JqZWN0fS0+U3lzdGVtVGltZSgpICsgJERpZmZUaW1lLAogICAgKTsKCiAgICBteSAoICRDcywgJENtLCAkQ2gsICRDRCwgJENNLCAkQ1kgKSA9ICRTZWxmLT57VXNlclRpbWVPYmplY3R9LT5TeXN0ZW1UaW1lMkRhdGUoCiAgICAgICAgU3lzdGVtVGltZSA9PiAkU2VsZi0+e1VzZXJUaW1lT2JqZWN0fS0+U3lzdGVtVGltZSgpLAogICAgKTsKCiAgICAjIHRpbWUgem9uZSB0cmFuc2xhdGlvbgogICAgaWYgKAogICAgICAgICRDb25maWdPYmplY3QtPkdldCgnVGltZVpvbmVVc2VyJykKICAgICAgICAmJiAkU2VsZi0+e1VzZXJUaW1lWm9uZX0KICAgICAgICAmJiAkUGFyYW17ICRQcmVmaXggLiAnWWVhcicgfQogICAgICAgICYmICRQYXJhbXsgJFByZWZpeCAuICdNb250aCcgfQogICAgICAgICYmICRQYXJhbXsgJFByZWZpeCAuICdEYXknIH0KICAgICAgICAmJiAhJFBhcmFte092ZXJyaWRlVGltZVpvbmV9CiAgICAgICAgKQogICAgewogICAgICAgIG15ICRUaW1lU3RhbXAgPSAkU2VsZi0+e1RpbWVPYmplY3R9LT5UaW1lU3RhbXAyU3lzdGVtVGltZSgKICAgICAgICAgICAgU3RyaW5nID0+ICRQYXJhbXsgJFByZWZpeCAuICdZZWFyJyB9IC4gJy0nCiAgICAgICAgICAgICAgICAuICRQYXJhbXsgJFByZWZpeCAuICdNb250aCcgfSAuICctJwogICAgICAgICAgICAgICAgLiAkUGFyYW17ICRQcmVmaXggLiAnRGF5JyB9IC4gJyAnCiAgICAgICAgICAgICAgICAuICggJFBhcmFteyAkUHJlZml4IC4gJ0hvdXInIH0gICB8fCAwICkgLiAnOicKICAgICAgICAgICAgICAgIC4gKCAkUGFyYW17ICRQcmVmaXggLiAnTWludXRlJyB9IHx8IDAgKQogICAgICAgICAgICAgICAgLiAnOjAwJywKICAgICAgICApOwogICAgICAgICRUaW1lU3RhbXAgPSAkVGltZVN0YW1wICsgKCAkU2VsZi0+e1VzZXJUaW1lWm9uZX0gKiAzNjAwICk7CiAgICAgICAgKAogICAgICAgICAgICAkUGFyYW17ICRQcmVmaXggLiAnU2Vjb25kJyB9LAogICAgICAgICAgICAkUGFyYW17ICRQcmVmaXggLiAnTWludXRlJyB9LAogICAgICAgICAgICAkUGFyYW17ICRQcmVmaXggLiAnSG91cicgfSwKICAgICAgICAgICAgJFBhcmFteyAkUHJlZml4IC4gJ0RheScgfSwKICAgICAgICAgICAgJFBhcmFteyAkUHJlZml4IC4gJ01vbnRoJyB9LAogICAgICAgICAgICAkUGFyYW17ICRQcmVmaXggLiAnWWVhcicgfQogICAgICAgICkgPSAkU2VsZi0+e1VzZXJUaW1lT2JqZWN0fS0+U3lzdGVtVGltZTJEYXRlKCBTeXN0ZW1UaW1lID0+ICRUaW1lU3RhbXAgKTsKICAgIH0KCiAgICAjIHllYXIKICAgIGlmICggJERhdGVJbnB1dFN0eWxlIGVxICdPcHRpb24nICkgewogICAgICAgIG15ICVZZWFyOwogICAgICAgIGlmICggZGVmaW5lZCAkUGFyYW17WWVhclBlcmlvZFBhc3R9ICYmIGRlZmluZWQgJFBhcmFte1llYXJQZXJpb2RGdXR1cmV9ICkgewogICAgICAgICAgICBmb3IgKCAkWSAtICRQYXJhbXtZZWFyUGVyaW9kUGFzdH0gLi4gJFkgKyAkUGFyYW17WWVhclBlcmlvZEZ1dHVyZX0gKSB7CiAgICAgICAgICAgICAgICAkWWVhcnskX30gPSAkXzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgZm9yICggJFkgLSAxMCAuLiAkWSArIDEgKyAoICRQYXJhbXtZZWFyRGlmZn0gfHwgMCApICkgewogICAgICAgICAgICAgICAgJFllYXJ7JF99ID0gJF87CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgQ2hlY2sgaWYgdGhlIERpZmZUaW1lIGlzIGluIGEgZnV0dXJlIHllYXIuIEluIHRoaXMgY2FzZSwgd2UgYWRkIHRoZSBtaXNzaW5nIHllYXJzIGJldHdlZW4KICAgICAgICAjICRDWSAoY3VycmVudCB5ZWFyKSBhbmQgJFkgKHllYXIpIHRvIGFsbG93IHRoZSB1c2VyIHRvIG1hbnVhbGx5IHNldCBiYWNrIHRoZSB5ZWFyIGlmIG5lZWRlZC4KICAgICAgICBpZiAoICRZID4gJENZICkgewogICAgICAgICAgICBmb3IgKCAkQ1kgLi4gJFkgKSB7CiAgICAgICAgICAgICAgICAkWWVhcnskX30gPSAkXzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJFBhcmFte1llYXJ9ID0gJFNlbGYtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgICAgICBOYW1lICAgICAgICA9PiAkUHJlZml4IC4gJ1llYXInLAogICAgICAgICAgICBEYXRhICAgICAgICA9PiBcJVllYXIsCiAgICAgICAgICAgIFNlbGVjdGVkSUQgID0+IGludCggJFBhcmFteyAkUHJlZml4IC4gJ1llYXInIH0gfHwgJFkgKSwKICAgICAgICAgICAgVHJhbnNsYXRpb24gPT4gMCwKICAgICAgICAgICAgQ2xhc3MgICAgICAgPT4gJFZhbGlkYXRlID8gJ1ZhbGlkYXRlX0RhdGVZZWFyJyA6ICcnLAogICAgICAgICAgICBUaXRsZSAgICAgICA9PiAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCdZZWFyJyksCiAgICAgICAgICAgIERpc2FibGVkICAgID0+ICRQYXJhbXtEaXNhYmxlZH0sCiAgICAgICAgKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgICRQYXJhbXtZZWFyfSA9ICI8aW5wdXQgdHlwZT1cInRleHRcIiAiCiAgICAgICAgICAgIC4gKCAkVmFsaWRhdGUgPyAiY2xhc3M9XCJWYWxpZGF0ZV9EYXRlWWVhciAkQ2xhc3NcIiAiIDogImNsYXNzPVwiJENsYXNzXCIgIiApCiAgICAgICAgICAgIC4gIm5hbWU9XCIke1ByZWZpeH1ZZWFyXCIgaWQ9XCIke1ByZWZpeH1ZZWFyXCIgc2l6ZT1cIjRcIiBtYXhsZW5ndGg9XCI0XCIgIgogICAgICAgICAgICAuICJ0aXRsZT1cIiIKICAgICAgICAgICAgLiAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCdZZWFyJykKICAgICAgICAgICAgLiAiXCIgdmFsdWU9XCIiCiAgICAgICAgICAgIC4gc3ByaW50ZiggIiUwMmQiLCAoICRQYXJhbXsgJFByZWZpeCAuICdZZWFyJyB9IHx8ICRZICkgKSAuICJcIiAiCiAgICAgICAgICAgIC4gKCAkUGFyYW17RGlzYWJsZWR9ID8gJ3JlYWRvbmx5PSJyZWFkb25seSInIDogJycgKSAuICIvPiI7CiAgICB9CgogICAgIyBtb250aAogICAgaWYgKCAkRGF0ZUlucHV0U3R5bGUgZXEgJ09wdGlvbicgKSB7CiAgICAgICAgbXkgJU1vbnRoID0gbWFwIHsgJF8gPT4gc3ByaW50ZiggIiUwMmQiLCAkXyApOyB9ICggMSAuLiAxMiApOwogICAgICAgICRQYXJhbXtNb250aH0gPSAkU2VsZi0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgICAgIE5hbWUgICAgICAgID0+ICRQcmVmaXggLiAnTW9udGgnLAogICAgICAgICAgICBEYXRhICAgICAgICA9PiBcJU1vbnRoLAogICAgICAgICAgICBTZWxlY3RlZElEICA9PiBpbnQoICRQYXJhbXsgJFByZWZpeCAuICdNb250aCcgfSB8fCAkTSApLAogICAgICAgICAgICBUcmFuc2xhdGlvbiA9PiAwLAogICAgICAgICAgICBDbGFzcyAgICAgICA9PiAkVmFsaWRhdGUgPyAnVmFsaWRhdGVfRGF0ZU1vbnRoJyA6ICcnLAogICAgICAgICAgICBUaXRsZSAgICAgICA9PiAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCdNb250aCcpLAogICAgICAgICAgICBEaXNhYmxlZCAgICA9PiAkUGFyYW17RGlzYWJsZWR9LAogICAgICAgICk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkUGFyYW17TW9udGh9ID0gIjxpbnB1dCB0eXBlPVwidGV4dFwiICIKICAgICAgICAgICAgLiAoICRWYWxpZGF0ZSA/ICJjbGFzcz1cIlZhbGlkYXRlX0RhdGVNb250aCAkQ2xhc3NcIiAiIDogImNsYXNzPVwiJENsYXNzXCIgIiApCiAgICAgICAgICAgIC4gIm5hbWU9XCIke1ByZWZpeH1Nb250aFwiIGlkPVwiJHtQcmVmaXh9TW9udGhcIiBzaXplPVwiMlwiIG1heGxlbmd0aD1cIjJcIiAiCiAgICAgICAgICAgIC4gInRpdGxlPVwiIgogICAgICAgICAgICAuICRTZWxmLT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoJ01vbnRoJykKICAgICAgICAgICAgLiAiXCIgdmFsdWU9XCIiCiAgICAgICAgICAgIC4gc3ByaW50ZiggIiUwMmQiLCAoICRQYXJhbXsgJFByZWZpeCAuICdNb250aCcgfSB8fCAkTSApICkgLiAiXCIgIgogICAgICAgICAgICAuICggJFBhcmFte0Rpc2FibGVkfSA/ICdyZWFkb25seT0icmVhZG9ubHkiJyA6ICcnICkgLiAiLz4iOwogICAgfQoKICAgIG15ICREYXRlVmFsaWRhdGVDbGFzc2VzID0gJyc7CiAgICBpZiAoJFZhbGlkYXRlKSB7CiAgICAgICAgJERhdGVWYWxpZGF0ZUNsYXNzZXMKICAgICAgICAgICAgLj0gIlZhbGlkYXRlX0RhdGVEYXkgVmFsaWRhdGVfRGF0ZVllYXJfJHtQcmVmaXh9WWVhciBWYWxpZGF0ZV9EYXRlTW9udGhfJHtQcmVmaXh9TW9udGgiOwoKICAgICAgICBpZiAoICRGb3JtYXQgZXEgJ0RhdGVJbnB1dEZvcm1hdExvbmcnICkgewogICAgICAgICAgICAkRGF0ZVZhbGlkYXRlQ2xhc3NlcwogICAgICAgICAgICAgICAgLj0gIiBWYWxpZGF0ZV9EYXRlSG91cl8ke1ByZWZpeH1Ib3VyIFZhbGlkYXRlX0RhdGVNaW51dGVfJHtQcmVmaXh9TWludXRlIjsKICAgICAgICB9CgogICAgICAgIGlmICgkVmFsaWRhdGVEYXRlSW5GdXR1cmUpIHsKICAgICAgICAgICAgJERhdGVWYWxpZGF0ZUNsYXNzZXMgLj0gIiBWYWxpZGF0ZV9EYXRlSW5GdXR1cmUiOwogICAgICAgIH0KICAgICAgICBpZiAoJFZhbGlkYXRlRGF0ZU5vdEluRnV0dXJlKSB7CiAgICAgICAgICAgICREYXRlVmFsaWRhdGVDbGFzc2VzIC49ICIgVmFsaWRhdGVfRGF0ZU5vdEluRnV0dXJlIjsKICAgICAgICB9CiAgICB9CgogICAgIyBkYXkKICAgIGlmICggJERhdGVJbnB1dFN0eWxlIGVxICdPcHRpb24nICkgewogICAgICAgIG15ICVEYXkgPSBtYXAgeyAkXyA9PiBzcHJpbnRmKCAiJTAyZCIsICRfICk7IH0gKCAxIC4uIDMxICk7CiAgICAgICAgJFBhcmFte0RheX0gPSAkU2VsZi0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgICAgIE5hbWUgICAgICAgID0+ICRQcmVmaXggLiAnRGF5JywKICAgICAgICAgICAgRGF0YSAgICAgICAgPT4gXCVEYXksCiAgICAgICAgICAgIFNlbGVjdGVkSUQgID0+IGludCggJFBhcmFteyAkUHJlZml4IC4gJ0RheScgfSB8fCAkRCApLAogICAgICAgICAgICBUcmFuc2xhdGlvbiA9PiAwLAogICAgICAgICAgICBDbGFzcyAgICAgICA9PiAiJERhdGVWYWxpZGF0ZUNsYXNzZXMgJENsYXNzIiwKICAgICAgICAgICAgVGl0bGUgICAgICAgPT4gJFNlbGYtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgnRGF5JyksCiAgICAgICAgICAgIERpc2FibGVkICAgID0+ICRQYXJhbXtEaXNhYmxlZH0sCiAgICAgICAgKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgICRQYXJhbXtEYXl9ID0gIjxpbnB1dCB0eXBlPVwidGV4dFwiICIKICAgICAgICAgICAgLiAiY2xhc3M9XCIkRGF0ZVZhbGlkYXRlQ2xhc3NlcyAkQ2xhc3NcIiAiCiAgICAgICAgICAgIC4gIm5hbWU9XCIke1ByZWZpeH1EYXlcIiBpZD1cIiR7UHJlZml4fURheVwiIHNpemU9XCIyXCIgbWF4bGVuZ3RoPVwiMlwiICIKICAgICAgICAgICAgLiAidGl0bGU9XCIiCiAgICAgICAgICAgIC4gJFNlbGYtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgnRGF5JykKICAgICAgICAgICAgLiAiXCIgdmFsdWU9XCIiCiAgICAgICAgICAgIC4gc3ByaW50ZiggIiUwMmQiLCAoICRQYXJhbXsgJFByZWZpeCAuICdEYXknIH0gfHwgJEQgKSApIC4gIlwiICIKICAgICAgICAgICAgLiAoICRQYXJhbXtEaXNhYmxlZH0gPyAncmVhZG9ubHk9InJlYWRvbmx5IicgOiAnJyApIC4gIi8+IjsKCiAgICB9CiAgICBpZiAoICRGb3JtYXQgZXEgJ0RhdGVJbnB1dEZvcm1hdExvbmcnICkgewoKICAgICAgICAjIGhvdXIKICAgICAgICBpZiAoICREYXRlSW5wdXRTdHlsZSBlcSAnT3B0aW9uJyApIHsKICAgICAgICAgICAgbXkgJUhvdXIgPSBtYXAgeyAkXyA9PiBzcHJpbnRmKCAiJTAyZCIsICRfICk7IH0gKCAwIC4uIDIzICk7CiAgICAgICAgICAgICRQYXJhbXtIb3VyfSA9ICRTZWxmLT5CdWlsZFNlbGVjdGlvbigKICAgICAgICAgICAgICAgIE5hbWUgICAgICAgPT4gJFByZWZpeCAuICdIb3VyJywKICAgICAgICAgICAgICAgIERhdGEgICAgICAgPT4gXCVIb3VyLAogICAgICAgICAgICAgICAgU2VsZWN0ZWRJRCA9PiBkZWZpbmVkKCAkUGFyYW17ICRQcmVmaXggLiAnSG91cicgfSApCiAgICAgICAgICAgICAgICA/IGludCggJFBhcmFteyAkUHJlZml4IC4gJ0hvdXInIH0gKQogICAgICAgICAgICAgICAgOiBpbnQoJGgpLAogICAgICAgICAgICAgICAgVHJhbnNsYXRpb24gPT4gMCwKICAgICAgICAgICAgICAgIENsYXNzICAgICAgID0+ICRWYWxpZGF0ZSA/ICggJ1ZhbGlkYXRlX0RhdGVIb3VyICcgLiAkQ2xhc3MgKSA6ICRDbGFzcywKICAgICAgICAgICAgICAgIFRpdGxlICAgICAgID0+ICRTZWxmLT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoJ0hvdXJzJyksCiAgICAgICAgICAgICAgICBEaXNhYmxlZCAgICA9PiAkUGFyYW17RGlzYWJsZWR9LAogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFBhcmFte0hvdXJ9ID0gIjxpbnB1dCB0eXBlPVwidGV4dFwiICIKICAgICAgICAgICAgICAgIC4gKCAkVmFsaWRhdGUgPyAiY2xhc3M9XCJWYWxpZGF0ZV9EYXRlSG91ciAkQ2xhc3NcIiAiIDogImNsYXNzPVwiJENsYXNzXCIgIiApCiAgICAgICAgICAgICAgICAuICJuYW1lPVwiJHtQcmVmaXh9SG91clwiIGlkPVwiJHtQcmVmaXh9SG91clwiIHNpemU9XCIyXCIgbWF4bGVuZ3RoPVwiMlwiICIKICAgICAgICAgICAgICAgIC4gInRpdGxlPVwiIgogICAgICAgICAgICAgICAgLiAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCdIb3VycycpCiAgICAgICAgICAgICAgICAuICJcIiB2YWx1ZT1cIiIKICAgICAgICAgICAgICAgIC4gc3ByaW50ZigKICAgICAgICAgICAgICAgICIlMDJkIiwKICAgICAgICAgICAgICAgICggZGVmaW5lZCggJFBhcmFteyAkUHJlZml4IC4gJ0hvdXInIH0gKSA/IGludCggJFBhcmFteyAkUHJlZml4IC4gJ0hvdXInIH0gKSA6ICRoICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIC4gIlwiICIKICAgICAgICAgICAgICAgIC4gKCAkUGFyYW17RGlzYWJsZWR9ID8gJ3JlYWRvbmx5PSJyZWFkb25seSInIDogJycgKSAuICIvPiI7CgogICAgICAgIH0KCiAgICAgICAgIyBtaW51dGUKICAgICAgICBpZiAoICREYXRlSW5wdXRTdHlsZSBlcSAnT3B0aW9uJyApIHsKICAgICAgICAgICAgbXkgJU1pbnV0ZSA9IG1hcCB7ICRfID0+IHNwcmludGYoICIlMDJkIiwgJF8gKTsgfSAoIDAgLi4gNTkgKTsKICAgICAgICAgICAgJFBhcmFte01pbnV0ZX0gPSAkU2VsZi0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgICAgICAgICBOYW1lICAgICAgID0+ICRQcmVmaXggLiAnTWludXRlJywKICAgICAgICAgICAgICAgIERhdGEgICAgICAgPT4gXCVNaW51dGUsCiAgICAgICAgICAgICAgICBTZWxlY3RlZElEID0+IGRlZmluZWQoICRQYXJhbXsgJFByZWZpeCAuICdNaW51dGUnIH0gKQogICAgICAgICAgICAgICAgPyBpbnQoICRQYXJhbXsgJFByZWZpeCAuICdNaW51dGUnIH0gKQogICAgICAgICAgICAgICAgOiBpbnQoJG0pLAogICAgICAgICAgICAgICAgVHJhbnNsYXRpb24gPT4gMCwKICAgICAgICAgICAgICAgIENsYXNzICAgICAgID0+ICRWYWxpZGF0ZSA/ICggJ1ZhbGlkYXRlX0RhdGVNaW51dGUgJyAuICRDbGFzcyApIDogJENsYXNzLAogICAgICAgICAgICAgICAgVGl0bGUgICAgICAgPT4gJFNlbGYtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgnTWludXRlcycpLAogICAgICAgICAgICAgICAgRGlzYWJsZWQgICAgPT4gJFBhcmFte0Rpc2FibGVkfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRQYXJhbXtNaW51dGV9ID0gIjxpbnB1dCB0eXBlPVwidGV4dFwiICIKICAgICAgICAgICAgICAgIC4gKCAkVmFsaWRhdGUgPyAiY2xhc3M9XCJWYWxpZGF0ZV9EYXRlTWludXRlICRDbGFzc1wiICIgOiAiY2xhc3M9XCIkQ2xhc3NcIiAiICkKICAgICAgICAgICAgICAgIC4gIm5hbWU9XCIke1ByZWZpeH1NaW51dGVcIiBpZD1cIiR7UHJlZml4fU1pbnV0ZVwiIHNpemU9XCIyXCIgbWF4bGVuZ3RoPVwiMlwiICIKICAgICAgICAgICAgICAgIC4gInRpdGxlPVwiIgogICAgICAgICAgICAgICAgLiAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCdNaW51dGVzJykKICAgICAgICAgICAgICAgIC4gIlwiIHZhbHVlPVwiIgogICAgICAgICAgICAgICAgLiBzcHJpbnRmKAogICAgICAgICAgICAgICAgIiUwMmQiLAogICAgICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgICAgIGRlZmluZWQoICRQYXJhbXsgJFByZWZpeCAuICdNaW51dGUnIH0gKQogICAgICAgICAgICAgICAgICAgID8gaW50KCAkUGFyYW17ICRQcmVmaXggLiAnTWludXRlJyB9ICkKICAgICAgICAgICAgICAgICAgICA6ICRtCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKSAuICJcIiAiCiAgICAgICAgICAgICAgICAuICggJFBhcmFte0Rpc2FibGVkfSA/ICdyZWFkb25seT0icmVhZG9ubHkiJyA6ICcnICkgLiAiLz4iOwogICAgICAgIH0KICAgIH0KCiAgICAjIEdldCBmaXJzdCBkYXkgb2YgdGhlIHdlZWsKICAgIG15ICRXZWVrRGF5U3RhcnQgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0NhbGVuZGFyV2Vla0RheVN0YXJ0Jyk7CiAgICBpZiAoICRQYXJhbXtDYWxlbmRhcn0gKSB7CiAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoICJUaW1lWm9uZTo6Q2FsZW5kYXIiIC4gJFBhcmFte0NhbGVuZGFyfSAuICJOYW1lIiApICkgewogICAgICAgICAgICAkV2Vla0RheVN0YXJ0ID0gJENvbmZpZ09iamVjdC0+R2V0KCAiQ2FsZW5kYXJXZWVrRGF5U3RhcnQ6OkNhbGVuZGFyIiAuICRQYXJhbXtDYWxlbmRhcn0gKTsKICAgICAgICB9CiAgICB9CiAgICBpZiAoICFkZWZpbmVkICRXZWVrRGF5U3RhcnQgKSB7CiAgICAgICAgJFdlZWtEYXlTdGFydCA9IDE7CiAgICB9CgogICAgbXkgJE91dHB1dDsKCiAgICAjIG9wdGlvbmFsIGNoZWNrYm94CiAgICBpZiAoJE9wdGlvbmFsKSB7CiAgICAgICAgbXkgJENoZWNrZWQgPSAnJzsKICAgICAgICBpZiAoJFVzZWQpIHsKICAgICAgICAgICAgJENoZWNrZWQgPSAnIGNoZWNrZWQ9ImNoZWNrZWQiJzsKICAgICAgICB9CiAgICAgICAgJE91dHB1dCAuPSAiPGlucHV0IHR5cGU9XCJjaGVja2JveFwiIG5hbWU9XCIiCiAgICAgICAgICAgIC4gJFByZWZpeAogICAgICAgICAgICAuICJVc2VkXCIgaWQ9XCIiIC4gJFByZWZpeCAuICJVc2VkXCIgdmFsdWU9XCIxXCIiCiAgICAgICAgICAgIC4gJENoZWNrZWQKICAgICAgICAgICAgLiAiIGNsYXNzPVwiJENsYXNzXCIiCiAgICAgICAgICAgIC4gIiB0aXRsZT1cIiIKICAgICAgICAgICAgLiAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCdDaGVjayB0byBhY3RpdmF0ZSB0aGlzIGRhdGUnKQogICAgICAgICAgICAuICJcIiAiCiAgICAgICAgICAgIC4gKCAkUGFyYW17RGlzYWJsZWR9ID8gJ2Rpc2FibGVkPSJkaXNhYmxlZCInIDogJycgKQogICAgICAgICAgICAuICIvPiZuYnNwOyI7CiAgICB9CgogICAgIyByZW1vdmUgJ1NlY29uZCcgYmVjYXVzZSBpdCBpcyBuZXZlciB1c2VkIGFuZCBidWcgIzk0NDEKICAgIGRlbGV0ZSAkUGFyYW17ICRQcmVmaXggLiAnU2Vjb25kJyB9OwoKICAgICMgZGF0ZSBmb3JtYXQKICAgICRPdXRwdXQgLj0gJFNlbGYtPntMYW5ndWFnZU9iamVjdH0tPlRpbWUoCiAgICAgICAgQWN0aW9uID0+ICdSZXR1cm4nLAogICAgICAgIEZvcm1hdCA9PiAnRGF0ZUlucHV0Rm9ybWF0JywKICAgICAgICBNb2RlICAgPT4gJ05vdE51bWVyaWMnLAogICAgICAgICVQYXJhbSwKICAgICk7CgogICAgIyBwcmVwYXJlIGRhdGVwaWNrZXIgZm9yIHNwZWNpZmljIGNhbGVuZGFyCiAgICBteSAkVmFjYXRpb25EYXlzID0gJyc7CiAgICBpZiAoICRQYXJhbXtDYWxlbmRhcn0gKSB7CiAgICAgICAgJFZhY2F0aW9uRGF5cyA9ICRTZWxmLT5EYXRlcGlja2VyR2V0VmFjYXRpb25EYXlzKAogICAgICAgICAgICBDYWxlbmRhciA9PiAkUGFyYW17Q2FsZW5kYXJ9LAogICAgICAgICk7CiAgICB9CiAgICBteSAkVmFjYXRpb25EYXlzSlNPTiA9ICRTZWxmLT5KU09ORW5jb2RlKAogICAgICAgIERhdGEgPT4gJFZhY2F0aW9uRGF5cywKICAgICk7CgogICAgIyBBZGQgRGF0ZXBpY2tlciBKUyB0byBvdXRwdXQuCiAgICBteSAkRGF0ZXBpY2tlckpTID0gJwogICAgQ29yZS5VSS5EYXRlcGlja2VyLkluaXQoewogICAgICAgIERheTogJCgiIyIgKyBDb3JlLkFwcC5Fc2NhcGVTZWxlY3RvcigiJyAuICRQcmVmaXggLiAnIikgKyAiRGF5IiksCiAgICAgICAgTW9udGg6ICQoIiMiICsgQ29yZS5BcHAuRXNjYXBlU2VsZWN0b3IoIicgLiAkUHJlZml4IC4gJyIpICsgIk1vbnRoIiksCiAgICAgICAgWWVhcjogJCgiIyIgKyBDb3JlLkFwcC5Fc2NhcGVTZWxlY3RvcigiJyAuICRQcmVmaXggLiAnIikgKyAiWWVhciIpLAogICAgICAgIEhvdXI6ICQoIiMiICsgQ29yZS5BcHAuRXNjYXBlU2VsZWN0b3IoIicgLiAkUHJlZml4IC4gJyIpICsgIkhvdXIiKSwKICAgICAgICBNaW51dGU6ICQoIiMiICsgQ29yZS5BcHAuRXNjYXBlU2VsZWN0b3IoIicgLiAkUHJlZml4IC4gJyIpICsgIk1pbnV0ZSIpLAogICAgICAgIFZhY2F0aW9uRGF5czogJyAuICRWYWNhdGlvbkRheXNKU09OIC4gJywKICAgICAgICBEYXRlSW5GdXR1cmU6ICcgLiAgICAoICRWYWxpZGF0ZURhdGVJbkZ1dHVyZSAgICA/ICd0cnVlJyA6ICdmYWxzZScgKSAuICcsCiAgICAgICAgRGF0ZU5vdEluRnV0dXJlOiAnIC4gKCAkVmFsaWRhdGVEYXRlTm90SW5GdXR1cmUgPyAndHJ1ZScgOiAnZmFsc2UnICkgLiAnLAogICAgICAgIFdlZWtEYXlTdGFydDogJyAuICRXZWVrRGF5U3RhcnQgLiAnCiAgICB9KTsnOwoKICAgICRTZWxmLT5BZGRKU09uRG9jdW1lbnRDb21wbGV0ZSggQ29kZSA9PiAkRGF0ZXBpY2tlckpTICk7CiAgICAkU2VsZi0+e0hhc0RhdGVwaWNrZXJ9ID0gMTsgICAgIyBDYWxsIHNvbWUgRGF0ZXBpY2tlciBpbml0IGNvZGUuCgogICAgcmV0dXJuICRPdXRwdXQ7Cn0KCnN1YiBDdXN0b21lckxvZ2luIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJE91dHB1dCA9ICcnOwogICAgJFBhcmFte1RpdGxlQXJlYX0gPSAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCdMb2dpbicpIC4gJyAtICc7CgogICAgIyBzZXQgQWN0aW9uIHBhcmFtZXRlciBmb3IgdGhlIGxvYWRlcgogICAgJFNlbGYtPntBY3Rpb259ID0gJ0N1c3RvbWVyTG9naW4nOwogICAgJFBhcmFteydYTG9naW5IZWFkZXInfSA9IDE7CgogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1Nlc3Npb25Vc2VDb29raWUnKSApIHsKCiAgICAgICAgIyBhbHdheXMgc2V0IGEgY29va2llLCBzbyB0aGF0IGF0IHRoZSB0aW1lIHRoZSB1c2VyIHN1Ym1pdHMKICAgICAgICAjIHRoZSBwYXNzd29yZCwgd2Uga25vdyBhbHJlYWR5IGlmIHRoZSBicm93c2VyIHN1cHBvcnRzIGNvb2tpZXMuCiAgICAgICAgIyAoIHRoZSBzZXNzaW9uIGNvb2tpZSBpc24ndCBhdmFpbGFibGUgYXQgdGhhdCB0aW1lICkuCiAgICAgICAgbXkgJENvb2tpZVNlY3VyZUF0dHJpYnV0ZSA9IDA7CiAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ0h0dHBUeXBlJykgZXEgJ2h0dHBzJyApIHsKCiAgICAgICAgICAgICMgUmVzdHJpY3QgQ29va2llIHRvIEhUVFBTIGlmIGl0IGlzIHVzZWQuCiAgICAgICAgICAgICRDb29raWVTZWN1cmVBdHRyaWJ1dGUgPSAxOwogICAgICAgIH0KICAgICAgICAkU2VsZi0+e1NldENvb2tpZXN9LT57T1RSU0Jyb3dzZXJIYXNDb29raWV9ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpLT5TZXRDb29raWUoCiAgICAgICAgICAgIEtleSAgICAgID0+ICdPVFJTQnJvd3Nlckhhc0Nvb2tpZScsCiAgICAgICAgICAgIFZhbHVlICAgID0+IDEsCiAgICAgICAgICAgIEV4cGlyZXMgID0+ICcxeScsCiAgICAgICAgICAgIFBhdGggICAgID0+ICRDb25maWdPYmplY3QtPkdldCgnU2NyaXB0QWxpYXMnKSwKICAgICAgICAgICAgU2VjdXJlICAgPT4gJENvb2tpZVNlY3VyZUF0dHJpYnV0ZSwKICAgICAgICAgICAgSHR0cE9ubHkgPT4gMSwKICAgICAgICApOwogICAgfQoKICAgICMgYWRkIGNvb2tpZXMgaWYgZXhpc3RzCiAgICBpZiAoICRTZWxmLT57U2V0Q29va2llc30gJiYgJENvbmZpZ09iamVjdC0+R2V0KCdTZXNzaW9uVXNlQ29va2llJykgKSB7CiAgICAgICAgZm9yICggc29ydCBrZXlzICV7ICRTZWxmLT57U2V0Q29va2llc30gfSApIHsKICAgICAgICAgICAgJE91dHB1dCAuPSAiU2V0LUNvb2tpZTogJFNlbGYtPntTZXRDb29raWVzfS0+eyRffVxuIjsKICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBpZiBtZXNzYWdlIHNob3VsZCBiZSBzaG93bgogICAgaWYgKCAkUGFyYW17TWVzc2FnZX0gKSB7CiAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdNZXNzYWdlJywKICAgICAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgICAgICk7CiAgICB9CgogICAgIyBHZW5lcmF0ZSB0aGUgbWluaWZpZWQgQ1NTIGFuZCBKYXZhU2NyaXB0IGZpbGVzIGFuZCB0aGUgdGFncyByZWZlcmVuY2luZyB0aGVtIChzZWUgTGF5b3V0TG9hZGVyKQogICAgJFNlbGYtPkxvYWRlckNyZWF0ZUN1c3RvbWVyQ1NTQ2FsbHMoKTsKICAgICRTZWxmLT5Mb2FkZXJDcmVhdGVDdXN0b21lckpTQ2FsbHMoKTsKCiAgICAjIEFkZCBoZWFkZXIgbG9nbywgaWYgY29uZmlndXJlZAogICAgaWYgKCBkZWZpbmVkICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJMb2dvJykgKSB7CiAgICAgICAgbXkgJUN1c3RvbWVyTG9nbyA9ICV7ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJMb2dvJykgfTsKICAgICAgICBteSAlRGF0YTsKCiAgICAgICAgZm9yIG15ICRDU1NTdGF0ZW1lbnQgKCBzb3J0IGtleXMgJUN1c3RvbWVyTG9nbyApIHsKICAgICAgICAgICAgaWYgKCAkQ1NTU3RhdGVtZW50IGVxICdVUkwnICkgewogICAgICAgICAgICAgICAgbXkgJFdlYlBhdGggPSAnJzsKICAgICAgICAgICAgICAgIGlmICggJEN1c3RvbWVyTG9nb3skQ1NTU3RhdGVtZW50fSAhfiAvKGh0dHB8ZnRwfGh0dHBzKTpcLy9pICkgewogICAgICAgICAgICAgICAgICAgICRXZWJQYXRoID0gJENvbmZpZ09iamVjdC0+R2V0KCdGcm9udGVuZDo6V2ViUGF0aCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJERhdGF7J1VSTCd9ID0gJ3VybCgnIC4gJFdlYlBhdGggLiAkQ3VzdG9tZXJMb2dveyRDU1NTdGF0ZW1lbnR9IC4gJyknOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJERhdGF7JENTU1N0YXRlbWVudH0gPSAkQ3VzdG9tZXJMb2dveyRDU1NTdGF0ZW1lbnR9OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkU2VsZi0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0hlYWRlckxvZ29DU1MnLAogICAgICAgICAgICBEYXRhID0+IFwlRGF0YSwKICAgICAgICApOwoKICAgICAgICAkU2VsZi0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0hlYWRlckxvZ28nLAogICAgICAgICk7CiAgICB9CgogICAgIyBnZXQgc3lzdGVtIG1haW50ZW5hbmNlIG9iamVjdAogICAgbXkgJFN5c3RlbU1haW50ZW5hbmNlT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlN5c3RlbU1haW50ZW5hbmNlJyk7CgogICAgbXkgJEFjdGl2ZU1haW50ZW5hbmNlID0gJFN5c3RlbU1haW50ZW5hbmNlT2JqZWN0LT5TeXN0ZW1NYWludGVuYW5jZUlzQWN0aXZlKCk7CgogICAgIyBjaGVjayBpZiBzeXN0ZW0gbWFpbnRlbmFuY2UgaXMgYWN0aXZlCiAgICBpZiAoJEFjdGl2ZU1haW50ZW5hbmNlKSB7CiAgICAgICAgbXkgJFN5c3RlbU1haW50ZW5hbmNlRGF0YSA9ICRTeXN0ZW1NYWludGVuYW5jZU9iamVjdC0+U3lzdGVtTWFpbnRlbmFuY2VHZXQoCiAgICAgICAgICAgIElEICAgICA9PiAkQWN0aXZlTWFpbnRlbmFuY2UsCiAgICAgICAgICAgIFVzZXJJRCA9PiAxLAogICAgICAgICk7CiAgICAgICAgaWYgKCAkU3lzdGVtTWFpbnRlbmFuY2VEYXRhLT57U2hvd0xvZ2luTWVzc2FnZX0gKSB7CiAgICAgICAgICAgIG15ICRMb2dpbk1lc3NhZ2UgPQogICAgICAgICAgICAgICAgJFN5c3RlbU1haW50ZW5hbmNlRGF0YS0+e0xvZ2luTWVzc2FnZX0KICAgICAgICAgICAgICAgIHx8ICRDb25maWdPYmplY3QtPkdldCgnU3lzdGVtTWFpbnRlbmFuY2U6OklzQWN0aXZlRGVmYXVsdExvZ2luTWVzc2FnZScpCiAgICAgICAgICAgICAgICB8fCAiU3lzdGVtIG1haW50ZW5hbmNlIGlzIGFjdGl2ZSwgbm90IHBvc3NpYmxlIHRvIHBlcmZvcm0gYSBsb2dpbiEiOwoKICAgICAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnU3lzdGVtTWFpbnRlbmFuY2UnLAogICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgTG9naW5NZXNzYWdlID0+ICRMb2dpbk1lc3NhZ2UsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIHNob3cgcHJlbG9naW4gYmxvY2ssIGlmIGluIHByZWxvZ2luIG1vZGUgKGUuZy4gU1NPIGxvZ2luKQogICAgaWYgKCBkZWZpbmVkICRQYXJhbXsnTW9kZSd9ICYmICRQYXJhbXsnTW9kZSd9IGVxICdQcmVMb2dpbicgKSB7CiAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdQcmVMb2dpbicsCiAgICAgICAgICAgIERhdGEgPT4gXCVQYXJhbSwKICAgICAgICApOwogICAgfQoKICAgICMgaWYgbm90IGluIFByZUxvZ2luIG1vZGUsIHNob3cgbm9ybWFsIGxvZ2luIGZvcm0KICAgIGVsc2UgewoKICAgICAgICAkU2VsZi0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0xvZ2luQm94JywKICAgICAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgICAgICk7CgogICAgICAgICMgc2hvdyAyIGZhY3RvciBwYXNzd29yZCBpbnB1dCBpZiB3ZSBoYXZlIGF0IGxlYXN0IG9uZSBiYWNrZW5kIGVuYWJsZWQKICAgICAgICBDT1VOVDoKICAgICAgICBmb3IgbXkgJENvdW50ICggJycsIDEgLi4gMTAgKSB7CiAgICAgICAgICAgIG5leHQgQ09VTlQgaWYgISRDb25maWdPYmplY3QtPkdldCgiQ3VzdG9tZXI6OkF1dGhUd29GYWN0b3JNb2R1bGUkQ291bnQiKTsKCiAgICAgICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0F1dGhUd29GYWN0b3InLAogICAgICAgICAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgICAgICAgICApOwogICAgICAgICAgICBsYXN0IENPVU5UOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgbG9zdCBwYXNzd29yZCBvdXRwdXQKICAgICAgICBpZiAoCiAgICAgICAgICAgICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQYW5lbExvc3RQYXNzd29yZCcpCiAgICAgICAgICAgICYmICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXI6OkF1dGhNb2R1bGUnKSBlcQogICAgICAgICAgICAnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyQXV0aDo6REInCiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0xvc3RQYXNzd29yZExpbmsnLAogICAgICAgICAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgICAgICAgICApOwogICAgICAgICAgICAkU2VsZi0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdMb3N0UGFzc3dvcmQnLAogICAgICAgICAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgY3JlYXRlIGFjY291bnQgb3V0cHV0CiAgICAgICAgaWYgKAogICAgICAgICAgICAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyUGFuZWxDcmVhdGVBY2NvdW50JykKICAgICAgICAgICAgJiYgJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lcjo6QXV0aE1vZHVsZScpIGVxCiAgICAgICAgICAgICdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJBdXRoOjpEQicKICAgICAgICAgICAgKQoKICAgICAgICB7CiAgICAgICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0NyZWF0ZUFjY291bnRMaW5rJywKICAgICAgICAgICAgICAgIERhdGEgPT4gXCVQYXJhbSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnQ3JlYXRlQWNjb3VudCcsCiAgICAgICAgICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgY3JlYXRlICYgcmV0dXJuIG91dHB1dAogICAgJE91dHB1dCAuPSAkU2VsZi0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQ3VzdG9tZXJMb2dpbicsCiAgICAgICAgRGF0YSAgICAgICAgID0+IFwlUGFyYW0KICAgICk7CgogICAgIyByZW1vdmUgdGhlIHZlcnNpb24gdGFnIGZyb20gdGhlIGhlYWRlciBpZiBjb25maWd1cmVkCiAgICAkU2VsZi0+X0Rpc2FibGVCYW5uZXJDaGVjayggT3V0cHV0UmVmID0+IFwkT3V0cHV0ICk7CgogICAgcmV0dXJuICRPdXRwdXQ7Cn0KCnN1YiBDdXN0b21lckhlYWRlciB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRUeXBlID0gJFBhcmFte1R5cGV9IHx8ICcnOwoKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgICMgYWRkIGNvb2tpZXMgaWYgZXhpc3RzCiAgICBteSAkT3V0cHV0ID0gJyc7CiAgICBpZiAoICRTZWxmLT57U2V0Q29va2llc30gJiYgJENvbmZpZ09iamVjdC0+R2V0KCdTZXNzaW9uVXNlQ29va2llJykgKSB7CiAgICAgICAgZm9yICggc29ydCBrZXlzICV7ICRTZWxmLT57U2V0Q29va2llc30gfSApIHsKICAgICAgICAgICAgJE91dHB1dCAuPSAiU2V0LUNvb2tpZTogJFNlbGYtPntTZXRDb29raWVzfS0+eyRffVxuIjsKICAgICAgICB9CiAgICB9CgogICAgbXkgJEZpbGUgPSAkUGFyYW17RmlsZW5hbWV9IHx8ICRTZWxmLT57QWN0aW9ufSB8fCAndW5rbm93bic7CgogICAgIyBzZXQgZmlsZSBuYW1lIGZvciAic2F2ZSBwYWdlIGFzIgogICAgJFBhcmFte0NvbnRlbnREaXNwb3NpdGlvbn0gPSAiZmlsZW5hbWU9XCIkRmlsZS5odG1sXCIiOwoKICAgICMgYXJlYSBhbmQgdGl0bGUKICAgIGlmICgKICAgICAgICAhJFBhcmFte0FyZWF9CiAgICAgICAgJiYgJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lckZyb250ZW5kOjpNb2R1bGUnKS0+eyAkU2VsZi0+e0FjdGlvbn0gfQogICAgICAgICkKICAgIHsKICAgICAgICAkUGFyYW17QXJlYX0gPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyRnJvbnRlbmQ6Ok1vZHVsZScpLT57ICRTZWxmLT57QWN0aW9ufSB9CiAgICAgICAgICAgIC0+e05hdkJhck5hbWV9IHx8ICcnOwogICAgfQogICAgaWYgKAogICAgICAgICEkUGFyYW17VGl0bGV9CiAgICAgICAgJiYgJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lckZyb250ZW5kOjpNb2R1bGUnKS0+eyAkU2VsZi0+e0FjdGlvbn0gfQogICAgICAgICkKICAgIHsKICAgICAgICAkUGFyYW17VGl0bGV9ID0gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lckZyb250ZW5kOjpNb2R1bGUnKS0+eyAkU2VsZi0+e0FjdGlvbn0gfS0+e1RpdGxlfQogICAgICAgICAgICB8fCAnJzsKICAgIH0KICAgIGlmICgKICAgICAgICAhJFBhcmFte0FyZWF9CiAgICAgICAgJiYgJENvbmZpZ09iamVjdC0+R2V0KCdQdWJsaWNGcm9udGVuZDo6TW9kdWxlJyktPnsgJFNlbGYtPntBY3Rpb259IH0KICAgICAgICApCiAgICB7CiAgICAgICAgJFBhcmFte0FyZWF9ID0gJENvbmZpZ09iamVjdC0+R2V0KCdQdWJsaWNGcm9udGVuZDo6TW9kdWxlJyktPnsgJFNlbGYtPntBY3Rpb259IH0KICAgICAgICAgICAgLT57TmF2QmFyTmFtZX0gfHwgJyc7CiAgICB9CiAgICBpZiAoCiAgICAgICAgISRQYXJhbXtUaXRsZX0KICAgICAgICAmJiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1B1YmxpY0Zyb250ZW5kOjpNb2R1bGUnKS0+eyAkU2VsZi0+e0FjdGlvbn0gfQogICAgICAgICkKICAgIHsKICAgICAgICAkUGFyYW17VGl0bGV9ID0gJENvbmZpZ09iamVjdC0+R2V0KCdQdWJsaWNGcm9udGVuZDo6TW9kdWxlJyktPnsgJFNlbGYtPntBY3Rpb259IH0tPntUaXRsZX0KICAgICAgICAgICAgfHwgJyc7CiAgICB9CiAgICBmb3IgbXkgJFdvcmQgKHF3KFZhbHVlIFRpdGxlIEFyZWEpKSB7CiAgICAgICAgaWYgKCAkUGFyYW17JFdvcmR9ICkgewogICAgICAgICAgICAkUGFyYW17VGl0bGVBcmVhfSAuPSAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCAkUGFyYW17JFdvcmR9ICkgLiAnIC0gJzsKICAgICAgICB9CiAgICB9CgogICAgbXkgJEZyb250ZW5kOwogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyRnJvbnRlbmQ6Ok1vZHVsZScpLT57ICRTZWxmLT57QWN0aW9ufSB9ICkgewogICAgICAgICRGcm9udGVuZCA9ICdDdXN0b21lcic7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkRnJvbnRlbmQgPSAnUHVibGljJzsKICAgIH0KCiAgICAjIHJ1biBoZWFkZXIgbWV0YSBtb2R1bGVzIGZvciBjdXN0b21lciBhbmQgcHVibGljIGZyb250ZW5kcwogICAgbXkgJEhlYWRlck1ldGFNb2R1bGUgPSAkQ29uZmlnT2JqZWN0LT5HZXQoICRGcm9udGVuZCAuICdGcm9udGVuZDo6SGVhZGVyTWV0YU1vZHVsZScgKTsKICAgIGlmICggcmVmICRIZWFkZXJNZXRhTW9kdWxlIGVxICdIQVNIJyApIHsKICAgICAgICBteSAlSm9icyA9ICV7JEhlYWRlck1ldGFNb2R1bGV9OwoKICAgICAgICBteSAkTWFpbk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyk7CgogICAgICAgIE1PRFVMRToKICAgICAgICBmb3IgbXkgJEpvYiAoIHNvcnQga2V5cyAlSm9icyApIHsKCiAgICAgICAgICAgICMgbG9hZCBhbmQgcnVuIG1vZHVsZQogICAgICAgICAgICBuZXh0IE1PRFVMRSBpZiAhJE1haW5PYmplY3QtPlJlcXVpcmUoICRKb2JzeyRKb2J9LT57TW9kdWxlfSApOwogICAgICAgICAgICBteSAkT2JqZWN0ID0gJEpvYnN7JEpvYn0tPntNb2R1bGV9LT5uZXcoICV7JFNlbGZ9LCBMYXlvdXRPYmplY3QgPT4gJFNlbGYgKTsKICAgICAgICAgICAgbmV4dCBNT0RVTEUgaWYgISRPYmplY3Q7CiAgICAgICAgICAgICRPYmplY3QtPlJ1biggJVBhcmFtLCBDb25maWcgPT4gJEpvYnN7JEpvYn0gKTsKICAgICAgICB9CiAgICB9CgogICAgIyBzZXQgcnRsIGlmIG5lZWRlZAogICAgaWYgKCAkU2VsZi0+e1RleHREaXJlY3Rpb259ICYmICRTZWxmLT57VGV4dERpcmVjdGlvbn0gZXEgJ3J0bCcgKSB7CiAgICAgICAgJFBhcmFte0JvZHlDbGFzc30gPSAnUlRMJzsKICAgIH0KICAgIGVsc2lmICggJENvbmZpZ09iamVjdC0+R2V0KCdGcm9udGVuZDo6RGVidWdNb2RlJykgKSB7CiAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdEZWJ1Z1JUTEJ1dHRvbicsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIEFkZCBoZWFkZXIgbG9nbywgaWYgY29uZmlndXJlZAogICAgaWYgKCBkZWZpbmVkICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJMb2dvJykgKSB7CiAgICAgICAgbXkgJUN1c3RvbWVyTG9nbyA9ICV7ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJMb2dvJykgfTsKICAgICAgICBteSAlRGF0YTsKCiAgICAgICAgZm9yIG15ICRDU1NTdGF0ZW1lbnQgKCBzb3J0IGtleXMgJUN1c3RvbWVyTG9nbyApIHsKICAgICAgICAgICAgaWYgKCAkQ1NTU3RhdGVtZW50IGVxICdVUkwnICkgewogICAgICAgICAgICAgICAgbXkgJFdlYlBhdGggPSAnJzsKICAgICAgICAgICAgICAgIGlmICggJEN1c3RvbWVyTG9nb3skQ1NTU3RhdGVtZW50fSAhfiAvKGh0dHB8ZnRwfGh0dHBzKTpcLy9pICkgewogICAgICAgICAgICAgICAgICAgICRXZWJQYXRoID0gJENvbmZpZ09iamVjdC0+R2V0KCdGcm9udGVuZDo6V2ViUGF0aCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJERhdGF7J1VSTCd9ID0gJ3VybCgnIC4gJFdlYlBhdGggLiAkQ3VzdG9tZXJMb2dveyRDU1NTdGF0ZW1lbnR9IC4gJyknOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJERhdGF7JENTU1N0YXRlbWVudH0gPSAkQ3VzdG9tZXJMb2dveyRDU1NTdGF0ZW1lbnR9OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkU2VsZi0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0hlYWRlckxvZ29DU1MnLAogICAgICAgICAgICBEYXRhID0+IFwlRGF0YSwKICAgICAgICApOwoKICAgICAgICAkU2VsZi0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0hlYWRlckxvZ28nLAogICAgICAgICk7CiAgICB9CgogICAgIyBHZW5lcmF0ZSB0aGUgbWluaWZpZWQgQ1NTIGFuZCBKYXZhU2NyaXB0IGZpbGVzCiAgICAjIGFuZCB0aGUgdGFncyByZWZlcmVuY2luZyB0aGVtIChzZWUgTGF5b3V0TG9hZGVyKQogICAgJFNlbGYtPkxvYWRlckNyZWF0ZUN1c3RvbWVyQ1NTQ2FsbHMoKTsKCiAgICAjIGNyZWF0ZSAmIHJldHVybiBvdXRwdXQKICAgICRPdXRwdXQgLj0gJFNlbGYtPk91dHB1dCgKICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gIkN1c3RvbWVySGVhZGVyJFR5cGUiLAogICAgICAgIERhdGEgICAgICAgICA9PiBcJVBhcmFtLAogICAgKTsKCiAgICAjIHJlbW92ZSB0aGUgdmVyc2lvbiB0YWcgZnJvbSB0aGUgaGVhZGVyIGlmIGNvbmZpZ3VyZWQKICAgICRTZWxmLT5fRGlzYWJsZUJhbm5lckNoZWNrKCBPdXRwdXRSZWYgPT4gXCRPdXRwdXQgKTsKCiAgICByZXR1cm4gJE91dHB1dDsKfQoKc3ViIEN1c3RvbWVyRm9vdGVyIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJFR5cGUgICAgICAgICAgPSAkUGFyYW17VHlwZX0gICAgICAgICAgIHx8ICcnOwogICAgbXkgJEhhc0RhdGVwaWNrZXIgPSAkU2VsZi0+e0hhc0RhdGVwaWNrZXJ9IHx8IDA7CgogICAgIyBHZW5lcmF0ZSB0aGUgbWluaWZpZWQgQ1NTIGFuZCBKYXZhU2NyaXB0IGZpbGVzCiAgICAjIGFuZCB0aGUgdGFncyByZWZlcmVuY2luZyB0aGVtIChzZWUgTGF5b3V0TG9hZGVyKQogICAgJFNlbGYtPkxvYWRlckNyZWF0ZUN1c3RvbWVySlNDYWxscygpOwoKICAgICMgZ2V0IGRhdGVwaWNrZXIgZGF0YSwgaWYgbmVlZGVkIGluIG1vZHVsZQogICAgaWYgKCRIYXNEYXRlcGlja2VyKSB7CiAgICAgICAgbXkgJFZhY2F0aW9uRGF5cyAgICAgPSAkU2VsZi0+RGF0ZXBpY2tlckdldFZhY2F0aW9uRGF5cygpOwogICAgICAgIG15ICRWYWNhdGlvbkRheXNKU09OID0gJFNlbGYtPkpTT05FbmNvZGUoCiAgICAgICAgICAgIERhdGEgPT4gJFZhY2F0aW9uRGF5cywKICAgICAgICApOwoKICAgICAgICBteSAkVGV4dERpcmVjdGlvbiA9ICRTZWxmLT57TGFuZ3VhZ2VPYmplY3R9LT57VGV4dERpcmVjdGlvbn0gfHwgJyc7CgogICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnRGF0ZXBpY2tlckRhdGEnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIFZhY2F0aW9uRGF5cyAgPT4gJFZhY2F0aW9uRGF5c0pTT04sCiAgICAgICAgICAgICAgICBJc1JUTExhbmd1YWdlID0+ICggJFRleHREaXJlY3Rpb24gZXEgJ3J0bCcgKSA/IDEgOiAwLAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgIyBCYW5uZXIKICAgIGlmICggISRDb25maWdPYmplY3QtPkdldCgnU2VjdXJlOjpEaXNhYmxlQmFubmVyJykgKSB7CiAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdCYW5uZXInLAogICAgICAgICk7CiAgICB9CgogICAgIyBBdXRvQ29tcGxldGUtQ29uZmlnCiAgICBteSAkQXV0b2NvbXBsZXRlQ29uZmlnID0gJENvbmZpZ09iamVjdC0+R2V0KCdBdXRvQ29tcGxldGU6OkN1c3RvbWVyJyk7CgogICAgZm9yIG15ICRDb25maWdFbGVtZW50ICggc29ydCBrZXlzICV7JEF1dG9jb21wbGV0ZUNvbmZpZ30gKSB7CiAgICAgICAgJEF1dG9jb21wbGV0ZUNvbmZpZy0+eyRDb25maWdFbGVtZW50fS0+e0J1dHRvblRleHR9CiAgICAgICAgICAgID0gJFNlbGYtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSggJEF1dG9jb21wbGV0ZUNvbmZpZy0+eyRDb25maWdFbGVtZW50fXtCdXR0b25UZXh0fSApOwogICAgfQoKICAgIG15ICRBdXRvY29tcGxldGVDb25maWdKU09OID0gJFNlbGYtPkpTT05FbmNvZGUoCiAgICAgICAgRGF0YSA9PiAkQXV0b2NvbXBsZXRlQ29uZmlnLAogICAgKTsKCiAgICAkU2VsZi0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnQXV0b0NvbXBsZXRlQ29uZmlnJywKICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgQXV0b2NvbXBsZXRlQ29uZmlnID0+ICRBdXRvY29tcGxldGVDb25maWdKU09OLAogICAgICAgIH0sCiAgICApOwoKICAgICMgY3JlYXRlICYgcmV0dXJuIG91dHB1dAogICAgcmV0dXJuICRTZWxmLT5PdXRwdXQoCiAgICAgICAgVGVtcGxhdGVGaWxlID0+ICJDdXN0b21lckZvb3RlciRUeXBlIiwKICAgICAgICBEYXRhICAgICAgICAgPT4gXCVQYXJhbQogICAgKTsKfQoKc3ViIEN1c3RvbWVyRmF0YWxFcnJvciB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgUHJldmVudCBlbmRsZXNzIHJlY3Vyc2lvbiBpbiBjYXNlIG9mIHByb2JsZW1zIHdpdGggVGVtcGxhdGUgZW5naW5lLgogICAgcmV0dXJuIGlmICggJFNlbGYtPntJbkZhdGFsRXJyb3J9KysgKTsKCiAgICBpZiAoICRQYXJhbXtNZXNzYWdlfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgQ2FsbGVyICAgPT4gMSwKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJFBhcmFte01lc3NhZ2V9LAogICAgICAgICk7CiAgICB9CiAgICBteSAkT3V0cHV0ID0gJFNlbGYtPkN1c3RvbWVySGVhZGVyKAogICAgICAgIEFyZWEgID0+ICdGcm9udGVuZCcsCiAgICAgICAgVGl0bGUgPT4gJ0ZhdGFsIEVycm9yJwogICAgKTsKICAgICRPdXRwdXQgLj0gJFNlbGYtPkVycm9yKCVQYXJhbSk7CiAgICAkT3V0cHV0IC49ICRTZWxmLT5DdXN0b21lckZvb3RlcigpOwogICAgJFNlbGYtPlByaW50KCBPdXRwdXQgPT4gXCRPdXRwdXQgKTsKICAgIGV4aXQ7Cn0KCnN1YiBDdXN0b21lck5hdmlnYXRpb25CYXIgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICAjIGNyZWF0ZSBtZW51IGl0ZW1zCiAgICBteSAlTmF2QmFyTW9kdWxlOwogICAgbXkgJEZyb250ZW5kTW9kdWxlQ29uZmlnID0gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lckZyb250ZW5kOjpNb2R1bGUnKTsKCiAgICBNT0RVTEU6CiAgICBmb3IgbXkgJE1vZHVsZSAoIHNvcnQga2V5cyAleyRGcm9udGVuZE1vZHVsZUNvbmZpZ30gKSB7CiAgICAgICAgbXkgJUhhc2ggPSAleyAkRnJvbnRlbmRNb2R1bGVDb25maWctPnskTW9kdWxlfSB9OwogICAgICAgIG5leHQgTU9EVUxFIGlmICEkSGFzaHtOYXZCYXJ9OwogICAgICAgIG5leHQgTU9EVUxFIGlmIHJlZiAkSGFzaHtOYXZCYXJ9IG5lICdBUlJBWSc7CgogICAgICAgIG15IEBJdGVtcyA9IEB7ICRIYXNoe05hdkJhcn0gfTsKCiAgICAgICAgSVRFTToKICAgICAgICBmb3IgbXkgJEl0ZW0gKEBJdGVtcykgewogICAgICAgICAgICBuZXh0IElURU0gaWYgISRJdGVtOwoKICAgICAgICAgICAgIyBjaGVjayBwZXJtaXNzaW9ucwogICAgICAgICAgICBteSAkU2hvd24gPSAwOwoKICAgICAgICAgICAgIyBnZXQgcGVybWlzc2lvbnMgZnJvbSBtb2R1bGUgaWYgbm8gcGVybWlzc2lvbnMgYXJlIGRlZmluZWQgZm9yIHRoZSBpY29uCiAgICAgICAgICAgIGlmICggISRJdGVtLT57R3JvdXBSb30gJiYgISRJdGVtLT57R3JvdXB9ICkgewogICAgICAgICAgICAgICAgaWYgKCAkSGFzaHtHcm91cFJvfSApIHsKICAgICAgICAgICAgICAgICAgICAkSXRlbS0+e0dyb3VwUm99ID0gJEhhc2h7R3JvdXBSb307CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoICRIYXNoe0dyb3VwfSApIHsKICAgICAgICAgICAgICAgICAgICAkSXRlbS0+e0dyb3VwfSA9ICRIYXNoe0dyb3VwfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBjaGVjayBzaG93biBwZXJtaXNzaW9uCiAgICAgICAgICAgIFBFUk1JU1NJT046CiAgICAgICAgICAgIGZvciBteSAkUGVybWlzc2lvbiAocXcoR3JvdXBSbyBHcm91cCkpIHsKCiAgICAgICAgICAgICAgICAjIGFycmF5IGFjY2VzcyByZXN0cmljdGlvbgogICAgICAgICAgICAgICAgaWYgKCAkSXRlbS0+eyRQZXJtaXNzaW9ufSAmJiByZWYgJEl0ZW0tPnskUGVybWlzc2lvbn0gZXEgJ0FSUkFZJyApIHsKICAgICAgICAgICAgICAgICAgICBmb3IgbXkgJFR5cGUgKCBAeyAkSXRlbS0+eyRQZXJtaXNzaW9ufSB9ICkgewogICAgICAgICAgICAgICAgICAgICAgICBteSAkS2V5ID0gJ1VzZXJJcycgLiAkUGVybWlzc2lvbiAuICdbJyAuICRUeXBlIC4gJ10nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRTZWxmLT57JEtleX0gJiYgJFNlbGYtPnskS2V5fSBlcSAnWWVzJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRTaG93biA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0IFBFUk1JU1NJT047CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBzY2FsYXIgYWNjZXNzIHJlc3RyaWN0aW9uCiAgICAgICAgICAgICAgICBlbHNpZiAoICRJdGVtLT57JFBlcm1pc3Npb259ICkgewogICAgICAgICAgICAgICAgICAgIG15ICRLZXkgPSAnVXNlcklzJyAuICRQZXJtaXNzaW9uIC4gJ1snIC4gJEl0ZW0tPnskUGVybWlzc2lvbn0gLiAnXSc7CiAgICAgICAgICAgICAgICAgICAgaWYgKCAkU2VsZi0+eyRLZXl9ICYmICRTZWxmLT57JEtleX0gZXEgJ1llcycgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRTaG93biA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3QgUEVSTUlTU0lPTjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBubyBhY2Nlc3MgcmVzdHJpY3Rpb24KICAgICAgICAgICAgICAgIGVsc2lmICggISRJdGVtLT57R3JvdXBSb30gJiYgISRJdGVtLT57R3JvdXB9ICkgewogICAgICAgICAgICAgICAgICAgICRTaG93biA9IDE7CiAgICAgICAgICAgICAgICAgICAgbGFzdCBQRVJNSVNTSU9OOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIG5leHQgSVRFTSBpZiAhJFNob3duOwoKICAgICAgICAgICAgIyBzZXQgcHJpbyBvZiBpdGVtCiAgICAgICAgICAgIG15ICRLZXkgPSBzcHJpbnRmKCAiJTA3ZCIsICRJdGVtLT57UHJpb30gKTsKICAgICAgICAgICAgQ09VTlQ6CiAgICAgICAgICAgIGZvciAoIDEgLi4gNTEgKSB7CiAgICAgICAgICAgICAgICBsYXN0IENPVU5UIGlmICEkTmF2QmFyTW9kdWxleyRLZXl9OwoKICAgICAgICAgICAgICAgICRJdGVtLT57UHJpb30rKzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCAkSXRlbS0+e1R5cGV9IGVxICdNZW51JyApIHsKICAgICAgICAgICAgICAgICROYXZCYXJNb2R1bGV7IHNwcmludGYoICIlMDdkIiwgJEl0ZW0tPntQcmlvfSApIH0gPSAkSXRlbTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBzaG93IGFzIHN1YiBvZiBtYWluIG1lbnUKICAgICAgICAgICAgZWxzaWYgKCAkSXRlbS0+e1R5cGV9IGVxICdTdWJtZW51JyApIHsKICAgICAgICAgICAgICAgICROYXZCYXJNb2R1bGV7U3VifS0+eyAkSXRlbS0+e05hdkJhcn0gfS0+eyBzcHJpbnRmKCAiJTA3ZCIsICRJdGVtLT57UHJpb30gKSB9ID0gJEl0ZW07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkTmF2QmFyTW9kdWxleyBzcHJpbnRmKCAiJTA3ZCIsICRJdGVtLT57UHJpb30gKSB9ID0gJEl0ZW07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgbXkgJE1haW5PYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpOwoKICAgICMgcnVuIG1lbnUgaXRlbSBtb2R1bGVzCiAgICBpZiAoIHJlZiAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyRnJvbnRlbmQ6Ok5hdkJhck1vZHVsZScpIGVxICdIQVNIJyApIHsKICAgICAgICBteSAlSm9icyA9ICV7ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJGcm9udGVuZDo6TmF2QmFyTW9kdWxlJykgfTsKICAgICAgICBmb3IgbXkgJEpvYiAoIHNvcnQga2V5cyAlSm9icyApIHsKCiAgICAgICAgICAgICMgbG9hZCBtb2R1bGUKICAgICAgICAgICAgaWYgKCAhJE1haW5PYmplY3QtPlJlcXVpcmUoICRKb2JzeyRKb2J9LT57TW9kdWxlfSApICkgewogICAgICAgICAgICAgICAgJFNlbGYtPkZhdGFsRXJyb3IoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBteSAkT2JqZWN0ID0gJEpvYnN7JEpvYn0tPntNb2R1bGV9LT5uZXcoCiAgICAgICAgICAgICAgICAleyRTZWxmfSwKICAgICAgICAgICAgICAgIExheW91dE9iamVjdCA9PiAkU2VsZiwKICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICBEZWJ1ZyAgICAgICAgPT4gJFNlbGYtPntEZWJ1Z30sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAjIHJ1biBtb2R1bGUKICAgICAgICAgICAgJU5hdkJhck1vZHVsZSA9ICgKICAgICAgICAgICAgICAgICVOYXZCYXJNb2R1bGUsCiAgICAgICAgICAgICAgICAkT2JqZWN0LT5SdW4oCiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgICAgIENvbmZpZyAgICAgICA9PiAkSm9ic3skSm9ifSwKICAgICAgICAgICAgICAgICAgICBOYXZCYXJNb2R1bGUgPT4gXCVOYXZCYXJNb2R1bGUgfHwge30sCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICBteSAkVG90YWwgICA9IGtleXMgJU5hdkJhck1vZHVsZTsKICAgIG15ICRDb3VudGVyID0gMDsKCiAgICBpZiAoICROYXZCYXJNb2R1bGV7U3VifSApIHsKICAgICAgICAkVG90YWwgPSBpbnQoJFRvdGFsKSAtIDE7CiAgICB9CgogICAgIyBPbmx5IGhpZ2hsaWdodCB0aGUgZmlyc3QgbWF0Y2hlZCBuYXZpZ2F0aW9uIGVudHJ5LiBJZiB0aGVyZSBhcmUgc2V2ZXJhbCBlbnRyaWVzCiAgICAjICAgd2l0aCB0aGUgc2FtZSBBY3Rpb24gYW5kIFN1YmFjdGlvbiwgaXQgY2Fubm90IGJlIGRldGVybWluZWQgd2hpY2ggb25lIHdhcyB1c2VkLgogICAgIyAgIFRoZXJlZm9yZSB3ZSBqdXN0IGhpZ2hsaWdodCB0aGUgZmlyc3Qgb25lLgogICAgbXkgJFNlbGVjdGVkRmxhZzsKCiAgICBJVEVNOgogICAgZm9yIG15ICRJdGVtICggc29ydCBrZXlzICVOYXZCYXJNb2R1bGUgKSB7CiAgICAgICAgbmV4dCBJVEVNIGlmICEleyAkTmF2QmFyTW9kdWxleyRJdGVtfSB9OwogICAgICAgIG5leHQgSVRFTSBpZiAkSXRlbSBlcSAnU3ViJzsKICAgICAgICAkQ291bnRlcisrOwogICAgICAgIG15ICRTdWI7CiAgICAgICAgaWYgKCAkTmF2QmFyTW9kdWxleyRJdGVtfS0+e05hdkJhcn0gKSB7CiAgICAgICAgICAgICRTdWIgPSAkTmF2QmFyTW9kdWxle1N1Yn0tPnsgJE5hdkJhck1vZHVsZXskSXRlbX0tPntOYXZCYXJ9IH07CiAgICAgICAgfQoKICAgICAgICAjIGhpZ2hsaWdodCBhY3RpdmUgbGluawogICAgICAgICROYXZCYXJNb2R1bGV7JEl0ZW19LT57Q2xhc3N9ID0gJyc7CiAgICAgICAgaWYgKCAkTmF2QmFyTW9kdWxleyRJdGVtfS0+e0xpbmt9ICkgewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAhJFNlbGVjdGVkRmxhZwogICAgICAgICAgICAgICAgJiYgJE5hdkJhck1vZHVsZXskSXRlbX0tPntMaW5rfSA9fiAvQWN0aW9uPSRTZWxmLT57QWN0aW9ufS8KICAgICAgICAgICAgICAgICYmICROYXZCYXJNb2R1bGV7JEl0ZW19LT57TGlua30gPX4gLyRTZWxmLT57U3ViYWN0aW9ufS8gICAgIyBTdWJhY3Rpb24gY2FuIGJlIGVtcHR5CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICROYXZCYXJNb2R1bGV7JEl0ZW19LT57Q2xhc3N9IC49ICcgU2VsZWN0ZWQnOwogICAgICAgICAgICAgICAgJFNlbGVjdGVkRmxhZyA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCAkQ291bnRlciA9PSAkVG90YWwgKSB7CiAgICAgICAgICAgICROYXZCYXJNb2R1bGV7JEl0ZW19LT57Q2xhc3N9IC49ICcgTGFzdCc7CiAgICAgICAgfQogICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAkTmF2QmFyTW9kdWxleyRJdGVtfS0+e0Jsb2NrfSB8fCAnSXRlbScsCiAgICAgICAgICAgIERhdGEgPT4gJE5hdkJhck1vZHVsZXskSXRlbX0sCiAgICAgICAgKTsKCiAgICAgICAgIyBzaG93IHN1YiBtZW51CiAgICAgICAgbmV4dCBJVEVNIGlmICEkU3ViOwogICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnSXRlbUFyZWFTdWInLAogICAgICAgICAgICBEYXRhID0+ICRJdGVtLAogICAgICAgICk7CiAgICAgICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJXskU3VifSApIHsKICAgICAgICAgICAgbXkgJEl0ZW1TdWIgPSAkU3ViLT57JEtleX07CiAgICAgICAgICAgICRJdGVtU3ViLT57TmFtZUZvcklEfSA9ICRJdGVtU3ViLT57TmFtZX07CiAgICAgICAgICAgICRJdGVtU3ViLT57TmFtZUZvcklEfSA9fiBzL1sgJjtdLy9pZzsKICAgICAgICAgICAgJEl0ZW1TdWItPntOYW1lVG9wfSA9ICROYXZCYXJNb2R1bGV7JEl0ZW19LT57TmFtZUZvcklEfTsKCiAgICAgICAgICAgICMgY2hlY2sgaWYgd2UgbXVzdCBtYXJrIHRoZSBwYXJlbnQgZWxlbWVudCBhcyBzZWxlY3RlZAogICAgICAgICAgICBpZiAoICRJdGVtU3ViLT57TGlua30gKSB7CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgJEl0ZW1TdWItPntMaW5rfSA9fiAvQWN0aW9uPSRTZWxmLT57QWN0aW9ufS8KICAgICAgICAgICAgICAgICAgICAmJiAkSXRlbVN1Yi0+e0xpbmt9ID1+IC8kU2VsZi0+e1N1YmFjdGlvbn0vICAgICMgU3ViYWN0aW9uIGNhbiBiZSBlbXB0eQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkTmF2QmFyTW9kdWxleyRJdGVtfS0+e0NsYXNzfSAuPSAnIFNlbGVjdGVkJzsKICAgICAgICAgICAgICAgICAgICAkSXRlbVN1Yi0+e0NsYXNzfSAuPSAnIFN1YlNlbGVjdGVkJzsKICAgICAgICAgICAgICAgICAgICAkU2VsZWN0ZWRGbGFnID0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnSXRlbUFyZWFTdWJJdGVtJywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICUkSXRlbVN1YiwKICAgICAgICAgICAgICAgICAgICBBY2Nlc3NLZXlSZWZlcmVuY2UgPT4gJEl0ZW1TdWItPntBY2Nlc3NLZXl9ID8gIiAoJEl0ZW1TdWItPntBY2Nlc3NLZXl9KSIgOiAnJywKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgcnVuIG5vdGlmaWNhdGlvbiBtb2R1bGVzCiAgICBteSAkRnJvbnRlbmROb3RpZnlNb2R1bGVDb25maWcgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyRnJvbnRlbmQ6Ok5vdGlmeU1vZHVsZScpOwogICAgaWYgKCByZWYgJEZyb250ZW5kTm90aWZ5TW9kdWxlQ29uZmlnIGVxICdIQVNIJyApIHsKICAgICAgICBteSAlSm9icyA9ICV7JEZyb250ZW5kTm90aWZ5TW9kdWxlQ29uZmlnfTsKCiAgICAgICAgTk9USUZJQ0FUSU9OTU9EVUxFOgogICAgICAgIGZvciBteSAkSm9iICggc29ydCBrZXlzICVKb2JzICkgewoKICAgICAgICAgICAgIyBsb2FkIG1vZHVsZQogICAgICAgICAgICBuZXh0IE5PVElGSUNBVElPTk1PRFVMRSBpZiAhJE1haW5PYmplY3QtPlJlcXVpcmUoICRKb2JzeyRKb2J9LT57TW9kdWxlfSApOwogICAgICAgICAgICBteSAkT2JqZWN0ID0gJEpvYnN7JEpvYn0tPntNb2R1bGV9LT5uZXcoCiAgICAgICAgICAgICAgICAleyRTZWxmfSwKICAgICAgICAgICAgICAgIExheW91dE9iamVjdCA9PiAkU2VsZiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgbmV4dCBOT1RJRklDQVRJT05NT0RVTEUgaWYgISRPYmplY3Q7CgogICAgICAgICAgICAjIHJ1biBtb2R1bGUKICAgICAgICAgICAgJFBhcmFte05vdGlmaWNhdGlvbn0gLj0gJE9iamVjdC0+UnVuKCAlUGFyYW0sIENvbmZpZyA9PiAkSm9ic3skSm9ifSApOwogICAgICAgIH0KICAgIH0KCiAgICAjIGNyZWF0ZSB0aGUgY3VzdG9tZXIgdXNlciBsb2dpbiBpbmZvICh1c3VhbGx5IGF0IHRoZSByaWdodCBzaWRlIG9mIHRoZSBuYXZpZ2F0aW9uIGJhcikKICAgIGlmICggISRTZWxmLT57VXNlckxvZ2luSWRlbnRpZmllcn0gKSB7CiAgICAgICAgJFBhcmFte1VzZXJMb2dpbklkZW50aWZpZXJ9ID0gJFNlbGYtPntVc2VyRW1haWx9IG5lICRTZWxmLT57VXNlckN1c3RvbWVySUR9CiAgICAgICAgICAgID8KICAgICAgICAgICAgIiggJFNlbGYtPntVc2VyRW1haWx9IC8gJFNlbGYtPntVc2VyQ3VzdG9tZXJJRH0gKSIKICAgICAgICAgICAgOiAkU2VsZi0+e1VzZXJFbWFpbH07CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkUGFyYW17VXNlckxvZ2luSWRlbnRpZmllcn0gPSAkU2VsZi0+e1VzZXJMb2dpbklkZW50aWZpZXJ9OwogICAgfQoKICAgICMgb25seSBvbiB2YWxpZCBzZXNzaW9uCiAgICBpZiAoICRTZWxmLT57VXNlcklEfSApIHsKCiAgICAgICAgIyBzaG93IGxvZ291dCBidXR0b24gKGlmIHJlZ2lzdGVyZWQpCiAgICAgICAgaWYgKCAkRnJvbnRlbmRNb2R1bGVDb25maWctPntMb2dvdXR9ICkgewogICAgICAgICAgICAkU2VsZi0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdMb2dvdXQnLAogICAgICAgICAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBzaG93IHByZWZlcmVuY2VzIGJ1dHRvbiAoaWYgcmVnaXN0ZXJlZCkKICAgICAgICBpZiAoICRGcm9udGVuZE1vZHVsZUNvbmZpZy0+e0N1c3RvbWVyUHJlZmVyZW5jZXN9ICkgewogICAgICAgICAgICBpZiAoICRTZWxmLT57QWN0aW9ufSBlcSAnQ3VzdG9tZXJQcmVmZXJlbmNlcycgKSB7CiAgICAgICAgICAgICAgICAkUGFyYW17Q2xhc3N9ID0gJ1NlbGVjdGVkJzsKICAgICAgICAgICAgfQogICAgICAgICAgICAkU2VsZi0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdQcmVmZXJlbmNlcycsCiAgICAgICAgICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIHNob3cgb3BlbiBjaGF0IHJlcXVlc3RzIChpZiBjaGF0IGVuZ2luZSBpcyBhY3RpdmUpCiAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ0NoYXRFbmdpbmU6OkFjdGl2ZScpICkgewoKICAgICAgICAgICAgbXkgJENoYXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2hhdCcpOwogICAgICAgICAgICBteSAkQ2hhdHMgICAgICA9ICRDaGF0T2JqZWN0LT5DaGF0TGlzdCgKICAgICAgICAgICAgICAgIFN0YXR1cyAgICAgICAgPT4gJ3JlcXVlc3QnLAogICAgICAgICAgICAgICAgVGFyZ2V0VHlwZSAgICA9PiAnQ3VzdG9tZXInLAogICAgICAgICAgICAgICAgQ2hhdHRlcklEICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICBDaGF0dGVyVHlwZSAgID0+ICdDdXN0b21lcicsCiAgICAgICAgICAgICAgICBDaGF0dGVyQWN0aXZlID0+IDAsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBteSAkQ291bnQgPSBzY2FsYXIgJENoYXRzOwoKICAgICAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnQ2hhdFJlcXVlc3RzJywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgIENvdW50ID0+ICRDb3VudCwKICAgICAgICAgICAgICAgICAgICBDbGFzcyA9PiAoJENvdW50KSA/ICcnIDogJ0hpZGRlbicsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIGNyZWF0ZSAmIHJldHVybiBvdXRwdXQKICAgIHJldHVybiAkU2VsZi0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQ3VzdG9tZXJOYXZpZ2F0aW9uQmFyJywKICAgICAgICBEYXRhICAgICAgICAgPT4gXCVQYXJhbQogICAgKTsKfQoKc3ViIEN1c3RvbWVyRXJyb3IgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGdldCBiYWNrZW5kIGVycm9yIG1lc3NhZ2VzCiAgICBmb3IgKHF3KE1lc3NhZ2UgVHJhY2ViYWNrKSkgewogICAgICAgICRQYXJhbXsgJ0JhY2tlbmQnIC4gJF8gfSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+R2V0TG9nRW50cnkoCiAgICAgICAgICAgIFR5cGUgPT4gJ0Vycm9yJywKICAgICAgICAgICAgV2hhdCA9PiAkXwogICAgICAgICkgfHwgJyc7CiAgICB9CiAgICBpZiAoICEkUGFyYW17QmFja2VuZE1lc3NhZ2V9ICYmICEkUGFyYW17QmFja2VuZFRyYWNlYmFja30gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICRQYXJhbXtNZXNzYWdlfSB8fCAnPycsCiAgICAgICAgKTsKICAgICAgICBmb3IgKHF3KE1lc3NhZ2UgVHJhY2ViYWNrKSkgewogICAgICAgICAgICAkUGFyYW17ICdCYWNrZW5kJyAuICRfIH0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkdldExvZ0VudHJ5KAogICAgICAgICAgICAgICAgVHlwZSA9PiAnRXJyb3InLAogICAgICAgICAgICAgICAgV2hhdCA9PiAkXwogICAgICAgICAgICApIHx8ICcnOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoICEkUGFyYW17TWVzc2FnZX0gKSB7CiAgICAgICAgJFBhcmFte01lc3NhZ2V9ID0gJFBhcmFte0JhY2tlbmRNZXNzYWdlfTsKICAgIH0KCiAgICAjIGNyZWF0ZSAmIHJldHVybiBvdXRwdXQKICAgIHJldHVybiAkU2VsZi0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQ3VzdG9tZXJFcnJvcicsCiAgICAgICAgRGF0YSAgICAgICAgID0+IFwlUGFyYW0KICAgICk7Cn0KCnN1YiBDdXN0b21lckVycm9yU2NyZWVuIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJE91dHB1dCA9ICRTZWxmLT5DdXN0b21lckhlYWRlciggVGl0bGUgPT4gJ0Vycm9yJyApOwogICAgJE91dHB1dCAuPSAkU2VsZi0+Q3VzdG9tZXJFcnJvciglUGFyYW0pOwogICAgJE91dHB1dCAuPSAkU2VsZi0+Q3VzdG9tZXJGb290ZXIoKTsKICAgIHJldHVybiAkT3V0cHV0Owp9CgpzdWIgQ3VzdG9tZXJXYXJuaW5nIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgYmFja2VuZCBlcnJvciBtZXNzYWdlcwogICAgJFBhcmFte0JhY2tlbmRNZXNzYWdlfSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+R2V0TG9nRW50cnkoCiAgICAgICAgVHlwZSA9PiAnTm90aWNlJywKICAgICAgICBXaGF0ID0+ICdNZXNzYWdlJywKICAgICAgICApCiAgICAgICAgfHwgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5HZXRMb2dFbnRyeSgKICAgICAgICBUeXBlID0+ICdFcnJvcicsCiAgICAgICAgV2hhdCA9PiAnTWVzc2FnZScsCiAgICAgICAgKSB8fCAnJzsKCiAgICBpZiAoICEkUGFyYW17TWVzc2FnZX0gKSB7CiAgICAgICAgJFBhcmFte01lc3NhZ2V9ID0gJFBhcmFte0JhY2tlbmRNZXNzYWdlfTsKICAgIH0KCiAgICAjIGNyZWF0ZSAmIHJldHVybiBvdXRwdXQKICAgIHJldHVybiAkU2VsZi0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQ3VzdG9tZXJXYXJuaW5nJywKICAgICAgICBEYXRhICAgICAgICAgPT4gXCVQYXJhbQogICAgKTsKfQoKc3ViIEN1c3RvbWVyTm9QZXJtaXNzaW9uIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJFdpdGhIZWFkZXIgPSAkUGFyYW17V2l0aEhlYWRlcn0gfHwgJ3llcyc7CiAgICAkUGFyYW17TWVzc2FnZX0gfHw9IFRyYW5zbGF0YWJsZSgnTm8gUGVybWlzc2lvbiEnKTsKCiAgICAjIGNyZWF0ZSBvdXRwdXQKICAgIG15ICRPdXRwdXQ7CiAgICAkT3V0cHV0ID0gJFNlbGYtPkN1c3RvbWVySGVhZGVyKCBUaXRsZSA9PiBUcmFuc2xhdGFibGUoJ05vIFBlcm1pc3Npb24nKSApIGlmICggJFdpdGhIZWFkZXIgZXEgJ3llcycgKTsKICAgICRPdXRwdXQgLj0gJFNlbGYtPk91dHB1dCgKICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gJ05vUGVybWlzc2lvbicsCiAgICAgICAgRGF0YSAgICAgICAgID0+IFwlUGFyYW0KICAgICk7CiAgICAkT3V0cHV0IC49ICRTZWxmLT5DdXN0b21lckZvb3RlcigpIGlmICggJFdpdGhIZWFkZXIgZXEgJ3llcycgKTsKCiAgICAjIHJldHVybiBvdXRwdXQKICAgIHJldHVybiAkT3V0cHV0Owp9Cgo9aXRlbSBBc2NpaTJSaWNoVGV4dCgpCgpjb252ZXJ0cyB0ZXh0IHRvIHJpY2ggdGV4dAoKICAgIG15ICRIVE1MU3RyaW5nID0gJExheW91dE9iamVjdC0+QXNjaWkyUmljaFRleHQoCiAgICAgICAgU3RyaW5nID0+ICRUZXh0U3RyaW5nLAogICAgKTsKCj1jdXQKCnN1YiBBc2NpaTJSaWNoVGV4dCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgKHF3KFN0cmluZykpIHsKICAgICAgICBpZiAoICFkZWZpbmVkICRQYXJhbXskX30gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICRfISIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjIGFzY2lpIDIgaHRtbAogICAgJFBhcmFte1N0cmluZ30gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6SFRNTFV0aWxzJyktPlRvSFRNTCgKICAgICAgICBTdHJpbmcgPT4gJFBhcmFte1N0cmluZ30sCiAgICApOwoKICAgIHJldHVybiAkUGFyYW17U3RyaW5nfTsKfQoKPWl0ZW0gUmljaFRleHQyQXNjaWkoKQoKY29udmVydHMgdGV4dCB0byByaWNoIHRleHQKCiAgICBteSAkVGV4dFN0cmluZyA9ICRMYXlvdXRPYmplY3QtPlJpY2hUZXh0MkFzY2lpKAogICAgICAgIFN0cmluZyA9PiAkSFRNTFN0cmluZywKICAgICk7Cgo9Y3V0CgpzdWIgUmljaFRleHQyQXNjaWkgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgZm9yIChxdyhTdHJpbmcpKSB7CiAgICAgICAgaWYgKCAhZGVmaW5lZCAkUGFyYW17JF99ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkXyEiCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgIyBhc2NpaSAyIGh0bWwKICAgICRQYXJhbXtTdHJpbmd9ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkhUTUxVdGlscycpLT5Ub0FzY2lpKAogICAgICAgIFN0cmluZyA9PiAkUGFyYW17U3RyaW5nfSwKICAgICk7CgogICAgcmV0dXJuICRQYXJhbXtTdHJpbmd9Owp9Cgo9aXRlbSBSaWNoVGV4dERvY3VtZW50Q29tcGxldGUoKQoKMSkgYWRkIGh0bWwsIGJvZHksIC4uLiB0YWdzIHRvIGJlIGEgdmFsaWQgaHRtbCBkb2N1bWVudAoyKSByZXBsYWNlIGxpbmtzIG9mIGlubGluZSBjb250ZW50IGUuIGcuIGltYWdlcyB0byA8aW1nIHNyYz0iY2lkOnh4eHgiIC8+CgogICAgJEhUTUxCb2R5ID0gJExheW91dE9iamVjdC0+UmljaFRleHREb2N1bWVudENvbXBsZXRlKAogICAgICAgIFN0cmluZyA9PiAkSFRNTEJvZHksCiAgICApOwoKPWN1dAoKc3ViIFJpY2hUZXh0RG9jdW1lbnRDb21wbGV0ZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgKHF3KFN0cmluZykpIHsKICAgICAgICBpZiAoICFkZWZpbmVkICRQYXJhbXskX30gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICRfISIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjIHJlcGxhY2UgaW1hZ2UgbGluayB3aXRoIGNvbnRlbnQgaWQgZm9yIHVwbG9hZGVkIGltYWdlcwogICAgbXkgJFN0cmluZ1JlZiA9ICRTZWxmLT5fUmljaFRleHRSZXBsYWNlTGlua09mSW5saW5lQ29udGVudCgKICAgICAgICBTdHJpbmcgPT4gXCRQYXJhbXtTdHJpbmd9LAogICAgKTsKCiAgICAjIHZlcmlmeSBodG1sIGRvY3VtZW50CiAgICAkUGFyYW17U3RyaW5nfSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpIVE1MVXRpbHMnKS0+RG9jdW1lbnRDb21wbGV0ZSgKICAgICAgICBTdHJpbmcgID0+ICR7JFN0cmluZ1JlZn0sCiAgICAgICAgQ2hhcnNldCA9PiAkU2VsZi0+e1VzZXJDaGFyc2V0fSwKICAgICk7CgogICAgIyBkbyBjb3JyZWN0IGRpcmVjdGlvbgogICAgaWYgKCAkU2VsZi0+e1RleHREaXJlY3Rpb259ICkgewogICAgICAgICRQYXJhbXtTdHJpbmd9ID1+IHMvPGJvZHkvPGJvZHkgZGlyPSIkU2VsZi0+e1RleHREaXJlY3Rpb259Ii9pOwogICAgfQoKICAgICMgZmlsdGVyIGxpbmtzIGluIHJlc3BvbnNlCiAgICAkUGFyYW17U3RyaW5nfSA9ICRTZWxmLT5IVE1MTGlua1F1b3RlKCBTdHJpbmcgPT4gJFBhcmFte1N0cmluZ30gKTsKCiAgICByZXR1cm4gJFBhcmFte1N0cmluZ307Cn0KCj1iZWdpbiBJbnRlcm5hbDoKCj1jdXQKCj1pdGVtIF9SaWNoVGV4dFJlcGxhY2VMaW5rT2ZJbmxpbmVDb250ZW50KCkKCnJlcGxhY2UgbGlua3Mgb2YgaW5saW5lIGNvbnRlbnQgZS4gZy4gaW1hZ2VzCgogICAgJEhUTUxCb2R5U3RyaW5nUmVmID0gJExheW91dE9iamVjdC0+X1JpY2hUZXh0UmVwbGFjZUxpbmtPZklubGluZUNvbnRlbnQoCiAgICAgICAgU3RyaW5nID0+ICRIVE1MQm9keVN0cmluZ1JlZiwKICAgICk7Cgo9Y3V0CgpzdWIgX1JpY2hUZXh0UmVwbGFjZUxpbmtPZklubGluZUNvbnRlbnQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgZm9yIChxdyhTdHJpbmcpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyRffSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5lZWQgJF8hIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgcmVwbGFjZSBpbWFnZSBsaW5rIHdpdGggY29udGVudCBpZCBmb3IgdXBsb2FkZWQgaW1hZ2VzCiAgICAkeyAkUGFyYW17U3RyaW5nfSB9ID1+IHN7CiAgICAgICAgKDxpbWcuKz9zcmM9KCJ8JykpW14iJz5dKz9Db250ZW50SUQ9KC4rPykoInwnKShbXj5dKj4pCiAgICB9CiAgICB7CiAgICAgICAgbXkgKCRTdGFydCwgJENJRCwgJENsb3NlLCAkRW5kKSA9ICgkMSwgJDMsICQ0LCAkNSk7CiAgICAgICAgIyBNYWtlIHN1cmUgd2Ugb25seSBnZXQgdGhlIENJRCBhbmQgbm90IGV4dHJhIHN0dWZmIGxpa2Ugc2Vzc2lvbiBpbmZvcm1hdGlvbgogICAgICAgICRDSUQgPX4gc3teKFteOyZdKykuKn17JDF9c214OwogICAgICAgICRTdGFydCAuICdjaWQ6JyAuICRDSUQgLiAkQ2xvc2UgLiAkRW5kOwogICAgfWVzZ3hpOwoKICAgIHJldHVybiAkUGFyYW17U3RyaW5nfTsKfQoKPWVuZCBJbnRlcm5hbDoKCj1pdGVtIFJpY2hUZXh0RG9jdW1lbnRTZXJ2ZSgpCgpzZXJ2ZSBhIHJpY2ggdGV4dCAoSFRNTCkgZG9jdW1lbnQgZm9yIGxvY2FsIHZpZXcgaW5zaWRlIG9mIGFuIGlmcmFtZSBpbiBjb3JyZWN0IGNoYXJzZXQgYW5kIHdpdGggY29ycmVjdApsaW5rcyBmb3IgaW5saW5lIGRvY3VtZW50cy4KCkJ5IGRlZmF1bHQsIGFsbCBpbmxpbmUvYWN0aXZlIGNvbnRlbnQgKHN1Y2ggYXMgc2NyaXB0LCBvYmplY3QsIGFwcGxldCBvciBlbWJlZCB0YWdzKQp3aWxsIGJlIHN0cmlwcGVkLiBJZiB0aGVyZSBhcmUgZXh0ZXJuYWwgaW1hZ2VzLCB0aGV5IHdpbGwgYmUgc3RyaXBwZWQgdG9vLApidXQgYSBtZXNzYWdlIHdpbGwgYmUgc2hvd24gYWxsb3dpbmcgdGhlIHVzZXIgdG8gcmVsb2FkIHRoZSBwYWdlIHNob3dpbmcgdGhlIGV4dGVybmFsIGltYWdlcy4KCiAgICBteSAlSFRNTEZpbGUgPSAkTGF5b3V0T2JqZWN0LT5SaWNoVGV4dERvY3VtZW50U2VydmUoCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgIENvbnRlbnQgICAgID0+ICRIVE1MQm9keVJlZiwKICAgICAgICAgICAgQ29udGVudFR5cGUgPT4gJ3RleHQvaHRtbDsgY2hhcnNldD0iaXNvLTg4NTktMSInLAogICAgICAgIH0sCiAgICAgICAgVVJMICAgICAgICAgICAgICAgPT4gJ0FnZW50VGlja2V0QXR0YWNobWVudDtTdWJhY3Rpb249SFRNTFZpZXc7QXJ0aWNsZUlEPTEyMztGaWxlSUQ9JywKICAgICAgICBBdHRhY2htZW50cyAgICAgICA9PiBcJUF0dGFjaG1lbnRMaXN0T2ZJbmxpbmVBdHRhY2htZW50cywKCiAgICAgICAgTG9hZElubGluZUNvbnRlbnQgPT4gMCwgICAgICMgU2VydmUgdGhlIGRvY3VtZW50IGluY2x1ZGluZyBhbGwgaW5saW5lIGNvbnRlbnQuIFdBUk5JTkc6IFRoaXMgbWlnaHQgYmUgZGFuZ2Vyb3VzLgoKICAgICAgICBMb2FkRXh0ZXJuYWxJbWFnZXMgPT4gMCwgICAgIyBMb2FkIGV4dGVybmFsIGltYWdlcz8gSWYgdGhpcyBpcyAwLCBhIG1lc3NhZ2Ugd2lsbCBiZSBpbmNsdWRlZCBpZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGV4dGVybmFsIGltYWdlcyB3ZXJlIGZvdW5kIGFuZCByZW1vdmVkLgogICAgKTsKCj1jdXQKCnN1YiBSaWNoVGV4dERvY3VtZW50U2VydmUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgZm9yIChxdyhEYXRhIFVSTCBBdHRhY2htZW50cykpIHsKICAgICAgICBpZiAoICFkZWZpbmVkICRQYXJhbXskX30gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICRfISIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCBjaGFyc2V0IGFuZCBjb252ZXJ0IGNvbnRlbnQgdG8gaW50ZXJuYWwgY2hhcnNldAogICAgbXkgJENoYXJzZXQ7CiAgICBpZiAoICRQYXJhbXtEYXRhfS0+e0NvbnRlbnRUeXBlfSA9fiBtLy4rP2NoYXJzZXQ9KCJ8J3wpKC4rKS9pZyApIHsKICAgICAgICAkQ2hhcnNldCA9ICQyOwogICAgICAgICRDaGFyc2V0ID1+IHMvInwnLy9nOwogICAgfQogICAgaWYgKCAhJENoYXJzZXQgKSB7CiAgICAgICAgJENoYXJzZXQgPSAndXMtYXNjaWknOwogICAgICAgICRQYXJhbXtEYXRhfS0+e0NvbnRlbnRUeXBlfSAuPSAnOyBjaGFyc2V0PSJ1cy1hc2NpaSInOwogICAgfQoKICAgICMgY29udmVydCBjaGFyc2V0CiAgICBpZiAoJENoYXJzZXQpIHsKICAgICAgICAkUGFyYW17RGF0YX0tPntDb250ZW50fSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpFbmNvZGUnKS0+Q29udmVydCgKICAgICAgICAgICAgVGV4dCA9PiAkUGFyYW17RGF0YX0tPntDb250ZW50fSwKICAgICAgICAgICAgRnJvbSA9PiAkQ2hhcnNldCwKICAgICAgICAgICAgVG8gICA9PiAndXRmLTgnLAogICAgICAgICk7CgogICAgICAgICMgcmVwbGFjZSBjaGFyc2V0IGluIGNvbnRlbnQKICAgICAgICAkUGFyYW17RGF0YX0tPntDb250ZW50VHlwZX0gPX4gcy9cUSRDaGFyc2V0XEUvdXRmLTgvZ2k7CiAgICAgICAgJFBhcmFte0RhdGF9LT57Q29udGVudH0gPX4gcy8oPG1ldGFbXj5dK2NoYXJzZXQ9KCJ8J3wpKVxRJENoYXJzZXRcRS8kMXV0Zi04L2dpOwogICAgfQoKICAgICMgYWRkIGh0bWwgbGlua3MKICAgICRQYXJhbXtEYXRhfS0+e0NvbnRlbnR9ID0gJFNlbGYtPkhUTUxMaW5rUXVvdGUoCiAgICAgICAgU3RyaW5nID0+ICRQYXJhbXtEYXRhfS0+e0NvbnRlbnR9LAogICAgKTsKCiAgICAjIGNsZWFudXAgc29tZSBodG1sIHRhZ3MgdG8gYmUgY3Jvc3MgYnJvd3NlciBjb21wYXQuCiAgICAkUGFyYW17RGF0YX0tPntDb250ZW50fSA9ICRTZWxmLT5SaWNoVGV4dERvY3VtZW50Q2xlYW51cCgKICAgICAgICBTdHJpbmcgPT4gJFBhcmFte0RhdGF9LT57Q29udGVudH0sCiAgICApOwoKICAgICMgc2FmZXR5IGNoZWNrCiAgICBpZiAoICEkUGFyYW17TG9hZElubGluZUNvbnRlbnR9ICkgewoKICAgICAgICAjIFN0cmlwIG91dCBhY3RpdmUgY29udGVudCBmaXJzdCwga2VlcGluZyBleHRlcm5hbCBpbWFnZXMuCiAgICAgICAgbXkgJVNhZmV0eUNoZWNrUmVzdWx0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkhUTUxVdGlscycpLT5TYWZldHkoCiAgICAgICAgICAgIFN0cmluZyAgICAgICA9PiAkUGFyYW17RGF0YX0tPntDb250ZW50fSwKICAgICAgICAgICAgTm9BcHBsZXQgICAgID0+IDEsCiAgICAgICAgICAgIE5vT2JqZWN0ICAgICA9PiAxLAogICAgICAgICAgICBOb0VtYmVkICAgICAgPT4gMSwKICAgICAgICAgICAgTm9TVkcgICAgICAgID0+IDEsCiAgICAgICAgICAgIE5vSW50U3JjTG9hZCA9PiAwLAogICAgICAgICAgICBOb0V4dFNyY0xvYWQgPT4gMCwKICAgICAgICAgICAgTm9KYXZhU2NyaXB0ID0+IDEsCiAgICAgICAgICAgIERlYnVnICAgICAgICA9PiAkU2VsZi0+e0RlYnVnfSwKICAgICAgICApOwoKICAgICAgICAkUGFyYW17RGF0YX0tPntDb250ZW50fSA9ICRTYWZldHlDaGVja1Jlc3VsdHtTdHJpbmd9OwoKICAgICAgICBpZiAoICEkUGFyYW17TG9hZEV4dGVybmFsSW1hZ2VzfSApIHsKCiAgICAgICAgICAgICMgU3RyaXAgb3V0IGV4dGVybmFsIGltYWdlcywgYnV0IHNob3cgYSBjb25maXJtYXRpb24gYnV0dG9uIHRvCiAgICAgICAgICAgICMgICBsb2FkIHRoZW0gZXhwbGljaXRseS4KICAgICAgICAgICAgbXkgJVNhZmV0eUNoZWNrUmVzdWx0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkhUTUxVdGlscycpLT5TYWZldHkoCiAgICAgICAgICAgICAgICBTdHJpbmcgICAgICAgPT4gJFBhcmFte0RhdGF9LT57Q29udGVudH0sCiAgICAgICAgICAgICAgICBOb0FwcGxldCAgICAgPT4gMSwKICAgICAgICAgICAgICAgIE5vT2JqZWN0ICAgICA9PiAxLAogICAgICAgICAgICAgICAgTm9FbWJlZCAgICAgID0+IDEsCiAgICAgICAgICAgICAgICBOb1NWRyAgICAgICAgPT4gMSwKICAgICAgICAgICAgICAgIE5vSW50U3JjTG9hZCA9PiAwLAogICAgICAgICAgICAgICAgTm9FeHRTcmNMb2FkID0+IDEsCiAgICAgICAgICAgICAgICBOb0phdmFTY3JpcHQgPT4gMSwKICAgICAgICAgICAgICAgIERlYnVnICAgICAgICA9PiAkU2VsZi0+e0RlYnVnfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICRQYXJhbXtEYXRhfS0+e0NvbnRlbnR9ID0gJFNhZmV0eUNoZWNrUmVzdWx0e1N0cmluZ307CgogICAgICAgICAgICBpZiAoICRTYWZldHlDaGVja1Jlc3VsdHtSZXBsYWNlfSApIHsKCiAgICAgICAgICAgICAgICAjIEdlbmVyYXRlIGJsb2NrZXIgbWVzc2FnZS4KICAgICAgICAgICAgICAgIG15ICRNZXNzYWdlID0gJFNlbGYtPk91dHB1dCggVGVtcGxhdGVGaWxlID0+ICdBdHRhY2htZW50QmxvY2tlcicgKTsKCiAgICAgICAgICAgICAgICAjIEFkZCBpdCB0byB0aGUgYmVnaW5uaW5nIG9mIHRoZSBib2R5LCBpZiBwb3NzaWJsZSwgb3RoZXJ3aXNlIHByZXBlbmQgaXQuCiAgICAgICAgICAgICAgICBpZiAoICRQYXJhbXtEYXRhfS0+e0NvbnRlbnR9ID1+IC88Ym9keS4qPz4vc2kgKSB7CiAgICAgICAgICAgICAgICAgICAgJFBhcmFte0RhdGF9LT57Q29udGVudH0gPX4gcy8oPGJvZHkuKj8+KS8kMVxuJE1lc3NhZ2Uvc2k7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkUGFyYW17RGF0YX0tPntDb250ZW50fSA9ICRNZXNzYWdlIC4gJFBhcmFte0RhdGF9LT57Q29udGVudH07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgfQogICAgfQoKICAgICMgYnVpbGQgYmFzZSB1cmwgZm9yIGlubGluZSBpbWFnZXMKICAgIG15ICRTZXNzaW9uSUQgPSAnJzsKICAgIGlmICggJFNlbGYtPntTZXNzaW9uSUR9ICYmICEkU2VsZi0+e1Nlc3Npb25JRENvb2tpZX0gKSB7CiAgICAgICAgJFNlc3Npb25JRCA9ICc7JyAuICRTZWxmLT57U2Vzc2lvbk5hbWV9IC4gJz0nIC4gJFNlbGYtPntTZXNzaW9uSUR9OwogICAgfQoKICAgICMgcmVwbGFjZSBpbmxpbmUgaW1hZ2VzIGluIGNvbnRlbnQgd2l0aCBydW50aW1lIHVybCB0byBpbWFnZXMKICAgIG15ICRBdHRhY2htZW50TGluayA9ICRTZWxmLT57QmFzZWxpbmt9IC4gJFBhcmFte1VSTH07CiAgICAkUGFyYW17RGF0YX0tPntDb250ZW50fSA9fiBzewogICAgICAgICg9fCJ8JyljaWQ6KC4qPykoInwnfD58XC8+fFxzKQogICAgfQogICAgewogICAgICAgIG15ICRTdGFydD0gJDE7CiAgICAgICAgbXkgJENvbnRlbnRJRCA9ICQyOwogICAgICAgIG15ICRFbmQgPSAkMzsKCiAgICAgICAgIyBpbXByb3ZlIGh0bWwgcXVhbGl0eQogICAgICAgIGlmICggJFN0YXJ0IG5lICciJyAmJiAkU3RhcnQgbmUgJ1wnJyApIHsKICAgICAgICAgICAgJFN0YXJ0IC49ICciJzsKICAgICAgICB9CiAgICAgICAgaWYgKCAkRW5kIG5lICciJyAmJiAkRW5kIG5lICdcJycgKSB7CiAgICAgICAgICAgICRFbmQgPSAnIicgLiAkRW5kOwogICAgICAgIH0KCiAgICAgICAgIyBmaW5kIG1hdGNoaW5nIGF0dGFjaG1lbnQgYW5kIHJlcGxhY2UgaXQgd2l0aCBydW50aW1lIHVybCB0byBpbWFnZQogICAgICAgIEFUVEFDSE1FTlRfSUQ6CiAgICAgICAgZm9yIG15ICRBdHRhY2htZW50SUQgKCAgc29ydCBrZXlzICV7ICRQYXJhbXtBdHRhY2htZW50c30gfSkgewogICAgICAgICAgICBuZXh0IEFUVEFDSE1FTlRfSUQgaWYgbGMgJFBhcmFte0F0dGFjaG1lbnRzfS0+eyRBdHRhY2htZW50SUR9LT57Q29udGVudElEfSBuZSBsYyAiPCRDb250ZW50SUQ+IjsKICAgICAgICAgICAgJENvbnRlbnRJRCA9ICRBdHRhY2htZW50TGluayAuICRBdHRhY2htZW50SUQgLiAkU2Vzc2lvbklEOwogICAgICAgICAgICBsYXN0IEFUVEFDSE1FTlRfSUQ7CiAgICAgICAgfQoKICAgICAgICAjIHJldHVybiBuZXcgcnVudGltZSB1cmwKICAgICAgICAkU3RhcnQgLiAkQ29udGVudElEIC4gJEVuZDsKICAgIH1lZ3hpOwoKICAgICMgYnVnICM1MDUzCiAgICAjIGlubGluZSBpbWFnZXMgdXNpbmcgQ29udGVudC1Mb2NhdGlvbiBhcyBpZGVudGlmaWVyIGluc3RlYWQgb2YgQ29udGVudC1JRCBldmVuIFJGQzI1NTcKICAgICMgaHR0cDovL3d3dy5pZXRmLm9yZy9yZmMvcmZjMjU1Ny50eHQKCiAgICAjIGZpbmQgbWF0Y2hpbmcgYXR0YWNobWVudCBhbmQgcmVwbGFjZSBpdCB3aXRoIHJ1bnRsaW1lIHVybCB0byBpbWFnZQogICAgQVRUQUNITUVOVDoKICAgIGZvciBteSAkQXR0YWNobWVudElEICggc29ydCBrZXlzICV7ICRQYXJhbXtBdHRhY2htZW50c30gfSApIHsKICAgICAgICBuZXh0IEFUVEFDSE1FTlQgaWYgISRQYXJhbXtBdHRhY2htZW50c30tPnskQXR0YWNobWVudElEfS0+e0NvbnRlbnRJRH07CgogICAgICAgICMgY29udGVudCBpZCBjbGVhbnVwCiAgICAgICAgJFBhcmFte0F0dGFjaG1lbnRzfS0+eyRBdHRhY2htZW50SUR9LT57Q29udGVudElEfSA9fiBzL148Ly87CiAgICAgICAgJFBhcmFte0F0dGFjaG1lbnRzfS0+eyRBdHRhY2htZW50SUR9LT57Q29udGVudElEfSA9fiBzLz4kLy87CgogICAgICAgIG5leHQgQVRUQUNITUVOVCBpZiAhJFBhcmFte0F0dGFjaG1lbnRzfS0+eyRBdHRhY2htZW50SUR9LT57Q29udGVudElEfTsKCiAgICAgICAgJFBhcmFte0RhdGF9LT57Q29udGVudH0gPX4gc3sKICAgICAgICAoPXwifCcpKFxRJFBhcmFte0F0dGFjaG1lbnRzfS0+eyRBdHRhY2htZW50SUR9LT57Q29udGVudElEfVxFKSgifCd8PnxcLz58XHMpCiAgICB9CiAgICB7CiAgICAgICAgbXkgJFN0YXJ0PSAkMTsKICAgICAgICBteSAkQ29udGVudElEID0gJDI7CiAgICAgICAgbXkgJEVuZCA9ICQzOwoKICAgICAgICAjIGltcHJvdmUgaHRtbCBxdWFsaXR5CiAgICAgICAgaWYgKCAkU3RhcnQgbmUgJyInICYmICRTdGFydCBuZSAnXCcnICkgewogICAgICAgICAgICAkU3RhcnQgLj0gJyInOwogICAgICAgIH0KICAgICAgICBpZiAoICRFbmQgbmUgJyInICYmICRFbmQgbmUgJ1wnJyApIHsKICAgICAgICAgICAgJEVuZCA9ICciJyAuICRFbmQ7CiAgICAgICAgfQoKICAgICAgICAjIHJldHVybiBuZXcgcnVudGltZSB1cmwKICAgICAgICAkQ29udGVudElEID0gJEF0dGFjaG1lbnRMaW5rIC4gJEF0dGFjaG1lbnRJRCAuICRTZXNzaW9uSUQ7CiAgICAgICAgJFN0YXJ0IC4gJENvbnRlbnRJRCAuICRFbmQ7CiAgICB9ZWd4aTsKICAgIH0KCiAgICByZXR1cm4gJXsgJFBhcmFte0RhdGF9IH07Cn0KCj1pdGVtIFJpY2hUZXh0RG9jdW1lbnRDbGVhbnVwKCkKCnBsZWFzZSBzZWUgTDxLZXJuZWw6OlN5c3RlbTo6SFRNTDo6TGF5b3V0OjpEb2N1bWVudENsZWFudXAoKT4KCj1jdXQKCnN1YiBSaWNoVGV4dERvY3VtZW50Q2xlYW51cCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgKHF3KFN0cmluZykpIHsKICAgICAgICBpZiAoICFkZWZpbmVkICRQYXJhbXskX30gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICRfISIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAkUGFyYW17U3RyaW5nfSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpIVE1MVXRpbHMnKS0+RG9jdW1lbnRDbGVhbnVwKAogICAgICAgIFN0cmluZyA9PiAkUGFyYW17U3RyaW5nfSwKICAgICk7CgogICAgcmV0dXJuICRQYXJhbXtTdHJpbmd9Owp9Cgo9YmVnaW4gSW50ZXJuYWw6Cgo9Y3V0Cgo9aXRlbSBfQnVpbGRTZWxlY3Rpb25PcHRpb25SZWZDcmVhdGUoKQoKY3JlYXRlIHRoZSBvcHRpb24gaGFzaAoKICAgIG15ICRPcHRpb25SZWYgPSAkTGF5b3V0T2JqZWN0LT5fQnVpbGRTZWxlY3Rpb25PcHRpb25SZWZDcmVhdGUoCiAgICAgICAgJVBhcmFtLAogICAgKTsKCiAgICBteSAkT3B0aW9uUmVmID0gewogICAgICAgIFNvcnQgICAgICAgICA9PiAnbnVtZXJpYycsCiAgICAgICAgUG9zc2libGVOb25lID0+IDAsCiAgICAgICAgTWF4ICAgICAgICAgID0+IDEwMCwKICAgIH0KCj1jdXQKCnN1YiBfQnVpbGRTZWxlY3Rpb25PcHRpb25SZWZDcmVhdGUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIHNldCBTZWxlY3RlZElEIG9wdGlvbgogICAgbXkgJE9wdGlvblJlZiA9IHt9OwogICAgaWYgKCBkZWZpbmVkICRQYXJhbXtTZWxlY3RlZElEfSApIHsKICAgICAgICBpZiAoIHJlZiAkUGFyYW17U2VsZWN0ZWRJRH0gZXEgJ0FSUkFZJyApIHsKICAgICAgICAgICAgZm9yIG15ICRLZXkgKCBAeyAkUGFyYW17U2VsZWN0ZWRJRH0gfSApIHsKICAgICAgICAgICAgICAgICRPcHRpb25SZWYtPntTZWxlY3RlZElEfS0+eyRLZXl9ID0gMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJE9wdGlvblJlZi0+e1NlbGVjdGVkSUR9LT57ICRQYXJhbXtTZWxlY3RlZElEfSB9ID0gMTsKICAgICAgICB9CiAgICB9CgogICAgIyBzZXQgU2VsZWN0ZWRWYWx1ZSBvcHRpb24KICAgIGlmICggZGVmaW5lZCAkUGFyYW17U2VsZWN0ZWRWYWx1ZX0gKSB7CiAgICAgICAgaWYgKCByZWYgJFBhcmFte1NlbGVjdGVkVmFsdWV9IGVxICdBUlJBWScgKSB7CiAgICAgICAgICAgIGZvciBteSAkVmFsdWUgKCBAeyAkUGFyYW17U2VsZWN0ZWRWYWx1ZX0gfSApIHsKICAgICAgICAgICAgICAgICRPcHRpb25SZWYtPntTZWxlY3RlZFZhbHVlfS0+eyRWYWx1ZX0gPSAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkT3B0aW9uUmVmLT57U2VsZWN0ZWRWYWx1ZX0tPnsgJFBhcmFte1NlbGVjdGVkVmFsdWV9IH0gPSAxOwogICAgICAgIH0KICAgIH0KCiAgICAjIHNldCBTb3J0IG9wdGlvbgogICAgJE9wdGlvblJlZi0+e1NvcnR9ID0gMDsKICAgIGlmICggJFBhcmFte1NvcnR9ICkgewogICAgICAgICRPcHRpb25SZWYtPntTb3J0fSA9ICRQYXJhbXtTb3J0fTsKICAgIH0KCiAgICAjIGxvb2sgaWYgYSBpbmRpdmlkdWFsIHNvcnQgaXMgYXZhaWxhYmxlCiAgICBpZiAoICRQYXJhbXtTb3J0SW5kaXZpZHVhbH0gJiYgcmVmICRQYXJhbXtTb3J0SW5kaXZpZHVhbH0gZXEgJ0FSUkFZJyApIHsKICAgICAgICAkT3B0aW9uUmVmLT57U29ydEluZGl2aWR1YWx9ID0gJFBhcmFte1NvcnRJbmRpdmlkdWFsfTsKICAgIH0KCiAgICAjIHNldCBTb3J0UmV2ZXJzZSBvcHRpb24KICAgICRPcHRpb25SZWYtPntTb3J0UmV2ZXJzZX0gPSAwOwogICAgaWYgKCAkUGFyYW17U29ydFJldmVyc2V9ICkgewogICAgICAgICRPcHRpb25SZWYtPntTb3J0UmV2ZXJzZX0gPSAxOwogICAgfQoKICAgICMgc2V0IFRyYW5zbGF0aW9uIG9wdGlvbgogICAgJE9wdGlvblJlZi0+e1RyYW5zbGF0aW9ufSA9IDE7CiAgICBpZiAoIGRlZmluZWQgJFBhcmFte1RyYW5zbGF0aW9ufSAmJiAkUGFyYW17VHJhbnNsYXRpb259IGVxIDAgKSB7CiAgICAgICAgJE9wdGlvblJlZi0+e1RyYW5zbGF0aW9ufSA9IDA7CiAgICB9CgogICAgIyBjb3JyZWN0aW5nIHNlbGVjdGVkIHZhbHVlIGhhc2ggaWYgdHJhbnNsYXRpb24gaXMgb24KICAgIGlmICgKICAgICAgICAkT3B0aW9uUmVmLT57VHJhbnNsYXRpb259CiAgICAgICAgJiYgJE9wdGlvblJlZi0+e1NlbGVjdGVkVmFsdWV9CiAgICAgICAgJiYgcmVmICRPcHRpb25SZWYtPntTZWxlY3RlZFZhbHVlfSBlcSAnSEFTSCcKICAgICAgICApCiAgICB7CiAgICAgICAgbXkgJVNlbGVjdGVkVmFsdWVOZXc7CiAgICAgICAgZm9yIG15ICRPcmlnaW5hbEtleSAoIHNvcnQga2V5cyAleyAkT3B0aW9uUmVmLT57U2VsZWN0ZWRWYWx1ZX0gfSApIHsKICAgICAgICAgICAgbXkgJFRyYW5zbGF0ZWRLZXkgPSAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCRPcmlnaW5hbEtleSk7CiAgICAgICAgICAgICRTZWxlY3RlZFZhbHVlTmV3eyRUcmFuc2xhdGVkS2V5fSA9IDE7CiAgICAgICAgfQogICAgICAgICRPcHRpb25SZWYtPntTZWxlY3RlZFZhbHVlfSA9IFwlU2VsZWN0ZWRWYWx1ZU5ldzsKICAgIH0KCiAgICAjIHNldCBQb3NzaWJsZU5vbmUgb3B0aW9uCiAgICAkT3B0aW9uUmVmLT57UG9zc2libGVOb25lfSA9IDA7CiAgICBpZiAoICRQYXJhbXtQb3NzaWJsZU5vbmV9ICkgewogICAgICAgICRPcHRpb25SZWYtPntQb3NzaWJsZU5vbmV9ID0gMTsKICAgIH0KCiAgICAjIHNldCBUcmVlVmlldyBvcHRpb24KICAgICRPcHRpb25SZWYtPntUcmVlVmlld30gPSAwOwogICAgaWYgKCAkUGFyYW17VHJlZVZpZXd9ICkgewogICAgICAgICRPcHRpb25SZWYtPntUcmVlVmlld30gPSAxOwogICAgICAgICRPcHRpb25SZWYtPntTb3J0fSAgICAgPSAnVHJlZVZpZXcnOwogICAgfQoKICAgICMgc2V0IERpc2FibGVkQnJhbmNoIG9wdGlvbgogICAgaWYgKCAkUGFyYW17RGlzYWJsZWRCcmFuY2h9ICkgewogICAgICAgIGlmICggcmVmICRQYXJhbXtEaXNhYmxlZEJyYW5jaH0gZXEgJ0FSUkFZJyApIHsKICAgICAgICAgICAgZm9yIG15ICRCcmFuY2ggKCBAeyAkUGFyYW17RGlzYWJsZWRCcmFuY2h9IH0gKSB7CiAgICAgICAgICAgICAgICAkT3B0aW9uUmVmLT57RGlzYWJsZWRCcmFuY2h9LT57JEJyYW5jaH0gPSAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkT3B0aW9uUmVmLT57RGlzYWJsZWRCcmFuY2h9LT57ICRQYXJhbXtEaXNhYmxlZEJyYW5jaH0gfSA9IDE7CiAgICAgICAgfQogICAgfQoKICAgICMgc2V0IE1heCBvcHRpb24KICAgICRPcHRpb25SZWYtPntNYXh9ID0gJFBhcmFte01heH0gfHwgMTAwOwoKICAgICMgc2V0IEhUTUxRdW90ZSBvcHRpb24KICAgICRPcHRpb25SZWYtPntIVE1MUXVvdGV9ID0gMTsKICAgIGlmICggZGVmaW5lZCAkUGFyYW17SFRNTFF1b3RlfSApIHsKICAgICAgICAkT3B0aW9uUmVmLT57SFRNTFF1b3RlfSA9ICRQYXJhbXtIVE1MUXVvdGV9OwogICAgfQoKICAgIHJldHVybiAkT3B0aW9uUmVmOwp9Cgo9aXRlbSBfQnVpbGRTZWxlY3Rpb25BdHRyaWJ1dGVSZWZDcmVhdGUoKQoKY3JlYXRlIHRoZSBhdHRyaWJ1dGUgaGFzaAoKICAgIG15ICRBdHRyaWJ1dGVSZWYgPSAkTGF5b3V0T2JqZWN0LT5fQnVpbGRTZWxlY3Rpb25BdHRyaWJ1dGVSZWZDcmVhdGUoCiAgICAgICAgJVBhcmFtLAogICAgKTsKCiAgICBteSAkQXR0cmlidXRlUmVmID0gewogICAgICAgIG5hbWUgICAgID0+ICdUaGVOYW1lJywKICAgICAgICBtdWx0aXBsZSA9PiB1bmRlZiwKICAgICAgICBzaXplICAgICA9PiA1LAogICAgfQoKPWN1dAoKc3ViIF9CdWlsZFNlbGVjdGlvbkF0dHJpYnV0ZVJlZkNyZWF0ZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRBdHRyaWJ1dGVSZWYgPSB7fTsKCiAgICAjIGNoZWNrIHBhcmFtcyB3aXRoIGtleSBhbmQgdmFsdWUKICAgIGZvciAocXcoTmFtZSBJRCBTaXplIENsYXNzIE9uQ2hhbmdlIE9uQ2xpY2sgQXV0b0NvbXBsZXRlKSkgewogICAgICAgIGlmICggJFBhcmFteyRffSApIHsKICAgICAgICAgICAgJEF0dHJpYnV0ZVJlZi0+eyBsYygkXykgfSA9ICRQYXJhbXskX307CiAgICAgICAgfQogICAgfQoKICAgICMgYWRkIGlkIGF0dHJpdWJ1dAogICAgaWYgKCAhJEF0dHJpYnV0ZVJlZi0+e2lkfSApIHsKICAgICAgICAkQXR0cmlidXRlUmVmLT57aWR9ID0gJEF0dHJpYnV0ZVJlZi0+e25hbWV9OwogICAgfQoKICAgICMgY2hlY2sgcGFyYW1zIHdpdGgga2V5IGFuZCB2YWx1ZSB0aGF0IG5lZWQgdG8gYmUgSFRNTC1RdW90ZWQKICAgIGZvciAocXcoVGl0bGUpKSB7CiAgICAgICAgaWYgKCAkUGFyYW17JF99ICkgewogICAgICAgICAgICAkQXR0cmlidXRlUmVmLT57IGxjKCRfKSB9ID0gJFNlbGYtPkFzY2lpMkh0bWwoIFRleHQgPT4gJFBhcmFteyRffSApOwogICAgICAgIH0KICAgIH0KCiAgICAjIGNoZWNrIEhUTUwgcGFyYW1zCiAgICBmb3IgKHF3KE11bHRpcGxlIERpc2FibGVkKSkgewogICAgICAgIGlmICggJFBhcmFteyRffSApIHsKICAgICAgICAgICAgJEF0dHJpYnV0ZVJlZi0+eyBsYygkXykgfSA9IGxjKCRfKTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuICRBdHRyaWJ1dGVSZWY7Cn0KCj1pdGVtIF9CdWlsZFNlbGVjdGlvbkRhdGFSZWZDcmVhdGUoKQoKY3JlYXRlIHRoZSBkYXRhIGhhc2gKCiAgICBteSAkRGF0YVJlZiA9ICRMYXlvdXRPYmplY3QtPl9CdWlsZFNlbGVjdGlvbkRhdGFSZWZDcmVhdGUoCiAgICAgICAgRGF0YSA9PiAkQXJyYXlSZWYsICAgICAgICAgICAgICAjIHVzZSAkSGFzaFJlZiwgJEFycmF5UmVmIG9yICRBcnJheUhhc2hSZWYKICAgICAgICBBdHRyaWJ1dGVSZWYgPT4gJEF0dHJpYnV0ZVJlZiwKICAgICAgICBPcHRpb25SZWYgPT4gJE9wdGlvblJlZiwKICAgICk7CgogICAgbXkgJERhdGFSZWYgID0gWwogICAgICAgIHsKICAgICAgICAgICAgS2V5ID0+IDExLAogICAgICAgICAgICBWYWx1ZSA9PiAnVGV4dCcsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIEtleSA9PiAnYWJjJywKICAgICAgICAgICAgVmFsdWUgPT4gJyZuYnNwOyZuYnNwO1RleHQnLAogICAgICAgICAgICBTZWxlY3RlZCA9PiAxLAogICAgICAgIH0sCiAgICBdOwoKPWN1dAoKc3ViIF9CdWlsZFNlbGVjdGlvbkRhdGFSZWZDcmVhdGUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkQXR0cmlidXRlUmVmID0gJFBhcmFte0F0dHJpYnV0ZVJlZn07CiAgICBteSAkT3B0aW9uUmVmICAgID0gJFBhcmFte09wdGlvblJlZn07CiAgICBteSAkRGF0YVJlZiAgICAgID0gW107CgogICAgbXkgJENvdW50ZXIgPSAwOwoKICAgICMgZm9yIEhhc2hSZWYgYW5kIEFycmF5UmVmIG9ubHkKICAgIG15ICVEaXNhYmxlZEVsZW1lbnRzOwoKICAgICMgZGNsb25lICRQYXJhbXtEYXRhfSBiZWNhdXNlIHRoZSBzdWJyb3V0aW5lIHVuZm9ydHVuYXRlbHkgbW9kaWZpZXMKICAgICMgdGhlIG9yaWdpbmFsIGRhdGEgcmVmCiAgICBteSAkRGF0YUxvY2FsID0gU3RvcmFibGU6OmRjbG9uZSggJFBhcmFte0RhdGF9ICk7CgogICAgIyBpZiBIYXNoUmVmIHdhcyBnaXZlbgogICAgaWYgKCByZWYgJERhdGFMb2NhbCBlcSAnSEFTSCcgKSB7CgogICAgICAgICMgZ2V0IG1pc3NpbmcgcGFyZW50cyBhbmQgbWFyayB0aGVtIGZvciBkaXNhYmxlIGxhdGVyCiAgICAgICAgaWYgKCAkT3B0aW9uUmVmLT57U29ydH0gZXEgJ1RyZWVWaWV3JyApIHsKICAgICAgICAgICAgbXkgJUxpc3QgPSByZXZlcnNlICV7JERhdGFMb2NhbH07CgogICAgICAgICAgICAjIGdldCBlYWNoIGRhdGEgdmFsdWUKICAgICAgICAgICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJUxpc3QgKSB7CiAgICAgICAgICAgICAgICBteSAkUGFyZW50cyA9ICcnOwoKICAgICAgICAgICAgICAgICMgdHJ5IHRvIHNwbGl0IGl0cyBwYXJlbnRzIChlLmcuIFF1ZXVlIG9yIFNlcnZpY2UpIEdyYW5kUGFyZW50OjpQYXJlbnQ6OlNvbgogICAgICAgICAgICAgICAgbXkgQEVsZW1lbnRzID0gc3BsaXQgLzo6LywgJEtleTsKCiAgICAgICAgICAgICAgICAjIGdldCBlYWNoIGVsZW1lbnQgaW4gdGhlIGhpZXJhcmNoeQogICAgICAgICAgICAgICAgZm9yIG15ICRFbGVtZW50IChARWxlbWVudHMpIHsKCiAgICAgICAgICAgICAgICAgICAgIyBhZGQgaXRzIG93biBwYXJlbnRzIGZvciB0aGUgY29tcGxldGUgbmFtZQogICAgICAgICAgICAgICAgICAgIG15ICRFbGVtZW50TG9uZ05hbWUgPSAkUGFyZW50cyAuICRFbGVtZW50OwoKICAgICAgICAgICAgICAgICAgICAjIGNoZWNrIGlmIGVsZW1lbnQgZXhpc3RzIGluIHRoZSBvcmlnaW5hbCBkYXRhIG9yIGlmIGl0IGlzIGFscmVhZHkgbWFya2VkCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhJExpc3R7JEVsZW1lbnRMb25nTmFtZX0gJiYgISREaXNhYmxlZEVsZW1lbnRzeyRFbGVtZW50TG9uZ05hbWV9ICkgewoKICAgICAgICAgICAgICAgICAgICAgICAgIyBtYXJrIGVsZW1lbnQgYXMgZGlzYWJsZWQKICAgICAgICAgICAgICAgICAgICAgICAgJERpc2FibGVkRWxlbWVudHN7JEVsZW1lbnRMb25nTmFtZX0gPSAxOwoKICAgICAgICAgICAgICAgICAgICAgICAgIyBhZGQgdGhlIGVsZW1lbnQgdG8gdGhlIG9yaWdpbmFsIGRhdGEgdG8gYmUgZGlzYWJsZWQgbGF0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgJERhdGFMb2NhbC0+eyAkRWxlbWVudExvbmdOYW1lIC4gJ19EaXNhYmxlZCcgfSA9ICRFbGVtZW50TG9uZ05hbWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRQYXJlbnRzIC49ICRFbGVtZW50IC4gJzo6JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBzb3J0IGhhc2ggKGJlZm9yZSB0aGUgdHJhbnNsYXRpb24pCiAgICAgICAgbXkgQFNvcnRLZXlzOwogICAgICAgIGlmICggJE9wdGlvblJlZi0+e1NvcnR9IGVxICdJbmRpdmlkdWFsVmFsdWUnICYmICRPcHRpb25SZWYtPntTb3J0SW5kaXZpZHVhbH0gKSB7CiAgICAgICAgICAgIG15ICVMaXN0ID0gcmV2ZXJzZSAleyREYXRhTG9jYWx9OwogICAgICAgICAgICBmb3IgbXkgJEtleSAoIEB7ICRPcHRpb25SZWYtPntTb3J0SW5kaXZpZHVhbH0gfSApIHsKICAgICAgICAgICAgICAgIGlmICggJExpc3R7JEtleX0gKSB7CiAgICAgICAgICAgICAgICAgICAgcHVzaCBAU29ydEtleXMsICRMaXN0eyRLZXl9OwogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSAkTGlzdHskS2V5fTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBwdXNoIEBTb3J0S2V5cywgc29ydCB7IGxjICRhIGNtcCBsYyAkYiB9ICggdmFsdWVzICVMaXN0ICk7CiAgICAgICAgfQoKICAgICAgICAjIHRyYW5zbGF0ZSB2YWx1ZQogICAgICAgIGlmICggJE9wdGlvblJlZi0+e1RyYW5zbGF0aW9ufSApIHsKICAgICAgICAgICAgZm9yIG15ICRSb3cgKCBzb3J0IGtleXMgJXskRGF0YUxvY2FsfSApIHsKICAgICAgICAgICAgICAgICREYXRhTG9jYWwtPnskUm93fSA9ICRTZWxmLT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoICREYXRhTG9jYWwtPnskUm93fSApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIHNvcnQgaGFzaCAoYWZ0ZXIgdGhlIHRyYW5zbGF0aW9uKQogICAgICAgIGlmICggJE9wdGlvblJlZi0+e1NvcnR9IGVxICdOdW1lcmljS2V5JyApIHsKICAgICAgICAgICAgQFNvcnRLZXlzID0gc29ydCB7ICRhIDw9PiAkYiB9ICgga2V5cyAleyREYXRhTG9jYWx9ICk7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJE9wdGlvblJlZi0+e1NvcnR9IGVxICdOdW1lcmljVmFsdWUnICkgewogICAgICAgICAgICBAU29ydEtleXMgPSBzb3J0IHsgJERhdGFMb2NhbC0+eyRhfSA8PT4gJERhdGFMb2NhbC0+eyRifSB9ICgga2V5cyAleyREYXRhTG9jYWx9ICk7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJE9wdGlvblJlZi0+e1NvcnR9IGVxICdBbHBoYW51bWVyaWNLZXknICkgewogICAgICAgICAgICBAU29ydEtleXMgPSBzb3J0KCBrZXlzICV7JERhdGFMb2NhbH0gKTsKICAgICAgICB9CiAgICAgICAgZWxzaWYgKCAkT3B0aW9uUmVmLT57U29ydH0gZXEgJ1RyZWVWaWV3JyApIHsKCiAgICAgICAgICAgICMgYWRkIHN1ZmZpeCBmb3IgY29ycmVjdCBzb3J0aW5nCiAgICAgICAgICAgIG15ICVTb3J0SGFzaDsKICAgICAgICAgICAgZm9yICggc29ydCBrZXlzICV7JERhdGFMb2NhbH0gKSB7CiAgICAgICAgICAgICAgICAkU29ydEhhc2h7JF99ID0gJERhdGFMb2NhbC0+eyRffSAuICc6Oic7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQFNvcnRLZXlzID0gc29ydCB7IGxjICRTb3J0SGFzaHskYX0gY21wIGxjICRTb3J0SGFzaHskYn0gfSAoIGtleXMgJVNvcnRIYXNoICk7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJE9wdGlvblJlZi0+e1NvcnR9IGVxICdJbmRpdmlkdWFsS2V5JyAmJiAkT3B0aW9uUmVmLT57U29ydEluZGl2aWR1YWx9ICkgewogICAgICAgICAgICBteSAlTGlzdCA9ICV7JERhdGFMb2NhbH07CiAgICAgICAgICAgIGZvciBteSAkS2V5ICggQHsgJE9wdGlvblJlZi0+e1NvcnRJbmRpdmlkdWFsfSB9ICkgewogICAgICAgICAgICAgICAgaWYgKCAkTGlzdHskS2V5fSApIHsKICAgICAgICAgICAgICAgICAgICBwdXNoIEBTb3J0S2V5cywgJEtleTsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgJExpc3R7JEtleX07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVzaCBAU29ydEtleXMsIHNvcnQgeyBsYyAkTGlzdHskYX0gY21wIGxjICRMaXN0eyRifSB9ICgga2V5cyAlTGlzdCApOwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRPcHRpb25SZWYtPntTb3J0fSBlcSAnSW5kaXZpZHVhbFZhbHVlJyAmJiAkT3B0aW9uUmVmLT57U29ydEluZGl2aWR1YWx9ICkgewoKICAgICAgICAgICAgIyBhbHJlYWR5IGRvbmUgYmVmb3JlIHRoZSB0cmFuc2xhdGlvbgogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgQFNvcnRLZXlzID0gc29ydCB7IGxjICREYXRhTG9jYWwtPnskYX0gY21wIGxjICREYXRhTG9jYWwtPnskYn0gfSAoIGtleXMgJXskRGF0YUxvY2FsfSApOwogICAgICAgICAgICAkT3B0aW9uUmVmLT57U29ydH0gPSAnQWxwaGFudW1lcmljVmFsdWUnOwogICAgICAgIH0KCiAgICAgICAgIyBjcmVhdGUgRGF0YVJlZgogICAgICAgIGZvciBteSAkUm93IChAU29ydEtleXMpIHsKICAgICAgICAgICAgJERhdGFSZWYtPlskQ291bnRlcl0tPntLZXl9ICAgPSAkUm93OwogICAgICAgICAgICAkRGF0YVJlZi0+WyRDb3VudGVyXS0+e1ZhbHVlfSA9ICREYXRhTG9jYWwtPnskUm93fTsKICAgICAgICAgICAgJENvdW50ZXIrKzsKICAgICAgICB9CiAgICB9CgogICAgIyBpZiBBcnJheUhhc2hSZWYgd2FzIGdpdmVuCiAgICBlbHNpZiAoIHJlZiAkRGF0YUxvY2FsIGVxICdBUlJBWScgJiYgcmVmICREYXRhTG9jYWwtPlswXSBlcSAnSEFTSCcgKSB7CgogICAgICAgICMgZ2V0IG1pc3NpbmcgcGFyZW50cyBhbmQgbWFyayB0aGVtIGZvciBkaXNhYmxlIGxhdGVyCiAgICAgICAgaWYgKCAkT3B0aW9uUmVmLT57U29ydH0gZXEgJ1RyZWVWaWV3JyApIHsKCiAgICAgICAgICAgICMgYnVpbGQgYSBsaXN0IG9mIGVsZW1lbnQgbG9uZ25hbWVzCiAgICAgICAgICAgIG15IEBOZXdEYXRhTG9jYWw7CgogICAgICAgICAgICBteSAlTGlzdDsKICAgICAgICAgICAgZm9yIG15ICRWYWx1ZUhhc2ggKCBAeyREYXRhTG9jYWx9ICkgewogICAgICAgICAgICAgICAgJExpc3R7ICRWYWx1ZUhhc2gtPntWYWx1ZX0gfSA9IDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgZ2V0IGVhY2ggZGF0YSB2YWx1ZSBoYXNoCiAgICAgICAgICAgIGZvciBteSAkVmFsdWVIYXNoICggQHskRGF0YUxvY2FsfSApIHsKCiAgICAgICAgICAgICAgICBteSAkUGFyZW50cyA9ICcnOwoKICAgICAgICAgICAgICAgICMgdHJ5IHRvIHNwbGl0IGl0cyBwYXJlbnRzIChlLmcuIFF1ZXVlIG9yIFNlcnZpY2UpIEdyYW5kUGFyZW50OjpQYXJlbnQ6OlNvbgogICAgICAgICAgICAgICAgbXkgQEVsZW1lbnRzID0gc3BsaXQgLzo6LywgJFZhbHVlSGFzaC0+e1ZhbHVlfTsKCiAgICAgICAgICAgICAgICAjIGdldCBlYWNoIGVsZW1lbnQgaW4gdGhlIGhpZXJhcmNoeQogICAgICAgICAgICAgICAgZm9yIG15ICRFbGVtZW50IChARWxlbWVudHMpIHsKCiAgICAgICAgICAgICAgICAgICAgIyBhZGQgaXRzIG93biBwYXJlbnRzIGZvciB0aGUgY29tcGxldGUgbmFtZQogICAgICAgICAgICAgICAgICAgIG15ICRFbGVtZW50TG9uZ05hbWUgPSAkUGFyZW50cyAuICRFbGVtZW50OwoKICAgICAgICAgICAgICAgICAgICAjIGNoZWNrIGlmIGVsZW1lbnQgZXhpc3RzIGluIHRoZSBvcmlnaW5hbCBkYXRhIG9yIGlmIGl0IGlzIGFscmVhZHkgbWFya2VkCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhJExpc3R7JEVsZW1lbnRMb25nTmFtZX0gJiYgISREaXNhYmxlZEVsZW1lbnRzeyRFbGVtZW50TG9uZ05hbWV9ICkgewoKICAgICAgICAgICAgICAgICAgICAgICAgIyBtYXJrIGVsZW1lbnQgYXMgZGlzYWJsZWQKICAgICAgICAgICAgICAgICAgICAgICAgJERpc2FibGVkRWxlbWVudHN7JEVsZW1lbnRMb25nTmFtZX0gPSAxOwoKICAgICAgICAgICAgICAgICAgICAgICAgIyBwdXNoIHRoZSBtaXNzaW5nIGVsZW1lbnQgdG8gdGhlIGRhdGEgbG9jYWwgYXJyYXkKICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCBATmV3RGF0YUxvY2FsLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBLZXkgICAgICA9PiAkRWxlbWVudExvbmdOYW1lIC4gJ19EaXNhYmxlZCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZSAgICA9PiAkRWxlbWVudExvbmdOYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGlzYWJsZWQgPT4gMSwKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJFBhcmVudHMgLj0gJEVsZW1lbnQgLiAnOjonOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgcHVzaCB0aGUgZWxlbWVudCB0byB0aGUgZGF0YSBsb2NhbCBhcnJheQogICAgICAgICAgICAgICAgcHVzaCBATmV3RGF0YUxvY2FsLCB7CiAgICAgICAgICAgICAgICAgICAgS2V5ICAgICAgPT4gJFZhbHVlSGFzaC0+e0tleX0sCiAgICAgICAgICAgICAgICAgICAgVmFsdWUgICAgPT4gJFZhbHVlSGFzaC0+e1ZhbHVlfSwKICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZCA9PiAkVmFsdWVIYXNoLT57U2VsZWN0ZWR9ID8gMSA6IDAsCiAgICAgICAgICAgICAgICAgICAgRGlzYWJsZWQgPT4gJFZhbHVlSGFzaC0+e0Rpc2FibGVkfSA/IDEgOiAwLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBvdmVycmlkZSB0aGUgZGF0YSBsb2NhbCB3aXRoIHRoZSBuZXcgb25lCiAgICAgICAgICAgIEB7JERhdGFMb2NhbH0gPSBATmV3RGF0YUxvY2FsOwogICAgICAgIH0KCiAgICAgICAgIyBjcmVhdGUgRGF0YVJlZgogICAgICAgIGZvciBteSAkUm93ICggQHskRGF0YUxvY2FsfSApIHsKICAgICAgICAgICAgaWYgKCByZWYgJFJvdyBlcSAnSEFTSCcgJiYgZGVmaW5lZCAkUm93LT57S2V5fSApIHsKICAgICAgICAgICAgICAgICREYXRhUmVmLT5bJENvdW50ZXJdLT57S2V5fSAgID0gJFJvdy0+e0tleX07CiAgICAgICAgICAgICAgICAkRGF0YVJlZi0+WyRDb3VudGVyXS0+e1ZhbHVlfSA9ICRSb3ctPntWYWx1ZX07CgogICAgICAgICAgICAgICAgIyB0cmFuc2xhdGUgdmFsdWUKICAgICAgICAgICAgICAgIGlmICggJE9wdGlvblJlZi0+e1RyYW5zbGF0aW9ufSApIHsKICAgICAgICAgICAgICAgICAgICAkRGF0YVJlZi0+WyRDb3VudGVyXS0+e1ZhbHVlfSA9ICRTZWxmLT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoICREYXRhUmVmLT5bJENvdW50ZXJdLT57VmFsdWV9ICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBzZXQgU2VsZWN0ZWQgYW5kIERpc2FibGVkIG9wdGlvbnMKICAgICAgICAgICAgICAgIGlmICggJFJvdy0+e1NlbGVjdGVkfSApIHsKICAgICAgICAgICAgICAgICAgICAkRGF0YVJlZi0+WyRDb3VudGVyXS0+e1NlbGVjdGVkfSA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNpZiAoICRSb3ctPntEaXNhYmxlZH0gKSB7CiAgICAgICAgICAgICAgICAgICAgJERhdGFSZWYtPlskQ291bnRlcl0tPntEaXNhYmxlZH0gPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJENvdW50ZXIrKzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAjIGlmIEFycmF5UmVmIHdhcyBnaXZlbgogICAgZWxzaWYgKCByZWYgJERhdGFMb2NhbCBlcSAnQVJSQVknICkgewoKICAgICAgICAjIGdldCBtaXNzaW5nIHBhcmVudHMgYW5kIG1hcmsgdGhlbSBmb3IgZGlzYWJsZSBsYXRlcgogICAgICAgIGlmICggJE9wdGlvblJlZi0+e1NvcnR9IGVxICdUcmVlVmlldycgKSB7CiAgICAgICAgICAgIG15ICVMaXN0ID0gbWFwIHsgJF8gPT4gMSB9IEB7JERhdGFMb2NhbH07CgogICAgICAgICAgICAjIGdldCBlYWNoIGRhdGEgdmFsdWUKICAgICAgICAgICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJUxpc3QgKSB7CiAgICAgICAgICAgICAgICBteSAkUGFyZW50cyA9ICcnOwoKICAgICAgICAgICAgICAgICMgdHJ5IHRvIHNwbGl0IGl0cyBwYXJlbnRzIChlLmcuIFF1ZXVlIG9yIFNlcnZpY2UpIEdyYW5kUGFyZW50OjpQYXJlbnQ6OlNvbgogICAgICAgICAgICAgICAgbXkgQEVsZW1lbnRzID0gc3BsaXQgLzo6LywgJEtleTsKCiAgICAgICAgICAgICAgICAjIGdldCBlYWNoIGVsZW1lbnQgaW4gdGhlIGhpZXJhcmNoeQogICAgICAgICAgICAgICAgZm9yIG15ICRFbGVtZW50IChARWxlbWVudHMpIHsKCiAgICAgICAgICAgICAgICAgICAgIyBhZGQgaXRzIG93biBwYXJlbnRzIGZvciB0aGUgY29tcGxldGUgbmFtZQogICAgICAgICAgICAgICAgICAgIG15ICRFbGVtZW50TG9uZ05hbWUgPSAkUGFyZW50cyAuICRFbGVtZW50OwoKICAgICAgICAgICAgICAgICAgICAjIGNoZWNrIGlmIGVsZW1lbnQgZXhpc3RzIGluIHRoZSBvcmlnaW5hbCBkYXRhIG9yIGlmIGl0IGlzIGFscmVhZHkgbWFya2VkCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhJExpc3R7JEVsZW1lbnRMb25nTmFtZX0gJiYgISREaXNhYmxlZEVsZW1lbnRzeyRFbGVtZW50TG9uZ05hbWV9ICkgewoKICAgICAgICAgICAgICAgICAgICAgICAgIyBtYXJrIGVsZW1lbnQgYXMgZGlzYWJsZWQKICAgICAgICAgICAgICAgICAgICAgICAgJERpc2FibGVkRWxlbWVudHN7JEVsZW1lbnRMb25nTmFtZX0gPSAxOwoKICAgICAgICAgICAgICAgICAgICAgICAgIyBhZGQgdGhlIGVsZW1lbnQgdG8gdGhlIG9yaWdpbmFsIGRhdGEgdG8gYmUgZGlzYWJsZWQgbGF0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCBAeyREYXRhTG9jYWx9LCAkRWxlbWVudExvbmdOYW1lOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkUGFyZW50cyAuPSAkRWxlbWVudCAuICc6Oic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICggJE9wdGlvblJlZi0+e1NvcnR9IGVxICdJbmRpdmlkdWFsVmFsdWUnICYmICRPcHRpb25SZWYtPntTb3J0SW5kaXZpZHVhbH0gKSB7CiAgICAgICAgICAgIG15ICVMaXN0ID0gbWFwIHsgJF8gPT4gMSB9IEB7JERhdGFMb2NhbH07CiAgICAgICAgICAgICREYXRhTG9jYWwgPSBbXTsKICAgICAgICAgICAgZm9yIG15ICRLZXkgKCBAeyAkT3B0aW9uUmVmLT57U29ydEluZGl2aWR1YWx9IH0gKSB7CiAgICAgICAgICAgICAgICBpZiAoICRMaXN0eyRLZXl9ICkgewogICAgICAgICAgICAgICAgICAgIHB1c2ggQHskRGF0YUxvY2FsfSwgJEtleTsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgJExpc3R7JEtleX07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVzaCBAeyREYXRhTG9jYWx9LCBzb3J0IHsgJGEgY21wICRiIH0gKCBrZXlzICVMaXN0ICk7CiAgICAgICAgfQoKICAgICAgICBteSAlUmV2ZXJzZUhhc2g7CgogICAgICAgICMgdHJhbnNsYXRlIHZhbHVlCiAgICAgICAgaWYgKCAkT3B0aW9uUmVmLT57VHJhbnNsYXRpb259ICkgewogICAgICAgICAgICBteSBAVHJhbnNsYXRlQXJyYXk7CiAgICAgICAgICAgIGZvciBteSAkUm93ICggQHskRGF0YUxvY2FsfSApIHsKICAgICAgICAgICAgICAgIG15ICRUcmFuc2xhdGVTdHJpbmcgPSAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCRSb3cpOwogICAgICAgICAgICAgICAgcHVzaCBAVHJhbnNsYXRlQXJyYXksICRUcmFuc2xhdGVTdHJpbmc7CiAgICAgICAgICAgICAgICAkUmV2ZXJzZUhhc2h7JFRyYW5zbGF0ZVN0cmluZ30gPSAkUm93OwogICAgICAgICAgICB9CiAgICAgICAgICAgICREYXRhTG9jYWwgPSBcQFRyYW5zbGF0ZUFycmF5OwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgZm9yIG15ICRSb3cgKCBAeyREYXRhTG9jYWx9ICkgewogICAgICAgICAgICAgICAgJFJldmVyc2VIYXNoeyRSb3d9ID0gJFJvdzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBzb3J0IGFycmF5CiAgICAgICAgaWYgKCAkT3B0aW9uUmVmLT57U29ydH0gZXEgJ0FscGhhbnVtZXJpY0tleScgfHwgJE9wdGlvblJlZi0+e1NvcnR9IGVxICdBbHBoYW51bWVyaWNWYWx1ZScgKQogICAgICAgIHsKICAgICAgICAgICAgbXkgQFNvcnRBcnJheSA9IHNvcnQoIEB7JERhdGFMb2NhbH0gKTsKICAgICAgICAgICAgJERhdGFMb2NhbCA9IFxAU29ydEFycmF5OwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRPcHRpb25SZWYtPntTb3J0fSBlcSAnTnVtZXJpY0tleScgfHwgJE9wdGlvblJlZi0+e1NvcnR9IGVxICdOdW1lcmljVmFsdWUnICkgewogICAgICAgICAgICBteSBAU29ydEFycmF5ID0gc29ydCB7ICRhIDw9PiAkYiB9ICggQHskRGF0YUxvY2FsfSApOwogICAgICAgICAgICAkRGF0YUxvY2FsID0gXEBTb3J0QXJyYXk7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJE9wdGlvblJlZi0+e1NvcnR9IGVxICdUcmVlVmlldycgKSB7CgogICAgICAgICAgICAjIHNvcnQgYXJyYXksIGFkZCAnOjonIGluIHRoZSBjb21wYXJpc29uLCBmb3IgcHJvcGVyIHNvcnQgb2YgSXRlbXMgd2l0aCBJdGVtczo6U3ViSXRlbXMKICAgICAgICAgICAgbXkgQFNvcnRBcnJheSA9IHNvcnQgeyAkYSAuICc6OicgY21wICRiIC4gJzo6JyB9IEB7JERhdGFMb2NhbH07CiAgICAgICAgICAgICREYXRhTG9jYWwgPSBcQFNvcnRBcnJheTsKICAgICAgICB9CgogICAgICAgICMgY3JlYXRlIERhdGFSZWYKICAgICAgICBmb3IgbXkgJFJvdyAoIEB7JERhdGFMb2NhbH0gKSB7CiAgICAgICAgICAgICREYXRhUmVmLT5bJENvdW50ZXJdLT57S2V5fSAgID0gJFJldmVyc2VIYXNoeyRSb3d9OwogICAgICAgICAgICAkRGF0YVJlZi0+WyRDb3VudGVyXS0+e1ZhbHVlfSA9ICRSb3c7CiAgICAgICAgICAgICRDb3VudGVyKys7CiAgICAgICAgfQogICAgfQoKICAgICMgY2hlY2sgZGlzYWJsZWQgaXRlbXMgb24gQXJyYXlSZWYgb3IgSGFzaFJlZiBvbmx5CiAgICBpZiAoCiAgICAgICAgcmVmICREYXRhTG9jYWwgZXEgJ0hBU0gnCiAgICAgICAgfHwgKCByZWYgJERhdGFMb2NhbCBlcSAnQVJSQVknICYmIHJlZiAkRGF0YUxvY2FsLT5bMF0gbmUgJ0hBU0gnICkKICAgICAgICApCiAgICB7CiAgICAgICAgZm9yIG15ICRSb3cgKCBAeyREYXRhUmVmfSApIHsKICAgICAgICAgICAgaWYgKCAkRGlzYWJsZWRFbGVtZW50c3sgJFJvdy0+e1ZhbHVlfSB9ICkgewogICAgICAgICAgICAgICAgJFJvdy0+e0tleX0gICAgICA9ICctJzsKICAgICAgICAgICAgICAgICRSb3ctPntEaXNhYmxlZH0gPSAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgRGlzYWJsZWRCcmFuY2ggb3B0aW9uCiAgICBpZiAoICRPcHRpb25SZWYtPntEaXNhYmxlZEJyYW5jaH0gKSB7CiAgICAgICAgZm9yIG15ICRSb3cgKCBAeyREYXRhUmVmfSApIHsKICAgICAgICAgICAgZm9yIG15ICRCcmFuY2ggKCBzb3J0IGtleXMgJXsgJE9wdGlvblJlZi0+e0Rpc2FibGVkQnJhbmNofSB9ICkgewogICAgICAgICAgICAgICAgaWYgKCAkUm93LT57VmFsdWV9ID1+IC9eKFxRJEJyYW5jaFxFKSQvIHx8ICRSb3ctPntWYWx1ZX0gPX4gL14oXFEkQnJhbmNoXEUpOjovICkgewogICAgICAgICAgICAgICAgICAgICRSb3ctPntEaXNhYmxlZH0gPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgU2VsZWN0ZWRJRCBhbmQgU2VsZWN0ZWRWYWx1ZSBvcHRpb24KICAgIGlmICggZGVmaW5lZCAkT3B0aW9uUmVmLT57U2VsZWN0ZWRJRH0gfHwgJE9wdGlvblJlZi0+e1NlbGVjdGVkVmFsdWV9ICkgewogICAgICAgIGZvciBteSAkUm93ICggQHskRGF0YVJlZn0gKSB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICgKICAgICAgICAgICAgICAgICAgICAkT3B0aW9uUmVmLT57U2VsZWN0ZWRJRH0tPnsgJFJvdy0+e0tleX0gfQogICAgICAgICAgICAgICAgICAgIHx8ICRPcHRpb25SZWYtPntTZWxlY3RlZFZhbHVlfS0+eyAkUm93LT57VmFsdWV9IH0KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICYmICEkRGlzYWJsZWRFbGVtZW50c3sgJFJvdy0+e1ZhbHVlfSB9CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRSb3ctPntTZWxlY3RlZH0gPSAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgU29ydFJldmVyc2Ugb3B0aW9uCiAgICBpZiAoICRPcHRpb25SZWYtPntTb3J0UmV2ZXJzZX0gKSB7CiAgICAgICAgQHskRGF0YVJlZn0gPSByZXZlcnNlKCBAeyREYXRhUmVmfSApOwogICAgfQoKICAgICMgUG9zc2libGVOb25lIG9wdGlvbgogICAgaWYgKCAkT3B0aW9uUmVmLT57UG9zc2libGVOb25lfSApIHsKICAgICAgICBteSAlTm9uZTsKICAgICAgICAkTm9uZXtLZXl9ICAgPSAnJzsKICAgICAgICAkTm9uZXtWYWx1ZX0gPSAnLSc7CgogICAgICAgIHVuc2hpZnQoIEB7JERhdGFSZWZ9LCBcJU5vbmUgKTsKICAgIH0KCiAgICAjIFRyZWVWaWV3IG9wdGlvbgogICAgaWYgKCAkT3B0aW9uUmVmLT57VHJlZVZpZXd9ICkgewoKICAgICAgICBST1c6CiAgICAgICAgZm9yIG15ICRSb3cgKCBAeyREYXRhUmVmfSApIHsKCiAgICAgICAgICAgIG5leHQgUk9XIGlmICEkUm93LT57VmFsdWV9OwoKICAgICAgICAgICAgbXkgQEZyYWdtZW50ID0gc3BsaXQgJzo6JywgJFJvdy0+e1ZhbHVlfTsKICAgICAgICAgICAgJFJvdy0+e1ZhbHVlfSA9IHBvcCBARnJhZ21lbnQ7CgogICAgICAgICAgICAjIFRPRE86IEhlcmUgd2UgYXJlIGNvbWJpbmluZyBNYXggd2l0aCBIVE1MUXVvdGUsIGNoZWNrIGJlbG93IGZvciB0aGUgUkVNQVJLOgogICAgICAgICAgICAjIE1heCBhbmQgSFRNTFF1b3RlIG5lZWRzIHRvIGJlIGRvbmUgYmVmb3JlIHNwYWNlcyBpbnNlcnQgYnV0IGFmdGVyIHRoZSBzcGxpdCBvZiB0aGUKICAgICAgICAgICAgIyBwYXJlbnRzLCB0aGVuIGl0IGlzIG5vdCBwb3NzaWJsZSB0byBkbyBpdCBvdXRzaWRlCiAgICAgICAgICAgIGlmICggJE9wdGlvblJlZi0+e0hUTUxRdW90ZX0gKSB7CiAgICAgICAgICAgICAgICAkUm93LT57VmFsdWV9ID0gJFNlbGYtPkFzY2lpMkh0bWwoCiAgICAgICAgICAgICAgICAgICAgVGV4dCA9PiAkUm93LT57VmFsdWV9LAogICAgICAgICAgICAgICAgICAgIE1heCAgPT4gJE9wdGlvblJlZi0+e01heH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2lmICggJE9wdGlvblJlZi0+e01heH0gKSB7CiAgICAgICAgICAgICAgICBpZiAoIGxlbmd0aCAkUm93LT57VmFsdWV9ID4gJE9wdGlvblJlZi0+e01heH0gKSB7CiAgICAgICAgICAgICAgICAgICAgJFJvdy0+e1ZhbHVlfSA9IHN1YnN0ciggJFJvdy0+e1ZhbHVlfSwgMCwgJE9wdGlvblJlZi0+e01heH0gLSA1ICkgLiAnWy4uLl0nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAkU3BhY2UgPSAnJm5ic3A7Jm5ic3A7JyB4IHNjYWxhciBARnJhZ21lbnQ7CiAgICAgICAgICAgICRTcGFjZSB8fD0gJyc7CgogICAgICAgICAgICAkUm93LT57VmFsdWV9ID0gJFNwYWNlIC4gJFJvdy0+e1ZhbHVlfTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlIHsKCiAgICAgICAgIyBIVE1MUXVvdGUgb3B0aW9uCiAgICAgICAgaWYgKCAkT3B0aW9uUmVmLT57SFRNTFF1b3RlfSApIHsKICAgICAgICAgICAgZm9yIG15ICRSb3cgKCBAeyREYXRhUmVmfSApIHsKICAgICAgICAgICAgICAgICRSb3ctPntLZXl9ICAgPSAkU2VsZi0+QXNjaWkySHRtbCggVGV4dCA9PiAkUm93LT57S2V5fSApOwogICAgICAgICAgICAgICAgJFJvdy0+e1ZhbHVlfSA9ICRTZWxmLT5Bc2NpaTJIdG1sKCBUZXh0ID0+ICRSb3ctPntWYWx1ZX0gKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBUT0RPOiBDaGVjayB0aGlzIGNvbW1lbnQhCiAgICAgICAgIyBNYXggb3B0aW9uCiAgICAgICAgIyBSRU1BUks6IERvbid0IG1lcmdlIHRoZSBNYXggaGFuZGxpbmcgd2l0aCBBc2NpaTJIdG1sIGZ1bmN0aW9uIGNhbGwgb2YKICAgICAgICAjIHRoZSBIVE1MUXVvdGUgaGFuZGxpbmcuIEluIHRoaXMgY2FzZSB5b3UgbG9zZSB0aGUgbWF4IGhhbmRsaW5nIGlmIHlvdQogICAgICAgICMgZGVhY3RpdmF0ZSBIVE1MUXVvdGUKICAgICAgICBpZiAoICRPcHRpb25SZWYtPntNYXh9ICkgewoKICAgICAgICAgICAgIyBSRU1BUks6IFRoaXMgaXMgdGhlIHNhbWUgc29sdXRpb24gYXMgaW4gQXNjaWkySHRtbAogICAgICAgICAgICBmb3IgbXkgJFJvdyAoIEB7JERhdGFSZWZ9ICkgewoKICAgICAgICAgICAgICAgIGlmICggcmVmICRSb3cgZXEgJ0hBU0gnICkgewogICAgICAgICAgICAgICAgICAgIGlmICggbGVuZ3RoICRSb3ctPntWYWx1ZX0gPiAkT3B0aW9uUmVmLT57TWF4fSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFJvdy0+e1ZhbHVlfSA9IHN1YnN0ciggJFJvdy0+e1ZhbHVlfSwgMCwgJE9wdGlvblJlZi0+e01heH0gLSA1ICkgLiAnWy4uLl0nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICggbGVuZ3RoICRSb3cgPiAkT3B0aW9uUmVmLT57TWF4fSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFJvdyA9IHN1YnN0ciggJFJvdywgMCwgJE9wdGlvblJlZi0+e01heH0gLSA1ICkgLiAnWy4uLl0nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gJERhdGFSZWY7Cn0KCj1pdGVtIF9CdWlsZFNlbGVjdGlvbk91dHB1dCgpCgpjcmVhdGUgdGhlIGh0bWwgc3RyaW5nCgogICAgbXkgJEhUTUxTdHJpbmcgPSAkTGF5b3V0T2JqZWN0LT5fQnVpbGRTZWxlY3Rpb25PdXRwdXQoCiAgICAgICAgQXR0cmlidXRlUmVmICA9PiAkQXR0cmlidXRlUmVmLAogICAgICAgIERhdGFSZWYgICAgICAgPT4gJERhdGFSZWYsCiAgICAgICAgVHJlZVZpZXcgICAgICA9PiAwLCAgICAgICAgICAgICAgIyBvcHRpb25hbCwgc2VlIEJ1aWxkU2VsZWN0aW9uKCkKICAgICAgICBGaWx0ZXJzUmVmICAgID0+IFxARmlsdGVycywgICAgICAjIG9wdGlvbmFsLCBzZWUgQnVpbGRTZWxlY3Rpb24oKQogICAgICAgIEZpbHRlckFjdGl2ZSAgPT4gJEZpbHRlckFjdGl2ZSwgICMgb3B0aW9uYWwsIHNlZSBCdWlsZFNlbGVjdGlvbigpCiAgICAgICAgRXhwYW5kRmlsdGVycyA9PiAxLCAgICAgICAgICAgICAgIyBvcHRpb25hbCwgc2VlIEJ1aWxkU2VsZWN0aW9uKCkKICAgICk7CgogICAgbXkgJEF0dHJpYnV0ZVJlZiA9IHsKICAgICAgICBuYW1lID0+ICdUaGVOYW1lJywKICAgICAgICBtdWx0aXBsZSA9PiB1bmRlZiwKICAgICAgICBzaXplID0+IDUsCiAgICB9CgogICAgbXkgJERhdGFSZWYgID0gWwogICAgICAgIHsKICAgICAgICAgICAgS2V5ID0+IDExLAogICAgICAgICAgICBWYWx1ZSA9PiAnVGV4dCcsCiAgICAgICAgICAgIERpc2FibGVkID0+IDEsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIEtleSA9PiAnYWJjJywKICAgICAgICAgICAgVmFsdWUgPT4gJyZuYnNwOyZuYnNwO1RleHQnLAogICAgICAgICAgICBTZWxlY3RlZCA9PiAxLAogICAgICAgIH0sCiAgICBdOwoKPWN1dAoKc3ViIF9CdWlsZFNlbGVjdGlvbk91dHB1dCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgc3RhcnQgZ2VuZXJhdGlvbiwgaWYgQXR0cmlidXRlUmVmIGFuZCBEYXRhUmVmIHdhcyBmb3VuZAogICAgbXkgJFN0cmluZzsKICAgIGlmICggJFBhcmFte0F0dHJpYnV0ZVJlZn0gJiYgJFBhcmFte0RhdGFSZWZ9ICkgewoKICAgICAgICAjIGdlbmVyYXRlIDxzZWxlY3Q+IHJvdwogICAgICAgICRTdHJpbmcgPSAnPHNlbGVjdCc7CiAgICAgICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJXsgJFBhcmFte0F0dHJpYnV0ZVJlZn0gfSApIHsKICAgICAgICAgICAgaWYgKCAkS2V5ICYmIGRlZmluZWQgJFBhcmFte0F0dHJpYnV0ZVJlZn0tPnskS2V5fSApIHsKICAgICAgICAgICAgICAgICRTdHJpbmcgLj0gIiAkS2V5PVwiJFBhcmFte0F0dHJpYnV0ZVJlZn0tPnskS2V5fVwiIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNpZiAoJEtleSkgewogICAgICAgICAgICAgICAgJFN0cmluZyAuPSAiICRLZXkiOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGFkZCBmaWx0ZXJzIGlmIGRlZmluZWQKICAgICAgICBpZiAoICRQYXJhbXtGaWx0ZXJzUmVmfSAmJiBzY2FsYXIgQHsgJFBhcmFte0ZpbHRlcnNSZWZ9IH0gPiAwICkgewogICAgICAgICAgICBteSAkSlNPTiA9ICRTZWxmLT5KU09ORW5jb2RlKAogICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgRmlsdGVycyA9PiAkUGFyYW17RmlsdGVyc1JlZn0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgTm9RdW90ZXMgPT4gMSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgbXkgJEpTT05Fc2NhcGVkID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkhUTUxVdGlscycpLT5Ub0hUTUwoCiAgICAgICAgICAgICAgICBTdHJpbmcgPT4gJEpTT04sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRTdHJpbmcgLj0gIiBkYXRhLWZpbHRlcnM9XCIkSlNPTkVzY2FwZWRcIiI7CiAgICAgICAgICAgIGlmICggJFBhcmFte0ZpbHRlckFjdGl2ZX0gKSB7CiAgICAgICAgICAgICAgICAkU3RyaW5nIC49ICcgZGF0YS1maWx0ZXJlZD0iJyAuIGludCggJFBhcmFte0ZpbHRlckFjdGl2ZX0gKSAuICciJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoICRQYXJhbXtFeHBhbmRGaWx0ZXJzfSApIHsKICAgICAgICAgICAgICAgICRTdHJpbmcgLj0gJyBkYXRhLWV4cGFuZC1maWx0ZXJzPSInIC4gaW50KCAkUGFyYW17RXhwYW5kRmlsdGVyc30gKSAuICciJzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyB0cmVlIGZsYWcgZm9yIElucHV0IEZpZWxkcwogICAgICAgIGlmICggJFBhcmFte1RyZWVWaWV3fSApIHsKICAgICAgICAgICAgJFN0cmluZyAuPSAnIGRhdGEtdHJlZT0idHJ1ZSInOwogICAgICAgIH0KCiAgICAgICAgJFN0cmluZyAuPSAiPlxuIjsKCiAgICAgICAgIyBnZW5lcmF0ZSA8b3B0aW9uPiByb3dzCiAgICAgICAgZm9yIG15ICRSb3cgKCBAeyAkUGFyYW17RGF0YVJlZn0gfSApIHsKICAgICAgICAgICAgbXkgJEtleSA9ICcnOwogICAgICAgICAgICBpZiAoIGRlZmluZWQgJFJvdy0+e0tleX0gKSB7CiAgICAgICAgICAgICAgICAkS2V5ID0gJFJvdy0+e0tleX07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbXkgJFZhbHVlID0gJyc7CiAgICAgICAgICAgIGlmICggZGVmaW5lZCAkUm93LT57VmFsdWV9ICkgewogICAgICAgICAgICAgICAgJFZhbHVlID0gJFJvdy0+e1ZhbHVlfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBteSAkU2VsZWN0ZWREaXNhYmxlZCA9ICcnOwogICAgICAgICAgICBpZiAoICRSb3ctPntTZWxlY3RlZH0gKSB7CiAgICAgICAgICAgICAgICAkU2VsZWN0ZWREaXNhYmxlZCA9ICcgc2VsZWN0ZWQ9InNlbGVjdGVkIic7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCAkUm93LT57RGlzYWJsZWR9ICkgewogICAgICAgICAgICAgICAgJFNlbGVjdGVkRGlzYWJsZWQgPSAnIGRpc2FibGVkPSJkaXNhYmxlZCInOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG15ICRPcHRpb25UaXRsZSA9ICcnOwogICAgICAgICAgICBpZiAoICRQYXJhbXtPcHRpb25UaXRsZX0gKSB7CiAgICAgICAgICAgICAgICAkT3B0aW9uVGl0bGUgPSAnIHRpdGxlPSInIC4gJFZhbHVlIC4gJyInOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRTdHJpbmcgLj0gIiAgPG9wdGlvbiB2YWx1ZT1cIiRLZXlcIiRTZWxlY3RlZERpc2FibGVkJE9wdGlvblRpdGxlPiRWYWx1ZTwvb3B0aW9uPlxuIjsKICAgICAgICB9CiAgICAgICAgJFN0cmluZyAuPSAnPC9zZWxlY3Q+JzsKCiAgICAgICAgaWYgKCAkUGFyYW17VHJlZVZpZXd9ICkgewogICAgICAgICAgICBteSAkVHJlZVNlbGVjdGlvbk1lc3NhZ2UgPSAkU2VsZi0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCJTaG93IFRyZWUgU2VsZWN0aW9uIik7CiAgICAgICAgICAgICRTdHJpbmcKICAgICAgICAgICAgICAgIC49ICcgPGEgaHJlZj0iIyIgdGl0bGU9IicKICAgICAgICAgICAgICAgIC4gJFRyZWVTZWxlY3Rpb25NZXNzYWdlCiAgICAgICAgICAgICAgICAuICciIGNsYXNzPSJTaG93VHJlZVNlbGVjdGlvbiI+PHNwYW4+JwogICAgICAgICAgICAgICAgLiAkVHJlZVNlbGVjdGlvbk1lc3NhZ2UgLiAnPC9zcGFuPjxpIGNsYXNzPSJmYSBmYS1zaXRlbWFwIj48L2k+PC9hPic7CiAgICAgICAgfQoKICAgIH0KICAgIHJldHVybiAkU3RyaW5nOwp9CgpzdWIgX0Rpc2FibGVCYW5uZXJDaGVjayB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIHJldHVybiAxIGlmICEkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ1NlY3VyZTo6RGlzYWJsZUJhbm5lcicpOwogICAgcmV0dXJuICAgaWYgISRQYXJhbXtPdXRwdXRSZWZ9OwoKICAgICMgcmVtb3ZlIHRoZSB2ZXJzaW9uIHRhZyBmcm9tIHRoZSBoZWFkZXIKICAgICR7ICRQYXJhbXtPdXRwdXRSZWZ9IH0gPX4gc3sKICAgICAgICAgICAgICAgIF4gWC1Qb3dlcmVkLUJ5OiAuKz8gT3BlbiBccyBUaWNrZXQgXHMgUmVxdWVzdCBccyBTeXN0ZW0gXHMgXChodHRwIC4rPyBcKSQgXG4KICAgICAgICAgICAgfXt9c214OwoKICAgIHJldHVybiAxOwp9Cgo9aXRlbSBfUmVtb3ZlU2NyaXB0VGFncygpCgpUaGlzIGZ1bmN0aW9uIHdpbGwgcmVtb3ZlIHRoZSBzdXJyb3VuZGluZyA8c2NyaXB0PiB0YWdzIG9mIGEKcGllY2Ugb2YgSmF2YVNjcmlwdCBjb2RlLCBpZiB0aGV5IGFyZSBwcmVzZW50LCBhbmQgcmV0dXJuIHRoZSByZXN1bHQuCgogICAgbXkgJENvZGVDb250ZW50ID0gJExheW91dE9iamVjdC0+X1JlbW92ZVNjcmlwdFRhZ3MoQ29kZSA9PiAkU29tZUNvZGUpOwoKPWN1dAoKc3ViIF9SZW1vdmVTY3JpcHRUYWdzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJENvZGUgPSAkUGFyYW17Q29kZX0gfHwgJyc7CgogICAgaWYgKCAkQ29kZSA9fiBtLzxzY3JpcHQvICkgewoKICAgICAgICAjIGN1dCBvdXQgZHRsIGJsb2NrIGNvbW1lbnRzIG9mIGFscmVhZHkgcmVwbGFjZWQgZHRsIGJsb2NrcwogICAgICAgICRDb2RlID1+IHN7CiAgICAgICAgICAgIF4KICAgICAgICAgICAgPCEtLQogICAgICAgICAgICBcLz8KICAgICAgICAgICAgXHcrCiAgICAgICAgICAgIC0tPgogICAgICAgICAgICBccj9cbgogICAgICAgIH17fXNteGc7CgogICAgICAgICMgY3V0IG91dCBvcGVuaW5nIHNjcmlwdCB0YWdzCiAgICAgICAgJENvZGUgPX4gc3sKICAgICAgICAgICAgPHNjcmlwdFtePl0rPgogICAgICAgICAgICAoPzpccyo8IS0tKT8KICAgICAgICAgICAgKD86XHMqLy9ccyo8IVxbQ0RBVEFcWyk/CiAgICAgICAgfQogICAgICAgIHt9c214ZzsKCiAgICAgICAgIyBjdXQgb3V0IGNsb3Npbmcgc2NyaXB0IHRhZ3MKICAgICAgICAkQ29kZSA9fiBzewogICAgICAgICAgICAoPzotLT5ccyopPwogICAgICAgICAgICAoPzovL1xzKlxdXF0+XHMqKT8KICAgICAgICAgICAgPC9zY3JpcHQ+CiAgICAgICAgfXt9c214ZzsKCiAgICB9CiAgICByZXR1cm4gJENvZGU7Cn0KCj1pdGVtIFdyYXBQbGFpblRleHQoKQoKVGhpcyBzdWIgaGFzIHR3byBtYWluIGZ1bmN0aW9uYWxpdGllczoKMS4gQ2hlY2sgZXZlcnkgbGluZSBhbmQgbWFrZSBzdXJlIHRoYXQgIlxuIiBpcyB0aGUgZW5kaW5nIG9mIHRoZSBsaW5lLgoyLiBJZiB0aGUgbGluZSBkb2VzIF9ub3RfIHN0YXJ0IHdpdGggIj4iIChlLmcuIG5vdCBjaXRlZCB0ZXh0KQp3cmFwIGl0IGFmdGVyIHRoZSBudW1iZXIgb2YgIk1heENoYXJhY3RlcnMiIChlLmcuIGlmIE1heENoYXJhY3RlcnMgaXMgIjgwIiB3cmFwIGFmdGVyIDgwIGNoYXJhY3RlcnMpLgpEbyB0aGlzIF9qdXN0XyBpZiB0aGUgbGluZSwgdGhhdCBzaG91bGQgYmUgd3JhcHBlZCwgY29udGFpbnMgc3BhY2UgY2hhcmFjdGVycyBhdCB3aGljaCB0aGUgbGluZSBjYW4gYmUgd3JhcHBlZC4KCklmIHlvdSBuZWVkIG1vcmUgaW5mbyB0byB1bmRlcnN0YW5kIHdoYXQgaXQgZG9lcywgdGFrZSBhIGxvb2sgYXQgdGhlIFVuaXRUZXN0IFdyYXBQbGFpblRleHQudCB0byBzZWUKdXNlIGNhc2VzIHRoZXJlLgoKbXkgJFdyYXBwZWRQbGFpblRleHQgPSAkTGF5b3V0T2JqZWN0LT5XcmFwUGxhaW5UZXh0KAogICAgUGxhaW5UZXh0ICAgICA9PiAiU29tZSBQbGFpbiB0ZXh0IHRoYXQgaXMgbG9uZ2VyIHRoYW4gdGhlIGFtb3VudCBzdG9yZWQgaW4gTWF4Q2hhcmFjdGVycyIsCiAgICBNYXhDaGFyYWN0ZXJzID0+IDgwLAopOwoKPWN1dAoKc3ViIFdyYXBQbGFpblRleHQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIFJldHVybiBpZiB3ZSBkaWQgbm90IGdldCBNYXhDaGFyYWN0ZXJzCiAgICAjIG9yIE1heENoYXJhY3RlcnMgZG9lc24ndCBjb250YWluIGp1c3QgYW4gaW50CiAgICBpZiAoICFJc1Bvc2l0aXZlSW50ZWdlciggJFBhcmFte01heENoYXJhY3RlcnN9ICkgKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJHb3Qgbm8gb3IgaW52YWxpZCBNYXhDaGFyYWN0ZXJzISIsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBSZXR1cm4gaWYgd2UgZGlkbid0IGdldCBQbGFpblRleHQKICAgIGlmICggIWRlZmluZWQgJFBhcmFte1BsYWluVGV4dH0gKSB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgUmV0dXJuIGlmIHdlIGdvdCBubyBTY2FsYXIKICAgIGlmICggcmVmICRQYXJhbXtQbGFpblRleHR9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiSGFkIG5vIHN0cmluZyBpbiBQbGFpblRleHQhIiwKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIFJldHVybiBQbGFpblRleHQgaWYgd2UgaGF2ZSBsZXNzIHRoYW4gTWF4Q2hhcmFjdGVycwogICAgaWYgKCBsZW5ndGggJFBhcmFte1BsYWluVGV4dH0gPCAkUGFyYW17TWF4Q2hhcmFjdGVyc30gKSB7CiAgICAgICAgcmV0dXJuICRQYXJhbXtQbGFpblRleHR9OwogICAgfQoKICAgIG15ICRXb3JrU3RyaW5nID0gJFBhcmFte1BsYWluVGV4dH07CgogICAgIyBOb3JtYWxpemUgbGluZSBlbmRpbmdzIHRvIGF2b2lkIHByb2JsZW1zIHdpdGggXHJcbiAoYnVnIzExMDc4KS4KICAgICRXb3JrU3RyaW5nID1+IHMvXHJcbj8vXG4vZzsKICAgICRXb3JrU3RyaW5nID1+IHMvKF4+Lit8Lns0LCRQYXJhbXtNYXhDaGFyYWN0ZXJzfX0pKD86XHN8XHopLyQxXG4vZ207CiAgICByZXR1cm4gJFdvcmtTdHJpbmc7Cn0KCiNDT01QQVQ6IHRvIDMuMC54IGFuZCBsb3dlciAoY2FuIGJlIHJlbW92ZWQgbGF0ZXIpCnN1YiBUcmFuc2Zyb21EYXRlU2VsZWN0aW9uIHsKICAgIG15ICRTZWxmID0gc2hpZnQ7CgogICAgcmV0dXJuICRTZWxmLT5UcmFuc2Zvcm1EYXRlU2VsZWN0aW9uKEBfKTsKfQoKMTsKCj1lbmQgSW50ZXJuYWw6Cgo9YmFjawoKPWhlYWQxIFRFUk1TIEFORCBDT05ESVRJT05TCgpUaGlzIHNvZnR3YXJlIGlzIHBhcnQgb2YgdGhlIE9UUlMgcHJvamVjdCAoTDxodHRwOi8vb3Rycy5vcmcvPikuCgpUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQp0aGUgZW5jbG9zZWQgZmlsZSBDT1BZSU5HIGZvciBsaWNlbnNlIGluZm9ybWF0aW9uIChBR1BMKS4gSWYgeW91CmRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBMPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9hZ3BsLnR4dD4uCgo9Y3V0Cg==</File>
        <File Location="KIXCore/Kernel/Output/HTML/Layout/Loader.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDE2IE9UUlMgQUcsIGh0dHA6Ly9vdHJzLmNvbS8KIyBLSVhDb3JlLUV4dGVuc2lvbnMgQ29weXJpZ2h0IChDKSAyMDA2LTIwMTYgYy5hLnAuZS4gSVQgR21iSCwgaHR0cDovL3d3dy5jYXBlLWl0LmRlCiMKIyB3cml0dGVuL2VkaXRlZCBieToKIyAqIFJlbmUoZG90KUJvZWhtKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIERvcm90aGVhKGRvdClEb2VyZmZlbChhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMgKiBBbm5hKGRvdClMaXR2aW5vdmEoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojCiMgLS0KIyAkSWQ6IExvYWRlci5wbSx2IDEuNCAyMDE2LzA0LzEzIDEyOjE3OjI3IGRkb2VyZmZlbCBFeHAgJAojIC0tCiMgVGhpcyBzb2Z0d2FyZSBjb21lcyB3aXRoIEFCU09MVVRFTFkgTk8gV0FSUkFOVFkuIEZvciBkZXRhaWxzLCBzZWUKIyB0aGUgZW5jbG9zZWQgZmlsZSBDT1BZSU5HIGZvciBsaWNlbnNlIGluZm9ybWF0aW9uIChBR1BMKS4gSWYgeW91CiMgZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9hZ3BsLnR4dC4KIyAtLQoKcGFja2FnZSBLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0OjpMb2FkZXI7Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7CgpvdXIgJE9iamVjdE1hbmFnZXJEaXNhYmxlZCA9IDE7CgojIEtJWENvcmUtY2FwZUlUCnVzZSBGaWxlOjpDb3B5Owp1c2UgRmlsZTo6UGF0aCBxdyhta3BhdGgpOwoKIyBFTyBLSVhDb3JlLWNhcGVJVAoKPWhlYWQxIE5BTUUKCktlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQ6OkxvYWRlciAtIENTUy9KYXZhU2NyaXB0Cgo9aGVhZDEgU1lOT1BTSVMKCkFsbCB2YWxpZCBmdW5jdGlvbnMuCgo9aGVhZDEgUFVCTElDIElOVEVSRkFDRQoKPW92ZXIgNAoKPWN1dAoKPWl0ZW0gTG9hZGVyQ3JlYXRlQWdlbnRDU1NDYWxscygpCgpHZW5lcmF0ZSB0aGUgbWluaWZpZWQgQ1NTIGZpbGVzIGFuZCB0aGUgdGFncyByZWZlcmVuY2luZyB0aGVtLAp0YWtpbmcgYSBsaXN0IGZyb20gdGhlIExvYWRlcjo6QWdlbnQ6OkNvbW1vbkNTUyBjb25maWcgaXRlbS4KCiAgICAkTGF5b3V0T2JqZWN0LT5Mb2FkZXJDcmVhdGVBZ2VudENTU0NhbGxzKAogICAgICAgIFNraW4gPT4gJ015U2tpbicsICMgb3B0aW9uYWwsIGlmIG5vdCBwcm92aWRlZCBza2luIGlzIHRoZSBjb25maWd1cmVkIGJ5IGRlZmF1bHQKICAgICk7Cgo9Y3V0CgpzdWIgTG9hZGVyQ3JlYXRlQWdlbnRDU1NDYWxscyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IGNvbmZpZyBvYmplY3QKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgICMgZ2V0IGhvc3QgYmFzZWQgZGVmYXVsdCBza2luIGNvbmZpZ3VyYXRpb24KICAgIG15ICRTa2luU2VsZWN0ZWRIb3N0QmFzZWQ7CiAgICBteSAkRGVmYXVsdFNraW5Ib3N0QmFzZWQgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvYWRlcjo6QWdlbnQ6OkRlZmF1bHRTZWxlY3RlZFNraW46Okhvc3RCYXNlZCcpOwogICAgaWYgKCAkRGVmYXVsdFNraW5Ib3N0QmFzZWQgJiYgJEVOVntIVFRQX0hPU1R9ICkgewogICAgICAgIFJFR0VYUDoKICAgICAgICBmb3IgbXkgJFJlZ0V4cCAoIHNvcnQga2V5cyAleyREZWZhdWx0U2tpbkhvc3RCYXNlZH0gKSB7CgogICAgICAgICAgICAjIGRvIG5vdCB1c2UgZW1wdHkgcmVnZXhwIG9yIHNraW4gZGlyZWN0b3JpZXMKICAgICAgICAgICAgbmV4dCBSRUdFWFAgaWYgISRSZWdFeHA7CiAgICAgICAgICAgIG5leHQgUkVHRVhQIGlmICEkRGVmYXVsdFNraW5Ib3N0QmFzZWQtPnskUmVnRXhwfTsKCiAgICAgICAgICAgICMgY2hlY2sgaWYgcmVnZXhwIGlzIG1hdGNoaW5nCiAgICAgICAgICAgIGlmICggJEVOVntIVFRQX0hPU1R9ID1+IC8kUmVnRXhwL2kgKSB7CiAgICAgICAgICAgICAgICAkU2tpblNlbGVjdGVkSG9zdEJhc2VkID0gJERlZmF1bHRTa2luSG9zdEJhc2VkLT57JFJlZ0V4cH07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBkZXRlcm1pbmUgc2tpbgogICAgIyAxLiB1c2UgVXNlclNraW4gc2V0dGluZyBmcm9tIEFnZW50IHByZWZlcmVuY2VzLCBpZiBhdmFpbGFibGUKICAgICMgMi4gdXNlIEhvc3RCYXNlZCBza2luIHNldHRpbmcsIGlmIGF2YWlsYWJsZQogICAgIyAzLiB1c2UgZGVmYXVsdCBza2luIGZyb20gY29uZmlndXJhdGlvbgoKICAgIG15ICRTa2luU2VsZWN0ZWQgPSAkU2VsZi0+eydVc2VyU2tpbid9OwoKICAgICMgY2hlY2sgaWYgdGhlIHNraW4gaXMgdmFsaWQKICAgIG15ICRTa2luVmFsaWQgPSAwOwogICAgaWYgKCRTa2luU2VsZWN0ZWQpIHsKICAgICAgICAkU2tpblZhbGlkID0gJFNlbGYtPlNraW5WYWxpZGF0ZSgKICAgICAgICAgICAgU2tpblR5cGUgPT4gJ0FnZW50JywKICAgICAgICAgICAgU2tpbiAgICAgPT4gJFNraW5TZWxlY3RlZCwKICAgICAgICApOwogICAgfQoKICAgIGlmICggISRTa2luVmFsaWQgKSB7CiAgICAgICAgJFNraW5TZWxlY3RlZCA9ICRTa2luU2VsZWN0ZWRIb3N0QmFzZWQKICAgICAgICAgICAgfHwgJENvbmZpZ09iamVjdC0+R2V0KCdMb2FkZXI6OkFnZW50OjpEZWZhdWx0U2VsZWN0ZWRTa2luJykKICAgICAgICAgICAgfHwgJ2RlZmF1bHQnOwogICAgfQoKICAgICMgc2F2ZSBzZWxlY3RlZCBza2luCiAgICAkU2VsZi0+e1NraW5TZWxlY3RlZH0gPSAkU2tpblNlbGVjdGVkOwoKICAgIG15ICRTa2luSG9tZSA9ICRDb25maWdPYmplY3QtPkdldCgnSG9tZScpIC4gJy92YXIvaHR0cGQvaHRkb2NzL3NraW5zJzsKICAgIG15ICREb01pbmlmeSA9ICRDb25maWdPYmplY3QtPkdldCgnTG9hZGVyOjpFbmFibGVkOjpDU1MnKTsKCiAgICBteSAkVG9vbGJhck1vZHVsZVNldHRpbmdzICAgID0gJENvbmZpZ09iamVjdC0+R2V0KCdGcm9udGVuZDo6VG9vbEJhck1vZHVsZScpOwogICAgbXkgJEN1c3RvbWVyVXNlckl0ZW1TZXR0aW5ncyA9ICRDb25maWdPYmplY3QtPkdldCgnRnJvbnRlbmQ6OkN1c3RvbWVyVXNlcjo6SXRlbScpOwoKICAgIHsKICAgICAgICBteSBARmlsZUxpc3Q7CgogICAgICAgICMgZ2V0IGdsb2JhbCBjc3MKICAgICAgICBteSAkQ29tbW9uQ1NTTGlzdCA9ICRDb25maWdPYmplY3QtPkdldCgnTG9hZGVyOjpBZ2VudDo6Q29tbW9uQ1NTJyk7CiAgICAgICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJXskQ29tbW9uQ1NTTGlzdH0gKSB7CiAgICAgICAgICAgIHB1c2ggQEZpbGVMaXN0LCBAeyAkQ29tbW9uQ1NTTGlzdC0+eyRLZXl9IH07CiAgICAgICAgfQoKICAgICAgICAjIGdldCB0b29sYmFyIG1vZHVsZSBjc3MKICAgICAgICBmb3IgbXkgJEtleSAoIHNvcnQga2V5cyAleyRUb29sYmFyTW9kdWxlU2V0dGluZ3N9ICkgewogICAgICAgICAgICBpZiAoICRUb29sYmFyTW9kdWxlU2V0dGluZ3MtPnskS2V5fS0+e0NTU30gKSB7CiAgICAgICAgICAgICAgICBwdXNoIEBGaWxlTGlzdCwgJFRvb2xiYXJNb2R1bGVTZXR0aW5ncy0+eyRLZXl9LT57Q1NTfTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBnZXQgY3VzdG9tZXIgdXNlciBpdGVtIGNzcwogICAgICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICV7JEN1c3RvbWVyVXNlckl0ZW1TZXR0aW5nc30gKSB7CiAgICAgICAgICAgIGlmICggJEN1c3RvbWVyVXNlckl0ZW1TZXR0aW5ncy0+eyRLZXl9LT57Q1NTfSApIHsKICAgICAgICAgICAgICAgIHB1c2ggQEZpbGVMaXN0LCAkQ3VzdG9tZXJVc2VySXRlbVNldHRpbmdzLT57JEtleX0tPntDU1N9OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkU2VsZi0+X0hhbmRsZUNTU0xpc3QoCiAgICAgICAgICAgIExpc3QgICAgICA9PiBcQEZpbGVMaXN0LAogICAgICAgICAgICBEb01pbmlmeSAgPT4gJERvTWluaWZ5LAogICAgICAgICAgICBCbG9ja05hbWUgPT4gJ0NvbW1vbkNTUycsCiAgICAgICAgICAgIFNraW5Ib21lICA9PiAkU2tpbkhvbWUsCiAgICAgICAgICAgIFNraW5UeXBlICA9PiAnQWdlbnQnLAogICAgICAgICAgICBTa2luICAgICAgPT4gJFNraW5TZWxlY3RlZCwKICAgICAgICApOwogICAgfQoKICAgICMgbm93IGhhbmRsZSBtb2R1bGUgc3BlY2lmaWMgQ1NTCiAgICBteSAkTG9hZGVyQWN0aW9uID0gJFNlbGYtPntBY3Rpb259IHx8ICdMb2dpbic7CiAgICAkTG9hZGVyQWN0aW9uID0gJ0xvZ2luJyBpZiAoICRMb2FkZXJBY3Rpb24gZXEgJ0xvZ291dCcgKTsKCiAgICBteSAkRnJvbnRlbmRNb2R1bGVSZWdpc3RyYXRpb24gPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0Zyb250ZW5kOjpNb2R1bGUnKS0+eyRMb2FkZXJBY3Rpb259CiAgICAgICAgfHwge307CgogICAgewoKICAgICAgICBteSAkQXBwQ1NTTGlzdCA9ICRGcm9udGVuZE1vZHVsZVJlZ2lzdHJhdGlvbi0+e0xvYWRlcn0tPntDU1N9IHx8IFtdOwoKICAgICAgICBteSBARmlsZUxpc3QgPSBAeyRBcHBDU1NMaXN0fTsKCiAgICAgICAgJFNlbGYtPl9IYW5kbGVDU1NMaXN0KAogICAgICAgICAgICBMaXN0ICAgICAgPT4gXEBGaWxlTGlzdCwKICAgICAgICAgICAgRG9NaW5pZnkgID0+ICREb01pbmlmeSwKICAgICAgICAgICAgQmxvY2tOYW1lID0+ICdNb2R1bGVDU1MnLAogICAgICAgICAgICBTa2luSG9tZSAgPT4gJFNraW5Ib21lLAogICAgICAgICAgICBTa2luVHlwZSAgPT4gJ0FnZW50JywKICAgICAgICAgICAgU2tpbiAgICAgID0+ICRTa2luU2VsZWN0ZWQsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGhhbmRsZSB0aGUgcmVzcG9uc2l2ZSBDU1MKICAgIHsKICAgICAgICBteSBARmlsZUxpc3Q7CiAgICAgICAgbXkgJFJlc3BvbnNpdmVDU1NMaXN0ID0gJENvbmZpZ09iamVjdC0+R2V0KCdMb2FkZXI6OkFnZW50OjpSZXNwb25zaXZlQ1NTJyk7CgogICAgICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICV7JFJlc3BvbnNpdmVDU1NMaXN0fSApIHsKICAgICAgICAgICAgcHVzaCBARmlsZUxpc3QsIEB7ICRSZXNwb25zaXZlQ1NTTGlzdC0+eyRLZXl9IH07CiAgICAgICAgfQoKICAgICAgICAkU2VsZi0+X0hhbmRsZUNTU0xpc3QoCiAgICAgICAgICAgIExpc3QgICAgICA9PiBcQEZpbGVMaXN0LAogICAgICAgICAgICBEb01pbmlmeSAgPT4gJERvTWluaWZ5LAogICAgICAgICAgICBCbG9ja05hbWUgPT4gJ1Jlc3BvbnNpdmVDU1MnLAogICAgICAgICAgICBTa2luSG9tZSAgPT4gJFNraW5Ib21lLAogICAgICAgICAgICBTa2luVHlwZSAgPT4gJ0FnZW50JywKICAgICAgICAgICAgU2tpbiAgICAgID0+ICRTa2luU2VsZWN0ZWQsCiAgICAgICAgKTsKICAgIH0KCiAgICAjcHJpbnQgU1RERVJSICJUaW1lOiAiIC4gVGltZTo6SGlSZXM6OnR2X2ludGVydmFsKFskdDBdKTsKCiAgICByZXR1cm4gMTsKfQoKPWl0ZW0gTG9hZGVyQ3JlYXRlQWdlbnRKU0NhbGxzKCkKCkdlbmVyYXRlIHRoZSBtaW5pZmllZCBKUyBmaWxlcyBhbmQgdGhlIHRhZ3MgcmVmZXJlbmNpbmcgdGhlbSwKdGFraW5nIGEgbGlzdCBmcm9tIHRoZSBMb2FkZXI6OkFnZW50OjpDb21tb25KUyBjb25maWcgaXRlbS4KCiAgICAkTGF5b3V0T2JqZWN0LT5Mb2FkZXJDcmVhdGVBZ2VudEpTQ2FsbHMoKTsKCj1jdXQKCnN1YiBMb2FkZXJDcmVhdGVBZ2VudEpTQ2FsbHMgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjdXNlIFRpbWU6OkhpUmVzOwogICAgI215ICR0MCA9IFRpbWU6OkhpUmVzOjpnZXR0aW1lb2ZkYXkoKTsKCiAgICAjIGdldCBjb25maWcgb2JqZWN0CiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICBteSAkSlNIb21lICAgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0hvbWUnKSAuICcvdmFyL2h0dHBkL2h0ZG9jcy9qcyc7CiAgICBteSAkRG9NaW5pZnkgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvYWRlcjo6RW5hYmxlZDo6SlMnKTsKCiAgICB7CiAgICAgICAgbXkgQEZpbGVMaXN0OwoKICAgICAgICAjIGdldCBnbG9iYWwganMKICAgICAgICBteSAkQ29tbW9uSlNMaXN0ID0gJENvbmZpZ09iamVjdC0+R2V0KCdMb2FkZXI6OkFnZW50OjpDb21tb25KUycpOwogICAgICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICV7JENvbW1vbkpTTGlzdH0gKSB7CiAgICAgICAgICAgIHB1c2ggQEZpbGVMaXN0LCBAeyAkQ29tbW9uSlNMaXN0LT57JEtleX0gfTsKICAgICAgICB9CgogICAgICAgICMgZ2V0IHRvb2xiYXIgbW9kdWxlIGpzCiAgICAgICAgbXkgJFRvb2xiYXJNb2R1bGVTZXR0aW5ncyA9ICRDb25maWdPYmplY3QtPkdldCgnRnJvbnRlbmQ6OlRvb2xCYXJNb2R1bGUnKTsKICAgICAgICBmb3IgbXkgJEtleSAoIHNvcnQga2V5cyAleyRUb29sYmFyTW9kdWxlU2V0dGluZ3N9ICkgewogICAgICAgICAgICBpZiAoICRUb29sYmFyTW9kdWxlU2V0dGluZ3MtPnskS2V5fS0+e0phdmFTY3JpcHR9ICkgewogICAgICAgICAgICAgICAgcHVzaCBARmlsZUxpc3QsICRUb29sYmFyTW9kdWxlU2V0dGluZ3MtPnskS2V5fS0+e0phdmFTY3JpcHR9OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkU2VsZi0+X0hhbmRsZUpTTGlzdCgKICAgICAgICAgICAgTGlzdCAgICAgID0+IFxARmlsZUxpc3QsCiAgICAgICAgICAgIERvTWluaWZ5ICA9PiAkRG9NaW5pZnksCiAgICAgICAgICAgIEJsb2NrTmFtZSA9PiAnQ29tbW9uSlMnLAogICAgICAgICAgICBKU0hvbWUgICAgPT4gJEpTSG9tZSwKICAgICAgICApOwoKICAgIH0KCiAgICAjIG5vdyBoYW5kbGUgbW9kdWxlIHNwZWNpZmljIEpTCiAgICB7CiAgICAgICAgbXkgJExvYWRlckFjdGlvbiA9ICRTZWxmLT57QWN0aW9ufSB8fCAnTG9naW4nOwogICAgICAgICRMb2FkZXJBY3Rpb24gPSAnTG9naW4nIGlmICggJExvYWRlckFjdGlvbiBlcSAnTG9nb3V0JyApOwoKICAgICAgICBteSAkQXBwSlNMaXN0ID0gJENvbmZpZ09iamVjdC0+R2V0KCdGcm9udGVuZDo6TW9kdWxlJyktPnskTG9hZGVyQWN0aW9ufS0+e0xvYWRlcn0KICAgICAgICAgICAgLT57SmF2YVNjcmlwdH0gfHwgW107CgogICAgICAgIG15IEBGaWxlTGlzdCA9IEB7JEFwcEpTTGlzdH07CgogICAgICAgICRTZWxmLT5fSGFuZGxlSlNMaXN0KAogICAgICAgICAgICBMaXN0ICAgICAgPT4gXEBGaWxlTGlzdCwKICAgICAgICAgICAgRG9NaW5pZnkgID0+ICREb01pbmlmeSwKICAgICAgICAgICAgQmxvY2tOYW1lID0+ICdNb2R1bGVKUycsCiAgICAgICAgICAgIEpTSG9tZSAgICA9PiAkSlNIb21lLAogICAgICAgICk7CgogICAgfQoKICAgIHJldHVybiAxOwp9Cgo9aXRlbSBMb2FkZXJDcmVhdGVDdXN0b21lckNTU0NhbGxzKCkKCkdlbmVyYXRlIHRoZSBtaW5pZmllZCBDU1MgZmlsZXMgYW5kIHRoZSB0YWdzIHJlZmVyZW5jaW5nIHRoZW0sCnRha2luZyBhIGxpc3QgZnJvbSB0aGUgTG9hZGVyOjpDdXN0b21lcjo6Q29tbW9uQ1NTIGNvbmZpZyBpdGVtLgoKICAgICRMYXlvdXRPYmplY3QtPkxvYWRlckNyZWF0ZUN1c3RvbWVyQ1NTQ2FsbHMoKTsKCj1jdXQKCnN1YiBMb2FkZXJDcmVhdGVDdXN0b21lckNTU0NhbGxzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgY29uZmlnIG9iamVjdAogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgbXkgJFNraW5TZWxlY3RlZCA9ICRDb25maWdPYmplY3QtPkdldCgnTG9hZGVyOjpDdXN0b21lcjo6U2VsZWN0ZWRTa2luJykKICAgICAgICB8fCAnZGVmYXVsdCc7CgogICAgIyBmb3JjZSBhIHNraW4gYmFzZWQgb24gaG9zdCBuYW1lCiAgICBteSAkRGVmYXVsdFNraW5Ib3N0QmFzZWQgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvYWRlcjo6Q3VzdG9tZXI6OlNlbGVjdGVkU2tpbjo6SG9zdEJhc2VkJyk7CiAgICBpZiAoICREZWZhdWx0U2tpbkhvc3RCYXNlZCAmJiAkRU5We0hUVFBfSE9TVH0gKSB7CiAgICAgICAgUkVHRVhQOgogICAgICAgIGZvciBteSAkUmVnRXhwICggc29ydCBrZXlzICV7JERlZmF1bHRTa2luSG9zdEJhc2VkfSApIHsKCiAgICAgICAgICAgICMgZG8gbm90IHVzZSBlbXB0eSByZWdleHAgb3Igc2tpbiBkaXJlY3RvcmllcwogICAgICAgICAgICBuZXh0IFJFR0VYUCBpZiAhJFJlZ0V4cDsKICAgICAgICAgICAgbmV4dCBSRUdFWFAgaWYgISREZWZhdWx0U2tpbkhvc3RCYXNlZC0+eyRSZWdFeHB9OwoKICAgICAgICAgICAgIyBjaGVjayBpZiByZWdleHAgaXMgbWF0Y2hpbmcKICAgICAgICAgICAgaWYgKCAkRU5We0hUVFBfSE9TVH0gPX4gLyRSZWdFeHAvaSApIHsKICAgICAgICAgICAgICAgICRTa2luU2VsZWN0ZWQgPSAkRGVmYXVsdFNraW5Ib3N0QmFzZWQtPnskUmVnRXhwfTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBteSAkU2tpbkhvbWUgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0hvbWUnKSAuICcvdmFyL2h0dHBkL2h0ZG9jcy9za2lucyc7CiAgICBteSAkRG9NaW5pZnkgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvYWRlcjo6RW5hYmxlZDo6Q1NTJyk7CgogICAgewogICAgICAgIG15ICRDb21tb25DU1NMaXN0ID0gJENvbmZpZ09iamVjdC0+R2V0KCdMb2FkZXI6OkN1c3RvbWVyOjpDb21tb25DU1MnKTsKCiAgICAgICAgbXkgQEZpbGVMaXN0OwoKICAgICAgICBmb3IgbXkgJEtleSAoIHNvcnQga2V5cyAleyRDb21tb25DU1NMaXN0fSApIHsKICAgICAgICAgICAgcHVzaCBARmlsZUxpc3QsIEB7ICRDb21tb25DU1NMaXN0LT57JEtleX0gfTsKICAgICAgICB9CgogICAgICAgICRTZWxmLT5fSGFuZGxlQ1NTTGlzdCgKICAgICAgICAgICAgTGlzdCAgICAgID0+IFxARmlsZUxpc3QsCiAgICAgICAgICAgIERvTWluaWZ5ICA9PiAkRG9NaW5pZnksCiAgICAgICAgICAgIEJsb2NrTmFtZSA9PiAnQ29tbW9uQ1NTJywKICAgICAgICAgICAgU2tpbkhvbWUgID0+ICRTa2luSG9tZSwKICAgICAgICAgICAgU2tpblR5cGUgID0+ICdDdXN0b21lcicsCiAgICAgICAgICAgIFNraW4gICAgICA9PiAkU2tpblNlbGVjdGVkLAogICAgICAgICk7CiAgICB9CgogICAgIyBub3cgaGFuZGxlIG1vZHVsZSBzcGVjaWZpYyBDU1MKICAgIG15ICRMb2FkZXJBY3Rpb24gPSAkU2VsZi0+e0FjdGlvbn0gfHwgJ0xvZ2luJzsKICAgICRMb2FkZXJBY3Rpb24gPSAnTG9naW4nIGlmICggJExvYWRlckFjdGlvbiBlcSAnTG9nb3V0JyApOwoKICAgIG15ICRGcm9udGVuZE1vZHVsZVJlZ2lzdHJhdGlvbiA9ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJGcm9udGVuZDo6TW9kdWxlJyktPnskTG9hZGVyQWN0aW9ufQogICAgICAgIHx8ICRDb25maWdPYmplY3QtPkdldCgnUHVibGljRnJvbnRlbmQ6Ok1vZHVsZScpLT57JExvYWRlckFjdGlvbn0KICAgICAgICB8fCB7fTsKCiAgICB7CiAgICAgICAgbXkgJEFwcENTU0xpc3QgPSAkRnJvbnRlbmRNb2R1bGVSZWdpc3RyYXRpb24tPntMb2FkZXJ9LT57Q1NTfSB8fCBbXTsKCiAgICAgICAgbXkgQEZpbGVMaXN0ID0gQHskQXBwQ1NTTGlzdH07CgogICAgICAgICRTZWxmLT5fSGFuZGxlQ1NTTGlzdCgKICAgICAgICAgICAgTGlzdCAgICAgID0+IFxARmlsZUxpc3QsCiAgICAgICAgICAgIERvTWluaWZ5ICA9PiAkRG9NaW5pZnksCiAgICAgICAgICAgIEJsb2NrTmFtZSA9PiAnTW9kdWxlQ1NTJywKICAgICAgICAgICAgU2tpbkhvbWUgID0+ICRTa2luSG9tZSwKICAgICAgICAgICAgU2tpblR5cGUgID0+ICdDdXN0b21lcicsCiAgICAgICAgICAgIFNraW4gICAgICA9PiAkU2tpblNlbGVjdGVkLAogICAgICAgICk7CiAgICB9CgogICAgIyBoYW5kbGUgdGhlIHJlc3BvbnNpdmUgQ1NTCiAgICB7CiAgICAgICAgbXkgQEZpbGVMaXN0OwogICAgICAgIG15ICRSZXNwb25zaXZlQ1NTTGlzdCA9ICRDb25maWdPYmplY3QtPkdldCgnTG9hZGVyOjpDdXN0b21lcjo6UmVzcG9uc2l2ZUNTUycpOwoKICAgICAgICBmb3IgbXkgJEtleSAoIHNvcnQga2V5cyAleyRSZXNwb25zaXZlQ1NTTGlzdH0gKSB7CiAgICAgICAgICAgIHB1c2ggQEZpbGVMaXN0LCBAeyAkUmVzcG9uc2l2ZUNTU0xpc3QtPnskS2V5fSB9OwogICAgICAgIH0KCiAgICAgICAgJFNlbGYtPl9IYW5kbGVDU1NMaXN0KAogICAgICAgICAgICBMaXN0ICAgICAgPT4gXEBGaWxlTGlzdCwKICAgICAgICAgICAgRG9NaW5pZnkgID0+ICREb01pbmlmeSwKICAgICAgICAgICAgQmxvY2tOYW1lID0+ICdSZXNwb25zaXZlQ1NTJywKICAgICAgICAgICAgU2tpbkhvbWUgID0+ICRTa2luSG9tZSwKICAgICAgICAgICAgU2tpblR5cGUgID0+ICdDdXN0b21lcicsCiAgICAgICAgICAgIFNraW4gICAgICA9PiAkU2tpblNlbGVjdGVkLAogICAgICAgICk7CiAgICB9CgogICAgI3ByaW50IFNUREVSUiAiVGltZTogIiAuIFRpbWU6OkhpUmVzOjp0dl9pbnRlcnZhbChbJHQwXSk7CgogICAgcmV0dXJuIDE7Cn0KCj1pdGVtIExvYWRlckNyZWF0ZUN1c3RvbWVySlNDYWxscygpCgpHZW5lcmF0ZSB0aGUgbWluaWZpZWQgSlMgZmlsZXMgYW5kIHRoZSB0YWdzIHJlZmVyZW5jaW5nIHRoZW0sCnRha2luZyBhIGxpc3QgZnJvbSB0aGUgTG9hZGVyOjpDdXN0b21lcjo6Q29tbW9uSlMgY29uZmlnIGl0ZW0uCgogICAgJExheW91dE9iamVjdC0+TG9hZGVyQ3JlYXRlQ3VzdG9tZXJKU0NhbGxzKCk7Cgo9Y3V0CgpzdWIgTG9hZGVyQ3JlYXRlQ3VzdG9tZXJKU0NhbGxzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgI3VzZSBUaW1lOjpIaVJlczsKICAgICNteSAkdDAgPSBUaW1lOjpIaVJlczo6Z2V0dGltZW9mZGF5KCk7CgogICAgIyBnZXQgY29uZmlnIG9iamVjdAogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgbXkgJEpTSG9tZSAgID0gJENvbmZpZ09iamVjdC0+R2V0KCdIb21lJykgLiAnL3Zhci9odHRwZC9odGRvY3MvanMnOwogICAgbXkgJERvTWluaWZ5ID0gJENvbmZpZ09iamVjdC0+R2V0KCdMb2FkZXI6OkVuYWJsZWQ6OkpTJyk7CgogICAgewogICAgICAgIG15ICRDb21tb25KU0xpc3QgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0xvYWRlcjo6Q3VzdG9tZXI6OkNvbW1vbkpTJyk7CgogICAgICAgIG15IEBGaWxlTGlzdDsKCiAgICAgICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJXskQ29tbW9uSlNMaXN0fSApIHsKICAgICAgICAgICAgcHVzaCBARmlsZUxpc3QsIEB7ICRDb21tb25KU0xpc3QtPnskS2V5fSB9OwogICAgICAgIH0KCiAgICAgICAgJFNlbGYtPl9IYW5kbGVKU0xpc3QoCiAgICAgICAgICAgIExpc3QgICAgICA9PiBcQEZpbGVMaXN0LAogICAgICAgICAgICBEb01pbmlmeSAgPT4gJERvTWluaWZ5LAogICAgICAgICAgICBCbG9ja05hbWUgPT4gJ0NvbW1vbkpTJywKICAgICAgICAgICAgSlNIb21lICAgID0+ICRKU0hvbWUsCiAgICAgICAgKTsKCiAgICB9CgogICAgIyBub3cgaGFuZGxlIG1vZHVsZSBzcGVjaWZpYyBKUwogICAgewogICAgICAgIG15ICRMb2FkZXJBY3Rpb24gPSAkU2VsZi0+e0FjdGlvbn0gfHwgJ0N1c3RvbWVyTG9naW4nOwogICAgICAgICRMb2FkZXJBY3Rpb24gPSAnQ3VzdG9tZXJMb2dpbicgaWYgKCAkTG9hZGVyQWN0aW9uIGVxICdMb2dvdXQnICk7CgogICAgICAgIG15ICRBcHBKU0xpc3QgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyRnJvbnRlbmQ6Ok1vZHVsZScpLT57JExvYWRlckFjdGlvbn0tPntMb2FkZXJ9CiAgICAgICAgICAgIC0+e0phdmFTY3JpcHR9CiAgICAgICAgICAgIHx8ICRDb25maWdPYmplY3QtPkdldCgnUHVibGljRnJvbnRlbmQ6Ok1vZHVsZScpLT57JExvYWRlckFjdGlvbn0tPntMb2FkZXJ9CiAgICAgICAgICAgIC0+e0phdmFTY3JpcHR9CiAgICAgICAgICAgIHx8IFtdOwoKICAgICAgICBteSBARmlsZUxpc3QgPSBAeyRBcHBKU0xpc3R9OwoKICAgICAgICAkU2VsZi0+X0hhbmRsZUpTTGlzdCgKICAgICAgICAgICAgTGlzdCAgICAgID0+IFxARmlsZUxpc3QsCiAgICAgICAgICAgIERvTWluaWZ5ICA9PiAkRG9NaW5pZnksCiAgICAgICAgICAgIEJsb2NrTmFtZSA9PiAnTW9kdWxlSlMnLAogICAgICAgICAgICBKU0hvbWUgICAgPT4gJEpTSG9tZSwKICAgICAgICApOwoKICAgIH0KCiAgICAjcHJpbnQgU1RERVJSICJUaW1lOiAiIC4gVGltZTo6SGlSZXM6OnR2X2ludGVydmFsKFskdDBdKTsKfQoKc3ViIF9IYW5kbGVDU1NMaXN0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgQFNraW5zID0gKCdkZWZhdWx0Jyk7CgogICAgIyBLSVhDb3JlLWNhcGVJVAogICAgbXkgJVNraW5zTWFwID0gbWFwIHsgJF8gPT4gMSB9IEBTa2luczsKCiAgICAjIEVPIEtJWENvcmUtY2FwZUlUCgogICAgIyB2YWxpZGF0aW5nIHNlbGVjdGVkIGN1c3RvbSBza2luLCBpZiBhbnkKICAgICMgS0lYQ29yZS1jYXBlSVQKICAgICMgaWYgKCAkUGFyYW17U2tpbn0gJiYgJFBhcmFte1NraW59IG5lICdkZWZhdWx0JyAmJiAkU2VsZi0+U2tpblZhbGlkYXRlKCVQYXJhbSkgKSB7CiAgICBpZiAoICRQYXJhbXtTa2lufSAmJiAhJFNraW5zTWFweyAkUGFyYW17U2tpbn0gfSAmJiAkU2VsZi0+U2tpblZhbGlkYXRlKCVQYXJhbSkgKSB7CgogICAgICAgICMgRU8gS0lYQ29yZS1jYXBlSVQKICAgICAgICBwdXNoIEBTa2lucywgJFBhcmFte1NraW59OwogICAgfQoKICAgICMgS0lYQ29yZS1jYXBlSVQKICAgICMgZ2V0IHBhdGhzCiAgICBteSAkSG9tZSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnSG9tZScpOwogICAgJFBhcmFte1NraW5Ib21lfSA9fiBtL14kSG9tZSguKikvOwogICAgbXkgJFNraW5Ib21lU2hvcnQgPSAkMTsKCiAgICAjIGdldCBpbnN0YWxsZWQgcGFja2FnZXMKICAgIG15IEBQYWNrYWdlc1BhdGhzOwogICAgZm9yIG15ICRQYWNrYWdlIChASU5DKSB7CiAgICAgICAgbmV4dCBpZiAoICRQYWNrYWdlICF+IG0vXiRIb21lKC4qKS8gfHwgJFBhY2thZ2UgPX4gbS9eJEhvbWVcL2Jpbi8gKTsKICAgICAgICBwdXNoIEBQYWNrYWdlc1BhdGhzLCAkUGFja2FnZTsKICAgIH0KCiAgICAjIHB1c2ggc3RhbmRhcmQgcGF0aAogICAgcHVzaCggQFBhY2thZ2VzUGF0aHMsICRIb21lICk7CiAgICBteSBAUmV2ZXJzZVBhdGhzID0gcmV2ZXJzZSBAUGFja2FnZXNQYXRoczsKCiAgICAjIGdldCBzeXNjb25maWcgb3B0aW9uIGZvciBwcmUtY3JlYXRlZCBsb2FkZXIgY2FjaGVzCiAgICBteSAkUHJlQ3JlYXRlZENhY2hlcyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnTG9hZGVyOjpQcmVDcmVhdGVkQ2FjaGVzJyk7CgogICAgIyBjb3B5IGZpbGVzCiAgICBpZiAoICEkUHJlQ3JlYXRlZENhY2hlcyApIHsKICAgICAgICBmb3IgbXkgJFNraW4gKEBTa2lucykgewogICAgICAgICAgICBmb3IgbXkgJFBhdGggKEBSZXZlcnNlUGF0aHMpIHsKICAgICAgICAgICAgICAgIGZvciBteSAkVHlwZSAocXcoaW1nIGltZy9pY29ucyBjc3MpKSB7CgogICAgICAgICAgICAgICAgICAgICMgc291cmNlIGRpcmVjdG9yeQogICAgICAgICAgICAgICAgICAgIG15ICREaXJlY3RvcnkgPQogICAgICAgICAgICAgICAgICAgICAgICAkUGF0aAogICAgICAgICAgICAgICAgICAgICAgICAuICRTa2luSG9tZVNob3J0IC4gIi8iCiAgICAgICAgICAgICAgICAgICAgICAgIC4gJFBhcmFte1NraW5UeXBlfSAuICIvIgogICAgICAgICAgICAgICAgICAgICAgICAuICRTa2luIC4gIi8iCiAgICAgICAgICAgICAgICAgICAgICAgIC4gJFR5cGUgLiAiLyI7CgogICAgICAgICAgICAgICAgICAgICMgdGFyZ2V0IGRpcmVjdG9yeQogICAgICAgICAgICAgICAgICAgIG15ICRTa2luRGlyZWN0b3J5ID0KICAgICAgICAgICAgICAgICAgICAgICAgJFBhcmFte1NraW5Ib21lfSAuICIvIgogICAgICAgICAgICAgICAgICAgICAgICAuICRQYXJhbXtTa2luVHlwZX0gLiAiLyIKICAgICAgICAgICAgICAgICAgICAgICAgLiAkU2tpbgogICAgICAgICAgICAgICAgICAgICAgICAuICIvY3NzLWNhY2hlLyIKICAgICAgICAgICAgICAgICAgICAgICAgLiAkVHlwZSAuICIvIjsKCiAgICAgICAgICAgICAgICAgICAgIyBpZiBzb3VyY2UgZGlyZWN0b3J5IGV4aXN0cywgY29weSBmaWxlcwogICAgICAgICAgICAgICAgICAgIGlmICggLWUgJERpcmVjdG9yeSApIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICMgZ2V0IGFsbCBzb3VyY2UgZmlsZXMKICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmRpciggRElSLCAkRGlyZWN0b3J5ICk7CiAgICAgICAgICAgICAgICAgICAgICAgIG15IEBGaWxlcyA9IGdyZXAgeyAhL14oLnwuLnxpY29uc3x0aGlyZHBhcnR5KSQvZyB9IHJlYWRkaXIoRElSKTsKICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VkaXIoRElSKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICMgY2hlY2sgZmlsZWxpc3QgZm9yIGNoYW5nZXMKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRGaWxlIChARmlsZXMpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGNoZWNrIGlmIG5ldyBkaXJlY3RvcnkgZXhpc3RzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICEoIC1lICRTa2luRGlyZWN0b3J5ICkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhbWtwYXRoKCAkU2tpbkRpcmVjdG9yeSwgMCwgMDc1NSApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiQ2FuJ3QgY3JlYXRlIGRpcmVjdG9yeSAnJFNraW5EaXJlY3RvcnknOiAkISIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBjaGVjayBpZiBmaWxlIGRvZXMgbm90IGV4aXN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICEtZSAkU2tpbkRpcmVjdG9yeSAuICRGaWxlICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcHkoICREaXJlY3RvcnkgLiAkRmlsZSwgJFNraW5EaXJlY3RvcnkgLiAkRmlsZSApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgY2hlY2sgaWYgZmlsZSBoYXMgY2hhbmdlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXkgJFRhcmdldEZpbGVTaXplID0gLXMgJFNraW5EaXJlY3RvcnkgLiAkRmlsZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteSAkU291cmNlRmlsZVNpemUgPSAtcyAkRGlyZWN0b3J5IC4gJEZpbGU7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgY29weSBmaWxlIGlmIGNoYW5nZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRTb3VyY2VGaWxlU2l6ZSAmJiAkVGFyZ2V0RmlsZVNpemUgIT0gJFNvdXJjZUZpbGVTaXplICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteSAkb2sgPSBjb3B5KCAkRGlyZWN0b3J5IC4gJEZpbGUsICRTa2luRGlyZWN0b3J5IC4gJEZpbGUgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbXkgJERpcmVjdG9yeVRQID0KICAgICAgICAgICAgICAgICAgICAkUGF0aAogICAgICAgICAgICAgICAgICAgIC4gJFNraW5Ib21lU2hvcnQgLiAiLyIKICAgICAgICAgICAgICAgICAgICAuICRQYXJhbXtTa2luVHlwZX0gLiAiLyIKICAgICAgICAgICAgICAgICAgICAuICRTa2luIC4gIi8iCiAgICAgICAgICAgICAgICAgICAgLiAiY3NzL3RoaXJkcGFydHkvIjsKICAgICAgICAgICAgICAgIG15ICRTa2luRGlyZWN0b3J5VFAgPQogICAgICAgICAgICAgICAgICAgICRQYXRoCiAgICAgICAgICAgICAgICAgICAgLiAkU2tpbkhvbWVTaG9ydCAuICIvIgogICAgICAgICAgICAgICAgICAgIC4gJFBhcmFte1NraW5UeXBlfSAuICIvIgogICAgICAgICAgICAgICAgICAgIC4gJFNraW4gLiAiLyIKICAgICAgICAgICAgICAgICAgICAuICJjc3MtY2FjaGUvY3NzL3RoaXJkcGFydHkvIjsKCiAgICAgICAgICAgICAgICBpZiAoIC1lICREaXJlY3RvcnlUUCApIHsKCiAgICAgICAgICAgICAgICAgICAgb3BlbmRpciggRElSLCAkRGlyZWN0b3J5VFAgKTsKICAgICAgICAgICAgICAgICAgICBteSBARmlsZXMgPSBncmVwIHsgIS9eKC58Li4pJC9nIH0gcmVhZGRpcihESVIpOwogICAgICAgICAgICAgICAgICAgIGNsb3NlZGlyKERJUik7CgogICAgICAgICAgICAgICAgICAgICRTZWxmLT5fQ29weVRoaXJkUGFydHlGaWxlcygKICAgICAgICAgICAgICAgICAgICAgICAgRmlsZUxpc3QgICA9PiBcQEZpbGVzLAogICAgICAgICAgICAgICAgICAgICAgICBTb3VyY2VQYXRoID0+ICREaXJlY3RvcnlUUCwKICAgICAgICAgICAgICAgICAgICAgICAgVGFyZ2V0UGF0aCA9PiAkU2tpbkRpcmVjdG9yeVRQCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAjIEVPIEtJWENvcmUtY2FwZUlUCgogICAgIyBsb2FkIGRlZmF1bHQgY3NzIGZpbGVzCiAgICBmb3IgbXkgJFNraW4gKEBTa2lucykgewogICAgICAgIG15IEBGaWxlTGlzdDsKCiAgICAgICAgQ1NTRklMRToKICAgICAgICBmb3IgbXkgJENTU0ZpbGUgKCBAeyAkUGFyYW17TGlzdH0gfSApIHsKCiAgICAgICAgICAgICMgS0lYQ29yZS1jYXBlSVQKICAgICAgICAgICAgIyBteSAkU2tpbkZpbGUgPSAiJFBhcmFte1NraW5Ib21lfS8kUGFyYW17U2tpblR5cGV9LyRTa2luL2Nzcy8kQ1NTRmlsZSI7CiAgICAgICAgICAgIG15ICRTa2luRmlsZTsKICAgICAgICAgICAgbXkgJENTU0RpcmVjdG9yeTsKCiAgICAgICAgICAgICRTa2luRmlsZSA9CiAgICAgICAgICAgICAgICAkUGFyYW17U2tpbkhvbWV9IC4gIi8iCiAgICAgICAgICAgICAgICAuICRQYXJhbXtTa2luVHlwZX0gLiAiLyIKICAgICAgICAgICAgICAgIC4gJFNraW4gLiAiLyIKICAgICAgICAgICAgICAgIC4gImNzcy1jYWNoZS9jc3MvIgogICAgICAgICAgICAgICAgLiAkQ1NTRmlsZTsKCiAgICAgICAgICAgIG5leHQgQ1NTRklMRSBpZiAhKCAtZSAkU2tpbkZpbGUgKTsKCiAgICAgICAgICAgICMgRU8gS0lYQ29yZS1jYXBlSVQKCiAgICAgICAgICAgIGlmICggJFBhcmFte0RvTWluaWZ5fSApIHsKICAgICAgICAgICAgICAgIHB1c2ggQEZpbGVMaXN0LCAkU2tpbkZpbGU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkU2VsZi0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAkUGFyYW17QmxvY2tOYW1lfSwKICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgU2tpbiA9PiAkU2tpbiwKCiAgICAgICAgICAgICAgICAgICAgICAgICMgS0lYQ29yZS1jYXBlSVQKICAgICAgICAgICAgICAgICAgICAgICAgIyBDU1NEaXJlY3RvcnkgPT4gJ2NzcycsCiAgICAgICAgICAgICAgICAgICAgICAgIENTU0RpcmVjdG9yeSA9PiAiY3NzLWNhY2hlL2NzcyIsCgogICAgICAgICAgICAgICAgICAgICAgICAjIEVPIEtJWENvcmUtY2FwZUlUCiAgICAgICAgICAgICAgICAgICAgICAgIEZpbGVuYW1lID0+ICRDU1NGaWxlLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIEtJWENvcmUtY2FwZUlUCiAgICAgICAgaWYgKCAkUGFyYW17RG9NaW5pZnl9ICkgewoKICAgICAgICAgICAgIyBjcmVhdGUgY2FjaGUgZGlyZWN0b3J5IGZvciBwYWNrYWdlIHNraW5zIChzdG9yZWQgaW4gc3ViZGlyZWN0b3J5KQogICAgICAgICAgICBteSAkS0lYQ2FjaGVEaXJlY3RvcnkgPQogICAgICAgICAgICAgICAgJFBhcmFte1NraW5Ib21lfSAuICIvIiAuICRQYXJhbXtTa2luVHlwZX0gLiAiLyIgLiAkU2tpbiAuICIvY3NzLWNhY2hlL2Nzcy8iOwogICAgICAgICAgICBpZiAoICEtZSAkS0lYQ2FjaGVEaXJlY3RvcnkgKSB7CiAgICAgICAgICAgICAgICBpZiAoICFta3BhdGgoICRLSVhDYWNoZURpcmVjdG9yeSwgMCwgMDc1NSApICkgewogICAgICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiQ2FuJ3QgY3JlYXRlIGRpcmVjdG9yeSAnJEtJWENhY2hlRGlyZWN0b3J5JzogJCEiLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIHJlZiBcQEZpbGVMaXN0IGVxICdBUlJBWScgJiYgc2NhbGFyIEBGaWxlTGlzdCApIHsKCiAgICAgICAgICAgICAgICAjIEVPIEtJWENvcmUtY2FwZUlUCiAgICAgICAgICAgICAgICBteSAkTWluaWZpZWRGaWxlID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvYWRlcicpLT5NaW5pZnlGaWxlcygKICAgICAgICAgICAgICAgICAgICBMaXN0ID0+IFxARmlsZUxpc3QsCiAgICAgICAgICAgICAgICAgICAgVHlwZSA9PiAnQ1NTJywKCiAgICAgICAgICAgICAgICAgICAgIyBLSVhDb3JlLWNhcGVJVAogICAgICAgICAgICAgICAgICAgICMgVGFyZ2V0RGlyZWN0b3J5ICAgICAgPT4gIiRQYXJhbXtTa2luSG9tZX0vJFBhcmFte1NraW5UeXBlfS8kU2tpbi9jc3MtY2FjaGUvIiwKICAgICAgICAgICAgICAgICAgICBUYXJnZXREaXJlY3RvcnkgPT4gJEtJWENhY2hlRGlyZWN0b3J5LAoKICAgICAgICAgICAgICAgICAgICAjIEVPIEtJWENvcmUtY2FwZUlUCiAgICAgICAgICAgICAgICAgICAgVGFyZ2V0RmlsZW5hbWVQcmVmaXggPT4gJFBhcmFte0Jsb2NrTmFtZX0sCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICRTZWxmLT5CbG9jaygKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICRQYXJhbXtCbG9ja05hbWV9LAogICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBTa2luID0+ICRTa2luLAoKICAgICAgICAgICAgICAgICAgICAgICAgIyBLSVhDb3JlLWNhcGVJVAogICAgICAgICAgICAgICAgICAgICAgICAjIENTU0RpcmVjdG9yeSA9PiAnY3NzLWNhY2hlJywKICAgICAgICAgICAgICAgICAgICAgICAgQ1NTRGlyZWN0b3J5ID0+ICdjc3MtY2FjaGUvY3NzJywKCiAgICAgICAgICAgICAgICAgICAgICAgICMgRU8gS0lYQ29yZS1jYXBlSVQKICAgICAgICAgICAgICAgICAgICAgICAgRmlsZW5hbWUgPT4gJE1pbmlmaWVkRmlsZSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAjIEtJWENvcmUtY2FwZUlUCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgRU8gS0lYQ29yZS1jYXBlSVQKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIDE7Cn0KCiMgS0lYQ29yZS1jYXBlSVQKc3ViIF9Db3B5VGhpcmRQYXJ0eUZpbGVzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgQEZpbGVMaXN0ICAgPSBAeyAkUGFyYW17RmlsZUxpc3R9IH07CiAgICBteSAkU291cmNlUGF0aCA9ICRQYXJhbXtTb3VyY2VQYXRofTsKICAgIG15ICRUYXJnZXRQYXRoID0gJFBhcmFte1RhcmdldFBhdGh9OwoKICAgIGZvciBteSAkRmlsZSAoQEZpbGVMaXN0KSB7CiAgICAgICAgaWYgKCAtZCAkU291cmNlUGF0aCAuICRGaWxlICkgewogICAgICAgICAgICBteSAkTmV3U291cmNlUGF0aCA9ICRTb3VyY2VQYXRoIC4gJEZpbGUgLiAiLyI7CiAgICAgICAgICAgIG15ICROZXdUYXJnZXRQYXRoID0gJFRhcmdldFBhdGggLiAkRmlsZSAuICIvIjsKCiAgICAgICAgICAgIG9wZW5kaXIoIERJUiwgJE5ld1NvdXJjZVBhdGggKTsKICAgICAgICAgICAgbXkgQEZpbGVzID0gZ3JlcCB7ICEvXigufC4uKSQvZyB9IHJlYWRkaXIoRElSKTsKICAgICAgICAgICAgY2xvc2VkaXIoRElSKTsKCiAgICAgICAgICAgIGlmICggISggLWUgJE5ld1RhcmdldFBhdGggKSApIHsKCiAgICAgICAgICAgICAgICBpZiAoICFta3BhdGgoICROZXdUYXJnZXRQYXRoLCAwLCAwNzU1ICkgKSB7CiAgICAgICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDYW4ndCBjcmVhdGUgZGlyZWN0b3J5ICckTmV3VGFyZ2V0UGF0aCc6ICQhIiwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJFNlbGYtPl9Db3B5VGhpcmRQYXJ0eUZpbGVzKAogICAgICAgICAgICAgICAgRmlsZUxpc3QgICA9PiBcQEZpbGVzLAogICAgICAgICAgICAgICAgU291cmNlUGF0aCA9PiAkTmV3U291cmNlUGF0aCwKICAgICAgICAgICAgICAgIFRhcmdldFBhdGggPT4gJE5ld1RhcmdldFBhdGgKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CgogICAgICAgICAgICAjIGNoZWNrIGlmIGZpbGUgZG9lcyBub3QgZXhpc3QKICAgICAgICAgICAgaWYgKCAhLWUgJFRhcmdldFBhdGggLiAkRmlsZSApIHsKICAgICAgICAgICAgICAgIGNvcHkoICRTb3VyY2VQYXRoIC4gJEZpbGUsICRUYXJnZXRQYXRoIC4gJEZpbGUgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBjaGVjayBpZiBmaWxlIGhhcyBjaGFuZ2VkCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgbXkgJFRhcmdldEZpbGVTaXplID0gLXMgJFRhcmdldFBhdGggLiAkRmlsZTsKICAgICAgICAgICAgICAgIG15ICRTb3VyY2VGaWxlU2l6ZSA9IC1zICRTb3VyY2VQYXRoIC4gJEZpbGU7CgogICAgICAgICAgICAgICAgIyBjb3B5IGZpbGUgaWYgY2hhbmdlZAogICAgICAgICAgICAgICAgaWYgKCAkVGFyZ2V0RmlsZVNpemUgIT0gJFNvdXJjZUZpbGVTaXplICkgewogICAgICAgICAgICAgICAgICAgIG15ICRvayA9IGNvcHkoICRTb3VyY2VQYXRoIC4gJEZpbGUsICRUYXJnZXRQYXRoIC4gJEZpbGUgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gMTsKfQoKIyBFTyBLSVhDb3JlLWNhcGVJVAoKc3ViIF9IYW5kbGVKU0xpc3QgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSBARmlsZUxpc3Q7CgogICAgIyBLSVhDb3JlLWNhcGVJVAogICAgbXkgJEhvbWUgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ0hvbWUnKTsKCiAgICBteSBAUGFja2FnZXNQYXRoczsKICAgIGZvciBteSAkUGFja2FnZSAoQElOQykgewogICAgICAgIG5leHQgaWYgKCAkUGFja2FnZSAhfiBtL14kSG9tZSguKikvIHx8ICRQYWNrYWdlID1+IG0vXiRIb21lXC9iaW4vICk7CiAgICAgICAgcHVzaCBAUGFja2FnZXNQYXRocywgJFBhY2thZ2U7CiAgICB9CgogICAgbXkgQFVzZWRGaWxlcyA9ICgpOwoKICAgICMgRU8gS0lYQ29yZS1jYXBlSVQKCiAgICBmb3IgbXkgJEpTRmlsZSAoIEB7ICRQYXJhbXtMaXN0fSB9ICkgewoKICAgICAgICAjIEtJWENvcmUtY2FwZUlUCiAgICAgICAgbmV4dCBpZiBncmVwIHsgJF8gZXEgJEpTRmlsZSB9IEBVc2VkRmlsZXM7CgogICAgICAgICMgY2hlY2sgcGFja2FnZXMKICAgICAgICBteSAkSlNIb21lID0gJFBhcmFte0pTSG9tZX07CiAgICAgICAgZm9yIG15ICRQYXRoIChAUGFja2FnZXNQYXRocykgewogICAgICAgICAgICBuZXh0IGlmICggIS1lICRQYXRoIC4gJy92YXIvaHR0cGQvaHRkb2NzL2pzLycgLiAkSlNGaWxlICk7CiAgICAgICAgICAgICRKU0hvbWUgPSAkUGF0aCAuICcvdmFyL2h0dHBkL2h0ZG9jcy9qcyc7CiAgICAgICAgICAgIGxhc3Q7CiAgICAgICAgfQogICAgICAgIHB1c2ggQFVzZWRGaWxlcywgJEpTRmlsZTsKCiAgICAgICAgIyBFTyBLSVhDb3JlLWNhcGVJVAoKICAgICAgICBpZiAoICRQYXJhbXtEb01pbmlmeX0gKSB7CgogICAgICAgICAgICAjIEtJWENvcmUtY2FwZUlUCiAgICAgICAgICAgICMgcHVzaCBARmlsZUxpc3QsICIkUGFyYW17SlNIb21lfS8kSlNGaWxlIjsKICAgICAgICAgICAgcHVzaCBARmlsZUxpc3QsICIkSlNIb21lLyRKU0ZpbGUiOwoKICAgICAgICAgICAgIyBFTyBLSVhDb3JlLWNhcGVJVAogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFNlbGYtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAkUGFyYW17QmxvY2tOYW1lfSwKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgIEpTRGlyZWN0b3J5ID0+ICcnLAogICAgICAgICAgICAgICAgICAgIEZpbGVuYW1lICAgID0+ICRKU0ZpbGUsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoICRQYXJhbXtEb01pbmlmeX0gJiYgQEZpbGVMaXN0ICkgewogICAgICAgIG15ICRNaW5pZmllZEZpbGUgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9hZGVyJyktPk1pbmlmeUZpbGVzKAogICAgICAgICAgICBMaXN0ICAgICAgICAgICAgICAgICA9PiBcQEZpbGVMaXN0LAogICAgICAgICAgICBUeXBlICAgICAgICAgICAgICAgICA9PiAnSmF2YVNjcmlwdCcsCiAgICAgICAgICAgIFRhcmdldERpcmVjdG9yeSAgICAgID0+ICIkUGFyYW17SlNIb21lfS9qcy1jYWNoZS8iLAogICAgICAgICAgICBUYXJnZXRGaWxlbmFtZVByZWZpeCA9PiAkUGFyYW17QmxvY2tOYW1lfSwKICAgICAgICApOwoKICAgICAgICAkU2VsZi0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJFBhcmFte0Jsb2NrTmFtZX0sCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgSlNEaXJlY3RvcnkgPT4gJ2pzLWNhY2hlLycsCiAgICAgICAgICAgICAgICBGaWxlbmFtZSAgICA9PiAkTWluaWZpZWRGaWxlLAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CiAgICByZXR1cm4gMTsKfQoKPWl0ZW0gU2tpblZhbGlkYXRlKCkKClJldHVybnMgMSBpZiBza2luIGlzIGF2YWlsYWJsZSBmb3IgQWdlbnQgb3IgQ3VzdG9tZXIgZnJvbnRlbmRzIGFuZCAwIGlmIG5vdC4KCiAgICBteSAkU2tpbklzVmFsaWQgPSAkTGF5b3V0T2JqZWN0LT5Ta2luVmFsaWRhdGUoCiAgICAgICAgVXNlclR5cGUgPT4gJ0FnZW50JyAgICAgIyAgQWdlbnQgb3IgQ3VzdG9tZXIsCiAgICAgICAgU2tpbiA9PiAnRXhhbXBsZVNraW4nLAogICAgKTsKCj1jdXQKCnN1YiBTa2luVmFsaWRhdGUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBmb3IgbXkgJE5lZWRlZCAoICdTa2luVHlwZScsICdTa2luJyApIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5lZWRlZCBwYXJhbTogJE5lZWRlZCEiLAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoIGV4aXN0cyAkU2VsZi0+e1NraW5WYWxpZGF0ZUNhY2hlfS0+eyAkUGFyYW17U2tpblR5cGV9IC4gJzo6JyAuICRQYXJhbXtTa2lufSB9ICkgewogICAgICAgIHJldHVybiAkU2VsZi0+e1NraW5WYWxpZGF0ZUNhY2hlfS0+eyAkUGFyYW17U2tpblR5cGV9IC4gJzo6JyAuICRQYXJhbXtTa2lufSB9OwogICAgfQoKICAgICMgZ2V0IGNvbmZpZyBvYmplY3QKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgIG15ICRTa2luVHlwZSAgICAgID0gJFBhcmFte1NraW5UeXBlfTsKICAgIG15ICRQb3NzaWJsZVNraW5zID0gJENvbmZpZ09iamVjdC0+R2V0KCJMb2FkZXI6OiR7U2tpblR5cGV9OjpTa2luIikgfHwge307CiAgICBteSAkSG9tZSAgICAgICAgICA9ICRDb25maWdPYmplY3QtPkdldCgnSG9tZScpOwogICAgbXkgJUFjdGl2ZVNraW5zOwoKICAgICMgcHJlcGFyZSB0aGUgbGlzdCBvZiBhY3RpdmUgc2tpbnMKICAgIGZvciBteSAkUG9zc2libGVTa2luICggdmFsdWVzICV7JFBvc3NpYmxlU2tpbnN9ICkgewogICAgICAgIGlmICggJFBvc3NpYmxlU2tpbi0+e0ludGVybmFsTmFtZX0gZXEgJFBhcmFte1NraW59ICkgewogICAgICAgICAgICBteSAkU2tpbkRpciA9ICRIb21lIC4gIi92YXIvaHR0cGQvaHRkb2NzL3NraW5zLyRTa2luVHlwZS8iIC4gJFBvc3NpYmxlU2tpbi0+e0ludGVybmFsTmFtZX07CiAgICAgICAgICAgIGlmICggLWQgJFNraW5EaXIgKSB7CiAgICAgICAgICAgICAgICAkU2VsZi0+e1NraW5WYWxpZGF0ZUNhY2hlfS0+eyAkUGFyYW17U2tpblR5cGV9IC4gJzo6JyAuICRQYXJhbXtTa2lufSB9ID0gMTsKICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICRTZWxmLT57U2tpblZhbGlkYXRlQ2FjaGV9LT57ICRQYXJhbXtTa2luVHlwZX0gLiAnOjonIC4gJFBhcmFte1NraW59IH0gPSB1bmRlZjsKICAgIHJldHVybjsKfQoKMTsKCj1iYWNrCgo9aGVhZDEgVEVSTVMgQU5EIENPTkRJVElPTlMKClRoaXMgc29mdHdhcmUgaXMgcGFydCBvZiB0aGUgT1RSUyBwcm9qZWN0IChMPGh0dHA6Ly9vdHJzLm9yZy8+KS4KClRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCnRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEFHUEwpLiBJZiB5b3UKZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIEw8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2FncGwudHh0Pi4KCj1jdXQK</File>
        <File Location="KIXCore/Kernel/Output/HTML/Layout/Template.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDE2IE9UUlMgQUcsIGh0dHA6Ly9vdHJzLmNvbS8KIyBLSVhDb3JlLUV4dGVuc2lvbnMgQ29weXJpZ2h0IChDKSAyMDA2LTIwMTYgYy5hLnAuZS4gSVQgR21iSCwgaHR0cDovL3d3dy5jYXBlLWl0LmRlCiMKIyB3cml0dGVuL2VkaXRlZCBieToKIyAqIERvcm90aGVhKGRvdClEb2VyZmZlbChhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMKIyAtLQojIFRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCiMgdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoQUdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvYWdwbC50eHQuCiMgLS0KCnBhY2thZ2UgS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dDo6VGVtcGxhdGU7Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7Cgp1c2UgU2NhbGFyOjpVdGlsIHF3KCk7CnVzZSBUZW1wbGF0ZTsKdXNlIFRlbXBsYXRlOjpTdGFzaDo6WFM7CnVzZSBUZW1wbGF0ZTo6Q29udGV4dDsKdXNlIFRlbXBsYXRlOjpQbHVnaW5zOwoKdXNlIEtlcm5lbDo6T3V0cHV0OjpUZW1wbGF0ZTo6UHJvdmlkZXI7CgpvdXIgJE9iamVjdE1hbmFnZXJEaXNhYmxlZCA9IDE7Cgo9aGVhZDEgTkFNRQoKS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dFRlbXBsYXRlIC0gdGVtcGxhdGUgcmVuZGVyaW5nIGVuZ2luZSBiYXNlZCBvbiBUZW1wbGF0ZTo6VG9vbGtpdAoKPWhlYWQxIFBVQkxJQyBJTlRFUkZBQ0UKCj1vdmVyIDQKCj1pdGVtIE91dHB1dCgpCgpnZW5lcmF0ZXMgSFRNTCBvdXRwdXQgYmFzZWQgb24gYSB0ZW1wbGF0ZSBmaWxlLgoKVXNpbmcgYSB0ZW1wbGF0ZSBmaWxlOgoKICAgIG15ICRIVE1MID0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQWRtaW5Mb2cudHQnLAogICAgICAgIERhdGEgICAgICAgICA9PiBcJVBhcmFtLAogICAgKTsKClVzaW5nIGEgdGVtcGxhdGUgc3RyaW5nOgoKICAgIG15ICRIVE1MID0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlID0+ICc8Yj5bJSBEYXRhLlNvbWVLZXkgfCBodG1sICVdPC9iPicsCiAgICAgICAgRGF0YSAgICAgPT4gXCVQYXJhbSwKICAgICk7CgpBZGRpdGlvbmFsIHBhcmFtZXRlcnM6CgogICAgS2VlcFNjcmlwdFRhZ3MgLSB0aGlzIGNhdXNlcyBbJSBXUkFQUEVSIEpTT25Eb2N1bWVudENvbXBsZXRlICVdIGJsb2NrcyBOT1QKICAgICAgICB0byBiZSByZXBsYWNlZC4gVGhpcyBpcyBpbXBvcnRhbnQgdG8gYmUgYWJsZSB0byBnZW5lcmF0ZSBzbmlwcGV0cyB3aGljaCBjYW4gYmUgY2FjaGVkLgoKICAgIG15ICRIVE1MID0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSAgID0+ICdBZG1pbkxvZy50dCcsCiAgICAgICAgRGF0YSAgICAgICAgICAgPT4gXCVQYXJhbSwKICAgICAgICBLZWVwU2NyaXB0VGFncyA9PiAxLAogICAgKTsKCj1jdXQKCnN1YiBPdXRwdXQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAkUGFyYW17RGF0YX0gfHw9IHt9OwoKICAgICMgZ2V0IGFuZCBjaGVjayBwYXJhbSBEYXRhCiAgICBpZiAoIHJlZiAkUGFyYW17RGF0YX0gbmUgJ0hBU0gnICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCBIYXNoUmVmIGluIFBhcmFtIERhdGEhIEdvdDogJyIgLiByZWYgJFBhcmFte0RhdGF9IC4gIichIiwKICAgICAgICApOwogICAgICAgICRTZWxmLT5GYXRhbEVycm9yKCk7CiAgICB9CgogICAgIyBmaWxsIGluaXQgRW52CiAgICBpZiAoICEkU2VsZi0+e0VudlJlZn0gKSB7CiAgICAgICAgJXsgJFNlbGYtPntFbnZSZWZ9IH0gPSAlRU5WOwoKICAgICAgICAjIGFsbCAkU2VsZi0+eyp9CiAgICAgICAgZm9yICggc29ydCBrZXlzICV7JFNlbGZ9ICkgewogICAgICAgICAgICBpZiAoIGRlZmluZWQgJFNlbGYtPnskX30gJiYgIXJlZiAkU2VsZi0+eyRffSApIHsKICAgICAgICAgICAgICAgICRTZWxmLT57RW52UmVmfS0+eyRffSA9ICRTZWxmLT57JF99OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgYWRkIG5ldyBlbnYKICAgIGlmICggJFNlbGYtPntFbnZOZXdSZWZ9ICkgewogICAgICAgIGZvciAoICV7ICRTZWxmLT57RW52TmV3UmVmfSB9ICkgewogICAgICAgICAgICAkU2VsZi0+e0VudlJlZn0tPnskX30gPSAkU2VsZi0+e0Vudk5ld1JlZn0tPnskX307CiAgICAgICAgfQogICAgICAgIHVuZGVmICRTZWxmLT57RW52TmV3UmVmfTsKICAgIH0KCiAgICAjIGlmIHdlIHVzZSB0aGUgSFRNTDUgaW5wdXQgdHlwZSAnZW1haWwnIGpRdWVyeSBWYWxpZGF0ZSB3aWxsIGFsd2F5cyB2YWxpZGF0ZQogICAgIyB3ZSBkbyBub3Qgd2FudCB0aGF0IGlmIENoZWNrRW1haWxBZGRyZXNzZXMgaXMgc2V0IHRvICdubycgaW4gU3lzQ29uZmlnCiAgICAkU2VsZi0+e0VudlJlZn0tPntFbWFpbEZpZWxkVHlwZX0KICAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnQ2hlY2tFbWFpbEFkZHJlc3NlcycpID8gJ2VtYWlsJyA6ICd0ZXh0JzsKCiAgICBteSBAVGVtcGxhdGVGb2xkZXJzID0gKAogICAgICAgICIkU2VsZi0+e0N1c3RvbVRlbXBsYXRlRGlyfSIsCiAgICAgICAgIiRTZWxmLT57Q3VzdG9tU3RhbmRhcmRUZW1wbGF0ZURpcn0iLAogICAgICAgICIkU2VsZi0+e1RlbXBsYXRlRGlyfSIsCiAgICAgICAgIiRTZWxmLT57U3RhbmRhcmRUZW1wbGF0ZURpcn0iLAogICAgKTsKCiAgICAjIEtJWENvcmUtY2FwZUlUCiAgICBteSBAS0lYVGVtcGxhdGVGb2xkZXJzID0gKCk7CiAgICBmb3JlYWNoIG15ICRUbXBEaXIgKEBJTkMpIHsKICAgICAgICBsYXN0IGlmICRUbXBEaXIgPX4gL1wvYmluXC9DdXN0b20kLzsKICAgICAgICBuZXh0IGlmIGdyZXAgeyAkXyBlcSAkVG1wRGlyLiIvS2VybmVsL091dHB1dC9IVE1ML1RlbXBsYXRlcy9TdGFuZGFyZCIgfSBAS0lYVGVtcGxhdGVGb2xkZXJzOwogICAgICAgIHB1c2ggQEtJWFRlbXBsYXRlRm9sZGVycywgJFRtcERpci4iL0tlcm5lbC9PdXRwdXQvSFRNTC9UZW1wbGF0ZXMvU3RhbmRhcmQiOwogICAgfQoKICAgIEBUZW1wbGF0ZUZvbGRlcnMgPSAoIEBLSVhUZW1wbGF0ZUZvbGRlcnMsIEBUZW1wbGF0ZUZvbGRlcnMgKTsKICAgICMgRU8gS0lYQ29yZS1jYXBlSVQKCiAgICBteSAkVGVtcGxhdGVTdHJpbmc7CgogICAgaWYgKCAkUGFyYW17VGVtcGxhdGVGaWxlfSApIHsKICAgICAgICAkUGFyYW17VGVtcGxhdGVGaWxlVFR9IC49ICIkUGFyYW17VGVtcGxhdGVGaWxlfS50dCI7CiAgICB9CgogICAgIyB0YWtlIHRlbXBsYXRlcyBmcm9tIHN0cmluZy9hcnJheQogICAgZWxzaWYgKCBkZWZpbmVkICRQYXJhbXtUZW1wbGF0ZX0gJiYgcmVmICRQYXJhbXtUZW1wbGF0ZX0gZXEgJ0FSUkFZJyApIHsKICAgICAgICBmb3IgKCBAeyAkUGFyYW17VGVtcGxhdGV9IH0gKSB7CiAgICAgICAgICAgICRUZW1wbGF0ZVN0cmluZyAuPSAkXzsKICAgICAgICB9CiAgICB9CiAgICBlbHNpZiAoIGRlZmluZWQgJFBhcmFte1RlbXBsYXRlfSApIHsKICAgICAgICAkVGVtcGxhdGVTdHJpbmcgPSAkUGFyYW17VGVtcGxhdGV9OwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdOZWVkIFRlbXBsYXRlIG9yIFRlbXBsYXRlRmlsZSBQYXJhbSEnLAogICAgICAgICk7CiAgICAgICAgJFNlbGYtPkZhdGFsRXJyb3IoKTsKICAgIH0KCiAgICBpZiAoICEkU2VsZi0+e1RlbXBsYXRlT2JqZWN0fSApIHsKCiAgICAgICAgJFNlbGYtPntUZW1wbGF0ZVByb3ZpZGVyT2JqZWN0fSA9IEtlcm5lbDo6T3V0cHV0OjpUZW1wbGF0ZTo6UHJvdmlkZXItPm5ldygKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgSU5DTFVERV9QQVRIID0+IFxAVGVtcGxhdGVGb2xkZXJzLAogICAgICAgICAgICAgICAgRVZBTF9QRVJMICAgID0+IDEsCiAgICAgICAgICAgICAgICBDT01QSUxFX0VYVCAgPT4gJy50dGMnLAogICAgICAgICAgICB9CiAgICAgICAgKTsKICAgICAgICAkU2VsZi0+e1RlbXBsYXRlUHJvdmlkZXJPYmplY3R9LT5PVFJTSW5pdCgKICAgICAgICAgICAgTGF5b3V0T2JqZWN0ID0+ICRTZWxmLAogICAgICAgICk7CgogICAgICAgIG15ICRQbHVnaW5zID0gVGVtcGxhdGU6OlBsdWdpbnMtPm5ldygKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgUExVR0lOX0JBU0UgPT4gJ0tlcm5lbDo6T3V0cHV0OjpUZW1wbGF0ZTo6UGx1Z2luJywKICAgICAgICAgICAgfQogICAgICAgICk7CgogICAgICAgIG15ICRDb250ZXh0ID0gVGVtcGxhdGU6OkNvbnRleHQtPm5ldygKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgRVZBTF9QRVJMICAgICAgPT4gMSwKICAgICAgICAgICAgICAgIFNUQVNIICAgICAgICAgID0+IFRlbXBsYXRlOjpTdGFzaDo6WFMtPm5ldygpLAogICAgICAgICAgICAgICAgTE9BRF9URU1QTEFURVMgPT4gWyAkU2VsZi0+e1RlbXBsYXRlUHJvdmlkZXJPYmplY3R9IF0sCiAgICAgICAgICAgICAgICBMT0FEX1BMVUdJTlMgICA9PiBbJFBsdWdpbnNdLAogICAgICAgICAgICB9CiAgICAgICAgKTsKCiAgICAgICAgIyBTdG9yZSBhIHdlYWsgcmVmZXJlbmNlIHRvIHRoZSBMYXlvdXRPYmplY3QgaW4gdGhlIGNvbnRleHQKICAgICAgICAjICAgdG8gYXZvaWQgcmluZyByZWZlcmVuY2VzLiBXZSBuZWVkIGl0IGZvciB0aGUgcGx1Z2lucy4KICAgICAgICAkQ29udGV4dC0+e0xheW91dE9iamVjdH0gPSAkU2VsZjsKICAgICAgICBTY2FsYXI6OlV0aWw6OndlYWtlbiggJENvbnRleHQtPntMYXlvdXRPYmplY3R9ICk7CgogICAgICAgIG15ICRTdWNjZXNzID0gJFNlbGYtPntUZW1wbGF0ZU9iamVjdH0gPSBUZW1wbGF0ZS0+bmV3KAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBDT05URVhUID0+ICRDb250ZXh0LAoKICAgICAgICAgICAgICAgICNERUJVRyA9PiBUZW1wbGF0ZTo6Q29uc3RhbnRzOjpERUJVR19BTEwsCiAgICAgICAgICAgIH0KICAgICAgICApOwoKICAgICAgICBpZiAoICEkU3VjY2VzcyApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIiRUZW1wbGF0ZTo6RVJST1I7IiwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgJFNlbGYtPkZhdGFsRXJyb3IoKTsgIyBEb24ndCB1c2UgRmF0YWxFcnJvciBoZXJlLCBtaWdodCBjYXVzZSBpbmZpbml0ZSByZWN1cnNpb24KICAgICAgICAgICAgZGllICIkVGVtcGxhdGU6OkVSUk9SXG4iOwogICAgICAgIH0KICAgIH0KCiAgICBteSAkT3V0cHV0OwogICAgbXkgJFN1Y2Nlc3MgPSAkU2VsZi0+e1RlbXBsYXRlT2JqZWN0fS0+cHJvY2VzcygKICAgICAgICAkUGFyYW17VGVtcGxhdGVGaWxlVFR9IC8vIFwkVGVtcGxhdGVTdHJpbmcsCiAgICAgICAgewogICAgICAgICAgICBEYXRhID0+ICRQYXJhbXtEYXRhfSAvLyB7fSwKICAgICAgICAgICAgZ2xvYmFsID0+IHsKICAgICAgICAgICAgICAgIEJsb2NrRGF0YSAgICAgID0+ICRTZWxmLT57QmxvY2tEYXRhfSAgICAgLy8gW10sCiAgICAgICAgICAgICAgICBLZWVwU2NyaXB0VGFncyA9PiAkUGFyYW17S2VlcFNjcmlwdFRhZ3N9IC8vIDAsCiAgICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICBcJE91dHB1dCwKICAgICk7CiAgICBpZiAoICEkU3VjY2VzcyApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJFNlbGYtPntUZW1wbGF0ZU9iamVjdH0tPmVycm9yKCksCiAgICAgICAgKTsKICAgICAgICAkU2VsZi0+RmF0YWxFcnJvcigpOwogICAgfQoKICAgICMgSWYgdGhlIGJyb3dzZXIgZG9lcyBub3Qgc2VuZCB0aGUgc2Vzc2lvbiBjb29raWUsIHdlIG5lZWQgdG8gYXBwZW5kIGl0IHRvIGFsbCBsaW5rcyBhbmQgaW1hZ2UgdXJscy4KICAgICMgICBXZSBjYW5ub3QgZG8gdGhpcyBpbiB0aGUgdGVtcGxhdGUgcHJlcHJvY2Vzc29yIGJlY2F1c2UgbGlua3MgYXJlIG9mdGVuIGR5bmFtaWNhbGx5IGdlbmVyYXRlZC4KICAgIGlmICggJFNlbGYtPntTZXNzaW9uSUR9ICYmICEkU2VsZi0+e1Nlc3Npb25JRENvb2tpZX0gKSB7CgogICAgICAgICMgcmV3cml0ZSBhIGhyZWZzCiAgICAgICAgJE91dHB1dCA9fiBzewogICAgICAgICAgICAoPGEuKz9ocmVmPSIpKC4rPykoXCMuKz98KSgiLis/PikKICAgICAgICB9CiAgICAgICAgewogICAgICAgICAgICBteSAkQUhyZWYgICA9ICQxOwogICAgICAgICAgICBteSAkVGFyZ2V0ICA9ICQyOwogICAgICAgICAgICBteSAkRW5kICAgICA9ICQzOwogICAgICAgICAgICBteSAkUmVhbEVuZCA9ICQ0OwogICAgICAgICAgICBpZiAoIGxjICRUYXJnZXQgPX4gL14oaHR0cDp8aHR0cHM6fCN8ZnRwOikvIHx8CiAgICAgICAgICAgICAgICAkVGFyZ2V0ICF+IC9cLihwbHxwaHB8Y2dpfGZjZ3xmY2dpfGZwbCkoXD98JCkvIHx8CiAgICAgICAgICAgICAgICAkVGFyZ2V0ID1+IC8oXD98Jnw7KVxRJFNlbGYtPntTZXNzaW9uTmFtZX1cRT0vKSB7CiAgICAgICAgICAgICAgICAkQUhyZWYuJFRhcmdldC4kRW5kLiRSZWFsRW5kOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJEFIcmVmLiRUYXJnZXQuJzsnLiRTZWxmLT57U2Vzc2lvbk5hbWV9Lic9Jy4kU2VsZi0+e1Nlc3Npb25JRH0uJEVuZC4kUmVhbEVuZDsKICAgICAgICAgICAgfQogICAgICAgIH1pZWd4czsKCiAgICAgICAgIyByZXdyaXRlIGltZyBhbmQgaWZyYW1lIHNyYwogICAgICAgICRPdXRwdXQgPX4gc3sKICAgICAgICAgICAgKDwoPzppbWd8aWZyYW1lKS4rP3NyYz0iKSguKz8pKCIuKz8+KQogICAgICAgIH0KICAgICAgICB7CiAgICAgICAgICAgIG15ICRBSHJlZiA9ICQxOwogICAgICAgICAgICBteSAkVGFyZ2V0ID0gJDI7CiAgICAgICAgICAgIG15ICRFbmQgPSAkMzsKICAgICAgICAgICAgaWYgKGxjICRUYXJnZXQgPX4gbXteaHR0cCBzPyA6fXNteCB8fCAhJFNlbGYtPntTZXNzaW9uSUR9IHx8CiAgICAgICAgICAgICAgICAkVGFyZ2V0ICF+IC9cLihwbHxwaHB8Y2dpfGZjZ3xmY2dpfGZwbCkoXD98JCkvIHx8CiAgICAgICAgICAgICAgICAkVGFyZ2V0ID1+IC9cUSRTZWxmLT57U2Vzc2lvbk5hbWV9XEU9LykgewogICAgICAgICAgICAgICAgJEFIcmVmLiRUYXJnZXQuJEVuZDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRBSHJlZi4kVGFyZ2V0LicmJy4kU2VsZi0+e1Nlc3Npb25OYW1lfS4nPScuJFNlbGYtPntTZXNzaW9uSUR9LiRFbmQ7CiAgICAgICAgICAgIH0KICAgICAgICB9aWVneHM7CiAgICB9CgogICAgIwogICAgIyAiUG9zdCIgT3V0cHV0IGZpbHRlciBoYW5kbGluZwogICAgIwogICAgaWYgKCAkU2VsZi0+e0ZpbHRlckVsZW1lbnRQb3N0fSAmJiByZWYgJFNlbGYtPntGaWx0ZXJFbGVtZW50UG9zdH0gZXEgJ0hBU0gnICkgewoKICAgICAgICAjIGV4dHJhY3QgZmlsdGVyIGxpc3QKICAgICAgICBteSAlRmlsdGVyTGlzdCA9ICV7ICRTZWxmLT57RmlsdGVyRWxlbWVudFBvc3R9IH07CgogICAgICAgIG15ICRNYWluT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKTsKCiAgICAgICAgRklMVEVSOgogICAgICAgIGZvciBteSAkRmlsdGVyICggc29ydCBrZXlzICVGaWx0ZXJMaXN0ICkgewoKICAgICAgICAgICAgIyBleHRyYWN0IGZpbHRlciBjb25maWcKICAgICAgICAgICAgbXkgJEZpbHRlckNvbmZpZyA9ICRGaWx0ZXJMaXN0eyRGaWx0ZXJ9OwoKICAgICAgICAgICAgIyBleHRyYWN0IHRlbXBsYXRlIGxpc3QKICAgICAgICAgICAgbXkgJVRlbXBsYXRlTGlzdCA9ICV7ICRGaWx0ZXJDb25maWctPntUZW1wbGF0ZXN9IHx8IHt9IH07CgogICAgICAgICAgICBuZXh0IEZJTFRFUiBpZiAhJFBhcmFte1RlbXBsYXRlRmlsZX07CiAgICAgICAgICAgIG5leHQgRklMVEVSIGlmICEkVGVtcGxhdGVMaXN0eyAkUGFyYW17VGVtcGxhdGVGaWxlfSB9OwoKICAgICAgICAgICAgbmV4dCBGSUxURVIgaWYgISRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyktPlJlcXVpcmUoICRGaWx0ZXJDb25maWctPntNb2R1bGV9ICk7CgogICAgICAgICAgICAjIGNyZWF0ZSBuZXcgaW5zdGFuY2UKICAgICAgICAgICAgbXkgJE9iamVjdCA9ICRGaWx0ZXJDb25maWctPntNb2R1bGV9LT5uZXcoCiAgICAgICAgICAgICAgICAleyRTZWxmfSwKICAgICAgICAgICAgICAgIExheW91dE9iamVjdCA9PiAkU2VsZiwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIG5leHQgRklMVEVSIGlmICEkT2JqZWN0OwoKICAgICAgICAgICAgIyBydW4gb3V0cHV0IGZpbHRlcgogICAgICAgICAgICAkT2JqZWN0LT5SdW4oCiAgICAgICAgICAgICAgICAleyRGaWx0ZXJDb25maWd9LAogICAgICAgICAgICAgICAgRGF0YSAgICAgICAgID0+IFwkT3V0cHV0LAogICAgICAgICAgICAgICAgVGVtcGxhdGVGaWxlID0+ICRQYXJhbXtUZW1wbGF0ZUZpbGV9IHx8ICcnLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gJE91dHB1dDsKfQoKPWl0ZW0gQWRkSlNPbkRvY3VtZW50Q29tcGxldGUoKQoKZHluYW1pY2FsbHkgYWRkIEphdmFTY3JpcHQgY29kZSB0aGF0IHNob3VsZCBiZSBleGVjdXRlZCBpbiBDb3JlLkFwcC5SZWFkeSgpLgpDYWxsIHRoaXMgZm9yIGFueSBkeW5hbWljYWxseSBnZW5lcmF0ZWQgY29kZSB0aGF0IGlzIG5vdCBpbiBhIHRlbXBsYXRlLgoKICAgICRMYXlvdXRPYmplY3QtPkFkZEpTT25Eb2N1bWVudENvbXBsZXRlKAogICAgICAgIENvZGUgPT4gJE15Q29kZSwKICAgICk7Cgo9Y3V0CgpzdWIgQWRkSlNPbkRvY3VtZW50Q29tcGxldGUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAkU2VsZi0+e19KU09uRG9jdW1lbnRDb21wbGV0ZX0gLy89IFtdOwogICAgcHVzaCBAeyAkU2VsZi0+e19KU09uRG9jdW1lbnRDb21wbGV0ZX0gfSwgJFBhcmFte0NvZGV9OwoKfQoKMTsKCj1iYWNrCgo9aGVhZDEgVEVSTVMgQU5EIENPTkRJVElPTlMKClRoaXMgc29mdHdhcmUgaXMgcGFydCBvZiB0aGUgT1RSUyBwcm9qZWN0IChMPGh0dHA6Ly9vdHJzLm9yZy8+KS4KClRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCnRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEFHUEwpLiBJZiB5b3UKZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIEw8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2FncGwudHh0Pi4KCj1jdXQK</File>
        <File Location="KIXCore/Kernel/Output/Template/Provider.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDE2IE9UUlMgQUcsIGh0dHA6Ly9vdHJzLmNvbS8KIyBLSVhDb3JlLUV4dGVuc2lvbnMgQ29weXJpZ2h0IChDKSAyMDA2LTIwMTYgYy5hLnAuZS4gSVQgR21iSCwgaHR0cDovL3d3dy5jYXBlLWl0LmRlCiMKIyB3cml0dGVuL2VkaXRlZCBieToKIyAqIERvcm90aGVhKGRvdClEb2VyZmZlbChhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMKIyAtLQojIFRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCiMgdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoQUdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvYWdwbC50eHQuCiMgLS0KCnBhY2thZ2UgS2VybmVsOjpPdXRwdXQ6OlRlbXBsYXRlOjpQcm92aWRlcjsKIyMgbm8gY3JpdGljKFBlcmw6OkNyaXRpYzo6UG9saWN5OjpPVFJTOjpSZXF1aXJlQ2FtZWxDYXNlKQojIyBub2ZpbHRlcihUaWR5QWxsOjpQbHVnaW46Ok9UUlM6OlBlcmw6OlN5bnRheENoZWNrKSAjIGJhaWxzIG9uIFRUIENvbnN0YW50cwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIGJhc2UgcXcgKFRlbXBsYXRlOjpQcm92aWRlcik7Cgp1c2UgU2NhbGFyOjpVdGlsIHF3KCk7CnVzZSBUZW1wbGF0ZTo6Q29uc3RhbnRzOwoKdXNlIEtlcm5lbDo6T3V0cHV0OjpUZW1wbGF0ZTo6RG9jdW1lbnQ7CgpvdXIgQE9iamVjdERlcGVuZGVuY2llcyA9ICgKICAgICdLZXJuZWw6OkNvbmZpZycsCiAgICAnS2VybmVsOjpTeXN0ZW06OkNhY2hlJywKICAgICdLZXJuZWw6OlN5c3RlbTo6RW5jb2RlJywKICAgICdLZXJuZWw6OlN5c3RlbTo6TG9nJywKICAgICdLZXJuZWw6OlN5c3RlbTo6TWFpbicsCik7CgojIEZvcmNlIHRoZSB1c2Ugb2Ygb3VyIG93biBkb2N1bWVudCBjbGFzcy4KJFRlbXBsYXRlOjpQcm92aWRlcjo6RE9DVU1FTlQgPSAnS2VybmVsOjpPdXRwdXQ6OlRlbXBsYXRlOjpEb2N1bWVudCc7Cgo9aGVhZDEgTkFNRQoKS2VybmVsOjpPdXRwdXQ6OlRlbXBsYXRlOjpQcm92aWRlciAtIFRlbXBsYXRlIFRvb2xraXQgY3VzdG9tIHByb3ZpZGVyCgo9aGVhZDEgUFVCTElDIElOVEVSRkFDRQoKPW92ZXIgNAoKPWN1dAoKPWl0ZW0gT1RSU0luaXQoKQoKcGVyZm9ybXMgc29tZSBwb3N0LWluaXRpYWxpemF0aW9uIGFuZCBjcmVhdGVzIGEgYnJpZGdldCBiZXR3ZWVuIFRlbXBsYXRlOjpUb29sa2l0CmFuZCBPVFJTIGJ5IGFkZGluZyB0aGUgT1RSUyBvYmplY3RzIHRvIHRoZSBQcm92aWRlciBvYmplY3QuIFRoaXMgbWV0aG9kIG11c3QgYmUKY2FsbGVkIGFmdGVyIGluc3RhbnRpYXRpbmcgdGhlIFByb3ZpZGVyIG9iamVjdC4KClBsZWFzZSBub3RlIHRoYXQgd2Ugb25seSBzdG9yZSBhIHdlYWsgcmVmZXJlbmNlIHRvIHRoZSBMYXlvdXRPYmplY3QgdG8gYXZvaWQgcmluZwpyZWZlcmVuY2VzLgoKPWN1dAoKc3ViIE9UUlNJbml0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBEb24ndCBmZXRjaCBMYXlvdXRPYmplY3QgdmlhIE9iamVjdE1hbmFnZXIgYXMgdGhlcmUgbWlnaHQgYmUgc2V2ZXJhbCBpbnN0YW5jZXMgaW52b2x2ZWQKICAgICMgICBhdCB0aGlzIHBvaW50IChmb3IgZXhhbXBsZSBpbiBMaW5rT2JqZWN0IHRoZXJlIGlzIGFuIG93biBMYXlvdXRPYmplY3QgdG8gYXZvaWQgYmxvY2sKICAgICMgICBuYW1lIGNvbGxpc2lvbnMpLgogICAgJFNlbGYtPntMYXlvdXRPYmplY3R9ID0gJFBhcmFte0xheW91dE9iamVjdH0gfHwgZGllICJHb3Qgbm8gTGF5b3V0T2JqZWN0ISI7CgogICAgIwogICAgIyBTdG9yZSBhIHdlYWsgcmVmZXJlbmNlIHRvIHRoZSBMYXlvdXRPYmplY3QgdG8gYXZvaWQgcmluZyByZWZlcmVuY2VzLgogICAgIyAgIFdlIG5lZWQgaXQgZm9yIHRoZSBmaWx0ZXJzLgogICAgIwogICAgU2NhbGFyOjpVdGlsOjp3ZWFrZW4oICRTZWxmLT57TGF5b3V0T2JqZWN0fSApOwoKICAgICMgZGVmaW5lIGNhY2hlIHR5cGUKICAgICRTZWxmLT57Q2FjaGVUeXBlfSA9ICdUZW1wbGF0ZVByb3ZpZGVyJzsKCiAgICAjIGNhY2hpbmcgY2FuIGJlIGRpc2FibGVkIGZvciBkZWJ1Z2dpbmcgcmVhc29ucwogICAgJFNlbGYtPntDYWNoaW5nRW5hYmxlZH0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ0Zyb250ZW5kOjpUZW1wbGF0ZUNhY2hlJykgLy8gMTsKCiAgICAjIEtJWENvcmUtY2FwZUlUCiAgICAjCiAgICAjIFByZS1jb21wdXRlIHRoZSBsaXN0IG9mIG5vdCBjYWNoZWFibGUgVGVtcGxhdGVzLiBJZiBhIHByZS1vdXRwdXQgZmlsdGVyIGlzCiAgICAjICAgcmVnaXN0ZXJlZCBmb3IgYSBwYXJ0aWN1bGFyIG9yIGZvciBhbGwgdGVtcGxhdGVzLCB0aGUgdGVtcGxhdGUgY2Fubm90IGJlCiAgICAjICAgY2FjaGVkIGFueSBtb3JlLgogICAgIwogICAgJFNlbGYtPntGaWx0ZXJFbGVtZW50UHJlfSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnRnJvbnRlbmQ6Ok91dHB1dDo6RmlsdGVyRWxlbWVudFByZScpOwoKICAgIG15ICVVbmNhY2hlYWJsZVRlbXBsYXRlczsKCiAgICBteSAlRmlsdGVyTGlzdCA9ICV7ICRTZWxmLT57RmlsdGVyRWxlbWVudFByZX0gfHwge30gfTsKCiAgICBGSUxURVI6CiAgICBmb3IgbXkgJEZpbHRlciAoIHNvcnQga2V5cyAlRmlsdGVyTGlzdCApIHsKCiAgICAgICAgIyBleHRyYWN0IGZpbHRlciBjb25maWcKICAgICAgICBteSAkRmlsdGVyQ29uZmlnID0gJEZpbHRlckxpc3R7JEZpbHRlcn07CgogICAgICAgIG5leHQgRklMVEVSIGlmICEkRmlsdGVyQ29uZmlnOwogICAgICAgIG5leHQgRklMVEVSIGlmIHJlZiAkRmlsdGVyQ29uZmlnIG5lICdIQVNIJzsKCiAgICAgICAgIyBleHRyYWN0IHRlbXBsYXRlIGxpc3QKICAgICAgICBteSAlVGVtcGxhdGVMaXN0ID0gJXsgJEZpbHRlckNvbmZpZy0+e1RlbXBsYXRlc30gfHwge30gfTsKCiAgICAgICAgaWYgKCAhJVRlbXBsYXRlTGlzdCApIHsKCiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4KICAgICAgICAgICAgICAgICAgICAiUGxlYXNlIGFkZCBhIHRlbXBsYXRlIGxpc3QgdG8gb3V0cHV0IGZpbHRlciAkRmlsdGVyQ29uZmlnLT57TW9kdWxlfSB0byBpbXByb3ZlIHBlcmZvcm1hbmNlLiIsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBuZXh0IEZJTFRFUjsKICAgICAgICB9CiAgICAgICAgZWxzaWYgKCAkVGVtcGxhdGVMaXN0e0FMTH0gKSB7CgogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiA8PEVPRiwKJEZpbHRlckNvbmZpZy0+e01vZHVsZX0gd2FudHMgdG8gb3BlcmF0ZSBvbiBBTEwgdGVtcGxhdGVzLgpUaGlzIHdpbGwgcHJvaGliaXQgdGhlIHRlbXBsYXRlcyBmcm9tIGJlaW5nIGNhY2hlZCBhbmQgY2FuIHRoZXJlZm9yZSBsZWFkIHRvIHNlcmlvdXMgcGVyZm9ybWFuY2UgaXNzdWVzLgpFT0YKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIG5leHQgRklMVEVSOwogICAgICAgIH0KCiAgICAgICAgQFVuY2FjaGVhYmxlVGVtcGxhdGVzeyBrZXlzICVUZW1wbGF0ZUxpc3QgfSA9IHZhbHVlcyAlVGVtcGxhdGVMaXN0OwogICAgfQoKICAgICMgbWFwIGZpbHRlcmVkIHRlbXBsYXRlIG5hbWVzIHRvIHJlYWwgdHQgbmFtZXMgKGV4Y2VwdCAnQUxMJyBwbGFjZWhvbGRlcikKICAgICVVbmNhY2hlYWJsZVRlbXBsYXRlcyA9CiAgICAgICAgbWFwIHsgJF8gZXEgJ0FMTCcgPyAnQUxMJyA6ICRfIC4gJy50dCcgPT4gJFVuY2FjaGVhYmxlVGVtcGxhdGVzeyRffSB9CiAgICAgICAga2V5cyAlVW5jYWNoZWFibGVUZW1wbGF0ZXM7CgogICAgJFNlbGYtPntVbmNhY2hlYWJsZVRlbXBsYXRlc30gPSBcJVVuY2FjaGVhYmxlVGVtcGxhdGVzOwogICAgIyBFTyBLSVhDb3JlLWNhcGVJVAp9Cgo9aXRlbSBfZmV0Y2goKQoKdHJ5IHRvIGdldCBhIGNvbXBpbGVkIHZlcnNpb24gb2YgYSB0ZW1wbGF0ZSBmcm9tIHRoZSBDYWNoZU9iamVjdCwKb3RoZXJ3aXNlIGNvbXBpbGUgdGhlIHRlbXBsYXRlIGFuZCByZXR1cm4gaXQuCgpDb3BpZWQgYW5kIHNsaWdodGx5IGFkYXB0ZWQgZnJvbSBUZW1wbGF0ZTo6UHJvdmlkZXIuCgpBIG5vdGUgYWJvdXQgY2FjaGluZzogd2UgaGF2ZSB0aHJlZSBsZXZlbHMgb2YgY2FjaGluZy4KCiAgICAxLiB3ZSBoYXZlIGFuIGluLW1lbW9yeSBjYWNoZSB0aGF0IHN0b3JlcyB0aGUgY29tcGlsZWQgRG9jdW1lbnQgb2JqZWN0cyAoZmFzdGVzdCkuCiAgICAyLiB3ZSBzdG9yZSB0aGUgcGFyc2VkIGRhdGEgaW4gdGhlIENhY2hlT2JqZWN0IHRvIGJlIHJlLXVzZWQgaW4gYW5vdGhlciByZXF1ZXN0LgogICAgMy4gZm9yIHN0cmluZyB0ZW1wbGF0ZXMsIHdlIGhhdmUgYW4gaW4tbWVtb3J5IGNhY2hlIGluIHRoZSBwYXJzaW5nIG1ldGhvZCBfY29tcGlsZSgpLgogICAgICAgIEl0IHdpbGwgcmV0dXJuIHRoZSBhbHJlYWR5IHBhcnNlZCBvYmplY3QgaWYgaXQgc2VlcyB0aGUgc2FtZSB0ZW1wbGF0ZSBjb250ZW50IGFnYWluLgoKPWN1dAoKc3ViIF9mZXRjaCB7CiAgICBteSAoICRzZWxmLCAkbmFtZSwgJHRfbmFtZSApID0gQF87CiAgICBteSAkc3RhdF90dGwgPSAkc2VsZi0+e1NUQVRfVFRMfTsKCiAgICAkc2VsZi0+ZGVidWcoIl9mZXRjaCgkbmFtZSkiKSBpZiAkc2VsZi0+e0RFQlVHfTsKCiAgICAjIEtJWENvcmUtY2FwZUlUCiAgICBteSAkVGVtcGxhdGVJc0NhY2hlYWJsZSA9ICEkc2VsZi0+e1VuY2FjaGVhYmxlVGVtcGxhdGVzfS0+e0FMTH0gJiYgISRzZWxmLT57VW5jYWNoZWFibGVUZW1wbGF0ZXN9LT57JHRfbmFtZX07CiAgICAjIEVPIEtJWENvcmUtY2FwZUlUCgogICAgIyBDaGVjayBpbi1tZW1vcnkgdGVtcGxhdGUgY2FjaGUgaWYgd2UgYWxyZWFkeSBoYWQgdGhpcyB0ZW1wbGF0ZS4KICAgICRzZWxmLT57X1RlbXBsYXRlQ2FjaGV9IC8vPSB7fTsKCiAgICAjIEtJWENvcmUtY2FwZUlUCiAgICAjIGlmICggJHNlbGYtPntfVGVtcGxhdGVDYWNoZX0tPnskbmFtZX0gKSB7CiAgICBpZiAoICRUZW1wbGF0ZUlzQ2FjaGVhYmxlICYmICRzZWxmLT57X1RlbXBsYXRlQ2FjaGV9LT57JG5hbWV9ICkgewogICAgIyBFTyBLSVhDb3JlLWNhcGVJVAogICAgICAgIHJldHVybiAkc2VsZi0+e19UZW1wbGF0ZUNhY2hlfS0+eyRuYW1lfTsKICAgIH0KCiAgICAjIFNlZSBpZiB3ZSBhbHJlYWR5IGtub3cgdGhlIHRlbXBsYXRlIGlzIG5vdCBmb3VuZAogICAgaWYgKCAkc2VsZi0+e05PVEZPVU5EfS0+eyRuYW1lfSApIHsKICAgICAgICByZXR1cm4gKCB1bmRlZiwgVGVtcGxhdGU6OkNvbnN0YW50czo6U1RBVFVTX0RFQ0xJTkVEICk7CiAgICB9CgogICAgIyBDaGVjayBpZiB0aGUgdGVtcGxhdGUgZXhpc3RzLCBpcyBjYWNoZWFibGUgYW5kIGlmIGEgY2FjaGVkIHZlcnNpb24gZXhpc3RzLgogICAgIyBLSVhDb3JlLWNhcGVJVAogICAgIyBpZiAoIC1lICRuYW1lICYmICRzZWxmLT57Q2FjaGluZ0VuYWJsZWR9ICkgewogICAgaWYgKCAtZSAkbmFtZSAmJiAkVGVtcGxhdGVJc0NhY2hlYWJsZSAmJiAkc2VsZi0+e0NhY2hpbmdFbmFibGVkfSApIHsKICAgICMgRU8gS0lYQ29yZS1jYXBlSVQKCiAgICAgICAgbXkgJHRlbXBsYXRlX210aW1lID0gJHNlbGYtPl90ZW1wbGF0ZV9tb2RpZmllZCgkbmFtZSk7CiAgICAgICAgbXkgJENhY2hlS2V5ICAgICAgID0gJHNlbGYtPl9jb21waWxlZF9maWxlbmFtZSgkbmFtZSkgLiAnOjonIC4gJHRlbXBsYXRlX210aW1lOwoKICAgICAgICAjIElzIHRoZXJlIGFuIHVwLXRvLWRhdGUgY29tcGlsZWQgdmVyc2lvbiBpbiB0aGUgY2FjaGU/CiAgICAgICAgbXkgJENhY2hlID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyktPkdldCgKICAgICAgICAgICAgVHlwZSA9PiAkc2VsZi0+e0NhY2hlVHlwZX0sCiAgICAgICAgICAgIEtleSAgPT4gJENhY2hlS2V5LAogICAgICAgICk7CgogICAgICAgIGlmICggcmVmICRDYWNoZSApIHsKCiAgICAgICAgICAgIG15ICRjb21waWxlZF90ZW1wbGF0ZSA9ICRUZW1wbGF0ZTo6UHJvdmlkZXI6OkRPQ1VNRU5ULT5uZXcoJENhY2hlKTsKCiAgICAgICAgICAgICMgU3RvcmUgaW4tbWVtb3J5IGFuZCByZXR1cm4gdGhlIGNvbXBpbGVkIHRlbXBsYXRlCiAgICAgICAgICAgIGlmICgkY29tcGlsZWRfdGVtcGxhdGUpIHsKCiAgICAgICAgICAgICAgICAjIE1ha2Ugc3VyZSB0ZW1wbGF0ZSBjYWNoZSBkb2VzIG5vdCBnZXQgdG9vIGJpZwogICAgICAgICAgICAgICAgaWYgKCBrZXlzICV7ICRzZWxmLT57X1RlbXBsYXRlQ2FjaGV9IH0gPiAxMDAwICkgewogICAgICAgICAgICAgICAgICAgICRzZWxmLT57X1RlbXBsYXRlQ2FjaGV9ID0ge307CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJHNlbGYtPntfVGVtcGxhdGVDYWNoZX0tPnskbmFtZX0gPSAkY29tcGlsZWRfdGVtcGxhdGU7CgogICAgICAgICAgICAgICAgcmV0dXJuICRjb21waWxlZF90ZW1wbGF0ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBQcm9ibGVtIGxvYWRpbmcgY29tcGlsZWQgdGVtcGxhdGU6IHdhcm4gYW5kIGNvbnRpbnVlIHRvIGZldGNoIHNvdXJjZSB0ZW1wbGF0ZQogICAgICAgICAgICB3YXJuKCAkc2VsZi0+ZXJyb3IoKSwgIlxuIiApOwogICAgICAgIH0KICAgIH0KCiAgICAjIGxvYWQgdGVtcGxhdGUgZnJvbSBzb3VyY2UKICAgIG15ICggJHRlbXBsYXRlLCAkZXJyb3IgKSA9ICRzZWxmLT5fbG9hZCggJG5hbWUsICR0X25hbWUgKTsKCiAgICBpZiAoJGVycm9yKSB7CgogICAgICAgICMgVGVtcGxhdGUgY291bGQgbm90IGJlIGZldGNoZWQuICBBZGQgdG8gdGhlIG5lZ2F0aXZlL25vdGZvdW5kIGNhY2hlLgogICAgICAgICRzZWxmLT57Tk9URk9VTkR9LT57JG5hbWV9ID0gdGltZTsKICAgICAgICByZXR1cm4gKCAkdGVtcGxhdGUsICRlcnJvciApOwogICAgfQoKICAgICMgY29tcGlsZSB0ZW1wbGF0ZSBzb3VyY2UKICAgICggJHRlbXBsYXRlLCAkZXJyb3IgKSA9ICRzZWxmLT5fY29tcGlsZSggJHRlbXBsYXRlLCAkc2VsZi0+X2NvbXBpbGVkX2ZpbGVuYW1lKCRuYW1lKSApOwoKICAgIGlmICgkZXJyb3IpIHsKCiAgICAgICAgIyByZXR1cm4gYW55IGNvbXBpbGUgdGltZSBlcnJvcgogICAgICAgIHJldHVybiAoICR0ZW1wbGF0ZSwgJGVycm9yICk7CiAgICB9CgogICAgIyBLSVhDb3JlLWNhcGVJVAogICAgaWYgKCRUZW1wbGF0ZUlzQ2FjaGVhYmxlKSB7CiAgICAjIEVPIEtJWENvcmUtY2FwZUlUCgogICAgICAgICMgTWFrZSBzdXJlIHRlbXBsYXRlIGNhY2hlIGRvZXMgbm90IGdldCB0b28gYmlnCiAgICAgICAgaWYgKCBrZXlzICV7ICRzZWxmLT57X1RlbXBsYXRlQ2FjaGV9IH0gPiAxMDAwICkgewogICAgICAgICAgICAkc2VsZi0+e19UZW1wbGF0ZUNhY2hlfSA9IHt9OwogICAgICAgIH0KCiAgICAgICAgJHNlbGYtPntfVGVtcGxhdGVDYWNoZX0tPnskbmFtZX0gPSAkdGVtcGxhdGUtPntkYXRhfTsKICAgICMgS0lYQ29yZS1jYXBlSVQKICAgIH0KICAgICMgRU8gS0lYQ29yZS1jYXBlSVQKCiAgICByZXR1cm4gJHRlbXBsYXRlLT57ZGF0YX07Cgp9Cgo9aXRlbSBfbG9hZCgpCgpjYWxscyBvdXIgcHJlIHByb2Nlc3NvciB3aGVuIGxvYWRpbmcgYSB0ZW1wbGF0ZS4KCkluaGVyaXRlZCBmcm9tIFRlbXBsYXRlOjpQcm92aWRlci4KCj1jdXQKCnN1YiBfbG9hZCB7CiAgICBteSAoICRTZWxmLCAkTmFtZSwgJEFsaWFzICkgPSBAXzsKCiAgICBteSBAUmVzdWx0ID0gJFNlbGYtPlNVUEVSOjpfbG9hZCggJE5hbWUsICRBbGlhcyApOwoKICAgICMgSWYgdGhlcmUgd2FzIG5vIGVycm9yLCBwcmUtcHJvY2VzcyBvdXIgdGVtcGxhdGUKICAgIGlmICggcmVmICRSZXN1bHRbMF0gKSB7CgogICAgICAgICRSZXN1bHRbMF0tPnt0ZXh0fSA9ICRTZWxmLT5fUHJlUHJvY2Vzc1RlbXBsYXRlQ29udGVudCgKICAgICAgICAgICAgQ29udGVudCAgICAgID0+ICRSZXN1bHRbMF0tPnt0ZXh0fSwKICAgICAgICAgICAgVGVtcGxhdGVGaWxlID0+ICRSZXN1bHRbMF0tPntuYW1lfSwKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiBAUmVzdWx0Owp9Cgo9aXRlbSBfY29tcGlsZSgpCgpjb21waWxlcyBhIC50dCB0ZW1wbGF0ZSBpbnRvIGEgUGVybCBwYWNrYWdlIGFuZCB1c2VzIHRoZSBDYWNoZU9iamVjdAp0byBjYWNoZSBpdC4KCkNvcGllZCBhbmQgc2xpZ2h0bHkgYWRhcHRlZCBmcm9tIFRlbXBsYXRlOjpQcm92aWRlci4KCj1jdXQKCnN1YiBfY29tcGlsZSB7CiAgICBteSAoICRzZWxmLCAkZGF0YSwgJGNvbXBmaWxlICkgPSBAXzsKICAgIG15ICR0ZXh0ID0gJGRhdGEtPnt0ZXh0fTsKICAgIG15ICggJHBhcnNlZG9jLCAkZXJyb3IgKTsKCiAgICBpZiAoICRzZWxmLT57REVCVUd9ICkgewogICAgICAgICRzZWxmLT5kZWJ1ZygKICAgICAgICAgICAgIl9jb21waWxlKCRkYXRhLCAiLAogICAgICAgICAgICBkZWZpbmVkICRjb21wZmlsZSA/ICRjb21wZmlsZSA6ICc8bm8gY29tcGZpbGU+JywgJyknCiAgICAgICAgKTsKICAgIH0KCiAgICAjIENoZWNrIGluLW1lbW9yeSBwYXJzZXIgY2FjaGUgaWYgd2UgYWxyZWFkeSBoYWQgdGhpcyB0ZW1wbGF0ZSBjb250ZW50CiAgICAkc2VsZi0+e19QYXJzZXJDYWNoZX0gLy89IHt9OwoKICAgIGlmICggJHNlbGYtPntfUGFyc2VyQ2FjaGV9LT57JHRleHR9ICkgewogICAgICAgIHJldHVybiAkc2VsZi0+e19QYXJzZXJDYWNoZX0tPnskdGV4dH07CiAgICB9CgogICAgbXkgJHBhcnNlciA9ICRzZWxmLT57UEFSU0VSfQogICAgICAgIHx8PSBUZW1wbGF0ZTo6Q29uZmlnLT5wYXJzZXIoICRzZWxmLT57UEFSQU1TfSApCiAgICAgICAgfHwgcmV0dXJuICggVGVtcGxhdGU6OkNvbmZpZy0+ZXJyb3IoKSwgVGVtcGxhdGU6OkNvbnN0YW50czo6U1RBVFVTX0VSUk9SICk7CgogICAgIyBkaXNjYXJkIHRoZSB0ZW1wbGF0ZSB0ZXh0IC0gd2UgZG9uJ3QgbmVlZCBpdCBhbnkgbW9yZQogICAgZGVsZXRlICRkYXRhLT57dGV4dH07CgogICAgIyBjYWxsIHBhcnNlciB0byBjb21waWxlIHRlbXBsYXRlIGludG8gUGVybCBjb2RlCiAgICBpZiAoICRwYXJzZWRvYyA9ICRwYXJzZXItPnBhcnNlKCAkdGV4dCwgJGRhdGEgKSApIHsKCiAgICAgICAgJHBhcnNlZG9jLT57TUVUQURBVEF9ID0gewogICAgICAgICAgICAnbmFtZScgICAgPT4gJGRhdGEtPntuYW1lfSwKICAgICAgICAgICAgJ21vZHRpbWUnID0+ICRkYXRhLT57dGltZX0sCiAgICAgICAgICAgICV7ICRwYXJzZWRvYy0+e01FVEFEQVRBfSB9LAogICAgICAgIH07CgogICAgICAgICMgd3JpdGUgdGhlIFBlcmwgY29kZSB0byB0aGUgZmlsZSAkY29tcGZpbGUsIGlmIGRlZmluZWQKICAgICAgICBpZiAoJGNvbXBmaWxlKSB7CiAgICAgICAgICAgIG15ICRDYWNoZUtleSA9ICRjb21wZmlsZSAuICc6OicgLiAkZGF0YS0+e3RpbWV9OwoKICAgICAgICAgICAgaWYgKCAkc2VsZi0+e0NhY2hpbmdFbmFibGVkfSApIHsKICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpLT5TZXQoCiAgICAgICAgICAgICAgICAgICAgVHlwZSAgPT4gJHNlbGYtPntDYWNoZVR5cGV9LAogICAgICAgICAgICAgICAgICAgIFRUTCAgID0+IDYwICogNjAgKiAyNCwKICAgICAgICAgICAgICAgICAgICBLZXkgICA9PiAkQ2FjaGVLZXksCiAgICAgICAgICAgICAgICAgICAgVmFsdWUgPT4gJHBhcnNlZG9jLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCAkZGF0YS0+e2RhdGF9ID0gJFRlbXBsYXRlOjpQcm92aWRlcjo6RE9DVU1FTlQtPm5ldygkcGFyc2Vkb2MpICkgewoKICAgICAgICAgICAgIyBNYWtlIHN1cmUgcGFyc2VyIGNhY2hlIGRvZXMgbm90IGdldCB0b28gYmlnCiAgICAgICAgICAgIGlmICgga2V5cyAleyAkc2VsZi0+e19QYXJzZXJDYWNoZX0gfSA+IDEwMDAgKSB7CiAgICAgICAgICAgICAgICAkc2VsZi0+e19QYXJzZXJDYWNoZX0gPSB7fTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHNlbGYtPntfUGFyc2VyQ2FjaGV9LT57JHRleHR9ID0gJGRhdGE7CgogICAgICAgICAgICByZXR1cm4gJGRhdGE7CiAgICAgICAgfQogICAgICAgICRlcnJvciA9ICRUZW1wbGF0ZTo6RG9jdW1lbnQ6OkVSUk9SOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJGVycm9yID0gVGVtcGxhdGU6OkV4Y2VwdGlvbi0+bmV3KCAncGFyc2UnLCAiJGRhdGEtPnsgbmFtZSB9ICIgLiAkcGFyc2VyLT5lcnJvcigpICk7CiAgICB9CgogICAgIyByZXR1cm4gU1RBVFVTX0VSUk9SLCBvciBTVEFUVVNfREVDTElORUQgaWYgd2UncmUgYmVpbmcgdG9sZXJhbnQKICAgIHJldHVybiAkc2VsZi0+e1RPTEVSQU5UfQogICAgICAgID8gKCB1bmRlZiwgVGVtcGxhdGU6OkNvbnN0YW50czo6U1RBVFVTX0RFQ0xJTkVEICkKICAgICAgICA6ICggJGVycm9yLCBUZW1wbGF0ZTo6Q29uc3RhbnRzOjpTVEFUVVNfRVJST1IgKQp9Cgo9aXRlbSBzdG9yZSgpCgppbmhlcml0ZWQgZnJvbSBUZW1wbGF0ZTo6UHJvdmlkZXIuIFRoaXMgZnVuY3Rpb24gb3ZlcnJpZGUganVzdCBtYWtlcyBzdXJlIHRoYXQgdGhlIG9yaWdpbmFsCmluLW1lbW9yeSBjYWNoZSBjYW5ub3QgYmUgdXNlZC4KCj1jdXQKCnN1YiBzdG9yZSB7CiAgICBteSAoICRTZWxmLCAkTmFtZSwgJERhdGEgKSA9IEBfOwoKICAgIHJldHVybiAkRGF0YTsgICAgIyBuby1vcAp9Cgo9aXRlbSBfUHJlUHJvY2Vzc1RlbXBsYXRlQ29udGVudCgpCgp0aGlzIGlzIG91ciB0ZW1wbGF0ZSBwcmUgcHJvY2Vzc29yLgoKSXQgaGFuZGxlcyBzb21lIE9UUlMgc3BlY2lmaWMgdGFncyBsaWtlIFslIEluc2VydFRlbXBsYXRlKCJUZW1wbGF0ZU5hbWUudHQiKSAlXQphbmQgYWxzbyBwZXJmb3JtcyBjb21waWxlLXRpbWUgY29kZSBpbmplY3Rpb24gKENoYWxsZW5nZVRva2VuIGVsZW1lbnQgaW50byBmb3JtcykuCgpCZXNpZGVzIHRoYXQsIGl0IGFsc28gbWFrZXMgc3VyZSB0aGUgdGVtcGxhdGUgaXMgdHJlYXRlZCBhcyBVVEY4LgoKVGhpcyBpcyBydW4gYXQgY29tcGlsZSB0aW1lLiBJZiBhIHRlbXBsYXRlIGlzIGNhY2hlZCwgdGhpcyBtZXRob2QgZG9lcyBub3QgaGF2ZSB0byBiZSBleGVjdXRlZCBvbiBpdAphbnkgbW9yZS4KCj1jdXQKCnN1YiBfUHJlUHJvY2Vzc1RlbXBsYXRlQ29udGVudCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRDb250ZW50ID0gJFBhcmFte0NvbnRlbnR9OwoKICAgICMgTWFrZSBzdXJlIHRoZSB0ZW1wbGF0ZSBpcyB0cmVhdGVkIGFzIHV0ZjguCiAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RW5jb2RlJyktPkVuY29kZUlucHV0KCBcJENvbnRlbnQgKTsKCiAgICBteSAkVGVtcGxhdGVGaWxlV2l0aG91dFRUID0gc3Vic3RyKCAkUGFyYW17VGVtcGxhdGVGaWxlfSwgMCwgLTMgKTsKCiAgICAjCiAgICAjIEluY2x1ZGUgb3RoZXIgdGVtcGxhdGVzIGludG8gdGhpcyBvbmUgYmVmb3JlIHBhcnNpbmcuCiAgICAjIFslIEluY2x1ZGVUZW1wbGF0ZSgiRGF0ZVBpY2tlci50dCIpICVdCiAgICAjCiAgICBteSAoICRSZXBsYWNlQ291bnRlciwgJFJlcGxhY2VkICk7CiAgICBkbyB7CiAgICAgICAgJFJlcGxhY2VkID0gJENvbnRlbnQgPX4gc3sKICAgICAgICAgICAgXFslIC0/IFxzKiBJbnNlcnRUZW1wbGF0ZSBcKCBccyogWyciXT8gKC4qPykgWyciXT8gXHMqIFwpIFxzKiAtPyAlXF1cbj8KICAgICAgICAgICAgfXsKICAgICAgICAgICAgICAgICMgTG9hZCB0aGUgdGVtcGxhdGUgdmlhIHRoZSBwcm92aWRlci4KICAgICAgICAgICAgICAgICMgV2UnbGwgdXNlIFNVUEVSOjpsb2FkIGhlcmUgYmVjYXVzZSB3ZSBkb24ndCBuZWVkIHRoZSBwcmVwcm9jZXNzaW5nIHR3aWNlLgogICAgICAgICAgICAgICAgbXkgJFRlbXBsYXRlQ29udGVudCA9ICgkU2VsZi0+U1VQRVI6OmxvYWQoJDEpKVswXTsKICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpFbmNvZGUnKS0+RW5jb2RlSW5wdXQoXCRUZW1wbGF0ZUNvbnRlbnQpOwoKICAgICAgICAgICAgICAgICMgUmVtb3ZlIGNvbW1lbnRlZCBsaW5lcyBhbHJlYWR5IGhlcmUgYmVjYXVzZSBvZiBwcm9ibGVtcyB3aGVuIHRoZSBJbnNlcnRUZW1wbGF0ZSB0YWcKICAgICAgICAgICAgICAgICMgICBpcyBub3Qgb24gdGhlIGJlZ2lubmluZyBvZiB0aGUgbGluZS4KICAgICAgICAgICAgICAgICRUZW1wbGF0ZUNvbnRlbnQgPX4gcy9eIy4qXG4vL2dtOwogICAgICAgICAgICAgICAgJFRlbXBsYXRlQ29udGVudDsKICAgICAgICAgICAgfWVzbXhnOwoKICAgIH0gdW50aWwgKCAhJFJlcGxhY2VkIHx8ICsrJFJlcGxhY2VDb3VudGVyID4gMTAwICk7CgogICAgIyBLSVhDb3JlLWNhcGVJVAogICAgIwogICAgIyBwcmUgcHV0cHV0IGZpbHRlciBoYW5kbGluZwogICAgIwogICAgaWYgKCAkU2VsZi0+e0ZpbHRlckVsZW1lbnRQcmV9ICYmIHJlZiAkU2VsZi0+e0ZpbHRlckVsZW1lbnRQcmV9IGVxICdIQVNIJyApIHsKCiAgICAgICAgIyBleHRyYWN0IGZpbHRlciBsaXN0CiAgICAgICAgbXkgJUZpbHRlckxpc3QgPSAleyAkU2VsZi0+e0ZpbHRlckVsZW1lbnRQcmV9IH07CgogICAgICAgIEZJTFRFUjoKICAgICAgICBmb3IgbXkgJEZpbHRlciAoIHNvcnQga2V5cyAlRmlsdGVyTGlzdCApIHsKCiAgICAgICAgICAgICMgZXh0cmFjdCBmaWx0ZXIgY29uZmlnCiAgICAgICAgICAgIG15ICRGaWx0ZXJDb25maWcgPSAkRmlsdGVyTGlzdHskRmlsdGVyfTsKCiAgICAgICAgICAgIG5leHQgRklMVEVSIGlmICEkRmlsdGVyQ29uZmlnOwogICAgICAgICAgICBuZXh0IEZJTFRFUiBpZiByZWYgJEZpbHRlckNvbmZpZyBuZSAnSEFTSCc7CgogICAgICAgICAgICAjIGV4dHJhY3QgdGVtcGxhdGUgbGlzdAogICAgICAgICAgICBteSAlVGVtcGxhdGVMaXN0ID0gJXsgJEZpbHRlckNvbmZpZy0+e1RlbXBsYXRlc30gfHwge30gfTsKCiAgICAgICAgICAgIGlmICggISVUZW1wbGF0ZUxpc3QgKSB7CgogICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAgICAgICAgICJQbGVhc2UgYWRkIGEgdGVtcGxhdGUgbGlzdCB0byBvdXRwdXQgZmlsdGVyICRGaWx0ZXJDb25maWctPntNb2R1bGV9IHRvIGltcHJvdmUgcGVyZm9ybWFuY2UuIiwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgbmV4dCBGSUxURVI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCAkVGVtcGxhdGVMaXN0e0FMTH0gKSB7CgogICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiA8PEVPRiwKJEZpbHRlckNvbmZpZy0+e01vZHVsZX0gd2FudHMgdG8gb3BlcmF0ZSBvbiBBTEwgdGVtcGxhdGVzLgpUaGlzIHdpbGwgcHJvaGliaXQgdGhlIHRlbXBsYXRlcyBmcm9tIGJlaW5nIGNhY2hlZCBhbmQgY2FuIHRoZXJlZm9yZSBsZWFkIHRvIHNlcmlvdXMgcGVyZm9ybWFuY2UgaXNzdWVzLgpFT0YKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgbmV4dCBGSUxURVI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgb25seSBvcGVyYXRlIG9uIHJlYWwgZmlsZXMKICAgICAgICAgICAgbmV4dCBGSUxURVIgaWYgISRQYXJhbXtUZW1wbGF0ZUZpbGV9OwoKICAgICAgICAgICAgIyBjaGVjayB0ZW1wbGF0ZSBsaXN0CiAgICAgICAgICAgICMgS0lYQ29yZS1jYXBlSVQKICAgICAgICAgICAgIyBuZXh0IEZJTFRFUiBpZiAhJFRlbXBsYXRlTGlzdHskVGVtcGxhdGVGaWxlV2l0aG91dFRUfTsKICAgICAgICAgICAgbXkgJE1hdGNoID0gMDsKICAgICAgICAgICAgZm9yIG15ICRUZW1wbGF0ZSAoIGtleXMgJVRlbXBsYXRlTGlzdCApIHsKICAgICAgICAgICAgICAgIGlmICggJFRlbXBsYXRlRmlsZVdpdGhvdXRUVCA9fiBtLyRUZW1wbGF0ZS8gKSB7CiAgICAgICAgICAgICAgICAgICAgJE1hdGNoID0gMTsgCiAgICAgICAgICAgICAgICB9ICAKICAgICAgICAgICAgfQogICAgICAgICAgICBuZXh0IEZJTFRFUiBpZiAhJE1hdGNoOwogICAgICAgICAgICAjIEVPIEtJWENvcmUtY2FwZUlUCgogICAgICAgICAgICAjIGNoZWNrIGZpbHRlciBjb25zdHJ1Y3Rpb24KICAgICAgICAgICAgbmV4dCBGSUxURVIgaWYgISRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyktPlJlcXVpcmUoICRGaWx0ZXJDb25maWctPntNb2R1bGV9ICk7CgogICAgICAgICAgICAjIGNyZWF0ZSBuZXcgaW5zdGFuY2UKICAgICAgICAgICAgbXkgJE9iamVjdCA9ICRGaWx0ZXJDb25maWctPntNb2R1bGV9LT5uZXcoCiAgICAgICAgICAgICAgICBMYXlvdXRPYmplY3QgPT4gJFNlbGYtPntMYXlvdXRPYmplY3R9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgbmV4dCBGSUxURVIgaWYgISRPYmplY3Q7CgogICAgICAgICAgICAjIHJ1biBvdXRwdXQgZmlsdGVyCiAgICAgICAgICAgICRPYmplY3QtPlJ1bigKICAgICAgICAgICAgICAgICV7JEZpbHRlckNvbmZpZ30sCiAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgPT4gXCRDb250ZW50LAogICAgICAgICAgICAgICAgVGVtcGxhdGVGaWxlID0+ICRUZW1wbGF0ZUZpbGVXaXRob3V0VFQgfHwgJycsCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQogICAgIyBFTyBLSVhDb3JlLWNhcGVJVAoKICAgICMKICAgICMgUmVtb3ZlIERUTC1zdHlsZSBjb21tZW50cyAobGluZXMgc3RhcnRpbmcgd2l0aCAjKQogICAgIwogICAgJENvbnRlbnQgPX4gcy9eIy4qXG4vL2dtOwoKICAgICMKICAgICMgSW5zZXJ0IGEgQkxPQ0sgY2FsbCBpbnRvIHRoZSB0ZW1wbGF0ZS4KICAgICMgWyUgUmVuZGVyQmxvY2soJ2IxJykgJV0uLi5bJSBFTkQgJV0KICAgICMgYmVjb21lcwogICAgIyBbJSBQZXJmb3JtUmVuZGVyQmxvY2soJ2IxJykgJV1bJSBCTE9DSyAnYjEnICVdLi4uWyUgRU5EICVdCiAgICAjIFRoaXMgaXMgd2hhdCB3ZSBuZWVkOiBkZWZpbmUgdGhlIGJsb2NrIGFuZCBjYWxsIGl0IGZyb20gdGhlIFJlbmRlckJsb2NrIG1hY3JvCiAgICAjIHRvIHJlbmRlciBpdCBiYXNlZCBvbiBhdmFpbGFibGUgYmxvY2sgZGF0YSBmcm9tIHRoZSBmcm9udGVuZCBtb2R1bGVzLgogICAgIwogICAgJENvbnRlbnQgPX4gc3sKICAgICAgICBcWyUgLT8gXHMqIFJlbmRlckJsb2NrU3RhcnQgXCggXHMqIFsnIl0/ICguKj8pIFsnIl0/IFxzKiBcKSBccyogLT8gJVxdCiAgICAgICAgfXtbJSBQZXJmb3JtUmVuZGVyQmxvY2soIiQxIikgJV1bJSBCTE9DSyAiJDEiIC0lXX1zbXhnOwoKICAgICRDb250ZW50ID1+IHN7CiAgICAgICAgXFslIC0/IFxzKiBSZW5kZXJCbG9ja0VuZCBcKCBccyogWyciXT8gKC4qPykgWyciXT8gXHMqIFwpIFxzKiAtPyAlXF0KICAgICAgICB9e1slIEVORCAtJV19c214ZzsKCiAgICAjCiAgICAjIEFkZCBjaGFsbGVuZ2UgdG9rZW4gZmllbGQgdG8gYWxsIGludGVybmFsIGZvcm1zCiAgICAjCiAgICAjICg/IS4uLikgaXMgYSBuZWdhdGl2ZSBsb29rLWFoZWFkLCBzbyAibm90IGZvbGxvd2VkIGJ5IGh0dHBzPzoiCiAgICAjIFxLIGlzIGEgbmV3IGZlYXR1cmUgaW4gcGVybCA1LjEwIHdoaWNoIGV4Y2x1ZGVzIGFueXRoaW5nIHByaW9yCiAgICAjIHRvIGl0IGZyb20gYmVpbmcgaW5jbHVkZWQgaW4gdGhlIG1hdGNoLCB3aGljaCBtZWFucyB0aGUgc3RyaW5nCiAgICAjIG1hdGNoZWQgYmVmb3JlIGl0IGlzIG5vdCBiZWluZyByZXBsYWNlZCBhd2F5LgogICAgIyBwZXJmb3JtcyBiZXR0ZXIgdGhhbiBpbmNsdWRpbmcgJDEgaW4gdGhlIHN1YnN0aXR1dGlvbi4KICAgICMKICAgICRDb250ZW50ID1+IHN7CiAgICAgICAgICAgIDxmb3JtW148Pl0rYWN0aW9uPSIoPyFodHRwcz86KVteIl0qIltePD5dKj5cSwogICAgICAgIH17WyUgSUYgRW52KCJVc2VyQ2hhbGxlbmdlVG9rZW4iKSAlXTxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9IkNoYWxsZW5nZVRva2VuIiB2YWx1ZT0iWyUgRW52KCJVc2VyQ2hhbGxlbmdlVG9rZW4iKSB8IGh0bWwgJV0iLz5bJSBFTkQgJV1bJSBJRiBFbnYoIlNlc3Npb25JRCIpICYmICFFbnYoIlNlc3Npb25JRENvb2tpZSIpICVdPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iWyUgRW52KCJTZXNzaW9uTmFtZSIpICVdIiB2YWx1ZT0iWyUgRW52KCJTZXNzaW9uSUQiKSB8IGh0bWwgJV0iLz5bJSBFTkQgJV19c214aWc7CgogICAgcmV0dXJuICRDb250ZW50OwoKfQoKPWl0ZW0gTWlncmF0ZURUTHRvVFQoKQoKdHJhbnNsYXRlcyBvbGQgRFRMIHRlbXBsYXRlIGNvbnRlbnQgdG8gVGVtcGxhdGU6OlRvb2xraXQgc3ludGF4LgoKICAgIG15ICRUVENvZGUgPSAkUHJvdmlkZXJPYmplY3QtPk1pZ3JhdGVEVEx0b1RUKCBDb250ZW50ID0+ICREVExDb2RlICk7CgpJZiBhbiBlcnJvciB3YXMgZm91bmQsIHRoaXMgbWV0aG9kIHdpbGwgZGllKCksIHNvIHBsZWFzZSB1c2UgZXZhbCBhcm91bmQgaXQuCgo9Y3V0CgpzdWIgTWlncmF0ZURUTHRvVFQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkQ29udGVudCA9ICRQYXJhbXtDb250ZW50fTsKCiAgICBteSAkSUQgPSAiW2EtekEtWjAtOTpfXC1dKyI7CgogICAgbXkgJFNhZmVBcnJyYXlBY2Nlc3MgPSBzdWIgewogICAgICAgIG15ICRJRCA9IHNoaWZ0OwogICAgICAgIGlmICggJElEICF+IG17XlthLXpBLVowLTlfXSskfXhtcyApIHsKICAgICAgICAgICAgcmV0dXJuICJpdGVtKFwiJElEXCIpIjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRJRDsKICAgIH07CgogICAgIyAkUXVvdGUgJENvbmZpZwogICAgJENvbnRlbnQgPX4gc3tcJFF1b3RleyJcJENvbmZpZ3siKCRJRCkifSJ9fXtbJSBDb25maWcoIiQxIikgfCBodG1sICVdfXNteGc7CgogICAgIyAkUXVvdGUgJEVudgogICAgJENvbnRlbnQgPX4gc3tcJFF1b3RleyJcJEVudnsiKCRJRCkifSJ9fXtbJSBFbnYoIiQxIikgfCBodG1sICVdfXNteGc7CgogICAgIyAkUXVvdGUgJERhdGEKICAgICRDb250ZW50ID1+IHN7CiAgICAgICAgICAgIFwkUXVvdGV7IlwkRGF0YXsiKCRJRCkifSJ9CiAgICAgICAgfQogICAgICAgIHsKICAgICAgICAgICAgJ1slIERhdGEuJyAuICRTYWZlQXJycmF5QWNjZXNzLT4oJDEpIC4gJyB8IGh0bWwgJV0nCiAgICAgICAgfWVzbXhnOwoKICAgICMgJFF1b3RlIHdpdGggbGVuZ3RoCiAgICAkQ29udGVudCA9fiBzewogICAgICAgICAgICBcJFF1b3RleyJcJERhdGF7IigkSUQpIn0iLFxzKiIoXGQrKSJ9CiAgICAgICAgfQogICAgICAgIHsKICAgICAgICAgICAgJ1slIERhdGEuJyAuICRTYWZlQXJycmF5QWNjZXNzLT4oJDEpIC4gIiB8IHRydW5jYXRlKCQyKSB8IGh0bWwgJV0iCiAgICAgICAgfWVzbXhnOwoKICAgICMgJFF1b3RlIHdpdGggZHluYW1pYyBsZW5ndGgKICAgICRDb250ZW50ID1+IHN7CiAgICAgICAgICAgIFwkUXVvdGV7IlwkRGF0YXsiKCRJRCkifSIsXHMqIlwkUT9EYXRheyIoJElEKSJ9In0KICAgICAgICB9CiAgICAgICAgewogICAgICAgICAgICAnWyUgRGF0YS4nIC4gJFNhZmVBcnJyYXlBY2Nlc3MtPigkMSkgLiAnIHwgdHJ1bmNhdGUoRGF0YS4nIC4gJFNhZmVBcnJyYXlBY2Nlc3MtPigkMikgLiAnKSB8IGh0bWwgJV0nCiAgICAgICAgfWVzbXhnOwoKICAgICMgJFF1b3RlIHdpdGggdHJhbnNsYXRlZCB0ZXh0IGFuZCBmaXhlZCBsZW5ndGgKICAgICRDb250ZW50ID1+IHN7CiAgICAgICAgICAgIFwkUXVvdGV7IlwkVGV4dHsiXCREYXRheyIoJElEKSJ9In0iLFxzKiIoXGQrKSJ9CiAgICAgICAgfQogICAgICAgIHsKICAgICAgICAgICAgJ1slIERhdGEuJyAuICRTYWZlQXJycmF5QWNjZXNzLT4oJDEpIC4gIiB8IFRyYW5zbGF0ZSB8IHRydW5jYXRlKCQyKSB8IGh0bWwgJV0iCiAgICAgICAgfWVzbXhnOwoKICAgICMgJFF1b3RlIHdpdGggdHJhbnNsYXRlZCB0ZXh0IGFuZCBkeW5hbWljIGxlbmd0aAogICAgJENvbnRlbnQgPX4gc3sKICAgICAgICAgICAgXCRRdW90ZXsiXCRUZXh0eyJcJERhdGF7IigkSUQpIn0ifSIsXHMqIlwkUT9EYXRheyIoJElEKSJ9In0KICAgICAgICB9CiAgICAgICAgewogICAgICAgICAgICAnWyUgRGF0YS4nIC4gJFNhZmVBcnJyYXlBY2Nlc3MtPigkMSkgLiAnIHwgVHJhbnNsYXRlIHwgdHJ1bmNhdGUoRGF0YS4nIC4gJFNhZmVBcnJyYXlBY2Nlc3MtPigkMikgLiAnKSB8IGh0bWwgJV0nCiAgICAgICAgfWVzbXhnOwoKICAgIG15ICRNaWdyYXRlVGV4dFRhZyA9IHN1YiB7CiAgICAgICAgbXkgJVBhcmFtICAgICAgID0gQF87CiAgICAgICAgbXkgJE1vZGUgICAgICAgID0gJFBhcmFte01vZGV9OyAgICAgICAgICAjIEhUTUwgb3IgSlNPTgogICAgICAgIG15ICRUZXh0ICAgICAgICA9ICRQYXJhbXtUZXh0fTsgICAgICAgICAgIyBUaGUgdHJhbnNsYXRlZCB0ZXh0CiAgICAgICAgbXkgJERvdCAgICAgICAgID0gJFBhcmFte0RvdH07ICAgICAgICAgICAjIENsb3NpbmcgZG90LCBzb21ldGltZXMgb3V0c2lkZSBvZiB0aGUgVGFnCiAgICAgICAgbXkgJFBhcmFtU3RyaW5nID0gJFBhcmFte1BhcmFtZXRlcnN9OyAgICAjIFBhcmFtZXRlcnMgdG8gaW50ZXJwb2xhdGUKCiAgICAgICAgbXkgJFJlc3VsdCA9ICdbJSAnOwoKICAgICAgICAjIFRleHQgY29udGFpbnMgYSB0YWcKICAgICAgICBpZiAoICRUZXh0ID1+IG17XCRUaW1lTG9uZ3siXCRRP0RhdGF7IigkSUQpIn0ifX1zbXggKSB7CiAgICAgICAgICAgICRSZXN1bHQgLj0gIlRyYW5zbGF0ZShMb2NhbGl6ZShEYXRhLiIgLiAkU2FmZUFycnJheUFjY2Vzcy0+KCQxKSAuICIsIFwiVGltZUxvbmdcIikiOwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRUZXh0ID1+IG17XCRUaW1lU2hvcnR7IlwkUT9EYXRheyIoJElEKSJ9In19c214ICkgewogICAgICAgICAgICAkUmVzdWx0IC49ICJUcmFuc2xhdGUoTG9jYWxpemUoRGF0YS4iIC4gJFNhZmVBcnJyYXlBY2Nlc3MtPigkMSkgLiAiLCBcIlRpbWVTaG9ydFwiKSI7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJFRleHQgPX4gbXtcJERhdGV7IlwkUT9EYXRheyIoJElEKSJ9In19c214ICkgewogICAgICAgICAgICAkUmVzdWx0IC49ICJUcmFuc2xhdGUoTG9jYWxpemUoRGF0YS4iIC4gJFNhZmVBcnJyYXlBY2Nlc3MtPigkMSkgLiAiLCBcIkRhdGVcIikiOwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRUZXh0ID1+IG17XCRRP0RhdGF7IigkSUQpIn19c214ICkgewogICAgICAgICAgICAkUmVzdWx0IC49ICJUcmFuc2xhdGUoRGF0YS4iIC4gJFNhZmVBcnJyYXlBY2Nlc3MtPigkMSkgLiAiIjsKICAgICAgICB9CiAgICAgICAgZWxzaWYgKCAkVGV4dCA9fiBte1wkQ29uZmlneyIoJElEKSJ9fXNteCApIHsKICAgICAgICAgICAgJFJlc3VsdCAuPSAiVHJhbnNsYXRlKENvbmZpZyhcIiQxXCIpIjsKICAgICAgICB9CiAgICAgICAgZWxzaWYgKCAkVGV4dCA9fiBte1wkUT9FbnZ7IigkSUQpIn19c214ICkgewogICAgICAgICAgICAkUmVzdWx0IC49ICJUcmFuc2xhdGUoRW52KFwiJDFcIikiOwogICAgICAgIH0KCiAgICAgICAgIyBQbGFpbiB0ZXh0CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRUZXh0ID1+IHN7In17XFwifXNteGc7ICAgICMgRXNjYXBlICIgc2lnbnMKICAgICAgICAgICAgaWYgKCAkUGFyYW17RG90fSApIHsKICAgICAgICAgICAgICAgICRUZXh0IC49ICRQYXJhbXtEb3R9OwogICAgICAgICAgICB9CiAgICAgICAgICAgICRSZXN1bHQgLj0gIlRyYW5zbGF0ZShcIiRUZXh0XCIiOwogICAgICAgIH0KCiAgICAgICAgbXkgQFBhcmFtZXRlcnMgPSBzcGxpdCBteyxccyp9LCAkUGFyYW1TdHJpbmc7CgogICAgICAgIFBBUkFNRVRFUjoKICAgICAgICBmb3IgbXkgJFBhcmFtZXRlciAoQFBhcmFtZXRlcnMpIHsKICAgICAgICAgICAgbmV4dCBQQVJBTUVURVIgaWYgKCAhJFBhcmFtZXRlciApOwogICAgICAgICAgICBpZiAoICRQYXJhbWV0ZXIgPX4gbXtcJFRpbWVMb25neyJcJFE/RGF0YXsiKCRJRCkifSJ9fXNteCApIHsKICAgICAgICAgICAgICAgICRSZXN1bHQgLj0gIiwgTG9jYWxpemUoRGF0YS4kMSwgXCJUaW1lTG9uZ1wiKSI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCAkUGFyYW1ldGVyID1+IG17XCRUaW1lU2hvcnR7IlwkUT9EYXRheyIoJElEKSJ9In19c214ICkgewogICAgICAgICAgICAgICAgJFJlc3VsdCAuPSAiLCBMb2NhbGl6ZShEYXRhLiQxLCBcIlRpbWVTaG9ydFwiKSI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCAkUGFyYW1ldGVyID1+IG17XCREYXRleyJcJFE/RGF0YXsiKCRJRCkifSJ9fXNteCApIHsKICAgICAgICAgICAgICAgICRSZXN1bHQgLj0gIiwgTG9jYWxpemUoRGF0YS4kMSwgXCJEYXRlXCIpIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNpZiAoICRQYXJhbWV0ZXIgPX4gbXtcJFE/RGF0YXsiKCRJRCkifX1zbXggKSB7CiAgICAgICAgICAgICAgICAkUmVzdWx0IC49ICIsIERhdGEuJDEiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2lmICggJFBhcmFtZXRlciA9fiBte1wkQ29uZmlneyIoJElEKSJ9fXNteCApIHsKICAgICAgICAgICAgICAgICRSZXN1bHQgLj0gIiwgQ29uZmlnKFwiJDFcIikiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2lmICggJFBhcmFtZXRlciA9fiBte1wkUT9FbnZ7IigkSUQpIn19c214ICkgewogICAgICAgICAgICAgICAgJFJlc3VsdCAuPSAiLCBFbnYoXCIkMVwiKSI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkUGFyYW1ldGVyID1+IHN7XiJ8IiR9e31zbXhnOyAgICAjIFJlbW92ZSBlbmNsb3NpbmcgIiIKICAgICAgICAgICAgICAgICRQYXJhbWV0ZXIgPX4gc3sifXtcXCJ9c214ZzsgICAgICMgRXNjYXBlICIgc2lnbnMgaW4gdGhlIHN0cmluZwogICAgICAgICAgICAgICAgJFJlc3VsdCAuPSAiLCBcIiRQYXJhbWV0ZXJcIiI7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICggJE1vZGUgZXEgJ0pTT04nICkgewogICAgICAgICAgICAkUmVzdWx0IC49ICcpIHwgSlNPTiAlXSc7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkUmVzdWx0IC49ICcpIHwgaHRtbCAlXSc7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJFJlc3VsdDsKICAgIH07CgogICAgbXkgJFRleHRPckRhdGEgPSAiIjsKCiAgICAjICRUZXh0CiAgICAkQ29udGVudCA9fiBzewogICAgICAgICAgICBcJFRleHR7CiAgICAgICAgICAgICAgICBbIiddCiAgICAgICAgICAgICAgICAoCiAgICAgICAgICAgICAgICAgICAgW15cJF0rPwogICAgICAgICAgICAgICAgICAgIHxcJFE/RGF0YXtcIiRJRFwifQogICAgICAgICAgICAgICAgICAgIHxcJENvbmZpZ3tcIiRJRFwifQogICAgICAgICAgICAgICAgICAgIHxcJFE/RW52e1wiJElEXCJ9CiAgICAgICAgICAgICAgICAgICAgfFwkVGltZUxvbmd7XCJcJFE/RGF0YXtcIiRJRFwifVwifQogICAgICAgICAgICAgICAgICAgIHxcJFRpbWVTaG9ydHtcIlwkUT9EYXRhe1wiJElEXCJ9XCJ9CiAgICAgICAgICAgICAgICAgICAgfFwkRGF0ZXtcIlwkUT9EYXRhe1wiJElEXCJ9XCJ9CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBbIiddCiAgICAgICAgICAgICAgICAoKD86CiAgICAgICAgICAgICAgICAgICAgLFxzKlsiJ10KICAgICAgICAgICAgICAgICAgICAoPzoKICAgICAgICAgICAgICAgICAgICAgICAgW15cJF0rPwogICAgICAgICAgICAgICAgICAgICAgICB8XCRRP0RhdGF7XCIkSURcIn0KICAgICAgICAgICAgICAgICAgICAgICAgfFwkQ29uZmlne1wiJElEXCJ9CiAgICAgICAgICAgICAgICAgICAgICAgIHxcJFE/RW52e1wiJElEXCJ9CiAgICAgICAgICAgICAgICAgICAgICAgIHxcJFRpbWVMb25ne1wiXCRRP0RhdGF7XCIkSURcIn1cIn0KICAgICAgICAgICAgICAgICAgICAgICAgfFwkVGltZVNob3J0e1wiXCRRP0RhdGF7XCIkSURcIn1cIn0KICAgICAgICAgICAgICAgICAgICAgICAgfFwkRGF0ZXtcIlwkUT9EYXRhe1wiJElEXCJ9XCJ9CiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgWyInXSkqKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHsKICAgICAgICAgICAgJE1pZ3JhdGVUZXh0VGFnLT4oIE1vZGUgPT4gJ0hUTUwnLCBUZXh0ID0+ICQxLCBQYXJhbWV0ZXJzID0+ICQyKTsKICAgICAgICB9ZXNteGc7CgogICAgIyBkcm9wIGVtcHR5ICRUZXh0CiAgICAkQ29udGVudCA9fiBzeyBcJFRleHQgW3tdICIiIFt9XSB9e314bXNnOwoKICAgICMgJEpTVGV4dAogICAgJENvbnRlbnQgPX4gc3sKICAgICAgICAgICAgWyInXVwkSlNUZXh0ewogICAgICAgICAgICAgICAgWyInXQogICAgICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgICAgIFteXCRdKz8KICAgICAgICAgICAgICAgICAgICB8XCRRP0RhdGF7XCIkSURcIn0KICAgICAgICAgICAgICAgICAgICB8XCRDb25maWd7XCIkSURcIn0KICAgICAgICAgICAgICAgICAgICB8XCRRP0VudntcIiRJRFwifQogICAgICAgICAgICAgICAgICAgIHxcJFRpbWVMb25ne1wiXCRRP0RhdGF7XCIkSURcIn1cIn0KICAgICAgICAgICAgICAgICAgICB8XCRUaW1lU2hvcnR7XCJcJFE/RGF0YXtcIiRJRFwifVwifQogICAgICAgICAgICAgICAgICAgIHxcJERhdGV7XCJcJFE/RGF0YXtcIiRJRFwifVwifQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgWyInXQogICAgICAgICAgICAgICAgKCg/OgogICAgICAgICAgICAgICAgICAgICxccypbIiddCiAgICAgICAgICAgICAgICAgICAgKD86CiAgICAgICAgICAgICAgICAgICAgICAgIFteXCRdKz8KICAgICAgICAgICAgICAgICAgICAgICAgfFwkUT9EYXRhe1wiJElEXCJ9CiAgICAgICAgICAgICAgICAgICAgICAgIHxcJENvbmZpZ3tcIiRJRFwifQogICAgICAgICAgICAgICAgICAgICAgICB8XCRRP0VudntcIiRJRFwifQogICAgICAgICAgICAgICAgICAgICAgICB8XCRUaW1lTG9uZ3tcIlwkUT9EYXRhe1wiJElEXCJ9XCJ9CiAgICAgICAgICAgICAgICAgICAgICAgIHxcJFRpbWVTaG9ydHtcIlwkUT9EYXRhe1wiJElEXCJ9XCJ9CiAgICAgICAgICAgICAgICAgICAgICAgIHxcJERhdGV7XCJcJFE/RGF0YXtcIiRJRFwifVwifQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIFsiJ10pKikKICAgICAgICAgICAgfQogICAgICAgICAgICAoLj8pWyInXQogICAgICAgIH0KICAgICAgICB7CiAgICAgICAgICAgICRNaWdyYXRlVGV4dFRhZy0+KCBNb2RlID0+ICdKU09OJywgVGV4dCA9PiAkMSwgUGFyYW1ldGVycyA9PiAkMiwgRG90ID0+ICQzKTsKICAgICAgICB9ZXNteGc7CgogICAgIyAkVGltZUxvbmcKICAgICRDb250ZW50ID1+IHN7XCRUaW1lTG9uZ3siXCRRP0RhdGF7IigkSUQpIn0ifX17WyUgRGF0YS4kMSB8IExvY2FsaXplKCJUaW1lTG9uZyIpICVdfXNteGc7CgogICAgIyAkVGltZVNob3J0CiAgICAkQ29udGVudCA9fiBze1wkVGltZVNob3J0eyJcJFE/RGF0YXsiKCRJRCkifSJ9fXtbJSBEYXRhLiQxIHwgTG9jYWxpemUoIlRpbWVTaG9ydCIpICVdfXNteGc7CgogICAgIyAkRGF0ZQogICAgJENvbnRlbnQgPX4gc3tcJERhdGV7IlwkUT9EYXRheyIoJElEKSJ9In19e1slIERhdGEuJDEgfCBMb2NhbGl6ZSgiRGF0ZSIpICVdfXNteGc7CgogICAgIyAkUURhdGEgd2l0aCBsZW5ndGgKICAgICRDb250ZW50ID1+IHN7CiAgICAgICAgICAgIFwkUURhdGF7IigkSUQpIixccyoiKFxkKykifQogICAgICAgIH0KICAgICAgICB7CiAgICAgICAgICAgICJbJSBEYXRhLiIgLiAkU2FmZUFycnJheUFjY2Vzcy0+KCQxKSAuICIgfCB0cnVuY2F0ZSgkMikgfCBodG1sICVdIgogICAgICAgIH1lc214ZzsKCiAgICAjIHNpbXBsZSAkUURhdGEKICAgICRDb250ZW50ID1+IHN7CiAgICAgICAgICAgIFwkUURhdGF7IigkSUQpIn0KICAgICAgICB9CiAgICAgICAgewogICAgICAgICAgICAiWyUgRGF0YS4iIC4gJFNhZmVBcnJyYXlBY2Nlc3MtPigkMSkgLiAiIHwgaHRtbCAlXSIKICAgICAgICB9ZXNteGc7CgogICAgIyAkTFFEYXRhCiAgICAkQ29udGVudCA9fiBzewogICAgICAgICAgICBcJExRRGF0YXsiKCRJRCkifQogICAgICAgIH0KICAgICAgICB7CiAgICAgICAgICAgICJbJSBEYXRhLiIgLiAkU2FmZUFycnJheUFjY2Vzcy0+KCQxKSAuICIgfCB1cmkgJV0iCiAgICAgICAgfWVzbXhnOwoKICAgICMgc2ltcGxlICREYXRhCiAgICAkQ29udGVudCA9fiBzewogICAgICAgICAgICBcJERhdGF7IigkSUQpIn0KICAgICAgICB9CiAgICAgICAgewogICAgICAgICAgICAiWyUgRGF0YS4iIC4gJFNhZmVBcnJyYXlBY2Nlc3MtPigkMSkgLiAiICVdIgogICAgICAgIH1lc214ZzsKCiAgICAjICRDb25maWcKICAgICRDb250ZW50ID1+IHN7XCRDb25maWd7IigkSUQpIn19e1slIENvbmZpZygiJDEiKSAlXX1zbXhnOwoKICAgICMgJEVudgogICAgJENvbnRlbnQgPX4gc3tcJEVudnsiKCRJRCkifX17WyUgRW52KCIkMSIpICVdfXNteGc7CgogICAgIyAkUUVudgogICAgJENvbnRlbnQgPX4gc3tcJFFFbnZ7IigkSUQpIn19e1slIEVudigiJDEiKSB8IGh0bWwgJV19c214ZzsKCiAgICAjIGR0bDpibG9jawogICAgbXkgJUJsb2NrU2VlbjsKICAgICRDb250ZW50ID1+IHN7PCEtLVxzKmR0bDpibG9jazooJElEKVxzKi0tPn17CiAgICAgICAgaWYgKCRCbG9ja1NlZW57JDF9KysgJSAyKSB7CiAgICAgICAgICAgICJbJSBSZW5kZXJCbG9ja0VuZChcIiQxXCIpICVdIjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICJbJSBSZW5kZXJCbG9ja1N0YXJ0KFwiJDFcIikgJV0iOwogICAgICAgIH0KICAgIH1lc214ZzsKCiAgICAjIGR0bDpqc19vbl9kb2N1bWVudF9jb21wbGV0ZQogICAgJENvbnRlbnQgPX4gc3sKICAgICAgICAgICAgPCEtLVxzKmR0bDpqc19vbl9kb2N1bWVudF9jb21wbGV0ZVxzKi0tPiguKj8pPCEtLVxzKmR0bDpqc19vbl9kb2N1bWVudF9jb21wbGV0ZVxzKi0tPgogICAgICAgIH0KICAgICAgICB7CiAgICAgICAgICAgICJbJSBXUkFQUEVSIEpTT25Eb2N1bWVudENvbXBsZXRlICVdJHsxfVslIEVORCAlXSI7CiAgICAgICAgfWVzbXhnOwoKICAgICMgZHRsOmpzX29uX2RvY3VtZW50X2NvbXBsZXRlX2luc2VydAogICAgJENvbnRlbnQKICAgICAgICA9fiBzezwhLS1ccypkdGw6anNfb25fZG9jdW1lbnRfY29tcGxldGVfcGxhY2Vob2xkZXJccyotLT59e1slIFBST0NFU1MgSlNPbkRvY3VtZW50Q29tcGxldGVJbnNlcnQgJV19c214ZzsKCiAgICAjICRJbmNsdWRlCiAgICAkQ29udGVudCA9fiBze1wkSW5jbHVkZXsiKCRJRCkifX17WyUgSW5zZXJ0VGVtcGxhdGUoIiQxLnR0IikgJV19c214ZzsKCiAgICBteSAoICRDb3VudGVyLCAkRXJyb3JNZXNzYWdlICk7CiAgICBMSU5FOgogICAgZm9yIG15ICRMaW5lICggc3BsaXQgL1xuLywgJENvbnRlbnQgKSB7CiAgICAgICAgJENvdW50ZXIrKzsKCiAgICAgICAgIyBNYWtlIHN1cmUgdGhlcmUgYXJlIG5vIG1vcmUgRFRMIHRhZ3MgcHJlc2VudCBpbiB0aGUgY29kZS4KICAgICAgICBpZiAoICRMaW5lID1+IG17XCQoPzpMP1E/RGF0YXxRdW90ZXxDb25maWd8UT9FbnZ8VGltZXxEYXRlfFRleHR8SlNUZXh0fEluY2x1ZGUpXHt9eG1zICkgewogICAgICAgICAgICAkRXJyb3JNZXNzYWdlIC49ICJMaW5lICRDb3VudGVyOiAkTGluZVxuIjsKICAgICAgICB9CiAgICB9CgogICAgZGllICRFcnJvck1lc3NhZ2UgaWYgJEVycm9yTWVzc2FnZTsKCiAgICByZXR1cm4gJENvbnRlbnQ7Cn0KCjE7Cgo9YmFjawoKPWhlYWQxIFRFUk1TIEFORCBDT05ESVRJT05TCgpUaGlzIHNvZnR3YXJlIGlzIHBhcnQgb2YgdGhlIE9UUlMgcHJvamVjdCAoTDxodHRwOi8vb3Rycy5vcmcvPikuCgpUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQp0aGUgZW5jbG9zZWQgZmlsZSBDT1BZSU5HIGZvciBsaWNlbnNlIGluZm9ybWF0aW9uIChBR1BMKS4gSWYgeW91CmRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBMPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9hZ3BsLnR4dD4uCgo9Y3V0Cg==</File>
        <File Location="KIXCore/Kernel/System/Cache/Memcached.pm" Permission="644" Encode="Base64">IyAtLQojIEtJWENvcmUtRXh0ZW5zaW9ucyBDb3B5cmlnaHQgKEMpIDIwMDYtMjAxNiBjLmEucC5lLiBJVCBHbWJILCBodHRwOi8vd3d3LmNhcGUtaXQuZGUKIwojIHdyaXR0ZW4vZWRpdGVkIGJ5OgojICogUmVuZShkb3QpQm9laG0oYXQpY2FwZShkYXNoKWl0KGRvdClkZQojICogRG9yb3RoZWEoZG90KURvZXJmZmVsKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIwojIC0tCiMgJElkOiBNZW1jYWNoZWQucG0sdiAxLjEyIDIwMTYvMDEvMjAgMTM6NDQ6NTEgZGRvZXJmZmVsIEV4cCAkCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEFHUEwpLiBJZiB5b3UKIyBkaWQgbm90IHJlY2VpdmUgdGhpcyBmaWxlLCBzZWUgaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2FncGwudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6U3lzdGVtOjpDYWNoZTo6TWVtY2FjaGVkOwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIENhY2hlOjpNZW1jYWNoZWQ6OkZhc3Q7CnVzZSBEaWdlc3Q6Ok1ENSBxdygpOwp1bWFzayAwMDI7CgpvdXIgQE9iamVjdERlcGVuZGVuY2llcyA9ICgKICAgICdLZXJuZWw6OkNvbmZpZycsCiAgICAnS2VybmVsOjpTeXN0ZW06OkVuY29kZScsCiAgICAnS2VybmVsOjpTeXN0ZW06OkxvZycsCiAgICAnS2VybmVsOjpTeXN0ZW06Ok1haW4nLAopOwoKdXNlIHZhcnMgcXcoQElTQSk7CgpzdWIgbmV3IHsKICAgIG15ICggJFR5cGUsICVQYXJhbSApID0gQF87CgogICAgIyBhbGxvY2F0ZSBuZXcgaGFzaCBmb3Igb2JqZWN0CiAgICBteSAkU2VsZiA9IHt9OwogICAgYmxlc3MoICRTZWxmLCAkVHlwZSApOwoKICAgICMgZ2V0IGNvbmZpZyBvYmplY3QKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgICRTZWxmLT57Q29uZmlnfSA9ICRDb25maWdPYmplY3QtPkdldCgnQ2FjaGU6Ok1vZHVsZTo6TWVtY2FjaGVkJyk7CiAgICBpZiAoICRTZWxmLT57Q29uZmlnfSApIHsKICAgICAgICAkU2VsZi0+X2luaXRNZW1DYWNoZSgpOwogICAgfQoKICAgIHJldHVybiAkU2VsZjsKfQoKc3ViIFNldCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIGZvciBteSAkTmVlZGVkIChxdyhUeXBlIEtleSBWYWx1ZSBUVEwpKSB7CiAgICAgICAgaWYgKCAhZGVmaW5lZCAkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQhIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBpZiAhJFNlbGYtPntNZW1jYWNoZWRPYmplY3R9OwoKICAgIG15ICRQcmVwYXJlZEtleSA9ICRTZWxmLT5fcHJlcGFyZU1lbUNhY2hlS2V5KCVQYXJhbSk7CiAgICBteSAkVFRMID0gJFBhcmFte1RUTH07CiAgICBpZiAoJFNlbGYtPntDb25maWd9LT57T3ZlcnJpZGVUVEx9KSB7CiAgICAgICAgZm9yZWFjaCBteSAkVHlwZVBhdHRlcm4gKGtleXMgJXskU2VsZi0+e0NvbmZpZ30tPntPdmVycmlkZVRUTH19KSB7CiAgICAgICAgICAgIGlmICgkUGFyYW17VHlwZX0gPX4gL14kVHlwZVBhdHRlcm4kL2cpIHsKICAgICAgICAgICAgICAgICRUVEwgPSAkU2VsZi0+e0NvbmZpZ30tPntPdmVycmlkZVRUTH0tPnskVHlwZVBhdHRlcm59OwogICAgICAgICAgICAgICAgbGFzdDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBpZiAoJFNlbGYtPntDb25maWd9LT57Q2FjaGVNZXRhSW5mb30pIHsKICAgICAgICAjIHVwZGF0ZSBpbmRleGVzCiAgICAgICAgbXkgJFJlc3VsdCA9ICRTZWxmLT57TWVtY2FjaGVkT2JqZWN0fS0+Z2V0X211bHRpKAogICAgICAgICAgICAiTWVtY2FjaGVkOjpDYWNoZWRPYmplY3RzIiwKICAgICAgICAgICAgIk1lbWNhY2hlZDo6Q2FjaGVJbmRleDo6JFBhcmFte1R5cGV9IiwKICAgICAgICApOwoKICAgICAgICAjIHVwZGF0ZSBnbG9iYWwgb2JqZWN0IGluZGV4CiAgICAgICAgaWYgKCAhJFJlc3VsdC0+eydNZW1jYWNoZWQ6OkNhY2hlZE9iamVjdHMnfSB8fCByZWYoICRSZXN1bHQtPnsnTWVtY2FjaGVkOjpDYWNoZWRPYmplY3RzJ30gKSBuZSAnSEFTSCcgKSB7CiAgICAgICAgICAgICRSZXN1bHQtPnsnTWVtY2FjaGVkOjpDYWNoZWRPYmplY3RzJ30gPSB7fTsKICAgICAgICB9CiAgICAgICAgJFJlc3VsdC0+eydNZW1jYWNoZWQ6OkNhY2hlZE9iamVjdHMnfS0+eyAkUGFyYW17VHlwZX0gfSA9IDE7CgogICAgICAgICMgdXBkYXRlIGNhY2hlIGluZGV4IGZvciBUeXBlCiAgICAgICAgaWYgKAogICAgICAgICAgICAhJFJlc3VsdC0+eyJNZW1jYWNoZWQ6OkNhY2hlSW5kZXg6OiRQYXJhbXtUeXBlfSJ9CiAgICAgICAgICAgIHx8IHJlZiggJFJlc3VsdC0+eyJNZW1jYWNoZWQ6OkNhY2hlSW5kZXg6OiRQYXJhbXtUeXBlfSJ9ICkgbmUgJ0hBU0gnCiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgICRSZXN1bHQtPnsiTWVtY2FjaGVkOjpDYWNoZUluZGV4OjokUGFyYW17VHlwZX0ifSA9IHt9OwogICAgICAgIH0KICAgICAgICAkUmVzdWx0LT57Ik1lbWNhY2hlZDo6Q2FjaGVJbmRleDo6JFBhcmFte1R5cGV9In0tPnskUHJlcGFyZWRLZXl9ID0gMTsKCiAgICAgICAgcmV0dXJuICRTZWxmLT57TWVtY2FjaGVkT2JqZWN0fS0+c2V0X211bHRpKAogICAgICAgICAgICBbICRQcmVwYXJlZEtleSwgJFBhcmFte1ZhbHVlfSwgJFRUTCwgXSwKICAgICAgICAgICAgWyAiTWVtY2FjaGVkOjpDYWNoZUluZGV4OjokUGFyYW17VHlwZX0iLCAkUmVzdWx0LT57Ik1lbWNhY2hlZDo6Q2FjaGVJbmRleDo6JFBhcmFte1R5cGV9In0gXSwKICAgICAgICAgICAgWyAiTWVtY2FjaGVkOjpDYWNoZWRPYmplY3RzIiwgICAgICAgICAgJFJlc3VsdC0+eyJNZW1jYWNoZWQ6OkNhY2hlZE9iamVjdHMifSBdLAogICAgICAgICk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAjIHVwZGF0ZSBpbmRleGVzCiAgICAgICAgbXkgJFJlc3VsdCA9ICRTZWxmLT57TWVtY2FjaGVkT2JqZWN0fS0+Z2V0KAogICAgICAgICAgICAiTWVtY2FjaGVkOjpDYWNoZUluZGV4OjokUGFyYW17VHlwZX0iLAogICAgICAgICk7CgogICAgICAgICMgdXBkYXRlIGNhY2hlIGluZGV4IGZvciBUeXBlCiAgICAgICAgaWYgKCEkUmVzdWx0IHx8IHJlZiggJFJlc3VsdCApIG5lICdIQVNIJykgewogICAgICAgICAgICAkUmVzdWx0ID0ge307CiAgICAgICAgfQogICAgICAgICRSZXN1bHQtPnskUHJlcGFyZWRLZXl9ID0gMTsKCiAgICAgICAgcmV0dXJuICRTZWxmLT57TWVtY2FjaGVkT2JqZWN0fS0+c2V0X211bHRpKAogICAgICAgICAgICBbICRQcmVwYXJlZEtleSwgJFBhcmFte1ZhbHVlfSwgJFRUTCwgXSwKICAgICAgICAgICAgWyAiTWVtY2FjaGVkOjpDYWNoZUluZGV4OjokUGFyYW17VHlwZX0iLCAkUmVzdWx0IF0sCiAgICAgICAgKTsKICAgIH0KfQoKc3ViIEdldCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgKHF3KFR5cGUgS2V5KSkgewogICAgICAgIGlmICggIWRlZmluZWQgJFBhcmFteyRffSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coIFByaW9yaXR5ID0+ICdlcnJvcicsIE1lc3NhZ2UgPT4gIk5lZWQgJF8hIiApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBpZiAhJFNlbGYtPntNZW1jYWNoZWRPYmplY3R9OwoKICAgIHJldHVybiAkU2VsZi0+e01lbWNhY2hlZE9iamVjdH0tPmdldCgKICAgICAgICAkU2VsZi0+X3ByZXBhcmVNZW1DYWNoZUtleSglUGFyYW0pLAogICAgKTsKfQoKc3ViIERlbGV0ZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgKHF3KFR5cGUgS2V5KSkgewogICAgICAgIGlmICggIWRlZmluZWQgJFBhcmFteyRffSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coIFByaW9yaXR5ID0+ICdlcnJvcicsIE1lc3NhZ2UgPT4gIk5lZWQgJF8hIiApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBpZiAoICEkU2VsZi0+e01lbWNhY2hlZE9iamVjdH0gKTsKCiAgICByZXR1cm4gJFNlbGYtPntNZW1jYWNoZWRPYmplY3R9LT5kZWxldGUoCiAgICAgICAgJFNlbGYtPl9wcmVwYXJlTWVtQ2FjaGVLZXkoJVBhcmFtKQogICAgKTsKfQoKc3ViIENsZWFuVXAgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICByZXR1cm4gaWYgKCAhJFNlbGYtPntNZW1jYWNoZWRPYmplY3R9ICk7CgogICAgaWYgKCAkUGFyYW17VHlwZX0gKSB7CgogICAgICAgICMgZ2V0IGNhY2hlIGluZGV4IGZvciBUeXBlCiAgICAgICAgbXkgJENhY2hlSW5kZXggPSAkU2VsZi0+e01lbWNhY2hlZE9iamVjdH0tPmdldCgKICAgICAgICAgICAgIk1lbWNhY2hlZDo6Q2FjaGVJbmRleDo6JFBhcmFte1R5cGV9IiwKICAgICAgICApOwogICAgICAgIGlmICggJENhY2hlSW5kZXggJiYgcmVmKCRDYWNoZUluZGV4KSBlcSAnSEFTSCcgKSB7CiAgICAgICAgICAgICRTZWxmLT57TWVtY2FjaGVkT2JqZWN0fS0+ZGVsZXRlX211bHRpKAogICAgICAgICAgICAgICAga2V5cyAleyRDYWNoZUluZGV4fSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgZGVsZXRlIGNhY2hlIGluZGV4CiAgICAgICAgICAgICRTZWxmLT57TWVtY2FjaGVkT2JqZWN0fS0+ZGVsZXRlKAogICAgICAgICAgICAgICAgIk1lbWNhY2hlZDo6Q2FjaGVJbmRleDo6JFBhcmFte1R5cGV9IiwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICgkU2VsZi0+e0NvbmZpZ30tPntDYWNoZU1ldGFJbmZvfSkgewogICAgICAgICAgICAgICAgIyBkZWxldGUgZnJvbSBnbG9iYWwgb2JqZWN0IGluZGV4CiAgICAgICAgICAgICAgICAkQ2FjaGVJbmRleCA9ICRTZWxmLT57TWVtY2FjaGVkT2JqZWN0fS0+Z2V0KAogICAgICAgICAgICAgICAgICAgICJNZW1jYWNoZWQ6OkNhY2hlZE9iamVjdHMiLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGRlbGV0ZSAkQ2FjaGVJbmRleC0+eyAkUGFyYW17VHlwZX0gfTsKICAgICAgICAgICAgICAgICRTZWxmLT57TWVtY2FjaGVkT2JqZWN0fS0+c2V0KAogICAgICAgICAgICAgICAgICAgICJNZW1jYWNoZWQ6OkNhY2hlZE9iamVjdHMiLAogICAgICAgICAgICAgICAgICAgICRDYWNoZUluZGV4LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gMTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHJldHVybiAkU2VsZi0+e01lbWNhY2hlZE9iamVjdH0tPmZsdXNoX2FsbCgpOwogICAgfQp9Cgo9aXRlbSBfaW5pdE1lbUNhY2hlKCkKCmluaXRpYWxpemUgY29ubmVjdGlvbiB0byBtZW1jYWNoZWQKCiAgICBteSAkVmFsdWUgPSAkQ2FjaGVJbnRlcm5hbE9iamVjdC0+X2luaXRNZW1DYWNoZSgpOwoKPWN1dAoKc3ViIF9pbml0TWVtQ2FjaGUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkSW5pdFBhcmFtcyA9IHsKICAgICAgICBzZXJ2ZXJzID0+ICRTZWxmLT57Q29uZmlnfS0+e1NlcnZlcnN9LAogICAgICAgICV7ICRTZWxmLT57Q29uZmlnfS0+e1BhcmFtZXRlcnN9IH0sCiAgICB9OwoKICAgICRTZWxmLT57TWVtY2FjaGVkT2JqZWN0fSA9IENhY2hlOjpNZW1jYWNoZWQ6OkZhc3QtPm5ldygkSW5pdFBhcmFtcykKICAgICAgICB8fCBkaWUgIlVuYWJsZSB0byBpbml0aWFsaXplIG1lbWNhY2hlZCBjb25uZWN0aW9uISI7CgogICAgcmV0dXJuIDE7Cn0KCj1pdGVtIF9wcmVwYXJlTWVtQ2FjaGVLZXkoKQoKVXNlIE1ENSBkaWdlc3Qgb2YgS2V5IGZvciBtZW1jYWNoZWQga2V5IChtZW1jYWNoZWQga2V5IG1heCBsZW5ndGggaXMgMjUwKTsKd2UgdXNlIGhlcmUgYWxnbyBzaW1pbGFyIHRvIG9yaWdpbmFsIG9uZSBmcm9tIEZpbGVTdG9yYWJsZS5wbS4KKHRoYW5rcyB0byBJbmZvcm1hdHlrYSBCb2d1c2xhd3NraSBzcC4geiBvLm8uIHNwLmsuLCBodHRwOi8vd3d3LmliLnBsLyBmb3IgdGVzdGluZyBhbmQgY29udHJpYnV0aW5nIHRoZSBNRDUgY2hhbmdlKQoKICAgIG15ICRQcmVwYXJlZEtleSA9ICRDYWNoZUludGVybmFsT2JqZWN0LT5fcHJlcGFyZU1lbUNhY2hlS2V5KAogICAgICAgICdTb21lS2V5JywKICAgICk7Cgo9Y3V0CgpzdWIgX3ByZXBhcmVNZW1DYWNoZUtleSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIGlmICgkUGFyYW17UmF3fSkgewogICAgICAgIHJldHVybiAkUGFyYW17VHlwZX0uJzo6Jy4kUGFyYW17S2V5fTsKICAgIH0KCiAgICBteSAkS2V5ID0gJFBhcmFte0tleX07CiAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RW5jb2RlJyktPkVuY29kZU91dHB1dCggXCRLZXkgKTsKICAgICRLZXkgPSBEaWdlc3Q6Ok1ENTo6bWQ1X2hleCgkS2V5KTsKICAgICRLZXkgPSAkUGFyYW17VHlwZX0gLiAnOjonIC4gJEtleTsKICAgIHJldHVybiAkS2V5Owp9CgoxOwo=</File>
        <File Location="KIXCore/Kernel/System/Console/Command/Admin/MultipleCustomPackages/CleanUpConfigPm.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwNi0yMDE2IGMuYS5wLmUuIElUIEdtYkgsIGh0dHA6Ly93d3cuY2FwZS1pdC5kZQojCiMgd3JpdHRlbi9lZGl0ZWQgYnk6CiMgKiBUb3JzdGVuKGRvdClUaGF1KGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIFJlbmUoZG90KUJvZWhtKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIERvcm90aGVhKGRvdClEb2VyZmZlbChhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMKIyAtLQojIFRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCiMgdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoQUdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvYWdwbC50eHQuCiMgLS0KCnBhY2thZ2UgS2VybmVsOjpTeXN0ZW06OkNvbnNvbGU6OkNvbW1hbmQ6OkFkbWluOjpNdWx0aXBsZUN1c3RvbVBhY2thZ2VzOjpDbGVhblVwQ29uZmlnUG07Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7Cgp1c2UgYmFzZSBxdyhLZXJuZWw6OlN5c3RlbTo6Q29uc29sZTo6QmFzZUNvbW1hbmQpOwoKb3VyIEBPYmplY3REZXBlbmRlbmNpZXMgPSAoCiAgICAnS2VybmVsOjpTeXN0ZW06OktJWFV0aWxzJywKKTsKCnN1YiBDb25maWd1cmUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAkU2VsZi0+RGVzY3JpcHRpb24oJ1Jlc3RvcmUgb2xkIENvbmZpZy5wbScpOwogICAgcmV0dXJuOwp9CgpzdWIgUnVuIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CiAgICAkU2VsZi0+UHJpbnQoIjx5ZWxsb3c+Tk9URTogc3RhcnQgdG8gcmVzdG9yZSBvbGQgJ0NvbmZpZy5wbSc8L3llbGxvdz5cbiIpOwoKICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpLSVhVdGlscycpLT5DbGVhblVwQ29uZmlnUG0oJVBhcmFtKTsKCiAgICAkU2VsZi0+UHJpbnQoIjxncmVlbj5Eb25lLjwvZ3JlZW4+XG4iKTsKICAgIHJldHVybiAkU2VsZi0+RXhpdENvZGVPaygpOwp9CgoxOwoK</File>
        <File Location="KIXCore/Kernel/System/Console/Command/Admin/MultipleCustomPackages/List.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwNi0yMDE2IGMuYS5wLmUuIElUIEdtYkgsIGh0dHA6Ly93d3cuY2FwZS1pdC5kZQojCiMgd3JpdHRlbi9lZGl0ZWQgYnk6CiMgKiBUb3JzdGVuKGRvdClUaGF1KGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIFJlbmUoZG90KUJvZWhtKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIERvcm90aGVhKGRvdClEb2VyZmZlbChhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMKIyAtLQojIFRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCiMgdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoQUdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvYWdwbC50eHQuCiMgLS0KCnBhY2thZ2UgS2VybmVsOjpTeXN0ZW06OkNvbnNvbGU6OkNvbW1hbmQ6OkFkbWluOjpNdWx0aXBsZUN1c3RvbVBhY2thZ2VzOjpMaXN0OwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIGJhc2UgcXcoS2VybmVsOjpTeXN0ZW06OkNvbnNvbGU6OkJhc2VDb21tYW5kKTsKCm91ciBAT2JqZWN0RGVwZW5kZW5jaWVzID0gKAogICAgJ0tlcm5lbDo6U3lzdGVtOjpLSVhVdGlscycsCik7CgpzdWIgQ29uZmlndXJlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgJFNlbGYtPkRlc2NyaXB0aW9uKCdMaXN0IGFsbCBjdXN0b20gcGFja2FnZXMuJyk7CiAgICByZXR1cm47Cn0KCnN1YiBSdW4gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKICAgICRTZWxmLT5QcmludCgKICAgICAgICAiPHllbGxvdz5OT1RFOiBUaGUgZm9sbG93aW5nIHBhY2thZ2VzIGFyZSBjdXJyZW50bHkgcmVnaXN0ZXJlZCBhbmQgc2hvdWxkICIKICAgICAgICAgICAgLiAiYXBwZWFyIGluIENvbmZpZy5wbSBhbmQgYXBhY2hlMi1wZXJsLXN0YXJ0dXAucGw6PC95ZWxsb3c+XG4iCiAgICApOwoKICAgIG15ICRSZWdpc3RlcmVkUGFja2FnZXMKICAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpLSVhVdGlscycpLT5HZXRSZWdpc3RlcmVkQ3VzdG9tUGFja2FnZXMoJVBhcmFtKTsKICAgIGZvciBteSAkQ3VyclByaW9LZXkgKCBzb3J0KCBrZXlzKCAleyRSZWdpc3RlcmVkUGFja2FnZXN9ICkgKSApIHsKICAgICAgICBwcmludCAiXG5cdCAiIC4gJEN1cnJQcmlvS2V5OwogICAgfQogICAgcHJpbnQgIlxuXG4iOwoKICAgICRTZWxmLT5QcmludCgiPGdyZWVuPkRvbmUuPC9ncmVlbj5cbiIpOwogICAgcmV0dXJuICRTZWxmLT5FeGl0Q29kZU9rKCk7Cn0KCjE7Cgo=</File>
        <File Location="KIXCore/Kernel/System/Console/Command/Admin/MultipleCustomPackages/Rebuild.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwNi0yMDE2IGMuYS5wLmUuIElUIEdtYkgsIGh0dHA6Ly93d3cuY2FwZS1pdC5kZQojCiMgd3JpdHRlbi9lZGl0ZWQgYnk6CiMgKiBUb3JzdGVuKGRvdClUaGF1KGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIFJlbmUoZG90KUJvZWhtKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIERvcm90aGVhKGRvdClEb2VyZmZlbChhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMKIyAtLQojIFRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCiMgdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoQUdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvYWdwbC50eHQuCiMgLS0KCnBhY2thZ2UgS2VybmVsOjpTeXN0ZW06OkNvbnNvbGU6OkNvbW1hbmQ6OkFkbWluOjpNdWx0aXBsZUN1c3RvbVBhY2thZ2VzOjpSZWJ1aWxkOwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIGJhc2UgcXcoS2VybmVsOjpTeXN0ZW06OkNvbnNvbGU6OkJhc2VDb21tYW5kKTsKCm91ciBAT2JqZWN0RGVwZW5kZW5jaWVzID0gKAogICAgJ0tlcm5lbDo6U3lzdGVtOjpLSVhVdGlscycsCik7CgpzdWIgQ29uZmlndXJlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgJFNlbGYtPkRlc2NyaXB0aW9uKCdSZWJ1aWxkIGxpYnJhcnkgcGF0aHMnKTsKICAgIHJldHVybjsKfQoKc3ViIFJ1biB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwogICAgJFNlbGYtPlByaW50KCI8eWVsbG93Pk5PVEU6IHN0YXJ0IHRvIHJlYnVpbGQgbGlicmFyeSBwYXRoc1xuXG48L3llbGxvdz5cbiIpOwoKICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpLSVhVdGlscycpLT5SZWJ1aWxkQ29uZmlnKCVQYXJhbSk7CgogICAgJFNlbGYtPlByaW50KCI8Z3JlZW4+RG9uZS48L2dyZWVuPlxuIik7CiAgICByZXR1cm4gJFNlbGYtPkV4aXRDb2RlT2soKTsKfQoKMTsKCg==</File>
        <File Location="KIXCore/Kernel/System/Console/Command/Admin/MultipleCustomPackages/Register.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwNi0yMDE2IGMuYS5wLmUuIElUIEdtYkgsIGh0dHA6Ly93d3cuY2FwZS1pdC5kZQojCiMgd3JpdHRlbi9lZGl0ZWQgYnk6CiMgKiBUb3JzdGVuKGRvdClUaGF1KGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIFJlbmUoZG90KUJvZWhtKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIERvcm90aGVhKGRvdClEb2VyZmZlbChhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMKIyAtLQojIFRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCiMgdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoQUdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvYWdwbC50eHQuCiMgLS0KCnBhY2thZ2UgS2VybmVsOjpTeXN0ZW06OkNvbnNvbGU6OkNvbW1hbmQ6OkFkbWluOjpNdWx0aXBsZUN1c3RvbVBhY2thZ2VzOjpSZWdpc3RlcjsKCnVzZSBzdHJpY3Q7CnVzZSB3YXJuaW5nczsKCnVzZSBiYXNlIHF3KEtlcm5lbDo6U3lzdGVtOjpDb25zb2xlOjpCYXNlQ29tbWFuZCk7CgpvdXIgQE9iamVjdERlcGVuZGVuY2llcyA9ICgKICAgICdLZXJuZWw6OlN5c3RlbTo6S0lYVXRpbHMnLAopOwoKc3ViIENvbmZpZ3VyZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICRTZWxmLT5EZXNjcmlwdGlvbignUmVnaXN0ZXIgYSBjdXN0b20gcGFja2FnZScpOwoKICAgICRTZWxmLT5BZGRBcmd1bWVudCgKICAgICAgICBOYW1lICAgICAgICA9PiAncGFja2FnZS1uYW1lJywKICAgICAgICBEZXNjcmlwdGlvbiA9PiAnbmFtZSBvZiBwYWNrYWdlIHRvIHJlZ2lzdGVyJywKICAgICAgICBSZXF1aXJlZCAgICA9PiAxLAogICAgICAgIFZhbHVlUmVnZXggID0+IHFyLyguKikvc214LAogICAgKTsKICAgICRTZWxmLT5BZGRBcmd1bWVudCgKICAgICAgICBOYW1lICAgICAgICA9PiAncHJpb3JpdHknLAogICAgICAgIERlc2NyaXB0aW9uID0+ICdwYWNrYWdlIHByaW9yaXR5JywKICAgICAgICBSZXF1aXJlZCAgICA9PiAxLAogICAgICAgIFZhbHVlUmVnZXggID0+IHFyL14oXGR7NH0pJC9zbXgsCiAgICApOwoKICAgIHJldHVybjsKfQoKc3ViIFJ1biB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRQYWNrYWdlTmFtZSA9ICRTZWxmLT5HZXRBcmd1bWVudCgncGFja2FnZS1uYW1lJyk7CiAgICBteSAkUHJpb3JpdHkgICAgPSAkU2VsZi0+R2V0QXJndW1lbnQoJ3ByaW9yaXR5Jyk7CgogICAgJFNlbGYtPlByaW50KCI8eWVsbG93Pk5PVEU6IHN0YXJ0IHRvIHJlZ2lzdGVyIHBhY2thZ2UgJyRQYWNrYWdlTmFtZSdcblxuPC95ZWxsb3c+XG4iKTsKCiAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6S0lYVXRpbHMnKS0+UmVnaXN0ZXJDdXN0b21QYWNrYWdlKAogICAgICAgIFBhY2thZ2VOYW1lID0+ICRQYWNrYWdlTmFtZSwKICAgICAgICBQcmlvcml0eSAgICA9PiAkUHJpb3JpdHkKICAgICk7CgogICAgJFNlbGYtPlByaW50KCI8Z3JlZW4+RG9uZS48L2dyZWVuPlxuIik7CiAgICByZXR1cm4gJFNlbGYtPkV4aXRDb2RlT2soKTsKfQoKMTsKCg==</File>
        <File Location="KIXCore/Kernel/System/Console/Command/Admin/MultipleCustomPackages/Unregister.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwNi0yMDE2IGMuYS5wLmUuIElUIEdtYkgsIGh0dHA6Ly93d3cuY2FwZS1pdC5kZQojCiMgd3JpdHRlbi9lZGl0ZWQgYnk6CiMgKiBUb3JzdGVuKGRvdClUaGF1KGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIFJlbmUoZG90KUJvZWhtKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIERvcm90aGVhKGRvdClEb2VyZmZlbChhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMKIyAtLQojIFRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCiMgdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoQUdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvYWdwbC50eHQuCiMgLS0KCnBhY2thZ2UgS2VybmVsOjpTeXN0ZW06OkNvbnNvbGU6OkNvbW1hbmQ6OkFkbWluOjpNdWx0aXBsZUN1c3RvbVBhY2thZ2VzOjpVbnJlZ2lzdGVyOwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIGJhc2UgcXcoS2VybmVsOjpTeXN0ZW06OkNvbnNvbGU6OkJhc2VDb21tYW5kKTsKCm91ciBAT2JqZWN0RGVwZW5kZW5jaWVzID0gKAogICAgJ0tlcm5lbDo6U3lzdGVtOjpLSVhVdGlscycsCik7CgpzdWIgQ29uZmlndXJlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgJFNlbGYtPkRlc2NyaXB0aW9uKCdSZWdpc3RlciBhIGN1c3RvbSBwYWNrYWdlJyk7CgogICAgJFNlbGYtPkFkZEFyZ3VtZW50KAogICAgICAgIE5hbWUgICAgICAgID0+ICdwYWNrYWdlLW5hbWUnLAogICAgICAgIERlc2NyaXB0aW9uID0+ICduYW1lIG9mIHBhY2thZ2UgdG8gcmVnaXN0ZXInLAogICAgICAgIFJlcXVpcmVkICAgID0+IDEsCiAgICAgICAgVmFsdWVSZWdleCAgPT4gcXIvKC4qKS9zbXgsCiAgICApOwoKICAgIHJldHVybjsKfQoKc3ViIFJ1biB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRQYWNrYWdlTmFtZSA9ICRTZWxmLT5HZXRBcmd1bWVudCgncGFja2FnZS1uYW1lJyk7CgogICAgJFNlbGYtPlByaW50KCI8eWVsbG93Pk5PVEU6IHN0YXJ0IHRvIHVucmVnaXN0ZXIgcGFja2FnZSAnJFBhY2thZ2VOYW1lJ1xuXG48L3llbGxvdz5cbiIpOwoKICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpLSVhVdGlscycpLT5VblJlZ2lzdGVyQ3VzdG9tUGFja2FnZSgKICAgICAgICBQYWNrYWdlTmFtZSA9PiAkUGFja2FnZU5hbWUKICAgICk7CgogICAgJFNlbGYtPlByaW50KCI8Z3JlZW4+RG9uZS48L2dyZWVuPlxuIik7CiAgICByZXR1cm4gJFNlbGYtPkV4aXRDb2RlT2soKTsKfQoKMTsKCg==</File>
        <File Location="KIXCore/Kernel/System/Console/Command/Maint/LoaderCache/Rebuild.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwNi0yMDE2IGMuYS5wLmUuIElUIEdtYkgsIGh0dHA6Ly93d3cuY2FwZS1pdC5kZQojCiMgd3JpdHRlbi9lZGl0ZWQgYnk6CiMgKiBEb3JvdGhlYShkb3QpRG9lcmZmZWwoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEFHUEwpLiBJZiB5b3UKIyBkaWQgbm90IHJlY2VpdmUgdGhpcyBmaWxlLCBzZWUgaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2FncGwudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6U3lzdGVtOjpDb25zb2xlOjpDb21tYW5kOjpNYWludDo6TG9hZGVyQ2FjaGU6OlJlYnVpbGQ7Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7Cgp1c2UgYmFzZSBxdyhLZXJuZWw6OlN5c3RlbTo6Q29uc29sZTo6QmFzZUNvbW1hbmQpOwoKb3VyIEBPYmplY3REZXBlbmRlbmNpZXMgPSAoCiAgICAnS2VybmVsOjpDb25maWcnLAogICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnCik7CgpzdWIgQ29uZmlndXJlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgJFNlbGYtPkRlc2NyaXB0aW9uKCdSZWJ1aWxkcyB0aGUgbG9hZGVyIGNhY2hlLicpOwoKICAgIHJldHVybjsKfQoKc3ViIFJ1biB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICRTZWxmLT5QcmludCgiPHllbGxvdz5SZWJ1aWxkaW5nIGxvYWRlciBjYWNoZS4uLjwveWVsbG93PlxuIik7CgogICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+eydMb2FkZXI6OlByZUNyZWF0ZWRDYWNoZXMnfSA9IDA7CgogICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpLT5Mb2FkZXJDcmVhdGVBZ2VudENTU0NhbGxzKCk7CiAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JyktPkxvYWRlckNyZWF0ZUFnZW50SlNDYWxscygpOwogICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpLT5Mb2FkZXJDcmVhdGVDdXN0b21lckNTU0NhbGxzKCk7CiAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JyktPkxvYWRlckNyZWF0ZUN1c3RvbWVySlNDYWxscygpOwoKICAgICRTZWxmLT5QcmludCgiPGdyZWVuPkRvbmUuPC9ncmVlbj5cbiIpOwogICAgcmV0dXJuICRTZWxmLT5FeGl0Q29kZU9rKCk7Cn0KCjE7Cgo=</File>
        <File Location="KIXCore/Kernel/System/Console/Command/Maint/Memcached/Details.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwNi0yMDE2IGMuYS5wLmUuIElUIEdtYkgsIGh0dHA6Ly93d3cuY2FwZS1pdC5kZQojCiMgd3JpdHRlbi9lZGl0ZWQgYnk6CiMgKiBSZW5lKGRvdClCb2VobShhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMgKiBEb3JvdGhlYShkb3QpRG9lcmZmZWwoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEFHUEwpLiBJZiB5b3UKIyBkaWQgbm90IHJlY2VpdmUgdGhpcyBmaWxlLCBzZWUgaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2FncGwudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6U3lzdGVtOjpDb25zb2xlOjpDb21tYW5kOjpNYWludDo6TWVtY2FjaGVkczo6RGV0YWlsczsKCnVzZSBzdHJpY3Q7CnVzZSB3YXJuaW5nczsKCnVzZSBiYXNlIHF3KEtlcm5lbDo6U3lzdGVtOjpDb25zb2xlOjpCYXNlQ29tbWFuZCk7CgpvdXIgQE9iamVjdERlcGVuZGVuY2llcyA9ICgKICAgICdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnLAopOwoKc3ViIENvbmZpZ3VyZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICRTZWxmLT5EZXNjcmlwdGlvbignRGV0YWlsZWQgaW5mb3MgYWJvdXQgb2JqZWN0cyBpbiBtZW1jYWNoZWQuJyk7CgogICAgJFNlbGYtPkFkZEFyZ3VtZW50KAogICAgICAgIE5hbWUgICAgICAgID0+ICd0eXBlJywKICAgICAgICBEZXNjcmlwdGlvbiA9PiAnY2FjaGUgdHlwZScsCiAgICAgICAgUmVxdWlyZWQgICAgPT4gMSwKICAgICAgICBWYWx1ZVJlZ2V4ICA9PiBxci8oLiopL3NteCwKICAgICk7CiAgICAkU2VsZi0+QWRkQXJndW1lbnQoCiAgICAgICAgTmFtZSAgICAgICAgPT4gJ2tleScsCiAgICAgICAgRGVzY3JpcHRpb24gPT4gJ2NhY2hlIGtleScsCiAgICAgICAgUmVxdWlyZWQgICAgPT4gMSwKICAgICAgICBWYWx1ZVJlZ2V4ICA9PiBxci8oLiopL3NteCwKICAgICk7CgogICAgcmV0dXJuOwp9CgpzdWIgUnVuIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJFR5cGUgPSAkU2VsZi0+R2V0QXJndW1lbnQoJ3R5cGUnKTsKICAgIG15ICRLZXkgID0gJFNlbGYtPkdldEFyZ3VtZW50KCdrZXknKTsKCiAgICAjIGdldCBjb250ZW50IGZvciBjYWNoZSBrZXkKICAgIG15ICRSZXN1bHQgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKS0+R2V0KAogICAgICAgIEtleSAgPT4gJEtleSwKICAgICAgICBUeXBlID0+ICRUeXBlLAogICAgICAgIFJhdyAgPT4gMSwKICAgICk7CiAgICBpZiAoJFJlc3VsdCkgewogICAgICAgIHVzZSBEYXRhOjpEdW1wZXI7CiAgICAgICAgcHJpbnQgU1RERVJSIER1bXBlcigkUmVzdWx0KTsKICAgIH0KCiAgICAkU2VsZi0+UHJpbnQoIjxncmVlbj5Eb25lLjwvZ3JlZW4+XG4iKTsKICAgIHJldHVybiAkU2VsZi0+RXhpdENvZGVPaygpOwp9CgoxOwoK</File>
        <File Location="KIXCore/Kernel/System/Console/Command/Maint/Memcached/List.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwNi0yMDE2IGMuYS5wLmUuIElUIEdtYkgsIGh0dHA6Ly93d3cuY2FwZS1pdC5kZQojCiMgd3JpdHRlbi9lZGl0ZWQgYnk6CiMgKiBSZW5lKGRvdClCb2VobShhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMgKiBEb3JvdGhlYShkb3QpRG9lcmZmZWwoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEFHUEwpLiBJZiB5b3UKIyBkaWQgbm90IHJlY2VpdmUgdGhpcyBmaWxlLCBzZWUgaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2FncGwudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6U3lzdGVtOjpDb25zb2xlOjpDb21tYW5kOjpNYWludDo6TWVtY2FjaGVkOjpMaXN0OwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIGJhc2UgcXcoS2VybmVsOjpTeXN0ZW06OkNvbnNvbGU6OkJhc2VDb21tYW5kKTsKCm91ciBAT2JqZWN0RGVwZW5kZW5jaWVzID0gKAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScsCik7CgpzdWIgQ29uZmlndXJlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgJFNlbGYtPkRlc2NyaXB0aW9uKCdJbmZvcyBhYm91dCBvYmplY3RzIGluIG1lbWNhY2hlZC4nKTsKCiAgICByZXR1cm47Cn0KCnN1YiBSdW4gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGdldCBhbGwgY2FjaGVkIG9iamVjdCB0eXBlcwogICAgbXkgJFJlc3VsdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpLT5HZXQoCiAgICAgICAgS2V5ICA9PiAnQ2FjaGVkT2JqZWN0cycsCiAgICAgICAgVHlwZSA9PiAnTWVtY2FjaGVkJywKICAgICAgICBSYXcgID0+IDEsCiAgICApOwogICAgaWYgKCAkUmVzdWx0ICYmIHJlZigkUmVzdWx0KSBlcSAnSEFTSCcgKSB7CiAgICAgICAgZm9yZWFjaCBteSAkVHlwZSAoIHNvcnQga2V5cyAleyRSZXN1bHR9ICkgewogICAgICAgICAgICBwcmludCAkVHlwZS4gIlxuIjsKICAgICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkU2VsZi0+UHJpbnQoIllvdSBjYW4ndCB1c2UgdGhlIFwiYWxsXCIgb3B0aW9uLCBiZWNhdXNlIHRoZXJlIGlzIG5vIGluZm9ybWF0aW9uIGFib3V0IHRoZSBjYWNoZWQgb2JqZWN0cyBzdG9yZWQgaW4gdGhlIG1lbWNhY2hlLiBUaGlzIGlzIHRoZSBjYXNlIGlmIHlvdSd2ZSBkZWFrdGl2YXRlZCB0aGUgb3B0aW9uIFwiQ2FjaGU6Ok1vZHVsZTo6TWVtY2FjaGVkIyMjQ2FjaGVNZXRhSW5mb1wiIGluIHRoZSBTeXNDb25maWcuIik7CiAgICB9CgogICAgJFNlbGYtPlByaW50KCI8Z3JlZW4+RG9uZS48L2dyZWVuPlxuIik7CiAgICByZXR1cm4gJFNlbGYtPkV4aXRDb2RlT2soKTsKfQoKMTsKCg==</File>
        <File Location="KIXCore/Kernel/System/Console/Command/Maint/Memcached/Remove.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwNi0yMDE2IGMuYS5wLmUuIElUIEdtYkgsIGh0dHA6Ly93d3cuY2FwZS1pdC5kZQojCiMgd3JpdHRlbi9lZGl0ZWQgYnk6CiMgKiBSZW5lKGRvdClCb2VobShhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMgKiBEb3JvdGhlYShkb3QpRG9lcmZmZWwoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEFHUEwpLiBJZiB5b3UKIyBkaWQgbm90IHJlY2VpdmUgdGhpcyBmaWxlLCBzZWUgaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2FncGwudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6U3lzdGVtOjpDb25zb2xlOjpDb21tYW5kOjpNYWludDo6TWVtY2FjaGVkczo6UmVtb3ZlOwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIGJhc2UgcXcoS2VybmVsOjpTeXN0ZW06OkNvbnNvbGU6OkJhc2VDb21tYW5kKTsKCm91ciBAT2JqZWN0RGVwZW5kZW5jaWVzID0gKAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScsCik7CgpzdWIgQ29uZmlndXJlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgJFNlbGYtPkRlc2NyaXB0aW9uKCdSZW1vdmVzIG9iamVjdHMgaW4gbWVtY2FjaGVkLicpOwoKICAgICRTZWxmLT5BZGRBcmd1bWVudCgKICAgICAgICBOYW1lICAgICAgICA9PiAndHlwZScsCiAgICAgICAgRGVzY3JpcHRpb24gPT4gJ2NhY2hlIHR5cGUnLAogICAgICAgIFJlcXVpcmVkICAgID0+IDEsCiAgICAgICAgVmFsdWVSZWdleCAgPT4gcXIvKC4qKS9zbXgsCiAgICApOwogICAgJFNlbGYtPkFkZEFyZ3VtZW50KAogICAgICAgIE5hbWUgICAgICAgID0+ICdrZXknLAogICAgICAgIERlc2NyaXB0aW9uID0+ICdjYWNoZSBrZXknLAogICAgICAgIFJlcXVpcmVkICAgID0+IDEsCiAgICAgICAgVmFsdWVSZWdleCAgPT4gcXIvKC4qKS9zbXgsCiAgICApOwoKICAgIHJldHVybjsKfQoKc3ViIFJ1biB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRUeXBlID0gJFNlbGYtPkdldEFyZ3VtZW50KCd0eXBlJyk7CiAgICBteSAkS2V5ICA9ICRTZWxmLT5HZXRBcmd1bWVudCgna2V5Jyk7CgogICAgJFNlbGYtPlByaW50KAogICAgICAgICI8eWVsbG93PnJlbW92aW5nLi4uPC95ZWxsb3c+XG4iCiAgICApOwoKICAgIG15ICRSZXN1bHQgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKS0+RGVsZXRlKAogICAgICAgIEtleSAgPT4gJEtleSwKICAgICAgICBUeXBlID0+ICRUeXBlLAogICAgICAgIFJhdyAgPT4gMSwKICAgICk7CgogICAgaWYgKCRSZXN1bHQpIHsKICAgICAgICBwcmludCAiXCIkVHlwZTo6JEtleVwiIHJlbW92ZWQuXG4iOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgcHJpbnQgIlwiJFR5cGU6OiRLZXlcIiBub3QgZm91bmQhXG4iOwogICAgfQoKICAgICRTZWxmLT5QcmludCgiPGdyZWVuPkRvbmUuPC9ncmVlbj5cbiIpOwogICAgcmV0dXJuICRTZWxmLT5FeGl0Q29kZU9rKCk7Cn0KCjE7Cgo=</File>
        <File Location="KIXCore/Kernel/System/Console/Command/Maint/Memcached/Type.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwNi0yMDE2IGMuYS5wLmUuIElUIEdtYkgsIGh0dHA6Ly93d3cuY2FwZS1pdC5kZQojCiMgd3JpdHRlbi9lZGl0ZWQgYnk6CiMgKiBSZW5lKGRvdClCb2VobShhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMgKiBEb3JvdGhlYShkb3QpRG9lcmZmZWwoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEFHUEwpLiBJZiB5b3UKIyBkaWQgbm90IHJlY2VpdmUgdGhpcyBmaWxlLCBzZWUgaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2FncGwudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6U3lzdGVtOjpDb25zb2xlOjpDb21tYW5kOjpNYWludDo6TWVtY2FjaGVkczo6VHlwZTsKCnVzZSBzdHJpY3Q7CnVzZSB3YXJuaW5nczsKCnVzZSBiYXNlIHF3KEtlcm5lbDo6U3lzdGVtOjpDb25zb2xlOjpCYXNlQ29tbWFuZCk7CgpvdXIgQE9iamVjdERlcGVuZGVuY2llcyA9ICgKICAgICdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnLAopOwoKc3ViIENvbmZpZ3VyZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICRTZWxmLT5EZXNjcmlwdGlvbignSW5mb3MgYWJvdXQgb2JqZWN0cyBpbiBtZW1jYWNoZWQuJyk7CgogICAgJFNlbGYtPkFkZEFyZ3VtZW50KAogICAgICAgIE5hbWUgICAgICAgID0+ICd0eXBlJywKICAgICAgICBEZXNjcmlwdGlvbiA9PiAnY2FjaGUgdHlwZScsCiAgICAgICAgUmVxdWlyZWQgICAgPT4gMSwKICAgICAgICBWYWx1ZVJlZ2V4ICA9PiBxci8oLiopL3NteCwKICAgICk7CgogICAgcmV0dXJuOwp9CgpzdWIgUnVuIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJFR5cGUgPSAkU2VsZi0+R2V0QXJndW1lbnQoJ3R5cGUnKTsKCiAgICAjIGdldCBhbGwgY2FjaGVkIGtleXMgZm9yIHR5cGUKICAgIG15ICRSZXN1bHQgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKS0+R2V0KAogICAgICAgIEtleSAgPT4gJ0NhY2hlSW5kZXg6OicgLiAkVHlwZSwKICAgICAgICBUeXBlID0+ICdNZW1jYWNoZWQnLAogICAgICAgIFJhdyAgPT4gMSwKICAgICk7CiAgICBpZiAoICRSZXN1bHQgJiYgcmVmKCRSZXN1bHQpIGVxICdIQVNIJyApIHsKICAgICAgICBmb3JlYWNoIG15ICRLZXkgKCBzb3J0IGtleXMgJXskUmVzdWx0fSApIHsKICAgICAgICAgICAgcHJpbnQgJEtleS4gIlxuIjsKICAgICAgICB9CiAgICB9CgogICAgJFNlbGYtPlByaW50KCI8Z3JlZW4+RG9uZS48L2dyZWVuPlxuIik7CiAgICByZXR1cm4gJFNlbGYtPkV4aXRDb2RlT2soKTsKfQoKMTsKCg==</File>
        <File Location="KIXCore/Kernel/System/LinkObject.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDE2IE9UUlMgQUcsIGh0dHA6Ly9vdHJzLmNvbS8KIyBLSVhDb3JlLUV4dGVuc2lvbnMgQ29weXJpZ2h0IChDKSAyMDA2LTIwMTYgYy5hLnAuZS4gSVQgR21iSCwgaHR0cDovL3d3dy5jYXBlLWl0LmRlCiMKIyB3cml0dGVuL2VkaXRlZCBieToKIyAqIFRvcnN0ZW4oZG90KVRoYXUoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojICogTWFydGluKGRvdClCYWx6YXJlayhhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMgKiBBbm5hKGRvdClMaXR2aW5vdmEoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojICogUmFsZihkb3QpQm9laG0oYXQpY2FwZShkYXNoKWl0KGRvdClkZQojICogRG9yb3RoZWEoZG90KURvZXJmZmVsKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAtLQojICRJZDogTGlua09iamVjdC5wbSx2IDEuMjEgMjAxNi8wMS8yMCAxMzo0NDo0MCBkZG9lcmZmZWwgRXhwICQKIyAtLQojIFRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCiMgdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoQUdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvYWdwbC50eHQuCiMgLS0KCnBhY2thZ2UgS2VybmVsOjpTeXN0ZW06OkxpbmtPYmplY3Q7Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7CgpvdXIgQE9iamVjdERlcGVuZGVuY2llcyA9ICgKICAgICdLZXJuZWw6OkNvbmZpZycsCiAgICAnS2VybmVsOjpTeXN0ZW06OkNhY2hlJywKICAgICdLZXJuZWw6OlN5c3RlbTo6Q2hlY2tJdGVtJywKICAgICdLZXJuZWw6OlN5c3RlbTo6REInLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpMb2cnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpNYWluJywKICAgICdLZXJuZWw6OlN5c3RlbTo6VGltZScsCiAgICAnS2VybmVsOjpTeXN0ZW06OlZhbGlkJywKCiAgICAjIEtJWENvcmUtY2FwZUlUCiAgICAnS2VybmVsOjpTeXN0ZW06OktJWFV0aWxzJywKCiAgICAjIEVPIEtJWENvcmUtY2FwZUlUCik7Cgo9aGVhZDEgTkFNRQoKS2VybmVsOjpTeXN0ZW06OkxpbmtPYmplY3QgLSB0byBsaW5rIG9iamVjdHMgbGlrZSB0aWNrZXRzLCBmYXFzLCAuLi4KCj1oZWFkMSBTWU5PUFNJUwoKQWxsIGZ1bmN0aW9ucyB0byBsaW5rIG9iamVjdHMgbGlrZSB0aWNrZXRzLCBmYXFzLCAuLi4KCj1oZWFkMSBQVUJMSUMgSU5URVJGQUNFCgo9b3ZlciA0Cgo9Y3V0Cgo9aXRlbSBuZXcoKQoKY3JlYXRlIGFuIG9iamVjdC4gRG8gbm90IHVzZSBpdCBkaXJlY3RseSwgaW5zdGVhZCB1c2U6CgogICAgdXNlIEtlcm5lbDo6U3lzdGVtOjpPYmplY3RNYW5hZ2VyOwogICAgbG9jYWwgJEtlcm5lbDo6T00gPSBLZXJuZWw6OlN5c3RlbTo6T2JqZWN0TWFuYWdlci0+bmV3KCk7CiAgICBteSAkTGlua09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMaW5rT2JqZWN0Jyk7Cgo9Y3V0CgpzdWIgbmV3IHsKICAgIG15ICggJFR5cGUsICVQYXJhbSApID0gQF87CgogICAgIyBhbGxvY2F0ZSBuZXcgaGFzaCBmb3Igb2JqZWN0CiAgICBteSAkU2VsZiA9IHt9OwogICAgYmxlc3MoICRTZWxmLCAkVHlwZSApOwoKICAgICRTZWxmLT57Q2FjaGVUeXBlfSA9ICdMaW5rT2JqZWN0JzsKICAgICRTZWxmLT57Q2FjaGVUVEx9ICA9IDYwICogNjAgKiAyNCAqIDIwOwoKICAgIHJldHVybiAkU2VsZjsKfQoKPWl0ZW0gUG9zc2libGVUeXBlc0xpc3QoKQoKcmV0dXJuIGEgaGFzaCBvZiBhbGwgcG9zc2libGUgdHlwZXMKClJldHVybgogICAgJVBvc3NpYmxlVHlwZXNMaXN0ID0gKAogICAgICAgICdOb3JtYWwnICAgICAgPT4gMSwKICAgICAgICAnUGFyZW50Q2hpbGQnID0+IDEsCiAgICApOwoKICAgIG15ICVQb3NzaWJsZVR5cGVzTGlzdCA9ICRMaW5rT2JqZWN0LT5Qb3NzaWJsZVR5cGVzTGlzdCgKICAgICAgICBPYmplY3QxID0+ICdUaWNrZXQnLAogICAgICAgIE9iamVjdDIgPT4gJ0ZBUScsCiAgICApOwoKPWN1dAoKc3ViIFBvc3NpYmxlVHlwZXNMaXN0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGZvciBteSAkQXJndW1lbnQgKHF3KE9iamVjdDEgT2JqZWN0MikpIHsKICAgICAgICBpZiAoICEkUGFyYW17JEFyZ3VtZW50fSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5lZWQgJEFyZ3VtZW50ISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgIyBnZXQgcG9zc2libGUgbGluayBsaXN0CiAgICBteSAlUG9zc2libGVMaW5rTGlzdCA9ICRTZWxmLT5Qb3NzaWJsZUxpbmtMaXN0KCk7CgogICAgIyByZW1vdmUgbm90IG5lZWRlZCBlbnRyaWVzCiAgICBQT1NTSUJMRUxJTks6CiAgICBmb3IgbXkgJFBvc3NpYmxlTGluayAoIHNvcnQga2V5cyAlUG9zc2libGVMaW5rTGlzdCApIHsKCiAgICAgICAgIyBleHRyYWN0IG9iamVjdHMKICAgICAgICBteSAkT2JqZWN0MSA9ICRQb3NzaWJsZUxpbmtMaXN0eyRQb3NzaWJsZUxpbmt9LT57T2JqZWN0MX07CiAgICAgICAgbXkgJE9iamVjdDIgPSAkUG9zc2libGVMaW5rTGlzdHskUG9zc2libGVMaW5rfS0+e09iamVjdDJ9OwoKICAgICAgICBuZXh0IFBPU1NJQkxFTElOSwogICAgICAgICAgICBpZiAoICRPYmplY3QxIGVxICRQYXJhbXtPYmplY3QxfSAmJiAkT2JqZWN0MiBlcSAkUGFyYW17T2JqZWN0Mn0gKQogICAgICAgICAgICB8fCAoICRPYmplY3QyIGVxICRQYXJhbXtPYmplY3QxfSAmJiAkT2JqZWN0MSBlcSAkUGFyYW17T2JqZWN0Mn0gKTsKCiAgICAgICAgIyByZW1vdmUgZW50cnkgZnJvbSBsaXN0IGlmIG9iamVjdHMgZG9uJ3QgbWF0Y2gKICAgICAgICBkZWxldGUgJFBvc3NpYmxlTGlua0xpc3R7JFBvc3NpYmxlTGlua307CiAgICB9CgogICAgIyBnZXQgdHlwZSBsaXN0CiAgICBteSAlVHlwZUxpc3QgPSAkU2VsZi0+VHlwZUxpc3QoKTsKCiAgICAjIGNoZWNrIHR5cGVzCiAgICBQT1NTSUJMRUxJTks6CiAgICBmb3IgbXkgJFBvc3NpYmxlTGluayAoIHNvcnQga2V5cyAlUG9zc2libGVMaW5rTGlzdCApIHsKCiAgICAgICAgIyBleHRyYWN0IHR5cGUKICAgICAgICBteSAkVHlwZSA9ICRQb3NzaWJsZUxpbmtMaXN0eyRQb3NzaWJsZUxpbmt9LT57VHlwZX0gfHwgJyc7CgogICAgICAgIG5leHQgUE9TU0lCTEVMSU5LIGlmICRUeXBlTGlzdHskVHlwZX07CgogICAgICAgICMgcmVtb3ZlIGVudHJ5IGZyb20gbGlzdCBpZiB0eXBlIGRvZXNuJ3QgZXhpc3QKICAgICAgICBkZWxldGUgJFBvc3NpYmxlTGlua0xpc3R7JFBvc3NpYmxlTGlua307CiAgICB9CgogICAgIyBleHRyYWN0IHRoZSB0eXBlIGxpc3QKICAgIG15ICVQb3NzaWJsZVR5cGVzTGlzdDsKICAgIGZvciBteSAkUG9zc2libGVMaW5rICggc29ydCBrZXlzICVQb3NzaWJsZUxpbmtMaXN0ICkgewoKICAgICAgICAjIGV4dHJhY3QgdHlwZQogICAgICAgIG15ICRUeXBlID0gJFBvc3NpYmxlTGlua0xpc3R7JFBvc3NpYmxlTGlua30tPntUeXBlfTsKCiAgICAgICAgJFBvc3NpYmxlVHlwZXNMaXN0eyRUeXBlfSA9IDE7CiAgICB9CgogICAgcmV0dXJuICVQb3NzaWJsZVR5cGVzTGlzdDsKfQoKPWl0ZW0gUG9zc2libGVPYmplY3RzTGlzdCgpCgpyZXR1cm4gYSBoYXNoIG9mIGFsbCBwb3NzaWJsZSBvYmplY3RzCgpSZXR1cm4KICAgICVQb3NzaWJsZU9iamVjdHNMaXN0ID0gKAogICAgICAgICdUaWNrZXQnID0+IDEsCiAgICAgICAgJ0ZBUScgICAgPT4gMSwKICAgICk7CgogICAgbXkgJVBvc3NpYmxlT2JqZWN0c0xpc3QgPSAkTGlua09iamVjdC0+UG9zc2libGVPYmplY3RzTGlzdCgKICAgICAgICBPYmplY3QgPT4gJ1RpY2tldCcsCiAgICApOwoKPWN1dAoKc3ViIFBvc3NpYmxlT2JqZWN0c0xpc3QgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgZm9yIG15ICRBcmd1bWVudCAocXcoT2JqZWN0KSkgewogICAgICAgIGlmICggISRQYXJhbXskQXJndW1lbnR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkQXJndW1lbnQhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCBwb3NzaWJsZSBsaW5rIGxpc3QKICAgIG15ICVQb3NzaWJsZUxpbmtMaXN0ID0gJFNlbGYtPlBvc3NpYmxlTGlua0xpc3QoKTsKCiAgICAjIGludmVzdGlnYXRlIHRoZSBwb3NzaWJsZSBvYmplY3QgbGlzdAogICAgbXkgJVBvc3NpYmxlT2JqZWN0c0xpc3Q7CiAgICBQT1NTSUJMRUxJTks6CiAgICBmb3IgbXkgJFBvc3NpYmxlTGluayAoIHNvcnQga2V5cyAlUG9zc2libGVMaW5rTGlzdCApIHsKCiAgICAgICAgIyBleHRyYWN0IG9iamVjdHMKICAgICAgICBteSAkT2JqZWN0MSA9ICRQb3NzaWJsZUxpbmtMaXN0eyRQb3NzaWJsZUxpbmt9LT57T2JqZWN0MX07CiAgICAgICAgbXkgJE9iamVjdDIgPSAkUG9zc2libGVMaW5rTGlzdHskUG9zc2libGVMaW5rfS0+e09iamVjdDJ9OwoKICAgICAgICBuZXh0IFBPU1NJQkxFTElOSyBpZiAkUGFyYW17T2JqZWN0fSBuZSAkT2JqZWN0MSAmJiAkUGFyYW17T2JqZWN0fSBuZSAkT2JqZWN0MjsKCiAgICAgICAgIyBhZGQgb2JqZWN0IHRvIGxpc3QKICAgICAgICBpZiAoICRQYXJhbXtPYmplY3R9IGVxICRPYmplY3QxICkgewogICAgICAgICAgICAkUG9zc2libGVPYmplY3RzTGlzdHskT2JqZWN0Mn0gPSAxOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFBvc3NpYmxlT2JqZWN0c0xpc3R7JE9iamVjdDF9ID0gMTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuICVQb3NzaWJsZU9iamVjdHNMaXN0Owp9Cgo9aXRlbSBQb3NzaWJsZUxpbmtMaXN0KCkKCnJldHVybiBhIDJkIGhhc2ggbGlzdCBvZiBhbGwgcG9zc2libGUgbGlua3MKClJldHVybgogICAgJVBvc3NpYmxlTGlua0xpc3QgPSAoCiAgICAgICAgMDAxID0+IHsKICAgICAgICAgICAgT2JqZWN0MSA9PiAnVGlja2V0JywKICAgICAgICAgICAgT2JqZWN0MiA9PiAnVGlja2V0JywKICAgICAgICAgICAgVHlwZSAgICA9PiAnTm9ybWFsJywKICAgICAgICB9LAogICAgICAgIDAwMiA9PiB7CiAgICAgICAgICAgIE9iamVjdDEgPT4gJ1RpY2tldCcsCiAgICAgICAgICAgIE9iamVjdDIgPT4gJ1RpY2tldCcsCiAgICAgICAgICAgIFR5cGUgICAgPT4gJ1BhcmVudENoaWxkJywKICAgICAgICB9LAogICAgKTsKCiAgICBteSAlUG9zc2libGVMaW5rTGlzdCA9ICRMaW5rT2JqZWN0LT5Qb3NzaWJsZUxpbmtMaXN0KCk7Cgo9Y3V0CgpzdWIgUG9zc2libGVMaW5rTGlzdCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IG5lZWRlZCBvYmplY3RzCiAgICBteSAkQ29uZmlnT2JqZWN0ICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKICAgIG15ICRDaGVja0l0ZW1PYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2hlY2tJdGVtJyk7CgogICAgIyBnZXQgcG9zc2libGUgbGluayBsaXN0CiAgICBteSAkUG9zc2libGVMaW5rTGlzdFJlZiA9ICRDb25maWdPYmplY3QtPkdldCgnTGlua09iamVjdDo6UG9zc2libGVMaW5rJykgfHwge307CiAgICBteSAlUG9zc2libGVMaW5rTGlzdCA9ICV7JFBvc3NpYmxlTGlua0xpc3RSZWZ9OwoKICAgICMgcHJlcGFyZSB0aGUgcG9zc2libGUgbGluayBsaXN0CiAgICBQT1NTSUJMRUxJTks6CiAgICBmb3IgbXkgJFBvc3NpYmxlTGluayAoIHNvcnQga2V5cyAlUG9zc2libGVMaW5rTGlzdCApIHsKCiAgICAgICAgIyBjaGVjayB0aGUgb2JqZWN0MSwgb2JqZWN0MiBhbmQgdHlwZSBzdHJpbmcKICAgICAgICBBUkdVTUVOVDoKICAgICAgICBmb3IgbXkgJEFyZ3VtZW50IChxdyhPYmplY3QxIE9iamVjdDIgVHlwZSkpIHsKCiAgICAgICAgICAgICMgc2V0IGVtcHR5IHN0cmluZyBhcyBkZWZhdWx0IHZhbHVlCiAgICAgICAgICAgICRQb3NzaWJsZUxpbmtMaXN0eyRQb3NzaWJsZUxpbmt9LT57JEFyZ3VtZW50fSB8fD0gJyc7CgogICAgICAgICAgICAjIHRyaW0gdGhlIGFyZ3VtZW50CiAgICAgICAgICAgICRDaGVja0l0ZW1PYmplY3QtPlN0cmluZ0NsZWFuKAogICAgICAgICAgICAgICAgU3RyaW5nUmVmID0+IFwkUG9zc2libGVMaW5rTGlzdHskUG9zc2libGVMaW5rfS0+eyRBcmd1bWVudH0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAjIGV4dHJhY3QgdmFsdWUKICAgICAgICAgICAgbXkgJFZhbHVlID0gJFBvc3NpYmxlTGlua0xpc3R7JFBvc3NpYmxlTGlua30tPnskQXJndW1lbnR9IHx8ICcnOwoKICAgICAgICAgICAgbmV4dCBBUkdVTUVOVCBpZiAkVmFsdWUgJiYgJFZhbHVlICF+IG17IDo6IH14bXMgJiYgJFZhbHVlICF+IG17IFxzIH14bXM7CgogICAgICAgICAgICAjIGxvZyB0aGUgZXJyb3IKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICJUaGUgJEFyZ3VtZW50ICckVmFsdWUnIGlzIGludmFsaWQgaW4gU3lzQ29uZmlnIChMaW5rT2JqZWN0OjpQb3NzaWJsZUxpbmspISIsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAjIHJlbW92ZSBlbnRyeSBmcm9tIGxpc3QgaWYgaXQgaXMgaW52YWxpZAogICAgICAgICAgICBkZWxldGUgJFBvc3NpYmxlTGlua0xpc3R7JFBvc3NpYmxlTGlua307CgogICAgICAgICAgICBuZXh0IFBPU1NJQkxFTElOSzsKICAgICAgICB9CiAgICB9CgogICAgIyBnZXQgbG9jYXRpb24gb2YgdGhlIGJhY2tlbmQgbW9kdWxlcwogICAgbXkgJEJhY2tlbmRMb2NhdGlvbiA9ICRDb25maWdPYmplY3QtPkdldCgnSG9tZScpIC4gJy9LZXJuZWwvU3lzdGVtL0xpbmtPYmplY3QvJzsKCiAgICAjIEtJWENvcmUtY2FwZUlUCiAgICBteSBAS0lYUGFja2FnZXMgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6S0lYVXRpbHMnKQogICAgICAgIC0+R2V0UmVnaXN0ZXJlZEN1c3RvbVBhY2thZ2VzKCBSZXN1bHQgPT4gJ0FSUkFZJyApOwogICAgIyBFTyBLSVhDb3JlLWNhcGVJVAoKICAgICMgY2hlY2sgdGhlIGV4aXN0aW5nIG9iamVjdHMKICAgIFBPU1NJQkxFTElOSzoKICAgIGZvciBteSAkUG9zc2libGVMaW5rICggc29ydCBrZXlzICVQb3NzaWJsZUxpbmtMaXN0ICkgewoKICAgICAgICAjIGNoZWNrIGlmIG9iamVjdCBiYWNrZW5kcyBleGlzdAogICAgICAgIEFSR1VNRU5UOgogICAgICAgIGZvciBteSAkQXJndW1lbnQgKHF3KE9iamVjdDEgT2JqZWN0MikpIHsKCiAgICAgICAgICAgICMgZXh0cmFjdCBvYmplY3QKICAgICAgICAgICAgbXkgJE9iamVjdCA9ICRQb3NzaWJsZUxpbmtMaXN0eyRQb3NzaWJsZUxpbmt9LT57JEFyZ3VtZW50fTsKCiAgICAgICAgICAgICMgS0lYQ29yZS1jYXBlSVQKICAgICAgICAgICAgI25leHQgQVJHVU1FTlQgaWYgLWUgJEJhY2tlbmRMb2NhdGlvbiAuICRPYmplY3QgLiAnLnBtJzsKICAgICAgICAgICAgbXkgJEZvdW5kID0gMDsKICAgICAgICAgICAgZm9yIG15ICRDdXJyUHJlZml4IChAS0lYUGFja2FnZXMpIHsKICAgICAgICAgICAgICAgIG15ICRDaGVja0JhY2tlbmRMb2NhdGlvbiA9CiAgICAgICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdIb21lJykgLiAiLyIKICAgICAgICAgICAgICAgICAgICAuICRDdXJyUHJlZml4CiAgICAgICAgICAgICAgICAgICAgLiAnL0tlcm5lbC9TeXN0ZW0vTGlua09iamVjdC8nOwogICAgICAgICAgICAgICAgaWYgKCAtZSAkQ2hlY2tCYWNrZW5kTG9jYXRpb24gLiAkT2JqZWN0IC4gJy5wbScgKSB7CiAgICAgICAgICAgICAgICAgICAgJEZvdW5kID0gMTsKICAgICAgICAgICAgICAgICAgICBsYXN0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggISRGb3VuZCApIHsKICAgICAgICAgICAgICAgIG5leHQgQVJHVU1FTlQgaWYgLWUgJEJhY2tlbmRMb2NhdGlvbiAuICRPYmplY3QgLiAnLnBtJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBuZXh0IEFSR1VNRU5UIGlmICRGb3VuZDsKCiAgICAgICAgICAgICMgRU8gS0lYQ29yZS1jYXBlSVQKCiAgICAgICAgICAgICMgcmVtb3ZlIGVudHJ5IGZyb20gbGlzdCBpZiBpdCBpcyBpbnZhbGlkCiAgICAgICAgICAgIGRlbGV0ZSAkUG9zc2libGVMaW5rTGlzdHskUG9zc2libGVMaW5rfTsKCiAgICAgICAgICAgIG5leHQgUE9TU0lCTEVMSU5LOwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCB0eXBlIGxpc3QKICAgIG15ICVUeXBlTGlzdCA9ICRTZWxmLT5UeXBlTGlzdCgpOwoKICAgICMgY2hlY2sgdHlwZXMKICAgIFBPU1NJQkxFTElOSzoKICAgIGZvciBteSAkUG9zc2libGVMaW5rICggc29ydCBrZXlzICVQb3NzaWJsZUxpbmtMaXN0ICkgewoKICAgICAgICAjIGV4dHJhY3QgdHlwZQogICAgICAgIG15ICRUeXBlID0gJFBvc3NpYmxlTGlua0xpc3R7JFBvc3NpYmxlTGlua30tPntUeXBlfTsKCiAgICAgICAgbmV4dCBQT1NTSUJMRUxJTksgaWYgJFR5cGVMaXN0eyRUeXBlfTsKCiAgICAgICAgIyBsb2cgdGhlIGVycm9yCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJUaGUgTGlua1R5cGUgJyRUeXBlJyBpcyBpbnZhbGlkIGluIFN5c0NvbmZpZyAoTGlua09iamVjdDo6UG9zc2libGVMaW5rKSEiLAogICAgICAgICk7CgogICAgICAgICMgcmVtb3ZlIGVudHJ5IGZyb20gbGlzdCBpZiB0eXBlIGRvZXNuJ3QgZXhpc3QKICAgICAgICBkZWxldGUgJFBvc3NpYmxlTGlua0xpc3R7JFBvc3NpYmxlTGlua307CiAgICB9CgogICAgcmV0dXJuICVQb3NzaWJsZUxpbmtMaXN0Owp9Cgo9aXRlbSBMaW5rQWRkKCkKCmFkZCBhIG5ldyBsaW5rIGJldHdlZW4gdHdvIGVsZW1lbnRzCgogICAgJFRydWUgPSAkTGlua09iamVjdC0+TGlua0FkZCgKICAgICAgICBTb3VyY2VPYmplY3QgPT4gJ1RpY2tldCcsCiAgICAgICAgU291cmNlS2V5ICAgID0+ICczMjEnLAogICAgICAgIFRhcmdldE9iamVjdCA9PiAnRkFRJywKICAgICAgICBUYXJnZXRLZXkgICAgPT4gJzUnLAogICAgICAgIFR5cGUgICAgICAgICA9PiAnUGFyZW50Q2hpbGQnLAogICAgICAgIFN0YXRlICAgICAgICA9PiAnVmFsaWQnLAogICAgICAgIFVzZXJJRCAgICAgICA9PiAxLAogICAgKTsKCj1jdXQKCnN1YiBMaW5rQWRkIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGZvciBteSAkQXJndW1lbnQgKHF3KFNvdXJjZU9iamVjdCBTb3VyY2VLZXkgVGFyZ2V0T2JqZWN0IFRhcmdldEtleSBUeXBlIFN0YXRlIFVzZXJJRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JEFyZ3VtZW50fSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5lZWQgJEFyZ3VtZW50ISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBpZiBzb3VyY2UgYW5kIHRhcmdldCBhcmUgdGhlIHNhbWUgb2JqZWN0CiAgICBpZiAoICRQYXJhbXtTb3VyY2VPYmplY3R9IGVxICRQYXJhbXtUYXJnZXRPYmplY3R9ICYmICRQYXJhbXtTb3VyY2VLZXl9IGVxICRQYXJhbXtUYXJnZXRLZXl9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnSW1wb3NzaWJsZSB0byBsaW5rIG9iamVjdCB3aXRoIGl0c2VsZiEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgbG9va3VwIHRoZSBvYmplY3QgaWRzCiAgICBPQkpFQ1Q6CiAgICBmb3IgbXkgJE9iamVjdCAocXcoU291cmNlT2JqZWN0IFRhcmdldE9iamVjdCkpIHsKCiAgICAgICAgIyBsb29rdXAgdGhlIG9iamVjdCBpZAogICAgICAgICRQYXJhbXsgJE9iamVjdCAuICdJRCcgfSA9ICRTZWxmLT5PYmplY3RMb29rdXAoCiAgICAgICAgICAgIE5hbWUgPT4gJFBhcmFteyRPYmplY3R9LAogICAgICAgICk7CgogICAgICAgIG5leHQgT0JKRUNUIGlmICRQYXJhbXsgJE9iamVjdCAuICdJRCcgfTsKCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJJbnZhbGlkICRPYmplY3QgaXMgZ2l2ZW4hIiwKICAgICAgICApOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBnZXQgYSBsaXN0IG9mIHBvc3NpYmxlIGxpbmsgdHlwZXMgZm9yIHRoZSB0d28gb2JqZWN0cwogICAgbXkgJVBvc3NpYmxlVHlwZXNMaXN0ID0gJFNlbGYtPlBvc3NpYmxlVHlwZXNMaXN0KAogICAgICAgIE9iamVjdDEgPT4gJFBhcmFte1NvdXJjZU9iamVjdH0sCiAgICAgICAgT2JqZWN0MiA9PiAkUGFyYW17VGFyZ2V0T2JqZWN0fSwKICAgICk7CgogICAgIyBjaGVjayBpZiB3YW50ZWQgbGluayB0eXBlIGlzIHBvc3NpYmxlCiAgICBpZiAoICEkUG9zc2libGVUeXBlc0xpc3R7ICRQYXJhbXtUeXBlfSB9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAiTm90IHBvc3NpYmxlIHRvIGNyZWF0ZSBhICckUGFyYW17VHlwZX0nIGxpbmsgYmV0d2VlbiAkUGFyYW17U291cmNlT2JqZWN0fSBhbmQgJFBhcmFte1RhcmdldE9iamVjdH0hIiwKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGxvb2t1cCBzdGF0ZSBpZAogICAgbXkgJFN0YXRlSUQgPSAkU2VsZi0+U3RhdGVMb29rdXAoCiAgICAgICAgTmFtZSA9PiAkUGFyYW17U3RhdGV9LAogICAgKTsKCiAgICAjIGxvb2t1cCB0eXBlIGlkCiAgICBteSAkVHlwZUlEID0gJFNlbGYtPlR5cGVMb29rdXAoCiAgICAgICAgTmFtZSAgID0+ICRQYXJhbXtUeXBlfSwKICAgICAgICBVc2VySUQgPT4gJFBhcmFte1VzZXJJRH0sCiAgICApOwoKICAgICMgZ2V0IGRhdGFiYXNlIG9iamVjdAogICAgbXkgJERCT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkRCJyk7CgogICAgIyBjaGVjayBpZiBsaW5rIGFscmVhZHkgZXhpc3RzIGluIGRhdGFiYXNlCiAgICByZXR1cm4gaWYgISREQk9iamVjdC0+UHJlcGFyZSgKICAgICAgICBTUUwgPT4gJwogICAgICAgICAgICBTRUxFQ1Qgc291cmNlX29iamVjdF9pZCwgc291cmNlX2tleSwgc3RhdGVfaWQKICAgICAgICAgICAgRlJPTSBsaW5rX3JlbGF0aW9uCiAgICAgICAgICAgIFdIRVJFICgKICAgICAgICAgICAgICAgICAgICAoIHNvdXJjZV9vYmplY3RfaWQgPSA/IEFORCBzb3VyY2Vfa2V5ID0gPwogICAgICAgICAgICAgICAgICAgIEFORCB0YXJnZXRfb2JqZWN0X2lkID0gPyBBTkQgdGFyZ2V0X2tleSA9ID8gKQogICAgICAgICAgICAgICAgT1IKICAgICAgICAgICAgICAgICAgICAoIHNvdXJjZV9vYmplY3RfaWQgPSA/IEFORCBzb3VyY2Vfa2V5ID0gPwogICAgICAgICAgICAgICAgICAgIEFORCB0YXJnZXRfb2JqZWN0X2lkID0gPyBBTkQgdGFyZ2V0X2tleSA9ID8gKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgQU5EIHR5cGVfaWQgPSA/JywKICAgICAgICBCaW5kID0+IFsKICAgICAgICAgICAgXCRQYXJhbXtTb3VyY2VPYmplY3RJRH0sIFwkUGFyYW17U291cmNlS2V5fSwKICAgICAgICAgICAgXCRQYXJhbXtUYXJnZXRPYmplY3RJRH0sIFwkUGFyYW17VGFyZ2V0S2V5fSwKICAgICAgICAgICAgXCRQYXJhbXtUYXJnZXRPYmplY3RJRH0sIFwkUGFyYW17VGFyZ2V0S2V5fSwKICAgICAgICAgICAgXCRQYXJhbXtTb3VyY2VPYmplY3RJRH0sIFwkUGFyYW17U291cmNlS2V5fSwKICAgICAgICAgICAgXCRUeXBlSUQsCiAgICAgICAgXSwKICAgICAgICBMaW1pdCA9PiAxLAogICAgKTsKCiAgICAjIGZldGNoIHRoZSByZXN1bHQKICAgIG15ICVFeGlzdGluZzsKICAgIHdoaWxlICggbXkgQFJvdyA9ICREQk9iamVjdC0+RmV0Y2hyb3dBcnJheSgpICkgewogICAgICAgICRFeGlzdGluZ3tTb3VyY2VPYmplY3RJRH0gPSAkUm93WzBdOwogICAgICAgICRFeGlzdGluZ3tTb3VyY2VLZXl9ICAgICAgPSAkUm93WzFdOwogICAgICAgICRFeGlzdGluZ3tTdGF0ZUlEfSAgICAgICAgPSAkUm93WzJdOwogICAgfQoKICAgICMgbGluayBleGlzdHMgYWxyZWFkeQogICAgaWYgKCVFeGlzdGluZykgewoKICAgICAgICAjIGV4aXN0aW5nIGxpbmsgaGFzIGEgZGlmZmVyZW50IFN0YXRlSUQgdGhhbiB0aGUgbmV3IGxpbmsKICAgICAgICBpZiAoICRFeGlzdGluZ3tTdGF0ZUlEfSBuZSAkU3RhdGVJRCApIHsKCiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJMaW5rIGFscmVhZHkgZXhpc3RzIGJldHdlZW4gdGhlc2UgdHdvIG9iamVjdHMgIgogICAgICAgICAgICAgICAgICAgIC4gIndpdGggYSBkaWZmZXJlbnQgc3RhdGUgaWQgJyRFeGlzdGluZ3tTdGF0ZUlEfSchIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgdHlwZSBkYXRhCiAgICAgICAgbXkgJVR5cGVEYXRhID0gJFNlbGYtPlR5cGVHZXQoCiAgICAgICAgICAgIFR5cGVJRCA9PiAkVHlwZUlELAogICAgICAgICk7CgogICAgICAgIHJldHVybiAxIGlmICEkVHlwZURhdGF7UG9pbnRlZH07CiAgICAgICAgcmV0dXJuIDEgaWYgJEV4aXN0aW5ne1NvdXJjZU9iamVjdElEfSBlcSAkUGFyYW17U291cmNlT2JqZWN0SUR9CiAgICAgICAgICAgICYmICRFeGlzdGluZ3tTb3VyY2VLZXl9IGVxICRQYXJhbXtTb3VyY2VLZXl9OwoKICAgICAgICAjIGxvZyBlcnJvcgogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnTGluayBhbHJlYWR5IGV4aXN0cyBiZXR3ZWVuIHRoZXNlIHR3byBvYmplY3RzIGluIG9wcG9zaXRlIGRpcmVjdGlvbiEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgZ2V0IGFsbCBsaW5rcyB0aGF0IHRoZSBzb3VyY2Ugb2JqZWN0IGFscmVhZHkgaGFzCiAgICBteSAkTGlua3MgPSAkU2VsZi0+TGlua0xpc3QoCiAgICAgICAgT2JqZWN0ID0+ICRQYXJhbXtTb3VyY2VPYmplY3R9LAogICAgICAgIEtleSAgICA9PiAkUGFyYW17U291cmNlS2V5fSwKICAgICAgICBTdGF0ZSAgPT4gJFBhcmFte1N0YXRlfSwKICAgICAgICBVc2VySUQgPT4gJFBhcmFte1VzZXJJRH0sCiAgICApOwoKICAgICMgY2hlY2sgdHlwZSBncm91cHMKICAgIE9CSkVDVDoKICAgIGZvciBteSAkT2JqZWN0ICggc29ydCBrZXlzICV7JExpbmtzfSApIHsKCiAgICAgICAgbmV4dCBPQkpFQ1QgaWYgJE9iamVjdCBuZSAkUGFyYW17VGFyZ2V0T2JqZWN0fTsKCiAgICAgICAgVFlQRToKICAgICAgICBmb3IgbXkgJFR5cGUgKCBzb3J0IGtleXMgJXsgJExpbmtzLT57JE9iamVjdH0gfSApIHsKCiAgICAgICAgICAgICMgZXh0cmFjdCBzb3VyY2UgYW5kIHRhcmdldAogICAgICAgICAgICBteSAkU291cmNlID0gJExpbmtzLT57JE9iamVjdH0tPnskVHlwZX0tPntTb3VyY2V9IHx8PSB7fTsKICAgICAgICAgICAgbXkgJFRhcmdldCA9ICRMaW5rcy0+eyRPYmplY3R9LT57JFR5cGV9LT57VGFyZ2V0fSB8fD0ge307CgogICAgICAgICAgICAjIGNoZWNrIGlmIHNvdXJjZSBhbmQgdGFyZ2V0IG9iamVjdCBhcmUgYWxyZWFkeSBsaW5rZWQKICAgICAgICAgICAgbmV4dCBUWVBFIGlmICEkU291cmNlLT57ICRQYXJhbXtUYXJnZXRLZXl9IH0gJiYgISRUYXJnZXQtPnsgJFBhcmFte1RhcmdldEtleX0gfTsKCiAgICAgICAgICAgICMgY2hlY2sgdGhlIHR5cGUgZ3JvdXBzCiAgICAgICAgICAgIG15ICRUeXBlR3JvdXBDaGVjayA9ICRTZWxmLT5Qb3NzaWJsZVR5cGUoCiAgICAgICAgICAgICAgICBUeXBlMSA9PiAkVHlwZSwKICAgICAgICAgICAgICAgIFR5cGUyID0+ICRQYXJhbXtUeXBlfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIG5leHQgVFlQRSBpZiAkVHlwZUdyb3VwQ2hlY2s7CgogICAgICAgICAgICAjIGV4aXN0aW5nIGxpbmsgdHlwZSBpcyBpbiBhIHR5cGUgZ3JvdXAgd2l0aCB0aGUgbmV3IGxpbmsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ0Fub3RoZXIgTGluayBhbHJlYWR5IGV4aXN0cyB3aXRoaW4gdGhlIHNhbWUgdHlwZSBncm91cCEnLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCBiYWNrZW5kIG9mIHNvdXJjZSBvYmplY3QKICAgIG15ICRCYWNrZW5kU291cmNlT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCggJ0tlcm5lbDo6U3lzdGVtOjpMaW5rT2JqZWN0OjonIC4gJFBhcmFte1NvdXJjZU9iamVjdH0gKTsKCiAgICByZXR1cm4gaWYgISRCYWNrZW5kU291cmNlT2JqZWN0OwoKICAgICMgZ2V0IGJhY2tlbmQgb2YgdGFyZ2V0IG9iamVjdAogICAgbXkgJEJhY2tlbmRUYXJnZXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCAnS2VybmVsOjpTeXN0ZW06OkxpbmtPYmplY3Q6OicgLiAkUGFyYW17VGFyZ2V0T2JqZWN0fSApOwoKICAgIHJldHVybiBpZiAhJEJhY2tlbmRUYXJnZXRPYmplY3Q7CgogICAgIyBydW4gcHJlIGV2ZW50IG1vZHVsZSBvZiBzb3VyY2Ugb2JqZWN0CiAgICAkQmFja2VuZFNvdXJjZU9iamVjdC0+TGlua0FkZFByZSgKICAgICAgICBLZXkgICAgICAgICAgPT4gJFBhcmFte1NvdXJjZUtleX0sCiAgICAgICAgVGFyZ2V0T2JqZWN0ID0+ICRQYXJhbXtUYXJnZXRPYmplY3R9LAogICAgICAgIFRhcmdldEtleSAgICA9PiAkUGFyYW17VGFyZ2V0S2V5fSwKICAgICAgICBUeXBlICAgICAgICAgPT4gJFBhcmFte1R5cGV9LAogICAgICAgIFN0YXRlICAgICAgICA9PiAkUGFyYW17U3RhdGV9LAogICAgICAgIFVzZXJJRCAgICAgICA9PiAkUGFyYW17VXNlcklEfSwKICAgICk7CgogICAgIyBydW4gcHJlIGV2ZW50IG1vZHVsZSBvZiB0YXJnZXQgb2JqZWN0CiAgICAkQmFja2VuZFRhcmdldE9iamVjdC0+TGlua0FkZFByZSgKICAgICAgICBLZXkgICAgICAgICAgPT4gJFBhcmFte1RhcmdldEtleX0sCiAgICAgICAgU291cmNlT2JqZWN0ID0+ICRQYXJhbXtTb3VyY2VPYmplY3R9LAogICAgICAgIFNvdXJjZUtleSAgICA9PiAkUGFyYW17U291cmNlS2V5fSwKICAgICAgICBUeXBlICAgICAgICAgPT4gJFBhcmFte1R5cGV9LAogICAgICAgIFN0YXRlICAgICAgICA9PiAkUGFyYW17U3RhdGV9LAogICAgICAgIFVzZXJJRCAgICAgICA9PiAkUGFyYW17VXNlcklEfSwKICAgICk7CgogICAgcmV0dXJuIGlmICEkREJPYmplY3QtPkRvKAogICAgICAgIFNRTCA9PiAnCiAgICAgICAgICAgIElOU0VSVCBJTlRPIGxpbmtfcmVsYXRpb24KICAgICAgICAgICAgKHNvdXJjZV9vYmplY3RfaWQsIHNvdXJjZV9rZXksIHRhcmdldF9vYmplY3RfaWQsIHRhcmdldF9rZXksCiAgICAgICAgICAgIHR5cGVfaWQsIHN0YXRlX2lkLCBjcmVhdGVfdGltZSwgY3JlYXRlX2J5KQogICAgICAgICAgICBWQUxVRVMgKD8sID8sID8sID8sID8sID8sIGN1cnJlbnRfdGltZXN0YW1wLCA/KScsCiAgICAgICAgQmluZCA9PiBbCiAgICAgICAgICAgIFwkUGFyYW17U291cmNlT2JqZWN0SUR9LCBcJFBhcmFte1NvdXJjZUtleX0sCiAgICAgICAgICAgIFwkUGFyYW17VGFyZ2V0T2JqZWN0SUR9LCBcJFBhcmFte1RhcmdldEtleX0sCiAgICAgICAgICAgIFwkVHlwZUlELCBcJFN0YXRlSUQsIFwkUGFyYW17VXNlcklEfSwKICAgICAgICBdLAogICAgKTsKCiAgICAjIHJ1biBwb3N0IGV2ZW50IG1vZHVsZSBvZiBzb3VyY2Ugb2JqZWN0CiAgICAkQmFja2VuZFNvdXJjZU9iamVjdC0+TGlua0FkZFBvc3QoCiAgICAgICAgS2V5ICAgICAgICAgID0+ICRQYXJhbXtTb3VyY2VLZXl9LAogICAgICAgIFRhcmdldE9iamVjdCA9PiAkUGFyYW17VGFyZ2V0T2JqZWN0fSwKICAgICAgICBUYXJnZXRLZXkgICAgPT4gJFBhcmFte1RhcmdldEtleX0sCiAgICAgICAgVHlwZSAgICAgICAgID0+ICRQYXJhbXtUeXBlfSwKICAgICAgICBTdGF0ZSAgICAgICAgPT4gJFBhcmFte1N0YXRlfSwKICAgICAgICBVc2VySUQgICAgICAgPT4gJFBhcmFte1VzZXJJRH0sCiAgICApOwoKICAgICMgcnVuIHBvc3QgZXZlbnQgbW9kdWxlIG9mIHRhcmdldCBvYmplY3QKICAgICRCYWNrZW5kVGFyZ2V0T2JqZWN0LT5MaW5rQWRkUG9zdCgKICAgICAgICBLZXkgICAgICAgICAgPT4gJFBhcmFte1RhcmdldEtleX0sCiAgICAgICAgU291cmNlT2JqZWN0ID0+ICRQYXJhbXtTb3VyY2VPYmplY3R9LAogICAgICAgIFNvdXJjZUtleSAgICA9PiAkUGFyYW17U291cmNlS2V5fSwKICAgICAgICBUeXBlICAgICAgICAgPT4gJFBhcmFte1R5cGV9LAogICAgICAgIFN0YXRlICAgICAgICA9PiAkUGFyYW17U3RhdGV9LAogICAgICAgIFVzZXJJRCAgICAgICA9PiAkUGFyYW17VXNlcklEfSwKICAgICk7CgogICAgcmV0dXJuIDE7Cn0KCj1pdGVtIExpbmtDbGVhbnVwKCkKCmRlbGV0ZXMgb2xkIGxpbmtzIGZyb20gZGF0YWJhc2UKCnJldHVybiB0cnVlCgogICAgJFRydWUgPSAkTGlua09iamVjdC0+TGlua0NsZWFudXAoCiAgICAgICAgU3RhdGUgID0+ICdUZW1wb3JhcnknLAogICAgICAgIEFnZSAgICA9PiAoIDYwICogNjAgKiAyNCApLAogICAgKTsKCj1jdXQKCnN1YiBMaW5rQ2xlYW51cCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgbXkgJEFyZ3VtZW50IChxdyhTdGF0ZSBBZ2UpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyRBcmd1bWVudH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICRBcmd1bWVudCEiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgbG9va3VwIHN0YXRlIGlkCiAgICBteSAkU3RhdGVJRCA9ICRTZWxmLT5TdGF0ZUxvb2t1cCgKICAgICAgICBOYW1lID0+ICRQYXJhbXtTdGF0ZX0sCiAgICApOwoKICAgIHJldHVybiBpZiAhJFN0YXRlSUQ7CgogICAgIyBnZXQgdGltZSBvYmplY3QKICAgIG15ICRUaW1lT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpbWUnKTsKCiAgICAjIGdldCBjdXJyZW50IHRpbWUKICAgIG15ICROb3cgPSAkVGltZU9iamVjdC0+U3lzdGVtVGltZSgpOwoKICAgICMgY2FsY3VsYXRlIGRlbGV0ZSB0aW1lCiAgICBteSAkRGVsZXRlVGltZSA9ICRUaW1lT2JqZWN0LT5TeXN0ZW1UaW1lMlRpbWVTdGFtcCgKICAgICAgICBTeXN0ZW1UaW1lID0+ICggJE5vdyAtICRQYXJhbXtBZ2V9ICksCiAgICApOwoKICAgICMgZGVsZXRlIHRoZSBsaW5rCiAgICByZXR1cm4gaWYgISRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpLT5EbygKICAgICAgICBTUUwgPT4gJwogICAgICAgICAgICBERUxFVEUgRlJPTSBsaW5rX3JlbGF0aW9uCiAgICAgICAgICAgIFdIRVJFIHN0YXRlX2lkID0gPwogICAgICAgICAgICBBTkQgY3JlYXRlX3RpbWUgPCA/JywKICAgICAgICBCaW5kID0+IFsKICAgICAgICAgICAgXCRTdGF0ZUlELCBcJERlbGV0ZVRpbWUsCiAgICAgICAgXSwKICAgICk7CgogICAgcmV0dXJuIDE7Cn0KCj1pdGVtIExpbmtEZWxldGUoKQoKZGVsZXRlcyBhIGxpbmsKCnJldHVybiB0cnVlCgogICAgJFRydWUgPSAkTGlua09iamVjdC0+TGlua0RlbGV0ZSgKICAgICAgICBPYmplY3QxID0+ICdUaWNrZXQnLAogICAgICAgIEtleTEgICAgPT4gJzMyMScsCiAgICAgICAgT2JqZWN0MiA9PiAnRkFRJywKICAgICAgICBLZXkyICAgID0+ICc1JywKICAgICAgICBUeXBlICAgID0+ICdOb3JtYWwnLAogICAgICAgIFVzZXJJRCAgPT4gMSwKICAgICk7Cgo9Y3V0CgpzdWIgTGlua0RlbGV0ZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgbXkgJEFyZ3VtZW50IChxdyhPYmplY3QxIEtleTEgT2JqZWN0MiBLZXkyIFR5cGUgVXNlcklEKSkgewogICAgICAgIGlmICggISRQYXJhbXskQXJndW1lbnR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkQXJndW1lbnQhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjIGxvb2t1cCB0aGUgb2JqZWN0IGlkcwogICAgT0JKRUNUOgogICAgZm9yIG15ICRPYmplY3QgKHF3KE9iamVjdDEgT2JqZWN0MikpIHsKCiAgICAgICAgIyBsb29rdXAgdGhlIG9iamVjdCBpZAogICAgICAgICRQYXJhbXsgJE9iamVjdCAuICdJRCcgfSA9ICRTZWxmLT5PYmplY3RMb29rdXAoCiAgICAgICAgICAgIE5hbWUgPT4gJFBhcmFteyRPYmplY3R9LAogICAgICAgICk7CgogICAgICAgIG5leHQgT0JKRUNUIGlmICRQYXJhbXsgJE9iamVjdCAuICdJRCcgfTsKCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJJbnZhbGlkICRPYmplY3QgaXMgZ2l2ZW4hIiwKICAgICAgICApOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBsb29rdXAgdHlwZSBpZAogICAgbXkgJFR5cGVJRCA9ICRTZWxmLT5UeXBlTG9va3VwKAogICAgICAgIE5hbWUgICA9PiAkUGFyYW17VHlwZX0sCiAgICAgICAgVXNlcklEID0+ICRQYXJhbXtVc2VySUR9LAogICAgKTsKCiAgICAjIGdldCBkYXRhYmFzZSBvYmplY3QKICAgIG15ICREQk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwoKICAgICMgZ2V0IHRoZSBleGlzdGluZyBsaW5rCiAgICByZXR1cm4gaWYgISREQk9iamVjdC0+UHJlcGFyZSgKICAgICAgICBTUUwgPT4gJwogICAgICAgICAgICBTRUxFQ1Qgc291cmNlX29iamVjdF9pZCwgc291cmNlX2tleSwgdGFyZ2V0X29iamVjdF9pZCwgdGFyZ2V0X2tleSwgc3RhdGVfaWQKICAgICAgICAgICAgRlJPTSBsaW5rX3JlbGF0aW9uCiAgICAgICAgICAgIFdIRVJFICgKICAgICAgICAgICAgICAgICAgICAoc291cmNlX29iamVjdF9pZCA9ID8gQU5EIHNvdXJjZV9rZXkgPSA/CiAgICAgICAgICAgICAgICAgICAgQU5EIHRhcmdldF9vYmplY3RfaWQgPSA/IEFORCB0YXJnZXRfa2V5ID0gPyApCiAgICAgICAgICAgICAgICBPUgogICAgICAgICAgICAgICAgICAgICggc291cmNlX29iamVjdF9pZCA9ID8gQU5EIHNvdXJjZV9rZXkgPSA/CiAgICAgICAgICAgICAgICAgICAgQU5EIHRhcmdldF9vYmplY3RfaWQgPSA/IEFORCB0YXJnZXRfa2V5ID0gPyApCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBBTkQgdHlwZV9pZCA9ID8nLAogICAgICAgIEJpbmQgPT4gWwogICAgICAgICAgICBcJFBhcmFte09iamVjdDFJRH0sIFwkUGFyYW17S2V5MX0sCiAgICAgICAgICAgIFwkUGFyYW17T2JqZWN0MklEfSwgXCRQYXJhbXtLZXkyfSwKICAgICAgICAgICAgXCRQYXJhbXtPYmplY3QySUR9LCBcJFBhcmFte0tleTJ9LAogICAgICAgICAgICBcJFBhcmFte09iamVjdDFJRH0sIFwkUGFyYW17S2V5MX0sCiAgICAgICAgICAgIFwkVHlwZUlELAogICAgICAgIF0sCiAgICAgICAgTGltaXQgPT4gMSwKICAgICk7CgogICAgIyBmZXRjaCByZXN1bHRzCiAgICBteSAlRXhpc3Rpbmc7CiAgICB3aGlsZSAoIG15IEBSb3cgPSAkREJPYmplY3QtPkZldGNocm93QXJyYXkoKSApIHsKCiAgICAgICAgJEV4aXN0aW5ne1NvdXJjZU9iamVjdElEfSA9ICRSb3dbMF07CiAgICAgICAgJEV4aXN0aW5ne1NvdXJjZUtleX0gICAgICA9ICRSb3dbMV07CiAgICAgICAgJEV4aXN0aW5ne1RhcmdldE9iamVjdElEfSA9ICRSb3dbMl07CiAgICAgICAgJEV4aXN0aW5ne1RhcmdldEtleX0gICAgICA9ICRSb3dbM107CiAgICAgICAgJEV4aXN0aW5ne1N0YXRlSUR9ICAgICAgICA9ICRSb3dbNF07CiAgICB9CgogICAgcmV0dXJuIDEgaWYgISVFeGlzdGluZzsKCiAgICAjIGxvb2t1cCB0aGUgb2JqZWN0IG5hbWVzCiAgICBPQkpFQ1Q6CiAgICBmb3IgbXkgJE9iamVjdCAocXcoU291cmNlT2JqZWN0IFRhcmdldE9iamVjdCkpIHsKCiAgICAgICAgIyBsb29rdXAgdGhlIG9iamVjdCBuYW1lCiAgICAgICAgJEV4aXN0aW5neyRPYmplY3R9ID0gJFNlbGYtPk9iamVjdExvb2t1cCgKICAgICAgICAgICAgT2JqZWN0SUQgPT4gJEV4aXN0aW5neyAkT2JqZWN0IC4gJ0lEJyB9LAogICAgICAgICk7CgogICAgICAgIG5leHQgT0JKRUNUIGlmICRFeGlzdGluZ3skT2JqZWN0fTsKCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJJbnZhbGlkICRPYmplY3QgaXMgZ2l2ZW4hIiwKICAgICAgICApOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBsb29rdXAgc3RhdGUKICAgICRFeGlzdGluZ3tTdGF0ZX0gPSAkU2VsZi0+U3RhdGVMb29rdXAoCiAgICAgICAgU3RhdGVJRCA9PiAkRXhpc3Rpbmd7U3RhdGVJRH0sCiAgICApOwoKICAgICMgZ2V0IGJhY2tlbmQgb2Ygc291cmNlIG9iamVjdAogICAgbXkgJEJhY2tlbmRTb3VyY2VPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCAnS2VybmVsOjpTeXN0ZW06OkxpbmtPYmplY3Q6OicgLiAkRXhpc3Rpbmd7U291cmNlT2JqZWN0fSApOwoKICAgIHJldHVybiBpZiAhJEJhY2tlbmRTb3VyY2VPYmplY3Q7CgogICAgIyBnZXQgYmFja2VuZCBvZiB0YXJnZXQgb2JqZWN0CiAgICBteSAkQmFja2VuZFRhcmdldE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoICdLZXJuZWw6OlN5c3RlbTo6TGlua09iamVjdDo6JyAuICRFeGlzdGluZ3tUYXJnZXRPYmplY3R9ICk7CgogICAgcmV0dXJuIGlmICEkQmFja2VuZFRhcmdldE9iamVjdDsKCiAgICAjIHJ1biBwcmUgZXZlbnQgbW9kdWxlIG9mIHNvdXJjZSBvYmplY3QKICAgICRCYWNrZW5kU291cmNlT2JqZWN0LT5MaW5rRGVsZXRlUHJlKAogICAgICAgIEtleSAgICAgICAgICA9PiAkRXhpc3Rpbmd7U291cmNlS2V5fSwKICAgICAgICBUYXJnZXRPYmplY3QgPT4gJEV4aXN0aW5ne1RhcmdldE9iamVjdH0sCiAgICAgICAgVGFyZ2V0S2V5ICAgID0+ICRFeGlzdGluZ3tUYXJnZXRLZXl9LAogICAgICAgIFR5cGUgICAgICAgICA9PiAkUGFyYW17VHlwZX0sCiAgICAgICAgU3RhdGUgICAgICAgID0+ICRFeGlzdGluZ3tTdGF0ZX0sCiAgICAgICAgVXNlcklEICAgICAgID0+ICRQYXJhbXtVc2VySUR9LAogICAgKTsKCiAgICAjIHJ1biBwcmUgZXZlbnQgbW9kdWxlIG9mIHRhcmdldCBvYmplY3QKICAgICRCYWNrZW5kVGFyZ2V0T2JqZWN0LT5MaW5rRGVsZXRlUHJlKAogICAgICAgIEtleSAgICAgICAgICA9PiAkRXhpc3Rpbmd7VGFyZ2V0S2V5fSwKICAgICAgICBTb3VyY2VPYmplY3QgPT4gJEV4aXN0aW5ne1NvdXJjZU9iamVjdH0sCiAgICAgICAgU291cmNlS2V5ICAgID0+ICRFeGlzdGluZ3tTb3VyY2VLZXl9LAogICAgICAgIFR5cGUgICAgICAgICA9PiAkUGFyYW17VHlwZX0sCiAgICAgICAgU3RhdGUgICAgICAgID0+ICRFeGlzdGluZ3tTdGF0ZX0sCiAgICAgICAgVXNlcklEICAgICAgID0+ICRQYXJhbXtVc2VySUR9LAogICAgKTsKCiAgICAjIGRlbGV0ZSB0aGUgbGluawogICAgcmV0dXJuIGlmICEkREJPYmplY3QtPkRvKAogICAgICAgIFNRTCA9PiAnCiAgICAgICAgICAgIERFTEVURSBGUk9NIGxpbmtfcmVsYXRpb24KICAgICAgICAgICAgV0hFUkUgKAogICAgICAgICAgICAgICAgICAgICggc291cmNlX29iamVjdF9pZCA9ID8gQU5EIHNvdXJjZV9rZXkgPSA/CiAgICAgICAgICAgICAgICAgICAgQU5EIHRhcmdldF9vYmplY3RfaWQgPSA/IEFORCB0YXJnZXRfa2V5ID0gPyApCiAgICAgICAgICAgICAgICBPUgogICAgICAgICAgICAgICAgICAgICggc291cmNlX29iamVjdF9pZCA9ID8gQU5EIHNvdXJjZV9rZXkgPSA/CiAgICAgICAgICAgICAgICAgICAgQU5EIHRhcmdldF9vYmplY3RfaWQgPSA/IEFORCB0YXJnZXRfa2V5ID0gPyApCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBBTkQgdHlwZV9pZCA9ID8nLAogICAgICAgIEJpbmQgPT4gWwogICAgICAgICAgICBcJFBhcmFte09iamVjdDFJRH0sIFwkUGFyYW17S2V5MX0sCiAgICAgICAgICAgIFwkUGFyYW17T2JqZWN0MklEfSwgXCRQYXJhbXtLZXkyfSwKICAgICAgICAgICAgXCRQYXJhbXtPYmplY3QySUR9LCBcJFBhcmFte0tleTJ9LAogICAgICAgICAgICBcJFBhcmFte09iamVjdDFJRH0sIFwkUGFyYW17S2V5MX0sCiAgICAgICAgICAgIFwkVHlwZUlELAogICAgICAgIF0sCiAgICApOwoKICAgICMgcnVuIHBvc3QgZXZlbnQgbW9kdWxlIG9mIHNvdXJjZSBvYmplY3QKICAgICRCYWNrZW5kU291cmNlT2JqZWN0LT5MaW5rRGVsZXRlUG9zdCgKICAgICAgICBLZXkgICAgICAgICAgPT4gJEV4aXN0aW5ne1NvdXJjZUtleX0sCiAgICAgICAgVGFyZ2V0T2JqZWN0ID0+ICRFeGlzdGluZ3tUYXJnZXRPYmplY3R9LAogICAgICAgIFRhcmdldEtleSAgICA9PiAkRXhpc3Rpbmd7VGFyZ2V0S2V5fSwKICAgICAgICBUeXBlICAgICAgICAgPT4gJFBhcmFte1R5cGV9LAogICAgICAgIFN0YXRlICAgICAgICA9PiAkRXhpc3Rpbmd7U3RhdGV9LAogICAgICAgIFVzZXJJRCAgICAgICA9PiAkUGFyYW17VXNlcklEfSwKICAgICk7CgogICAgIyBydW4gcG9zdCBldmVudCBtb2R1bGUgb2YgdGFyZ2V0IG9iamVjdAogICAgJEJhY2tlbmRUYXJnZXRPYmplY3QtPkxpbmtEZWxldGVQb3N0KAogICAgICAgIEtleSAgICAgICAgICA9PiAkRXhpc3Rpbmd7VGFyZ2V0S2V5fSwKICAgICAgICBTb3VyY2VPYmplY3QgPT4gJEV4aXN0aW5ne1NvdXJjZU9iamVjdH0sCiAgICAgICAgU291cmNlS2V5ICAgID0+ICRFeGlzdGluZ3tTb3VyY2VLZXl9LAogICAgICAgIFR5cGUgICAgICAgICA9PiAkUGFyYW17VHlwZX0sCiAgICAgICAgU3RhdGUgICAgICAgID0+ICRFeGlzdGluZ3tTdGF0ZX0sCiAgICAgICAgVXNlcklEICAgICAgID0+ICRQYXJhbXtVc2VySUR9LAogICAgKTsKCiAgICByZXR1cm4gMTsKfQoKPWl0ZW0gTGlua0RlbGV0ZUFsbCgpCgpkZWxldGUgYWxsIGxpbmtzIG9mIGFuIG9iamVjdAoKICAgICRUcnVlID0gJExpbmtPYmplY3QtPkxpbmtEZWxldGVBbGwoCiAgICAgICAgT2JqZWN0ID0+ICdUaWNrZXQnLAogICAgICAgIEtleSAgICA9PiAnMzIxJywKICAgICAgICBVc2VySUQgPT4gMSwKICAgICk7Cgo9Y3V0CgpzdWIgTGlua0RlbGV0ZUFsbCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgbXkgJEFyZ3VtZW50IChxdyhPYmplY3QgS2V5IFVzZXJJRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JEFyZ3VtZW50fSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5lZWQgJEFyZ3VtZW50ISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgIyBnZXQgc3RhdGUgbGlzdAogICAgbXkgJVN0YXRlTGlzdCA9ICRTZWxmLT5TdGF0ZUxpc3QoCiAgICAgICAgVmFsaWQgPT4gMCwKICAgICk7CgogICAgIyBkZWxldGUgYWxsIGxpbmtzCiAgICBTVEFURToKICAgIGZvciBteSAkU3RhdGUgKCB2YWx1ZXMgJVN0YXRlTGlzdCApIHsKCiAgICAgICAgIyBnZXQgbGluayBsaXN0CiAgICAgICAgbXkgJExpbmtMaXN0ID0gJFNlbGYtPkxpbmtMaXN0KAogICAgICAgICAgICBPYmplY3QgPT4gJFBhcmFte09iamVjdH0sCiAgICAgICAgICAgIEtleSAgICA9PiAkUGFyYW17S2V5fSwKICAgICAgICAgICAgU3RhdGUgID0+ICRTdGF0ZSwKICAgICAgICAgICAgVXNlcklEID0+ICRQYXJhbXtVc2VySUR9LAogICAgICAgICk7CgogICAgICAgIG5leHQgU1RBVEUgaWYgISRMaW5rTGlzdDsKICAgICAgICBuZXh0IFNUQVRFIGlmICEleyRMaW5rTGlzdH07CgogICAgICAgIGZvciBteSAkT2JqZWN0ICggc29ydCBrZXlzICV7JExpbmtMaXN0fSApIHsKCiAgICAgICAgICAgIGZvciBteSAkTGlua1R5cGUgKCBzb3J0IGtleXMgJXsgJExpbmtMaXN0LT57JE9iamVjdH0gfSApIHsKCiAgICAgICAgICAgICAgICAjIGV4dHJhY3QgbGluayB0eXBlIExpc3QKICAgICAgICAgICAgICAgIG15ICRMaW5rVHlwZUxpc3QgPSAkTGlua0xpc3QtPnskT2JqZWN0fS0+eyRMaW5rVHlwZX07CgogICAgICAgICAgICAgICAgZm9yIG15ICREaXJlY3Rpb24gKCBzb3J0IGtleXMgJXskTGlua1R5cGVMaXN0fSApIHsKCiAgICAgICAgICAgICAgICAgICAgIyBleHRyYWN0IGRpcmVjdGlvbiBsaXN0CiAgICAgICAgICAgICAgICAgICAgbXkgJERpcmVjdGlvbkxpc3QgPSAkTGlua0xpc3QtPnskT2JqZWN0fS0+eyRMaW5rVHlwZX0tPnskRGlyZWN0aW9ufTsKCiAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRPYmplY3RLZXkgKCBzb3J0IGtleXMgJXskRGlyZWN0aW9uTGlzdH0gKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAjIGRlbGV0ZSB0aGUgbGluawogICAgICAgICAgICAgICAgICAgICAgICAkU2VsZi0+TGlua0RlbGV0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdDEgPT4gJFBhcmFte09iamVjdH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBLZXkxICAgID0+ICRQYXJhbXtLZXl9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0MiA9PiAkT2JqZWN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgS2V5MiAgICA9PiAkT2JqZWN0S2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVHlwZSAgICA9PiAkTGlua1R5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVc2VySUQgID0+ICRQYXJhbXtVc2VySUR9LAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gMTsKfQoKPWl0ZW0gTGlua0xpc3QoKQoKZ2V0IGFsbCBleGlzdGluZyBsaW5rcyBmb3IgYSBnaXZlbiBvYmplY3QKClJldHVybgogICAgJExpbmtMaXN0ID0gewogICAgICAgIFRpY2tldCA9PiB7CiAgICAgICAgICAgIE5vcm1hbCA9PiB7CiAgICAgICAgICAgICAgICBTb3VyY2UgPT4gewogICAgICAgICAgICAgICAgICAgIDEyICA9PiAxLAogICAgICAgICAgICAgICAgICAgIDIxMiA9PiAxLAogICAgICAgICAgICAgICAgICAgIDMzMiA9PiAxLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgUGFyZW50Q2hpbGQgPT4gewogICAgICAgICAgICAgICAgU291cmNlID0+IHsKICAgICAgICAgICAgICAgICAgICA1ID0+IDEsCiAgICAgICAgICAgICAgICAgICAgOSA9PiAxLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIFRhcmdldCA9PiB7CiAgICAgICAgICAgICAgICAgICAgNCAgPT4gMSwKICAgICAgICAgICAgICAgICAgICA4ICA9PiAxLAogICAgICAgICAgICAgICAgICAgIDE1ID0+IDEsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgRkFRID0+IHsKICAgICAgICAgICAgUGFyZW50Q2hpbGQgPT4gewogICAgICAgICAgICAgICAgU291cmNlID0+IHsKICAgICAgICAgICAgICAgICAgICA1ID0+IDEsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgIH0sCiAgICB9OwoKICAgIG15ICRMaW5rTGlzdCA9ICRMaW5rT2JqZWN0LT5MaW5rTGlzdCgKICAgICAgICBPYmplY3QgICAgPT4gJ1RpY2tldCcsCiAgICAgICAgS2V5ICAgICAgID0+ICczMjEnLAogICAgICAgIE9iamVjdDIgICA9PiAnRkFRJywgICAgICAgICAjIChvcHRpb25hbCkKICAgICAgICBTdGF0ZSAgICAgPT4gJ1ZhbGlkJywKICAgICAgICBUeXBlICAgICAgPT4gJ1BhcmVudENoaWxkJywgIyAob3B0aW9uYWwpCiAgICAgICAgRGlyZWN0aW9uID0+ICdUYXJnZXQnLCAgICAgICMgKG9wdGlvbmFsKSBkZWZhdWx0IEJvdGggKFNvdXJjZXxUYXJnZXR8Qm90aCkKICAgICAgICBVc2VySUQgICAgPT4gMSwKICAgICk7Cgo9Y3V0CgpzdWIgTGlua0xpc3QgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgZm9yIG15ICRBcmd1bWVudCAocXcoT2JqZWN0IEtleSBTdGF0ZSBVc2VySUQpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyRBcmd1bWVudH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICRBcmd1bWVudCEiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgbG9va3VwIG9iamVjdCBpZAogICAgbXkgJE9iamVjdElEID0gJFNlbGYtPk9iamVjdExvb2t1cCgKICAgICAgICBOYW1lID0+ICRQYXJhbXtPYmplY3R9LAogICAgKTsKCiAgICByZXR1cm4gaWYgISRPYmplY3RJRDsKCiAgICAjIGxvb2t1cCBzdGF0ZSBpZAogICAgbXkgJFN0YXRlSUQgPSAkU2VsZi0+U3RhdGVMb29rdXAoCiAgICAgICAgTmFtZSA9PiAkUGFyYW17U3RhdGV9LAogICAgKTsKCiAgICAjIHByZXBhcmUgU1FMIHN0YXRlbWVudAogICAgbXkgJFR5cGVTUUwgPSAnJzsKICAgIG15IEBCaW5kID0gKCBcJE9iamVjdElELCBcJFBhcmFte0tleX0sIFwkU3RhdGVJRCApOwoKICAgICMgYWRkIHR5cGUgaWQgdG8gU1FMIHN0YXRlbWVudAogICAgaWYgKCAkUGFyYW17VHlwZX0gKSB7CgogICAgICAgICMgbG9va3VwIHR5cGUgaWQKICAgICAgICBteSAkVHlwZUlEID0gJFNlbGYtPlR5cGVMb29rdXAoCiAgICAgICAgICAgIE5hbWUgICA9PiAkUGFyYW17VHlwZX0sCiAgICAgICAgICAgIFVzZXJJRCA9PiAkUGFyYW17VXNlcklEfSwKICAgICAgICApOwoKICAgICAgICAkVHlwZVNRTCA9ICdBTkQgdHlwZV9pZCA9ID8gJzsKICAgICAgICBwdXNoIEBCaW5kLCBcJFR5cGVJRDsKICAgIH0KCiAgICAjIGdldCBkYXRhYmFzZSBvYmplY3QKICAgIG15ICREQk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwoKICAgICMgZ2V0IGxpbmtzIHdoZXJlIHRoZSBnaXZlbiBvYmplY3QgaXMgdGhlIHNvdXJjZQogICAgcmV0dXJuIGlmICEkREJPYmplY3QtPlByZXBhcmUoCiAgICAgICAgU1FMID0+ICcKICAgICAgICAgICAgU0VMRUNUIHRhcmdldF9vYmplY3RfaWQsIHRhcmdldF9rZXksIHR5cGVfaWQKICAgICAgICAgICAgRlJPTSBsaW5rX3JlbGF0aW9uCiAgICAgICAgICAgIFdIRVJFIHNvdXJjZV9vYmplY3RfaWQgPSA/CiAgICAgICAgICAgICAgICBBTkQgc291cmNlX2tleSA9ID8KICAgICAgICAgICAgICAgIEFORCBzdGF0ZV9pZCA9ID8gJwogICAgICAgICAgICAuICRUeXBlU1FMLAogICAgICAgIEJpbmQgPT4gXEBCaW5kLAogICAgKTsKCiAgICAjIGZldGNoIHJlc3VsdHMKICAgIG15IEBEYXRhOwogICAgd2hpbGUgKCBteSBAUm93ID0gJERCT2JqZWN0LT5GZXRjaHJvd0FycmF5KCkgKSB7CiAgICAgICAgbXkgJUxpbmtEYXRhOwogICAgICAgICRMaW5rRGF0YXtUYXJnZXRPYmplY3RJRH0gPSAkUm93WzBdOwogICAgICAgICRMaW5rRGF0YXtUYXJnZXRLZXl9ICAgICAgPSAkUm93WzFdOwogICAgICAgICRMaW5rRGF0YXtUeXBlSUR9ICAgICAgICAgPSAkUm93WzJdOwogICAgICAgIHB1c2ggQERhdGEsIFwlTGlua0RhdGE7CiAgICB9CgogICAgIyBzdG9yZSByZXN1bHRzCiAgICBteSAlTGlua3M7CiAgICBteSAlVHlwZVBvaW50ZWRMaXN0OwogICAgZm9yIG15ICRMaW5rRGF0YSAoQERhdGEpIHsKCiAgICAgICAgIyBsb29rdXAgb2JqZWN0IG5hbWUKICAgICAgICBteSAkVGFyZ2V0T2JqZWN0ID0gJFNlbGYtPk9iamVjdExvb2t1cCgKICAgICAgICAgICAgT2JqZWN0SUQgPT4gJExpbmtEYXRhLT57VGFyZ2V0T2JqZWN0SUR9LAogICAgICAgICk7CgogICAgICAgICMgZ2V0IHR5cGUgZGF0YQogICAgICAgIG15ICVUeXBlRGF0YSA9ICRTZWxmLT5UeXBlR2V0KAogICAgICAgICAgICBUeXBlSUQgPT4gJExpbmtEYXRhLT57VHlwZUlEfSwKICAgICAgICApOwoKICAgICAgICAkVHlwZVBvaW50ZWRMaXN0eyAkVHlwZURhdGF7TmFtZX0gfSA9ICRUeXBlRGF0YXtQb2ludGVkfTsKCiAgICAgICAgIyBzdG9yZSB0aGUgcmVzdWx0CiAgICAgICAgJExpbmtzeyRUYXJnZXRPYmplY3R9LT57ICRUeXBlRGF0YXtOYW1lfSB9LT57VGFyZ2V0fS0+eyAkTGlua0RhdGEtPntUYXJnZXRLZXl9IH0gPSAxOwogICAgfQoKICAgICMgZ2V0IGxpbmtzIHdoZXJlIHRoZSBnaXZlbiBvYmplY3QgaXMgdGhlIHRhcmdldAogICAgcmV0dXJuIGlmICEkREJPYmplY3QtPlByZXBhcmUoCiAgICAgICAgU1FMID0+ICcKICAgICAgICAgICAgU0VMRUNUIHNvdXJjZV9vYmplY3RfaWQsIHNvdXJjZV9rZXksIHR5cGVfaWQKICAgICAgICAgICAgRlJPTSBsaW5rX3JlbGF0aW9uCiAgICAgICAgICAgIFdIRVJFIHRhcmdldF9vYmplY3RfaWQgPSA/CiAgICAgICAgICAgICAgICBBTkQgdGFyZ2V0X2tleSA9ID8KICAgICAgICAgICAgICAgIEFORCBzdGF0ZV9pZCA9ID8gJwogICAgICAgICAgICAuICRUeXBlU1FMLAogICAgICAgIEJpbmQgPT4gXEBCaW5kLAogICAgKTsKCiAgICAjIGZldGNoIHRoZSByZXN1bHQKICAgIEBEYXRhID0gKCk7CiAgICB3aGlsZSAoIG15IEBSb3cgPSAkREJPYmplY3QtPkZldGNocm93QXJyYXkoKSApIHsKICAgICAgICBteSAlTGlua0RhdGE7CiAgICAgICAgJExpbmtEYXRhe1NvdXJjZU9iamVjdElEfSA9ICRSb3dbMF07CiAgICAgICAgJExpbmtEYXRhe1NvdXJjZUtleX0gICAgICA9ICRSb3dbMV07CiAgICAgICAgJExpbmtEYXRhe1R5cGVJRH0gICAgICAgICA9ICRSb3dbMl07CiAgICAgICAgcHVzaCBARGF0YSwgXCVMaW5rRGF0YTsKICAgIH0KCiAgICAjIHN0b3JlIHJlc3VsdHMKICAgIGZvciBteSAkTGlua0RhdGEgKEBEYXRhKSB7CgogICAgICAgICMgbG9va3VwIG9iamVjdCBuYW1lCiAgICAgICAgbXkgJFNvdXJjZU9iamVjdCA9ICRTZWxmLT5PYmplY3RMb29rdXAoCiAgICAgICAgICAgIE9iamVjdElEID0+ICRMaW5rRGF0YS0+e1NvdXJjZU9iamVjdElEfSwKICAgICAgICApOwoKICAgICAgICAjIGdldCB0eXBlIGRhdGEKICAgICAgICBteSAlVHlwZURhdGEgPSAkU2VsZi0+VHlwZUdldCgKICAgICAgICAgICAgVHlwZUlEID0+ICRMaW5rRGF0YS0+e1R5cGVJRH0sCiAgICAgICAgKTsKCiAgICAgICAgJFR5cGVQb2ludGVkTGlzdHsgJFR5cGVEYXRhe05hbWV9IH0gPSAkVHlwZURhdGF7UG9pbnRlZH07CgogICAgICAgICMgc3RvcmUgdGhlIHJlc3VsdAogICAgICAgICRMaW5rc3skU291cmNlT2JqZWN0fS0+eyAkVHlwZURhdGF7TmFtZX0gfS0+e1NvdXJjZX0tPnsgJExpbmtEYXRhLT57U291cmNlS2V5fSB9ID0gMTsKICAgIH0KCiAgICAjIG1lcmdlIHNvdXJjZSB0YXJnZXQgcGFpcnMgaW50byBzb3VyY2UgZm9yIHVucG9pbnRlZCBsaW5rIHR5cGVzCiAgICBmb3IgbXkgJE9iamVjdCAoIHNvcnQga2V5cyAlTGlua3MgKSB7CgogICAgICAgIFRZUEU6CiAgICAgICAgZm9yIG15ICRUeXBlICggc29ydCBrZXlzICV7ICRMaW5rc3skT2JqZWN0fSB9ICkgewoKICAgICAgICAgICAgbmV4dCBUWVBFIGlmICRUeXBlUG9pbnRlZExpc3R7JFR5cGV9OwoKICAgICAgICAgICAgIyBleHRyYWN0IHNvdXJjZSB0YXJnZXQgcGFpcgogICAgICAgICAgICBteSAkU291cmNlVGFyZ2V0ID0gJExpbmtzeyRPYmplY3R9LT57JFR5cGV9OwoKICAgICAgICAgICAgbmV4dCBUWVBFIGlmICEkU291cmNlVGFyZ2V0LT57VGFyZ2V0fTsKCiAgICAgICAgICAgICMgc2V0IGVtcHR5IGhhc2ggcmVmZXJlbmNlIGFzIGRlZmF1bHQKICAgICAgICAgICAgJFNvdXJjZVRhcmdldC0+e1NvdXJjZX0gfHw9IHt9OwoKICAgICAgICAgICAgIyBtZXJnZSB0aGUgZGF0YQogICAgICAgICAgICBteSAlTWVyZ2VkSURzID0gKCAleyAkU291cmNlVGFyZ2V0LT57U291cmNlfSB9LCAleyAkU291cmNlVGFyZ2V0LT57VGFyZ2V0fSB9ICk7CiAgICAgICAgICAgICRTb3VyY2VUYXJnZXQtPntTb3VyY2V9ID0gXCVNZXJnZWRJRHM7CgogICAgICAgICAgICAjIGRlbGV0ZSB0YXJnZXQgaGFzaAogICAgICAgICAgICBkZWxldGUgJFNvdXJjZVRhcmdldC0+e1RhcmdldH07CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBcJUxpbmtzIGlmICEkUGFyYW17T2JqZWN0Mn0gJiYgISRQYXJhbXtEaXJlY3Rpb259OwoKICAgICMgcmVtb3ZlZCBub3QgbmVlZGVkIGVsZW1lbnRzCiAgICBPQkpFQ1Q6CiAgICBmb3IgbXkgJE9iamVjdCAoIHNvcnQga2V5cyAlTGlua3MgKSB7CgogICAgICAgICMgcmVtb3ZlZCBub3QgbmVlZGVkIG9iamVjdAogICAgICAgIGlmICggJFBhcmFte09iamVjdDJ9ICYmICRQYXJhbXtPYmplY3QyfSBuZSAkT2JqZWN0ICkgewogICAgICAgICAgICBkZWxldGUgJExpbmtzeyRPYmplY3R9OwogICAgICAgICAgICBuZXh0IE9CSkVDVDsKICAgICAgICB9CgogICAgICAgIG5leHQgT0JKRUNUIGlmICEkUGFyYW17RGlyZWN0aW9ufTsKCiAgICAgICAgIyByZW1vdmVkIG5vdCBuZWVkZWQgZGlyZWN0aW9uCiAgICAgICAgZm9yIG15ICRUeXBlICggc29ydCBrZXlzICV7ICRMaW5rc3skT2JqZWN0fSB9ICkgewoKICAgICAgICAgICAgRElSRUNUSU9OOgogICAgICAgICAgICBmb3IgbXkgJERpcmVjdGlvbiAoIHNvcnQga2V5cyAleyAkTGlua3N7JE9iamVjdH0tPnskVHlwZX0gfSApIHsKCiAgICAgICAgICAgICAgICBuZXh0IERJUkVDVElPTiBpZiAkUGFyYW17RGlyZWN0aW9ufSBlcSAkRGlyZWN0aW9uOwogICAgICAgICAgICAgICAgbmV4dCBESVJFQ1RJT04gaWYgJFBhcmFte0RpcmVjdGlvbn0gbmUgJ1NvdXJjZScgJiYgJFBhcmFte0RpcmVjdGlvbn0gbmUgJ1RhcmdldCc7CgogICAgICAgICAgICAgICAgZGVsZXRlICRMaW5rc3skT2JqZWN0fS0+eyRUeXBlfS0+eyREaXJlY3Rpb259OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBcJUxpbmtzOwp9Cgo9aXRlbSBMaW5rTGlzdFdpdGhEYXRhKCkKCmdldCBhbGwgZXhpc3RpbmcgbGlua3MgZm9yIGEgZ2l2ZW4gb2JqZWN0IHdpdGggZGF0YSBvZiB0aGUgb3RoZXIgb2JqZWN0cwoKUmV0dXJuCiAgICAkTGlua0xpc3QgPSB7CiAgICAgICAgVGlja2V0ID0+IHsKICAgICAgICAgICAgTm9ybWFsID0+IHsKICAgICAgICAgICAgICAgIFNvdXJjZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgMTIgID0+ICREYXRhT2ZJdGVtMTIsCiAgICAgICAgICAgICAgICAgICAgMjEyID0+ICREYXRhT2ZJdGVtMjEyLAogICAgICAgICAgICAgICAgICAgIDMzMiA9PiAkRGF0YU9mSXRlbTMzMiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFBhcmVudENoaWxkID0+IHsKICAgICAgICAgICAgICAgIFNvdXJjZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgNSA9PiAkRGF0YU9mSXRlbTUsCiAgICAgICAgICAgICAgICAgICAgOSA9PiAkRGF0YU9mSXRlbTksCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgVGFyZ2V0ID0+IHsKICAgICAgICAgICAgICAgICAgICA0ICA9PiAkRGF0YU9mSXRlbTQsCiAgICAgICAgICAgICAgICAgICAgOCAgPT4gJERhdGFPZkl0ZW04LAogICAgICAgICAgICAgICAgICAgIDE1ID0+ICREYXRhT2ZJdGVtMTUsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgRkFRID0+IHsKICAgICAgICAgICAgUGFyZW50Q2hpbGQgPT4gewogICAgICAgICAgICAgICAgU291cmNlID0+IHsKICAgICAgICAgICAgICAgICAgICA1ID0+ICREYXRhT2ZJdGVtNSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgIH07CgogICAgbXkgJExpbmtMaXN0ID0gJExpbmtPYmplY3QtPkxpbmtMaXN0V2l0aERhdGEoCiAgICAgICAgT2JqZWN0ICAgICAgICAgICAgICAgICAgICAgICAgICA9PiAnVGlja2V0JywKICAgICAgICBLZXkgICAgICAgICAgICAgICAgICAgICAgICAgICAgID0+ICczMjEnLAogICAgICAgIE9iamVjdDIgICAgICAgICAgICAgICAgICAgICAgICAgPT4gJ0ZBUScsICAgICAgICAgIyAob3B0aW9uYWwpCiAgICAgICAgU3RhdGUgICAgICAgICAgICAgICAgICAgICAgICAgICA9PiAnVmFsaWQnLAogICAgICAgIFR5cGUgICAgICAgICAgICAgICAgICAgICAgICAgICAgPT4gJ1BhcmVudENoaWxkJywgIyAob3B0aW9uYWwpCiAgICAgICAgRGlyZWN0aW9uICAgICAgICAgICAgICAgICAgICAgICA9PiAnVGFyZ2V0JywgICAgICAjIChvcHRpb25hbCkgZGVmYXVsdCBCb3RoIChTb3VyY2V8VGFyZ2V0fEJvdGgpCiAgICAgICAgVXNlcklEICAgICAgICAgICAgICAgICAgICAgICAgICA9PiAxLAogICAgICAgIE9iamVjdFBhcmFtZXRlcnMgICAgICAgICAgICAgICAgPT4geyAgICAgICAgICAgICAgIyAob3B0aW9uYWwpIGJhY2tlbmQgc3BlY2lmaWMgZmxhZ3MKICAgICAgICAgICAgVGlja2V0ID0+IHsKICAgICAgICAgICAgICAgIElnbm9yZUxpbmtlZFRpY2tldFN0YXRlVHlwZXMgPT4gMHwxLAogICAgICAgICAgICB9LAogICAgICAgIH0sCiAgICApOwoKPWN1dAoKc3ViIExpbmtMaXN0V2l0aERhdGEgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgZm9yIG15ICRBcmd1bWVudCAocXcoT2JqZWN0IEtleSBTdGF0ZSBVc2VySUQpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyRBcmd1bWVudH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICRBcmd1bWVudCEiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IHRoZSBsaW5rIGxpc3QKICAgIG15ICRMaW5rTGlzdCA9ICRTZWxmLT5MaW5rTGlzdCglUGFyYW0pOwoKICAgICMgY2hlY2sgbGluayBsaXN0CiAgICByZXR1cm4gaWYgISRMaW5rTGlzdDsKICAgIHJldHVybiBpZiByZWYgJExpbmtMaXN0IG5lICdIQVNIJzsKCiAgICAjIGFkZCBkYXRhIHRvIGhhc2gKICAgIE9CSkVDVDoKICAgIGZvciBteSAkT2JqZWN0ICggc29ydCBrZXlzICV7JExpbmtMaXN0fSApIHsKCiAgICAgICAgIyBjaGVjayBpZiBiYWNrZW5kIG9iamVjdCBjYW4gYmUgbG9hZGVkCiAgICAgICAgaWYgKAogICAgICAgICAgICAhJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKS0+UmVxdWlyZSggJ0tlcm5lbDo6U3lzdGVtOjpMaW5rT2JqZWN0OjonIC4gJE9iamVjdCApCiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgIGRlbGV0ZSAkTGlua0xpc3QtPnskT2JqZWN0fTsKICAgICAgICAgICAgbmV4dCBPQkpFQ1Q7CiAgICAgICAgfQoKICAgICAgICAjIGdldCBiYWNrZW5kIG9iamVjdAogICAgICAgIG15ICRCYWNrZW5kT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCggJ0tlcm5lbDo6U3lzdGVtOjpMaW5rT2JqZWN0OjonIC4gJE9iamVjdCApOwoKICAgICAgICAjIGNoZWNrIGJhY2tlbmQgb2JqZWN0CiAgICAgICAgaWYgKCAhJEJhY2tlbmRPYmplY3QgKSB7CiAgICAgICAgICAgIGRlbGV0ZSAkTGlua0xpc3QtPnskT2JqZWN0fTsKICAgICAgICAgICAgbmV4dCBPQkpFQ1Q7CiAgICAgICAgfQoKICAgICAgICBteSAlT2JqZWN0UGFyYW1ldGVycyA9ICgpOwogICAgICAgIGlmICgKICAgICAgICAgICAgcmVmICRQYXJhbXtPYmplY3RQYXJhbWV0ZXJzfSBlcSAnSEFTSCcKICAgICAgICAgICAgJiYgcmVmICRQYXJhbXtPYmplY3RQYXJhbWV0ZXJzfS0+eyRPYmplY3R9IGVxICdIQVNIJwogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICAlT2JqZWN0UGFyYW1ldGVycyA9ICV7ICRQYXJhbXtPYmplY3RQYXJhbWV0ZXJzfS0+eyRPYmplY3R9IH07CiAgICAgICAgfQoKICAgICAgICAjIGFkZCBiYWNrZW5kIGRhdGEKICAgICAgICBteSAkU3VjY2VzcyA9ICRCYWNrZW5kT2JqZWN0LT5MaW5rTGlzdFdpdGhEYXRhKAogICAgICAgICAgICBMaW5rTGlzdCA9PiAkTGlua0xpc3QtPnskT2JqZWN0fSwKICAgICAgICAgICAgVXNlcklEICAgPT4gJFBhcmFte1VzZXJJRH0sCiAgICAgICAgICAgICVPYmplY3RQYXJhbWV0ZXJzLAogICAgICAgICk7CgogICAgICAgIG5leHQgT0JKRUNUIGlmICRTdWNjZXNzOwoKICAgICAgICBkZWxldGUgJExpbmtMaXN0LT57JE9iamVjdH07CiAgICB9CgogICAgIyBjbGVhbiB0aGUgaGFzaAogICAgT0JKRUNUOgogICAgZm9yIG15ICRPYmplY3QgKCBzb3J0IGtleXMgJXskTGlua0xpc3R9ICkgewoKICAgICAgICBMSU5LVFlQRToKICAgICAgICBmb3IgbXkgJExpbmtUeXBlICggc29ydCBrZXlzICV7ICRMaW5rTGlzdC0+eyRPYmplY3R9IH0gKSB7CgogICAgICAgICAgICBESVJFQ1RJT046CiAgICAgICAgICAgIGZvciBteSAkRGlyZWN0aW9uICggc29ydCBrZXlzICV7ICRMaW5rTGlzdC0+eyRPYmplY3R9LT57JExpbmtUeXBlfSB9ICkgewoKICAgICAgICAgICAgICAgIG5leHQgRElSRUNUSU9OIGlmICV7ICRMaW5rTGlzdC0+eyRPYmplY3R9LT57JExpbmtUeXBlfS0+eyREaXJlY3Rpb259IH07CgogICAgICAgICAgICAgICAgZGVsZXRlICRMaW5rTGlzdC0+eyRPYmplY3R9LT57JExpbmtUeXBlfS0+eyREaXJlY3Rpb259OwogICAgICAgICAgICB9CgogICAgICAgICAgICBuZXh0IExJTktUWVBFIGlmICV7ICRMaW5rTGlzdC0+eyRPYmplY3R9LT57JExpbmtUeXBlfSB9OwoKICAgICAgICAgICAgZGVsZXRlICRMaW5rTGlzdC0+eyRPYmplY3R9LT57JExpbmtUeXBlfTsKICAgICAgICB9CgogICAgICAgIG5leHQgT0JKRUNUIGlmICV7ICRMaW5rTGlzdC0+eyRPYmplY3R9IH07CgogICAgICAgIGRlbGV0ZSAkTGlua0xpc3QtPnskT2JqZWN0fTsKICAgIH0KCiAgICByZXR1cm4gJExpbmtMaXN0Owp9Cgo9aXRlbSBMaW5rS2V5TGlzdCgpCgpyZXR1cm4gYSBoYXNoIHdpdGggYWxsIGV4aXN0aW5nIGxpbmtzIG9mIGEgZ2l2ZW4gb2JqZWN0CgpSZXR1cm4KICAgICVMaW5rS2V5TGlzdCA9ICgKICAgICAgICA1ICAgPT4gMSwKICAgICAgICA5ICAgPT4gMSwKICAgICAgICAxMiAgPT4gMSwKICAgICAgICAyMTIgPT4gMSwKICAgICAgICAzMzIgPT4gMSwKICAgICk7CgogICAgbXkgJUxpbmtLZXlMaXN0ID0gJExpbmtPYmplY3QtPkxpbmtLZXlMaXN0KAogICAgICAgIE9iamVjdDEgICA9PiAnVGlja2V0JywKICAgICAgICBLZXkxICAgICAgPT4gJzMyMScsCiAgICAgICAgT2JqZWN0MiAgID0+ICdGQVEnLAogICAgICAgIFN0YXRlICAgICA9PiAnVmFsaWQnLAogICAgICAgIFR5cGUgICAgICA9PiAnUGFyZW50Q2hpbGQnLCAjIChvcHRpb25hbCkKICAgICAgICBEaXJlY3Rpb24gPT4gJ1RhcmdldCcsICAgICAgIyAob3B0aW9uYWwpIGRlZmF1bHQgQm90aCAoU291cmNlfFRhcmdldHxCb3RoKQogICAgICAgIFVzZXJJRCAgICA9PiAxLAogICAgKTsKCj1jdXQKCnN1YiBMaW5rS2V5TGlzdCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgbXkgJEFyZ3VtZW50IChxdyhPYmplY3QxIEtleTEgT2JqZWN0MiBTdGF0ZSBVc2VySUQpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyRBcmd1bWVudH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICRBcmd1bWVudCEiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IHRoZSBsaW5rIGxpc3QKICAgIG15ICRMaW5rTGlzdCA9ICRTZWxmLT5MaW5rTGlzdCgKICAgICAgICAlUGFyYW0sCiAgICAgICAgT2JqZWN0ID0+ICRQYXJhbXtPYmplY3QxfSwKICAgICAgICBLZXkgICAgPT4gJFBhcmFte0tleTF9LAogICAgKTsKCiAgICAjIGNoZWNrIGxpbmsgbGlzdAogICAgcmV0dXJuIGlmICEkTGlua0xpc3Q7CiAgICByZXR1cm4gaWYgcmVmICRMaW5rTGlzdCBuZSAnSEFTSCc7CgogICAgIyBleHRyYWN0IHR5cGVsaXN0CiAgICBteSAkVHlwZUxpc3QgPSAkTGlua0xpc3QtPnsgJFBhcmFte09iamVjdDJ9IH07CgogICAgIyBhZGQgZGF0YSB0byBoYXNoCiAgICBteSAlTGlua0tleUxpc3Q7CiAgICBmb3IgbXkgJFR5cGUgKCBzb3J0IGtleXMgJXskVHlwZUxpc3R9ICkgewoKICAgICAgICAjIGV4dHJhY3QgZGlyZWN0aW9uIGxpc3QKICAgICAgICBteSAkRGlyZWN0aW9uTGlzdCA9ICRUeXBlTGlzdC0+eyRUeXBlfTsKCiAgICAgICAgZm9yIG15ICREaXJlY3Rpb24gKCBzb3J0IGtleXMgJXskRGlyZWN0aW9uTGlzdH0gKSB7CgogICAgICAgICAgICBmb3IgbXkgJEtleSAoIHNvcnQga2V5cyAleyAkRGlyZWN0aW9uTGlzdC0+eyREaXJlY3Rpb259IH0gKSB7CgogICAgICAgICAgICAgICAgIyBhZGQga2V5IHRvIGxpc3QKICAgICAgICAgICAgICAgICRMaW5rS2V5TGlzdHskS2V5fSA9ICREaXJlY3Rpb25MaXN0LT57JERpcmVjdGlvbn0tPnskS2V5fTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gJUxpbmtLZXlMaXN0Owp9Cgo9aXRlbSBMaW5rS2V5TGlzdFdpdGhEYXRhKCkKCnJldHVybiBhIGhhc2ggd2l0aCBhbGwgZXhpc3RpbmcgbGlua3Mgb2YgYSBnaXZlbiBvYmplY3QKClJldHVybgogICAgJUxpbmtLZXlMaXN0ID0gKAogICAgICAgIDUgICA9PiAkRGF0YU9mSXRlbTUsCiAgICAgICAgOSAgID0+ICREYXRhT2ZJdGVtOSwKICAgICAgICAxMiAgPT4gJERhdGFPZkl0ZW0xMiwKICAgICAgICAyMTIgPT4gJERhdGFPZkl0ZW0yMTIsCiAgICAgICAgMzMyID0+ICREYXRhT2ZJdGVtMzMyLAogICAgKTsKCiAgICBteSAlTGlua0tleUxpc3QgPSAkTGlua09iamVjdC0+TGlua0tleUxpc3RXaXRoRGF0YSgKICAgICAgICBPYmplY3QxICAgPT4gJ1RpY2tldCcsCiAgICAgICAgS2V5MSAgICAgID0+ICczMjEnLAogICAgICAgIE9iamVjdDIgICA9PiAnRkFRJywKICAgICAgICBTdGF0ZSAgICAgPT4gJ1ZhbGlkJywKICAgICAgICBUeXBlICAgICAgPT4gJ1BhcmVudENoaWxkJywgIyAob3B0aW9uYWwpCiAgICAgICAgRGlyZWN0aW9uID0+ICdUYXJnZXQnLCAgICAgICMgKG9wdGlvbmFsKSBkZWZhdWx0IEJvdGggKFNvdXJjZXxUYXJnZXR8Qm90aCkKICAgICAgICBVc2VySUQgICAgPT4gMSwKICAgICk7Cgo9Y3V0CgpzdWIgTGlua0tleUxpc3RXaXRoRGF0YSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgbXkgJEFyZ3VtZW50IChxdyhPYmplY3QxIEtleTEgT2JqZWN0MiBTdGF0ZSBVc2VySUQpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyRBcmd1bWVudH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICRBcmd1bWVudCEiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IHRoZSBsaW5rIGxpc3QKICAgIG15ICRMaW5rTGlzdCA9ICRTZWxmLT5MaW5rTGlzdFdpdGhEYXRhKAogICAgICAgICVQYXJhbSwKICAgICAgICBPYmplY3QgPT4gJFBhcmFte09iamVjdDF9LAogICAgICAgIEtleSAgICA9PiAkUGFyYW17S2V5MX0sCiAgICApOwoKICAgICMgY2hlY2sgbGluayBsaXN0CiAgICByZXR1cm4gaWYgISRMaW5rTGlzdDsKICAgIHJldHVybiBpZiByZWYgJExpbmtMaXN0IG5lICdIQVNIJzsKCiAgICAjIGV4dHJhY3QgdHlwZWxpc3QKICAgIG15ICRUeXBlTGlzdCA9ICRMaW5rTGlzdC0+eyAkUGFyYW17T2JqZWN0Mn0gfTsKCiAgICAjIGFkZCBkYXRhIHRvIGhhc2gKICAgIG15ICVMaW5rS2V5TGlzdDsKICAgIGZvciBteSAkVHlwZSAoIHNvcnQga2V5cyAleyRUeXBlTGlzdH0gKSB7CgogICAgICAgICMgZXh0cmFjdCBkaXJlY3Rpb24gbGlzdAogICAgICAgIG15ICREaXJlY3Rpb25MaXN0ID0gJFR5cGVMaXN0LT57JFR5cGV9OwoKICAgICAgICBmb3IgbXkgJERpcmVjdGlvbiAoIHNvcnQga2V5cyAleyREaXJlY3Rpb25MaXN0fSApIHsKCiAgICAgICAgICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICV7ICREaXJlY3Rpb25MaXN0LT57JERpcmVjdGlvbn0gfSApIHsKCiAgICAgICAgICAgICAgICAjIGFkZCBrZXkgdG8gbGlzdAogICAgICAgICAgICAgICAgJExpbmtLZXlMaXN0eyRLZXl9ID0gJERpcmVjdGlvbkxpc3QtPnskRGlyZWN0aW9ufS0+eyRLZXl9OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAlTGlua0tleUxpc3Q7Cn0KCj1pdGVtIE9iamVjdExvb2t1cCgpCgpsb29rdXAgYSBsaW5rIG9iamVjdAoKICAgICRPYmplY3RJRCA9ICRMaW5rT2JqZWN0LT5PYmplY3RMb29rdXAoCiAgICAgICAgTmFtZSA9PiAnVGlja2V0JywKICAgICk7CgogICAgb3IKCiAgICAkTmFtZSA9ICRMaW5rT2JqZWN0LT5PYmplY3RMb29rdXAoCiAgICAgICAgT2JqZWN0SUQgPT4gMTIsCiAgICApOwoKPWN1dAoKc3ViIE9iamVjdExvb2t1cCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICEkUGFyYW17T2JqZWN0SUR9ICYmICEkUGFyYW17TmFtZX0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdOZWVkIE9iamVjdElEIG9yIE5hbWUhJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtPYmplY3RJRH0gKSB7CgogICAgICAgICMgY2hlY2sgY2FjaGUKICAgICAgICBteSAkQ2FjaGVLZXkgPSAnT2JqZWN0TG9va3VwOjpPYmplY3RJRDo6JyAuICRQYXJhbXtPYmplY3RJRH07CiAgICAgICAgbXkgJENhY2hlICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyktPkdldCgKICAgICAgICAgICAgVHlwZSA9PiAkU2VsZi0+e0NhY2hlVHlwZX0sCiAgICAgICAgICAgIEtleSAgPT4gJENhY2hlS2V5LAogICAgICAgICk7CiAgICAgICAgcmV0dXJuICRDYWNoZSBpZiAkQ2FjaGU7CgogICAgICAgICMgZ2V0IGRhdGFiYXNlIG9iamVjdAogICAgICAgIG15ICREQk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwoKICAgICAgICAjIGFzayB0aGUgZGF0YWJhc2UKICAgICAgICByZXR1cm4gaWYgISREQk9iamVjdC0+UHJlcGFyZSgKICAgICAgICAgICAgU1FMID0+ICcKICAgICAgICAgICAgICAgIFNFTEVDVCBuYW1lCiAgICAgICAgICAgICAgICBGUk9NIGxpbmtfb2JqZWN0CiAgICAgICAgICAgICAgICBXSEVSRSBpZCA9ID8nLAogICAgICAgICAgICBCaW5kICA9PiBbIFwkUGFyYW17T2JqZWN0SUR9IF0sCiAgICAgICAgICAgIExpbWl0ID0+IDEsCiAgICAgICAgKTsKCiAgICAgICAgIyBmZXRjaCB0aGUgcmVzdWx0CiAgICAgICAgbXkgJE5hbWU7CiAgICAgICAgd2hpbGUgKCBteSBAUm93ID0gJERCT2JqZWN0LT5GZXRjaHJvd0FycmF5KCkgKSB7CiAgICAgICAgICAgICROYW1lID0gJFJvd1swXTsKICAgICAgICB9CgogICAgICAgICMgY2hlY2sgdGhlIG5hbWUKICAgICAgICBpZiAoICEkTmFtZSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkxpbmsgb2JqZWN0IGlkICckUGFyYW17T2JqZWN0SUR9JyBub3QgZm91bmQgaW4gdGhlIGRhdGFiYXNlISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgc2V0IGNhY2hlCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyktPlNldCgKICAgICAgICAgICAgVHlwZSAgPT4gJFNlbGYtPntDYWNoZVR5cGV9LAogICAgICAgICAgICBUVEwgICA9PiAkU2VsZi0+e0NhY2hlVFRMfSwKICAgICAgICAgICAgS2V5ICAgPT4gJENhY2hlS2V5LAogICAgICAgICAgICBWYWx1ZSA9PiAkTmFtZSwKICAgICAgICApOwoKICAgICAgICByZXR1cm4gJE5hbWU7CiAgICB9CiAgICBlbHNlIHsKCiAgICAgICAgIyBjaGVjayBjYWNoZQogICAgICAgIG15ICRDYWNoZUtleSA9ICdPYmplY3RMb29rdXA6Ok5hbWU6OicgLiAkUGFyYW17TmFtZX07CiAgICAgICAgbXkgJENhY2hlICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyktPkdldCgKICAgICAgICAgICAgVHlwZSA9PiAkU2VsZi0+e0NhY2hlVHlwZX0sCiAgICAgICAgICAgIEtleSAgPT4gJENhY2hlS2V5LAogICAgICAgICk7CiAgICAgICAgcmV0dXJuICRDYWNoZSBpZiAkQ2FjaGU7CgogICAgICAgICMgZ2V0IG5lZWRlZCBvYmplY3QKICAgICAgICBteSAkREJPYmplY3QgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkRCJyk7CiAgICAgICAgbXkgJENoZWNrSXRlbU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDaGVja0l0ZW0nKTsKCiAgICAgICAgIyBpbnZlc3RpZ2F0ZSB0aGUgb2JqZWN0IGlkCiAgICAgICAgbXkgJE9iamVjdElEOwogICAgICAgIFRSWToKICAgICAgICBmb3IgbXkgJFRyeSAoIDEgLi4gMyApIHsKCiAgICAgICAgICAgICMgYXNrIHRoZSBkYXRhYmFzZQogICAgICAgICAgICByZXR1cm4gaWYgISREQk9iamVjdC0+UHJlcGFyZSgKICAgICAgICAgICAgICAgIFNRTCA9PiAnCiAgICAgICAgICAgICAgICAgICAgU0VMRUNUIGlkCiAgICAgICAgICAgICAgICAgICAgRlJPTSBsaW5rX29iamVjdAogICAgICAgICAgICAgICAgICAgIFdIRVJFIG5hbWUgPSA/JywKICAgICAgICAgICAgICAgIEJpbmQgID0+IFsgXCRQYXJhbXtOYW1lfSBdLAogICAgICAgICAgICAgICAgTGltaXQgPT4gMSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgZmV0Y2ggdGhlIHJlc3VsdAogICAgICAgICAgICB3aGlsZSAoIG15IEBSb3cgPSAkREJPYmplY3QtPkZldGNocm93QXJyYXkoKSApIHsKICAgICAgICAgICAgICAgICRPYmplY3RJRCA9ICRSb3dbMF07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxhc3QgVFJZIGlmICRPYmplY3RJRDsKCiAgICAgICAgICAgICMgY2xlYW51cCB0aGUgZ2l2ZW4gbmFtZQogICAgICAgICAgICAkQ2hlY2tJdGVtT2JqZWN0LT5TdHJpbmdDbGVhbigKICAgICAgICAgICAgICAgIFN0cmluZ1JlZiA9PiBcJFBhcmFte05hbWV9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBjaGVjayBpZiBuYW1lIGlzIHZhbGlkCiAgICAgICAgICAgIGlmICggISRQYXJhbXtOYW1lfSB8fCAkUGFyYW17TmFtZX0gPX4gbXsgOjogfXhtcyB8fCAkUGFyYW17TmFtZX0gPX4gbXsgXHMgfXhtcyApIHsKICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkludmFsaWQgb2JqZWN0IG5hbWUgJyRQYXJhbXtOYW1lfScgaXMgZ2l2ZW4hIiwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG5leHQgVFJZIGlmICRUcnkgPT0gMTsKCiAgICAgICAgICAgICMgaW5zZXJ0IHRoZSBuZXcgb2JqZWN0CiAgICAgICAgICAgIHJldHVybiBpZiAhJERCT2JqZWN0LT5EbygKICAgICAgICAgICAgICAgIFNRTCAgPT4gJ0lOU0VSVCBJTlRPIGxpbmtfb2JqZWN0IChuYW1lKSBWQUxVRVMgKD8pJywKICAgICAgICAgICAgICAgIEJpbmQgPT4gWyBcJFBhcmFte05hbWV9IF0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIHNldCBjYWNoZQogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpLT5TZXQoCiAgICAgICAgICAgIFR5cGUgID0+ICRTZWxmLT57Q2FjaGVUeXBlfSwKICAgICAgICAgICAgVFRMICAgPT4gJFNlbGYtPntDYWNoZVRUTH0sCiAgICAgICAgICAgIEtleSAgID0+ICRDYWNoZUtleSwKICAgICAgICAgICAgVmFsdWUgPT4gJE9iamVjdElELAogICAgICAgICk7CgogICAgICAgIHJldHVybiAkT2JqZWN0SUQ7CiAgICB9Cn0KCj1pdGVtIFR5cGVMb29rdXAoKQoKbG9va3VwIGEgbGluayB0eXBlCgogICAgJFR5cGVJRCA9ICRMaW5rT2JqZWN0LT5UeXBlTG9va3VwKAogICAgICAgIE5hbWUgICA9PiAnTm9ybWFsJywKICAgICAgICBVc2VySUQgPT4gMSwKICAgICk7CgogICAgb3IKCiAgICAkTmFtZSA9ICRMaW5rT2JqZWN0LT5UeXBlTG9va3VwKAogICAgICAgIFR5cGVJRCA9PiA1NiwKICAgICAgICBVc2VySUQgPT4gMSwKICAgICk7Cgo9Y3V0CgpzdWIgVHlwZUxvb2t1cCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICEkUGFyYW17VHlwZUlEfSAmJiAhJFBhcmFte05hbWV9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnTmVlZCBUeXBlSUQgb3IgTmFtZSEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICEkUGFyYW17VXNlcklEfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgVXNlcklEIScKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtUeXBlSUR9ICkgewoKICAgICAgICAjIGNoZWNrIGNhY2hlCiAgICAgICAgbXkgJENhY2hlS2V5ID0gJ1R5cGVMb29rdXA6OlR5cGVJRDo6JyAuICRQYXJhbXtUeXBlSUR9OwogICAgICAgIG15ICRDYWNoZSAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpLT5HZXQoCiAgICAgICAgICAgIFR5cGUgPT4gJFNlbGYtPntDYWNoZVR5cGV9LAogICAgICAgICAgICBLZXkgID0+ICRDYWNoZUtleSwKICAgICAgICApOwogICAgICAgIHJldHVybiAkQ2FjaGUgaWYgJENhY2hlOwoKICAgICAgICAjIGdldCBkYXRhYmFzZSBvYmplY3QKICAgICAgICBteSAkREJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6REInKTsKCiAgICAgICAgIyBhc2sgdGhlIGRhdGFiYXNlCiAgICAgICAgcmV0dXJuIGlmICEkREJPYmplY3QtPlByZXBhcmUoCiAgICAgICAgICAgIFNRTCAgID0+ICdTRUxFQ1QgbmFtZSBGUk9NIGxpbmtfdHlwZSBXSEVSRSBpZCA9ID8nLAogICAgICAgICAgICBCaW5kICA9PiBbIFwkUGFyYW17VHlwZUlEfSBdLAogICAgICAgICAgICBMaW1pdCA9PiAxLAogICAgICAgICk7CgogICAgICAgICMgZmV0Y2ggdGhlIHJlc3VsdAogICAgICAgIG15ICROYW1lOwogICAgICAgIHdoaWxlICggbXkgQFJvdyA9ICREQk9iamVjdC0+RmV0Y2hyb3dBcnJheSgpICkgewogICAgICAgICAgICAkTmFtZSA9ICRSb3dbMF07CiAgICAgICAgfQoKICAgICAgICAjIGNoZWNrIHRoZSBuYW1lCiAgICAgICAgaWYgKCAhJE5hbWUgKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJMaW5rIHR5cGUgaWQgJyRQYXJhbXtUeXBlSUR9JyBub3QgZm91bmQgaW4gdGhlIGRhdGFiYXNlISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgc2V0IGNhY2hlCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyktPlNldCgKICAgICAgICAgICAgVHlwZSAgPT4gJFNlbGYtPntDYWNoZVR5cGV9LAogICAgICAgICAgICBUVEwgICA9PiAkU2VsZi0+e0NhY2hlVFRMfSwKICAgICAgICAgICAgS2V5ICAgPT4gJENhY2hlS2V5LAogICAgICAgICAgICBWYWx1ZSA9PiAkTmFtZSwKICAgICAgICApOwoKICAgICAgICByZXR1cm4gJE5hbWU7CiAgICB9CiAgICBlbHNlIHsKCiAgICAgICAgIyBnZXQgY2hlY2sgaXRlbSBvYmplY3QKICAgICAgICBteSAkQ2hlY2tJdGVtT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNoZWNrSXRlbScpOwoKICAgICAgICAjIGNsZWFudXAgdGhlIGdpdmVuIG5hbWUKICAgICAgICAkQ2hlY2tJdGVtT2JqZWN0LT5TdHJpbmdDbGVhbigKICAgICAgICAgICAgU3RyaW5nUmVmID0+IFwkUGFyYW17TmFtZX0sCiAgICAgICAgKTsKCiAgICAgICAgIyBjaGVjayBjYWNoZQogICAgICAgIG15ICRDYWNoZUtleSA9ICdUeXBlTG9va3VwOjpOYW1lOjonIC4gJFBhcmFte05hbWV9OwogICAgICAgIG15ICRDYWNoZSAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpLT5HZXQoCiAgICAgICAgICAgIFR5cGUgPT4gJFNlbGYtPntDYWNoZVR5cGV9LAogICAgICAgICAgICBLZXkgID0+ICRDYWNoZUtleSwKICAgICAgICApOwogICAgICAgIHJldHVybiAkQ2FjaGUgaWYgJENhY2hlOwoKICAgICAgICAjIGdldCBkYXRhYmFzZSBvYmplY3QKICAgICAgICBteSAkREJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6REInKTsKCiAgICAgICAgIyBpbnZlc3RpZ2F0ZSB0aGUgdHlwZSBpZAogICAgICAgIG15ICRUeXBlSUQ7CiAgICAgICAgVFJZOgogICAgICAgIGZvciBteSAkVHJ5ICggMSAuLiAyICkgewoKICAgICAgICAgICAgIyBhc2sgdGhlIGRhdGFiYXNlCiAgICAgICAgICAgIHJldHVybiBpZiAhJERCT2JqZWN0LT5QcmVwYXJlKAogICAgICAgICAgICAgICAgU1FMICAgPT4gJ1NFTEVDVCBpZCBGUk9NIGxpbmtfdHlwZSBXSEVSRSBuYW1lID0gPycsCiAgICAgICAgICAgICAgICBCaW5kICA9PiBbIFwkUGFyYW17TmFtZX0gXSwKICAgICAgICAgICAgICAgIExpbWl0ID0+IDEsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAjIGZldGNoIHRoZSByZXN1bHQKICAgICAgICAgICAgd2hpbGUgKCBteSBAUm93ID0gJERCT2JqZWN0LT5GZXRjaHJvd0FycmF5KCkgKSB7CiAgICAgICAgICAgICAgICAkVHlwZUlEID0gJFJvd1swXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGFzdCBUUlkgaWYgJFR5cGVJRDsKCiAgICAgICAgICAgICMgY2hlY2sgaWYgbmFtZSBpcyB2YWxpZAogICAgICAgICAgICBpZiAoICEkUGFyYW17TmFtZX0gfHwgJFBhcmFte05hbWV9ID1+IG17IDo6IH14bXMgfHwgJFBhcmFte05hbWV9ID1+IG17IFxzIH14bXMgKSB7CiAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJJbnZhbGlkIHR5cGUgbmFtZSAnJFBhcmFte05hbWV9JyBpcyBnaXZlbiEiLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBpbnNlcnQgdGhlIG5ldyB0eXBlCiAgICAgICAgICAgIHJldHVybiBpZiAhJERCT2JqZWN0LT5EbygKICAgICAgICAgICAgICAgIFNRTCA9PiAnCiAgICAgICAgICAgICAgICAgICAgSU5TRVJUIElOVE8gbGlua190eXBlCiAgICAgICAgICAgICAgICAgICAgKG5hbWUsIHZhbGlkX2lkLCBjcmVhdGVfdGltZSwgY3JlYXRlX2J5LCBjaGFuZ2VfdGltZSwgY2hhbmdlX2J5KQogICAgICAgICAgICAgICAgICAgIFZBTFVFUyAoPywgMSwgY3VycmVudF90aW1lc3RhbXAsID8sIGN1cnJlbnRfdGltZXN0YW1wLCA/KScsCiAgICAgICAgICAgICAgICBCaW5kID0+IFsgXCRQYXJhbXtOYW1lfSwgXCRQYXJhbXtVc2VySUR9LCBcJFBhcmFte1VzZXJJRH0gXSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgY2hlY2sgdGhlIHR5cGUgaWQKICAgICAgICBpZiAoICEkVHlwZUlEICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTGluayB0eXBlICckUGFyYW17TmFtZX0nIG5vdCBmb3VuZCBpbiB0aGUgZGF0YWJhc2UhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBzZXQgY2FjaGUKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKS0+U2V0KAogICAgICAgICAgICBUeXBlICA9PiAkU2VsZi0+e0NhY2hlVHlwZX0sCiAgICAgICAgICAgIFRUTCAgID0+ICRTZWxmLT57Q2FjaGVUVEx9LAogICAgICAgICAgICBLZXkgICA9PiAkQ2FjaGVLZXksCiAgICAgICAgICAgIFZhbHVlID0+ICRUeXBlSUQsCiAgICAgICAgKTsKCiAgICAgICAgcmV0dXJuICRUeXBlSUQ7CiAgICB9Cn0KCj1pdGVtIFR5cGVHZXQoKQoKZ2V0IGEgbGluayB0eXBlCgpSZXR1cm4KICAgICRUeXBlRGF0YXtUeXBlSUR9CiAgICAkVHlwZURhdGF7TmFtZX0KICAgICRUeXBlRGF0YXtTb3VyY2VOYW1lfQogICAgJFR5cGVEYXRhe1RhcmdldE5hbWV9CiAgICAkVHlwZURhdGF7UG9pbnRlZH0KICAgICRUeXBlRGF0YXtDcmVhdGVUaW1lfQogICAgJFR5cGVEYXRhe0NyZWF0ZUJ5fQogICAgJFR5cGVEYXRhe0NoYW5nZVRpbWV9CiAgICAkVHlwZURhdGF7Q2hhbmdlQnl9CgogICAgJVR5cGVEYXRhID0gJExpbmtPYmplY3QtPlR5cGVHZXQoCiAgICAgICAgVHlwZUlEID0+IDQ0NCwKICAgICk7Cgo9Y3V0CgpzdWIgVHlwZUdldCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgbXkgJEFyZ3VtZW50IChxdyhUeXBlSUQpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyRBcmd1bWVudH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICRBcmd1bWVudCEiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgY2hlY2sgY2FjaGUKICAgIG15ICRDYWNoZUtleSA9ICdUeXBlR2V0OjpUeXBlSUQ6OicgLiAkUGFyYW17VHlwZUlEfTsKICAgIG15ICRDYWNoZSAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpLT5HZXQoCiAgICAgICAgVHlwZSA9PiAkU2VsZi0+e0NhY2hlVHlwZX0sCiAgICAgICAgS2V5ICA9PiAkQ2FjaGVLZXksCiAgICApOwogICAgcmV0dXJuICV7JENhY2hlfSBpZiAkQ2FjaGU7CgogICAgIyBnZXQgZGF0YWJhc2Ugb2JqZWN0CiAgICBteSAkREJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6REInKTsKCiAgICAjIGFzayB0aGUgZGF0YWJhc2UKICAgIHJldHVybiBpZiAhJERCT2JqZWN0LT5QcmVwYXJlKAogICAgICAgIFNRTCA9PiAnCiAgICAgICAgICAgIFNFTEVDVCBpZCwgbmFtZSwgY3JlYXRlX3RpbWUsIGNyZWF0ZV9ieSwgY2hhbmdlX3RpbWUsIGNoYW5nZV9ieQogICAgICAgICAgICBGUk9NIGxpbmtfdHlwZQogICAgICAgICAgICBXSEVSRSBpZCA9ID8nLAogICAgICAgIEJpbmQgID0+IFsgXCRQYXJhbXtUeXBlSUR9IF0sCiAgICAgICAgTGltaXQgPT4gMSwKICAgICk7CgogICAgIyBmZXRjaCB0aGUgcmVzdWx0CiAgICBteSAlVHlwZTsKICAgIHdoaWxlICggbXkgQFJvdyA9ICREQk9iamVjdC0+RmV0Y2hyb3dBcnJheSgpICkgewogICAgICAgICRUeXBle1R5cGVJRH0gICAgID0gJFJvd1swXTsKICAgICAgICAkVHlwZXtOYW1lfSAgICAgICA9ICRSb3dbMV07CiAgICAgICAgJFR5cGV7Q3JlYXRlVGltZX0gPSAkUm93WzJdOwogICAgICAgICRUeXBle0NyZWF0ZUJ5fSAgID0gJFJvd1szXTsKICAgICAgICAkVHlwZXtDaGFuZ2VUaW1lfSA9ICRSb3dbNF07CiAgICAgICAgJFR5cGV7Q2hhbmdlQnl9ICAgPSAkUm93WzVdOwogICAgfQoKICAgICMgZ2V0IGNvbmZpZyBvZiBhbGwgdHlwZXMKICAgIG15ICRDb25maWd1cmVkVHlwZXMgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ0xpbmtPYmplY3Q6OlR5cGUnKTsKCiAgICAjIGNoZWNrIHRoZSBjb25maWcKICAgIGlmICggISRDb25maWd1cmVkVHlwZXMtPnsgJFR5cGV7TmFtZX0gfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkxpbmt0eXBlICckVHlwZXtOYW1lfScgZG9lcyBub3QgZXhpc3QhIiwKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGFkZCBzb3VyY2UgYW5kIHRhcmdldCBuYW1lCiAgICAkVHlwZXtTb3VyY2VOYW1lfSA9ICRDb25maWd1cmVkVHlwZXMtPnsgJFR5cGV7TmFtZX0gfS0+e1NvdXJjZU5hbWV9IHx8ICcnOwogICAgJFR5cGV7VGFyZ2V0TmFtZX0gPSAkQ29uZmlndXJlZFR5cGVzLT57ICRUeXBle05hbWV9IH0tPntUYXJnZXROYW1lfSB8fCAnJzsKCiAgICAjIGdldCBjaGVjayBpdGVtIG9iamVjdAogICAgbXkgJENoZWNrSXRlbU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDaGVja0l0ZW0nKTsKCiAgICAjIGNsZWFuIHRoZSBuYW1lcwogICAgQVJHVU1FTlQ6CiAgICBmb3IgbXkgJEFyZ3VtZW50IChxdyhTb3VyY2VOYW1lIFRhcmdldE5hbWUpKSB7CiAgICAgICAgJENoZWNrSXRlbU9iamVjdC0+U3RyaW5nQ2xlYW4oCiAgICAgICAgICAgIFN0cmluZ1JlZiAgICAgICAgID0+IFwkVHlwZXskQXJndW1lbnR9LAogICAgICAgICAgICBSZW1vdmVBbGxOZXdsaW5lcyA9PiAxLAogICAgICAgICAgICBSZW1vdmVBbGxUYWJzICAgICA9PiAxLAogICAgICAgICk7CgogICAgICAgIG5leHQgQVJHVU1FTlQgaWYgJFR5cGV7JEFyZ3VtZW50fTsKCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgPT4KICAgICAgICAgICAgICAgICJUaGUgJEFyZ3VtZW50ICckVHlwZXskQXJndW1lbnR9JyBpcyBpbnZhbGlkIGluIFN5c0NvbmZpZyAoTGlua09iamVjdDo6VHlwZSkhIiwKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGFkZCBwb2ludGVkIHZhbHVlCiAgICAkVHlwZXtQb2ludGVkfSA9ICRUeXBle1NvdXJjZU5hbWV9IG5lICRUeXBle1RhcmdldE5hbWV9ID8gMSA6IDA7CgogICAgIyBzZXQgY2FjaGUKICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpLT5TZXQoCiAgICAgICAgVHlwZSAgPT4gJFNlbGYtPntDYWNoZVR5cGV9LAogICAgICAgIFRUTCAgID0+ICRTZWxmLT57Q2FjaGVUVEx9LAogICAgICAgIEtleSAgID0+ICRDYWNoZUtleSwKICAgICAgICBWYWx1ZSA9PiBcJVR5cGUsCiAgICApOwoKICAgIHJldHVybiAlVHlwZTsKfQoKPWl0ZW0gVHlwZUxpc3QoKQoKcmV0dXJuIGEgMmQgaGFzaCBsaXN0IG9mIGFsbCB2YWxpZCBsaW5rIHR5cGVzCgpSZXR1cm4KICAgICRUeXBlTGlzdHsKICAgICAgICBOb3JtYWwgPT4gewogICAgICAgICAgICBTb3VyY2VOYW1lID0+ICdOb3JtYWwnLAogICAgICAgICAgICBUYXJnZXROYW1lID0+ICdOb3JtYWwnLAogICAgICAgIH0sCiAgICAgICAgUGFyZW50Q2hpbGQgPT4gewogICAgICAgICAgICBTb3VyY2VOYW1lID0+ICdQYXJlbnQnLAogICAgICAgICAgICBUYXJnZXROYW1lID0+ICdDaGlsZCcsCiAgICAgICAgfSwKICAgIH0KCiAgICBteSAlVHlwZUxpc3QgPSAkTGlua09iamVjdC0+VHlwZUxpc3QoKTsKCj1jdXQKCnN1YiBUeXBlTGlzdCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IHR5cGUgbGlzdAogICAgbXkgJFR5cGVMaXN0UmVmID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdMaW5rT2JqZWN0OjpUeXBlJykgfHwge307CiAgICBteSAlVHlwZUxpc3QgPSAleyRUeXBlTGlzdFJlZn07CgogICAgIyBnZXQgY2hlY2sgaXRlbSBvYmplY3QKICAgIG15ICRDaGVja0l0ZW1PYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2hlY2tJdGVtJyk7CgogICAgIyBwcmVwYXJlIHRoZSB0eXBlIGxpc3QKICAgIFRZUEU6CiAgICBmb3IgbXkgJFR5cGUgKCBzb3J0IGtleXMgJVR5cGVMaXN0ICkgewoKICAgICAgICAjIGNoZWNrIHRoZSBzb3VyY2UgYW5kIHRhcmdldCBuYW1lCiAgICAgICAgQVJHVU1FTlQ6CiAgICAgICAgZm9yIG15ICRBcmd1bWVudCAocXcoU291cmNlTmFtZSBUYXJnZXROYW1lKSkgewoKICAgICAgICAgICAgIyBzZXQgZW1wdHkgc3RyaW5nIGFzIGRlZmF1bHQgdmFsdWUKICAgICAgICAgICAgJFR5cGVMaXN0eyRUeXBlfXskQXJndW1lbnR9IHx8PSAnJzsKCiAgICAgICAgICAgICMgY2xlYW4gdGhlIGFyZ3VtZW50CiAgICAgICAgICAgICRDaGVja0l0ZW1PYmplY3QtPlN0cmluZ0NsZWFuKAogICAgICAgICAgICAgICAgU3RyaW5nUmVmICAgICAgICAgPT4gXCRUeXBlTGlzdHskVHlwZX17JEFyZ3VtZW50fSwKICAgICAgICAgICAgICAgIFJlbW92ZUFsbE5ld2xpbmVzID0+IDEsCiAgICAgICAgICAgICAgICBSZW1vdmVBbGxUYWJzICAgICA9PiAxLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgbmV4dCBBUkdVTUVOVCBpZiAkVHlwZUxpc3R7JFR5cGV9eyRBcmd1bWVudH07CgogICAgICAgICAgICAjIHJlbW92ZSBpbnZhbGlkIGxpbmsgdHlwZSBmcm9tIGxpc3QKICAgICAgICAgICAgZGVsZXRlICRUeXBlTGlzdHskVHlwZX07CgogICAgICAgICAgICBuZXh0IFRZUEU7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAlVHlwZUxpc3Q7Cn0KCj1pdGVtIFR5cGVHcm91cExpc3QoKQoKcmV0dXJuIGEgMmQgaGFzaCBsaXN0IG9mIGFsbCB0eXBlIGdyb3VwcwoKUmV0dXJuCiAgICAlVHlwZUdyb3VwTGlzdCA9ICgKICAgICAgICAwMDEgPT4gWwogICAgICAgICAgICAnTm9ybWFsJywKICAgICAgICAgICAgJ1BhcmVudENoaWxkJywKICAgICAgICBdLAogICAgICAgIDAwMiA9PiBbCiAgICAgICAgICAgICdOb3JtYWwnLAogICAgICAgICAgICAnRGVwZW5kc09uJywKICAgICAgICBdLAogICAgICAgIDAwMyA9PiBbCiAgICAgICAgICAgICdQYXJlbnRDaGlsZCcsCiAgICAgICAgICAgICdSZWxldmFudFRvJywKICAgICAgICBdLAogICAgKTsKCiAgICBteSAlVHlwZUdyb3VwTGlzdCA9ICRMaW5rT2JqZWN0LT5UeXBlR3JvdXBMaXN0KCk7Cgo9Y3V0CgpzdWIgVHlwZUdyb3VwTGlzdCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IHBvc3NpYmxlIHR5cGUgZ3JvdXBzCiAgICBteSAkVHlwZUdyb3VwTGlzdFJlZiA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnTGlua09iamVjdDo6VHlwZUdyb3VwJykgfHwge307CiAgICBteSAlVHlwZUdyb3VwTGlzdCA9ICV7JFR5cGVHcm91cExpc3RSZWZ9OwoKICAgICMgZ2V0IGNoZWNrIGl0ZW0gb2JqZWN0CiAgICBteSAkQ2hlY2tJdGVtT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNoZWNrSXRlbScpOwoKICAgICMgcHJlcGFyZSB0aGUgcG9zc2libGUgbGluayBsaXN0CiAgICBUWVBFR1JPVVA6CiAgICBmb3IgbXkgJFR5cGVHcm91cCAoIHNvcnQga2V5cyAlVHlwZUdyb3VwTGlzdCApIHsKCiAgICAgICAgIyBjaGVjayB0aGUgdHlwZXMKICAgICAgICBUWVBFOgogICAgICAgIGZvciBteSAkVHlwZSAoIEB7ICRUeXBlR3JvdXBMaXN0eyRUeXBlR3JvdXB9IH0gKSB7CgogICAgICAgICAgICAjIHNldCBlbXB0eSBzdHJpbmcgYXMgZGVmYXVsdCB2YWx1ZQogICAgICAgICAgICAkVHlwZSB8fD0gJyc7CgogICAgICAgICAgICAjIHRyaW0gdGhlIGFyZ3VtZW50CiAgICAgICAgICAgICRDaGVja0l0ZW1PYmplY3QtPlN0cmluZ0NsZWFuKAogICAgICAgICAgICAgICAgU3RyaW5nUmVmID0+IFwkVHlwZSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIG5leHQgVFlQRSBpZiAkVHlwZSAmJiAkVHlwZSAhfiBteyA6OiB9eG1zICYmICRUeXBlICF+IG17IFxzIH14bXM7CgogICAgICAgICAgICAjIGxvZyB0aGUgZXJyb3IKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICJUaGUgQXJndW1lbnQgJyRUeXBlJyBpcyBpbnZhbGlkIGluIFN5c0NvbmZpZyAoTGlua09iamVjdDo6VHlwZUdyb3VwKSEiLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyByZW1vdmUgZW50cnkgZnJvbSBsaXN0IGlmIGl0IGlzIGludmFsaWQKICAgICAgICAgICAgZGVsZXRlICRUeXBlR3JvdXBMaXN0eyRUeXBlR3JvdXB9OwoKICAgICAgICAgICAgbmV4dCBUWVBFR1JPVVA7CiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IHR5cGUgbGlzdAogICAgbXkgJVR5cGVMaXN0ID0gJFNlbGYtPlR5cGVMaXN0KCk7CgogICAgIyBjaGVjayB0eXBlcwogICAgVFlQRUdST1VQOgogICAgZm9yIG15ICRUeXBlR3JvdXAgKCBzb3J0IGtleXMgJVR5cGVHcm91cExpc3QgKSB7CgogICAgICAgICMgY2hlY2sgdGhlIHR5cGVzCiAgICAgICAgVFlQRToKICAgICAgICBmb3IgbXkgJFR5cGUgKCBAeyAkVHlwZUdyb3VwTGlzdHskVHlwZUdyb3VwfSB9ICkgewoKICAgICAgICAgICAgIyBzZXQgZW1wdHkgc3RyaW5nIGFzIGRlZmF1bHQgdmFsdWUKICAgICAgICAgICAgJFR5cGUgfHw9ICcnOwoKICAgICAgICAgICAgbmV4dCBUWVBFIGlmICRUeXBlTGlzdHskVHlwZX07CgogICAgICAgICAgICAjIGxvZyB0aGUgZXJyb3IKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICJUaGUgTGlua1R5cGUgJyRUeXBlJyBpcyBpbnZhbGlkIGluIFN5c0NvbmZpZyAoTGlua09iamVjdDo6VHlwZUdyb3VwKSEiLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyByZW1vdmUgZW50cnkgZnJvbSBsaXN0IGlmIHR5cGUgZG9lc24ndCBleGlzdAogICAgICAgICAgICBkZWxldGUgJFR5cGVHcm91cExpc3R7JFR5cGVHcm91cH07CgogICAgICAgICAgICBuZXh0IFRZUEVHUk9VUDsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuICVUeXBlR3JvdXBMaXN0Owp9Cgo9aXRlbSBQb3NzaWJsZVR5cGUoKQoKcmV0dXJuIHRydWUgaWYgYm90aCB0eXBlcyBhcmUgTk9UIHRvZ2V0aGVyIGluIGEgdHlwZSBncm91cAoKICAgIG15ICRUcnVlID0gJExpbmtPYmplY3QtPlBvc3NpYmxlVHlwZSgKICAgICAgICBUeXBlMSA9PiAnTm9ybWFsJywKICAgICAgICBUeXBlMiA9PiAnUGFyZW50Q2hpbGQnLAogICAgKTsKCj1jdXQKCnN1YiBQb3NzaWJsZVR5cGUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgZm9yIG15ICRBcmd1bWVudCAocXcoVHlwZTEgVHlwZTIpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyRBcmd1bWVudH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICRBcmd1bWVudCEiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IHR5cGUgZ3JvdXAgbGlzdAogICAgbXkgJVR5cGVHcm91cExpc3QgPSAkU2VsZi0+VHlwZUdyb3VwTGlzdCgpOwoKICAgICMgY2hlY2sgYWxsIHR5cGUgZ3JvdXBzCiAgICBUWVBFR1JPVVA6CiAgICBmb3IgbXkgJFR5cGVHcm91cCAoIHNvcnQga2V5cyAlVHlwZUdyb3VwTGlzdCApIHsKCiAgICAgICAgbXkgJVR5cGVMaXN0ID0gbWFwIHsgJF8gPT4gMSB9IEB7ICRUeXBlR3JvdXBMaXN0eyRUeXBlR3JvdXB9IH07CgogICAgICAgIHJldHVybiBpZiAkVHlwZUxpc3R7ICRQYXJhbXtUeXBlMX0gfSAmJiAkVHlwZUxpc3R7ICRQYXJhbXtUeXBlMn0gfTsKCiAgICB9CgogICAgcmV0dXJuIDE7Cn0KCj1pdGVtIFN0YXRlTG9va3VwKCkKCmxvb2t1cCBhIGxpbmsgc3RhdGUKCiAgICAkU3RhdGVJRCA9ICRMaW5rT2JqZWN0LT5TdGF0ZUxvb2t1cCgKICAgICAgICBOYW1lID0+ICdWYWxpZCcsCiAgICApOwoKICAgIG9yCgogICAgJE5hbWUgPSAkTGlua09iamVjdC0+U3RhdGVMb29rdXAoCiAgICAgICAgU3RhdGVJRCA9PiA1NiwKICAgICk7Cgo9Y3V0CgpzdWIgU3RhdGVMb29rdXAgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgaWYgKCAhJFBhcmFte1N0YXRlSUR9ICYmICEkUGFyYW17TmFtZX0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdOZWVkIFN0YXRlSUQgb3IgTmFtZSEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmICggJFBhcmFte1N0YXRlSUR9ICkgewoKICAgICAgICAjIGNoZWNrIGNhY2hlCiAgICAgICAgbXkgJENhY2hlS2V5ID0gJ1N0YXRlTG9va3VwOjpTdGF0ZUlEOjonIC4gJFBhcmFte1N0YXRlSUR9OwogICAgICAgIG15ICRDYWNoZSAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpLT5HZXQoCiAgICAgICAgICAgIFR5cGUgPT4gJFNlbGYtPntDYWNoZVR5cGV9LAogICAgICAgICAgICBLZXkgID0+ICRDYWNoZUtleSwKICAgICAgICApOwogICAgICAgIHJldHVybiAkQ2FjaGUgaWYgJENhY2hlOwoKICAgICAgICAjIGdldCBkYXRhYmFzZSBvYmplY3QKICAgICAgICBteSAkREJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6REInKTsKCiAgICAgICAgIyBhc2sgdGhlIGRhdGFiYXNlCiAgICAgICAgcmV0dXJuIGlmICEkREJPYmplY3QtPlByZXBhcmUoCiAgICAgICAgICAgIFNRTCA9PiAnCiAgICAgICAgICAgICAgICBTRUxFQ1QgbmFtZQogICAgICAgICAgICAgICAgRlJPTSBsaW5rX3N0YXRlCiAgICAgICAgICAgICAgICBXSEVSRSBpZCA9ID8nLAogICAgICAgICAgICBCaW5kICA9PiBbIFwkUGFyYW17U3RhdGVJRH0gXSwKICAgICAgICAgICAgTGltaXQgPT4gMSwKICAgICAgICApOwoKICAgICAgICAjIGZldGNoIHRoZSByZXN1bHQKICAgICAgICBteSAkTmFtZTsKICAgICAgICB3aGlsZSAoIG15IEBSb3cgPSAkREJPYmplY3QtPkZldGNocm93QXJyYXkoKSApIHsKICAgICAgICAgICAgJE5hbWUgPSAkUm93WzBdOwogICAgICAgIH0KCiAgICAgICAgIyBjaGVjayB0aGUgbmFtZQogICAgICAgIGlmICggISROYW1lICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTGluayBzdGF0ZSBpZCAnJFBhcmFte1N0YXRlSUR9JyBub3QgZm91bmQgaW4gdGhlIGRhdGFiYXNlISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgc2V0IGNhY2hlCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyktPlNldCgKICAgICAgICAgICAgVHlwZSAgPT4gJFNlbGYtPntDYWNoZVR5cGV9LAogICAgICAgICAgICBUVEwgICA9PiAkU2VsZi0+e0NhY2hlVFRMfSwKICAgICAgICAgICAgS2V5ICAgPT4gJENhY2hlS2V5LAogICAgICAgICAgICBWYWx1ZSA9PiAkTmFtZSwKICAgICAgICApOwoKICAgICAgICByZXR1cm4gJE5hbWU7CiAgICB9CiAgICBlbHNlIHsKCiAgICAgICAgIyBjaGVjayBjYWNoZQogICAgICAgIG15ICRDYWNoZUtleSA9ICdTdGF0ZUxvb2t1cDo6TmFtZTo6JyAuICRQYXJhbXtOYW1lfTsKICAgICAgICBteSAkQ2FjaGUgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKS0+R2V0KAogICAgICAgICAgICBUeXBlID0+ICRTZWxmLT57Q2FjaGVUeXBlfSwKICAgICAgICAgICAgS2V5ICA9PiAkQ2FjaGVLZXksCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gJENhY2hlIGlmICRDYWNoZTsKCiAgICAgICAgIyBnZXQgZGF0YWJhc2Ugb2JqZWN0CiAgICAgICAgbXkgJERCT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkRCJyk7CgogICAgICAgICMgYXNrIHRoZSBkYXRhYmFzZQogICAgICAgIHJldHVybiBpZiAhJERCT2JqZWN0LT5QcmVwYXJlKAogICAgICAgICAgICBTUUwgPT4gJwogICAgICAgICAgICAgICAgU0VMRUNUIGlkCiAgICAgICAgICAgICAgICBGUk9NIGxpbmtfc3RhdGUKICAgICAgICAgICAgICAgIFdIRVJFIG5hbWUgPSA/JywKICAgICAgICAgICAgQmluZCAgPT4gWyBcJFBhcmFte05hbWV9IF0sCiAgICAgICAgICAgIExpbWl0ID0+IDEsCiAgICAgICAgKTsKCiAgICAgICAgIyBmZXRjaCB0aGUgcmVzdWx0CiAgICAgICAgbXkgJFN0YXRlSUQ7CiAgICAgICAgd2hpbGUgKCBteSBAUm93ID0gJERCT2JqZWN0LT5GZXRjaHJvd0FycmF5KCkgKSB7CiAgICAgICAgICAgICRTdGF0ZUlEID0gJFJvd1swXTsKICAgICAgICB9CgogICAgICAgICMgY2hlY2sgdGhlIHN0YXRlIGlkCiAgICAgICAgaWYgKCAhJFN0YXRlSUQgKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJMaW5rIHN0YXRlICckUGFyYW17TmFtZX0nIG5vdCBmb3VuZCBpbiB0aGUgZGF0YWJhc2UhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBzZXQgY2FjaGUKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKS0+U2V0KAogICAgICAgICAgICBUeXBlICA9PiAkU2VsZi0+e0NhY2hlVHlwZX0sCiAgICAgICAgICAgIFRUTCAgID0+ICRTZWxmLT57Q2FjaGVUVEx9LAogICAgICAgICAgICBLZXkgICA9PiAkQ2FjaGVLZXksCiAgICAgICAgICAgIFZhbHVlID0+ICRTdGF0ZUlELAogICAgICAgICk7CgogICAgICAgIHJldHVybiAkU3RhdGVJRDsKICAgIH0KfQoKPWl0ZW0gU3RhdGVMaXN0KCkKCnJldHVybiBhIGhhc2ggbGlzdCBvZiBhbGwgdmFsaWQgbGluayBzdGF0ZXMKClJldHVybgogICAgJFN0YXRlTGlzdHsKICAgICAgICA0ID0+ICdWYWxpZCcsCiAgICAgICAgOCA9PiAnVGVtcG9yYXJ5JywKICAgIH0KCiAgICBteSAlU3RhdGVMaXN0ID0gJExpbmtPYmplY3QtPlN0YXRlTGlzdCgKICAgICAgICBWYWxpZCA9PiAwLCAgICMgKG9wdGlvbmFsKSBkZWZhdWx0IDEgKDB8MSkKICAgICk7Cgo9Y3V0CgpzdWIgU3RhdGVMaXN0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBzZXQgdmFsaWQgcGFyYW0KICAgIGlmICggIWRlZmluZWQgJFBhcmFte1ZhbGlkfSApIHsKICAgICAgICAkUGFyYW17VmFsaWR9ID0gMTsKICAgIH0KCiAgICAjIGFkZCB2YWxpZCBwYXJ0CiAgICBteSAkU1FMV2hlcmUgPSAnJzsKICAgIGlmICggJFBhcmFte1ZhbGlkfSApIHsKCiAgICAgICAgIyBjcmVhdGUgdGhlIHZhbGlkIGlkIHN0cmluZwogICAgICAgIG15ICRWYWxpZElEcyA9IGpvaW4gJywgJywgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlZhbGlkJyktPlZhbGlkSURzR2V0KCk7CgogICAgICAgICRTUUxXaGVyZSA9ICJXSEVSRSB2YWxpZF9pZCBJTiAoICRWYWxpZElEcyApIjsKICAgIH0KCiAgICAjIGdldCBkYXRhYmFzZSBvYmplY3QKICAgIG15ICREQk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwoKICAgICMgYXNrIGRhdGFiYXNlCiAgICByZXR1cm4gaWYgISREQk9iamVjdC0+UHJlcGFyZSgKICAgICAgICBTUUwgPT4gIlNFTEVDVCBpZCwgbmFtZSBGUk9NIGxpbmtfc3RhdGUgJFNRTFdoZXJlIiwKICAgICk7CgogICAgIyBmZXRjaCB0aGUgcmVzdWx0CiAgICBteSAlU3RhdGVMaXN0OwogICAgd2hpbGUgKCBteSBAUm93ID0gJERCT2JqZWN0LT5GZXRjaHJvd0FycmF5KCkgKSB7CiAgICAgICAgJFN0YXRlTGlzdHsgJFJvd1swXSB9ID0gJFJvd1sxXTsKICAgIH0KCiAgICByZXR1cm4gJVN0YXRlTGlzdDsKfQoKPWl0ZW0gT2JqZWN0UGVybWlzc2lvbigpCgpjaGVja3MgcmVhZCBwZXJtaXNzaW9uIGZvciBhIGdpdmVuIG9iamVjdCBhbmQgVXNlcklELgoKICAgICRQZXJtaXNzaW9uID0gJExpbmtPYmplY3QtPk9iamVjdFBlcm1pc3Npb24oCiAgICAgICAgT2JqZWN0ICA9PiAnVGlja2V0JywKICAgICAgICBLZXkgICAgID0+IDEyMywKICAgICAgICBVc2VySUQgID0+IDEsCiAgICApOwoKPWN1dAoKc3ViIE9iamVjdFBlcm1pc3Npb24gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgZm9yIG15ICRBcmd1bWVudCAocXcoT2JqZWN0IEtleSBVc2VySUQpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyRBcmd1bWVudH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICRBcmd1bWVudCEiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IGJhY2tlbmQgb2JqZWN0CiAgICBteSAkQmFja2VuZE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoICdLZXJuZWw6OlN5c3RlbTo6TGlua09iamVjdDo6JyAuICRQYXJhbXtPYmplY3R9ICk7CgogICAgcmV0dXJuICAgaWYgISRCYWNrZW5kT2JqZWN0OwogICAgcmV0dXJuIDEgaWYgISRCYWNrZW5kT2JqZWN0LT5jYW4oJ09iamVjdFBlcm1pc3Npb24nKTsKCiAgICByZXR1cm4gJEJhY2tlbmRPYmplY3QtPk9iamVjdFBlcm1pc3Npb24oCiAgICAgICAgJVBhcmFtLAogICAgKTsKfQoKPWl0ZW0gT2JqZWN0RGVzY3JpcHRpb25HZXQoKQoKcmV0dXJuIGEgaGFzaCBvZiBvYmplY3QgZGVzY3JpcHRpb25zCgpSZXR1cm4KICAgICVEZXNjcmlwdGlvbiA9ICgKICAgICAgICBOb3JtYWwgPT4gJycsCiAgICAgICAgTG9uZyAgID0+ICcnLAogICAgKTsKCiAgICAlRGVzY3JpcHRpb24gPSAkTGlua09iamVjdC0+T2JqZWN0RGVzY3JpcHRpb25HZXQoCiAgICAgICAgT2JqZWN0ICA9PiAnVGlja2V0JywKICAgICAgICBLZXkgICAgID0+IDEyMywKICAgICAgICBVc2VySUQgID0+IDEsCiAgICApOwoKPWN1dAoKc3ViIE9iamVjdERlc2NyaXB0aW9uR2V0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGZvciBteSAkQXJndW1lbnQgKHF3KE9iamVjdCBLZXkgVXNlcklEKSkgewogICAgICAgIGlmICggISRQYXJhbXskQXJndW1lbnR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkQXJndW1lbnQhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCBiYWNrZW5kIG9iamVjdAogICAgbXkgJEJhY2tlbmRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCAnS2VybmVsOjpTeXN0ZW06OkxpbmtPYmplY3Q6OicgLiAkUGFyYW17T2JqZWN0fSApOwoKICAgIHJldHVybiBpZiAhJEJhY2tlbmRPYmplY3Q7CgogICAgIyBnZXQgb2JqZWN0IGRlc2NyaXB0aW9uCiAgICBteSAlRGVzY3JpcHRpb24gPSAkQmFja2VuZE9iamVjdC0+T2JqZWN0RGVzY3JpcHRpb25HZXQoCiAgICAgICAgJVBhcmFtLAogICAgKTsKCiAgICByZXR1cm4gJURlc2NyaXB0aW9uOwp9Cgo9aXRlbSBPYmplY3RTZWFyY2goKQoKcmV0dXJuIGEgaGFzaCByZWZlcmVuY2Ugb2YgdGhlIHNlYXJjaCByZXN1bHRzCgpSZXR1cm4KICAgICRPYmplY3RMaXN0ID0gewogICAgICAgIFRpY2tldCA9PiB7CiAgICAgICAgICAgIE5PVExJTktFRCA9PiB7CiAgICAgICAgICAgICAgICBTb3VyY2UgPT4gewogICAgICAgICAgICAgICAgICAgIDEyICA9PiAkRGF0YU9mSXRlbTEyLAogICAgICAgICAgICAgICAgICAgIDIxMiA9PiAkRGF0YU9mSXRlbTIxMiwKICAgICAgICAgICAgICAgICAgICAzMzIgPT4gJERhdGFPZkl0ZW0zMzIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgIH0sCiAgICB9OwoKICAgICRPYmplY3RMaXN0ID0gJExpbmtPYmplY3QtPk9iamVjdFNlYXJjaCgKICAgICAgICBPYmplY3QgICAgICAgPT4gJ0lUU01Db25maWdJdGVtJywKICAgICAgICBTdWJPYmplY3QgICAgPT4gJ0NvbXB1dGVyJyAgICAgICAgICMgKG9wdGlvbmFsKQogICAgICAgIFNlYXJjaFBhcmFtcyA9PiAkSGFzaFJlZiwgICAgICAgICAgIyAob3B0aW9uYWwpCiAgICAgICAgVXNlcklEICAgICAgID0+IDEsCiAgICApOwoKPWN1dAoKc3ViIE9iamVjdFNlYXJjaCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgbXkgJEFyZ3VtZW50IChxdyhPYmplY3QgVXNlcklEKSkgewogICAgICAgIGlmICggISRQYXJhbXskQXJndW1lbnR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkQXJndW1lbnQhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCBiYWNrZW5kIG9iamVjdAogICAgbXkgJEJhY2tlbmRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCAnS2VybmVsOjpTeXN0ZW06OkxpbmtPYmplY3Q6OicgLiAkUGFyYW17T2JqZWN0fSApOwoKICAgIHJldHVybiBpZiAhJEJhY2tlbmRPYmplY3Q7CgogICAgIyBzZWFyY2ggb2JqZWN0cwogICAgbXkgJFNlYXJjaExpc3QgPSAkQmFja2VuZE9iamVjdC0+T2JqZWN0U2VhcmNoKAogICAgICAgICVQYXJhbSwKICAgICk7CgogICAgbXkgJU9iamVjdExpc3Q7CiAgICAkT2JqZWN0TGlzdHsgJFBhcmFte09iamVjdH0gfSA9ICRTZWFyY2hMaXN0OwoKICAgIHJldHVybiBcJU9iamVjdExpc3Q7Cn0KCjE7Cgo9YmFjawoKPWhlYWQxIFRFUk1TIEFORCBDT05ESVRJT05TCgpUaGlzIHNvZnR3YXJlIGlzIHBhcnQgb2YgdGhlIE9UUlMgcHJvamVjdCAoTDxodHRwOi8vb3Rycy5vcmcvPikuCgpUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQp0aGUgZW5jbG9zZWQgZmlsZSBDT1BZSU5HIGZvciBsaWNlbnNlIGluZm9ybWF0aW9uIChBR1BMKS4gSWYgeW91CmRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBMPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9hZ3BsLnR4dD4uCgo9Y3V0Cg==</File>
        <File Location="KIXCore/Kernel/System/Loader.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDE2IE9UUlMgQUcsIGh0dHA6Ly9vdHJzLmNvbS8KIyBLSVhDb3JlLUV4dGVuc2lvbnMgQ29weXJpZ2h0IChDKSAyMDA2LTIwMTYgYy5hLnAuZS4gSVQgR21iSCwgaHR0cDovL3d3dy5jYXBlLWl0LmRlCiMKIyB3cml0dGVuL2VkaXRlZCBieToKIyAqIFJlbmUoZG90KUJvZWhtKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIERvcm90aGVhKGRvdClEb2VyZmZlbChhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMgLS0KIyAkSWQ6IExvYWRlci5wbSx2IDEuMTIgMjAxNi8wMS8yMCAxMzo0NDo0MCBkZG9lcmZmZWwgRXhwICQKIyAtLQojIFRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCiMgdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoQUdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvYWdwbC50eHQuCiMgLS0KCnBhY2thZ2UgS2VybmVsOjpTeXN0ZW06OkxvYWRlcjsKCnVzZSBzdHJpY3Q7CnVzZSB3YXJuaW5nczsKCiMgS0lYNE9UUlMtY2FwZUlUCnVzZSB2YXJzIHF3KEBJU0EpOwp1c2UgRmlsZTo6RmluZDsKCiMgRU8gS0lYNE9UUlMtY2FwZUlUCgp1c2UgQ1NTOjpNaW5pZmllciBxdygpOwp1c2UgSmF2YVNjcmlwdDo6TWluaWZpZXIgcXcoKTsKCm91ciBAT2JqZWN0RGVwZW5kZW5jaWVzID0gKAogICAgJ0tlcm5lbDo6Q29uZmlnJywKICAgICdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0JywKICAgICdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpMb2cnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpNYWluJywKKTsKCj1oZWFkMSBOQU1FCgpLZXJuZWw6OlN5c3RlbTo6TG9hZGVyIC0gQ1NTL0phdmFTY3JpcHQgbG9hZGVyIGJhY2tlbmQKCj1oZWFkMSBTWU5PUFNJUwoKQWxsIHZhbGlkIGZ1bmN0aW9ucy4KCj1oZWFkMSBQVUJMSUMgSU5URVJGQUNFCgo9b3ZlciA0Cgo9Y3V0Cgo9aXRlbSBuZXcoKQoKY3JlYXRlIGFuIG9iamVjdAoKICAgIHVzZSBLZXJuZWw6OlN5c3RlbTo6T2JqZWN0TWFuYWdlcjsKICAgIGxvY2FsICRLZXJuZWw6Ok9NID0gS2VybmVsOjpTeXN0ZW06Ok9iamVjdE1hbmFnZXItPm5ldygpOwogICAgbXkgJExvYWRlck9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2FkZXInKTsKCj1jdXQKCnN1YiBuZXcgewogICAgbXkgKCAkVHlwZSwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGFsbG9jYXRlIG5ldyBoYXNoIGZvciBvYmplY3QKICAgIG15ICRTZWxmID0ge307CiAgICBibGVzcyggJFNlbGYsICRUeXBlICk7CgogICAgJFNlbGYtPntDYWNoZVR5cGV9ID0gJ0xvYWRlcic7CiAgICAkU2VsZi0+e0NhY2hlVFRMfSAgPSA2MCAqIDYwICogMjQgKiAyMDsKCiAgICByZXR1cm4gJFNlbGY7Cn0KCj1pdGVtIE1pbmlmeUZpbGVzKCkKCnRha2VzIGEgbGlzdCBvZiBmaWxlcyBhbmQgcmV0dXJucyBhIGZpbGVuYW1lIGluIHRoZSB0YXJnZXQgZGlyZWN0b3J5CndoaWNoIGhvbGRzIHRoZSBtaW5pZmllZCBhbmQgY29uY2F0ZW5hdGVkIGNvbnRlbnQgb2YgdGhlIGZpbGVzLgpVc2VzIGNhY2hpbmcgaW50ZXJuYWxseS4KCiAgICBteSAkVGFyZ2V0RmlsZW5hbWUgPSAkTG9hZGVyT2JqZWN0LT5NaW5pZnlGaWxlcygKICAgICAgICBMaXN0ICA9PiBbCiAgICAgICAgICAgICRGaWxlbmFtZSwKICAgICAgICAgICAgJEZpbGVuYW1lMiwKICAgICAgICBdLAogICAgICAgIFR5cGUgICAgICAgICAgICAgICAgID0+ICdDU1MnLCAgICAgICMgQ1NTIHwgSmF2YVNjcmlwdAogICAgICAgIFRhcmdldERpcmVjdG9yeSAgICAgID0+ICRUYXJnZXREaXJlY3RvcnksCiAgICAgICAgVGFyZ2V0RmlsZW5hbWVQcmVmaXggPT4gJ0NvbW1vbkNTUycsICAgICMgb3B0aW9uYWwsIHByZWZpeCBmb3IgdGhlIHRhcmdldCBmaWxlbmFtZQogICAgKTsKCj1jdXQKCnN1YiBNaW5pZnlGaWxlcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHBhcmFtcwogICAgbXkgJExpc3QgPSAkUGFyYW17TGlzdH07CiAgICBpZiAoIHJlZiAkTGlzdCBuZSAnQVJSQVknIHx8ICFAeyRMaXN0fSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgTGlzdCEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIG15ICRUYXJnZXREaXJlY3RvcnkgPSAkUGFyYW17VGFyZ2V0RGlyZWN0b3J5fTsKICAgIGlmICggIS1lICRUYXJnZXREaXJlY3RvcnkgKSB7CiAgICAgICAgaWYgKCAhbWtkaXIoICRUYXJnZXREaXJlY3RvcnksIDA3NzUgKSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkNhbid0IGNyZWF0ZSBkaXJlY3RvcnkgJyRUYXJnZXREaXJlY3RvcnknOiAkISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgaWYgKCAhJFRhcmdldERpcmVjdG9yeSB8fCAhLWQgJFRhcmdldERpcmVjdG9yeSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5lZWQgdmFsaWQgVGFyZ2V0RGlyZWN0b3J5LCBnb3QgJyRUYXJnZXREaXJlY3RvcnknISIsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbXkgJFRhcmdldEZpbGVuYW1lUHJlZml4ID0gJFBhcmFte1RhcmdldEZpbGVuYW1lUHJlZml4fSA/ICIkUGFyYW17VGFyZ2V0RmlsZW5hbWVQcmVmaXh9XyIgOiAnJzsKCiAgICBteSAlVmFsaWRUeXBlUGFyYW1zID0gKAogICAgICAgIENTUyAgICAgICAgPT4gMSwKICAgICAgICBKYXZhU2NyaXB0ID0+IDEsCiAgICApOwoKICAgIGlmICggISRQYXJhbXtUeXBlfSB8fCAhJFZhbGlkVHlwZVBhcmFtc3sgJFBhcmFte1R5cGV9IH0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkIFR5cGUhIE11c3QgYmUgb25lIG9mICciIC4gam9pbiggJywgJywga2V5cyAlVmFsaWRUeXBlUGFyYW1zICkgLiAiJy4iCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbXkgJE1haW5PYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpOwoKICAgIG15ICRGaWxlU3RyaW5nOwogICAgTE9DQVRJT046CiAgICBmb3IgbXkgJExvY2F0aW9uICggQHskTGlzdH0gKSB7CiAgICAgICAgaWYgKCAhLWUgJExvY2F0aW9uICkgewogICAgICAgICAgICBuZXh0IExPQ0FUSU9OOwogICAgICAgIH0KICAgICAgICBteSAkRmlsZU1UaW1lID0gJE1haW5PYmplY3QtPkZpbGVHZXRNVGltZSgKICAgICAgICAgICAgTG9jYXRpb24gPT4gJExvY2F0aW9uCiAgICAgICAgKTsKCiAgICAgICAgIyBGb3IgdGhlIGNhY2hpbmcsIHVzZSBib3RoIGZpbGVuYW1lIGFuZCBtdGltZSB0byBtYWtlIHN1cmUgdGhhdAogICAgICAgICMgICBjYWNoZXMgYXJlIGNvcnJlY3RseSByZWdlbmVyYXRlZCBvbiBjaGFuZ2VzLgogICAgICAgICRGaWxlU3RyaW5nIC49ICIkTG9jYXRpb246JEZpbGVNVGltZToiOwogICAgfQoKICAgIG15ICRGaWxlbmFtZSA9ICRUYXJnZXRGaWxlbmFtZVByZWZpeCAuICRNYWluT2JqZWN0LT5NRDVzdW0oCiAgICAgICAgU3RyaW5nID0+IFwkRmlsZVN0cmluZywKICAgICk7CgogICAgaWYgKCAkUGFyYW17VHlwZX0gZXEgJ0NTUycgKSB7CiAgICAgICAgJEZpbGVuYW1lIC49ICcuY3NzJzsKICAgIH0KICAgIGVsc2lmICggJFBhcmFte1R5cGV9IGVxICdKYXZhU2NyaXB0JyApIHsKICAgICAgICAkRmlsZW5hbWUgLj0gJy5qcyc7CgogICAgfQoKICAgIGlmICggIS1yICIkVGFyZ2V0RGlyZWN0b3J5LyRGaWxlbmFtZSIgKSB7CgogICAgICAgIG15ICRDb250ZW50OwoKICAgICAgICAjIG5vIGNhY2hlIGF2YWlsYWJsZSwgc28gbG9vcCB0aHJvdWdoIGFsbCBmaWxlcywgZ2V0IG1pbmlmaWVkIHZlcnNpb24gYW5kIGNvbmNhdGVuYXRlCiAgICAgICAgTE9DQVRJT046IGZvciBteSAkTG9jYXRpb24gKCBAeyRMaXN0fSApIHsKCiAgICAgICAgICAgIG5leHQgTE9DQVRJT04gaWYgKCAhLXIgJExvY2F0aW9uICk7CgogICAgICAgICAgICAjIGN1dCBvdXQgdGhlIHN5c3RlbSBzcGVjaWZpYyBwYXJ0cyBmb3IgdGhlIGNvbW1lbnRzIChmb3IgZWFzaWVyIHRlc3RpbmcpCiAgICAgICAgICAgICMgZm9yIG5vdywgb25seSBrZWVwIGZpbGVuYW1lCiAgICAgICAgICAgIG15ICRMYWJlbCA9ICRMb2NhdGlvbjsKICAgICAgICAgICAgJExhYmVsID1+IHN7Xi4qL317fXNteDsKCiAgICAgICAgICAgIGlmICggJFBhcmFte1R5cGV9IGVxICdDU1MnICkgewoKICAgICAgICAgICAgICAgIGV2YWwgewogICAgICAgICAgICAgICAgICAgICRDb250ZW50IC49ICRTZWxmLT5HZXRNaW5pZmllZEZpbGUoCiAgICAgICAgICAgICAgICAgICAgICAgIExvY2F0aW9uID0+ICRMb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgVHlwZSAgICAgPT4gJFBhcmFte1R5cGV9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIGlmICgkQCkgewogICAgICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiRXJyb3IgZHVyaW5nIGZpbGUgbWluaWZpY2F0aW9uOiAkQCIsCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkQ29udGVudCAuPSAiXG4iOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2lmICggJFBhcmFte1R5cGV9IGVxICdKYXZhU2NyaXB0JyApIHsKCiAgICAgICAgICAgICAgICBldmFsIHsKICAgICAgICAgICAgICAgICAgICAkQ29udGVudCAuPSAkU2VsZi0+R2V0TWluaWZpZWRGaWxlKAogICAgICAgICAgICAgICAgICAgICAgICBMb2NhdGlvbiA9PiAkTG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIFR5cGUgICAgID0+ICRQYXJhbXtUeXBlfSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBpZiAoJEApIHsKICAgICAgICAgICAgICAgICAgICBteSAkSlNFcnJvciA9ICJFcnJvciBkdXJpbmcgbWluaWZpY2F0aW9uIG9mIGZpbGUgJExvY2F0aW9uOiAkQCI7CiAgICAgICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICRKU0Vycm9yLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgJEpTRXJyb3IgPX4gcy8nL1xcJy9nc214OwogICAgICAgICAgICAgICAgICAgICRKU0Vycm9yID1+IHMvXHI/XG4vIC9nc214OwogICAgICAgICAgICAgICAgICAgICRDb250ZW50IC49ICJhbGVydCgnJEpTRXJyb3InKTsiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJENvbnRlbnQgLj0gIlxuIjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbXkgJEZpbGVMb2NhdGlvbiA9ICRNYWluT2JqZWN0LT5GaWxlV3JpdGUoCiAgICAgICAgICAgIERpcmVjdG9yeSA9PiAkVGFyZ2V0RGlyZWN0b3J5LAogICAgICAgICAgICBGaWxlbmFtZSAgPT4gJEZpbGVuYW1lLAogICAgICAgICAgICBDb250ZW50ICAgPT4gXCRDb250ZW50LAogICAgICAgICk7CiAgICB9CgogICAgcmV0dXJuICRGaWxlbmFtZTsKfQoKPWl0ZW0gR2V0TWluaWZpZWRGaWxlKCkKCnJldHVybnMgdGhlIG1pbmlmaWVkIGNvbnRlbnRzIG9mIGEgZ2l2ZW4gQ1NTIG9yIEphdmFTY3JpcHQgZmlsZS4KVXNlcyBjYWNoaW5nIGludGVybmFsbHkuCgogICAgbXkgJE1pbmlmaWVkQ1NTID0gJExvYWRlck9iamVjdC0+R2V0TWluaWZpZWRGaWxlKAogICAgICAgIExvY2F0aW9uID0+ICRGaWxlbmFtZSwKICAgICAgICBUeXBlICAgICA9PiAnQ1NTJywgICAgICAjIENTUyB8IEphdmFTY3JpcHQKICAgICk7CgpXYXJuaW5nOiB0aGlzIGZ1bmN0aW9uIG1heSBjYXVzZSBhIGRpZSgpIGlmIHRoZXJlIGFyZSBlcnJvcnMgaW4gdGhlIGZpbGUsCnByb3RlY3QgYWdhaW5zdCB0aGF0IHdpdGggZXZhbCgpLgoKPWN1dAoKc3ViIEdldE1pbmlmaWVkRmlsZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHBhcmFtcwogICAgbXkgJExvY2F0aW9uID0gJFBhcmFte0xvY2F0aW9ufTsKICAgIGlmICggISRMb2NhdGlvbiApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgTG9jYXRpb24hJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBteSAlVmFsaWRUeXBlUGFyYW1zID0gKAogICAgICAgIENTUyAgICAgICAgPT4gMSwKICAgICAgICBKYXZhU2NyaXB0ID0+IDEsCiAgICApOwoKICAgIGlmICggISRQYXJhbXtUeXBlfSB8fCAhJFZhbGlkVHlwZVBhcmFtc3sgJFBhcmFte1R5cGV9IH0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkIFR5cGUhIE11c3QgYmUgb25lIG9mICciIC4gam9pbiggJywgJywga2V5cyAlVmFsaWRUeXBlUGFyYW1zICkgLiAiJy4iCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbXkgJE1haW5PYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpOwoKICAgIG15ICRGaWxlTVRpbWUgPSAkTWFpbk9iamVjdC0+RmlsZUdldE1UaW1lKAogICAgICAgIExvY2F0aW9uID0+ICRMb2NhdGlvbiwKICAgICk7CgogICAgIyBGb3IgdGhlIGNhY2hpbmcsIHVzZSBib3RoIGZpbGVuYW1lIGFuZCBtdGltZSB0byBtYWtlIHN1cmUgdGhhdAogICAgIyAgIGNhY2hlcyBhcmUgY29ycmVjdGx5IHJlZ2VuZXJhdGVkIG9uIGNoYW5nZXMuCiAgICBteSAkQ2FjaGVLZXkgPSAiJExvY2F0aW9uOiRGaWxlTVRpbWUiOwoKICAgICMgY2hlY2sgaWYgYSBjYWNoZWQgdmVyc2lvbiBleGlzdHMKICAgIG15ICRDYWNoZUNvbnRlbnQgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKS0+R2V0KAogICAgICAgIFR5cGUgPT4gJFNlbGYtPntDYWNoZVR5cGV9LAogICAgICAgIEtleSAgPT4gJENhY2hlS2V5LAogICAgKTsKCiAgICBpZiAoIHJlZiAkQ2FjaGVDb250ZW50IGVxICdTQ0FMQVInICkgewogICAgICAgIHJldHVybiAkeyRDYWNoZUNvbnRlbnR9OwogICAgfQoKICAgICMgbm8gY2FjaGUgYXZhaWxhYmxlLCByZWFkIGFuZCBtaW5pZnkgZmlsZQogICAgbXkgJEZpbGVDb250ZW50cyA9ICRNYWluT2JqZWN0LT5GaWxlUmVhZCgKICAgICAgICBMb2NhdGlvbiA9PiAkTG9jYXRpb24sCgogICAgICAgICMgSXQgd291bGQgYmUgbW9yZSBjb3JyZWN0IHRvIHVzZSBVVEY4IG1vZGUsIGJ1dCB0aGVuIHRoZSBKYXZhU2NyaXB0OjpNaW5pZmllcgogICAgICAgICMgICB3aWxsIGNhdXNlIHRpbWVvdXRzIGR1ZSB0byBleHRyZW1lIHNsb3duZXNzIG9uIHNvbWUgVVQgc2VydmVycy4gRGlzYWJsZSBmb3Igbm93LgogICAgICAgICMgICBVbmljb2RlIGluIHRoZSBmaWxlcyBzdGlsbCB3b3JrcyBjb3JyZWN0bHkuCiAgICAgICAgI01vZGUgICAgID0+ICd1dGY4JywKICAgICk7CgogICAgaWYgKCByZWYgJEZpbGVDb250ZW50cyBuZSAnU0NBTEFSJyApIHsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbXkgJFJlc3VsdDsKICAgIGlmICggJFBhcmFte1R5cGV9IGVxICdDU1MnICkgewogICAgICAgICRSZXN1bHQgPSAkU2VsZi0+TWluaWZ5Q1NTKCBDb2RlID0+ICQkRmlsZUNvbnRlbnRzICk7CiAgICB9CiAgICBlbHNpZiAoICRQYXJhbXtUeXBlfSBlcSAnSmF2YVNjcmlwdCcgKSB7CiAgICAgICAgJFJlc3VsdCA9ICRTZWxmLT5NaW5pZnlKYXZhU2NyaXB0KCBDb2RlID0+ICQkRmlsZUNvbnRlbnRzICk7CiAgICB9CgogICAgIyBhbmQgcHV0IGl0IGluIHRoZSBjYWNoZQogICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyktPlNldCgKICAgICAgICBUeXBlICA9PiAkU2VsZi0+e0NhY2hlVHlwZX0sCiAgICAgICAgVFRMICAgPT4gJFNlbGYtPntDYWNoZVRUTH0sCiAgICAgICAgS2V5ICAgPT4gJENhY2hlS2V5LAogICAgICAgIFZhbHVlID0+IFwkUmVzdWx0LAogICAgKTsKCiAgICByZXR1cm4gJFJlc3VsdDsKfQoKPWl0ZW0gTWluaWZ5Q1NTKCkKCnJldHVybnMgYSBtaW5pZmllZCB2ZXJzaW9uIG9mIHRoZSBnaXZlbiBDU1MgQ29kZQoKICAgIG15ICRNaW5pZmllZENTUyA9ICRMb2FkZXJPYmplY3QtPk1pbmlmeUNTUyggQ29kZSA9PiAkQ1NTICk7CgpXYXJuaW5nOiB0aGlzIGZ1bmN0aW9uIG1heSBjYXVzZSBhIGRpZSgpIGlmIHRoZXJlIGFyZSBlcnJvcnMgaW4gdGhlIGZpbGUsCnByb3RlY3QgYWdhaW5zdCB0aGF0IHdpdGggZXZhbCgpLgoKPWN1dAoKc3ViIE1pbmlmeUNTUyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHBhcmFtcwogICAgaWYgKCAhJFBhcmFte0NvZGV9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnTmVlZCBDb2RlIFBhcmFtIScsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbXkgJFJlc3VsdCA9IENTUzo6TWluaWZpZXI6Om1pbmlmeSggaW5wdXQgPT4gJFBhcmFte0NvZGV9ICk7CgogICAgIyBhIGZldyBvcHRpbWl6YXRpb25zIGNhbiBiZSBtYWRlIGZvciB0aGUgbWluaWZpZWQgQ1NTIHRoYXQgQ1NTOjpNaW5pZmllciBkb2Vzbid0IHlldCBkbwoKICAgICMgcmVtb3ZlIHJlbWFpbmluZyBsaW5lYnJlYWtzCiAgICAkUmVzdWx0ID1+IHMvXHI/XG5ccyovL3NteGc7CgogICAgIyByZW1vdmUgc3VwZXJmbHVvdXMgd2hpdGVzcGFjZSBhZnRlciBjb21tYXMgaW4gY2hhaW5lZCBzZWxlY3RvcnMKICAgICRSZXN1bHQgPX4gcy8sXHMqLywvc214ZzsKCiAgICByZXR1cm4gJFJlc3VsdDsKfQoKPWl0ZW0gTWluaWZ5SmF2YVNjcmlwdCgpCgpyZXR1cm5zIGEgbWluaWZpZWQgdmVyc2lvbiBvZiB0aGUgZ2l2ZW4gSmF2YVNjcmlwdCBDb2RlLgoKICAgIG15ICRNaW5pZmllZEpTID0gJExvYWRlck9iamVjdC0+TWluaWZ5SmF2YVNjcmlwdCggQ29kZSA9PiAkSmF2YVNjcmlwdCApOwoKV2FybmluZzogdGhpcyBmdW5jdGlvbiBtYXkgY2F1c2UgYSBkaWUoKSBpZiB0aGVyZSBhcmUgZXJyb3JzIGluIHRoZSBmaWxlLApwcm90ZWN0IGFnYWluc3QgdGhhdCB3aXRoIGV2YWwoKS4KClRoaXMgZnVuY3Rpb24gaW50ZXJuYWxseSB1c2VzIHRoZSBDUEFOIG1vZHVsZSBKYXZhU2NyaXB0OjpNaW5pZmllci4KQXMgb2YgdmVyc2lvbiAxLjA1IG9mIHRoYXQgbW9kdWxlLCB0aGVyZSBpcyBhbiBpc3N1ZSB3aXRoIHJlZ3VsYXIgZXhwcmVzc2lvbnM6CgpUaGlzIHdpbGwgY2F1c2UgYSBkaWU6CgogICAgZnVuY3Rpb24gdGVzdChzKSB7IHJldHVybiAvXGR7MSwyfS8udGVzdChzKTsgfQoKQSB3b3JrYXJvdW5kIGlzIHRvIGVuY2xvc2UgdGhlIHJlZ3VsYXIgZXhwcmVzc2lvbiBpbiBwYXJlbnRoZXNlczoKCiAgICBmdW5jdGlvbiB0ZXN0KHMpIHsgcmV0dXJuICgvXGR7MSwyfS8pLnRlc3Qocyk7IH0KCj1jdXQKCnN1YiBNaW5pZnlKYXZhU2NyaXB0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgcGFyYW1zCiAgICBpZiAoICEkUGFyYW17Q29kZX0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdOZWVkIENvZGUgUGFyYW0hJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICByZXR1cm4gSmF2YVNjcmlwdDo6TWluaWZpZXI6Om1pbmlmeSggaW5wdXQgPT4gJFBhcmFte0NvZGV9ICk7Cn0KCj1pdGVtIENhY2hlR2VuZXJhdGUoKQoKZ2VuZXJhdGVzIHRoZSBsb2FkZXIgY2FjaGUgZmlsZXMgZm9yIGFsbCBmcm9udGVuZCBtb2R1bGVzLgoKICAgIG15ICVHZW5lcmF0ZWRGaWxlcyA9ICRMb2FkZXJPYmplY3QtPkNhY2hlR2VuZXJhdGUoKTsKCj1jdXQKCnN1YiBDYWNoZUdlbmVyYXRlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgQFJlc3VsdDsKCiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKICAgICMjIG5vZmlsdGVyKFRpZHlBbGw6OlBsdWdpbjo6T1RSUzo6UGVybDo6TGF5b3V0T2JqZWN0KQogICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICBteSAlQWdlbnRGcm9udGVuZHMgPSAleyAkQ29uZmlnT2JqZWN0LT5HZXQoJ0Zyb250ZW5kOjpNb2R1bGUnKSAvLyB7fSB9OwoKICAgIGZvciBteSAkRnJvbnRlbmRNb2R1bGUgKCBzb3J0IHsgJGEgY21wICRiIH0ga2V5cyAlQWdlbnRGcm9udGVuZHMgKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+e0FjdGlvbn0gPSAkRnJvbnRlbmRNb2R1bGU7CiAgICAgICAgJExheW91dE9iamVjdC0+TG9hZGVyQ3JlYXRlQWdlbnRDU1NDYWxscygpOwogICAgICAgICRMYXlvdXRPYmplY3QtPkxvYWRlckNyZWF0ZUFnZW50SlNDYWxscygpOwogICAgICAgIHB1c2ggQFJlc3VsdCwgJEZyb250ZW5kTW9kdWxlOwogICAgfQoKICAgIG15ICVDdXN0b21lckZyb250ZW5kcyA9ICgKICAgICAgICAleyAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyRnJvbnRlbmQ6Ok1vZHVsZScpIC8vIHt9IH0sCiAgICAgICAgJXsgJENvbmZpZ09iamVjdC0+R2V0KCdQdWJsaWNGcm9udGVuZDo6TW9kdWxlJykgICAvLyB7fSB9LAogICAgKTsKCiAgICBmb3IgbXkgJEZyb250ZW5kTW9kdWxlICggc29ydCB7ICRhIGNtcCAkYiB9IGtleXMgJUN1c3RvbWVyRnJvbnRlbmRzICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPntBY3Rpb259ID0gJEZyb250ZW5kTW9kdWxlOwogICAgICAgICRMYXlvdXRPYmplY3QtPkxvYWRlckNyZWF0ZUN1c3RvbWVyQ1NTQ2FsbHMoKTsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5Mb2FkZXJDcmVhdGVDdXN0b21lckpTQ2FsbHMoKTsKICAgICAgICBwdXNoIEBSZXN1bHQsICRGcm9udGVuZE1vZHVsZTsKICAgIH0KCiAgICByZXR1cm4gQFJlc3VsdDsKfQoKPWl0ZW0gQ2FjaGVEZWxldGUoKQoKZGVsZXRlcyBhbGwgdGhlIGxvYWRlciBjYWNoZSBmaWxlcy4KClJldHVybnMgYSBsaXN0IG9mIGRlbGV0ZWQgZmlsZXMuCgogICAgbXkgQERlbGV0ZWRGaWxlcyA9ICRMb2FkZXJPYmplY3QtPkNhY2hlRGVsZXRlKCk7Cgo9Y3V0CgpzdWIgQ2FjaGVEZWxldGUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSBAUmVzdWx0OwoKICAgIG15ICRIb21lID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdIb21lJyk7CgogICAgbXkgJEpTQ2FjaGVGb2xkZXIgICAgICAgPSAiJEhvbWUvdmFyL2h0dHBkL2h0ZG9jcy9qcy9qcy1jYWNoZSI7CiAgICBteSBAU2tpblR5cGVEaXJlY3RvcmllcyA9ICgKICAgICAgICAiJEhvbWUvdmFyL2h0dHBkL2h0ZG9jcy9za2lucy9BZ2VudCIsCiAgICAgICAgIiRIb21lL3Zhci9odHRwZC9odGRvY3Mvc2tpbnMvQ3VzdG9tZXIiLAogICAgKTsKCiAgICBteSBAQ2FjaGVGb2xkZXJzTGlzdCA9ICgkSlNDYWNoZUZvbGRlcik7CgogICAgbXkgJE1haW5PYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpOwoKICAgICMgTG9va2luZyBmb3IgYWxsIHNraW4gZm9sZGVycyB0aGF0IG1heSBjb250YWluIGEgY2FjaGUgZm9sZGVyCiAgICBmb3IgbXkgJEZvbGRlciAoQFNraW5UeXBlRGlyZWN0b3JpZXMpIHsKICAgICAgICBteSBATGlzdCA9ICRNYWluT2JqZWN0LT5EaXJlY3RvcnlSZWFkKAogICAgICAgICAgICBEaXJlY3RvcnkgPT4gJEZvbGRlciwKICAgICAgICAgICAgRmlsdGVyICAgID0+ICcqJywKICAgICAgICApOwoKICAgICAgICBGT0xERVI6CiAgICAgICAgZm9yIG15ICRGb2xkZXIgKEBMaXN0KSB7CiAgICAgICAgICAgIG5leHQgRk9MREVSIGlmICggIS1kICRGb2xkZXIgKTsKICAgICAgICAgICAgbXkgQENhY2hlRm9sZGVyID0gJE1haW5PYmplY3QtPkRpcmVjdG9yeVJlYWQoCiAgICAgICAgICAgICAgICBEaXJlY3RvcnkgPT4gJEZvbGRlciwKICAgICAgICAgICAgICAgIEZpbHRlciAgICA9PiAnY3NzLWNhY2hlJywKICAgICAgICAgICAgKTsKICAgICAgICAgICAgaWYgKCBAQ2FjaGVGb2xkZXIgJiYgLWQgJENhY2hlRm9sZGVyWzBdICkgewogICAgICAgICAgICAgICAgcHVzaCBAQ2FjaGVGb2xkZXJzTGlzdCwgJENhY2hlRm9sZGVyWzBdOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgbm93IGdvIHRocm91Z2ggdGhlIGNhY2hlIGZvbGRlcnMgYW5kIGRlbGV0ZSBhbGwgLmpzIGFuZCAuY3NzIGZpbGVzCiAgICBteSBARmlsZVR5cGVzID0gKCAiKi5qcyIsICIqLmNzcyIgKTsKICAgIG15ICRUb3RhbENvdW50ZXIgPSAwOwogICAgRk9MREVSVE9ERUxFVEU6CiAgICBmb3IgbXkgJEZvbGRlclRvRGVsZXRlIChAQ2FjaGVGb2xkZXJzTGlzdCkgewogICAgICAgIG5leHQgRk9MREVSVE9ERUxFVEUgaWYgKCAhLWQgJEZvbGRlclRvRGVsZXRlICk7CgogICAgICAgICMgS0lYNE9UUlMtY2FwZUlUCiAgICAgICAgIyAgICAgICAgbXkgQEZpbGVzTGlzdCA9ICRTZWxmLT57TWFpbk9iamVjdH0tPkRpcmVjdG9yeVJlYWQoCiAgICAgICAgIyAgICAgICAgICAgIERpcmVjdG9yeSA9PiAkRm9sZGVyVG9EZWxldGUsCiAgICAgICAgIyAgICAgICAgICAgIEZpbHRlciAgICA9PiBcQEZpbGVUeXBlcywKICAgICAgICAjICAgICAgICApOwogICAgICAgIG15ICREaXJlY3RvcnlTZWFyY2hTdWJSZWYgPSBzdWIgewogICAgICAgICAgICBteSAkRmlsZSA9ICRGaWxlOjpGaW5kOjpuYW1lOwogICAgICAgICAgICByZXR1cm4gaWYgIS1mICRGaWxlOwoKICAgICAgICAgICAgaWYgKCAkTWFpbk9iamVjdC0+RmlsZURlbGV0ZSggTG9jYXRpb24gPT4gJEZpbGUgKSApIHsKICAgICAgICAgICAgICAgIHB1c2ggQFJlc3VsdCwgJEZpbGU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDYW4ndCByZW1vdmU6ICRGaWxlIgogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgRmlsZTo6RmluZDo6ZmluZCggJERpcmVjdG9yeVNlYXJjaFN1YlJlZiwgJEZvbGRlclRvRGVsZXRlICk7CgogICAgICAgICMgRU8gS0lYNE9UUlMtY2FwZUlUCiAgICB9CgogICAgIyBmaW5hbGx5LCBhbHNvIGNsZWFuIHVwIHRoZSBpbnRlcm5hbCBwZXJsIGNhY2hlIGZpbGVzCiAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKS0+Q2xlYW5VcCgKICAgICAgICBUeXBlID0+ICRTZWxmLT57Q2FjaGVUeXBlfSwKICAgICk7CgogICAgcmV0dXJuIEBSZXN1bHQ7Cn0KCjE7Cgo9YmFjawoKPWhlYWQxIFRFUk1TIEFORCBDT05ESVRJT05TCgpUaGlzIHNvZnR3YXJlIGlzIHBhcnQgb2YgdGhlIE9UUlMgcHJvamVjdCAoTDxodHRwOi8vb3Rycy5vcmcvPikuCgpUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQp0aGUgZW5jbG9zZWQgZmlsZSBDT1BZSU5HIGZvciBsaWNlbnNlIGluZm9ybWF0aW9uIChBR1BMKS4gSWYgeW91CmRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBMPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9hZ3BsLnR4dD4uCgo9Y3V0Cg==</File>
        <File Location="KIXCore/Kernel/System/Package.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDE2IE9UUlMgQUcsIGh0dHA6Ly9vdHJzLmNvbS8KIyBLSVhDb3JlLUV4dGVuc2lvbnMgQ29weXJpZ2h0IChDKSAyMDA2LTIwMTYgYy5hLnAuZS4gSVQgR21iSCwgaHR0cDovL3d3dy5jYXBlLWl0LmRlCiMKIyB3cml0dGVuL2VkaXRlZCBieToKIyAqIEJlYXRyaWNlKGRvdClNdWVsbGVyKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIERvcm90aGVhKGRvdClEb2VyZmZlbChhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMgKiBUb3JzdGVuKGRvdClUaGF1KGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIwojIC0tCiMgVGhpcyBzb2Z0d2FyZSBjb21lcyB3aXRoIEFCU09MVVRFTFkgTk8gV0FSUkFOVFkuIEZvciBkZXRhaWxzLCBzZWUKIyB0aGUgZW5jbG9zZWQgZmlsZSBDT1BZSU5HIGZvciBsaWNlbnNlIGluZm9ybWF0aW9uIChBR1BMKS4gSWYgeW91CiMgZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9hZ3BsLnR4dC4KIyAtLQoKcGFja2FnZSBLZXJuZWw6OlN5c3RlbTo6UGFja2FnZTsKCnVzZSBzdHJpY3Q7CnVzZSB3YXJuaW5nczsKCnVzZSBNSU1FOjpCYXNlNjQ7CnVzZSBGaWxlOjpDb3B5OwoKdXNlIEtlcm5lbDo6Q29uZmlnOwp1c2UgS2VybmVsOjpTeXN0ZW06OlN5c0NvbmZpZzsKdXNlIEtlcm5lbDo6U3lzdGVtOjpXZWJVc2VyQWdlbnQ7Cgp1c2UgS2VybmVsOjpTeXN0ZW06OlZhcmlhYmxlQ2hlY2sgcXcoOmFsbCk7CnVzZSBLZXJuZWw6Okxhbmd1YWdlIHF3KFRyYW5zbGF0YWJsZSk7Cgp1c2UgYmFzZSBxdyhLZXJuZWw6OlN5c3RlbTo6RXZlbnRIYW5kbGVyKTsKCm91ciBAT2JqZWN0RGVwZW5kZW5jaWVzID0gKAogICAgJ0tlcm5lbDo6Q29uZmlnJywKICAgICdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDbG91ZFNlcnZpY2U6OkJhY2tlbmQ6OlJ1bicsCiAgICAnS2VybmVsOjpTeXN0ZW06OkRCJywKICAgICdLZXJuZWw6OlN5c3RlbTo6RW5jb2RlJywKICAgICdLZXJuZWw6OlN5c3RlbTo6SlNPTicsCiAgICAnS2VybmVsOjpTeXN0ZW06OkxvYWRlcicsCiAgICAnS2VybmVsOjpTeXN0ZW06OkxvZycsCiAgICAnS2VybmVsOjpTeXN0ZW06Ok1haW4nLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpUaW1lJywKICAgICdLZXJuZWw6OlN5c3RlbTo6WE1MJywKKTsKCj1oZWFkMSBOQU1FCgpLZXJuZWw6OlN5c3RlbTo6UGFja2FnZSAtIHRvIG1hbmFnZSBhcHBsaWNhdGlvbiBwYWNrYWdlcy9tb2R1bGVzCgo9aGVhZDEgU1lOT1BTSVMKCkFsbCBmdW5jdGlvbnMgdG8gbWFuYWdlIGFwcGxpY2F0aW9uIHBhY2thZ2VzL21vZHVsZXMuCgo9aGVhZDEgUFVCTElDIElOVEVSRkFDRQoKPW92ZXIgNAoKPWN1dAoKPWl0ZW0gbmV3KCkKCmNyZWF0ZSBhbiBvYmplY3QKCiAgICB1c2UgS2VybmVsOjpTeXN0ZW06Ok9iamVjdE1hbmFnZXI7CiAgICBsb2NhbCAkS2VybmVsOjpPTSA9IEtlcm5lbDo6U3lzdGVtOjpPYmplY3RNYW5hZ2VyLT5uZXcoKTsKICAgIG15ICRQYWNrYWdlT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlBhY2thZ2UnKTsKCj1jdXQKCnN1YiBuZXcgewogICAgbXkgKCAkVHlwZSwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGFsbG9jYXRlIG5ldyBoYXNoIGZvciBvYmplY3QKICAgIG15ICRTZWxmID0ge307CiAgICBibGVzcyggJFNlbGYsICRUeXBlICk7CgogICAgIyBnZXQgbmVlZGVkIG9iamVjdHMKICAgICRTZWxmLT57Q29uZmlnT2JqZWN0fSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CiAgICAkU2VsZi0+e01haW5PYmplY3R9ICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpOwoKICAgICRTZWxmLT57UGFja2FnZU1hcH0gPSB7CiAgICAgICAgTmFtZSAgICAgICAgICAgID0+ICdTQ0FMQVInLAogICAgICAgIFZlcnNpb24gICAgICAgICA9PiAnU0NBTEFSJywKICAgICAgICBWZW5kb3IgICAgICAgICAgPT4gJ1NDQUxBUicsCiAgICAgICAgQnVpbGREYXRlICAgICAgID0+ICdTQ0FMQVInLAogICAgICAgIEJ1aWxkSG9zdCAgICAgICA9PiAnU0NBTEFSJywKICAgICAgICBMaWNlbnNlICAgICAgICAgPT4gJ1NDQUxBUicsCiAgICAgICAgVVJMICAgICAgICAgICAgID0+ICdTQ0FMQVInLAogICAgICAgIENoYW5nZUxvZyAgICAgICA9PiAnQVJSQVknLAogICAgICAgIERlc2NyaXB0aW9uICAgICA9PiAnQVJSQVknLAogICAgICAgIEZyYW1ld29yayAgICAgICA9PiAnQVJSQVknLAogICAgICAgIE9TICAgICAgICAgICAgICA9PiAnQVJSQVknLAogICAgICAgIFBhY2thZ2VSZXF1aXJlZCA9PiAnQVJSQVknLAogICAgICAgIE1vZHVsZVJlcXVpcmVkICA9PiAnQVJSQVknLAogICAgICAgIEludHJvSW5zdGFsbCAgICA9PiAnQVJSQVknLAogICAgICAgIEludHJvVW5pbnN0YWxsICA9PiAnQVJSQVknLAogICAgICAgIEludHJvVXBncmFkZSAgICA9PiAnQVJSQVknLAogICAgICAgIEludHJvUmVpbnN0YWxsICA9PiAnQVJSQVknLAogICAgICAgIFBhY2thZ2VNZXJnZSAgICA9PiAnQVJSQVknLAoKICAgICAgICAjIHBhY2thZ2UgZmxhZ3MKICAgICAgICBQYWNrYWdlSXNWaXNpYmxlICAgICAgPT4gJ1NDQUxBUicsCiAgICAgICAgUGFja2FnZUlzRG93bmxvYWRhYmxlID0+ICdTQ0FMQVInLAogICAgICAgIFBhY2thZ2VJc1JlbW92YWJsZSAgICA9PiAnU0NBTEFSJywKCiAgICAgICAgIyAqKFByZXxQb3N0KSAtIGp1c3QgZm9yIGNvbXBhdC4gdG8gMi4yCiAgICAgICAgSW50cm9JbnN0YWxsUHJlICAgID0+ICdBUlJBWScsCiAgICAgICAgSW50cm9JbnN0YWxsUG9zdCAgID0+ICdBUlJBWScsCiAgICAgICAgSW50cm9Vbmluc3RhbGxQcmUgID0+ICdBUlJBWScsCiAgICAgICAgSW50cm9Vbmluc3RhbGxQb3N0ID0+ICdBUlJBWScsCiAgICAgICAgSW50cm9VcGdyYWRlUHJlICAgID0+ICdBUlJBWScsCiAgICAgICAgSW50cm9VcGdyYWRlUG9zdCAgID0+ICdBUlJBWScsCiAgICAgICAgSW50cm9SZWluc3RhbGxQcmUgID0+ICdBUlJBWScsCiAgICAgICAgSW50cm9SZWluc3RhbGxQb3N0ID0+ICdBUlJBWScsCgogICAgICAgIENvZGVJbnN0YWxsICAgPT4gJ0FSUkFZJywKICAgICAgICBDb2RlVXBncmFkZSAgID0+ICdBUlJBWScsCiAgICAgICAgQ29kZVVuaW5zdGFsbCA9PiAnQVJSQVknLAogICAgICAgIENvZGVSZWluc3RhbGwgPT4gJ0FSUkFZJywKICAgIH07CiAgICAkU2VsZi0+e1BhY2thZ2VNYXBGaWxlTGlzdH0gPSB7CiAgICAgICAgRmlsZSA9PiAnQVJSQVknLAogICAgfTsKCiAgICAjIEtJWENvcmUtY2FwZUlUCiAgICAjICRTZWxmLT57UGFja2FnZVZlcmlmeVVSTH0KICAgICMgICAgID0gJ2h0dHBzOi8vcGF2Lm90cnMuY29tL290cnMvcHVibGljLnBsJzsKICAgICRTZWxmLT57UGFja2FnZVZlcmlmeVVSTH0KICAgICAgICA9ICRTZWxmLT57Q29uZmlnT2JqZWN0fS0+R2V0KCdQYWNrYWdlOjpDb25maWd1cmVDYWxsSG9tZVZlcmlmaWNhdGlvblBhdGgnKTsKCiAgICAjIEVPIEtJWENvcmUtY2FwZUlUCgogICAgJFNlbGYtPntIb21lfSA9ICRTZWxmLT57Q29uZmlnT2JqZWN0fS0+R2V0KCdIb21lJyk7CgogICAgIyBwZXJtaXNzaW9uIGNoZWNrCiAgICBkaWUgaWYgISRTZWxmLT5fRmlsZVN5c3RlbUNoZWNrKCk7CgogICAgIyBpbml0IG9mIGV2ZW50IGhhbmRsZXIKICAgICRTZWxmLT5FdmVudEhhbmRsZXJJbml0KAogICAgICAgIENvbmZpZyA9PiAnUGFja2FnZTo6RXZlbnRNb2R1bGVQb3N0JywKICAgICk7CgogICAgIyByZXNlcnZlIHNwYWNlIGZvciBtZXJnZWQgcGFja2FnZXMKICAgICRTZWxmLT57TWVyZ2VkUGFja2FnZXN9ID0ge307CgogICAgIyBjaGVjayBpZiBjbG91ZCBzZXJ2aWNlcyBhcmUgZGlzYWJsZWQKICAgICRTZWxmLT57Q2xvdWRTZXJ2aWNlc0Rpc2FibGVkfSA9ICRTZWxmLT57Q29uZmlnT2JqZWN0fS0+R2V0KCdDbG91ZFNlcnZpY2VzOjpEaXNhYmxlZCcpIHx8IDA7CgogICAgcmV0dXJuICRTZWxmOwp9Cgo9aXRlbSBSZXBvc2l0b3J5TGlzdCgpCgpyZXR1cm5zIGEgbGlzdCBvZiByZXBvc2l0b3J5IHBhY2thZ2VzCnVzaW5nIFJlc3VsdCA9PiAnc2hvcnQnIHdpbGwgb25seSByZXR1cm4gbmFtZSwgdmVyc2lvbiwgaW5zdGFsbF9zdGF0dXMgbWQ1c3VtIGFuZCB2ZW5kb3IKaW5zdGVhZCBvZiB0aGUgc3RydWN0dXJlCgogICAgbXkgQExpc3QgPSAkUGFja2FnZU9iamVjdC0+UmVwb3NpdG9yeUxpc3QoKTsKCiAgICBteSBATGlzdCA9ICRQYWNrYWdlT2JqZWN0LT5SZXBvc2l0b3J5TGlzdCgKICAgICAgICBSZXN1bHQgPT4gJ3Nob3J0JywKICAgICk7Cgo9Y3V0CgpzdWIgUmVwb3NpdG9yeUxpc3QgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkUmVzdWx0ID0gJ0Z1bGwnOwogICAgaWYgKCBkZWZpbmVkICRQYXJhbXtSZXN1bHR9ICYmIGxjICRQYXJhbXtSZXN1bHR9IGVxICdzaG9ydCcgKSB7CiAgICAgICAgJFJlc3VsdCA9ICdTaG9ydCc7CiAgICB9CgogICAgIyBnZXQgY2FjaGUgb2JqZWN0CiAgICBteSAkQ2FjaGVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKTsKCiAgICAjIGNoZWNrIGNhY2hlCiAgICBteSAkQ2FjaGUgPSAkQ2FjaGVPYmplY3QtPkdldCgKICAgICAgICBUeXBlID0+ICJSZXBvc2l0b3J5TGlzdCIsCiAgICAgICAgS2V5ICA9PiAkUmVzdWx0IC4gJ0xpc3QnLAogICAgKTsKICAgIHJldHVybiBAeyRDYWNoZX0gaWYgJENhY2hlOwoKICAgICMgZ2V0IGRhdGFiYXNlIG9iamVjdAogICAgbXkgJERCT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkRCJyk7CgogICAgIyBnZXQgcmVwb3NpdG9yeSBsaXN0CiAgICAkREJPYmplY3QtPlByZXBhcmUoCiAgICAgICAgU1FMID0+ICdTRUxFQ1QgbmFtZSwgdmVyc2lvbiwgaW5zdGFsbF9zdGF0dXMsIGNvbnRlbnQsIHZlbmRvcgogICAgICAgICAgICAgICAgRlJPTSBwYWNrYWdlX3JlcG9zaXRvcnkKICAgICAgICAgICAgICAgIE9SREVSIEJZIG5hbWUsIGNyZWF0ZV90aW1lJywKICAgICk7CgogICAgIyBmZXRjaCB0aGUgZGF0YQogICAgbXkgQERhdGE7CiAgICB3aGlsZSAoIG15IEBSb3cgPSAkREJPYmplY3QtPkZldGNocm93QXJyYXkoKSApIHsKICAgICAgICBteSAlUGFja2FnZSA9ICgKICAgICAgICAgICAgTmFtZSAgICA9PiAkUm93WzBdLAogICAgICAgICAgICBWZXJzaW9uID0+ICRSb3dbMV0sCiAgICAgICAgICAgIFN0YXR1cyAgPT4gJFJvd1syXSwKICAgICAgICAgICAgVmVuZG9yICA9PiAkUm93WzRdLAogICAgICAgICk7CgogICAgICAgICMgY29ycmVjdCBhbnkgJ2Rvcy1zdHlsZScgbGluZSBlbmRpbmdzIC0gaHR0cDovL2J1Z3Mub3Rycy5vcmcvc2hvd19idWcuY2dpP2lkPTk4MzgKICAgICAgICAkUm93WzNdID1+IHN7XHJcbn17XG59eG1zZzsKICAgICAgICAkUGFja2FnZXtNRDVzdW19ID0gJFNlbGYtPntNYWluT2JqZWN0fS0+TUQ1c3VtKCBTdHJpbmcgPT4gXCRSb3dbM10gKTsKCiAgICAgICAgIyBnZXQgcGFja2FnZSBhdHRyaWJ1dGVzCiAgICAgICAgaWYgKCAkUm93WzNdICYmICRSZXN1bHQgZXEgJ1Nob3J0JyApIHsKCiAgICAgICAgICAgIHB1c2ggQERhdGEsIHslUGFja2FnZX07CgogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRSb3dbM10gKSB7CgogICAgICAgICAgICBteSAlU3RydWN0dXJlID0gJFNlbGYtPlBhY2thZ2VQYXJzZSggU3RyaW5nID0+IFwkUm93WzNdICk7CiAgICAgICAgICAgIHB1c2ggQERhdGEsIHsgJVBhY2thZ2UsICVTdHJ1Y3R1cmUgfTsKCiAgICAgICAgfQogICAgfQoKICAgICMgc2V0IGNhY2hlCiAgICAkQ2FjaGVPYmplY3QtPlNldCgKICAgICAgICBUeXBlICA9PiAnUmVwb3NpdG9yeUxpc3QnLAogICAgICAgIEtleSAgID0+ICRSZXN1bHQgLiAnTGlzdCcsCiAgICAgICAgVmFsdWUgPT4gXEBEYXRhLAogICAgICAgIFRUTCAgID0+IDMwICogMjQgKiA2MCAqIDYwLAogICAgKTsKCiAgICByZXR1cm4gQERhdGE7Cn0KCj1pdGVtIFJlcG9zaXRvcnlHZXQoKQoKZ2V0IGEgcGFja2FnZSBmcm9tIGxvY2FsIHJlcG9zaXRvcnkKCiAgICBteSAkUGFja2FnZSA9ICRQYWNrYWdlT2JqZWN0LT5SZXBvc2l0b3J5R2V0KAogICAgICAgIE5hbWUgICAgPT4gJ0FwcGxpY2F0aW9uIEEnLAogICAgICAgIFZlcnNpb24gPT4gJzEuMCcsCiAgICApOwoKICAgIG15ICRQYWNrYWdlU2NhbGFyID0gJFBhY2thZ2VPYmplY3QtPlJlcG9zaXRvcnlHZXQoCiAgICAgICAgTmFtZSAgICAgICAgICAgID0+ICdBcHBsaWNhdGlvbiBBJywKICAgICAgICBWZXJzaW9uICAgICAgICAgPT4gJzEuMCcsCiAgICAgICAgUmVzdWx0ICAgICAgICAgID0+ICdTQ0FMQVInLAogICAgICAgIERpc2FibGVXYXJuaW5ncyA9PiAxLCAgICAgICAgICMgb3B0aW9uYWwKICAgICk7Cgo9Y3V0CgpzdWIgUmVwb3NpdG9yeUdldCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoTmFtZSBWZXJzaW9uKSkgewogICAgICAgIGlmICggIWRlZmluZWQgJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiJE5lZWRlZCBub3QgZGVmaW5lZCEiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IGNhY2hlIG9iamVjdAogICAgbXkgJENhY2hlT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyk7CgogICAgIyBjaGVjayBjYWNoZQogICAgbXkgJENhY2hlS2V5ID0gJFBhcmFte05hbWV9IC4gJFBhcmFte1ZlcnNpb259OwogICAgbXkgJENhY2hlICAgID0gJENhY2hlT2JqZWN0LT5HZXQoCiAgICAgICAgVHlwZSA9PiAnUmVwb3NpdG9yeUdldCcsCiAgICAgICAgS2V5ICA9PiAkQ2FjaGVLZXksCiAgICApOwogICAgcmV0dXJuICRDYWNoZSBpZiAkQ2FjaGUgJiYgJFBhcmFte1Jlc3VsdH0gJiYgJFBhcmFte1Jlc3VsdH0gZXEgJ1NDQUxBUic7CiAgICByZXR1cm4gJHskQ2FjaGV9IGlmICRDYWNoZTsKCiAgICAjIGdldCBkYXRhYmFzZSBvYmplY3QKICAgIG15ICREQk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwoKICAgICMgZ2V0IHJlcG9zaXRvcnkKICAgICREQk9iamVjdC0+UHJlcGFyZSgKICAgICAgICBTUUwgICA9PiAnU0VMRUNUIGNvbnRlbnQgRlJPTSBwYWNrYWdlX3JlcG9zaXRvcnkgV0hFUkUgbmFtZSA9ID8gQU5EIHZlcnNpb24gPSA/JywKICAgICAgICBCaW5kICA9PiBbIFwkUGFyYW17TmFtZX0sIFwkUGFyYW17VmVyc2lvbn0gXSwKICAgICAgICBMaW1pdCA9PiAxLAogICAgKTsKCiAgICAjIGZldGNoIGRhdGEKICAgIG15ICRQYWNrYWdlID0gJyc7CiAgICB3aGlsZSAoIG15IEBSb3cgPSAkREJPYmplY3QtPkZldGNocm93QXJyYXkoKSApIHsKICAgICAgICAkUGFja2FnZSA9ICRSb3dbMF07CiAgICB9CgogICAgaWYgKCAhJFBhY2thZ2UgKSB7CgogICAgICAgIGlmICggISRQYXJhbXtEaXNhYmxlV2FybmluZ3N9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdub3RpY2UnLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5vIHN1Y2ggcGFja2FnZTogJFBhcmFte05hbWV9LSRQYXJhbXtWZXJzaW9ufSEiLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgc2V0IGNhY2hlCiAgICAkQ2FjaGVPYmplY3QtPlNldCgKICAgICAgICBUeXBlICA9PiAnUmVwb3NpdG9yeUdldCcsCiAgICAgICAgS2V5ICAgPT4gJENhY2hlS2V5LAogICAgICAgIFZhbHVlID0+IFwkUGFja2FnZSwKICAgICAgICBUVEwgICA9PiAzMCAqIDI0ICogNjAgKiA2MCwKICAgICk7CgogICAgcmV0dXJuIFwkUGFja2FnZSBpZiAkUGFyYW17UmVzdWx0fSAmJiAkUGFyYW17UmVzdWx0fSBlcSAnU0NBTEFSJzsKICAgIHJldHVybiAkUGFja2FnZTsKfQoKPWl0ZW0gUmVwb3NpdG9yeUFkZCgpCgphZGQgYSBwYWNrYWdlIHRvIGxvY2FsIHJlcG9zaXRvcnkKCiAgICAkUGFja2FnZU9iamVjdC0+UmVwb3NpdG9yeUFkZCgKICAgICAgICBTdHJpbmcgPT4gJEZpbGVTdHJpbmcsCiAgICAgICAgRnJvbUNsb3VkID0+IDAsICMgb3B0aW9uYWwgMSBvciAwLCBpdCBpbmRpY2F0ZXMgaWYgcGFja2FnZSBjYW1lIGZyb20gQ2xvdWQgb3Igbm90CiAgICApOwoKPWN1dAoKc3ViIFJlcG9zaXRvcnlBZGQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgaWYgKCAhZGVmaW5lZCAkUGFyYW17U3RyaW5nfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ1N0cmluZyBub3QgZGVmaW5lZCEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgZ2V0IGZyb20gY2xvdWQgZmxhZwogICAgJFBhcmFte0Zyb21DbG91ZH0gLy89IDA7CgogICAgIyBnZXQgcGFja2FnZSBhdHRyaWJ1dGVzCiAgICBteSAlU3RydWN0dXJlID0gJFNlbGYtPlBhY2thZ2VQYXJzZSglUGFyYW0pOwoKICAgIGlmICggIUlzSGFzaFJlZldpdGhEYXRhKCBcJVN0cnVjdHVyZSApICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnSW52YWxpZCBQYWNrYWdlIScsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoICEkU3RydWN0dXJle05hbWV9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnTmVlZCBOYW1lIScsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoICEkU3RydWN0dXJle1ZlcnNpb259ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnTmVlZCBWZXJzaW9uIScsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBjaGVjayBpZiBwYWNrYWdlIGFscmVhZHkgZXhpc3RzCiAgICBteSAkUGFja2FnZUV4aXN0cyA9ICRTZWxmLT5SZXBvc2l0b3J5R2V0KAogICAgICAgIE5hbWUgICAgICAgICAgICA9PiAkU3RydWN0dXJle05hbWV9LT57Q29udGVudH0sCiAgICAgICAgVmVyc2lvbiAgICAgICAgID0+ICRTdHJ1Y3R1cmV7VmVyc2lvbn0tPntDb250ZW50fSwKICAgICAgICBSZXN1bHQgICAgICAgICAgPT4gJ1NDQUxBUicsCiAgICAgICAgRGlzYWJsZVdhcm5pbmdzID0+IDEsCiAgICApOwoKICAgICMgZ2V0IGRhdGFiYXNlIG9iamVjdAogICAgbXkgJERCT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkRCJyk7CgogICAgaWYgKCRQYWNrYWdlRXhpc3RzKSB7CiAgICAgICAgJERCT2JqZWN0LT5EbygKICAgICAgICAgICAgU1FMICA9PiAnREVMRVRFIEZST00gcGFja2FnZV9yZXBvc2l0b3J5IFdIRVJFIG5hbWUgPSA/IEFORCB2ZXJzaW9uID0gPycsCiAgICAgICAgICAgIEJpbmQgPT4gWyBcJFN0cnVjdHVyZXtOYW1lfS0+e0NvbnRlbnR9LCBcJFN0cnVjdHVyZXtWZXJzaW9ufS0+e0NvbnRlbnR9IF0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGFkZCBuZXcgcGFja2FnZQogICAgbXkgJEZpbGVOYW1lID0gJFN0cnVjdHVyZXtOYW1lfS0+e0NvbnRlbnR9IC4gJy0nIC4gJFN0cnVjdHVyZXtWZXJzaW9ufS0+e0NvbnRlbnR9IC4gJy54bWwnOwoKICAgIHJldHVybiBpZiAhJERCT2JqZWN0LT5EbygKICAgICAgICBTUUwgPT4gJ0lOU0VSVCBJTlRPIHBhY2thZ2VfcmVwb3NpdG9yeSAobmFtZSwgdmVyc2lvbiwgdmVuZG9yLCBmaWxlbmFtZSwgJwogICAgICAgICAgICAuICcgY29udGVudF90eXBlLCBjb250ZW50LCBpbnN0YWxsX3N0YXR1cywgJwogICAgICAgICAgICAuICcgY3JlYXRlX3RpbWUsIGNyZWF0ZV9ieSwgY2hhbmdlX3RpbWUsIGNoYW5nZV9ieSknCiAgICAgICAgICAgIC4gJyBWQUxVRVMgICg/LCA/LCA/LCA/LCBcJ3RleHQveG1sXCcsID8sIFwnJwogICAgICAgICAgICAuIFRyYW5zbGF0YWJsZSgnbm90IGluc3RhbGxlZCcpIC4gJ1wnLCAnCiAgICAgICAgICAgIC4gJyBjdXJyZW50X3RpbWVzdGFtcCwgMSwgY3VycmVudF90aW1lc3RhbXAsIDEpJywKICAgICAgICBCaW5kID0+IFsKICAgICAgICAgICAgXCRTdHJ1Y3R1cmV7TmFtZX0tPntDb250ZW50fSwgXCRTdHJ1Y3R1cmV7VmVyc2lvbn0tPntDb250ZW50fSwKICAgICAgICAgICAgXCRTdHJ1Y3R1cmV7VmVuZG9yfS0+e0NvbnRlbnR9LCBcJEZpbGVOYW1lLCBcJFBhcmFte1N0cmluZ30sCiAgICAgICAgXSwKICAgICk7CgogICAgIyBjbGVhbnVwIGNhY2hlCiAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKS0+Q2xlYW5VcCgKICAgICAgICBUeXBlID0+ICdSZXBvc2l0b3J5TGlzdCcsCiAgICApOwoKICAgIHJldHVybiAxOwp9Cgo9aXRlbSBSZXBvc2l0b3J5UmVtb3ZlKCkKCnJlbW92ZSBhIHBhY2thZ2UgZnJvbSBsb2NhbCByZXBvc2l0b3J5CgogICAgJFBhY2thZ2VPYmplY3QtPlJlcG9zaXRvcnlSZW1vdmUoCiAgICAgICAgTmFtZSAgICA9PiAnQXBwbGljYXRpb24gQScsCiAgICAgICAgVmVyc2lvbiA9PiAnMS4wJywKICAgICk7Cgo9Y3V0CgpzdWIgUmVwb3NpdG9yeVJlbW92ZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICFkZWZpbmVkICRQYXJhbXtOYW1lfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05hbWUgbm90IGRlZmluZWQhJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGNyZWF0ZSBzcWwKICAgIG15IEBCaW5kID0gKCBcJFBhcmFte05hbWV9ICk7CiAgICBteSAkU1FMICA9ICdERUxFVEUgRlJPTSBwYWNrYWdlX3JlcG9zaXRvcnkgV0hFUkUgbmFtZSA9ID8nOwogICAgaWYgKCAkUGFyYW17VmVyc2lvbn0gKSB7CiAgICAgICAgJFNRTCAuPSAnIEFORCB2ZXJzaW9uID0gPyc7CiAgICAgICAgcHVzaCBAQmluZCwgXCRQYXJhbXtWZXJzaW9ufTsKICAgIH0KCiAgICByZXR1cm4gaWYgISRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpLT5EbygKICAgICAgICBTUUwgID0+ICRTUUwsCiAgICAgICAgQmluZCA9PiBcQEJpbmQKICAgICk7CgogICAgIyBnZXQgY2FjaGUgb2JqZWN0CiAgICBteSAkQ2FjaGVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKTsKCiAgICAjIGNsZWFudXAgY2FjaGUKICAgICRDYWNoZU9iamVjdC0+Q2xlYW5VcCgKICAgICAgICBUeXBlID0+ICdSZXBvc2l0b3J5TGlzdCcsCiAgICApOwogICAgJENhY2hlT2JqZWN0LT5DbGVhblVwKAogICAgICAgIFR5cGUgPT4gJ1JlcG9zaXRvcnlHZXQnLAogICAgKTsKCiAgICByZXR1cm4gMTsKfQoKPWl0ZW0gUGFja2FnZUluc3RhbGwoKQoKaW5zdGFsbCBhIHBhY2thZ2UKCiAgICAkUGFja2FnZU9iamVjdC0+UGFja2FnZUluc3RhbGwoCiAgICAgICAgU3RyaW5nICAgID0+ICRGaWxlU3RyaW5nCiAgICAgICAgRnJvbUNsb3VkID0+IDEsICMgb3B0aW9uYWwgMSBvciAwLCBpdCBpbmRpY2F0ZXMgaWYgcGFja2FnZSdzIG9yaWdpbiBpcyBDbG91ZCBvciBub3QKICAgICk7Cgo9Y3V0CgpzdWIgUGFja2FnZUluc3RhbGwgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgaWYgKCAhZGVmaW5lZCAkUGFyYW17U3RyaW5nfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ1N0cmluZyBub3QgZGVmaW5lZCEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgZ2V0IGZyb20gY2xvdWQgZmxhZwogICAgbXkgJEZyb21DbG91ZCA9ICRQYXJhbXtGcm9tQ2xvdWR9IHx8IDA7CgogICAgIyBjb25mbGljdCBjaGVjawogICAgbXkgJVN0cnVjdHVyZSA9ICRTZWxmLT5QYWNrYWdlUGFyc2UoJVBhcmFtKTsKCiAgICAjIGNoZWNrIGlmIHBhY2thZ2UgaXMgYWxyZWFkeSBpbnN0YWxsZWQKICAgIGlmICggJFNlbGYtPlBhY2thZ2VJc0luc3RhbGxlZCggTmFtZSA9PiAkU3RydWN0dXJle05hbWV9LT57Q29udGVudH0gKSApIHsKICAgICAgICBpZiAoICEkUGFyYW17Rm9yY2V9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdub3RpY2UnLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ1BhY2thZ2UgYWxyZWFkeSBpbnN0YWxsZWQsIHRyeSB1cGdyYWRlIScsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybiAkU2VsZi0+UGFja2FnZVVwZ3JhZGUoJVBhcmFtKTsKICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBPUwogICAgaWYgKCAkU3RydWN0dXJle09TfSAmJiAhJFBhcmFte0ZvcmNlfSApIHsKICAgICAgICByZXR1cm4gaWYgISRTZWxmLT5fT1NDaGVjayggT1MgPT4gJFN0cnVjdHVyZXtPU30gKTsKICAgIH0KCiAgICAjIGNoZWNrIGZyYW1ld29yawogICAgaWYgKCAkU3RydWN0dXJle0ZyYW1ld29ya30gJiYgISRQYXJhbXtGb3JjZX0gKSB7CiAgICAgICAgcmV0dXJuIGlmICEkU2VsZi0+X0NoZWNrRnJhbWV3b3JrKCBGcmFtZXdvcmsgPT4gJFN0cnVjdHVyZXtGcmFtZXdvcmt9ICk7CiAgICB9CgogICAgIyBjaGVjayByZXF1aXJlZCBwYWNrYWdlcwogICAgaWYgKCAkU3RydWN0dXJle1BhY2thZ2VSZXF1aXJlZH0gJiYgISRQYXJhbXtGb3JjZX0gKSB7CiAgICAgICAgcmV0dXJuIGlmICEkU2VsZi0+X0NoZWNrUGFja2FnZVJlcXVpcmVkKAogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgIFBhY2thZ2VSZXF1aXJlZCA9PiAkU3RydWN0dXJle1BhY2thZ2VSZXF1aXJlZH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGNoZWNrIHJlcXVpcmVkIG1vZHVsZXMKICAgIGlmICggJFN0cnVjdHVyZXtNb2R1bGVSZXF1aXJlZH0gJiYgISRQYXJhbXtGb3JjZX0gKSB7CiAgICAgICAgcmV0dXJuIGlmICEkU2VsZi0+X0NoZWNrTW9kdWxlUmVxdWlyZWQoCiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgTW9kdWxlUmVxdWlyZWQgPT4gJFN0cnVjdHVyZXtNb2R1bGVSZXF1aXJlZH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGNoZWNrIG1lcmdlZCBwYWNrYWdlcwogICAgaWYgKCAkU3RydWN0dXJle1BhY2thZ2VNZXJnZX0gKSB7CgogICAgICAgICMgdXBncmFkZSBtZXJnZWQgcGFja2FnZXMgKG5vIGZpbGVzKQogICAgICAgIHJldHVybiBpZiAhJFNlbGYtPl9NZXJnZWRQYWNrYWdlcygKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICBTdHJ1Y3R1cmUgPT4gXCVTdHJ1Y3R1cmUsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGNoZWNrIGZpbGVzCiAgICBteSAkRmlsZUNoZWNrT2sgPSAxOwogICAgaWYgKCAkU3RydWN0dXJle0ZpbGVsaXN0fSAmJiByZWYgJFN0cnVjdHVyZXtGaWxlbGlzdH0gZXEgJ0FSUkFZJyApIHsKICAgICAgICBmb3IgbXkgJEZpbGUgKCBAeyAkU3RydWN0dXJle0ZpbGVsaXN0fSB9ICkgewoKICAgICAgICAgICAgI3ByaW50IFNUREVSUiAiTm90aWNlOiBXYW50IHRvIGluc3RhbGwgJEZpbGUtPntMb2NhdGlvbn0hXG4iOwogICAgICAgIH0KICAgIH0KICAgIGlmICggISRGaWxlQ2hlY2tPayAmJiAhJFBhcmFte0ZvcmNlfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ0ZpbGUgY29uZmxpY3QsIGNhblwndCBpbnN0YWxsIHBhY2thZ2UhJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGNoZWNrIGlmIG9uZSBvZiB0aGlzIGZpbGVzIGlzIGFscmVhZHkgaW50YWxsZWQgYnkgYW4gb3RoZXIgcGFja2FnZQogICAgaWYgKCAlU3RydWN0dXJlICYmICEkUGFyYW17Rm9yY2V9ICkgewogICAgICAgIHJldHVybiBpZiAhJFNlbGYtPl9QYWNrYWdlRmlsZUNoZWNrKAogICAgICAgICAgICBTdHJ1Y3R1cmUgPT4gXCVTdHJ1Y3R1cmUsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGluc3RhbGwgY29kZSAocHJlKQogICAgaWYgKCAkU3RydWN0dXJle0NvZGVJbnN0YWxsfSApIHsKICAgICAgICAkU2VsZi0+X0NvZGUoCiAgICAgICAgICAgIENvZGUgICAgICA9PiAkU3RydWN0dXJle0NvZGVJbnN0YWxsfSwKICAgICAgICAgICAgVHlwZSAgICAgID0+ICdwcmUnLAogICAgICAgICAgICBTdHJ1Y3R1cmUgPT4gXCVTdHJ1Y3R1cmUsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGluc3RhbGwgZGF0YWJhc2UgKHByZSkKICAgIGlmICggJFN0cnVjdHVyZXtEYXRhYmFzZUluc3RhbGx9ICYmICRTdHJ1Y3R1cmV7RGF0YWJhc2VJbnN0YWxsfS0+e3ByZX0gKSB7CgogICAgICAgIG15ICREYXRhYmFzZUluc3RhbGwgPSAkU2VsZi0+X0NoZWNrREJNZXJnZWQoIERhdGFiYXNlID0+ICRTdHJ1Y3R1cmV7RGF0YWJhc2VJbnN0YWxsfS0+e3ByZX0gKTsKCiAgICAgICAgaWYgKCBJc0FycmF5UmVmV2l0aERhdGEoJERhdGFiYXNlSW5zdGFsbCkgKSB7CiAgICAgICAgICAgICRTZWxmLT5fRGF0YWJhc2UoIERhdGFiYXNlID0+ICREYXRhYmFzZUluc3RhbGwgKTsKICAgICAgICB9CiAgICB9CgogICAgIyBpbnN0YWxsIGZpbGVzCiAgICBpZiAoICRTdHJ1Y3R1cmV7RmlsZWxpc3R9ICYmIHJlZiAkU3RydWN0dXJle0ZpbGVsaXN0fSBlcSAnQVJSQVknICkgewogICAgICAgIGZvciBteSAkRmlsZSAoIEB7ICRTdHJ1Y3R1cmV7RmlsZWxpc3R9IH0gKSB7CiAgICAgICAgICAgICRTZWxmLT5fRmlsZUluc3RhbGwoIEZpbGUgPT4gJEZpbGUgKTsKICAgICAgICB9CiAgICB9CgogICAgIyBhZGQgcGFja2FnZQogICAgcmV0dXJuIGlmICEkU2VsZi0+UmVwb3NpdG9yeUFkZCgKICAgICAgICBTdHJpbmcgICAgPT4gJFBhcmFte1N0cmluZ30sCiAgICAgICAgRnJvbUNsb3VkID0+ICRGcm9tQ2xvdWQKICAgICk7CgogICAgIyB1cGRhdGUgcGFja2FnZSBzdGF0dXMKICAgIHJldHVybiBpZiAhJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkRCJyktPkRvKAogICAgICAgIFNRTCA9PiAnVVBEQVRFIHBhY2thZ2VfcmVwb3NpdG9yeSBTRVQgaW5zdGFsbF9zdGF0dXMgPSBcJycKICAgICAgICAgICAgLiBUcmFuc2xhdGFibGUoJ2luc3RhbGxlZCcpIC4gJ1wnJwogICAgICAgICAgICAuICcgV0hFUkUgbmFtZSA9ID8gQU5EIHZlcnNpb24gPSA/JywKICAgICAgICBCaW5kID0+IFsKICAgICAgICAgICAgXCRTdHJ1Y3R1cmV7TmFtZX0tPntDb250ZW50fSwKICAgICAgICAgICAgXCRTdHJ1Y3R1cmV7VmVyc2lvbn0tPntDb250ZW50fSwKICAgICAgICBdLAogICAgKTsKCiAgICAjIGluc3RhbGwgY29uZmlnCiAgICAkU2VsZi0+e1N5c0NvbmZpZ09iamVjdH0gPSBLZXJuZWw6OlN5c3RlbTo6U3lzQ29uZmlnLT5uZXcoICV7JFNlbGZ9ICk7CiAgICAkU2VsZi0+e1N5c0NvbmZpZ09iamVjdH0tPldyaXRlRGVmYXVsdCgpOwoKICAgICMgaW5zdGFsbCBkYXRhYmFzZSAocG9zdCkKICAgIGlmICggJFN0cnVjdHVyZXtEYXRhYmFzZUluc3RhbGx9ICYmICRTdHJ1Y3R1cmV7RGF0YWJhc2VJbnN0YWxsfS0+e3Bvc3R9ICkgewoKICAgICAgICBteSAkRGF0YWJhc2VJbnN0YWxsID0gJFNlbGYtPl9DaGVja0RCTWVyZ2VkKCBEYXRhYmFzZSA9PiAkU3RydWN0dXJle0RhdGFiYXNlSW5zdGFsbH0tPntwb3N0fSApOwoKICAgICAgICBpZiAoIElzQXJyYXlSZWZXaXRoRGF0YSgkRGF0YWJhc2VJbnN0YWxsKSApIHsKICAgICAgICAgICAgJFNlbGYtPl9EYXRhYmFzZSggRGF0YWJhc2UgPT4gJERhdGFiYXNlSW5zdGFsbCApOwogICAgICAgIH0KICAgIH0KCiAgICAjIGluc3RhbGwgY29kZSAocG9zdCkKICAgIGlmICggJFN0cnVjdHVyZXtDb2RlSW5zdGFsbH0gKSB7CiAgICAgICAgJFNlbGYtPl9Db2RlKAogICAgICAgICAgICBDb2RlICAgICAgPT4gJFN0cnVjdHVyZXtDb2RlSW5zdGFsbH0sCiAgICAgICAgICAgIFR5cGUgICAgICA9PiAncG9zdCcsCiAgICAgICAgICAgIFN0cnVjdHVyZSA9PiBcJVN0cnVjdHVyZSwKICAgICAgICApOwogICAgfQoKICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpLT5DbGVhblVwKAogICAgICAgIEtlZXBUeXBlcyA9PiBbJ1hNTFBhcnNlJ10sCiAgICApOwogICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvYWRlcicpLT5DYWNoZURlbGV0ZSgpOwoKICAgICMgdHJpZ2dlciBldmVudAogICAgJFNlbGYtPkV2ZW50SGFuZGxlcigKICAgICAgICBFdmVudCA9PiAnUGFja2FnZUluc3RhbGwnLAogICAgICAgIERhdGEgID0+IHsKICAgICAgICAgICAgTmFtZSAgICA9PiAkU3RydWN0dXJle05hbWV9LT57Q29udGVudH0sCiAgICAgICAgICAgIFZlbmRvciAgPT4gJFN0cnVjdHVyZXtWZW5kb3J9LT57Q29udGVudH0sCiAgICAgICAgICAgIFZlcnNpb24gPT4gJFN0cnVjdHVyZXtWZXJzaW9ufS0+e0NvbnRlbnR9LAogICAgICAgIH0sCiAgICAgICAgVXNlcklEID0+IDEsCiAgICApOwoKICAgIHJldHVybiAxOwp9Cgo9aXRlbSBQYWNrYWdlUmVpbnN0YWxsKCkKCnJlaW5zdGFsbCBmaWxlcyBvZiBhIHBhY2thZ2UKCiAgICAkUGFja2FnZU9iamVjdC0+UGFja2FnZVJlaW5zdGFsbCggU3RyaW5nID0+ICRGaWxlU3RyaW5nICk7Cgo9Y3V0CgpzdWIgUGFja2FnZVJlaW5zdGFsbCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICFkZWZpbmVkICRQYXJhbXtTdHJpbmd9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnU3RyaW5nIG5vdCBkZWZpbmVkIScsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBwYXJzZSBzb3VyY2UgZmlsZQogICAgbXkgJVN0cnVjdHVyZSA9ICRTZWxmLT5QYWNrYWdlUGFyc2UoJVBhcmFtKTsKCiAgICAjIGNoZWNrIE9TCiAgICBpZiAoICRTdHJ1Y3R1cmV7T1N9ICYmICEkUGFyYW17Rm9yY2V9ICkgewogICAgICAgIHJldHVybiBpZiAhJFNlbGYtPl9PU0NoZWNrKCBPUyA9PiAkU3RydWN0dXJle09TfSApOwogICAgfQoKICAgICMgY2hlY2sgZnJhbWV3b3JrCiAgICBpZiAoICRTdHJ1Y3R1cmV7RnJhbWV3b3JrfSAmJiAhJFBhcmFte0ZvcmNlfSApIHsKICAgICAgICByZXR1cm4gaWYgISRTZWxmLT5fQ2hlY2tGcmFtZXdvcmsoIEZyYW1ld29yayA9PiAkU3RydWN0dXJle0ZyYW1ld29ya30gKTsKICAgIH0KCiAgICAjIHJlaW5zdGFsbCBjb2RlIChwcmUpCiAgICBpZiAoICRTdHJ1Y3R1cmV7Q29kZVJlaW5zdGFsbH0gKSB7CiAgICAgICAgJFNlbGYtPl9Db2RlKAogICAgICAgICAgICBDb2RlICAgICAgPT4gJFN0cnVjdHVyZXtDb2RlUmVpbnN0YWxsfSwKICAgICAgICAgICAgVHlwZSAgICAgID0+ICdwcmUnLAogICAgICAgICAgICBTdHJ1Y3R1cmUgPT4gXCVTdHJ1Y3R1cmUsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGluc3RhbGwgZmlsZXMKICAgIGlmICggJFN0cnVjdHVyZXtGaWxlbGlzdH0gJiYgcmVmICRTdHJ1Y3R1cmV7RmlsZWxpc3R9IGVxICdBUlJBWScgKSB7CiAgICAgICAgZm9yIG15ICRGaWxlICggQHsgJFN0cnVjdHVyZXtGaWxlbGlzdH0gfSApIHsKCiAgICAgICAgICAgICMgaW5zdGFsbCBmaWxlCiAgICAgICAgICAgICRTZWxmLT5fRmlsZUluc3RhbGwoCiAgICAgICAgICAgICAgICBGaWxlICAgICAgPT4gJEZpbGUsCiAgICAgICAgICAgICAgICBSZWluc3RhbGwgPT4gMQogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIGluc3RhbGwgY29uZmlnCiAgICAkU2VsZi0+e1N5c0NvbmZpZ09iamVjdH0gPSBLZXJuZWw6OlN5c3RlbTo6U3lzQ29uZmlnLT5uZXcoICV7JFNlbGZ9ICk7CiAgICAkU2VsZi0+e1N5c0NvbmZpZ09iamVjdH0tPldyaXRlRGVmYXVsdCgpOwoKICAgICMgcmVpbnN0YWxsIGNvZGUgKHBvc3QpCiAgICBpZiAoICRTdHJ1Y3R1cmV7Q29kZVJlaW5zdGFsbH0gKSB7CiAgICAgICAgJFNlbGYtPl9Db2RlKAogICAgICAgICAgICBDb2RlICAgICAgPT4gJFN0cnVjdHVyZXtDb2RlUmVpbnN0YWxsfSwKICAgICAgICAgICAgVHlwZSAgICAgID0+ICdwb3N0JywKICAgICAgICAgICAgU3RydWN0dXJlID0+IFwlU3RydWN0dXJlLAogICAgICAgICk7CiAgICB9CgogICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyktPkNsZWFuVXAoCiAgICAgICAgS2VlcFR5cGVzID0+IFsnWE1MUGFyc2UnXSwKICAgICk7CiAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9hZGVyJyktPkNhY2hlRGVsZXRlKCk7CgogICAgIyB0cmlnZ2VyIGV2ZW50CiAgICAkU2VsZi0+RXZlbnRIYW5kbGVyKAogICAgICAgIEV2ZW50ID0+ICdQYWNrYWdlUmVpbnN0YWxsJywKICAgICAgICBEYXRhICA9PiB7CiAgICAgICAgICAgIE5hbWUgICAgPT4gJFN0cnVjdHVyZXtOYW1lfS0+e0NvbnRlbnR9LAogICAgICAgICAgICBWZW5kb3IgID0+ICRTdHJ1Y3R1cmV7VmVuZG9yfS0+e0NvbnRlbnR9LAogICAgICAgICAgICBWZXJzaW9uID0+ICRTdHJ1Y3R1cmV7VmVyc2lvbn0tPntDb250ZW50fSwKICAgICAgICB9LAogICAgICAgIFVzZXJJRCA9PiAxLAogICAgKTsKCiAgICByZXR1cm4gMTsKfQoKPWl0ZW0gUGFja2FnZVVwZ3JhZGUoKQoKdXBncmFkZSBhIHBhY2thZ2UKCiAgICAkUGFja2FnZU9iamVjdC0+UGFja2FnZVVwZ3JhZGUoIFN0cmluZyA9PiAkRmlsZVN0cmluZyApOwoKPWN1dAoKc3ViIFBhY2thZ2VVcGdyYWRlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJUluc3RhbGxlZFN0cnVjdHVyZTsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgaWYgKCAhZGVmaW5lZCAkUGFyYW17U3RyaW5nfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ1N0cmluZyBub3QgZGVmaW5lZCEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgY29uZmxpY3QgY2hlY2sKICAgIG15ICVTdHJ1Y3R1cmUgPSAkU2VsZi0+UGFja2FnZVBhcnNlKCVQYXJhbSk7CgogICAgIyBjaGVjayBpZiBwYWNrYWdlIGlzIGFscmVhZHkgaW5zdGFsbGVkCiAgICBteSAkSW5zdGFsbGVkICAgICAgICA9IDA7CiAgICBteSAkSW5zdGFsbGVkVmVyc2lvbiA9IDA7CiAgICBmb3IgbXkgJFBhY2thZ2UgKCAkU2VsZi0+UmVwb3NpdG9yeUxpc3QoKSApIHsKICAgICAgICBpZiAoICRTdHJ1Y3R1cmV7TmFtZX0tPntDb250ZW50fSBlcSAkUGFja2FnZS0+e05hbWV9LT57Q29udGVudH0gKSB7CiAgICAgICAgICAgIGlmICggJFBhY2thZ2UtPntTdGF0dXN9ID1+IC9eaW5zdGFsbGVkJC9pICkgewogICAgICAgICAgICAgICAgJEluc3RhbGxlZCAgICAgICAgICA9IDE7CiAgICAgICAgICAgICAgICAkSW5zdGFsbGVkVmVyc2lvbiAgID0gJFBhY2thZ2UtPntWZXJzaW9ufS0+e0NvbnRlbnR9OwogICAgICAgICAgICAgICAgJUluc3RhbGxlZFN0cnVjdHVyZSA9ICV7JFBhY2thZ2V9OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgaWYgKCAhJEluc3RhbGxlZCApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ1BhY2thZ2UgaXMgbm90IGluc3RhbGxlZCwgY2FuXCd0IHVwZ3JhZGUhJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGNoZWNrIE9TCiAgICBpZiAoICRTdHJ1Y3R1cmV7T1N9ICYmICEkUGFyYW17Rm9yY2V9ICkgewogICAgICAgIHJldHVybiBpZiAhJFNlbGYtPl9PU0NoZWNrKCBPUyA9PiAkU3RydWN0dXJle09TfSApOwogICAgfQoKICAgICMgY2hlY2sgZnJhbWV3b3JrCiAgICBpZiAoICRTdHJ1Y3R1cmV7RnJhbWV3b3JrfSAmJiAhJFBhcmFte0ZvcmNlfSApIHsKICAgICAgICByZXR1cm4gaWYgISRTZWxmLT5fQ2hlY2tGcmFtZXdvcmsoIEZyYW1ld29yayA9PiAkU3RydWN0dXJle0ZyYW1ld29ya30gKTsKICAgIH0KCiAgICAjIGNoZWNrIHJlcXVpcmVkIHBhY2thZ2VzCiAgICBpZiAoICRTdHJ1Y3R1cmV7UGFja2FnZVJlcXVpcmVkfSAmJiAhJFBhcmFte0ZvcmNlfSApIHsKCiAgICAgICAgcmV0dXJuIGlmICEkU2VsZi0+X0NoZWNrUGFja2FnZVJlcXVpcmVkKAogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgIFBhY2thZ2VSZXF1aXJlZCA9PiAkU3RydWN0dXJle1BhY2thZ2VSZXF1aXJlZH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGNoZWNrIHJlcXVpcmVkIG1vZHVsZXMKICAgIGlmICggJFN0cnVjdHVyZXtNb2R1bGVSZXF1aXJlZH0gJiYgISRQYXJhbXtGb3JjZX0gKSB7CgogICAgICAgIHJldHVybiBpZiAhJFNlbGYtPl9DaGVja01vZHVsZVJlcXVpcmVkKAogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgIE1vZHVsZVJlcXVpcmVkID0+ICRTdHJ1Y3R1cmV7TW9kdWxlUmVxdWlyZWR9LAogICAgICAgICk7CiAgICB9CgogICAgIyBjaGVjayBtZXJnZWQgcGFja2FnZXMKICAgIGlmICggJFN0cnVjdHVyZXtQYWNrYWdlTWVyZ2V9ICkgewoKICAgICAgICAjIHVwZ3JhZGUgbWVyZ2VkIHBhY2thZ2VzIChubyBmaWxlcykKICAgICAgICByZXR1cm4gaWYgISRTZWxmLT5fTWVyZ2VkUGFja2FnZXMoCiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgU3RydWN0dXJlID0+IFwlU3RydWN0dXJlLAogICAgICAgICk7CiAgICB9CgogICAgIyBjaGVjayB2ZXJzaW9uCiAgICBteSAkQ2hlY2tWZXJzaW9uID0gJFNlbGYtPl9DaGVja1ZlcnNpb24oCiAgICAgICAgVmVyc2lvbk5ldyAgICAgICA9PiAkU3RydWN0dXJle1ZlcnNpb259LT57Q29udGVudH0sCiAgICAgICAgVmVyc2lvbkluc3RhbGxlZCA9PiAkSW5zdGFsbGVkVmVyc2lvbiwKICAgICAgICBUeXBlICAgICAgICAgICAgID0+ICdNYXgnLAogICAgKTsKCiAgICBpZiAoICEkQ2hlY2tWZXJzaW9uICkgewoKICAgICAgICBpZiAoICRTdHJ1Y3R1cmV7VmVyc2lvbn0tPntDb250ZW50fSBlcSAkSW5zdGFsbGVkVmVyc2lvbiApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICJDYW4ndCB1cGdyYWRlLCBwYWNrYWdlICckU3RydWN0dXJle05hbWV9LT57Q29udGVudH0tJEluc3RhbGxlZFZlcnNpb24nIGFscmVhZHkgaW5zdGFsbGVkISIsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICByZXR1cm4gaWYgISRQYXJhbXtGb3JjZX07CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAgICAgIkNhbid0IHVwZ3JhZGUsIGluc3RhbGxlZCBwYWNrYWdlICckSW5zdGFsbGVkVmVyc2lvbicgaXMgbmV3ZXIgYXMgJyRTdHJ1Y3R1cmV7VmVyc2lvbn0tPntDb250ZW50fSchIiwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIHJldHVybiBpZiAhJFBhcmFte0ZvcmNlfTsKICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBpZiBvbmUgb2YgdGhpcyBmaWxlcyBpcyBhbHJlYWR5IGluc3RhbGxlZCBieSBhbiBvdGhlciBwYWNrYWdlCiAgICBpZiAoICVTdHJ1Y3R1cmUgJiYgISRQYXJhbXtGb3JjZX0gKSB7CiAgICAgICAgcmV0dXJuIGlmICEkU2VsZi0+X1BhY2thZ2VGaWxlQ2hlY2soCiAgICAgICAgICAgIFN0cnVjdHVyZSA9PiBcJVN0cnVjdHVyZSwKICAgICAgICApOwogICAgfQoKICAgICMgcmVtb3ZlIG9sZCBwYWNrYWdlCiAgICByZXR1cm4gaWYgISRTZWxmLT5SZXBvc2l0b3J5UmVtb3ZlKCBOYW1lID0+ICRTdHJ1Y3R1cmV7TmFtZX0tPntDb250ZW50fSApOwoKICAgICMgYWRkIG5ldyBwYWNrYWdlCiAgICByZXR1cm4gaWYgISRTZWxmLT5SZXBvc2l0b3J5QWRkKCBTdHJpbmcgPT4gJFBhcmFte1N0cmluZ30gKTsKCiAgICAjIHVwZGF0ZSBwYWNrYWdlIHN0YXR1cwogICAgcmV0dXJuIGlmICEkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6REInKS0+RG8oCiAgICAgICAgU1FMID0+ICdVUERBVEUgcGFja2FnZV9yZXBvc2l0b3J5IFNFVCBpbnN0YWxsX3N0YXR1cyA9IFwnJwogICAgICAgICAgICAuIFRyYW5zbGF0YWJsZSgnaW5zdGFsbGVkJykgLiAnXCcnCiAgICAgICAgICAgIC4gJyBXSEVSRSBuYW1lID0gPyBBTkQgdmVyc2lvbiA9ID8nLAogICAgICAgIEJpbmQgPT4gWwogICAgICAgICAgICBcJFN0cnVjdHVyZXtOYW1lfS0+e0NvbnRlbnR9LCBcJFN0cnVjdHVyZXtWZXJzaW9ufS0+e0NvbnRlbnR9LAogICAgICAgIF0sCiAgICApOwoKICAgICMgdXBncmFkZSBjb2RlIChwcmUpCiAgICBpZiAoICRTdHJ1Y3R1cmV7Q29kZVVwZ3JhZGV9ICYmIHJlZiAkU3RydWN0dXJle0NvZGVVcGdyYWRlfSBlcSAnQVJSQVknICkgewoKICAgICAgICBteSBAUGFydHM7CiAgICAgICAgUEFSVDoKICAgICAgICBmb3IgbXkgJFBhcnQgKCBAeyAkU3RydWN0dXJle0NvZGVVcGdyYWRlfSB9ICkgewoKICAgICAgICAgICAgaWYgKCAkUGFydC0+e1ZlcnNpb259ICkgewoKICAgICAgICAgICAgICAgICMgc2tpcCBjb2RlIHVwZ3JhZGUgYmxvY2sgaWYgaXRzIHZlcnNpb24gaXMgYmlnZ2VyIHRoYW4gdGhlIG5ldyBwYWNrYWdlIHZlcnNpb24KICAgICAgICAgICAgICAgIG15ICRDaGVja1ZlcnNpb24gPSAkU2VsZi0+X0NoZWNrVmVyc2lvbigKICAgICAgICAgICAgICAgICAgICBWZXJzaW9uTmV3ICAgICAgID0+ICRQYXJ0LT57VmVyc2lvbn0sCiAgICAgICAgICAgICAgICAgICAgVmVyc2lvbkluc3RhbGxlZCA9PiAkU3RydWN0dXJle1ZlcnNpb259LT57Q29udGVudH0sCiAgICAgICAgICAgICAgICAgICAgVHlwZSAgICAgICAgICAgICA9PiAnTWF4JywKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgbmV4dCBQQVJUIGlmICRDaGVja1ZlcnNpb247CgogICAgICAgICAgICAgICAgJENoZWNrVmVyc2lvbiA9ICRTZWxmLT5fQ2hlY2tWZXJzaW9uKAogICAgICAgICAgICAgICAgICAgIFZlcnNpb25OZXcgICAgICAgPT4gJFBhcnQtPntWZXJzaW9ufSwKICAgICAgICAgICAgICAgICAgICBWZXJzaW9uSW5zdGFsbGVkID0+ICRJbnN0YWxsZWRWZXJzaW9uLAogICAgICAgICAgICAgICAgICAgIFR5cGUgICAgICAgICAgICAgPT4gJ01pbicsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIGlmICggISRDaGVja1ZlcnNpb24gKSB7CiAgICAgICAgICAgICAgICAgICAgcHVzaCBAUGFydHMsICRQYXJ0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcHVzaCBAUGFydHMsICRQYXJ0OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkU2VsZi0+X0NvZGUoCiAgICAgICAgICAgIENvZGUgICAgICA9PiBcQFBhcnRzLAogICAgICAgICAgICBUeXBlICAgICAgPT4gJ3ByZScsCiAgICAgICAgICAgIFN0cnVjdHVyZSA9PiBcJVN0cnVjdHVyZSwKICAgICAgICApOwogICAgfQoKICAgICMgdXBncmFkZSBkYXRhYmFzZSAocHJlKQogICAgaWYgKCAkU3RydWN0dXJle0RhdGFiYXNlVXBncmFkZX0tPntwcmV9ICYmIHJlZiAkU3RydWN0dXJle0RhdGFiYXNlVXBncmFkZX0tPntwcmV9IGVxICdBUlJBWScgKSB7CgogICAgICAgIG15IEBQYXJ0czsKICAgICAgICBteSAkVXNlID0gMDsKICAgICAgICBteSAkVXNlSW5zdGFsbGVkOwogICAgICAgIG15ICROb3RVc2VUYWc7CiAgICAgICAgbXkgJE5vdFVzZVRhZ0xldmVsOwogICAgICAgIFBBUlREQjoKICAgICAgICBmb3IgbXkgJFBhcnQgKCBAeyAkU3RydWN0dXJle0RhdGFiYXNlVXBncmFkZX0tPntwcmV9IH0gKSB7CgogICAgICAgICAgICBpZiAoICEkVXNlSW5zdGFsbGVkICkgewoKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAkUGFydC0+e1RhZ1R5cGV9IGVxICdFbmQnCiAgICAgICAgICAgICAgICAgICAgJiYgKCBkZWZpbmVkICROb3RVc2VUYWcgICAgICAmJiAkUGFydC0+e1RhZ30gZXEgJE5vdFVzZVRhZyApCiAgICAgICAgICAgICAgICAgICAgJiYgKCBkZWZpbmVkICROb3RVc2VUYWdMZXZlbCAmJiAkUGFydC0+e1RhZ0xldmVsfSBlcSAkTm90VXNlVGFnTGV2ZWwgKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkVXNlSW5zdGFsbGVkID0gMTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBuZXh0IFBBUlREQjsKCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKAogICAgICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgICAgIGRlZmluZWQgJFBhcnQtPntJZlBhY2thZ2V9CiAgICAgICAgICAgICAgICAgICAgJiYgISRTZWxmLT57TWVyZ2VkUGFja2FnZXN9LT57ICRQYXJ0LT57SWZQYWNrYWdlfSB9CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICB8fCAoCiAgICAgICAgICAgICAgICAgICAgZGVmaW5lZCAkUGFydC0+e0lmTm90UGFja2FnZX0KICAgICAgICAgICAgICAgICAgICAmJgogICAgICAgICAgICAgICAgICAgICgKICAgICAgICAgICAgICAgICAgICAgICAgZGVmaW5lZCAkU2VsZi0+e01lcmdlZFBhY2thZ2VzfS0+eyAkUGFydC0+e0lmTm90UGFja2FnZX0gfQogICAgICAgICAgICAgICAgICAgICAgICB8fCAkU2VsZi0+UGFja2FnZUlzSW5zdGFsbGVkKCBOYW1lID0+ICRQYXJ0LT57SWZOb3RQYWNrYWdlfSApCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAjIHN0b3JlIFRhZyBhbmQgVGFnTGV2ZWwgdG8gYmUgdXNlZCBsYXRlciBhbmQgZm91bmQgdGhlIGVuZCBvZiB0aGlzIGxldmVsCiAgICAgICAgICAgICAgICAkTm90VXNlVGFnICAgICAgPSAkUGFydC0+e1RhZ307CiAgICAgICAgICAgICAgICAkTm90VXNlVGFnTGV2ZWwgPSAkUGFydC0+e1RhZ0xldmVsfTsKCiAgICAgICAgICAgICAgICAkVXNlSW5zdGFsbGVkID0gMDsKCiAgICAgICAgICAgICAgICBuZXh0IFBBUlREQjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCAkUGFydC0+e1RhZ0xldmVsfSA9PSAzICYmICRQYXJ0LT57VmVyc2lvbn0gKSB7CgogICAgICAgICAgICAgICAgbXkgJENoZWNrVmVyc2lvbiA9ICRTZWxmLT5fQ2hlY2tWZXJzaW9uKAogICAgICAgICAgICAgICAgICAgIFZlcnNpb25OZXcgICAgICAgPT4gJFBhcnQtPntWZXJzaW9ufSwKICAgICAgICAgICAgICAgICAgICBWZXJzaW9uSW5zdGFsbGVkID0+ICRJbnN0YWxsZWRWZXJzaW9uLAogICAgICAgICAgICAgICAgICAgIFR5cGUgICAgICAgICAgICAgPT4gJ01pbicsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIGlmICggISRDaGVja1ZlcnNpb24gKSB7CiAgICAgICAgICAgICAgICAgICAgJFVzZSAgID0gMTsKICAgICAgICAgICAgICAgICAgICBAUGFydHMgPSAoKTsKICAgICAgICAgICAgICAgICAgICBwdXNoIEBQYXJ0cywgJFBhcnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCAkVXNlICYmICRQYXJ0LT57VGFnTGV2ZWx9ID09IDMgJiYgJFBhcnQtPntUYWdUeXBlfSBlcSAnRW5kJyApIHsKICAgICAgICAgICAgICAgICRVc2UgPSAwOwogICAgICAgICAgICAgICAgcHVzaCBAUGFydHMsICRQYXJ0OwogICAgICAgICAgICAgICAgJFNlbGYtPl9EYXRhYmFzZSggRGF0YWJhc2UgPT4gXEBQYXJ0cyApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2lmICgkVXNlKSB7CiAgICAgICAgICAgICAgICBwdXNoIEBQYXJ0cywgJFBhcnQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyB1bmluc3RhbGwgb2xkIHBhY2thZ2UgZmlsZXMKICAgIGlmICggJEluc3RhbGxlZFN0cnVjdHVyZXtGaWxlbGlzdH0gJiYgcmVmICRJbnN0YWxsZWRTdHJ1Y3R1cmV7RmlsZWxpc3R9IGVxICdBUlJBWScgKSB7CiAgICAgICAgZm9yIG15ICRGaWxlICggQHsgJEluc3RhbGxlZFN0cnVjdHVyZXtGaWxlbGlzdH0gfSApIHsKCiAgICAgICAgICAgICMgcmVtb3ZlIGZpbGUKICAgICAgICAgICAgJFNlbGYtPl9GaWxlUmVtb3ZlKCBGaWxlID0+ICRGaWxlICk7CiAgICAgICAgfQogICAgfQoKICAgICMgaW5zdGFsbCBmaWxlcwogICAgaWYgKCAkU3RydWN0dXJle0ZpbGVsaXN0fSAmJiByZWYgJFN0cnVjdHVyZXtGaWxlbGlzdH0gZXEgJ0FSUkFZJyApIHsKICAgICAgICBmb3IgbXkgJEZpbGUgKCBAeyAkU3RydWN0dXJle0ZpbGVsaXN0fSB9ICkgewoKICAgICAgICAgICAgIyBpbnN0YWxsIGZpbGUKICAgICAgICAgICAgJFNlbGYtPl9GaWxlSW5zdGFsbCggRmlsZSA9PiAkRmlsZSApOwogICAgICAgIH0KICAgIH0KCiAgICAjIGluc3RhbGwgY29uZmlnCiAgICAkU2VsZi0+e1N5c0NvbmZpZ09iamVjdH0gPSBLZXJuZWw6OlN5c3RlbTo6U3lzQ29uZmlnLT5uZXcoICV7JFNlbGZ9ICk7CiAgICAkU2VsZi0+e1N5c0NvbmZpZ09iamVjdH0tPldyaXRlRGVmYXVsdCgpOwoKICAgICMgdXBncmFkZSBkYXRhYmFzZSAocG9zdCkKICAgIGlmICggJFN0cnVjdHVyZXtEYXRhYmFzZVVwZ3JhZGV9LT57cG9zdH0gJiYgcmVmICRTdHJ1Y3R1cmV7RGF0YWJhc2VVcGdyYWRlfS0+e3Bvc3R9IGVxICdBUlJBWScgKQogICAgewoKICAgICAgICBteSBAUGFydHM7CiAgICAgICAgbXkgJFVzZSAgICAgICAgICA9IDA7CiAgICAgICAgbXkgJFVzZUluc3RhbGxlZCA9IDE7CiAgICAgICAgbXkgJE5vdFVzZVRhZzsKICAgICAgICBteSAkTm90VXNlVGFnTGV2ZWw7CiAgICAgICAgUEFSVERCOgogICAgICAgIGZvciBteSAkUGFydCAoIEB7ICRTdHJ1Y3R1cmV7RGF0YWJhc2VVcGdyYWRlfS0+e3Bvc3R9IH0gKSB7CgogICAgICAgICAgICBpZiAoICEkVXNlSW5zdGFsbGVkICkgewoKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAkUGFydC0+e1RhZ1R5cGV9IGVxICdFbmQnCiAgICAgICAgICAgICAgICAgICAgJiYgKCBkZWZpbmVkICROb3RVc2VUYWcgICAgICAmJiAkUGFydC0+e1RhZ30gZXEgJE5vdFVzZVRhZyApCiAgICAgICAgICAgICAgICAgICAgJiYgKCBkZWZpbmVkICROb3RVc2VUYWdMZXZlbCAmJiAkUGFydC0+e1RhZ0xldmVsfSBlcSAkTm90VXNlVGFnTGV2ZWwgKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkVXNlSW5zdGFsbGVkID0gMTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBuZXh0IFBBUlREQjsKCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKAogICAgICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgICAgIGRlZmluZWQgJFBhcnQtPntJZlBhY2thZ2V9CiAgICAgICAgICAgICAgICAgICAgJiYgISRTZWxmLT57TWVyZ2VkUGFja2FnZXN9LT57ICRQYXJ0LT57SWZQYWNrYWdlfSB9CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICB8fCAoCiAgICAgICAgICAgICAgICAgICAgZGVmaW5lZCAkUGFydC0+e0lmTm90UGFja2FnZX0KICAgICAgICAgICAgICAgICAgICAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmluZWQgJFNlbGYtPntNZXJnZWRQYWNrYWdlc30tPnsgJFBhcnQtPntJZk5vdFBhY2thZ2V9IH0KICAgICAgICAgICAgICAgICAgICAgICAgfHwgJFNlbGYtPlBhY2thZ2VJc0luc3RhbGxlZCggTmFtZSA9PiAkUGFydC0+e0lmTm90UGFja2FnZX0gKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIyBzdG9yZSBUYWcgYW5kIFRhZ0xldmVsIHRvIGJlIHVzZWQgbGF0ZXIgYW5kIGZvdW5kIHRoZSBlbmQgb2YgdGhpcyBsZXZlbAogICAgICAgICAgICAgICAgJE5vdFVzZVRhZyAgICAgID0gJFBhcnQtPntUYWd9OwogICAgICAgICAgICAgICAgJE5vdFVzZVRhZ0xldmVsID0gJFBhcnQtPntUYWdMZXZlbH07CgogICAgICAgICAgICAgICAgJFVzZUluc3RhbGxlZCA9IDA7CgogICAgICAgICAgICAgICAgbmV4dCBQQVJUREI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICggJFBhcnQtPntUYWdMZXZlbH0gPT0gMyAmJiAkUGFydC0+e1ZlcnNpb259ICkgewoKICAgICAgICAgICAgICAgIG15ICRDaGVja1ZlcnNpb24gPSAkU2VsZi0+X0NoZWNrVmVyc2lvbigKICAgICAgICAgICAgICAgICAgICBWZXJzaW9uTmV3ICAgICAgID0+ICRQYXJ0LT57VmVyc2lvbn0sCiAgICAgICAgICAgICAgICAgICAgVmVyc2lvbkluc3RhbGxlZCA9PiAkSW5zdGFsbGVkVmVyc2lvbiwKICAgICAgICAgICAgICAgICAgICBUeXBlICAgICAgICAgICAgID0+ICdNaW4nLAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBpZiAoICEkQ2hlY2tWZXJzaW9uICkgewogICAgICAgICAgICAgICAgICAgICRVc2UgICA9IDE7CiAgICAgICAgICAgICAgICAgICAgQFBhcnRzID0gKCk7CiAgICAgICAgICAgICAgICAgICAgcHVzaCBAUGFydHMsICRQYXJ0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2lmICggJFVzZSAmJiAkUGFydC0+e1RhZ0xldmVsfSA9PSAzICYmICRQYXJ0LT57VGFnVHlwZX0gZXEgJ0VuZCcgKSB7CgogICAgICAgICAgICAgICAgJFVzZSA9IDA7CiAgICAgICAgICAgICAgICBwdXNoIEBQYXJ0cywgJFBhcnQ7CiAgICAgICAgICAgICAgICAkU2VsZi0+X0RhdGFiYXNlKCBEYXRhYmFzZSA9PiBcQFBhcnRzICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCRVc2UpIHsKICAgICAgICAgICAgICAgIHB1c2ggQFBhcnRzLCAkUGFydDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAjIHVwZ3JhZGUgY29kZSAocG9zdCkKICAgIGlmICggJFN0cnVjdHVyZXtDb2RlVXBncmFkZX0gJiYgcmVmICRTdHJ1Y3R1cmV7Q29kZVVwZ3JhZGV9IGVxICdBUlJBWScgKSB7CgogICAgICAgIG15IEBQYXJ0czsKICAgICAgICBQQVJUOgogICAgICAgIGZvciBteSAkUGFydCAoIEB7ICRTdHJ1Y3R1cmV7Q29kZVVwZ3JhZGV9IH0gKSB7CgogICAgICAgICAgICBpZiAoICRQYXJ0LT57VmVyc2lvbn0gKSB7CgogICAgICAgICAgICAgICAgIyBza2lwIGNvZGUgdXBncmFkZSBibG9jayBpZiBpdHMgdmVyc2lvbiBpcyBiaWdnZXIgdGhhbiB0aGUgbmV3IHBhY2thZ2UgdmVyc2lvbgogICAgICAgICAgICAgICAgbXkgJENoZWNrVmVyc2lvbiA9ICRTZWxmLT5fQ2hlY2tWZXJzaW9uKAogICAgICAgICAgICAgICAgICAgIFZlcnNpb25OZXcgICAgICAgPT4gJFBhcnQtPntWZXJzaW9ufSwKICAgICAgICAgICAgICAgICAgICBWZXJzaW9uSW5zdGFsbGVkID0+ICRTdHJ1Y3R1cmV7VmVyc2lvbn0tPntDb250ZW50fSwKICAgICAgICAgICAgICAgICAgICBUeXBlICAgICAgICAgICAgID0+ICdNYXgnLAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBuZXh0IFBBUlQgaWYgJENoZWNrVmVyc2lvbjsKCiAgICAgICAgICAgICAgICAkQ2hlY2tWZXJzaW9uID0gJFNlbGYtPl9DaGVja1ZlcnNpb24oCiAgICAgICAgICAgICAgICAgICAgVmVyc2lvbk5ldyAgICAgICA9PiAkUGFydC0+e1ZlcnNpb259LAogICAgICAgICAgICAgICAgICAgIFZlcnNpb25JbnN0YWxsZWQgPT4gJEluc3RhbGxlZFZlcnNpb24sCiAgICAgICAgICAgICAgICAgICAgVHlwZSAgICAgICAgICAgICA9PiAnTWluJywKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgaWYgKCAhJENoZWNrVmVyc2lvbiApIHsKICAgICAgICAgICAgICAgICAgICBwdXNoIEBQYXJ0cywgJFBhcnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBwdXNoIEBQYXJ0cywgJFBhcnQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRTZWxmLT5fQ29kZSgKICAgICAgICAgICAgQ29kZSAgICAgID0+IFxAUGFydHMsCiAgICAgICAgICAgIFR5cGUgICAgICA9PiAncG9zdCcsCiAgICAgICAgICAgIFN0cnVjdHVyZSA9PiBcJVN0cnVjdHVyZSwKICAgICAgICApOwogICAgfQoKICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpLT5DbGVhblVwKAogICAgICAgIEtlZXBUeXBlcyA9PiBbJ1hNTFBhcnNlJ10sCiAgICApOwogICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvYWRlcicpLT5DYWNoZURlbGV0ZSgpOwoKICAgICMgdHJpZ2dlciBldmVudAogICAgJFNlbGYtPkV2ZW50SGFuZGxlcigKICAgICAgICBFdmVudCA9PiAnUGFja2FnZVVwZ3JhZGUnLAogICAgICAgIERhdGEgID0+IHsKICAgICAgICAgICAgTmFtZSAgICA9PiAkU3RydWN0dXJle05hbWV9LT57Q29udGVudH0sCiAgICAgICAgICAgIFZlbmRvciAgPT4gJFN0cnVjdHVyZXtWZW5kb3J9LT57Q29udGVudH0sCiAgICAgICAgICAgIFZlcnNpb24gPT4gJFN0cnVjdHVyZXtWZXJzaW9ufS0+e0NvbnRlbnR9LAogICAgICAgIH0sCiAgICAgICAgVXNlcklEID0+IDEsCiAgICApOwoKICAgIHJldHVybiAxOwp9Cgo9aXRlbSBQYWNrYWdlVW5pbnN0YWxsKCkKCnVuaW5zdGFsbCBhIHBhY2thZ2UKCiAgICAkUGFja2FnZU9iamVjdC0+UGFja2FnZVVuaW5zdGFsbCggU3RyaW5nID0+ICRGaWxlU3RyaW5nICk7Cgo9Y3V0CgpzdWIgUGFja2FnZVVuaW5zdGFsbCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICFkZWZpbmVkICRQYXJhbXtTdHJpbmd9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnU3RyaW5nIG5vdCBkZWZpbmVkIScKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIHBhcnNlIHNvdXJjZSBmaWxlCiAgICBteSAlU3RydWN0dXJlID0gJFNlbGYtPlBhY2thZ2VQYXJzZSglUGFyYW0pOwoKICAgICMgY2hlY2sgZGVwZW5kcwogICAgaWYgKCAhJFBhcmFte0ZvcmNlfSApIHsKICAgICAgICByZXR1cm4gaWYgISRTZWxmLT5fQ2hlY2tQYWNrYWdlRGVwZW5kcyggTmFtZSA9PiAkU3RydWN0dXJle05hbWV9LT57Q29udGVudH0gKTsKICAgIH0KCiAgICAjIHVuaW5zdGFsbCBjb2RlIChwcmUpCiAgICBpZiAoICRTdHJ1Y3R1cmV7Q29kZVVuaW5zdGFsbH0gKSB7CiAgICAgICAgJFNlbGYtPl9Db2RlKAogICAgICAgICAgICBDb2RlICAgICAgPT4gJFN0cnVjdHVyZXtDb2RlVW5pbnN0YWxsfSwKICAgICAgICAgICAgVHlwZSAgICAgID0+ICdwcmUnLAogICAgICAgICAgICBTdHJ1Y3R1cmUgPT4gXCVTdHJ1Y3R1cmUsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIHVuaW5zdGFsbCBkYXRhYmFzZSAocHJlKQogICAgaWYgKCAkU3RydWN0dXJle0RhdGFiYXNlVW5pbnN0YWxsfSAmJiAkU3RydWN0dXJle0RhdGFiYXNlVW5pbnN0YWxsfS0+e3ByZX0gKSB7CiAgICAgICAgJFNlbGYtPl9EYXRhYmFzZSggRGF0YWJhc2UgPT4gJFN0cnVjdHVyZXtEYXRhYmFzZVVuaW5zdGFsbH0tPntwcmV9ICk7CiAgICB9CgogICAgIyBmaWxlcwogICAgbXkgJEZpbGVDaGVja09rID0gMTsKICAgIGlmICggJFN0cnVjdHVyZXtGaWxlbGlzdH0gJiYgcmVmICRTdHJ1Y3R1cmV7RmlsZWxpc3R9IGVxICdBUlJBWScgKSB7CiAgICAgICAgZm9yIG15ICRGaWxlICggQHsgJFN0cnVjdHVyZXtGaWxlbGlzdH0gfSApIHsKCiAgICAgICAgICAgICMgcmVtb3ZlIGZpbGUKICAgICAgICAgICAgJFNlbGYtPl9GaWxlUmVtb3ZlKCBGaWxlID0+ICRGaWxlICk7CiAgICAgICAgfQogICAgfQoKICAgICMgcmVtb3ZlIG9sZCBwYWNrYWdlcwogICAgJFNlbGYtPlJlcG9zaXRvcnlSZW1vdmUoIE5hbWUgPT4gJFN0cnVjdHVyZXtOYW1lfS0+e0NvbnRlbnR9ICk7CgogICAgIyBpbnN0YWxsIGNvbmZpZwogICAgJFNlbGYtPntTeXNDb25maWdPYmplY3R9ID0gS2VybmVsOjpTeXN0ZW06OlN5c0NvbmZpZy0+bmV3KCAleyRTZWxmfSApOwogICAgJFNlbGYtPntTeXNDb25maWdPYmplY3R9LT5Xcml0ZURlZmF1bHQoKTsKCiAgICAjIHVuaW5zdGFsbCBkYXRhYmFzZSAocG9zdCkKICAgIGlmICggJFN0cnVjdHVyZXtEYXRhYmFzZVVuaW5zdGFsbH0gJiYgJFN0cnVjdHVyZXtEYXRhYmFzZVVuaW5zdGFsbH0tPntwb3N0fSApIHsKICAgICAgICAkU2VsZi0+X0RhdGFiYXNlKCBEYXRhYmFzZSA9PiAkU3RydWN0dXJle0RhdGFiYXNlVW5pbnN0YWxsfS0+e3Bvc3R9ICk7CiAgICB9CgogICAgIyB1bmluc3RhbGwgY29kZSAocG9zdCkKICAgIGlmICggJFN0cnVjdHVyZXtDb2RlVW5pbnN0YWxsfSApIHsKICAgICAgICAkU2VsZi0+X0NvZGUoCiAgICAgICAgICAgIENvZGUgICAgICA9PiAkU3RydWN0dXJle0NvZGVVbmluc3RhbGx9LAogICAgICAgICAgICBUeXBlICAgICAgPT4gJ3Bvc3QnLAogICAgICAgICAgICBTdHJ1Y3R1cmUgPT4gXCVTdHJ1Y3R1cmUsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGluc3RhbGwgY29uZmlnCiAgICAkU2VsZi0+e0NvbmZpZ09iamVjdH0gPSBLZXJuZWw6OkNvbmZpZy0+bmV3KCAleyRTZWxmfSApOwoKICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpLT5DbGVhblVwKAogICAgICAgIEtlZXBUeXBlcyA9PiBbJ1hNTFBhcnNlJ10sCiAgICApOwogICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvYWRlcicpLT5DYWNoZURlbGV0ZSgpOwoKICAgICMgdHJpZ2dlciBldmVudAogICAgJFNlbGYtPkV2ZW50SGFuZGxlcigKICAgICAgICBFdmVudCA9PiAnUGFja2FnZVVuaW5zdGFsbCcsCiAgICAgICAgRGF0YSAgPT4gewogICAgICAgICAgICBOYW1lICAgID0+ICRTdHJ1Y3R1cmV7TmFtZX0tPntDb250ZW50fSwKICAgICAgICAgICAgVmVuZG9yICA9PiAkU3RydWN0dXJle1ZlbmRvcn0tPntDb250ZW50fSwKICAgICAgICAgICAgVmVyc2lvbiA9PiAkU3RydWN0dXJle1ZlcnNpb259LT57Q29udGVudH0sCiAgICAgICAgfSwKICAgICAgICBVc2VySUQgPT4gMSwKICAgICk7CgogICAgcmV0dXJuIDE7Cn0KCj1pdGVtIFBhY2thZ2VPbmxpbmVSZXBvc2l0b3JpZXMoKQoKcmV0dXJucyBhIGxpc3Qgb2YgYXZhaWxhYmxlIG9ubGluZSByZXBvc2l0b3JpZXMKCiAgICBteSAlTGlzdCA9ICRQYWNrYWdlT2JqZWN0LT5QYWNrYWdlT25saW5lUmVwb3NpdG9yaWVzKCk7Cgo9Y3V0CgpzdWIgUGFja2FnZU9ubGluZVJlcG9zaXRvcmllcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgaWYgb25saW5lIHJlcG9zaXRvcnkgc2hvdWxkIGJlIGZldGNoZWQKICAgIHJldHVybiAoKSBpZiAhJFNlbGYtPntDb25maWdPYmplY3R9LT5HZXQoJ1BhY2thZ2U6OlJlcG9zaXRvcnlSb290Jyk7CgogICAgIyBnZXQgcmVwb3NpdG9yeSBsaXN0CiAgICBteSAkWE1MID0gJyc7CiAgICBVUkw6CiAgICBmb3IgbXkgJFVSTCAoIEB7ICRTZWxmLT57Q29uZmlnT2JqZWN0fS0+R2V0KCdQYWNrYWdlOjpSZXBvc2l0b3J5Um9vdCcpIH0gKSB7CgogICAgICAgICRYTUwgPSAkU2VsZi0+X0Rvd25sb2FkKCBVUkwgPT4gJFVSTCApOwoKICAgICAgICBsYXN0IFVSTCBpZiAkWE1MOwogICAgfQoKICAgIHJldHVybiBpZiAhJFhNTDsKCiAgICBteSBAWE1MQVJSQVkgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6WE1MJyktPlhNTFBhcnNlKCBTdHJpbmcgPT4gJFhNTCApOwoKICAgIG15ICVMaXN0OwogICAgbXkgJE5hbWUgPSAnJzsKCiAgICBUQUc6CiAgICBmb3IgbXkgJFRhZyAoQFhNTEFSUkFZKSB7CgogICAgICAgICMganVzdCB1c2Ugc3RhcnQgdGFncwogICAgICAgIG5leHQgVEFHIGlmICRUYWctPntUYWdUeXBlfSBuZSAnU3RhcnQnOwoKICAgICAgICAjIHJlc2V0IHBhY2thZ2UgZGF0YQogICAgICAgIGlmICggJFRhZy0+e1RhZ30gZXEgJ1JlcG9zaXRvcnknICkgewogICAgICAgICAgICAkTmFtZSA9ICcnOwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRUYWctPntUYWd9IGVxICdOYW1lJyApIHsKICAgICAgICAgICAgJE5hbWUgPSAkVGFnLT57Q29udGVudH07CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJFRhZy0+e1RhZ30gZXEgJ1VSTCcgKSB7CiAgICAgICAgICAgIGlmICgkTmFtZSkgewogICAgICAgICAgICAgICAgJExpc3R7ICRUYWctPntDb250ZW50fSB9ID0gJE5hbWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuICVMaXN0Owp9Cgo9aXRlbSBQYWNrYWdlT25saW5lTGlzdCgpCgpyZXR1cm5zIGEgbGlzdCBvZiBhdmFpbGFibGUgb24tbGluZSBwYWNrYWdlcwoKICAgIG15IEBMaXN0ID0gJFBhY2thZ2VPYmplY3QtPlBhY2thZ2VPbmxpbmVMaXN0KAogICAgICAgIFVSTCAgPT4gJycsCiAgICAgICAgTGFuZyA9PiAnZW4nLAogICAgICAgIENhY2hlID0+IDAsICAgIyAob3B0aW9uYWwpIGRvIG5vdCB1c2UgY2FjaGVkIGRhdGEKICAgICAgICBGcm9tQ2xvdWQgPT4gMSwgIyBvcHRpb25hbCAxIG9yIDAsIGl0IGluZGljYXRlcyBpZiBhIENsb3VkIFNlcnZpY2UKICAgICAgICAgICAgICAgICAgICAgICAgIyBzaG91bGQgYmUgdXNlZCBmb3IgZ2V0dGluZyB0aGUgcGFja2FnZXMgbGlzdAogICAgKTsKCj1jdXQKCnN1YiBQYWNrYWdlT25saW5lTGlzdCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoVVJMIExhbmcpKSB7CiAgICAgICAgaWYgKCAhZGVmaW5lZCAkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICIkTmVlZGVkIG5vdCBkZWZpbmVkISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CiAgICBpZiAoICFkZWZpbmVkICRQYXJhbXtDYWNoZX0gKSB7CgogICAgICAgIGlmICggJFBhcmFte1VSTH0gPX4gbXsgXC5vdHJzXC5vcmdcLyB9eG1zICkgewogICAgICAgICAgICAkUGFyYW17Q2FjaGV9ID0gMTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRQYXJhbXtDYWNoZX0gPSAwOwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCBjYWNoZSBvYmplY3QKICAgIG15ICRDYWNoZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpOwoKICAgICMgY2hlY2sgY2FjaGUKICAgIG15ICRDYWNoZUtleSA9ICRQYXJhbXtVUkx9IC4gJy0nIC4gJFBhcmFte0xhbmd9OwogICAgaWYgKCAkUGFyYW17Q2FjaGV9ICkgewogICAgICAgIG15ICRDYWNoZSA9ICRDYWNoZU9iamVjdC0+R2V0KAogICAgICAgICAgICBUeXBlID0+ICdQYWNrYWdlT25saW5lTGlzdCcsCiAgICAgICAgICAgIEtleSAgPT4gJENhY2hlS2V5LAogICAgICAgICk7CiAgICAgICAgcmV0dXJuIEB7JENhY2hlfSBpZiAkQ2FjaGU7CiAgICB9CgogICAgbXkgQFBhY2thZ2VzOwogICAgbXkgJVBhY2thZ2U7CiAgICBteSAkRmlsZWxpc3Q7CiAgICBpZiAoICEkUGFyYW17RnJvbUNsb3VkfSApIHsKCiAgICAgICAgbXkgJFhNTCA9ICRTZWxmLT5fRG93bmxvYWQoIFVSTCA9PiAkUGFyYW17VVJMfSAuICcvb3Rycy54bWwnICk7CiAgICAgICAgcmV0dXJuIGlmICEkWE1MOwoKICAgICAgICBteSBAWE1MQVJSQVkgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6WE1MJyktPlhNTFBhcnNlKCBTdHJpbmcgPT4gJFhNTCApOwoKICAgICAgICBpZiAoICFAWE1MQVJSQVkgKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+IFRyYW5zbGF0YWJsZSgnVW5hYmxlIHRvIHBhcnNlIHJlcG9zaXRvcnkgaW5kZXggZG9jdW1lbnQuJyksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIFRBRzoKICAgICAgICBmb3IgbXkgJFRhZyAoQFhNTEFSUkFZKSB7CgogICAgICAgICAgICAjIHJlbWVtYmVyIHBhY2thZ2UKICAgICAgICAgICAgaWYgKCAkVGFnLT57VGFnVHlwZX0gZXEgJ0VuZCcgJiYgJFRhZy0+e1RhZ30gZXEgJ1BhY2thZ2UnICkgewogICAgICAgICAgICAgICAgaWYgKCVQYWNrYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgcHVzaCBAUGFja2FnZXMsIHslUGFja2FnZX07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBuZXh0IFRBRzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBqdXN0IHVzZSBzdGFydCB0YWdzCiAgICAgICAgICAgIG5leHQgVEFHIGlmICRUYWctPntUYWdUeXBlfSBuZSAnU3RhcnQnOwoKICAgICAgICAgICAgIyByZXNldCBwYWNrYWdlIGRhdGEKICAgICAgICAgICAgaWYgKCAkVGFnLT57VGFnfSBlcSAnUGFja2FnZScgKSB7CiAgICAgICAgICAgICAgICAlUGFja2FnZSAgPSAoKTsKICAgICAgICAgICAgICAgICRGaWxlbGlzdCA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCAkVGFnLT57VGFnfSBlcSAnRnJhbWV3b3JrJyApIHsKICAgICAgICAgICAgICAgIHB1c2ggQHsgJFBhY2thZ2V7RnJhbWV3b3JrfSB9LCAkVGFnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2lmICggJFRhZy0+e1RhZ30gZXEgJ0ZpbGVsaXN0JyApIHsKICAgICAgICAgICAgICAgICRGaWxlbGlzdCA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCAkRmlsZWxpc3QgJiYgJFRhZy0+e1RhZ30gZXEgJ0ZpbGVEb2MnICkgewogICAgICAgICAgICAgICAgcHVzaCBAeyAkUGFja2FnZXtGaWxlbGlzdH0gfSwgJFRhZzsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNpZiAoICRUYWctPntUYWd9IGVxICdEZXNjcmlwdGlvbicgKSB7CiAgICAgICAgICAgICAgICBpZiAoICEkUGFja2FnZXtEZXNjcmlwdGlvbn0gKSB7CiAgICAgICAgICAgICAgICAgICAgJFBhY2thZ2V7RGVzY3JpcHRpb259ID0gJFRhZy0+e0NvbnRlbnR9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCAkVGFnLT57TGFuZ30gZXEgJFBhcmFte0xhbmd9ICkgewogICAgICAgICAgICAgICAgICAgICRQYWNrYWdle0Rlc2NyaXB0aW9ufSA9ICRUYWctPntDb250ZW50fTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRQYWNrYWdleyAkVGFnLT57VGFnfSB9ID0gJFRhZy0+e0NvbnRlbnR9OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0KICAgIGVsc2UgewoKICAgICAgICAjIE9uIHRoaXMgY2FzZSBhIGNsb3VkIHNlcnZpY2UgaXMgdXNlZCwgYSBVUkwgaXMgbm90CiAgICAgICAgIyBuZWVkZWQsIGluc3RlYWQgYSBvcGVyYXRpb24gbmFtZSwgcHJlc2VudCBvbiB0aGUgVVJMCiAgICAgICAgIyBwYXJhbWV0ZXIgaW4gb3JkZXIgdG8gbWF0Y2ggd2l0aCB0aGUgcHJldmlvdXMgc3RydWN0dXJlCiAgICAgICAgbXkgJE9wZXJhdGlvbiA9ICRQYXJhbXtVUkx9OwoKICAgICAgICAjIGdldCBsaXN0IGZyb20gY2xvdWQKICAgICAgICBteSAkTGlzdFJlc3VsdCA9ICRTZWxmLT5DbG91ZEZpbGVHZXQoCiAgICAgICAgICAgIE9wZXJhdGlvbiA9PiAkT3BlcmF0aW9uLAogICAgICAgICk7CgogICAgICAgICMgY2hlY2sgcmVzdWx0IHN0cnVjdHVyZQogICAgICAgIHJldHVybiBpZiAhSXNIYXNoUmVmV2l0aERhdGEoJExpc3RSZXN1bHQpOwoKICAgICAgICBteSAkQ3VycmVudEZyYW1ld29yayA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnVmVyc2lvbicpOwogICAgICAgIEZSQU1FV09SS1ZFUlNJT046CiAgICAgICAgZm9yIG15ICRGcmFtZXdvcmtWZXJzaW9uICggc29ydCBrZXlzICV7JExpc3RSZXN1bHR9ICkgewoKICAgICAgICAgICAgaWYgKCAkQ3VycmVudEZyYW1ld29yayA9fiBteyBcQSAkRnJhbWV3b3JrVmVyc2lvbiB9eG1zICkgewoKICAgICAgICAgICAgICAgIEBQYWNrYWdlcyA9IEB7ICRMaXN0UmVzdWx0LT57JEZyYW1ld29ya1ZlcnNpb259IH07CiAgICAgICAgICAgICAgICBsYXN0IEZSQU1FV09SS1ZFUlNJT047CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBpZiBub3QgcGFja2FnZXMgZm91bmQsIGp1c3QgcmV0dXJuCiAgICByZXR1cm4gaWYgIUBQYWNrYWdlczsKCiAgICAjIGp1c3QgZnJhbWV3b3JrIHBhY2thZ2VzCiAgICBteSBATmV3UGFja2FnZXM7CiAgICBteSAkUGFja2FnZUZvclJlcXVlc3RlZEZyYW1ld29yayA9IDA7CiAgICBmb3IgbXkgJFBhY2thZ2UgKEBQYWNrYWdlcykgewoKICAgICAgICBteSAkRldDaGVja09rID0gMDsKCiAgICAgICAgaWYgKCAkUGFja2FnZS0+e0ZyYW1ld29ya30gKSB7CgogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAkU2VsZi0+X0NoZWNrRnJhbWV3b3JrKAogICAgICAgICAgICAgICAgICAgIEZyYW1ld29yayA9PiAkUGFja2FnZS0+e0ZyYW1ld29ya30sCiAgICAgICAgICAgICAgICAgICAgTm9Mb2cgICAgID0+IDEKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJEZXQ2hlY2tPayAgICAgICAgICAgICAgICAgICAgPSAxOwogICAgICAgICAgICAgICAgJFBhY2thZ2VGb3JSZXF1ZXN0ZWRGcmFtZXdvcmsgPSAxOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoJEZXQ2hlY2tPaykgewogICAgICAgICAgICBwdXNoIEBOZXdQYWNrYWdlcywgJFBhY2thZ2U7CiAgICAgICAgfQogICAgfQoKICAgICMgcmV0dXJuIGlmIHRoZXJlIGFyZSBwYWNrYWdlcywganVzdCBub3QgZm9yIHRoaXMgZnJhbWV3b3JrIHZlcnNpb24KICAgIGlmICggQFBhY2thZ2VzICYmICEkUGFja2FnZUZvclJlcXVlc3RlZEZyYW1ld29yayApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgVHJhbnNsYXRhYmxlKAogICAgICAgICAgICAgICAgJ05vIHBhY2thZ2VzIGZvciB5b3VyIGZyYW1ld29yayB2ZXJzaW9uIGZvdW5kIGluIHRoaXMgcmVwb3NpdG9yeSwgaXQgb25seSBjb250YWlucyBwYWNrYWdlcyBmb3Igb3RoZXIgZnJhbWV3b3JrIHZlcnNpb25zLicKICAgICAgICAgICAgICAgICksCiAgICAgICAgKTsKICAgIH0KICAgIEBQYWNrYWdlcyA9IEBOZXdQYWNrYWdlczsKCiAgICAjIGp1c3QgdGhlIG5ld2VzdCBwYWNrYWdlcwogICAgbXkgJU5ld2VzdDsKICAgIGZvciBteSAkUGFja2FnZSAoQFBhY2thZ2VzKSB7CgogICAgICAgIGlmICggISROZXdlc3R7ICRQYWNrYWdlLT57TmFtZX0gfSApIHsKICAgICAgICAgICAgJE5ld2VzdHsgJFBhY2thZ2UtPntOYW1lfSB9ID0gJFBhY2thZ2U7CiAgICAgICAgfQogICAgICAgIGVsc2UgewoKICAgICAgICAgICAgbXkgJENoZWNrVmVyc2lvbiA9ICRTZWxmLT5fQ2hlY2tWZXJzaW9uKAogICAgICAgICAgICAgICAgVmVyc2lvbk5ldyAgICAgICA9PiAkUGFja2FnZS0+e1ZlcnNpb259LAogICAgICAgICAgICAgICAgVmVyc2lvbkluc3RhbGxlZCA9PiAkTmV3ZXN0eyAkUGFja2FnZS0+e05hbWV9IH0tPntWZXJzaW9ufSwKICAgICAgICAgICAgICAgIFR5cGUgICAgICAgICAgICAgPT4gJ01pbicsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBpZiAoICEkQ2hlY2tWZXJzaW9uICkgewogICAgICAgICAgICAgICAgJE5ld2VzdHsgJFBhY2thZ2UtPntOYW1lfSB9ID0gJFBhY2thZ2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBnZXQgcG9zc2libGUgYWN0aW9ucwogICAgQE5ld1BhY2thZ2VzID0gKCk7CiAgICBteSBATG9jYWxMaXN0ID0gJFNlbGYtPlJlcG9zaXRvcnlMaXN0KCk7CgogICAgZm9yIG15ICREYXRhICggc29ydCBrZXlzICVOZXdlc3QgKSB7CgogICAgICAgIG15ICRJbnN0YWxsZWRTYW1lVmVyc2lvbiA9IDA7CgogICAgICAgIFBBQ0tBR0U6CiAgICAgICAgZm9yIG15ICRQYWNrYWdlIChATG9jYWxMaXN0KSB7CgogICAgICAgICAgICBuZXh0IFBBQ0tBR0UgaWYgJE5ld2VzdHskRGF0YX0tPntOYW1lfSBuZSAkUGFja2FnZS0+e05hbWV9LT57Q29udGVudH07CgogICAgICAgICAgICAkTmV3ZXN0eyREYXRhfS0+e0xvY2FsfSA9IDE7CgogICAgICAgICAgICBuZXh0IFBBQ0tBR0UgaWYgJFBhY2thZ2UtPntTdGF0dXN9IG5lICdpbnN0YWxsZWQnOwoKICAgICAgICAgICAgJE5ld2VzdHskRGF0YX0tPntJbnN0YWxsZWR9ID0gMTsKCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICEkU2VsZi0+X0NoZWNrVmVyc2lvbigKICAgICAgICAgICAgICAgICAgICBWZXJzaW9uTmV3ICAgICAgID0+ICROZXdlc3R7JERhdGF9LT57VmVyc2lvbn0sCiAgICAgICAgICAgICAgICAgICAgVmVyc2lvbkluc3RhbGxlZCA9PiAkUGFja2FnZS0+e1ZlcnNpb259LT57Q29udGVudH0sCiAgICAgICAgICAgICAgICAgICAgVHlwZSAgICAgICAgICAgICA9PiAnTWluJywKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJE5ld2VzdHskRGF0YX0tPntVcGdyYWRlfSA9IDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgY2hlY2sgaWYgdmVyc2lvbiBvciBsb3dlciBpcyBhbHJlYWR5IGluc3RhbGxlZAogICAgICAgICAgICBlbHNpZiAoCiAgICAgICAgICAgICAgICAhJFNlbGYtPl9DaGVja1ZlcnNpb24oCiAgICAgICAgICAgICAgICAgICAgVmVyc2lvbk5ldyAgICAgICA9PiAkTmV3ZXN0eyREYXRhfS0+e1ZlcnNpb259LAogICAgICAgICAgICAgICAgICAgIFZlcnNpb25JbnN0YWxsZWQgPT4gJFBhY2thZ2UtPntWZXJzaW9ufS0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgICAgIFR5cGUgICAgICAgICAgICAgPT4gJ01heCcsCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRJbnN0YWxsZWRTYW1lVmVyc2lvbiA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgYWRkIHBhY2thZ2UgaWYgbm90IGFscmVhZHkgaW5zdGFsbGVkCiAgICAgICAgaWYgKCAhJEluc3RhbGxlZFNhbWVWZXJzaW9uICkgewogICAgICAgICAgICBwdXNoIEBOZXdQYWNrYWdlcywgJE5ld2VzdHskRGF0YX07CiAgICAgICAgfQogICAgfQoKICAgIEBQYWNrYWdlcyA9IEBOZXdQYWNrYWdlczsKCiAgICAjIHNldCBjYWNoZQogICAgaWYgKCAkUGFyYW17Q2FjaGV9ICkgewogICAgICAgICRDYWNoZU9iamVjdC0+U2V0KAogICAgICAgICAgICBUeXBlICA9PiAnUGFja2FnZU9ubGluZUxpc3QnLAogICAgICAgICAgICBLZXkgICA9PiAkQ2FjaGVLZXksCiAgICAgICAgICAgIFZhbHVlID0+IFxAUGFja2FnZXMsCiAgICAgICAgICAgIFRUTCAgID0+IDYwICogNjAsCiAgICAgICAgKTsKICAgIH0KCiAgICByZXR1cm4gQFBhY2thZ2VzOwp9Cgo9aXRlbSBQYWNrYWdlT25saW5lR2V0KCkKCmRvd25sb2FkIG9mIGFuIG9ubGluZSBwYWNrYWdlIGFuZCBwdXQgaXQgaW50byB0aGUgbG9jYWwgcmVwb3NpdG9yeQoKICAgICRQYWNrYWdlT2JqZWN0LT5QYWNrYWdlT25saW5lR2V0KAogICAgICAgIFNvdXJjZSA9PiAnaHR0cDovL2hvc3QuZXhhbXBsZS5jb20vJywKICAgICAgICBGaWxlICAgPT4gJ1NvbWVQYWNrYWdlLTEuMC5vcG0nLAogICAgKTsKCj1jdXQKCnN1YiBQYWNrYWdlT25saW5lR2V0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGZvciBteSAkTmVlZGVkIChxdyhGaWxlIFNvdXJjZSkpIHsKICAgICAgICBpZiAoICFkZWZpbmVkICRQYXJhbXskTmVlZGVkfSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIiROZWVkZWQgbm90IGRlZmluZWQhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjY2hlY2sgaWYgZmlsZSBtaWdodCBiZSByZXRyaWV2ZWQgZnJvbSBjbG91ZAogICAgbXkgJFJlcG9zaXRvcnlDbG91ZExpc3Q7CiAgICBpZiAoICEkU2VsZi0+e0Nsb3VkU2VydmljZXNEaXNhYmxlZH0gKSB7CiAgICAgICAgJFJlcG9zaXRvcnlDbG91ZExpc3QgPSAkU2VsZi0+UmVwb3NpdG9yeUNsb3VkTGlzdCgpOwogICAgfQogICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSgkUmVwb3NpdG9yeUNsb3VkTGlzdCkgJiYgJFJlcG9zaXRvcnlDbG91ZExpc3QtPnsgJFBhcmFte1NvdXJjZX0gfSApIHsKCiAgICAgICAgbXkgJFBhY2thZ2VGcm9tQ2xvdWQ7CgogICAgICAgICMgT24gdGhpcyBjYXNlIGEgY2xvdWQgc2VydmljZSBpcyB1c2VkLCBTb3VyY2UgY29udGFpbnMgYW4KICAgICAgICAjIG9wZXJhdGlvbiBuYW1lIGluIG9yZGVyIHRvIG1hdGNoIHdpdGggdGhlIHByZXZpb3VzIHN0cnVjdHVyZQogICAgICAgIG15ICRPcGVyYXRpb24gPSAkUGFyYW17U291cmNlfSAuICdGaWxlR2V0JzsKCiAgICAgICAgIyBkb3dubG9hZCBwYWNrYWdlIGZyb20gY2xvdWQKICAgICAgICBteSAkUGFja2FnZVJlc3VsdCA9ICRTZWxmLT5DbG91ZEZpbGVHZXQoCiAgICAgICAgICAgIE9wZXJhdGlvbiA9PiAkT3BlcmF0aW9uLAogICAgICAgICAgICBEYXRhICAgICAgPT4gewogICAgICAgICAgICAgICAgRmlsZSA9PiAkUGFyYW17RmlsZX0sCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKCiAgICAgICAgaWYgKAogICAgICAgICAgICBJc0hhc2hSZWZXaXRoRGF0YSgkUGFja2FnZVJlc3VsdCkKICAgICAgICAgICAgJiYgJFBhY2thZ2VSZXN1bHQtPntQYWNrYWdlfQogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICAkUGFja2FnZUZyb21DbG91ZCA9ICRQYWNrYWdlUmVzdWx0LT57UGFja2FnZX07CiAgICAgICAgfQogICAgICAgIGVsc2lmICggSXNTdHJpbmdXaXRoRGF0YSgkUGFja2FnZVJlc3VsdCkgKSB7CiAgICAgICAgICAgIHJldHVybiAnRXJyb3JNZXNzYWdlOicgLiAkUGFja2FnZVJlc3VsdDsKCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJFBhY2thZ2VGcm9tQ2xvdWQ7CiAgICB9CgogICAgcmV0dXJuICRTZWxmLT5fRG93bmxvYWQoIFVSTCA9PiAkUGFyYW17U291cmNlfSAuICcvJyAuICRQYXJhbXtGaWxlfSApOwp9Cgo9aXRlbSBEZXBsb3lDaGVjaygpCgpjaGVjayBpZiBwYWNrYWdlIChmaWxlcykgaXMgZGVwbG95ZWQsIHJldHVybnMgdHJ1ZSBpZiBpdCdzIG9rCgogICAgJFBhY2thZ2VPYmplY3QtPkRlcGxveUNoZWNrKAogICAgICAgIE5hbWUgICAgPT4gJ0FwcGxpY2F0aW9uIEEnLAogICAgICAgIFZlcnNpb24gPT4gJzEuMCcsCiAgICAgICAgTG9nICAgICA9PiAxLCAjIERlZmF1bHQ6IDEKICAgICk7Cgo9Y3V0CgpzdWIgRGVwbG95Q2hlY2sgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgZm9yIG15ICROZWVkZWQgKHF3KE5hbWUgVmVyc2lvbikpIHsKICAgICAgICBpZiAoICFkZWZpbmVkICRQYXJhbXskTmVlZGVkfSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIiROZWVkZWQgbm90IGRlZmluZWQhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoICFkZWZpbmVkICRQYXJhbXtMb2d9ICkgewogICAgICAgICRQYXJhbXtMb2d9ID0gMTsKICAgIH0KCiAgICBteSAkUGFja2FnZSA9ICRTZWxmLT5SZXBvc2l0b3J5R2V0KCAlUGFyYW0sIFJlc3VsdCA9PiAnU0NBTEFSJyApOwogICAgbXkgJVN0cnVjdHVyZSA9ICRTZWxmLT5QYWNrYWdlUGFyc2UoIFN0cmluZyA9PiAkUGFja2FnZSApOwoKICAgICRTZWxmLT57RGVwbG95Q2hlY2tJbmZvfSA9IHVuZGVmOwoKICAgIHJldHVybiAxIGlmICEkU3RydWN0dXJle0ZpbGVsaXN0fTsKICAgIHJldHVybiAxIGlmIHJlZiAkU3RydWN0dXJle0ZpbGVsaXN0fSBuZSAnQVJSQVknOwoKICAgIG15ICRIaXQgPSAwOwogICAgZm9yIG15ICRGaWxlICggQHsgJFN0cnVjdHVyZXtGaWxlbGlzdH0gfSApIHsKCiAgICAgICAgbXkgJExvY2FsRmlsZSA9ICRTZWxmLT57SG9tZX0gLiAnLycgLiAkRmlsZS0+e0xvY2F0aW9ufTsKCiAgICAgICAgaWYgKCAhLWUgJExvY2FsRmlsZSApIHsKCiAgICAgICAgICAgIGlmICggJFBhcmFte0xvZ30gKSB7CiAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICIkUGFyYW17TmFtZX0tJFBhcmFte1ZlcnNpb259OiBObyBzdWNoIGZpbGU6ICRMb2NhbEZpbGUhIiwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRTZWxmLT57RGVwbG95Q2hlY2tJbmZvfS0+e0ZpbGV9LT57ICRGaWxlLT57TG9jYXRpb259IH0gPSAnTm8gZmlsZSBpbnN0YWxsZWQhJzsKICAgICAgICAgICAgJEhpdCA9IDE7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggLWUgJExvY2FsRmlsZSApIHsKCiAgICAgICAgICAgIG15ICRDb250ZW50ID0gJFNlbGYtPntNYWluT2JqZWN0fS0+RmlsZVJlYWQoCiAgICAgICAgICAgICAgICBMb2NhdGlvbiA9PiAkU2VsZi0+e0hvbWV9IC4gJy8nIC4gJEZpbGUtPntMb2NhdGlvbn0sCiAgICAgICAgICAgICAgICBNb2RlICAgICA9PiAnYmlubW9kZScsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBpZiAoJENvbnRlbnQpIHsKCiAgICAgICAgICAgICAgICBpZiAoICR7JENvbnRlbnR9IG5lICRGaWxlLT57Q29udGVudH0gKSB7CgogICAgICAgICAgICAgICAgICAgIGlmICggJFBhcmFte0xvZ30gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICIkUGFyYW17TmFtZX0tJFBhcmFte1ZlcnNpb259OiAkTG9jYWxGaWxlIGlzIGRpZmZlcmVudCEiLAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJEhpdCA9IDE7CiAgICAgICAgICAgICAgICAgICAgJFNlbGYtPntEZXBsb3lDaGVja0luZm99LT57RmlsZX0tPnsgJEZpbGUtPntMb2NhdGlvbn0gfSA9ICdGaWxlIGlzIGRpZmZlcmVudCEnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewoKICAgICAgICAgICAgICAgIGlmICggJFBhcmFte0xvZ30gKSB7CiAgICAgICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDYW4ndCByZWFkICRMb2NhbEZpbGUhIiwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRTZWxmLT57RGVwbG95Q2hlY2tJbmZvfS0+e0ZpbGV9LT57ICRGaWxlLT57TG9jYXRpb259IH0gPSAnQ2FuXCcgcmVhZCBGaWxlISc7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIGlmICRIaXQ7CiAgICByZXR1cm4gMTsKfQoKPWl0ZW0gRGVwbG95Q2hlY2tJbmZvKCkKCnJldHVybnMgdGhlIGluZm8gb2YgdGhlIGxhdGVzdCBEZXBsb3lDaGVjaygpLCB3aGF0J3Mgbm90IGRlcGxveWVkIGNvcnJlY3RseQoKICAgIG15ICVIYXNoID0gJFBhY2thZ2VPYmplY3QtPkRlcGxveUNoZWNrSW5mbygpOwoKPWN1dAoKc3ViIERlcGxveUNoZWNrSW5mbyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIHJldHVybiAleyAkU2VsZi0+e0RlcGxveUNoZWNrSW5mb30gfQogICAgICAgIGlmICRTZWxmLT57RGVwbG95Q2hlY2tJbmZvfTsKCiAgICByZXR1cm4gKCk7Cn0KCj1pdGVtIFBhY2thZ2VWZXJpZnkoKQoKY2hlY2sgaWYgcGFja2FnZSBpcyB2ZXJpZmllZCBieSB0aGUgdmVuZG9yCgogICAgJFBhY2thZ2VPYmplY3QtPlBhY2thZ2VWZXJpZnkoCiAgICAgICAgUGFja2FnZSAgID0+ICRQYWNrYWdlLAogICAgICAgIFN0cnVjdHVyZSA9PiBcJVN0cnVjdHVyZSwKICAgICk7CgpvcgoKICAgICRQYWNrYWdlT2JqZWN0LT5QYWNrYWdlVmVyaWZ5KAogICAgICAgIFBhY2thZ2UgPT4gJFBhY2thZ2UsCiAgICAgICAgTmFtZSAgICA9PiAnRkFRJywKICAgICk7Cgo9Y3V0CgpzdWIgUGFja2FnZVZlcmlmeSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICEkUGFyYW17UGFja2FnZX0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkIFBhY2thZ2UhIiwKICAgICAgICApOwoKICAgICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoICEkUGFyYW17U3RydWN0dXJlfSAmJiAhJFBhcmFte05hbWV9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnTmVlZCBTdHJ1Y3R1cmUgb3IgTmFtZSEnLAogICAgICAgICk7CgogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIHJldHVybiBwYWNrYWdlIGFzIHZlcmlmaWVkIGlmIGNsb3VkIHNlcnZpY2VzIGFyZSBkaXNhYmxlZAogICAgaWYgKCAkU2VsZi0+e0Nsb3VkU2VydmljZXNEaXNhYmxlZH0gKSB7CiAgICAgICAgcmV0dXJuICd2ZXJpZmllZCc7CiAgICB9CgogICAgIyBkZWZpbmUgcGFja2FnZSB2ZXJpZmljYXRpb24gaW5mbwogICAgbXkgJFBhY2thZ2VWZXJpZnlJbmZvID0gewoKICAgICMgS0lYQ29yZS1jYXBlSVQKICAgICMgRGVzY3JpcHRpb24gPT4gIjxicj5JZiB5b3UgY29udGludWUgdG8gaW5zdGFsbCB0aGlzIHBhY2thZ2UsIHRoZSBmb2xsb3dpbmcgaXNzdWVzIG1heSBvY2N1ciE8YnI+PGJyPiZuYnNwOy1TZWN1cml0eSBwcm9ibGVtczxicj4mbmJzcDstU3RhYmlsaXR5IHByb2JsZW1zPGJyPiZuYnNwOy1QZXJmb3JtYW5jZSBwcm9ibGVtczxicj48YnI+UGxlYXNlIG5vdGUgdGhhdCBpc3N1ZXMgdGhhdCBhcmUgY2F1c2VkIGJ5IHdvcmtpbmcgd2l0aCB0aGlzIHBhY2thZ2UgYXJlIG5vdCBjb3ZlcmVkIGJ5IE9UUlMgc2VydmljZSBjb250cmFjdHMhPGJyPjxicj4iLAogICAgIyBUaXRsZSAgICAgICA9PiAnUGFja2FnZSBub3QgdmVyaWZpZWQgYnkgdGhlIE9UUlMgR3JvdXAhIEl0IGlzIHJlY29tbWVuZGVkIG5vdCB0byB1c2UgdGhpcyBwYWNrYWdlLicsCiAgICAgICAgRGVzY3JpcHRpb24gPT4KICAgICAgICAgICAgIjxicj5QbGVhc2Ugbm90ZSB0aGF0IGlzc3VlcyB0aGF0IGFyZSBjYXVzZWQgYnkgd29ya2luZyB3aXRoIHRoaXMgcGFja2FnZSBhcmUgbm90IGNvdmVyZWQgYnkgT1RSUyBzZXJ2aWNlIGNvbnRyYWN0cy4iLAogICAgICAgIFRpdGxlID0+CiAgICAgICAgICAgICdUaGlzIHBhY2thZ2UgaXMgbm90IGNlcnRpZmllZCBieSBPVFJTIEdyb3VwLCB3aGljaCBkb2VzIG5vdCBtZWFuIGl0IGlzIG9mIGluZmVyaW9yIHF1YWxpdHkgdGhhbiBwcm9kdWN0cyBvZiB0aGUgT1RSUyBHcm91cC4nLAoKICAgICAgICAjIEVPIEtJWENvcmUtY2FwZUlUCiAgICB9OwoKICAgICMgaW52ZXN0aWdhdGUgbmFtZQogICAgbXkgJE5hbWUgPSAkUGFyYW17U3RydWN0dXJlfS0+e05hbWV9LT57Q29udGVudH0gfHwgJFBhcmFte05hbWV9OwoKICAgICMgY29ycmVjdCBhbnkgJ2Rvcy1zdHlsZScgbGluZSBlbmRpbmdzIC0gaHR0cDovL2J1Z3Mub3Rycy5vcmcvc2hvd19idWcuY2dpP2lkPTk4MzgKICAgICRQYXJhbXtQYWNrYWdlfSA9fiBze1xyXG59e1xufXhtc2c7CgogICAgIyBjcmVhdGUgTUQ1IHN1bQogICAgbXkgJFN1bSA9ICRTZWxmLT57TWFpbk9iamVjdH0tPk1ENXN1bSggU3RyaW5nID0+ICRQYXJhbXtQYWNrYWdlfSApOwoKICAgICMgZ2V0IGNhY2hlIG9iamVjdAogICAgbXkgJENhY2hlT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyk7CgogICAgIyBsb29rdXAgY2FjaGUKICAgIG15ICRDYWNoZWRWYWx1ZSA9ICRDYWNoZU9iamVjdC0+R2V0KAogICAgICAgIFR5cGUgPT4gJ1BhY2thZ2VWZXJpZmljYXRpb24nLAogICAgICAgIEtleSAgPT4gJFN1bSwKICAgICk7CiAgICBpZiAoJENhY2hlZFZhbHVlKSB7CiAgICAgICAgJFNlbGYtPntQYWNrYWdlVmVyaWZ5SW5mb30gPSAkUGFja2FnZVZlcmlmeUluZm87CgogICAgICAgIHJldHVybiAkQ2FjaGVkVmFsdWU7CiAgICB9CgogICAgbXkgJENsb3VkU2VydmljZSA9ICdQYWNrYWdlTWFuYWdlbWVudCc7CiAgICBteSAkT3BlcmF0aW9uICAgID0gJ1BhY2thZ2VWZXJpZnknOwoKICAgICMgcHJlcGFyZSBjbG91ZCBzZXJ2aWNlIHJlcXVlc3QKICAgIG15ICVSZXF1ZXN0UGFyYW1zID0gKAogICAgICAgIFJlcXVlc3REYXRhID0+IHsKICAgICAgICAgICAgJENsb3VkU2VydmljZSA9PiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgT3BlcmF0aW9uID0+ICRPcGVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgRGF0YSAgICAgID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFja2FnZSA9PiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSAgID0+ICROYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1ENXN1bSA9PiAkU3VtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICBdLAogICAgICAgIH0sCiAgICApOwoKICAgICMgZ2V0IGNsb3VkIHNlcnZpY2Ugb2JqZWN0CiAgICBteSAkQ2xvdWRTZXJ2aWNlT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNsb3VkU2VydmljZTo6QmFja2VuZDo6UnVuJyk7CgogICAgIyBkaXNwYXRjaCB0aGUgY2xvdWQgc2VydmljZSByZXF1ZXN0CiAgICBteSAkUmVxdWVzdFJlc3VsdCA9ICRDbG91ZFNlcnZpY2VPYmplY3QtPlJlcXVlc3QoJVJlcXVlc3RQYXJhbXMpOwoKICAgICMgYXMgdGhpcyBpcyB0aGUgb25seSBvcGVyYXRpb24gYW4gdW5zdWNjZXNzZnVsIHJlcXVlc3QgbWVhbnMgdGhhdCB0aGUgb3BlcmF0aW9uIHdhcyBhbHNvCiAgICAjIHVuc3VjY2Vzc2Z1bCwgaW4gc3VjaCBjYXNlIHNldCB0aGUgcGFja2FnZSBhcyB2ZXJpZmllZAogICAgcmV0dXJuICd1bmtub3duJyBpZiAhSXNIYXNoUmVmV2l0aERhdGEoJFJlcXVlc3RSZXN1bHQpOwoKICAgIG15ICRPcGVyYXRpb25SZXN1bHQgPSAkQ2xvdWRTZXJ2aWNlT2JqZWN0LT5PcGVyYXRpb25SZXN1bHRHZXQoCiAgICAgICAgUmVxdWVzdFJlc3VsdCA9PiAkUmVxdWVzdFJlc3VsdCwKICAgICAgICBDbG91ZFNlcnZpY2UgID0+ICRDbG91ZFNlcnZpY2UsCiAgICAgICAgT3BlcmF0aW9uICAgICA9PiAkT3BlcmF0aW9uLAogICAgKTsKCiAgICAjIGlmIHRoZXJlIHdhcyBubyByZXN1bHQgZm9yIHRoaXMgc3BlY2lmaWMgb3BlcmF0aW9uIG9yIHRoZSBvcGVyYXRpb24gd2FzIG5vdCBzdWNjZXNzLCB0aGVuCiAgICAjIHNldCB0aGUgcGFja2FnZSBhcyB2ZXJpZmllZAogICAgcmV0dXJuICd1bmtub3duJyBpZiAhSXNIYXNoUmVmV2l0aERhdGEoJE9wZXJhdGlvblJlc3VsdCk7CiAgICByZXR1cm4gJ3Vua25vd24nIGlmICEkT3BlcmF0aW9uUmVzdWx0LT57U3VjY2Vzc307CgogICAgbXkgJFZlcmlmaWNhdGlvbkRhdGEgPSAkT3BlcmF0aW9uUmVzdWx0LT57RGF0YX07CgogICAgIyBleHRyYWN0IHJlc3BvbnNlCiAgICBteSAkUGFja2FnZVZlcmlmeSA9ICRWZXJpZmljYXRpb25EYXRhLT57JE5hbWV9OwoKICAgIHJldHVybiAndW5rbm93bicgaWYgISRQYWNrYWdlVmVyaWZ5OwogICAgcmV0dXJuICd1bmtub3duJyBpZiAkUGFja2FnZVZlcmlmeSBuZSAnbm90X3ZlcmlmaWVkJyAmJiAkUGFja2FnZVZlcmlmeSBuZSAndmVyaWZpZWQnOwoKICAgICMgc2V0IHBhY2thZ2UgdmVyaWZpY2F0aW9uIGluZm8KICAgIGlmICggJFBhY2thZ2VWZXJpZnkgZXEgJ25vdF92ZXJpZmllZCcgKSB7CiAgICAgICAgJFNlbGYtPntQYWNrYWdlVmVyaWZ5SW5mb30gPSAkUGFja2FnZVZlcmlmeUluZm87CiAgICB9CgogICAgIyBzZXQgY2FjaGUKICAgICRDYWNoZU9iamVjdC0+U2V0KAogICAgICAgIFR5cGUgID0+ICdQYWNrYWdlVmVyaWZpY2F0aW9uJywKICAgICAgICBLZXkgICA9PiAkU3VtLAogICAgICAgIFZhbHVlID0+ICRQYWNrYWdlVmVyaWZ5LAogICAgICAgIFRUTCAgID0+IDMwICogMjQgKiA2MCAqIDYwLCAgICAgICAjIDMwIGRheXMKICAgICk7CgogICAgcmV0dXJuICRQYWNrYWdlVmVyaWZ5Owp9Cgo9aXRlbSBQYWNrYWdlVmVyaWZ5SW5mbygpCgpyZXR1cm5zIHRoZSBpbmZvIG9mIHRoZSBsYXRlc3QgUGFja2FnZVZlcmlmeSgpCgogICAgbXkgJUhhc2ggPSAkUGFja2FnZU9iamVjdC0+UGFja2FnZVZlcmlmeUluZm8oKTsKCj1jdXQKCnN1YiBQYWNrYWdlVmVyaWZ5SW5mbyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIHJldHVybiAoKSBpZiAhJFNlbGYtPntQYWNrYWdlVmVyaWZ5SW5mb307CiAgICByZXR1cm4gKCkgaWYgcmVmICRTZWxmLT57UGFja2FnZVZlcmlmeUluZm99IG5lICdIQVNIJzsKICAgIHJldHVybiAoKSBpZiAhJXsgJFNlbGYtPntQYWNrYWdlVmVyaWZ5SW5mb30gfTsKCiAgICByZXR1cm4gJXsgJFNlbGYtPntQYWNrYWdlVmVyaWZ5SW5mb30gfTsKfQoKPWl0ZW0gUGFja2FnZVZlcmlmeUFsbCgpCgpjaGVjayBpZiBhbGwgaW5zdGFsbGVkIHBhY2thZ2VzIGFyZSBpbnN0YWxsZWQgYnkgdGhlIHZlbmRvcgpyZXR1cm5zIGEgaGFzaCB3aXRoIHBhY2thZ2UgbmFtZXMgYW5kIHZlcmlmaWNhdGlvbiBzdGF0dXMuCgogICAgbXkgJVZlcmlmaWNhdGlvbkluZm8gPSAkUGFja2FnZU9iamVjdC0+UGFja2FnZVZlcmlmeUFsbCgpOwoKcmV0dXJuczoKCiAgICAlVmVyaWZpY2F0aW9uSW5mbyA9ICgKICAgICAgICBGQVEgICAgID0+ICd2ZXJpZmllZCcsCiAgICAgICAgU3VwcG9ydCA9PiAndmVyaWZpZWQnLAogICAgICAgIE15SGFjayAgPT4gJ25vdF92ZXJpZmllZCcsCiAgICApOwoKPWN1dAoKc3ViIFBhY2thZ2VWZXJpZnlBbGwgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGdldCBpbnN0YWxsZWQgcGFja2FnZSBsaXN0CiAgICBteSBAUGFja2FnZUxpc3QgPSAkU2VsZi0+UmVwb3NpdG9yeUxpc3QoCiAgICAgICAgUmVzdWx0ID0+ICdTaG9ydCcsCiAgICApOwoKICAgIHJldHVybiAoKSBpZiAhQFBhY2thZ2VMaXN0OwoKICAgICMgY3JlYXRlIGEgbWFwcGluZyBvZiBQYWNrYWdlIE5hbWUgPT4gbWQ1IHBhaXJzCiAgICBteSAlUGFja2FnZUxpc3QgPSBtYXAgeyAkXy0+e05hbWV9ID0+ICRfLT57TUQ1c3VtfSB9IEBQYWNrYWdlTGlzdDsKCiAgICAjIGdldCBjYWNoZSBvYmplY3QKICAgIG15ICRDYWNoZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpOwoKICAgIG15ICVSZXN1bHQ7CiAgICBteSBAUGFja2FnZXNUb1ZlcmlmeTsKCiAgICAjIGZpcnN0IGNoZWNrIHRoZSBjYWNoZSBmb3IgZWFjaCBwYWNrYWdlCiAgICBmb3IgbXkgJFBhY2thZ2UgKEBQYWNrYWdlTGlzdCkgewoKICAgICAgICBteSAkVmVyaWZpY2F0aW9uID0gJENhY2hlT2JqZWN0LT5HZXQoCiAgICAgICAgICAgIFR5cGUgPT4gJ1BhY2thZ2VWZXJpZmljYXRpb24nLAogICAgICAgICAgICBLZXkgID0+ICRQYWNrYWdlLT57TUQ1c3VtfSwKICAgICAgICApOwoKICAgICAgICAjIGFkZCB0byByZXN1bHQgaWYgd2UgaGF2ZSBpdCBhbHJlYWR5CiAgICAgICAgaWYgKCRWZXJpZmljYXRpb24pIHsKICAgICAgICAgICAgJFJlc3VsdHsgJFBhY2thZ2UtPntOYW1lfSB9ID0gJFZlcmlmaWNhdGlvbjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRSZXN1bHR7ICRQYWNrYWdlLT57TmFtZX0gfSA9ICd1bmtub3duJzsKICAgICAgICAgICAgcHVzaCBAUGFja2FnZXNUb1ZlcmlmeSwgewogICAgICAgICAgICAgICAgTmFtZSAgID0+ICRQYWNrYWdlLT57TmFtZX0sCiAgICAgICAgICAgICAgICBNRDVzdW0gPT4gJFBhY2thZ2UtPntNRDVzdW19LAogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gJVJlc3VsdCBpZiAhQFBhY2thZ2VzVG9WZXJpZnk7CiAgICByZXR1cm4gJVJlc3VsdCBpZiAkU2VsZi0+e0Nsb3VkU2VydmljZXNEaXNhYmxlZH07CgogICAgbXkgJENsb3VkU2VydmljZSA9ICdQYWNrYWdlTWFuYWdlbWVudCc7CiAgICBteSAkT3BlcmF0aW9uICAgID0gJ1BhY2thZ2VWZXJpZnknOwoKICAgICMgcHJlcGFyZSBjbG91ZCBzZXJ2aWNlIHJlcXVlc3QKICAgIG15ICVSZXF1ZXN0UGFyYW1zID0gKAogICAgICAgIFJlcXVlc3REYXRhID0+IHsKICAgICAgICAgICAgJENsb3VkU2VydmljZSA9PiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgT3BlcmF0aW9uID0+ICRPcGVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgRGF0YSAgICAgID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgUGFja2FnZSA9PiBcQFBhY2thZ2VzVG9WZXJpZnksCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF0sCiAgICAgICAgfSwKICAgICk7CgogICAgIyBnZXQgY2xvdWQgc2VydmljZSBvYmplY3QKICAgIG15ICRDbG91ZFNlcnZpY2VPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2xvdWRTZXJ2aWNlOjpCYWNrZW5kOjpSdW4nKTsKCiAgICAjIGRpc3BhdGNoIHRoZSBjbG91ZCBzZXJ2aWNlIHJlcXVlc3QKICAgIG15ICRSZXF1ZXN0UmVzdWx0ID0gJENsb3VkU2VydmljZU9iamVjdC0+UmVxdWVzdCglUmVxdWVzdFBhcmFtcyk7CgogICAgIyBhcyB0aGlzIGlzIHRoZSBvbmx5IG9wZXJhdGlvbiBhbiB1bnN1Y2Nlc3NmdWwgcmVxdWVzdCBtZWFucyB0aGF0IHRoZSBvcGVyYXRpb24gd2FzIGFsc28KICAgICMgdW5zdWNjZXNzZnVsLCB0aGVuIHJldHVybiBhbGwgcGFja2FnZXMgYXMgdmVyaWZpZWQgKG9yIGNhY2hlKQogICAgcmV0dXJuICVSZXN1bHQgaWYgIUlzSGFzaFJlZldpdGhEYXRhKCRSZXF1ZXN0UmVzdWx0KTsKCiAgICBteSAkT3BlcmF0aW9uUmVzdWx0ID0gJENsb3VkU2VydmljZU9iamVjdC0+T3BlcmF0aW9uUmVzdWx0R2V0KAogICAgICAgIFJlcXVlc3RSZXN1bHQgPT4gJFJlcXVlc3RSZXN1bHQsCiAgICAgICAgQ2xvdWRTZXJ2aWNlICA9PiAkQ2xvdWRTZXJ2aWNlLAogICAgICAgIE9wZXJhdGlvbiAgICAgPT4gJE9wZXJhdGlvbiwKICAgICk7CgogICAgIyBpZiBubyBvcGVyYXRpb24gcmVzdWx0IGZvdW5kIG9yIGl0IHdhcyBub3Qgc3VjY2Vzc2Z1bCB0aGUgcmV0dXJuIGFsbCBwYWNrYWdlcyBhcyB2ZXJpZmllZAogICAgIyAob3IgY2FjaGUpCiAgICByZXR1cm4gJVJlc3VsdCBpZiAhSXNIYXNoUmVmV2l0aERhdGEoJE9wZXJhdGlvblJlc3VsdCk7CiAgICByZXR1cm4gJVJlc3VsdCBpZiAhJE9wZXJhdGlvblJlc3VsdC0+e1N1Y2Nlc3N9OwoKICAgIG15ICRWZXJpZmljYXRpb25EYXRhID0gJE9wZXJhdGlvblJlc3VsdC0+e0RhdGF9OwoKICAgIFBBQ0tBR0U6CiAgICBmb3IgbXkgJFBhY2thZ2UgKCBzb3J0IGtleXMgJVJlc3VsdCApIHsKCiAgICAgICAgbmV4dCBQQUNLQUdFIGlmICEkUGFja2FnZTsKICAgICAgICBuZXh0IFBBQ0tBR0UgaWYgISRWZXJpZmljYXRpb25EYXRhLT57JFBhY2thZ2V9OwoKICAgICAgICAjIGV4dHJhY3QgcmVzcG9uc2UKICAgICAgICBteSAkUGFja2FnZVZlcmlmeSA9ICRWZXJpZmljYXRpb25EYXRhLT57JFBhY2thZ2V9OwoKICAgICAgICBuZXh0IFBBQ0tBR0UgaWYgISRQYWNrYWdlVmVyaWZ5OwogICAgICAgIG5leHQgUEFDS0FHRSBpZiAkUGFja2FnZVZlcmlmeSBuZSAnbm90X3ZlcmlmaWVkJyAmJiAkUGFja2FnZVZlcmlmeSBuZSAndmVyaWZpZWQnOwoKICAgICAgICAjIHByb2Nlc3MgcmVzdWx0CiAgICAgICAgJFJlc3VsdHskUGFja2FnZX0gPSAkUGFja2FnZVZlcmlmeTsKCiAgICAgICAgIyBzZXQgY2FjaGUKICAgICAgICAkQ2FjaGVPYmplY3QtPlNldCgKICAgICAgICAgICAgVHlwZSAgPT4gJ1BhY2thZ2VWZXJpZmljYXRpb24nLAogICAgICAgICAgICBLZXkgICA9PiAkUGFja2FnZUxpc3R7JFBhY2thZ2V9LAogICAgICAgICAgICBWYWx1ZSA9PiAkUGFja2FnZVZlcmlmeSwKICAgICAgICAgICAgVFRMICAgPT4gMzAgKiAyNCAqIDYwICogNjAsICAgICAgICAjIDMwIGRheXMKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiAlUmVzdWx0Owp9Cgo9aXRlbSBQYWNrYWdlQnVpbGQoKQoKYnVpbGQgYW4gb3BtIHBhY2thZ2UKCiAgICBteSAkUGFja2FnZSA9ICRQYWNrYWdlT2JqZWN0LT5QYWNrYWdlQnVpbGQoCiAgICAgICAgTmFtZSA9PiB7CiAgICAgICAgICAgIENvbnRlbnQgPT4gJ1NvbWVQYWNrYWdlTmFtZScsCiAgICAgICAgfSwKICAgICAgICBWZXJzaW9uID0+IHsKICAgICAgICAgICAgQ29udGVudCA9PiAnMS4wJywKICAgICAgICB9LAogICAgICAgIFZlbmRvciA9PiB7CiAgICAgICAgICAgIENvbnRlbnQgPT4gJ09UUlMgQUcnLAogICAgICAgIH0sCiAgICAgICAgVVJMID0+IHsKICAgICAgICAgICAgQ29udGVudCA9PiAnTDxodHRwOi8vb3Rycy5vcmcvPicsCiAgICAgICAgfSwKICAgICAgICBMaWNlbnNlID0+IHsKICAgICAgICAgICAgQ29udGVudCA9PiAnR05VIEdFTkVSQUwgUFVCTElDIExJQ0VOU0UgVmVyc2lvbiAyLCBKdW5lIDE5OTEnLAogICAgICAgIH0KICAgICAgICBEZXNjcmlwdGlvbiA9PiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIExhbmcgICAgPT4gJ2VuJywKICAgICAgICAgICAgICAgIENvbnRlbnQgPT4gJ2VuZ2xpc2ggZGVzY3JpcHRpb24nLAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBMYW5nICAgID0+ICdkZScsCiAgICAgICAgICAgICAgICBDb250ZW50ID0+ICdnZXJtYW4gZGVzY3JpcHRpb24nLAogICAgICAgICAgICB9LAogICAgICAgIF0sCiAgICAgICAgRmlsZWxpc3QgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIExvY2F0aW9uICAgPT4gJ0tlcm5lbC9TeXN0ZW0vTGFsYS5wbScKICAgICAgICAgICAgICAgIFBlcm1pc3Npb24gPT4gJzY0NCcsCiAgICAgICAgICAgICAgICBDb250ZW50ICAgID0+ICRGaWxlSW5TdHJpbmcsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIExvY2F0aW9uICAgPT4gJ0tlcm5lbC9TeXN0ZW0vTHVsdS5wbScKICAgICAgICAgICAgICAgIFBlcm1pc3Npb24gPT4gJzY0NCcsCiAgICAgICAgICAgICAgICBDb250ZW50ICAgID0+ICRGaWxlSW5TdHJpbmcsCiAgICAgICAgICAgIH0sCiAgICAgICAgXSwKICAgICk7Cgo9Y3V0CgpzdWIgUGFja2FnZUJ1aWxkIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJFhNTCA9ICcnOwogICAgbXkgJEhvbWUgPSAkUGFyYW17SG9tZX0gfHwgJFNlbGYtPntDb25maWdPYmplY3R9LT5HZXQoJ0hvbWUnKTsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgZm9yIG15ICROZWVkZWQgKHF3KE5hbWUgVmVyc2lvbiBWZW5kb3IgTGljZW5zZSBEZXNjcmlwdGlvbikpIHsKICAgICAgICBpZiAoICFkZWZpbmVkICRQYXJhbXskTmVlZGVkfSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIiROZWVkZWQgbm90IGRlZmluZWQhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjIGZpbmQgZnJhbWV3b3JrLCBtYXkgd2UgbmVlZCBkbyBzb21lIHRoaW5ncyBkaWZmZXJlbnQgdG8gYmUgY29tcGF0LiB0byAyLjIKICAgIG15ICRGcmFtZXdvcms7CiAgICBpZiAoICRQYXJhbXtGcmFtZXdvcmt9ICkgewoKICAgICAgICBGVzoKICAgICAgICBmb3IgbXkgJEZXICggQHsgJFBhcmFte0ZyYW1ld29ya30gfSApIHsKCiAgICAgICAgICAgIG5leHQgRlcgaWYgJEZXLT57Q29udGVudH0gIX4gLzJcLjJcLi87CgogICAgICAgICAgICAkRnJhbWV3b3JrID0gJzIuMic7CgogICAgICAgICAgICBsYXN0IEZXOwogICAgICAgIH0KICAgIH0KCiAgICAjIGJ1aWxkIHhtbAogICAgaWYgKCAhJFBhcmFte1R5cGV9ICkgewogICAgICAgICRYTUwgLj0gJzw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9InV0Zi04IiA/Pic7CiAgICAgICAgJFhNTCAuPSAiXG4iOwogICAgICAgICRYTUwgLj0gJzxvdHJzX3BhY2thZ2UgdmVyc2lvbj0iMS4xIj4nOwogICAgICAgICRYTUwgLj0gIlxuIjsKICAgIH0KCiAgICBUQUc6CiAgICBmb3IgbXkgJFRhZyAoCiAgICAgICAgcXcoTmFtZSBWZXJzaW9uIFZlbmRvciBVUkwgTGljZW5zZSBDaGFuZ2VMb2cgRGVzY3JpcHRpb24gRnJhbWV3b3JrIE9TCiAgICAgICAgSW50cm9JbnN0YWxsIEludHJvVW5pbnN0YWxsIEludHJvUmVpbnN0YWxsIEludHJvVXBncmFkZQogICAgICAgIFBhY2thZ2VJc1Zpc2libGUgUGFja2FnZUlzRG93bmxvYWRhYmxlIFBhY2thZ2VJc1JlbW92YWJsZSBQYWNrYWdlTWVyZ2UKICAgICAgICBQYWNrYWdlUmVxdWlyZWQgTW9kdWxlUmVxdWlyZWQgQ29kZUluc3RhbGwgQ29kZVVwZ3JhZGUgQ29kZVVuaW5zdGFsbCBDb2RlUmVpbnN0YWxsKQogICAgICAgICkKICAgIHsKCiAgICAgICAgIyBkb24ndCB1c2UgQ29kZUluc3RhbGwgQ29kZVVwZ3JhZGUgQ29kZVVuaW5zdGFsbCBDb2RlUmVpbnN0YWxsIGluIGluZGV4IG1vZGUKICAgICAgICBpZiAoICRQYXJhbXtUeXBlfSAmJiAkVGFnID1+IC8oQ29kZXxJbnRybykoSW5zdGFsbHxVcGdyYWRlfFVuaW5zdGFsbHxSZWluc3RhbGwpLyApIHsKICAgICAgICAgICAgbmV4dCBUQUc7CiAgICAgICAgfQoKICAgICAgICBpZiAoIHJlZiAkUGFyYW17JFRhZ30gZXEgJ0hBU0gnICkgewoKICAgICAgICAgICAgbXkgJU9sZFBhcmFtOwogICAgICAgICAgICBmb3IgbXkgJEl0ZW0gKHF3KENvbnRlbnQgRW5jb2RlIFRhZ1R5cGUgVGFnIFRhZ0xldmVsIFRhZ0NvdW50IFRhZ0tleSBUYWdMYXN0TGV2ZWwpKSB7CiAgICAgICAgICAgICAgICAkT2xkUGFyYW17JEl0ZW19ID0gJFBhcmFteyRUYWd9LT57JEl0ZW19IHx8ICcnOwogICAgICAgICAgICAgICAgZGVsZXRlICRQYXJhbXskVGFnfS0+eyRJdGVtfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJFhNTCAuPSAiICAgIDwkVGFnIjsKCiAgICAgICAgICAgIGZvciBteSAkSXRlbSAoIHNvcnQga2V5cyAleyAkUGFyYW17JFRhZ30gfSApIHsKICAgICAgICAgICAgICAgICRYTUwgLj0gIiAkSXRlbT1cIiIgLiAkU2VsZi0+X0VuY29kZSggJFBhcmFteyRUYWd9LT57JEl0ZW19ICkgLiAiXCIiOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkWE1MIC49ICI+IjsKICAgICAgICAgICAgJFhNTCAuPSAkU2VsZi0+X0VuY29kZSggJE9sZFBhcmFte0NvbnRlbnR9ICkgLiAiPC8kVGFnPlxuIjsKICAgICAgICB9CiAgICAgICAgZWxzaWYgKCByZWYgJFBhcmFteyRUYWd9IGVxICdBUlJBWScgKSB7CgogICAgICAgICAgICBmb3IgbXkgJEl0ZW0gKCBAeyAkUGFyYW17JFRhZ30gfSApIHsKCiAgICAgICAgICAgICAgICBteSAkVGFnU3ViID0gJFRhZzsKICAgICAgICAgICAgICAgIG15ICVIYXNoICAgPSAleyRJdGVtfTsKICAgICAgICAgICAgICAgIG15ICVPbGRQYXJhbTsKCiAgICAgICAgICAgICAgICBmb3IgbXkgJEhhc2hQYXJhbSAoCiAgICAgICAgICAgICAgICAgICAgcXcoQ29udGVudCBFbmNvZGUgVGFnVHlwZSBUYWcgVGFnTGV2ZWwgVGFnQ291bnQgVGFnS2V5IFRhZ0xhc3RMZXZlbCkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJE9sZFBhcmFteyRIYXNoUGFyYW19ID0gJEhhc2h7JEhhc2hQYXJhbX0gfHwgJyc7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlICRIYXNoeyRIYXNoUGFyYW19OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgY29tcGF0LiB0byAyLjIKICAgICAgICAgICAgICAgIGlmICggJEZyYW1ld29yayAmJiAkVGFnID1+IC9eSW50cm8vICkgewogICAgICAgICAgICAgICAgICAgIGlmICggJEhhc2h7VHlwZX0gZXEgJ3ByZScgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRIYXNoe1R5cGV9ID0gJ1ByZSc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkSGFzaHtUeXBlfSA9ICdQb3N0JzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJFRhZ1N1YiA9ICRUYWcgLiAkSGFzaHtUeXBlfTsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgJEhhc2h7VHlwZX07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJFhNTCAuPSAiICAgIDwkVGFnU3ViIjsKCiAgICAgICAgICAgICAgICBmb3IgbXkgJEl0ZW0gKCBzb3J0IGtleXMgJUhhc2ggKSB7CiAgICAgICAgICAgICAgICAgICAgJFhNTCAuPSAiICRJdGVtPVwiIiAuICRTZWxmLT5fRW5jb2RlKCAkSGFzaHskSXRlbX0gKSAuICJcIiI7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJFhNTCAuPSAiPiI7CiAgICAgICAgICAgICAgICAkWE1MIC49ICRTZWxmLT5fRW5jb2RlKCAkT2xkUGFyYW17Q29udGVudH0gKSAuICI8LyRUYWdTdWI+XG4iOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgZG9uJ3QgdXNlIEJ1aWxkKiBpbiBpbmRleCBtb2RlCiAgICBpZiAoICEkUGFyYW17VHlwZX0gKSB7CgogICAgICAgICMgZ2V0IHRpbWUgb2JqZWN0CiAgICAgICAgbXkgJFRpbWVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGltZScpOwoKICAgICAgICBteSAkVGltZSA9ICRUaW1lT2JqZWN0LT5TeXN0ZW1UaW1lMlRpbWVTdGFtcCgKICAgICAgICAgICAgU3lzdGVtVGltZSA9PiAkVGltZU9iamVjdC0+U3lzdGVtVGltZSgpLAogICAgICAgICk7CgogICAgICAgICRYTUwgLj0gIiAgICA8QnVpbGREYXRlPiIgLiAkVGltZSAuICI8L0J1aWxkRGF0ZT5cbiI7CiAgICAgICAgJFhNTCAuPSAiICAgIDxCdWlsZEhvc3Q+IiAuICRTZWxmLT57Q29uZmlnT2JqZWN0fS0+R2V0KCdGUUROJykgLiAiPC9CdWlsZEhvc3Q+XG4iOwogICAgfQogICAgaWYgKCAkUGFyYW17RmlsZWxpc3R9ICkgewoKICAgICAgICAkWE1MIC49ICIgICAgPEZpbGVsaXN0PlxuIjsKCiAgICAgICAgRklMRToKICAgICAgICBmb3IgbXkgJEZpbGUgKCBAeyAkUGFyYW17RmlsZWxpc3R9IH0gKSB7CgogICAgICAgICAgICBteSAlT2xkUGFyYW07CgogICAgICAgICAgICBmb3IgbXkgJEl0ZW0gKHF3KENvbnRlbnQgRW5jb2RlIFRhZ1R5cGUgVGFnIFRhZ0xldmVsIFRhZ0NvdW50IFRhZ0tleSBUYWdMYXN0TGV2ZWwpKSB7CiAgICAgICAgICAgICAgICAkT2xkUGFyYW17JEl0ZW19ID0gJEZpbGUtPnskSXRlbX0gfHwgJyc7CiAgICAgICAgICAgICAgICBkZWxldGUgJEZpbGUtPnskSXRlbX07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgZG8gb25seSB1c2UgZG9jLyogRmlsZWxpc3QgaW4gaW5kZXggbW9kZQogICAgICAgICAgICBuZXh0IEZJTEUgaWYgJFBhcmFte1R5cGV9ICYmICRGaWxlLT57TG9jYXRpb259ICF+IC9eZG9jXC8vOwoKICAgICAgICAgICAgaWYgKCAhJFBhcmFte1R5cGV9ICkgewogICAgICAgICAgICAgICAgJFhNTCAuPSAiICAgICAgICA8RmlsZSI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkWE1MIC49ICIgICAgICAgIDxGaWxlRG9jIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgbXkgJEl0ZW0gKCBzb3J0IGtleXMgJXskRmlsZX0gKSB7CiAgICAgICAgICAgICAgICBpZiAoICRJdGVtIG5lICdUYWcnICYmICRJdGVtIG5lICdDb250ZW50JyAmJiAkSXRlbSBuZSAnVGFnVHlwZScgJiYgJEl0ZW0gbmUgJ1NpemUnICkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkWE1MCiAgICAgICAgICAgICAgICAgICAgICAgIC49ICIgIgogICAgICAgICAgICAgICAgICAgICAgICAuICRTZWxmLT5fRW5jb2RlKCRJdGVtKSAuICI9XCIiCiAgICAgICAgICAgICAgICAgICAgICAgIC4gJFNlbGYtPl9FbmNvZGUoICRGaWxlLT57JEl0ZW19ICkgLiAiXCIiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGRvbid0IHVzZSBjb250ZW50IGluIGluIGluZGV4IG1vZGUKICAgICAgICAgICAgaWYgKCAhJFBhcmFte1R5cGV9ICkgewogICAgICAgICAgICAgICAgJFhNTCAuPSAiIEVuY29kZT1cIkJhc2U2NFwiPiI7CiAgICAgICAgICAgICAgICBteSAkRmlsZUNvbnRlbnQgPSAkU2VsZi0+e01haW5PYmplY3R9LT5GaWxlUmVhZCgKICAgICAgICAgICAgICAgICAgICBMb2NhdGlvbiA9PiAkSG9tZSAuICcvJyAuICRGaWxlLT57TG9jYXRpb259LAogICAgICAgICAgICAgICAgICAgIE1vZGUgICAgID0+ICdiaW5tb2RlJywKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgcmV0dXJuIGlmICFkZWZpbmVkICRGaWxlQ29udGVudDsKCiAgICAgICAgICAgICAgICAkWE1MIC49IGVuY29kZV9iYXNlNjQoICR7JEZpbGVDb250ZW50fSwgJycgKTsKICAgICAgICAgICAgICAgICRYTUwgLj0gIjwvRmlsZT5cbiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkWE1MIC49ICIgPiI7CiAgICAgICAgICAgICAgICAkWE1MIC49ICI8L0ZpbGVEb2M+XG4iOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICRYTUwgLj0gIiAgICA8L0ZpbGVsaXN0PlxuIjsKICAgIH0KCiAgICAjIGRvbid0IHVzZSBEYXRhYmFzZSogaW4gaW5kZXggbW9kZQogICAgcmV0dXJuICRYTUwgaWYgJFBhcmFte1R5cGV9OwoKICAgIFRBRzoKICAgIGZvciBteSAkSXRlbSAocXcoRGF0YWJhc2VJbnN0YWxsIERhdGFiYXNlVXBncmFkZSBEYXRhYmFzZVJlaW5zdGFsbCBEYXRhYmFzZVVuaW5zdGFsbCkpIHsKCiAgICAgICAgaWYgKCByZWYgJFBhcmFteyRJdGVtfSBuZSAnSEFTSCcgKSB7CiAgICAgICAgICAgIG5leHQgVEFHOwogICAgICAgIH0KCiAgICAgICAgZm9yIG15ICRUeXBlICggc29ydCAleyAkUGFyYW17JEl0ZW19IH0gKSB7CgogICAgICAgICAgICBpZiAoICRQYXJhbXskSXRlbX0tPnskVHlwZX0gKSB7CgogICAgICAgICAgICAgICAgbXkgJENvdW50ZXIgPSAxOwogICAgICAgICAgICAgICAgZm9yIG15ICRUYWcgKCBAeyAkUGFyYW17JEl0ZW19LT57JFR5cGV9IH0gKSB7CgogICAgICAgICAgICAgICAgICAgIGlmICggJFRhZy0+e1RhZ1R5cGV9IGVxICdTdGFydCcgKSB7CgogICAgICAgICAgICAgICAgICAgICAgICBteSAkU3BhY2UgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICggMSAuLiAkQ291bnRlciApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRTcGFjZSAuPSAnICAgICc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICRDb3VudGVyKys7CiAgICAgICAgICAgICAgICAgICAgICAgICRYTUwgLj0gJFNwYWNlIC4gIjwkVGFnLT57VGFnfSI7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRUYWctPntUYWdMZXZlbH0gPT0gMyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRYTUwgLj0gIiBUeXBlPVwiJFR5cGVcIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICV7JFRhZ30gKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRLZXkgbmUgJ1RhZycKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiAkS2V5IG5lICdDb250ZW50JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmICRLZXkgbmUgJ1RhZ1R5cGUnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgJEtleSBuZSAnVGFnTGV2ZWwnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgJEtleSBuZSAnVGFnQ291bnQnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgJEtleSBuZSAnVGFnS2V5JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmICRLZXkgbmUgJ1RhZ0xhc3RMZXZlbCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBkZWZpbmVkKCAkVGFnLT57JEtleX0gKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFhNTCAuPSAnICcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4gJFNlbGYtPl9FbmNvZGUoJEtleSkgLiAnPSInCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuICRTZWxmLT5fRW5jb2RlKCAkVGFnLT57JEtleX0gKSAuICciJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICRYTUwgLj0gIj4iOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkVGFnLT57VGFnTGV2ZWx9IDw9IDMgfHwgJFRhZy0+e1RhZ30gPX4gLyhGb3JlaWdufFJlZmVyZW5jZXxJbmRleCkvICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFhNTCAuPSAiXG4iOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgZGVmaW5lZCggJFRhZy0+e0NvbnRlbnR9ICkKICAgICAgICAgICAgICAgICAgICAgICAgJiYgJFRhZy0+e1RhZ0xldmVsfSA+PSA0CiAgICAgICAgICAgICAgICAgICAgICAgICYmICRUYWctPntUYWd9ICF+IC8oRm9yZWlnbnxSZWZlcmVuY2V8SW5kZXgpLwogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAkWE1MIC49ICRTZWxmLT5fRW5jb2RlKCAkVGFnLT57Q29udGVudH0gKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCAkVGFnLT57VGFnVHlwZX0gZXEgJ0VuZCcgKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAkQ291bnRlciA9ICRDb3VudGVyIC0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkVGFnLT57VGFnTGV2ZWx9ID4gMyAmJiAkVGFnLT57VGFnfSAhfiAvKEZvcmVpZ258UmVmZXJlbmNlfEluZGV4KS8gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkWE1MIC49ICI8LyRUYWctPntUYWd9PlxuIjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBteSAkU3BhY2UgPSAnJzsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCAxIC4uICRDb3VudGVyICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRTcGFjZSAuPSAnICAgICc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFhNTCAuPSAkU3BhY2UgLiAiPC8kVGFnLT57VGFnfT5cbiI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgJFhNTCAuPSAnPC9vdHJzX3BhY2thZ2U+JzsKCiAgICByZXR1cm4gJFhNTDsKfQoKPWl0ZW0gUGFja2FnZVBhcnNlKCkKCnBhcnNlIGEgcGFja2FnZQoKICAgIG15ICVTdHJ1Y3R1cmUgPSAkUGFja2FnZU9iamVjdC0+UGFja2FnZVBhcnNlKCBTdHJpbmcgPT4gJEZpbGVTdHJpbmcgKTsKCj1jdXQKCnN1YiBQYWNrYWdlUGFyc2UgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgaWYgKCAhZGVmaW5lZCAkUGFyYW17U3RyaW5nfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ1N0cmluZyBub3QgZGVmaW5lZCEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgY3JlYXRlIGNoZWNrc3VtCiAgICBteSAkQ29va2VkU3RyaW5nID0gcmVmICRQYXJhbXtTdHJpbmd9ID8gJHsgJFBhcmFte1N0cmluZ30gfSA6ICRQYXJhbXtTdHJpbmd9OwoKICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpFbmNvZGUnKS0+RW5jb2RlT3V0cHV0KCBcJENvb2tlZFN0cmluZyApOwoKICAgICMgY3JlYXRlIGNoZWNrc3VtCiAgICBteSAkQ2hlY2tzdW0gPSAkU2VsZi0+e01haW5PYmplY3R9LT5NRDVzdW0oCiAgICAgICAgU3RyaW5nID0+IFwkQ29va2VkU3RyaW5nLAogICAgKTsKCiAgICAjIGdldCBjYWNoZSBvYmplY3QKICAgIG15ICRDYWNoZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpOwoKICAgICMgY2hlY2sgY2FjaGUKICAgIGlmICgkQ2hlY2tzdW0pIHsKICAgICAgICBteSAkQ2FjaGUgPSAkQ2FjaGVPYmplY3QtPkdldCgKICAgICAgICAgICAgVHlwZSA9PiAnUGFja2FnZVBhcnNlJywKICAgICAgICAgICAgS2V5ICA9PiAkQ2hlY2tzdW0sCgogICAgICAgICAgICAjIERvbid0IHN0b3JlIGNvbXBsZXggc3RydWN0dXJlIGluIG1lbW9yeSBhcyBpdCB3aWxsIGJlIG1vZGlmaWVkIGxhdGVyLgogICAgICAgICAgICBDYWNoZUluTWVtb3J5ID0+IDAsCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gJXskQ2FjaGV9IGlmICRDYWNoZTsKICAgIH0KCiAgICAjIGdldCB4bWwgb2JqZWN0CiAgICBteSAkWE1MT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlhNTCcpOwoKICAgIG15IEBYTUxBUlJBWSA9IGV2YWwgewogICAgICAgICRYTUxPYmplY3QtPlhNTFBhcnNlKCVQYXJhbSk7CiAgICB9OwoKICAgIGlmICggIUlzQXJyYXlSZWZXaXRoRGF0YSggXEBYTUxBUlJBWSApICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiSW52YWxpZCBYTUxQYXJzZSBpbiBQYWNrYWdlUGFyc2UoKSEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIG15ICVQYWNrYWdlOwoKICAgICMgcGFyc2UgcGFja2FnZQogICAgbXkgJVBhY2thZ2VNYXAgPSAleyAkU2VsZi0+e1BhY2thZ2VNYXB9IH07CgogICAgVEFHOgogICAgZm9yIG15ICRUYWcgKEBYTUxBUlJBWSkgewoKICAgICAgICBuZXh0IFRBRyBpZiAkVGFnLT57VGFnVHlwZX0gbmUgJ1N0YXJ0JzsKCiAgICAgICAgaWYgKCAkUGFja2FnZU1hcHsgJFRhZy0+e1RhZ30gfSAmJiAkUGFja2FnZU1hcHsgJFRhZy0+e1RhZ30gfSBlcSAnU0NBTEFSJyApIHsKICAgICAgICAgICAgJFBhY2thZ2V7ICRUYWctPntUYWd9IH0gPSAkVGFnOwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRQYWNrYWdlTWFweyAkVGFnLT57VGFnfSB9ICYmICRQYWNrYWdlTWFweyAkVGFnLT57VGFnfSB9IGVxICdBUlJBWScgKSB7CgogICAgICAgICAgICAjIEZvciBjb21wYXQuIHRvIDIuMiAtIGNvbnZlcnQgSW50cm8oSW5zdGFsbHxVcGdyYWRlfFVuaW50YWxsKShQcmV8UG9zdCkgdG8KICAgICAgICAgICAgIyBlLiBnLiA8SW50cm9JbnN0YWxsIFR5cGU9InBvc3QiPi4KICAgICAgICAgICAgaWYgKCAkVGFnLT57VGFnfSA9fiAvXihJbnRybyhJbnN0YWxsfFVwZ3JhZGV8VW5pbnN0YWxsKSkoUHJlfFBvc3QpLyApIHsKICAgICAgICAgICAgICAgICRUYWctPntUYWd9ICA9ICQxOwogICAgICAgICAgICAgICAgJFRhZy0+e1R5cGV9ID0gbGMgJDM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgU2V0IGRlZmF1bHQgdHlwZSBvZiBDb2RlKiBhbmQgSW50cm8qIHRvIHBvc3QuCiAgICAgICAgICAgIGVsc2lmICggJFRhZy0+e1RhZ30gPX4gL14oQ29kZXxJbnRybykvICYmICEkVGFnLT57VHlwZX0gKSB7CiAgICAgICAgICAgICAgICAkVGFnLT57VHlwZX0gPSAncG9zdCc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1c2ggQHsgJFBhY2thZ2V7ICRUYWctPntUYWd9IH0gfSwgJFRhZzsKICAgICAgICB9CiAgICB9CgogICAgIyBkZWZpbmUgbmFtZXMgYW5kIGxvY2F0aW9ucyB0aGF0IGFyZSBub3QgYWxsb3dlZCBmb3IgZmlsZXMgaW4gYSBwYWNrYWdlCiAgICBteSAkRmlsZXNOb3RBbGxvd2VkID0gWwogICAgICAgICdLZXJuZWwvQ29uZmlnLnBtJCcsCiAgICAgICAgJ0tlcm5lbC9Db25maWcvRmlsZXMvWlpaQXV0by5wbSQnLAogICAgICAgICdLZXJuZWwvQ29uZmlnL0ZpbGVzL1paWkFBdXRvLnBtJCcsCiAgICAgICAgJ0tlcm5lbC9Db25maWcvRmlsZXMvWlpaUHJvY2Vzc01hbmFnZW1lbnQucG0kJywKICAgICAgICAndmFyL3RtcC9DYWNoZScsCiAgICAgICAgJ3Zhci9sb2cvJywKICAgICAgICAnXC5cLi8nLAogICAgICAgICdeLycsCiAgICBdOwoKICAgIG15ICRPcGVuID0gMDsKICAgIFRBRzoKICAgIGZvciBteSAkVGFnIChAWE1MQVJSQVkpIHsKCiAgICAgICAgaWYgKCAkT3BlbiAmJiAkVGFnLT57VGFnfSBlcSAnRmlsZWxpc3QnICkgewogICAgICAgICAgICAkT3BlbiA9IDA7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggISRPcGVuICYmICRUYWctPntUYWd9IGVxICdGaWxlbGlzdCcgKSB7CiAgICAgICAgICAgICRPcGVuID0gMTsKICAgICAgICAgICAgbmV4dCBUQUc7CiAgICAgICAgfQoKICAgICAgICBpZiAoICRPcGVuICYmICRUYWctPntUYWdUeXBlfSBlcSAnU3RhcnQnICkgewoKICAgICAgICAgICAgIyBjaGVjayBmb3IgYWxsb3dlZCBmaWxlIG5hbWVzIGFuZCBsb2NhdGlvbnMKICAgICAgICAgICAgRklMRUNIRUNLOgogICAgICAgICAgICBmb3IgbXkgJEZpbGVOb3RBbGxvd2VkICggQHskRmlsZXNOb3RBbGxvd2VkfSApIHsKCiAgICAgICAgICAgICAgICBuZXh0IEZJTEVDSEVDSyBpZiAkVGFnLT57TG9jYXRpb259ICF+IG17ICRGaWxlTm90QWxsb3dlZCB9eG1zOwoKICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkludmFsaWQgZmlsZS9sb2NhdGlvbiAnJFRhZy0+e0xvY2F0aW9ufScgaW4gUGFja2FnZVBhcnNlKCkhIiwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgbmV4dCBUQUc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgZ2V0IGF0dGFjaG1lbnQgc2l6ZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoICRUYWctPntDb250ZW50fSApIHsKCiAgICAgICAgICAgICAgICAgICAgbXkgJENvbnRlbnRQbGFpbiA9IDA7CgogICAgICAgICAgICAgICAgICAgIGlmICggJFRhZy0+e0VuY29kZX0gJiYgJFRhZy0+e0VuY29kZX0gZXEgJ0Jhc2U2NCcgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRUYWctPntFbmNvZGV9ICA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAkVGFnLT57Q29udGVudH0gPSBkZWNvZGVfYmFzZTY0KCAkVGFnLT57Q29udGVudH0gKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRUYWctPntTaXplfSA9IGJ5dGVzOjpsZW5ndGgoICRUYWctPntDb250ZW50fSApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBwdXNoIEB7ICRQYWNrYWdle0ZpbGVsaXN0fSB9LCAkVGFnOwogICAgICAgIH0KICAgIH0KCiAgICBmb3IgbXkgJEtleSAocXcoRGF0YWJhc2VJbnN0YWxsIERhdGFiYXNlVXBncmFkZSBEYXRhYmFzZVJlaW5zdGFsbCBEYXRhYmFzZVVuaW5zdGFsbCkpIHsKCiAgICAgICAgbXkgJFR5cGUgPSAncG9zdCc7CgogICAgICAgIFRBRzoKICAgICAgICBmb3IgbXkgJFRhZyAoQFhNTEFSUkFZKSB7CgogICAgICAgICAgICBpZiAoICRPcGVuICYmICRUYWctPntUYWd9IGVxICRLZXkgKSB7CiAgICAgICAgICAgICAgICAkT3BlbiA9IDA7CiAgICAgICAgICAgICAgICBwdXNoKCBAeyAkUGFja2FnZXskS2V5fS0+eyRUeXBlfSB9LCAkVGFnICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCAhJE9wZW4gJiYgJFRhZy0+e1RhZ30gZXEgJEtleSApIHsKCiAgICAgICAgICAgICAgICAkT3BlbiA9IDE7CgogICAgICAgICAgICAgICAgaWYgKCAkVGFnLT57VHlwZX0gKSB7CiAgICAgICAgICAgICAgICAgICAgJFR5cGUgPSAkVGFnLT57VHlwZX07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG5leHQgVEFHIGlmICEkT3BlbjsKCiAgICAgICAgICAgIHB1c2ggQHsgJFBhY2thZ2V7JEtleX0tPnskVHlwZX0gfSwgJFRhZzsKICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBpZiBhIHN0cnVjdHVyZSBpcyBwcmVzZW50CiAgICBpZiAoICElUGFja2FnZSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkludmFsaWQgcGFja2FnZSBzdHJ1Y3R1cmUgaW4gUGFja2FnZVBhcnNlKCkhIiwKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIHNldCBjYWNoZQogICAgaWYgKCRDaGVja3N1bSkgewogICAgICAgICRDYWNoZU9iamVjdC0+U2V0KAogICAgICAgICAgICBUeXBlICA9PiAnUGFja2FnZVBhcnNlJywKICAgICAgICAgICAgS2V5ICAgPT4gJENoZWNrc3VtLAogICAgICAgICAgICBWYWx1ZSA9PiBcJVBhY2thZ2UsCiAgICAgICAgICAgIFRUTCAgID0+IDMwICogMjQgKiA2MCAqIDYwLAoKICAgICAgICAgICAgIyBEb24ndCBzdG9yZSBjb21wbGV4IHN0cnVjdHVyZSBpbiBtZW1vcnkgYXMgaXQgd2lsbCBiZSBtb2RpZmllZCBsYXRlci4KICAgICAgICAgICAgQ2FjaGVJbk1lbW9yeSA9PiAwLAogICAgICAgICk7CiAgICB9CgogICAgcmV0dXJuICVQYWNrYWdlOwp9Cgo9aXRlbSBQYWNrYWdlRXhwb3J0KCkKCmV4cG9ydCBmaWxlcyBvZiBhbiBwYWNrYWdlCgogICAgJFBhY2thZ2VPYmplY3QtPlBhY2thZ2VFeHBvcnQoCiAgICAgICAgU3RyaW5nID0+ICRGaWxlU3RyaW5nLAogICAgICAgIEhvbWUgICA9PiAnL3BhdGgvdG8vZXhwb3J0JwogICAgKTsKCj1jdXQKCnN1YiBQYWNrYWdlRXhwb3J0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGZvciBteSAkTmVlZGVkIChxdyhTdHJpbmcgSG9tZSkpIHsKICAgICAgICBpZiAoICFkZWZpbmVkICRQYXJhbXskTmVlZGVkfSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIiROZWVkZWQgbm90IGRlZmluZWQhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjIHBhcnNlIHNvdXJjZSBmaWxlCiAgICBteSAlU3RydWN0dXJlID0gJFNlbGYtPlBhY2thZ2VQYXJzZSglUGFyYW0pOwoKICAgIHJldHVybiAxIGlmICEkU3RydWN0dXJle0ZpbGVsaXN0fTsKICAgIHJldHVybiAxIGlmIHJlZiAkU3RydWN0dXJle0ZpbGVsaXN0fSBuZSAnQVJSQVknOwoKICAgICMgaW5zdGFsbCBmaWxlcwogICAgZm9yIG15ICRGaWxlICggQHsgJFN0cnVjdHVyZXtGaWxlbGlzdH0gfSApIHsKCiAgICAgICAgJFNlbGYtPl9GaWxlSW5zdGFsbCgKICAgICAgICAgICAgRmlsZSA9PiAkRmlsZSwKICAgICAgICAgICAgSG9tZSA9PiAkUGFyYW17SG9tZX0sCiAgICAgICAgKTsKICAgIH0KCiAgICByZXR1cm4gMTsKfQoKPWl0ZW0gUGFja2FnZUlzSW5zdGFsbGVkKCkKCnJldHVybnMgdHJ1ZSBpZiB0aGUgcGFja2FnZSBpcyBhbHJlYWR5IGluc3RhbGxlZAoKICAgICRQYWNrYWdlT2JqZWN0LT5QYWNrYWdlSXNJbnN0YWxsZWQoCiAgICAgICAgU3RyaW5nID0+ICRQYWNrYWdlU3RyaW5nLCAgICAjIEF0dHJpYnV0ZSBTdHJpbmcgb3IgTmFtZSBpcyByZXF1aXJlZAogICAgICAgIE5hbWUgICA9PiAkTmFtZU9mVGhlUGFja2FnZSwKICAgICk7Cgo9Y3V0CgpzdWIgUGFja2FnZUlzSW5zdGFsbGVkIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGlmICggISRQYXJhbXtTdHJpbmd9ICYmICEkUGFyYW17TmFtZX0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdOZWVkIFN0cmluZyAoUGFja2FnZVN0cmluZykgb3IgTmFtZSAoTmFtZSBvZiB0aGUgcGFja2FnZSkhJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtTdHJpbmd9ICkgewogICAgICAgIG15ICVTdHJ1Y3R1cmUgPSAkU2VsZi0+UGFja2FnZVBhcnNlKCVQYXJhbSk7CiAgICAgICAgJFBhcmFte05hbWV9ID0gJFN0cnVjdHVyZXtOYW1lfS0+e0NvbnRlbnR9OwogICAgfQoKICAgICMgZ2V0IGRhdGFiYXNlIG9iamVjdAogICAgbXkgJERCT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkRCJyk7CgogICAgJERCT2JqZWN0LT5QcmVwYXJlKAogICAgICAgIFNRTCA9PiAiU0VMRUNUIG5hbWUgRlJPTSBwYWNrYWdlX3JlcG9zaXRvcnkgIgogICAgICAgICAgICAuICJXSEVSRSBuYW1lID0gPyBBTkQgaW5zdGFsbF9zdGF0dXMgPSAnaW5zdGFsbGVkJyIsCiAgICAgICAgQmluZCAgPT4gWyBcJFBhcmFte05hbWV9IF0sCiAgICAgICAgTGltaXQgPT4gMSwKICAgICk7CgogICAgbXkgJEZsYWcgPSAwOwogICAgd2hpbGUgKCBteSBAUm93ID0gJERCT2JqZWN0LT5GZXRjaHJvd0FycmF5KCkgKSB7CiAgICAgICAgJEZsYWcgPSAxOwogICAgfQoKICAgIHJldHVybiAkRmxhZzsKfQoKPWl0ZW0gUGFja2FnZUluc3RhbGxEZWZhdWx0RmlsZXMoKQoKcmV0dXJucyB0cnVlIGlmIHRoZSBkaXN0cmlidXRpb24gcGFja2FnZSAobG9jYXRlZCB1bmRlciApIGNhbiBnZXQgaW5zdGFsbGVkCgogICAgJFBhY2thZ2VPYmplY3QtPlBhY2thZ2VJbnN0YWxsRGVmYXVsdEZpbGVzKCk7Cgo9Y3V0CgpzdWIgUGFja2FnZUluc3RhbGxEZWZhdWx0RmlsZXMgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkRGlyZWN0b3J5ICAgID0gJFNlbGYtPntDb25maWdPYmplY3R9LT5HZXQoJ0hvbWUnKSAuICcvdmFyL3BhY2thZ2VzJzsKICAgIG15IEBQYWNrYWdlRmlsZXMgPSAkU2VsZi0+e01haW5PYmplY3R9LT5EaXJlY3RvcnlSZWFkKAogICAgICAgIERpcmVjdG9yeSA9PiAkRGlyZWN0b3J5LAogICAgICAgIEZpbHRlciAgICA9PiAnKi5vcG0nLAogICAgKTsKCiAgICAjIHJlYWQgcGFja2FnZXMgYW5kIGluc3RhbGwKICAgIExPQ0FUSU9OOgogICAgZm9yIG15ICRMb2NhdGlvbiAoQFBhY2thZ2VGaWxlcykgewoKICAgICAgICAjIHJlYWQgcGFja2FnZQogICAgICAgIG15ICRDb250ZW50U0NBTEFSUmVmID0gJFNlbGYtPntNYWluT2JqZWN0fS0+RmlsZVJlYWQoCiAgICAgICAgICAgIExvY2F0aW9uID0+ICRMb2NhdGlvbiwKICAgICAgICAgICAgTW9kZSAgICAgPT4gJ2Jpbm1vZGUnLAogICAgICAgICAgICBUeXBlICAgICA9PiAnTG9jYWwnLAogICAgICAgICAgICBSZXN1bHQgICA9PiAnU0NBTEFSJywKICAgICAgICApOwoKICAgICAgICBuZXh0IExPQ0FUSU9OIGlmICEkQ29udGVudFNDQUxBUlJlZjsKCiAgICAgICAgIyBpbnN0YWxsIHBhY2thZ2UgKHVzZSBldmFsIHRvIGJlIHNhZmUpCiAgICAgICAgZXZhbCB7CiAgICAgICAgICAgICRTZWxmLT5QYWNrYWdlSW5zdGFsbCggU3RyaW5nID0+ICR7JENvbnRlbnRTQ0FMQVJSZWZ9ICk7CiAgICAgICAgfTsKCiAgICAgICAgbmV4dCBMT0NBVElPTiBpZiAhJEA7CgogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAkQCwKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiAxOwp9Cgo9aXRlbSBQYWNrYWdlRmlsZUdldE1ENVN1bSgpCgpnZW5lcmF0ZXMgYSBNRDUgU3VtIGZvciBhbGwgZmlsZXMgaW4gYSBnaXZlbiBwYWNrYWdlCgogICAgbXkgJE1ENVN1bSA9ICRQYWNrYWdlT2JqZWN0LT5QYWNrYWdlRmlsZUdldE1ENVN1bSgKICAgICAgICBOYW1lID0+ICdQYWNrYWdlIE5hbWUnLAogICAgICAgIFZlcnNpb24gPT4gMTIzLjAsCiAgICApOwoKcmV0dXJuczoKICAgICRNRDVTdW1Mb29rdXAgPSB7CiAgICAgICAgJ0RpcmVjb3R5L0ZpbGUxJyA9PiAnZjNmMzBiZDU5YWZhZGY1NDI3NzBkNDNlZGIyODA0ODknCiAgICAgICAgJ0RpcmVjb3R5L0ZpbGUyJyA9PiAnY2NiOGEwYjg2YWRmMTI1YTM2MzkyZTM4OGViOTY3NzgnCiAgICB9OwoKPWN1dAoKc3ViIFBhY2thZ2VGaWxlR2V0TUQ1U3VtIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgZm9yIG15ICROZWVkZWQgKHF3KE5hbWUgVmVyc2lvbikpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQhIiwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgIyBnZXQgY2FjaGUgb2JqZWN0CiAgICBteSAkQ2FjaGVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKTsKCiAgICAjIGNoZWNrIGNhY2hlCiAgICBteSAkQ2FjaGVLZXkgPSAkUGFyYW17TmFtZX0gLiAkUGFyYW17VmVyc2lvbn07CiAgICBteSAkQ2FjaGUgICAgPSAkQ2FjaGVPYmplY3QtPkdldCgKICAgICAgICBUeXBlID0+ICdQYWNrYWdlRmlsZUdldE1ENVN1bScsCiAgICAgICAgS2V5ICA9PiAkQ2FjaGVLZXksCiAgICApOwogICAgcmV0dXJuICRDYWNoZSBpZiBJc0hhc2hSZWZXaXRoRGF0YSgkQ2FjaGUpOwoKICAgICMgZ2V0IHRoZSBwYWNrYWdlIGNvbnRlbnRzCiAgICBteSAkUGFja2FnZSA9ICRTZWxmLT5SZXBvc2l0b3J5R2V0KAogICAgICAgICVQYXJhbSwKICAgICAgICBSZXN1bHQgPT4gJ1NDQUxBUicsCiAgICApOwogICAgbXkgJVN0cnVjdHVyZSA9ICRTZWxmLT5QYWNrYWdlUGFyc2UoIFN0cmluZyA9PiAkUGFja2FnZSApOwoKICAgIHJldHVybiAxIGlmICEkU3RydWN0dXJle0ZpbGVsaXN0fTsKICAgIHJldHVybiAxIGlmIHJlZiAkU3RydWN0dXJle0ZpbGVsaXN0fSBuZSAnQVJSQVknOwoKICAgICMgY2xlYW51cCB0aGUgSG9tZSB2YXJpYWJsZSAocmVtb3ZlIHRhaWxpbmcgIi8iKQogICAgbXkgJEhvbWUgPSAkU2VsZi0+e0hvbWV9OwogICAgJEhvbWUgPX4gc3tcL1x6fXt9OwoKICAgIG15ICVNRDVTdW1Mb29rdXA7CiAgICBmb3IgbXkgJEZpbGUgKCBAeyAkU3RydWN0dXJle0ZpbGVsaXN0fSB9ICkgewoKICAgICAgICBteSAkTG9jYWxGaWxlID0gJEhvbWUgLiAnLycgLiAkRmlsZS0+e0xvY2F0aW9ufTsKCiAgICAgICAgIyBnZW5lcmF0ZSB0aGUgTUQ1U3VtCiAgICAgICAgbXkgJE1ENVN1bSA9ICRTZWxmLT57TWFpbk9iamVjdH0tPk1ENXN1bSgKICAgICAgICAgICAgU3RyaW5nID0+IFwkRmlsZS0+e0NvbnRlbnR9LAogICAgICAgICk7CgogICAgICAgICRNRDVTdW1Mb29rdXB7JExvY2FsRmlsZX0gPSAkTUQ1U3VtOwogICAgfQoKICAgICMgc2V0IGNhY2hlCiAgICAkQ2FjaGVPYmplY3QtPlNldCgKICAgICAgICBUeXBlICA9PiAnUGFja2FnZUZpbGVHZXRNRDVTdW0nLAogICAgICAgIEtleSAgID0+ICRDYWNoZUtleSwKICAgICAgICBWYWx1ZSA9PiBcJU1ENVN1bUxvb2t1cCwKICAgICAgICBUVEwgICA9PiA2ICogMzAgKiAyNCAqIDYwICogNjAsICAgICMgNiBNb250aHMgKEFwcm94KQogICAgKTsKCiAgICByZXR1cm4gXCVNRDVTdW1Mb29rdXA7Cn0KCj1iZWdpbiBJbnRlcm5hbDoKCj1jdXQKCnN1YiBfRG93bmxvYWQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgaWYgKCAhZGVmaW5lZCAkUGFyYW17VVJMfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ1VSTCBub3QgZGVmaW5lZCEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIG15ICRXZWJVc2VyQWdlbnRPYmplY3QgPSBLZXJuZWw6OlN5c3RlbTo6V2ViVXNlckFnZW50LT5uZXcoCiAgICAgICAgVGltZW91dCA9PiAkU2VsZi0+e0NvbmZpZ09iamVjdH0tPkdldCgnUGFja2FnZTo6VGltZW91dCcpLAogICAgICAgIFByb3h5ICAgPT4gJFNlbGYtPntDb25maWdPYmplY3R9LT5HZXQoJ1BhY2thZ2U6OlByb3h5JyksCiAgICApOwoKICAgIG15ICVSZXNwb25zZSA9ICRXZWJVc2VyQWdlbnRPYmplY3QtPlJlcXVlc3QoCiAgICAgICAgVVJMID0+ICRQYXJhbXtVUkx9LAogICAgKTsKCiAgICByZXR1cm4gaWYgISRSZXNwb25zZXtDb250ZW50fTsKICAgIHJldHVybiAkeyAkUmVzcG9uc2V7Q29udGVudH0gfTsKfQoKc3ViIF9EYXRhYmFzZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICFkZWZpbmVkICRQYXJhbXtEYXRhYmFzZX0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdEYXRhYmFzZSBub3QgZGVmaW5lZCEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmICggcmVmICRQYXJhbXtEYXRhYmFzZX0gbmUgJ0FSUkFZJyApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgYXJyYXkgcmVmIGluIERhdGFiYXNlIHBhcmFtIScsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBnZXQgZGF0YWJhc2Ugb2JqZWN0CiAgICBteSAkREJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6REInKTsKCiAgICBteSBAU1FMID0gJERCT2JqZWN0LT5TUUxQcm9jZXNzb3IoCiAgICAgICAgRGF0YWJhc2UgPT4gJFBhcmFte0RhdGFiYXNlfSwKICAgICk7CgogICAgZm9yIG15ICRTUUwgKEBTUUwpIHsKICAgICAgICBwcmludCBTVERFUlIgIk5vdGljZTogJFNRTFxuIjsKICAgICAgICAkREJPYmplY3QtPkRvKCBTUUwgPT4gJFNRTCApOwogICAgfQoKICAgIG15IEBTUUxQb3N0ID0gJERCT2JqZWN0LT5TUUxQcm9jZXNzb3JQb3N0KCk7CgogICAgZm9yIG15ICRTUUwgKEBTUUxQb3N0KSB7CiAgICAgICAgcHJpbnQgU1RERVJSICJOb3RpY2U6ICRTUUxcbiI7CiAgICAgICAgJERCT2JqZWN0LT5EbyggU1FMID0+ICRTUUwgKTsKICAgIH0KCiAgICByZXR1cm4gMTsKfQoKc3ViIF9Db2RlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGZvciBteSAkTmVlZGVkIChxdyhDb2RlIFR5cGUgU3RydWN0dXJlKSkgewogICAgICAgIGlmICggIWRlZmluZWQgJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiJE5lZWRlZCBub3QgZGVmaW5lZCEiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgY2hlY2sgZm9ybWF0CiAgICBpZiAoIHJlZiAkUGFyYW17Q29kZX0gbmUgJ0FSUkFZJyApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgYXJyYXkgcmVmIGluIENvZGUgcGFyYW0hJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGV4ZWN1dGUgY29kZQogICAgQ09ERToKICAgIGZvciBteSAkQ29kZSAoIEB7ICRQYXJhbXtDb2RlfSB9ICkgewoKICAgICAgICBuZXh0IENPREUgaWYgISRDb2RlLT57Q29udGVudH07CiAgICAgICAgbmV4dCBDT0RFIGlmICRQYXJhbXtUeXBlfSAhfiAvXiRDb2RlLT57VHlwZX0kL2k7CgogICAgICAgICMgaWYgdGhlIG1lcmdlZCBwYWNrYWdlcyB3YXMgYWxyZWFkeSBpbnN0YWxsZWQgb3Igbm90CiAgICAgICAgaWYgKAogICAgICAgICAgICAoCiAgICAgICAgICAgICAgICBkZWZpbmVkICRDb2RlLT57SWZQYWNrYWdlfQogICAgICAgICAgICAgICAgJiYgISRTZWxmLT57TWVyZ2VkUGFja2FnZXN9LT57ICRDb2RlLT57SWZQYWNrYWdlfSB9CiAgICAgICAgICAgICkKICAgICAgICAgICAgfHwgKAogICAgICAgICAgICAgICAgZGVmaW5lZCAkQ29kZS0+e0lmTm90UGFja2FnZX0KICAgICAgICAgICAgICAgICYmICgKICAgICAgICAgICAgICAgICAgICAkU2VsZi0+e01lcmdlZFBhY2thZ2VzfS0+eyAkQ29kZS0+e0lmTm90UGFja2FnZX0gfQogICAgICAgICAgICAgICAgICAgIHx8ICRTZWxmLT5QYWNrYWdlSXNJbnN0YWxsZWQoIE5hbWUgPT4gJENvZGUtPntJZk5vdFBhY2thZ2V9ICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKQogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICBuZXh0IENPREU7CiAgICAgICAgfQoKICAgICAgICBwcmludCBTVERFUlIgIkNvZGU6ICRDb2RlLT57Q29udGVudH1cbiI7CgogICAgICAgIGlmICggIWV2YWwgJENvZGUtPntDb250ZW50fSAuICJcbjE7IiApIHsgICAgIyMgbm8gY3JpdGljCiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDb2RlOiAkQCIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIDE7Cn0KCnN1YiBfT1NDaGVjayB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICFkZWZpbmVkICRQYXJhbXtPU30gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdPUyBub3QgZGVmaW5lZCEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgY2hlY2sgZm9ybWF0CiAgICBpZiAoIHJlZiAkUGFyYW17T1N9IG5lICdBUlJBWScgKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdOZWVkIGFycmF5IHJlZiBpbiBPUyBwYXJhbSEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgY2hlY2sgT1MKICAgIG15ICRPU0NoZWNrICAgPSAwOwogICAgbXkgJEN1cnJlbnRPUyA9ICReTzsKICAgIG15IEBUZXN0ZWRPUzsKCiAgICBPUzoKICAgIGZvciBteSAkT1MgKCBAeyAkUGFyYW17T1N9IH0gKSB7CiAgICAgICAgbmV4dCBPUyBpZiAhJE9TLT57Q29udGVudH07CiAgICAgICAgcHVzaCBAVGVzdGVkT1MsICRPUy0+e0NvbnRlbnR9OwogICAgICAgIG5leHQgT1MgaWYgJEN1cnJlbnRPUyAhfiAvXiRPUy0+e0NvbnRlbnR9JC9pOwoKICAgICAgICAkT1NDaGVjayA9IDE7CiAgICAgICAgbGFzdCBPUzsKICAgIH0KCiAgICByZXR1cm4gMSBpZiAkT1NDaGVjazsKICAgIHJldHVybiAgIGlmICRQYXJhbXtOb0xvZ307CgogICAgbXkgJFBvc3NpYmxlT1MgPSBqb2luICcsICcsIEBUZXN0ZWRPUzsKCiAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgIE1lc3NhZ2UgID0+ICJTb3JyeSwgY2FuJ3QgaW5zdGFsbC91cGdyYWRlIHBhY2thZ2UsIGJlY2F1c2UgT1Mgb2YgcGFja2FnZSAiCiAgICAgICAgICAgIC4gIigkUG9zc2libGVPUykgZG9lcyBub3QgbWF0Y2ggeW91ciBPUyAoJEN1cnJlbnRPUykhIiwKICAgICk7CgogICAgcmV0dXJuOwp9CgpzdWIgX0NoZWNrRnJhbWV3b3JrIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGlmICggIWRlZmluZWQgJFBhcmFte0ZyYW1ld29ya30gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdGcmFtZXdvcmsgbm90IGRlZmluZWQhJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGNoZWNrIGZvcm1hdAogICAgaWYgKCByZWYgJFBhcmFte0ZyYW1ld29ya30gbmUgJ0FSUkFZJyApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgYXJyYXkgcmVmIGluIEZyYW1ld29yayBwYXJhbSEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIG15ICRGV0NoZWNrICAgICAgICAgICA9IDA7CiAgICBteSAkQ3VycmVudEZyYW1ld29yayAgPSAkU2VsZi0+e0NvbmZpZ09iamVjdH0tPkdldCgnVmVyc2lvbicpOwogICAgbXkgJFBvc3NpYmxlRnJhbWV3b3JrID0gJyc7CgogICAgaWYgKCByZWYgJFBhcmFte0ZyYW1ld29ya30gZXEgJ0FSUkFZJyApIHsKCiAgICAgICAgRlc6CiAgICAgICAgZm9yIG15ICRGVyAoIEB7ICRQYXJhbXtGcmFtZXdvcmt9IH0gKSB7CgogICAgICAgICAgICBuZXh0IEZXIGlmICEkRlc7CgogICAgICAgICAgICAkUG9zc2libGVGcmFtZXdvcmsgLj0gJEZXLT57Q29udGVudH0gLiAnOyc7CgogICAgICAgICAgICAjIHJlZ2V4cCBtb2RpZnkKICAgICAgICAgICAgbXkgJEZyYW1ld29yayA9ICRGVy0+e0NvbnRlbnR9OwogICAgICAgICAgICAkRnJhbWV3b3JrID1+IHMvXC4vXFxcLi9nOwogICAgICAgICAgICAkRnJhbWV3b3JrID1+IHMveC8uKz8vZ2k7CgogICAgICAgICAgICBuZXh0IEZXIGlmICRDdXJyZW50RnJhbWV3b3JrICF+IC9eJEZyYW1ld29yayQvaTsKCiAgICAgICAgICAgICRGV0NoZWNrID0gMTsKCiAgICAgICAgICAgIGxhc3QgRlc7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAxIGlmICRGV0NoZWNrOwogICAgcmV0dXJuICAgaWYgJFBhcmFte05vTG9nfTsKCiAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgIE1lc3NhZ2UgID0+ICJTb3JyeSwgY2FuJ3QgaW5zdGFsbC91cGdyYWRlIHBhY2thZ2UsIGJlY2F1c2UgdGhlIGZyYW1ld29yayB2ZXJzaW9uIHJlcXVpcmVkIgogICAgICAgICAgICAuICIgYnkgdGhlIHBhY2thZ2UgKCRQb3NzaWJsZUZyYW1ld29yaykgZG9lcyBub3QgbWF0Y2ggeW91ciBGcmFtZXdvcmsgKCRDdXJyZW50RnJhbWV3b3JrKSEiLAogICAgKTsKCiAgICByZXR1cm47Cn0KCj1pdGVtIF9DaGVja1ZlcnNpb24oKQoKQ29tcGFyZSB0aGUgdHdvIHZlcnNpb24gc3RyaW5ncyAkVmVyc2lvbk5ldyBhbmQgJFZlcnNpb25JbnN0YWxsZWQuClRoZSB0eXBlIGlzIGVpdGhlciAnTWluJyBvciAnTWF4Jy4KJ01pbicgcmV0dXJucyBhIHRydWUgdmFsdWUgaWYgJFZlcnNpb25JbnN0YWxsZWQgPj0gJFZlcnNpb25OZXcuCidNYXgnIHJldHVybnMgYSB0cnVlIHZhbHVlIGlmICRWZXJzaW9uSW5zdGFsbGVkIDwgJFZlcnNpb25OZXcuCk90aGVyd2lzZSB1bmRlZiBpcyByZXR1cm5lZCBpbiBzY2FsYXIgY29udGV4dC4KCiAgICBteSAkQ2hlY2tPayA9ICRQYWNrYWdlT2JqZWN0LT5fQ2hlY2tWZXJzaW9uKAogICAgICAgIFZlcnNpb25OZXcgICAgICAgPT4gJzEuMy45MicsCiAgICAgICAgVmVyc2lvbkluc3RhbGxlZCA9PiAnMS4zLjkxJywKICAgICAgICBUeXBlICAgICAgICAgICAgID0+ICdNaW4nLCAgICAgIyAnTWluJyBvciAnTWF4JwogICAgICAgIEV4dGVybmFsUGFja2FnZSAgPT4gMSwgICAgICAgICAjIG9wdGlvbmFsCiAgICApCgo9Y3V0CgpzdWIgX0NoZWNrVmVyc2lvbiB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoVmVyc2lvbk5ldyBWZXJzaW9uSW5zdGFsbGVkIFR5cGUpKSB7CiAgICAgICAgaWYgKCAhZGVmaW5lZCAkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICIkTmVlZGVkIG5vdCBkZWZpbmVkISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBUeXBlCiAgICBpZiAoICRQYXJhbXtUeXBlfSBuZSAnTWluJyAmJiAkUGFyYW17VHlwZX0gbmUgJ01heCcgKSB7CgogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnSW52YWxpZCBUeXBlIScsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBwcmVwYXJlIHBhcnRzIGhhc2gKICAgIG15ICVQYXJ0czsKICAgIFRZUEU6CiAgICBmb3IgbXkgJFR5cGUgKHF3KFZlcnNpb25OZXcgVmVyc2lvbkluc3RhbGxlZCkpIHsKCiAgICAgICAgIyBzcGxpdCB2ZXJzaW9uIHN0cmluZwogICAgICAgIG15IEBUaGlzUGFydHMgPSBzcGxpdCAvXC4vLCAkUGFyYW17JFR5cGV9OwoKICAgICAgICAkUGFydHN7JFR5cGV9ID0gXEBUaGlzUGFydHM7CiAgICAgICAgJFBhcnRzeyAkVHlwZSAuICdOdW0nIH0gPSBzY2FsYXIgQFRoaXNQYXJ0czsKICAgIH0KCiAgICAjIGlmIGl0IGlzIG5vdCBhbiBleHRlcm5hbCBwYWNrYWdlLCBhbmQgdGhlIHZlcnNpb25zIGFyZSBkaWZmZXJlbnQKICAgICMgd2Ugd2FudCB0byBhZGQgYSAwIGF0IHRoZSBlbmQgb2YgdGhlIHNob3J0ZXIgdmVyc2lvbiBudW1iZXIKICAgICMgKDEuMi4zIHdpbGwgYmUgbW9kaWZpZWQgdG8gMS4yLjMuMCkKICAgICMgVGhpcyBpcyBpbXBvcnRhbnQgdG8gY29tcGFyZSB3aXRoIGEgdGVzdC1yZWxlYXNlIHZlcnNpb24gbnVtYmVyCiAgICBpZiAoICEkUGFyYW17RXh0ZXJuYWxQYWNrYWdlfSAmJiAkUGFydHN7VmVyc2lvbk5ld051bX0gbmUgJFBhcnRze1ZlcnNpb25JbnN0YWxsZWROdW19ICkgewoKICAgICAgICBUWVBFOgogICAgICAgIGZvciBteSAkVHlwZSAocXcoVmVyc2lvbk5ldyBWZXJzaW9uSW5zdGFsbGVkKSkgewoKICAgICAgICAgICAgbmV4dCBUWVBFIGlmICRQYXJ0c3sgJFR5cGUgLiAnTnVtJyB9ID4gMzsKCiAgICAgICAgICAgICMgYWRkIGEgemVybyBhdCB0aGUgZW5kIGlmIG51bWJlciBoYXMgbGVzcyB0aGFuIDQgZGlnaXRzCiAgICAgICAgICAgIHB1c2ggQHsgJFBhcnRzeyRUeXBlfSB9LCAwOwogICAgICAgICAgICAkUGFydHN7ICRUeXBlIC4gJ051bScgfSA9IHNjYWxhciBAeyAkUGFydHN7JFR5cGV9IH07CiAgICAgICAgfQogICAgfQoKICAgIENPVU5UOgogICAgZm9yIG15ICRDb3VudCAoIDAgLi4gNSApIHsKCiAgICAgICAgJFBhcnRze1ZlcnNpb25OZXd9LT5bJENvdW50XSAgICAgICB8fD0gMDsKICAgICAgICAkUGFydHN7VmVyc2lvbkluc3RhbGxlZH0tPlskQ291bnRdIHx8PSAwOwoKICAgICAgICBuZXh0IENPVU5UIGlmICRQYXJ0c3tWZXJzaW9uTmV3fS0+WyRDb3VudF0gZXEgJFBhcnRze1ZlcnNpb25JbnN0YWxsZWR9LT5bJENvdW50XTsKCiAgICAgICAgIyBjb21wYXJlIHZlcnNpb25zCiAgICAgICAgaWYgKCAkUGFyYW17VHlwZX0gZXEgJ01pbicgKSB7CiAgICAgICAgICAgIHJldHVybiAxIGlmICRQYXJ0c3tWZXJzaW9uSW5zdGFsbGVkfS0+WyRDb3VudF0gPj0gJFBhcnRze1ZlcnNpb25OZXd9LT5bJENvdW50XTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRQYXJhbXtUeXBlfSBlcSAnTWF4JyApIHsKICAgICAgICAgICAgcmV0dXJuIDEgaWYgJFBhcnRze1ZlcnNpb25JbnN0YWxsZWR9LT5bJENvdW50XSA8ICRQYXJ0c3tWZXJzaW9uTmV3fS0+WyRDb3VudF07CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIDEgaWYgJFBhcmFte1R5cGV9IGVxICdNaW4nOwogICAgcmV0dXJuOwp9CgpzdWIgX0NoZWNrUGFja2FnZVJlcXVpcmVkIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGlmICggIWRlZmluZWQgJFBhcmFte1BhY2thZ2VSZXF1aXJlZH0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdQYWNrYWdlUmVxdWlyZWQgbm90IGRlZmluZWQhJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICByZXR1cm4gMSBpZiAhJFBhcmFte1BhY2thZ2VSZXF1aXJlZH07CiAgICByZXR1cm4gMSBpZiByZWYgJFBhcmFte1BhY2thZ2VSZXF1aXJlZH0gbmUgJ0FSUkFZJzsKCiAgICAjIGdldCByZXBvc2l0b3J5IGxpc3QKICAgIG15IEBSZXBvc2l0b3J5TGlzdCA9ICRTZWxmLT5SZXBvc2l0b3J5TGlzdCgpOwoKICAgICMgY2hlY2sgcmVxdWlyZWQgcGFja2FnZXMKICAgIFBBQ0tBR0U6CiAgICBmb3IgbXkgJFBhY2thZ2UgKCBAeyAkUGFyYW17UGFja2FnZVJlcXVpcmVkfSB9ICkgewoKICAgICAgICBuZXh0IFBBQ0tBR0UgaWYgISRQYWNrYWdlOwoKICAgICAgICBteSAkSW5zdGFsbGVkICAgICAgICA9IDA7CiAgICAgICAgbXkgJEluc3RhbGxlZFZlcnNpb24gPSAwOwoKICAgICAgICBMT0NBTDoKICAgICAgICBmb3IgbXkgJExvY2FsIChAUmVwb3NpdG9yeUxpc3QpIHsKCiAgICAgICAgICAgIG5leHQgTE9DQUwgaWYgJExvY2FsLT57TmFtZX0tPntDb250ZW50fSBuZSAkUGFja2FnZS0+e0NvbnRlbnR9OwogICAgICAgICAgICBuZXh0IExPQ0FMIGlmICRMb2NhbC0+e1N0YXR1c30gbmUgJ2luc3RhbGxlZCc7CgogICAgICAgICAgICAkSW5zdGFsbGVkICAgICAgICA9IDE7CiAgICAgICAgICAgICRJbnN0YWxsZWRWZXJzaW9uID0gJExvY2FsLT57VmVyc2lvbn0tPntDb250ZW50fTsKICAgICAgICAgICAgbGFzdCBMT0NBTDsKICAgICAgICB9CgogICAgICAgIGlmICggISRJbnN0YWxsZWQgKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJTb3JyeSwgY2FuJ3QgaW5zdGFsbCBwYWNrYWdlLCBiZWNhdXNlIHBhY2thZ2UgIgogICAgICAgICAgICAgICAgICAgIC4gIiRQYWNrYWdlLT57Q29udGVudH0gdiRQYWNrYWdlLT57VmVyc2lvbn0gaXMgcmVxdWlyZWQhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgbXkgJFZlcnNpb25DaGVjayA9ICRTZWxmLT5fQ2hlY2tWZXJzaW9uKAogICAgICAgICAgICBWZXJzaW9uTmV3ICAgICAgID0+ICRQYWNrYWdlLT57VmVyc2lvbn0sCiAgICAgICAgICAgIFZlcnNpb25JbnN0YWxsZWQgPT4gJEluc3RhbGxlZFZlcnNpb24sCiAgICAgICAgICAgIFR5cGUgICAgICAgICAgICAgPT4gJ01pbicsCiAgICAgICAgKTsKCiAgICAgICAgbmV4dCBQQUNLQUdFIGlmICRWZXJzaW9uQ2hlY2s7CgogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiU29ycnksIGNhbid0IGluc3RhbGwgcGFja2FnZSwgYmVjYXVzZSAiCiAgICAgICAgICAgICAgICAuICJwYWNrYWdlICRQYWNrYWdlLT57Q29udGVudH0gdiRQYWNrYWdlLT57VmVyc2lvbn0gaXMgcmVxdWlyZWQhIiwKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICByZXR1cm4gMTsKfQoKc3ViIF9DaGVja01vZHVsZVJlcXVpcmVkIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGlmICggIWRlZmluZWQgJFBhcmFte01vZHVsZVJlcXVpcmVkfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ01vZHVsZVJlcXVpcmVkIG5vdCBkZWZpbmVkIScsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBjaGVjayByZXF1aXJlZCBwZXJsIG1vZHVsZXMKICAgIGlmICggJFBhcmFte01vZHVsZVJlcXVpcmVkfSAmJiByZWYgJFBhcmFte01vZHVsZVJlcXVpcmVkfSBlcSAnQVJSQVknICkgewoKICAgICAgICBNT0RVTEU6CiAgICAgICAgZm9yIG15ICRNb2R1bGUgKCBAeyAkUGFyYW17TW9kdWxlUmVxdWlyZWR9IH0gKSB7CgogICAgICAgICAgICBuZXh0IE1PRFVMRSBpZiAhJE1vZHVsZTsKCiAgICAgICAgICAgIG15ICRJbnN0YWxsZWQgICAgICAgID0gMDsKICAgICAgICAgICAgbXkgJEluc3RhbGxlZFZlcnNpb24gPSAwOwoKICAgICAgICAgICAgIyBjaGVjayBpZiBtb2R1bGUgaXMgaW5zdGFsbGVkCiAgICAgICAgICAgIGlmICggJFNlbGYtPntNYWluT2JqZWN0fS0+UmVxdWlyZSggJE1vZHVsZS0+e0NvbnRlbnR9ICkgKSB7CiAgICAgICAgICAgICAgICAkSW5zdGFsbGVkID0gMTsKCiAgICAgICAgICAgICAgICAjIGNoZWNrIHZlcnNpb24gaWYgaW5zdGFsbGVkIG1vZHVsZQogICAgICAgICAgICAgICAgJEluc3RhbGxlZFZlcnNpb24gPSAkTW9kdWxlLT57Q29udGVudH0tPlZFUlNJT047ICAgICMjIG5vIGNyaXRpYwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggISRJbnN0YWxsZWQgKSB7CiAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJTb3JyeSwgY2FuJ3QgaW5zdGFsbCBwYWNrYWdlLCBiZWNhdXNlIG1vZHVsZSAiCiAgICAgICAgICAgICAgICAgICAgICAgIC4gIiRNb2R1bGUtPntDb250ZW50fSB2JE1vZHVsZS0+e1ZlcnNpb259IGlzIHJlcXVpcmVkICIKICAgICAgICAgICAgICAgICAgICAgICAgLiAiYW5kIG5vdCBpbnN0YWxsZWQhIiwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgcmV0dXJuIGlmIG5vIHZlcnNpb24gaXMgcmVxdWlyZWQKICAgICAgICAgICAgcmV0dXJuIDEgaWYgISRNb2R1bGUtPntWZXJzaW9ufTsKCiAgICAgICAgICAgICMgcmV0dXJuIGlmIG5vIG1vZHVsZSB2ZXJzaW9uIGlzIGF2YWlsYWJsZQogICAgICAgICAgICByZXR1cm4gMSBpZiAhJEluc3RhbGxlZFZlcnNpb247CgogICAgICAgICAgICAjIGNoZWNrIHZlcnNpb24KICAgICAgICAgICAgbXkgJE9rID0gJFNlbGYtPl9DaGVja1ZlcnNpb24oCiAgICAgICAgICAgICAgICBWZXJzaW9uTmV3ICAgICAgID0+ICRNb2R1bGUtPntWZXJzaW9ufSwKICAgICAgICAgICAgICAgIFZlcnNpb25JbnN0YWxsZWQgPT4gJEluc3RhbGxlZFZlcnNpb24sCiAgICAgICAgICAgICAgICBUeXBlICAgICAgICAgICAgID0+ICdNaW4nLAogICAgICAgICAgICAgICAgRXh0ZXJuYWxQYWNrYWdlICA9PiAxLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCAhJE9rICkgewogICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiU29ycnksIGNhbid0IGluc3RhbGwgcGFja2FnZSwgYmVjYXVzZSBtb2R1bGUgIgogICAgICAgICAgICAgICAgICAgICAgICAuICIkTW9kdWxlLT57Q29udGVudH0gdiRNb2R1bGUtPntWZXJzaW9ufSBpcyByZXF1aXJlZCBhbmQgIgogICAgICAgICAgICAgICAgICAgICAgICAuICIkSW5zdGFsbGVkVmVyc2lvbiBpcyBpbnN0YWxsZWQhIFlvdSBuZWVkIHRvIHVwZ3JhZGUgIgogICAgICAgICAgICAgICAgICAgICAgICAuICIkTW9kdWxlLT57Q29udGVudH0gdG8gJE1vZHVsZS0+e1ZlcnNpb259IG9yIGhpZ2hlciBmaXJzdCEiLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gMTsKfQoKc3ViIF9DaGVja1BhY2thZ2VEZXBlbmRzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGlmICggIWRlZmluZWQgJFBhcmFte05hbWV9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnTmFtZSBub3QgZGVmaW5lZCEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGZvciBteSAkTG9jYWwgKCAkU2VsZi0+UmVwb3NpdG9yeUxpc3QoKSApIHsKCiAgICAgICAgaWYgKAogICAgICAgICAgICAkTG9jYWwtPntQYWNrYWdlUmVxdWlyZWR9CiAgICAgICAgICAgICYmIHJlZiAkTG9jYWwtPntQYWNrYWdlUmVxdWlyZWR9IGVxICdBUlJBWScKICAgICAgICAgICAgJiYgJExvY2FsLT57TmFtZX0tPntDb250ZW50fSBuZSAkUGFyYW17TmFtZX0KICAgICAgICAgICAgJiYgJExvY2FsLT57U3RhdHVzfSBlcSAnaW5zdGFsbGVkJwogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICBmb3IgbXkgJE1vZHVsZSAoIEB7ICRMb2NhbC0+e1BhY2thZ2VSZXF1aXJlZH0gfSApIHsKICAgICAgICAgICAgICAgIGlmICggJFBhcmFte05hbWV9IGVxICRNb2R1bGUtPntDb250ZW50fSAmJiAhJFBhcmFte0ZvcmNlfSApIHsKICAgICAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlNvcnJ5LCBjYW4ndCB1bmluc3RhbGwgcGFja2FnZSAkUGFyYW17TmFtZX0sICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4gImJlY2F1c2UgcGFja2FnZSAkTG9jYWwtPntOYW1lfS0+e0NvbnRlbnR9IGRlcGVuZHMgb24gaXQhIiwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gMTsKfQoKc3ViIF9QYWNrYWdlRmlsZUNoZWNrIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGlmICggIWRlZmluZWQgJFBhcmFte1N0cnVjdHVyZX0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdTdHJ1Y3R1cmUgbm90IGRlZmluZWQhJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGNoZWNrIGlmIG9uZSBvZiB0aGUgZmlsZXMgaXMgYWxyZWFkeSBpbnN0YWxsZWQgYnkgYW5vdGhlciBwYWNrYWdlCiAgICBQQUNLQUdFOgogICAgZm9yIG15ICRQYWNrYWdlICggJFNlbGYtPlJlcG9zaXRvcnlMaXN0KCkgKSB7CgogICAgICAgIG5leHQgUEFDS0FHRSBpZiAkUGFyYW17U3RydWN0dXJlfS0+e05hbWV9LT57Q29udGVudH0gZXEgJFBhY2thZ2UtPntOYW1lfS0+e0NvbnRlbnR9OwoKICAgICAgICBmb3IgbXkgJEZpbGVOZXcgKCBAeyAkUGFyYW17U3RydWN0dXJlfS0+e0ZpbGVsaXN0fSB9ICkgewoKICAgICAgICAgICAgRklMRU9MRDoKICAgICAgICAgICAgZm9yIG15ICRGaWxlT2xkICggQHsgJFBhY2thZ2UtPntGaWxlbGlzdH0gfSApIHsKCiAgICAgICAgICAgICAgICAkRmlsZU5ldy0+e0xvY2F0aW9ufSA9fiBzL1wvXC8vXC8vZzsKICAgICAgICAgICAgICAgICRGaWxlT2xkLT57TG9jYXRpb259ID1+IHMvXC9cLy9cLy9nOwoKICAgICAgICAgICAgICAgIG5leHQgRklMRU9MRCBpZiAkRmlsZU5ldy0+e0xvY2F0aW9ufSBuZSAkRmlsZU9sZC0+e0xvY2F0aW9ufTsKCiAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDYW4ndCBpbnN0YWxsL3VwZ3JhZGUgcGFja2FnZSwgZmlsZSAkRmlsZU5ldy0+e0xvY2F0aW9ufSBhbHJlYWR5ICIKICAgICAgICAgICAgICAgICAgICAgICAgLiAidXNlZCBpbiBwYWNrYWdlICRQYWNrYWdlLT57TmFtZX0tPntDb250ZW50fS0kUGFja2FnZS0+e1ZlcnNpb259LT57Q29udGVudH0hIiwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAxOwp9CgpzdWIgX0ZpbGVJbnN0YWxsIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGZvciBteSAkTmVlZGVkIChxdyhGaWxlKSkgewogICAgICAgIGlmICggIWRlZmluZWQgJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiJE5lZWRlZCBub3QgZGVmaW5lZCEiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQogICAgZm9yIG15ICRJdGVtIChxdyhMb2NhdGlvbiBDb250ZW50IFBlcm1pc3Npb24pKSB7CiAgICAgICAgaWYgKCAhZGVmaW5lZCAkUGFyYW17RmlsZX0tPnskSXRlbX0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICIkSXRlbSBub3QgZGVmaW5lZCBpbiBGaWxlISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgbXkgJEhvbWUgPSAkUGFyYW17SG9tZX0gfHwgJFNlbGYtPntIb21lfTsKCiAgICAjIGNoZWNrIEhvbWUKICAgIGlmICggIS1lICRIb21lICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiTm8gc3VjaCBob21lIGRpcmVjdG9yeTogJEhvbWUhIiwKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGdldCByZWFsIGZpbGUgbmFtZSBpbiBmcwogICAgbXkgJFJlYWxGaWxlID0gJEhvbWUgLiAnLycgLiAkUGFyYW17RmlsZX0tPntMb2NhdGlvbn07CiAgICAkUmVhbEZpbGUgPX4gcy9cL1wvL1wvL2c7CgogICAgIyBiYWNrdXAgb2xkIGZpbGUgKGlmIHJlaW5zdGFsbCwgZG9uJ3Qgb3ZlcndyaXRlIC5iYWNrdXAgYW5kIC5zYXZlIGZpbGVzKQogICAgaWYgKCAtZSAkUmVhbEZpbGUgKSB7CiAgICAgICAgaWYgKCAkUGFyYW17RmlsZX0tPntUeXBlfSAmJiAkUGFyYW17RmlsZX0tPntUeXBlfSA9fiAvXnJlcGxhY2UkL2kgKSB7CiAgICAgICAgICAgIGlmICggISRQYXJhbXtSZWluc3RhbGx9IHx8ICggJFBhcmFte1JlaW5zdGFsbH0gJiYgIS1lICIkUmVhbEZpbGUuYmFja3VwIiApICkgewogICAgICAgICAgICAgICAgbW92ZSggJFJlYWxGaWxlLCAiJFJlYWxGaWxlLmJhY2t1cCIgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKCiAgICAgICAgICAgICMgY2hlY2sgaWYgd2UgcmVpbnN0YWxsIHRoZSBzYW1lIGZpbGUsIGNyZWF0ZSBhIC5zYXZlIGlmIGl0IGlzIG5vdCB0aGUgc2FtZQogICAgICAgICAgICBteSAkU2F2ZSA9IDA7CiAgICAgICAgICAgIGlmICggJFBhcmFte1JlaW5zdGFsbH0gJiYgIS1lICIkUmVhbEZpbGUuc2F2ZSIgKSB7CgogICAgICAgICAgICAgICAgIyBjaGVjayBpZiBpdCdzIG5vdCB0aGUgc2FtZQogICAgICAgICAgICAgICAgbXkgJENvbnRlbnQgPSAkU2VsZi0+e01haW5PYmplY3R9LT5GaWxlUmVhZCgKICAgICAgICAgICAgICAgICAgICBMb2NhdGlvbiA9PiAkUmVhbEZpbGUsCiAgICAgICAgICAgICAgICAgICAgTW9kZSAgICAgPT4gJ2Jpbm1vZGUnLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmICggJENvbnRlbnQgJiYgJHskQ29udGVudH0gbmUgJFBhcmFte0ZpbGV9LT57Q29udGVudH0gKSB7CgogICAgICAgICAgICAgICAgICAgICMgY2hlY2sgaWYgaXQncyBhIGZyYW1ld29yayBmaWxlLCBjcmVhdGUgLnNhdmUgZmlsZQogICAgICAgICAgICAgICAgICAgIG15ICVGaWxlID0gJFNlbGYtPl9SZWFkRGlzdEFyY2hpdmUoIEhvbWUgPT4gJEhvbWUgKTsKICAgICAgICAgICAgICAgICAgICBpZiAoICRGaWxleyAkUGFyYW17RmlsZX0tPntMb2NhdGlvbn0gfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFNhdmUgPSAxOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBpZiBpdCdzIG5vIHJlaW5zdGFsbCBvciByZWluc3RhbGwgYW5kIGZyYW1ld29yayBmaWxlIGJ1dCBkaWZmZXJlbnQsIGJhY2sgaXQgdXAKICAgICAgICAgICAgaWYgKCAhJFBhcmFte1JlaW5zdGFsbH0gfHwgKCAkUGFyYW17UmVpbnN0YWxsfSAmJiAkU2F2ZSApICkgewogICAgICAgICAgICAgICAgbW92ZSggJFJlYWxGaWxlLCAiJFJlYWxGaWxlLnNhdmUiICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBkaXJlY3Rvcnkgb2YgbG9jYXRpb24gKGluIGNhc2UgY3JlYXRlIGEgZGlyZWN0b3J5KQogICAgaWYgKCAkUGFyYW17RmlsZX0tPntMb2NhdGlvbn0gPX4gL14oLiopXC8oLis/fCkkLyApIHsKCiAgICAgICAgbXkgJERpcmVjdG9yeSAgICAgICAgPSAkMTsKICAgICAgICBteSBARGlyZWN0b3JpZXMgICAgICA9IHNwbGl0KCAvXC8vLCAkRGlyZWN0b3J5ICk7CiAgICAgICAgbXkgJERpcmVjdG9yeUN1cnJlbnQgPSAkSG9tZTsKCiAgICAgICAgRElSRUNUT1JZOgogICAgICAgIGZvciBteSAkRGlyZWN0b3J5IChARGlyZWN0b3JpZXMpIHsKCiAgICAgICAgICAgICREaXJlY3RvcnlDdXJyZW50IC49ICcvJyAuICREaXJlY3Rvcnk7CgogICAgICAgICAgICBuZXh0IERJUkVDVE9SWSBpZiAtZCAkRGlyZWN0b3J5Q3VycmVudDsKCiAgICAgICAgICAgIGlmICggbWtkaXIgJERpcmVjdG9yeUN1cnJlbnQgKSB7CiAgICAgICAgICAgICAgICBwcmludCBTVERFUlIgIk5vdGljZTogQ3JlYXRlIERpcmVjdG9yeSAkRGlyZWN0b3J5Q3VycmVudCFcbiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDYW4ndCBjcmVhdGUgZGlyZWN0b3J5OiAkRGlyZWN0b3J5Q3VycmVudDogJCEiLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAjIHdyaXRlIGZpbGUKICAgIHJldHVybiBpZiAhJFNlbGYtPntNYWluT2JqZWN0fS0+RmlsZVdyaXRlKAogICAgICAgIExvY2F0aW9uICAgPT4gJFJlYWxGaWxlLAogICAgICAgIENvbnRlbnQgICAgPT4gXCRQYXJhbXtGaWxlfS0+e0NvbnRlbnR9LAogICAgICAgIE1vZGUgICAgICAgPT4gJ2Jpbm1vZGUnLAogICAgICAgIFBlcm1pc3Npb24gPT4gJFBhcmFte0ZpbGV9LT57UGVybWlzc2lvbn0sCiAgICApOwoKICAgIHByaW50IFNUREVSUiAiTm90aWNlOiBJbnN0YWxsICRSZWFsRmlsZSAoJFBhcmFte0ZpbGV9LT57UGVybWlzc2lvbn0pIVxuIjsKCiAgICByZXR1cm4gMTsKfQoKc3ViIF9GaWxlUmVtb3ZlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGZvciBteSAkTmVlZGVkIChxdyhGaWxlKSkgewogICAgICAgIGlmICggIWRlZmluZWQgJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiJE5lZWRlZCBub3QgZGVmaW5lZCEiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQogICAgZm9yIG15ICRJdGVtIChxdyhMb2NhdGlvbikpIHsKICAgICAgICBpZiAoICFkZWZpbmVkICRQYXJhbXtGaWxlfS0+eyRJdGVtfSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIiRJdGVtIG5vdCBkZWZpbmVkIGluIEZpbGUhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICBteSAkSG9tZSA9ICRQYXJhbXtIb21lfSB8fCAkU2VsZi0+e0hvbWV9OwoKICAgICMgY2hlY2sgSG9tZQogICAgaWYgKCAhLWUgJEhvbWUgKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJObyBzdWNoIGhvbWUgZGlyZWN0b3J5OiAkSG9tZSEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgZ2V0IHJlYWwgZmlsZSBuYW1lIGluIGZzCiAgICBteSAkUmVhbEZpbGUgPSAkSG9tZSAuICcvJyAuICRQYXJhbXtGaWxlfS0+e0xvY2F0aW9ufTsKICAgICRSZWFsRmlsZSA9fiBzL1wvXC8vXC8vZzsKCiAgICAjIGNoZWNrIGlmIGZpbGUgZXhpc3RzCiAgICBpZiAoICEtZSAkUmVhbEZpbGUgKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJObyBzdWNoIGZpbGU6ICRSZWFsRmlsZSEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgY2hlY2sgaWYgd2Ugc2hvdWxkIGJhY2t1cCB0aGlzIGZpbGUsIGlmIGl0IGlzIHRvdWNoZWQvZGlmZmVyZW50CiAgICBpZiAoICRQYXJhbXtGaWxlfS0+e0NvbnRlbnR9ICkgewogICAgICAgIG15ICRDb250ZW50ID0gJFNlbGYtPntNYWluT2JqZWN0fS0+RmlsZVJlYWQoCiAgICAgICAgICAgIExvY2F0aW9uID0+ICRSZWFsRmlsZSwKICAgICAgICAgICAgTW9kZSAgICAgPT4gJ2Jpbm1vZGUnLAogICAgICAgICk7CiAgICAgICAgaWYgKCAkQ29udGVudCAmJiAkeyRDb250ZW50fSBuZSAkUGFyYW17RmlsZX0tPntDb250ZW50fSApIHsKICAgICAgICAgICAgcHJpbnQgU1RERVJSICJOb3RpY2U6IEJhY2t1cCBmb3IgY2hhbmdlZCBmaWxlOiAkUmVhbEZpbGUuYmFja3VwXG4iOwogICAgICAgICAgICBjb3B5KCAkUmVhbEZpbGUsICIkUmVhbEZpbGUuY3VzdG9tX2JhY2t1cCIgKTsKICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBpZiBpdCdzIGEgZnJhbWV3b3JrIGZpbGUgYW5kIGlmICRSZWFsRmlsZS4oYmFja3VwfHNhdmUpIGV4aXN0cwogICAgIyB0aGVuIGRvIG5vdCByZW1vdmUgaXQhCiAgICBteSAlRmlsZSA9ICRTZWxmLT5fUmVhZERpc3RBcmNoaXZlKCBIb21lID0+ICRIb21lICk7CiAgICBpZiAoICRGaWxleyAkUGFyYW17RmlsZX0tPntMb2NhdGlvbn0gfSAmJiAoICEtZSAiJFJlYWxGaWxlLmJhY2t1cCIgJiYgIS1lICIkUmVhbEZpbGUuc2F2ZSIgKSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkNhbid0IHJlbW92ZSBmaWxlICRSZWFsRmlsZSwgYmVjYXVzZSBpdCBhIGZyYW1ld29yayBmaWxlIGFuZCBubyAiCiAgICAgICAgICAgICAgICAuICJvdGhlciBvbmUgZXhpc3RzISIsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyByZW1vdmUgb2xkIGZpbGUKICAgIGlmICggISRTZWxmLT57TWFpbk9iamVjdH0tPkZpbGVEZWxldGUoIExvY2F0aW9uID0+ICRSZWFsRmlsZSApICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiQ2FuJ3QgcmVtb3ZlIGZpbGUgJFJlYWxGaWxlOiAkISEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIHByaW50IFNUREVSUiAiTm90aWNlOiBSZW1vdmVkIGZpbGU6ICRSZWFsRmlsZVxuIjsKCiAgICAjIHJlc3RvcmUgb2xkIGZpbGUgKGlmIGV4aXN0cykKICAgIGlmICggLWUgIiRSZWFsRmlsZS5iYWNrdXAiICkgewogICAgICAgIHByaW50IFNUREVSUiAiTm90aWNlOiBSZWNvdmVyZWQ6ICRSZWFsRmlsZS5iYWNrdXBcbiI7CiAgICAgICAgbW92ZSggIiRSZWFsRmlsZS5iYWNrdXAiLCAkUmVhbEZpbGUgKTsKICAgIH0KCiAgICAjIHJlc3RvcmUgb2xkIGZpbGUgKGlmIGV4aXN0cykKICAgIGVsc2lmICggLWUgIiRSZWFsRmlsZS5zYXZlIiApIHsKICAgICAgICBwcmludCBTVERFUlIgIk5vdGljZTogUmVjb3ZlcmVkOiAkUmVhbEZpbGUuc2F2ZVxuIjsKICAgICAgICBtb3ZlKCAiJFJlYWxGaWxlLnNhdmUiLCAkUmVhbEZpbGUgKTsKICAgIH0KCiAgICByZXR1cm4gMTsKfQoKc3ViIF9SZWFkRGlzdEFyY2hpdmUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkSG9tZSA9ICRQYXJhbXtIb21lfSB8fCAkU2VsZi0+e0hvbWV9OwoKICAgICMgY2hlY2sgY2FjaGUKICAgIHJldHVybiAleyAkU2VsZi0+e0NhY2hlfS0+e0Rpc3RBcmNoaXZlfS0+eyRIb21lfSB9CiAgICAgICAgaWYgJFNlbGYtPntDYWNoZX0tPntEaXN0QXJjaGl2ZX0tPnskSG9tZX07CgogICAgIyBjaGVjayBpZiBBUkNISVZFIGV4aXN0cwogICAgaWYgKCAhLWUgIiRIb21lL0FSQ0hJVkUiICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiTm8gc3VjaCBmaWxlOiAkSG9tZS9BUkNISVZFISIsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyByZWFkIEFSQ0hJVkUgZmlsZQogICAgbXkgJENvbnRlbnQgPSAkU2VsZi0+e01haW5PYmplY3R9LT5GaWxlUmVhZCgKICAgICAgICBEaXJlY3RvcnkgPT4gJEhvbWUsCiAgICAgICAgRmlsZW5hbWUgID0+ICdBUkNISVZFJywKICAgICAgICBSZXN1bHQgICAgPT4gJ0FSUkFZJywKICAgICk7CgogICAgbXkgJUZpbGU7CiAgICBpZiAoJENvbnRlbnQpIHsKCiAgICAgICAgZm9yIG15ICRDb250ZW50Um93ICggQHskQ29udGVudH0gKSB7CgogICAgICAgICAgICBteSBAUm93ID0gc3BsaXQgLzo6LywgJENvbnRlbnRSb3c7CiAgICAgICAgICAgICRSb3dbMV0gPX4gcy9cL1wvLy9nOwogICAgICAgICAgICAkUm93WzFdID1+IHMvKFxufFxyKS8vZzsKCiAgICAgICAgICAgICRGaWxleyAkUm93WzFdIH0gPSAkUm93WzBdOwogICAgICAgIH0KICAgIH0KICAgIGVsc2UgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiQ2FuJ3Qgb3BlbiAkSG9tZS9BUkNISVZFOiAkISIsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIHNldCBpbiBtZW1vcnkgY2FjaGUKICAgICRTZWxmLT57Q2FjaGV9LT57RGlzdEFyY2hpdmV9LT57JEhvbWV9ID0gXCVGaWxlOwoKICAgIHJldHVybiAlRmlsZTsKfQoKc3ViIF9GaWxlU3lzdGVtQ2hlY2sgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkSG9tZSA9ICRQYXJhbXtIb21lfSB8fCAkU2VsZi0+e0hvbWV9OwoKICAgICMgY2hlY2sgSG9tZQogICAgaWYgKCAhLWUgJEhvbWUgKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJObyBzdWNoIGhvbWUgZGlyZWN0b3J5OiAkSG9tZSEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgY3JlYXRlIHRlc3QgZmlsZXMgaW4gZm9sbG93aW5nIGRpcmVjdG9yaWVzCiAgICBmb3IgbXkgJEZpbGVwYXRoICgKICAgICAgICBxdygvYmluLyAvS2VybmVsLyAvS2VybmVsL1N5c3RlbS8gL0tlcm5lbC9PdXRwdXQvIC9LZXJuZWwvT3V0cHV0L0hUTUwvIC9LZXJuZWwvTW9kdWxlcy8pCiAgICAgICAgKQogICAgewogICAgICAgIG15ICRMb2NhdGlvbiA9ICRIb21lIC4gJEZpbGVwYXRoIC4gImNoZWNrX3Blcm1pc3Npb25zLiQkIjsKICAgICAgICBteSAkQ29udGVudCAgPSAndGVzdCc7CgogICAgICAgICMgY3JlYXRlIHRlc3QgZmlsZQogICAgICAgIG15ICRXcml0ZSA9ICRTZWxmLT57TWFpbk9iamVjdH0tPkZpbGVXcml0ZSgKICAgICAgICAgICAgTG9jYXRpb24gPT4gJExvY2F0aW9uLAogICAgICAgICAgICBDb250ZW50ICA9PiBcJENvbnRlbnQsCiAgICAgICAgKTsKCiAgICAgICAgaWYgKCAhJFdyaXRlICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiRVJST1I6IE5lZWQgd3JpdGUgcGVybWlzc2lvbnMgZm9yIGRpcmVjdG9yeSAkSG9tZSRGaWxlcGF0aFxuIgogICAgICAgICAgICAgICAgICAgIC4gIiBUcnk6ICRIb21lL2Jpbi9vdHJzLlNldFBlcm1pc3Npb25zLnBsISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICMgZGVsZXRlIHRlc3QgZmlsZQogICAgICAgICRTZWxmLT57TWFpbk9iamVjdH0tPkZpbGVEZWxldGUoIExvY2F0aW9uID0+ICRMb2NhdGlvbiApOwogICAgfQoKICAgIHJldHVybiAxOwp9CgpzdWIgX0VuY29kZSB7CiAgICBteSAoICRTZWxmLCAkVGV4dCApID0gQF87CgogICAgcmV0dXJuICRUZXh0IGlmICFkZWZpbmVkICRUZXh0OwoKICAgICRUZXh0ID1+IHMvJi8mYW1wOy9nOwogICAgJFRleHQgPX4gcy88LyZsdDsvZzsKICAgICRUZXh0ID1+IHMvPi8mZ3Q7L2c7CiAgICAkVGV4dCA9fiBzLyIvJnF1b3Q7L2c7CgogICAgcmV0dXJuICRUZXh0Owp9Cgo9aXRlbSBfUGFja2FnZVVuaW5zdGFsbE1lcmdlZCgpCgpPTkxZIENBTEwgVEhJUyBNRVRIT0QgRlJPTSBBIERBVEFCQVNFIFVQR1JBRElORyBTQ1JJUFQgRFVSSU5HIEZSQU1FV09SSyBVUERBVEVTCk9SIEZST00gQSBDT0RFVVBHUkFERSBTRUNUSU9OIElOIEFOIFNPUE0gRklMRSBPRiBBIFBBQ0tBR0UgVEhBVCBJTkNMVURFUyBBIE1FUkdFRCBGRUFUVVJFIEFERE9OLgoKVW5pbnN0YWxsIGFuIGFscmVhZHkgZnJhbWV3b3JrIChvciBtb2R1bGUpIG1lcmdlZCBwYWNrYWdlLgoKUGFja2FnZSBmaWxlcyB0aGF0IGFyZSBub3QgaW4gdGhlIGZyYW1ld29yayBBUkNISVZFIGZpbGUgd2lsbCBiZSBkZWxldGVkLCBEYXRhYmFzZVVuaW5zdGFsbCgpIGFuZApDb2RlVW5pbnN0YWxsIGFyZSBub3QgY2FsbGVkLgoKICAgICRTdWNjZXNzID0gJFBhY2thZ2VPYmplY3QtPl9QYWNrYWdlVW5pbnN0YWxsTWVyZ2VkKAogICAgICAgIE5hbWUgICAgICAgID0+ICdzb21lIHBhY2thZ2UgbmFtZScsCiAgICAgICAgSG9tZSAgICAgICAgPT4gJ09UUlMgSG9tZSBwYXRoJywgICAgICAjIE9wdGlvbmFsCiAgICAgICAgRGVsZXRlU2F2ZWQgPT4gMSwgICAgICAgICAgICAgICAgICAgICAjIG9yIDAsIDEgRGVmYXVsdCwgT3B0aW9uYWw6IGlmIHNldCB0byAxIGl0IGFsc28KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgZGVsZXRlIC5zYXZlIGZpbGVzCiAgICApOwoKPWN1dAoKc3ViIF9QYWNrYWdlVW5pbnN0YWxsTWVyZ2VkIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGlmICggISRQYXJhbXtOYW1lfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgTmFtZSAoTmFtZSBvZiB0aGUgcGFja2FnZSkhJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBteSAkSG9tZSA9ICRQYXJhbXtIb21lfSB8fCAkU2VsZi0+e0hvbWV9OwoKICAgICMgY2hlY2sgSG9tZQogICAgaWYgKCAhLWUgJEhvbWUgKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJObyBzdWNoIGhvbWUgZGlyZWN0b3J5OiAkSG9tZSEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmICggIWRlZmluZWQgJFBhcmFte0RlbGV0ZVNhdmVkfSApIHsKICAgICAgICAkUGFyYW17RGVsZXRlU2F2ZWR9ID0gMTsKICAgIH0KCiAgICAjIGNoZWNrIGlmIHRoZSBwYWNrYWdlIGlzIGluc3RhbGxlZCwgb3RoZXJ3aXNlIHJldHVybiBzdWNjZXNzIChub3RoaW5nIHRvIGRvKQogICAgbXkgJFBhY2thZ2VJbnN0YWxsZWQgPSAkU2VsZi0+UGFja2FnZUlzSW5zdGFsbGVkKAogICAgICAgIE5hbWUgPT4gJFBhcmFte05hbWV9LAogICAgKTsKICAgIHJldHVybiAxIGlmICEkUGFja2FnZUluc3RhbGxlZDsKCiAgICAjIGdldCB0aGUgcGFja2FnZSBkZXRhaWxzCiAgICBteSBAUGFja2FnZUxpc3QgICAgICAgPSAkU2VsZi0+UmVwb3NpdG9yeUxpc3QoKTsKICAgIG15ICVQYWNrYWdlTGlzdExvb2t1cCA9IG1hcCB7ICRfLT57TmFtZX0tPntDb250ZW50fSA9PiAkXyB9IEBQYWNrYWdlTGlzdDsKICAgIG15ICVQYWNrYWdlRGV0YWlscyAgICA9ICV7ICRQYWNrYWdlTGlzdExvb2t1cHsgJFBhcmFte05hbWV9IH0gfTsKCiAgICAjIGdldCB0aGUgbGlzdCBvZiBmcmFtZXdvcmsgZmlsZXMKICAgIG15ICVGcmFtZXdvcmtGaWxlcyA9ICRTZWxmLT5fUmVhZERpc3RBcmNoaXZlKCBIb21lID0+ICRIb21lICk7CgogICAgIyBjYW4gbm90IGNvbnRpbnVlIGlmIHRoZXJlIGFyZSBubyBmcmFtZXdvcmsgZmlsZXMKICAgIHJldHVybiBpZiAhJUZyYW1ld29ya0ZpbGVzOwoKICAgICMgcmVtb3ZlIHVubmVlZGVkIGZpbGVzIChpZiBleGlzdHMpCiAgICBpZiAoIElzQXJyYXlSZWZXaXRoRGF0YSggJFBhY2thZ2VEZXRhaWxze0ZpbGVsaXN0fSApICkgewoKICAgICAgICBGSUxFOgogICAgICAgIGZvciBteSAkRmlsZUhhc2ggKCBAeyAkUGFja2FnZURldGFpbHN7RmlsZWxpc3R9IH0gKSB7CgogICAgICAgICAgICBteSAkRmlsZSA9ICRGaWxlSGFzaC0+e0xvY2F0aW9ufTsKCiAgICAgICAgICAgICMgZ2V0IHJlYWwgZmlsZSBuYW1lIGluIGZzCiAgICAgICAgICAgIG15ICRSZWFsRmlsZSA9ICRIb21lIC4gJy8nIC4gJEZpbGU7CiAgICAgICAgICAgICRSZWFsRmlsZSA9fiBzL1wvXC8vXC8vZzsKCiAgICAgICAgICAgICMgY2hlY2sgaWYgZmlsZSBleGlzdHMKICAgICAgICAgICAgaWYgKCAtZSAkUmVhbEZpbGUgKSB7CgogICAgICAgICAgICAgICAgIyBjaGVjayBmcmFtZXdvcmsgZmlsZXMgKHVzZSAkRmlsZSBpbnN0ZWFkIG9mICRSZWFsRmlsZSkKICAgICAgICAgICAgICAgIGlmICggJEZyYW1ld29ya0ZpbGVzeyRGaWxlfSApIHsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCAkUGFyYW17RGVsZXRlU2F2ZWR9ICkgewoKICAgICAgICAgICAgICAgICAgICAgICAgIyBjaGVjayBpZiBmaWxlIHdhcyBvdmVycmlkZGVuIGJ5IHRoZSBwYWNrYWdlCiAgICAgICAgICAgICAgICAgICAgICAgIG15ICRTYXZlZEZpbGUgPSAkUmVhbEZpbGUgLiAnLnNhdmUnOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIC1lICRTYXZlZEZpbGUgKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyByZW1vdmUgb2xkIGZpbGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggISRTZWxmLT57TWFpbk9iamVjdH0tPkZpbGVEZWxldGUoIExvY2F0aW9uID0+ICRTYXZlZEZpbGUgKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkNhbid0IHJlbW92ZSBmaWxlICRTYXZlZEZpbGU6ICQhISIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCBTVERFUlIgIk5vdGljZTogUmVtb3ZlZCBvbGQgYmFja3VwIGZpbGU6ICRTYXZlZEZpbGVcbiI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICMgc2tpcCBmcmFtZXdvcmsgZmlsZQogICAgICAgICAgICAgICAgICAgIHByaW50IFNUREVSUiAiTm90aWNlOiBTa2lwZWQgZnJhbWV3b3JrIGZpbGU6ICRSZWFsRmlsZVxuIjsKICAgICAgICAgICAgICAgICAgICBuZXh0IEZJTEU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyByZW1vdmUgb2xkIGZpbGUKICAgICAgICAgICAgICAgIGlmICggISRTZWxmLT57TWFpbk9iamVjdH0tPkZpbGVEZWxldGUoIExvY2F0aW9uID0+ICRSZWFsRmlsZSApICkgewogICAgICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiQ2FuJ3QgcmVtb3ZlIGZpbGUgJFJlYWxGaWxlOiAkISEiLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcHJpbnQgU1RERVJSICJOb3RpY2U6IFJlbW92ZWQgZmlsZTogJFJlYWxGaWxlXG4iOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgZGVsZXRlIHBhY2thZ2UgZnJvbSB0aGUgZGF0YWJhc2UKICAgIG15ICRQYWNrYWdlUmVtb3ZlID0gJFNlbGYtPlJlcG9zaXRvcnlSZW1vdmUoCiAgICAgICAgTmFtZSA9PiAkUGFyYW17TmFtZX0sCiAgICApOwoKICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpLT5DbGVhblVwKAogICAgICAgIEtlZXBUeXBlcyA9PiBbJ1hNTFBhcnNlJ10sCiAgICApOwogICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvYWRlcicpLT5DYWNoZURlbGV0ZSgpOwoKICAgIHJldHVybiAkUGFja2FnZVJlbW92ZTsKfQoKc3ViIF9NZXJnZWRQYWNrYWdlcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICFkZWZpbmVkICRQYXJhbXtTdHJ1Y3R1cmV9LT57UGFja2FnZU1lcmdlfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ1BhY2thZ2VNZXJnZSBub3QgZGVmaW5lZCEnLAogICAgICAgICk7CgogICAgICAgIHJldHVybjsKICAgIH0KCiAgICByZXR1cm4gMSBpZiAhJFBhcmFte1N0cnVjdHVyZX0tPntQYWNrYWdlTWVyZ2V9OwogICAgcmV0dXJuIDEgaWYgcmVmICRQYXJhbXtTdHJ1Y3R1cmV9LT57UGFja2FnZU1lcmdlfSBuZSAnQVJSQVknOwoKICAgICMgZ2V0IHJlcG9zaXRvcnkgbGlzdAogICAgbXkgQFJlcG9zaXRvcnlMaXN0ID0gJFNlbGYtPlJlcG9zaXRvcnlMaXN0KCk7CiAgICBteSAlUGFja2FnZUxpc3RMb29rdXAgPSBtYXAgeyAkXy0+e05hbWV9LT57Q29udGVudH0gPT4gJF8gfSBAUmVwb3NpdG9yeUxpc3Q7CgogICAgIyBjaGVjayByZXF1aXJlZCBwYWNrYWdlcwogICAgUEFDS0FHRToKICAgIGZvciBteSAkUGFja2FnZSAoIEB7ICRQYXJhbXtTdHJ1Y3R1cmV9LT57UGFja2FnZU1lcmdlfSB9ICkgewoKICAgICAgICBuZXh0IFBBQ0tBR0UgaWYgISRQYWNrYWdlOwoKICAgICAgICBteSAkSW5zdGFsbGVkICAgICAgICA9IDA7CiAgICAgICAgbXkgJEluc3RhbGxlZFZlcnNpb24gPSAwOwogICAgICAgIG15ICRUYXJnZXRWZXJzaW9uICAgID0gJFBhY2thZ2UtPntUYXJnZXRWZXJzaW9ufTsKICAgICAgICBteSAlUGFja2FnZURldGFpbHM7CgogICAgICAgICMgY2hlY2sgaWYgdGhlIHBhY2thZ2UgaXMgaW5zdGFsbGVkLCBvdGhlcndpc2UgZ28gbmV4dCBwYWNrYWdlIChub3RoaW5nIHRvIGRvKQogICAgICAgIG15ICRQYWNrYWdlSW5zdGFsbGVkID0gJFNlbGYtPlBhY2thZ2VJc0luc3RhbGxlZCgKICAgICAgICAgICAgTmFtZSA9PiAkUGFja2FnZS0+e05hbWV9LAogICAgICAgICk7CgogICAgICAgICMgZG8gbm90aGluZyBpZiBwYWNrYWdlIGlzIG5vdCBpbnN0YWxsZWQKICAgICAgICBuZXh0IFBBQ0tBR0UgaWYgISRQYWNrYWdlSW5zdGFsbGVkOwoKICAgICAgICAjIGdldCBjb21wbGV0ZSBwYWNrYWdlIGluZm8KICAgICAgICAlUGFja2FnZURldGFpbHMgPSAleyAkUGFja2FnZUxpc3RMb29rdXB7ICRQYWNrYWdlLT57TmFtZX0gfSB9OwoKICAgICAgICAjIHZlcmlmeSBwYWNrYWdlIHZlcnNpb24KICAgICAgICAkSW5zdGFsbGVkVmVyc2lvbiA9ICRQYWNrYWdlRGV0YWlsc3tWZXJzaW9ufS0+e0NvbnRlbnR9OwoKICAgICAgICAjIHN0b3JlIHBhY2thZ2UgbmFtZSBhbmQgdmVyc2lvbiBmb3IKICAgICAgICAjIHVzZSBpdCBvbiBjb2RlIGFuZCBkYXRhYmFzZSBpbnN0YWxsYXRpb24KICAgICAgICAjIGZvciBwcmluY2lwYWwgcGFja2FnZQogICAgICAgICRTZWxmLT57TWVyZ2VkUGFja2FnZXN9LT57ICRQYWNrYWdlLT57TmFtZX0gfSA9ICRJbnN0YWxsZWRWZXJzaW9uOwoKICAgICAgICBteSAkQ2hlY2tUYXJnZXRWZXJzaW9uID0gJFNlbGYtPl9DaGVja1ZlcnNpb24oCiAgICAgICAgICAgIFZlcnNpb25OZXcgICAgICAgPT4gJFRhcmdldFZlcnNpb24sCiAgICAgICAgICAgIFZlcnNpb25JbnN0YWxsZWQgPT4gJEluc3RhbGxlZFZlcnNpb24sCiAgICAgICAgICAgIFR5cGUgICAgICAgICAgICAgPT4gJ01heCcsCiAgICAgICAgKTsKCiAgICAgICAgaWYgKCAkVGFyZ2V0VmVyc2lvbiBlcSAkSW5zdGFsbGVkVmVyc2lvbiApIHsKCiAgICAgICAgICAgICMgZG8gbm90aGluZywgaW5zdGFsbGVkIHZlcnNpb24gaXMgdGhlIGNvcnJlY3Qgb25lLAogICAgICAgICAgICAjIGNvZGUgYW5kIGRhdGFiYXNlIGFyZSB1cCB0byBkYXRlCiAgICAgICAgfQoKICAgICAgICAjIG1lcmdlZCBwYWNrYWdlIHNob3VsZG4ndCBiZSBuZXdlciB0aGFuIHRoZSBrbm93biBtZXJnZWFibGUgdGFyZ2V0IHZlcnNpb24KICAgICAgICBlbHNpZiAoICEkQ2hlY2tUYXJnZXRWZXJzaW9uICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiU29ycnksIGNhbid0IGluc3RhbGwgcGFja2FnZSwgYmVjYXVzZSBwYWNrYWdlICIKICAgICAgICAgICAgICAgICAgICAuICIkUGFja2FnZS0+e05hbWV9IHYkSW5zdGFsbGVkVmVyc2lvbiBuZXdlciB0aGFuIHJlcXVpcmVkIHYkVGFyZ2V0VmVyc2lvbiEiLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKCiAgICAgICAgICAgICMgdXBncmFkZSBjb2RlIChtZXJnZSkKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgJFBhcmFte1N0cnVjdHVyZX0tPntDb2RlVXBncmFkZX0KICAgICAgICAgICAgICAgICYmIHJlZiAkUGFyYW17U3RydWN0dXJlfS0+e0NvZGVVcGdyYWRlfSBlcSAnQVJSQVknCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIHsKCiAgICAgICAgICAgICAgICBteSBAUGFydHM7CiAgICAgICAgICAgICAgICBQQVJUOgogICAgICAgICAgICAgICAgZm9yIG15ICRQYXJ0ICggQHsgJFBhcmFte1N0cnVjdHVyZX0tPntDb2RlVXBncmFkZX0gfSApIHsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCAkUGFydC0+e1ZlcnNpb259ICkgewoKICAgICAgICAgICAgICAgICAgICAgICAgIyBpZiBWZXJzaW9uTmV3ID49IFZlcnNpb25JbnN0YWxsZWQgYWRkIGNvZGUgZm9yIGV4ZWN1dGlvbgogICAgICAgICAgICAgICAgICAgICAgICBteSAkQ2hlY2tWZXJzaW9uID0gJFNlbGYtPl9DaGVja1ZlcnNpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBWZXJzaW9uTmV3ICAgICAgID0+ICRQYXJ0LT57VmVyc2lvbn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBWZXJzaW9uSW5zdGFsbGVkID0+ICRUYXJnZXRWZXJzaW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVHlwZSAgICAgICAgICAgICA9PiAnTWluJywKICAgICAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkQ2hlY2tWZXJzaW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoIEBQYXJ0cywgJFBhcnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHB1c2ggQFBhcnRzLCAkUGFydDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJFNlbGYtPl9Db2RlKAogICAgICAgICAgICAgICAgICAgIENvZGUgICAgICA9PiBcQFBhcnRzLAogICAgICAgICAgICAgICAgICAgIFR5cGUgICAgICA9PiAnbWVyZ2UnLAogICAgICAgICAgICAgICAgICAgIFN0cnVjdHVyZSA9PiAkUGFyYW17U3RydWN0dXJlfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgdXBncmFkZSBkYXRhYmFzZSAobWVyZ2UpCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICRQYXJhbXtTdHJ1Y3R1cmV9LT57RGF0YWJhc2VVcGdyYWRlfS0+e21lcmdlfQogICAgICAgICAgICAgICAgJiYgcmVmICRQYXJhbXtTdHJ1Y3R1cmV9LT57RGF0YWJhc2VVcGdyYWRlfS0+e21lcmdlfSBlcSAnQVJSQVknCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIHsKCiAgICAgICAgICAgICAgICBteSBAUGFydHM7CiAgICAgICAgICAgICAgICBteSAkVXNlID0gMDsKICAgICAgICAgICAgICAgIGZvciBteSAkUGFydCAoIEB7ICRQYXJhbXtTdHJ1Y3R1cmV9LT57RGF0YWJhc2VVcGdyYWRlfS0+e21lcmdlfSB9ICkgewoKICAgICAgICAgICAgICAgICAgICBpZiAoICRQYXJ0LT57VGFnTGV2ZWx9ID09IDMgJiYgJFBhcnQtPntWZXJzaW9ufSApIHsKCiAgICAgICAgICAgICAgICAgICAgICAgIG15ICRDaGVja1ZlcnNpb24gPSAkU2VsZi0+X0NoZWNrVmVyc2lvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZlcnNpb25OZXcgICAgICAgPT4gJFBhcnQtPntWZXJzaW9ufSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZlcnNpb25JbnN0YWxsZWQgPT4gJEluc3RhbGxlZFZlcnNpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUeXBlICAgICAgICAgICAgID0+ICdNaW4nLAogICAgICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhJENoZWNrVmVyc2lvbiApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRVc2UgICA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBAUGFydHMgPSAoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2ggQFBhcnRzLCAkUGFydDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNpZiAoICRVc2UgJiYgJFBhcnQtPntUYWdMZXZlbH0gPT0gMyAmJiAkUGFydC0+e1RhZ1R5cGV9IGVxICdFbmQnICkgewogICAgICAgICAgICAgICAgICAgICAgICAkVXNlID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCBAUGFydHMsICRQYXJ0OwogICAgICAgICAgICAgICAgICAgICAgICAkU2VsZi0+X0RhdGFiYXNlKCBEYXRhYmFzZSA9PiBcQFBhcnRzICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2lmICgkVXNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHB1c2ggQFBhcnRzLCAkUGFydDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgfQoKICAgICAgICAjIHB1cmdlIHBhY2thZ2UKICAgICAgICBpZiAoIElzQXJyYXlSZWZXaXRoRGF0YSggJFBhY2thZ2VEZXRhaWxze0ZpbGVsaXN0fSApICkgewogICAgICAgICAgICBmb3IgbXkgJEZpbGUgKCBAeyAkUGFja2FnZURldGFpbHN7RmlsZWxpc3R9IH0gKSB7CgogICAgICAgICAgICAgICAgIyByZW1vdmUgZmlsZQogICAgICAgICAgICAgICAgJFNlbGYtPl9GaWxlUmVtb3ZlKCBGaWxlID0+ICRGaWxlICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgcmVtb3ZlIG1lcmdlZCBwYWNrYWdlIGZyb20gcmVwb3NpdG9yeQogICAgICAgIHJldHVybiBpZiAhJFNlbGYtPlJlcG9zaXRvcnlSZW1vdmUoCiAgICAgICAgICAgIE5hbWUgICAgPT4gJFBhY2thZ2UtPntOYW1lfSwKICAgICAgICAgICAgVmVyc2lvbiA9PiAkSW5zdGFsbGVkVmVyc2lvbiwKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiAxOwp9CgpzdWIgX0NoZWNrREJNZXJnZWQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgaWYgKCAhZGVmaW5lZCAkUGFyYW17RGF0YWJhc2V9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnRGF0YWJhc2Ugbm90IGRlZmluZWQhJywKICAgICAgICApOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKCByZWYgJFBhcmFte0RhdGFiYXNlfSBuZSAnQVJSQVknICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnTmVlZCBhcnJheSByZWYgaW4gRGF0YWJhc2UgcGFyYW0hJywKICAgICAgICApOwoKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbXkgQFBhcnRzOwogICAgbXkgJFVzZSA9IDE7CiAgICBteSAkTm90VXNlVGFnOwogICAgbXkgJE5vdFVzZVRhZ0xldmVsOwogICAgUEFSVDoKICAgIGZvciBteSAkUGFydCAoIEB7ICRQYXJhbXtEYXRhYmFzZX0gfSApIHsKCiAgICAgICAgaWYgKCAkVXNlIGVxIDAgKSB7CgogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAkUGFydC0+e1RhZ1R5cGV9IGVxICdFbmQnCiAgICAgICAgICAgICAgICAmJiAoIGRlZmluZWQgJE5vdFVzZVRhZyAgICAgICYmICRQYXJ0LT57VGFnfSBlcSAkTm90VXNlVGFnICkKICAgICAgICAgICAgICAgICYmICggZGVmaW5lZCAkTm90VXNlVGFnTGV2ZWwgJiYgJFBhcnQtPntUYWdMZXZlbH0gZXEgJE5vdFVzZVRhZ0xldmVsICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJFVzZSA9IDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG5leHQgUEFSVDsKCiAgICAgICAgfQogICAgICAgIGVsc2lmICgKICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgZGVmaW5lZCAkUGFydC0+e0lmUGFja2FnZX0KICAgICAgICAgICAgICAgICYmICEkU2VsZi0+e01lcmdlZFBhY2thZ2VzfS0+eyAkUGFydC0+e0lmUGFja2FnZX0gfQogICAgICAgICAgICApCiAgICAgICAgICAgIHx8ICgKICAgICAgICAgICAgICAgIGRlZmluZWQgJFBhcnQtPntJZk5vdFBhY2thZ2V9CiAgICAgICAgICAgICAgICAmJiBkZWZpbmVkICRTZWxmLT57TWVyZ2VkUGFja2FnZXN9LT57ICRQYXJ0LT57SWZOb3RQYWNrYWdlfSB9CiAgICAgICAgICAgICkKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgIyBzdG9yZSBUYWcgYW5kIFRhZ0xldmVsIHRvIGJlIHVzZWQgbGF0ZXIgYW5kIGZvdW5kIHRoZSBlbmQgb2YgdGhpcyBsZXZlbAogICAgICAgICAgICAkTm90VXNlVGFnICAgICAgPSAkUGFydC0+e1RhZ307CiAgICAgICAgICAgICROb3RVc2VUYWdMZXZlbCA9ICRQYXJ0LT57VGFnTGV2ZWx9OwoKICAgICAgICAgICAgJFVzZSA9IDA7CiAgICAgICAgICAgIG5leHQgUEFSVDsKICAgICAgICB9CgogICAgICAgIHB1c2ggQFBhcnRzLCAkUGFydDsKICAgIH0KCiAgICByZXR1cm4gXEBQYXJ0czsKfQoKPWl0ZW0gUmVwb3NpdG9yeUNsb3VkTGlzdCgpCgpyZXR1cm5zIGEgbGlzdCBvZiBhdmFpbGFibGUgY2xvdWQgcmVwb3NpdG9yaWVzCgogICAgbXkgJExpc3QgPSAkUGFja2FnZU9iamVjdC0+UmVwb3NpdG9yeUNsb3VkTGlzdCgpOwoKPWN1dAoKc3ViIFJlcG9zaXRvcnlDbG91ZExpc3QgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGdldCBjYWNoZSBvYmplY3QKICAgIG15ICRDYWNoZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpOwoKICAgICMgY2hlY2sgY2FjaGUKICAgIG15ICRDYWNoZUtleSA9ICJSZXBvc2l0b3J5OjpMaXN0OjpGcm9tOjpDbG91ZCI7CiAgICBteSAkQ2FjaGUgICAgPSAkQ2FjaGVPYmplY3QtPkdldCgKICAgICAgICBUeXBlID0+ICdSZXBvc2l0b3J5Q2xvdWRMaXN0JywKICAgICAgICBLZXkgID0+ICRDYWNoZUtleSwKICAgICk7CgogICAgJFBhcmFte05vQ2FjaGV9IC8vPSAwOwoKICAgICMgY2hlY2sgaWYgdXNlIGNhY2hlIGlzIG5lZWRlZAogICAgaWYgKCAhJFBhcmFte05vQ2FjaGV9ICkgewogICAgICAgIHJldHVybiAkQ2FjaGUgaWYgSXNIYXNoUmVmV2l0aERhdGEoJENhY2hlKTsKICAgIH0KCiAgICBteSAkUmVwb3NpdG9yeVJlc3VsdCA9ICRTZWxmLT5DbG91ZEZpbGVHZXQoCiAgICAgICAgT3BlcmF0aW9uID0+ICdSZXBvc2l0b3J5TGlzdEF2YWlsYWJsZScsCiAgICApOwoKICAgIHJldHVybiBpZiAhSXNIYXNoUmVmV2l0aERhdGEoJFJlcG9zaXRvcnlSZXN1bHQpOwoKICAgICMgc2V0IGNhY2hlCiAgICAkQ2FjaGVPYmplY3QtPlNldCgKICAgICAgICBUeXBlICA9PiAnUmVwb3NpdG9yeUNsb3VkTGlzdCcsCiAgICAgICAgS2V5ICAgPT4gJENhY2hlS2V5LAogICAgICAgIFZhbHVlID0+ICRSZXBvc2l0b3J5UmVzdWx0LAogICAgICAgIFRUTCAgID0+IDYwICogNjAsCiAgICApOwoKICAgIHJldHVybiAkUmVwb3NpdG9yeVJlc3VsdDsKfQoKPWl0ZW0gQ2xvdWRGaWxlR2V0KCkKCnJldHVybnMgYSBmaWxlIGZyb20gY2xvdWQKCiAgICBteSAkTGlzdCA9ICRQYWNrYWdlT2JqZWN0LT5DbG91ZEZpbGVHZXQoCiAgICAgICAgT3BlcmF0aW9uID0+ICdPcGVyYXRpb25OYW1lJywgIyB1c2VkIGFzIG9wZXJhdGlvbiBuYW1lIGJ5IHRoZSBDbG91ZCBTZXJ2aWNlIEFQSQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgUG9zc2libGUgb3BlcmF0aW9uIG5hbWVzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgLSBSZXBvc2l0b3J5TGlzdEF2YWlsYWJsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgLSBGQU9MaXN0QXNzaWduZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIC0gRkFPTGlzdEFzc2lnbmVkRmlsZUdldAogICAgKTsKCj1jdXQKCnN1YiBDbG91ZEZpbGVHZXQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICByZXR1cm4gaWYgJFNlbGYtPntDbG91ZFNlcnZpY2VzRGlzYWJsZWR9OwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICFkZWZpbmVkICRQYXJhbXtPcGVyYXRpb259ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnT3BlcmF0aW9uIG5vdCBkZWZpbmVkIScsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbXkgJURhdGE7CiAgICBpZiAoIElzSGFzaFJlZldpdGhEYXRhKCAkUGFyYW17RGF0YX0gKSApIHsKICAgICAgICAlRGF0YSA9ICV7ICRQYXJhbXtEYXRhfSB9OwogICAgfQoKICAgIG15ICRDbG91ZFNlcnZpY2UgPSAnUGFja2FnZU1hbmFnZW1lbnQnOwoKICAgICMgcHJlcGFyZSBjbG91ZCBzZXJ2aWNlIHJlcXVlc3QKICAgIG15ICVSZXF1ZXN0UGFyYW1zID0gKAogICAgICAgIFJlcXVlc3REYXRhID0+IHsKICAgICAgICAgICAgJENsb3VkU2VydmljZSA9PiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgT3BlcmF0aW9uID0+ICRQYXJhbXtPcGVyYXRpb259LAogICAgICAgICAgICAgICAgICAgIERhdGEgICAgICA9PiBcJURhdGEsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICBdLAogICAgICAgIH0sCiAgICApOwoKICAgICMgZ2V0IGNsb3VkIHNlcnZpY2Ugb2JqZWN0CiAgICBteSAkQ2xvdWRTZXJ2aWNlT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNsb3VkU2VydmljZTo6QmFja2VuZDo6UnVuJyk7CgogICAgIyBkaXNwYXRjaCB0aGUgY2xvdWQgc2VydmljZSByZXF1ZXN0CiAgICBteSAkUmVxdWVzdFJlc3VsdCA9ICRDbG91ZFNlcnZpY2VPYmplY3QtPlJlcXVlc3QoJVJlcXVlc3RQYXJhbXMpOwoKICAgICMgYXMgdGhpcyBpcyB0aGUgb25seSBvcGVyYXRpb24gYW4gdW5zdWNjZXNzZnVsIHJlcXVlc3QgbWVhbnMgdGhhdCB0aGUgb3BlcmF0aW9uIHdhcyBhbHNvCiAgICAjIHVuc3VjY2Vzc2Z1bAogICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoJFJlcXVlc3RSZXN1bHQpICkgewogICAgICAgIG15ICRFcnJvck1lc3NhZ2UgPSAiQ2FuJ3QgY29ubmVjdCB0byBjbG91ZCBzZXJ2ZXIhIjsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJEVycm9yTWVzc2FnZSwKICAgICAgICApOwogICAgICAgIHJldHVybiAkRXJyb3JNZXNzYWdlOwogICAgfQoKICAgIG15ICRPcGVyYXRpb25SZXN1bHQgPSAkQ2xvdWRTZXJ2aWNlT2JqZWN0LT5PcGVyYXRpb25SZXN1bHRHZXQoCiAgICAgICAgUmVxdWVzdFJlc3VsdCA9PiAkUmVxdWVzdFJlc3VsdCwKICAgICAgICBDbG91ZFNlcnZpY2UgID0+ICRDbG91ZFNlcnZpY2UsCiAgICAgICAgT3BlcmF0aW9uICAgICA9PiAkUGFyYW17T3BlcmF0aW9ufSwKICAgICk7CgogICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoJE9wZXJhdGlvblJlc3VsdCkgKSB7CiAgICAgICAgbXkgJEVycm9yTWVzc2FnZSA9ICJDYW4ndCBnZXQgcmVzdWx0IGZyb20gc2VydmVyIjsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJEVycm9yTWVzc2FnZSwKICAgICAgICApOwogICAgICAgIHJldHVybiAkRXJyb3JNZXNzYWdlOwogICAgfQogICAgZWxzaWYgKCAhJE9wZXJhdGlvblJlc3VsdC0+e1N1Y2Nlc3N9ICkgewogICAgICAgIG15ICRFcnJvck1lc3NhZ2UgPSAkT3BlcmF0aW9uUmVzdWx0LT57RXJyb3JNZXNzYWdlfQogICAgICAgICAgICB8fCAiQ2FuJ3QgZ2V0IGxpc3QgZnJvbSBzZXJ2ZXIhIjsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJEVycm9yTWVzc2FnZSwKICAgICAgICApOwogICAgICAgIHJldHVybiAkRXJyb3JNZXNzYWdlOwogICAgfQoKICAgICMgcmV0dXJuIGlmIG5vdCBjb3JyZWN0IHN0cnVjdHVyZQogICAgcmV0dXJuIGlmICFJc0hhc2hSZWZXaXRoRGF0YSggJE9wZXJhdGlvblJlc3VsdC0+e0RhdGF9ICk7CgogICAgIyByZXR1cm4gcmVwbyBsaXN0CiAgICByZXR1cm4gJE9wZXJhdGlvblJlc3VsdC0+e0RhdGF9OwoKfQoKc3ViIERFU1RST1kgewogICAgbXkgJFNlbGYgPSBzaGlmdDsKCiAgICAjIGV4ZWN1dGUgYWxsIHRyYW5zYWN0aW9uIGV2ZW50cwogICAgJFNlbGYtPkV2ZW50SGFuZGxlclRyYW5zYWN0aW9uKCk7CgogICAgcmV0dXJuIDE7Cn0KCjE7Cgo9ZW5kIEludGVybmFsOgoKPWJhY2sKCj1oZWFkMSBURVJNUyBBTkQgQ09ORElUSU9OUwoKVGhpcyBzb2Z0d2FyZSBpcyBwYXJ0IG9mIHRoZSBPVFJTIHByb2plY3QgKEw8aHR0cDovL290cnMub3JnLz4pLgoKVGhpcyBzb2Z0d2FyZSBjb21lcyB3aXRoIEFCU09MVVRFTFkgTk8gV0FSUkFOVFkuIEZvciBkZXRhaWxzLCBzZWUKdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoQUdQTCkuIElmIHlvdQpkaWQgbm90IHJlY2VpdmUgdGhpcyBmaWxlLCBzZWUgTDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvYWdwbC50eHQ+LgoKPWN1dAo=</File>
        <File Location="KIXCore/Kernel/System/Stats.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDE2IE9UUlMgQUcsIGh0dHA6Ly9vdHJzLmNvbS8KIyBLSVhDb3JlLUV4dGVuc2lvbnMgQ29weXJpZ2h0IChDKSAyMDA2LTIwMTYgYy5hLnAuZS4gSVQgR21iSCwgaHR0cDovL3d3dy5jYXBlLWl0LmRlCiMKIyB3cml0dGVuL2VkaXRlZCBieToKIyAqIE1hcnRpbihkb3QpQmFsemFyZWsoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojICogU3RlZmFuKGRvdClNZWhsaWcoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojICogRG9yb3RoZWEoZG90KURvZXJmZmVsKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIEFubmEoZG90KUxpdHZpbm92YShhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMgLS0KIyAkSWQ6IFN0YXRzLnBtLHYgMS4zOCAyMDE2LzA3LzA1IDExOjM3OjU1IGRkb2VyZmZlbCBFeHAgJAojIC0tCiMgVGhpcyBzb2Z0d2FyZSBjb21lcyB3aXRoIEFCU09MVVRFTFkgTk8gV0FSUkFOVFkuIEZvciBkZXRhaWxzLCBzZWUKIyB0aGUgZW5jbG9zZWQgZmlsZSBDT1BZSU5HIGZvciBsaWNlbnNlIGluZm9ybWF0aW9uIChBR1BMKS4gSWYgeW91CiMgZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9hZ3BsLnR4dC4KIyAtLQoKcGFja2FnZSBLZXJuZWw6OlN5c3RlbTo6U3RhdHM7Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7Cgp1c2UgTUlNRTo6QmFzZTY0OwoKdXNlIERhdGU6OlBjYWxjCiAgICBxdyhBZGRfRGVsdGFfWU1EIEFkZF9EZWx0YV9ESE1TIEFkZF9EZWx0YV9EYXlzIERheXNfaW5fTW9udGggRGF5X29mX1dlZWsgRGF5X29mX1dlZWtfQWJicmV2aWF0aW9uIERheV9vZl9XZWVrX3RvX1RleHQgTW9uZGF5X29mX1dlZWsgV2Vla19vZl9ZZWFyKTsKdXNlIFBPU0lYIHF3KGNlaWwpOwp1c2UgU3RvcmFibGUgcXcoKTsKCnVzZSBLZXJuZWw6OlN5c3RlbTo6VmFyaWFibGVDaGVjayBxdyg6YWxsKTsKdXNlIEtlcm5lbDo6T3V0cHV0OjpIVE1MOjpTdGF0aXN0aWNzOjpWaWV3OwoKb3VyIEBPYmplY3REZXBlbmRlbmNpZXMgPSAoCiAgICAnS2VybmVsOjpDb25maWcnLAogICAgJ0tlcm5lbDo6TGFuZ3VhZ2UnLAogICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpTdGF0aXN0aWNzOjpWaWV3JywKICAgICdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpEQicsCiAgICAnS2VybmVsOjpTeXN0ZW06OkVuY29kZScsCiAgICAnS2VybmVsOjpTeXN0ZW06Okdyb3VwJywKICAgICdLZXJuZWw6OlN5c3RlbTo6TG9nJywKICAgICdLZXJuZWw6OlN5c3RlbTo6TWFpbicsCiAgICAnS2VybmVsOjpTeXN0ZW06OlRpbWUnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpVc2VyJywKICAgICdLZXJuZWw6OlN5c3RlbTo6WE1MJywKICAgICMgS0lYQ29yZS1jYXBlSVQKICAgICdLZXJuZWw6OlN5c3RlbTo6S0lYVXRpbHMnLAogICAgIyBFTyBLSVhDb3JlLWNhcGVJVAopOwoKPWhlYWQxIE5BTUUKCktlcm5lbDo6U3lzdGVtOjpTdGF0cyAtIHN0YXRzIGxpYgoKPWhlYWQxIFNZTk9QU0lTCgpBbGwgc3RhdHMgZnVuY3Rpb25zLgoKPWhlYWQyIEV4cGxhbmF0aW9uIGZvciB0aGUgdGltZSB6b25lIHBhcmFtZXRlcgoKVGhlIHRpbWUgem9uZSBwYXJhbWV0ZXIgaXMgYXZhaWxhYmxlLCBpZiB0aGUgc3lzdGVtIHVzZSBVVEMgYXMgc3lzdGVtIHRpbWUgYW5kIHRoZSBUaW1lWm9uZVVzZXIgZmVhdHVyZSBpcyBhY3RpdmUKYW5kIHRoZSBzdGF0aXN0aWMgaXMgYSBkeW5hbWljIHN0YXRpc3RpYy4gVGhlIHNlbGVjdGVkIHBlcmlvZHMgaW4gdGhlIGZyb250ZW5kIGFyZSB0aW1lIHpvbmUgbmV1dHJhbCBhbmQgZm9yIHRoZQpzZWFyY2ggcGFyYW1ldGVycywgdGhlIHNlbGVjdGlvbiB3aWxsIGJlIGNvbnZlcnRlZCB0byBVVEMgdGltZSBiYXNlZCBvbiB0aGUgc2VsZWN0ZWQgdGltZSB6b25lLCBiZWNhdXNlIHRoZSB0aW1lcwphcmUgc3RvcmVkIGFzIFVUQyB0aW1lIGluIHRoZSBkYXRhYmFzZSAoaWYgdGhlIHN5c3RlbSBpcyBjb25maWd1cmVkIGNvcnJlY3RseSkuCgpUaGlzIG1lYW5zIGUuZy4gaWYgYSBhYnNvbHV0ZSBwZXJpb2Qgb2YgdGltZSBmcm9tIDIwMTUgMjAxNS0wOC0wMSAwMDowMDowMCB0byAyMDE1LTA5LTEwIDIzOjU5OjU5IGFuZCBhIHRpbWUgem9uZSArNiBoYXMgYmVlbiBzZWxlY3RlZCwKdGhlIHRpbWUgem9uZSAoKzYpIHdpbGwgYmUgc3VidHJhY3RlZCAod2l0aCAiX1N1YnRyYWN0VGltZVpvbmUiKSBmcm9tIHRoZSBzZWxlY3RlZCBhYnNvbHV0ZSB0aW1lIHBlcmlvZCBmb3IgdGhlIHNlYXJjaCBwYXJhbWV0ZXIsCnNvIHRoYXQgdGhlIHJpZ2h0IFVUQyB0aW1lIHdpbGwgYmUgdXNlZCBmb3IgdGhlIGFic29sdXRlIHBlcmlvZCBvZiB0aW1lLiBGb3IgdGhlIGV4YW1wbGUgdGhpcyB3b3VsZCBiZSB0aGUgMjAxNS0wNy0zMSAxODowMDowMCB0byAyMDE1LTA5LTEwIDE3OjU5OjU5LgoKRm9yIGEgcmVsYXRpdmUgdGltZSBwZXJpb2QsIGUuZy4gYSByZWxhdGl2ZSBwZXJpb2Qgb2YgdGhlIGxhc3QgZnVsbCAxMCBkYXlzIGFuZCB0aGUgdGltZSB6b25lICsxMCwgZmlyc3QgdGhlIHNlbGVjdGVkCnRpbWUgem9uZSB3aWxsIGJlIGFkZGVkICh3aXRoICJfQWRkVGltZVpvbmUiKSB0byB0aGUgY3VycmVudCBVVEMgdGltZSwgc28gdGhhdCB0aGUgcmlnaHQgcmVsYXRpdmUgcGVyaW9kIG9mIHRpbWUgd2lsbCBiZSB1c2VkIGZvciB0aGUgZnJvbnRlbmQgb3V0cHV0LgpGb3IgdGhlIGV4YW1wbGUsIHdlIGhhdmUgdGhlIGN1cnJlbnQgVVRDIHRpbWUgMjAxNS0wOS0xMCAxNjowMDowMCwgdGhhdCBtZWFucyBmb3IgdGhlIHNlbGVjdGVkIHJlbGF0aXZlIHBlcmlvZCBhbmQgdGltZSB6b25lICgrMTApIHRoZSBwZXJpb2Qgb2YgdGltZQpmcm9tIDIwMTUtMDktMDEgMDA6MDA6MDAgdG8gMjAxNS0wOS0xMCAyMzo1OTo1OS4gRnJvbSB0aGUgcGVyaW9kIG9mIHRpbWUgd2lsbCBiZSBzdWJzdHJhY3RlZCB0aGUgc2VsZWN0ZWQgdGltZSB6b25lICgrMTApIHRvIGdldCB0aGUgY29ycmVjdCBVVEMgdGltZQpmb3IgdGhlIHNlYXJjaCBpbiB0aGUgZGF0YWJhc2UgKGFzIGZvciB0aGUgYWJzb2x1dGUgdGltZSkuIEluIHRoaXMgY2FzZSB0aGF0IHdvdWxkIGJlIHRoZSBwZXJpb2Qgb2YgdGltZSBmcm9tIDIwMTUtMDgtMzEgMTQ6MDA6MDAgdG8gMjAxNS0wOS0xMCAxMzo1OTo1OS4KCj1oZWFkMSBQVUJMSUMgSU5URVJGQUNFCgo9b3ZlciA0Cgo9aXRlbSBuZXcoKQoKY3JlYXRlIGFuIG9iamVjdC4gRG8gbm90IHVzZSBpdCBkaXJlY3RseSwgaW5zdGVhZCB1c2U6CgogICAgdXNlIEtlcm5lbDo6U3lzdGVtOjpPYmplY3RNYW5hZ2VyOwogICAgbG9jYWwgJEtlcm5lbDo6T00gPSBLZXJuZWw6OlN5c3RlbTo6T2JqZWN0TWFuYWdlci0+bmV3KCk7CiAgICBteSAkU3RhdHNPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6U3RhdHMnKTsKCj1jdXQKCnN1YiBuZXcgewogICAgbXkgKCAkVHlwZSwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGFsbG9jYXRlIG5ldyBoYXNoIGZvciBvYmplY3QKICAgIG15ICRTZWxmID0ge307CiAgICBibGVzcyggJFNlbGYsICRUeXBlICk7CgogICAgIyB0ZW1wb3JhcnkgZGlyZWN0b3J5CiAgICAkU2VsZi0+e1N0YXRzVGVtcERpcn0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ0hvbWUnKSAuICcvdmFyL3N0YXRzLyc7CgogICAgcmV0dXJuICRTZWxmOwp9Cgo9aXRlbSBTdGF0c0FkZCgpCgphZGQgbmV3IGVtcHR5IHN0YXRzCgogICAgbXkgJFN0YXRJRCA9ICRTdGF0c09iamVjdC0+U3RhdHNBZGQoCiAgICAgICAgVXNlcklEID0+ICRVc2VySUQsCiAgICApOwoKPWN1dAoKc3ViIFN0YXRzQWRkIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgZm9yIG15ICROZWVkZWQgKHF3KFVzZXJJRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gImVycm9yIiwKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQuIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCBuZWVkZWQgb2JqZWN0cwogICAgbXkgJFhNTE9iamVjdCAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6WE1MJyk7CiAgICBteSAkVGltZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaW1lJyk7CgogICAgIyBnZXQgbmV3IFN0YXRJRAogICAgbXkgJFN0YXRJRCA9IDE7CiAgICBteSBAS2V5cyAgID0gJFhNTE9iamVjdC0+WE1MSGFzaFNlYXJjaCgKICAgICAgICBUeXBlID0+ICdTdGF0cycsCiAgICApOwogICAgaWYgKEBLZXlzKSB7CiAgICAgICAgbXkgQFNvcnRLZXlzID0gc29ydCB7ICRhIDw9PiAkYiB9IEBLZXlzOwogICAgICAgICRTdGF0SUQgPSAkU29ydEtleXNbLTFdICsgMTsKICAgIH0KCiAgICAjIHJlcXVlc3RpbmcgY3VycmVudCB0aW1lIHN0YW1wCiAgICBteSAkVGltZVN0YW1wID0gJFRpbWVPYmplY3QtPlN5c3RlbVRpbWUyVGltZVN0YW1wKAogICAgICAgIFN5c3RlbVRpbWUgPT4gJFRpbWVPYmplY3QtPlN5c3RlbVRpbWUoKSwKICAgICk7CgogICAgIyBtZXRhIHRhZ3MKICAgIG15ICRTdGF0TnVtYmVyID0gJFN0YXRJRCArICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnU3RhdHM6OlN0YXRzU3RhcnROdW1iZXInKTsKCiAgICBteSAlTWV0YURhdGEgPSAoCiAgICAgICAgQ3JlYXRlZCA9PiBbCiAgICAgICAgICAgIHsgQ29udGVudCA9PiAkVGltZVN0YW1wIH0sCiAgICAgICAgXSwKICAgICAgICBDcmVhdGVkQnkgPT4gWwogICAgICAgICAgICB7IENvbnRlbnQgPT4gJFBhcmFte1VzZXJJRH0gfSwKICAgICAgICBdLAogICAgICAgIENoYW5nZWQgPT4gWwogICAgICAgICAgICB7IENvbnRlbnQgPT4gJFRpbWVTdGFtcCB9LAogICAgICAgIF0sCiAgICAgICAgQ2hhbmdlZEJ5ID0+IFsKICAgICAgICAgICAgeyBDb250ZW50ID0+ICRQYXJhbXtVc2VySUR9IH0sCiAgICAgICAgXSwKICAgICAgICBWYWxpZCA9PiBbCiAgICAgICAgICAgIHsgQ29udGVudCA9PiAxIH0sCiAgICAgICAgXSwKICAgICAgICBTdGF0TnVtYmVyID0+IFsKICAgICAgICAgICAgeyBDb250ZW50ID0+ICRTdGF0TnVtYmVyIH0sCiAgICAgICAgXSwKICAgICk7CgogICAgIyBzdGFydCBuZXcgc3RhdHMgcmVjb3JkCiAgICBteSBAWE1MSGFzaCA9ICgKICAgICAgICB7IG90cnNfc3RhdHMgPT4gWyBcJU1ldGFEYXRhIF0gfSwKICAgICk7CiAgICBteSAkU3VjY2VzcyA9ICRYTUxPYmplY3QtPlhNTEhhc2hBZGQoCiAgICAgICAgVHlwZSAgICA9PiAnU3RhdHMnLAogICAgICAgIEtleSAgICAgPT4gJFN0YXRJRCwKICAgICAgICBYTUxIYXNoID0+IFxAWE1MSGFzaCwKICAgICk7CiAgICBpZiAoICEkU3VjY2VzcyApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ0NhbiBub3QgYWRkIGEgbmV3IFN0YXQhJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKS0+Q2xlYW5VcCgKICAgICAgICBUeXBlID0+ICdTdGF0cycsCiAgICApOwoKICAgIHJldHVybiAkU3RhdElEOwp9Cgo9aXRlbSBTdGF0c0dldCgpCgpnZXQgYSBoYXNoIHJlZiBvZiB0aGUgc3RhdHMgeW91IG5lZWQKCiAgICBteSAkSGFzaFJlZiA9ICRTdGF0c09iamVjdC0+U3RhdHNHZXQoCiAgICAgICAgU3RhdElEICAgICAgICAgICAgID0+ICcxMjMnLAogICAgICAgIE5vT2JqZWN0QXR0cmlidXRlcyA9PiAxLCAgICAgICAjIG9wdGlvbmFsCiAgICApOwoKPWN1dAoKc3ViIFN0YXRzR2V0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWNlc3NhcnkgZGF0YQogICAgaWYgKCAhJFBhcmFte1N0YXRJRH0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdOZWVkIFN0YXRJRCEnCiAgICAgICAgKTsKICAgIH0KCiAgICAkUGFyYW17Tm9PYmplY3RBdHRyaWJ1dGVzfSA9ICRQYXJhbXtOb09iamVjdEF0dHJpYnV0ZXN9ID8gMSA6IDA7CgogICAgIyBnZXQgY2FjaGUgb2JqZWN0CiAgICBteSAkQ2FjaGVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKTsKCiAgICBteSAkQ2FjaGVLZXkgPSAiU3RhdHNHZXQ6OlN0YXRJRDo6JFBhcmFte1N0YXRJRH06Ok5vT2JqZWN0QXR0cmlidXRlczo6JFBhcmFte05vT2JqZWN0QXR0cmlidXRlc30iOwoKICAgIG15ICRDYWNoZSA9ICRDYWNoZU9iamVjdC0+R2V0KAogICAgICAgIFR5cGUgPT4gJ1N0YXRzJywKICAgICAgICBLZXkgID0+ICRDYWNoZUtleSwKCiAgICAgICAgIyBEb24ndCBzdG9yZSBjb21wbGV4IHN0cnVjdHVyZSBpbiBtZW1vcnkgYXMgaXQgd2lsbCBiZSBtb2RpZmllZCBsYXRlci4KICAgICAgICBDYWNoZUluTWVtb3J5ID0+IDAsCiAgICApOwogICAgcmV0dXJuICRDYWNoZSBpZiByZWYgJENhY2hlIGVxICdIQVNIJzsKCiAgICAjIGdldCBoYXNoIGZyb20gc3RvcmFnZQogICAgbXkgQFhNTEhhc2ggPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6WE1MJyktPlhNTEhhc2hHZXQoCiAgICAgICAgVHlwZSA9PiAnU3RhdHMnLAogICAgICAgIEtleSAgPT4gJFBhcmFte1N0YXRJRH0sCiAgICApOwoKICAgIGlmICggISRYTUxIYXNoWzBdICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiQ2FuJ3QgZ2V0IFN0YXRzSUQgJFBhcmFte1N0YXRJRH0hIiwKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBteSAlU3RhdDsKICAgIG15ICRTdGF0c1hNTCA9ICRYTUxIYXNoWzBdLT57b3Ryc19zdGF0c30tPlsxXTsKCiAgICAjIHByb2Nlc3MgYWxsIHN0cmluZ3MKICAgICRTdGF0e1N0YXRJRH0gPSAkUGFyYW17U3RhdElEfTsKICAgIGZvciBteSAkS2V5ICgKICAgICAgICBxdyhUaXRsZSBPYmplY3QgRmlsZSBEZXNjcmlwdGlvbiBTdW1Sb3cgU3VtQ29sIFN0YXROdW1iZXIKICAgICAgICBDYWNoZSBTdGF0VHlwZSBWYWxpZCBPYmplY3RNb2R1bGUgQ3JlYXRlZEJ5IENoYW5nZWRCeSBDcmVhdGVkIENoYW5nZWQKICAgICAgICBTaG93QXNEYXNoYm9hcmRXaWRnZXQKICAgICAgICApCiAgICAgICAgKQogICAgewogICAgICAgIGlmICggZGVmaW5lZCAkU3RhdHNYTUwtPnskS2V5fS0+WzFdLT57Q29udGVudH0gKSB7CiAgICAgICAgICAgICRTdGF0eyRLZXl9ID0gJFN0YXRzWE1MLT57JEtleX0tPlsxXS0+e0NvbnRlbnR9OwogICAgICAgIH0KICAgIH0KCiAgIyBwcm92aWRlIHRoZSB0aW1lIHpvbmUgZmllbGQgb25seSwgaWYgdGhlIHN5c3RlbSB1c2Ugbm90IFVUQyBhcyBzeXN0ZW0gdGltZSBvciB0aGUgVGltZVpvbmVVc2VyIGZlYXR1cmUgaXMgbm90IGFjdGl2ZQogICAgaWYgKAogICAgICAgICEkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGltZScpLT5TZXJ2ZXJMb2NhbFRpbWVPZmZzZXRTZWNvbmRzKCkKICAgICAgICAmJiAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ1RpbWVab25lVXNlcicpCiAgICAgICAgKQogICAgewogICAgICAgIGlmICggZGVmaW5lZCAkU3RhdHNYTUwtPntUaW1lWm9uZX0tPlsxXS0+e0NvbnRlbnR9ICkgewogICAgICAgICAgICAkU3RhdHtUaW1lWm9uZX0gPSAkU3RhdHNYTUwtPntUaW1lWm9uZX0tPlsxXS0+e0NvbnRlbnR9OwogICAgICAgIH0KICAgIH0KCiAgICAjIHByb2Nlc3MgYWxsIGFycmF5cwogICAgS0VZOgogICAgZm9yIG15ICRLZXkgKHF3KFBlcm1pc3Npb24gRm9ybWF0IEdyYXBoU2l6ZSkpIHsKICAgICAgICBuZXh0IEtFWSBpZiAhJFN0YXRzWE1MLT57JEtleX0tPlsxXS0+e0NvbnRlbnR9OwoKICAgICAgICAkU3RhdHskS2V5fSA9ICgpOwogICAgICAgIGZvciBteSAkSW5kZXggKCAxIC4uICQjeyAkU3RhdHNYTUwtPnskS2V5fSB9ICkgewogICAgICAgICAgICBwdXNoIEB7ICRTdGF0eyRLZXl9IH0sICRTdGF0c1hNTC0+eyRLZXl9LT5bJEluZGV4XS0+e0NvbnRlbnR9OwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoICRTdGF0e09iamVjdE1vZHVsZX0gKSB7CiAgICAgICAgJFN0YXR7T2JqZWN0QmVoYXZpb3Vyc30gPSAkU2VsZi0+R2V0T2JqZWN0QmVoYXZpb3VycygKICAgICAgICAgICAgT2JqZWN0TW9kdWxlID0+ICRTdGF0e09iamVjdE1vZHVsZX0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGdldCB0aGUgY29uZmlndXJhdGlvbiBlbGVtZW50cyBvZiB0aGUgZHluYW1pYyBzdGF0cwogICAgIyAlQWxsb3dlZCBpcyB1c2VkIHRvIGF2b2lkIGRvdWJsZSBzZWxlY3Rpb24gaW4gZGlmZmVyZW50IGZvcm1zCiAgICBteSAlQWxsb3dlZDsKICAgIG15ICVUaW1lQWxsb3dlZDsKICAgIG15ICRUaW1lRWxlbWVudCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnU3RhdHM6OlRpbWVFbGVtZW50JykgfHwgJ1RpbWUnOwoKICAgIHJldHVybiBcJVN0YXQgaWYgISRTdGF0e09iamVjdH07CgogICAgJFN0YXR7T2JqZWN0TmFtZX0gPSAkU2VsZi0+R2V0T2JqZWN0TmFtZSgKICAgICAgICBPYmplY3RNb2R1bGUgPT4gJFN0YXR7T2JqZWN0TW9kdWxlfSwKICAgICk7CgogICAgaWYgKCAkUGFyYW17Tm9PYmplY3RBdHRyaWJ1dGVzfSApIHsKCiAgICAgICAgJENhY2hlT2JqZWN0LT5TZXQoCiAgICAgICAgICAgIFR5cGUgID0+ICdTdGF0cycsCiAgICAgICAgICAgIEtleSAgID0+ICRDYWNoZUtleSwKICAgICAgICAgICAgVmFsdWUgPT4gXCVTdGF0LAogICAgICAgICAgICBUVEwgICA9PiAyNCAqIDYwICogNjAsCgogICAgICAgICAgICAjIERvbid0IHN0b3JlIGNvbXBsZXggc3RydWN0dXJlIGluIG1lbW9yeSBhcyBpdCB3aWxsIGJlIG1vZGlmaWVkIGxhdGVyLgogICAgICAgICAgICBDYWNoZUluTWVtb3J5ID0+IDAsCiAgICAgICAgKTsKCiAgICAgICAgcmV0dXJuIFwlU3RhdDsKICAgIH0KCiAgICBLRVk6CiAgICBmb3IgbXkgJEtleSAocXcoVXNlQXNYdmFsdWUgVXNlQXNWYWx1ZVNlcmllcyBVc2VBc1Jlc3RyaWN0aW9uKSkgewoKICAgICAgICAjIEBTdGF0QXR0cmlidXRlc1NpbXBsaWZpZWQgZ2l2ZSB5b3UgYXJyYXlzIHdpdGhvdXQgdW5kZWYgYXJyYXkgZWxlbWVudHMKICAgICAgICBteSBAU3RhdEF0dHJpYnV0ZXNTaW1wbGlmaWVkOwoKICAgICAgICAjIGdldCB0aGUgYXR0cmlidXRlcyBvZiB0aGUgb2JqZWN0CiAgICAgICAgbXkgQE9iamVjdEF0dHJpYnV0ZXMgPSAkU2VsZi0+R2V0U3RhdHNPYmplY3RBdHRyaWJ1dGVzKAogICAgICAgICAgICBPYmplY3RNb2R1bGUgPT4gJFN0YXR7T2JqZWN0TW9kdWxlfSwKICAgICAgICAgICAgVXNlICAgICAgICAgID0+ICRLZXksCiAgICAgICAgKTsKCiAgICAgICAgbmV4dCBLRVkgaWYgIUBPYmplY3RBdHRyaWJ1dGVzOwoKICAgICAgICBBVFRSSUJVVEU6CiAgICAgICAgZm9yIG15ICRBdHRyaWJ1dGUgKEBPYmplY3RBdHRyaWJ1dGVzKSB7CiAgICAgICAgICAgIG15ICRFbGVtZW50ID0gJEF0dHJpYnV0ZS0+e0VsZW1lbnR9OwogICAgICAgICAgICBpZiAoICRBdHRyaWJ1dGUtPntCbG9ja30gZXEgJ1RpbWUnICkgewogICAgICAgICAgICAgICAgaWYgKCAkS2V5IGVxICdVc2VBc1ZhbHVlU2VyaWVzJyApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoICRBbGxvd2VkeyRFbGVtZW50fSAmJiAkQWxsb3dlZHskRWxlbWVudH0gPT0gMSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEFsbG93ZWR7JEVsZW1lbnR9ICAgICA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICRUaW1lQWxsb3dlZHskRWxlbWVudH0gPSAxOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEFsbG93ZWR7JEVsZW1lbnR9ID0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNpZiAoICRLZXkgZXEgJ1VzZUFzUmVzdHJpY3Rpb24nICkgewogICAgICAgICAgICAgICAgICAgIGlmICggJFRpbWVBbGxvd2VkeyRFbGVtZW50fSAmJiAkVGltZUFsbG93ZWR7JEVsZW1lbnR9ID09IDEgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRBbGxvd2VkeyRFbGVtZW50fSA9IDE7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkQWxsb3dlZHskRWxlbWVudH0gPSAwOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBuZXh0IEFUVFJJQlVURSBpZiAkQWxsb3dlZHskRWxlbWVudH07CgogICAgICAgICAgICBpZiAoICRTdGF0c1hNTC0+eyRLZXl9ICkgewogICAgICAgICAgICAgICAgbXkgQFN0YXRBdHRyaWJ1dGVzID0gQHsgJFN0YXRzWE1MLT57JEtleX0gfTsKICAgICAgICAgICAgICAgIGlmICggISRTdGF0QXR0cmlidXRlc1swXSApIHsKICAgICAgICAgICAgICAgICAgICBzaGlmdCBAU3RhdEF0dHJpYnV0ZXM7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgUkVGOgogICAgICAgICAgICAgICAgZm9yIG15ICRSZWYgKEBTdGF0QXR0cmlidXRlcykgewogICAgICAgICAgICAgICAgICAgIGlmICggIWRlZmluZWQgJEF0dHJpYnV0ZS0+e1RyYW5zbGF0aW9ufSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEF0dHJpYnV0ZS0+e1RyYW5zbGF0aW9ufSA9IDE7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBuZXh0IFJFRgogICAgICAgICAgICAgICAgICAgICAgICBpZiAhKAogICAgICAgICAgICAgICAgICAgICAgICAkRWxlbWVudAogICAgICAgICAgICAgICAgICAgICAgICAmJiAkUmVmLT57RWxlbWVudH0KICAgICAgICAgICAgICAgICAgICAgICAgJiYgJEVsZW1lbnQgZXEgJFJlZi0+e0VsZW1lbnR9CiAgICAgICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgICMgaWYgc2VsZWN0ZWQgZWxlbWVudHMgZXhpdCwgYWRkIHRoZSBpbmZvcm1hdGlvbiB0byB0aGUgU3RhdEF0dHJpYnV0ZXMKICAgICAgICAgICAgICAgICAgICAkQXR0cmlidXRlLT57U2VsZWN0ZWR9ID0gMTsKICAgICAgICAgICAgICAgICAgICBpZiAoICRSZWYtPntGaXhlZH0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRBdHRyaWJ1dGUtPntGaXhlZH0gPSAxOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRJbmRleCAoIDEgLi4gJCN7ICRSZWYtPntTZWxlY3RlZFZhbHVlc30gfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCBAeyAkQXR0cmlidXRlLT57U2VsZWN0ZWRWYWx1ZXN9IH0sICRSZWYtPntTZWxlY3RlZFZhbHVlc30tPlskSW5kZXhdLT57Q29udGVudH07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoICRBdHRyaWJ1dGUtPntCbG9ja30gZXEgJ1RpbWUnICkgewoKICAgICAgICAgICAgICAgICAgICAgICAgIyBzZXR0aW5ncyBmb3Igd29ya2luZyB3aXRoIHRpbWUgZWxlbWVudHMKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF3KFRpbWVTdG9wIFRpbWVTdGFydCBUaW1lUmVsYXRpdmVVbml0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaW1lUmVsYXRpdmVDb3VudCBUaW1lUmVsYXRpdmVVcGNvbWluZ0NvdW50IFRpbWVTY2FsZUNvdW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZGVmaW5lZCAkUmVmLT57JF99ICYmICggISRBdHRyaWJ1dGUtPnskX30gfHwgJFJlZi0+e0ZpeGVkfSApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRBdHRyaWJ1dGUtPnskX30gPSAkUmVmLT57JF99OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAjIHNldCBhIGRlZmF1bHQgdmFsdWUgZm9yIHRoZSB0aW1lIHJlbGF0aXZlIHVwY29taW5nIGNvdW50IGZpZWxkCiAgICAgICAgICAgICAgICAgICAgICAgICRBdHRyaWJ1dGUtPntUaW1lUmVsYXRpdmVVcGNvbWluZ0NvdW50fSAvLz0gMDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRBbGxvd2VkeyRFbGVtZW50fSA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1c2ggQFN0YXRBdHRyaWJ1dGVzU2ltcGxpZmllZCwgJEF0dHJpYnV0ZTsKCiAgICAgICAgfQoKICAgICAgICAkU3RhdHskS2V5fSA9IFxAU3RhdEF0dHJpYnV0ZXNTaW1wbGlmaWVkOwogICAgfQoKICAgICRDYWNoZU9iamVjdC0+U2V0KAogICAgICAgIFR5cGUgID0+ICdTdGF0cycsCiAgICAgICAgS2V5ICAgPT4gJENhY2hlS2V5LAogICAgICAgIFZhbHVlID0+IFwlU3RhdCwKICAgICAgICBUVEwgICA9PiAyNCAqIDYwICogNjAsCgogICAgICAgICMgRG9uJ3Qgc3RvcmUgY29tcGxleCBzdHJ1Y3R1cmUgaW4gbWVtb3J5IGFzIGl0IHdpbGwgYmUgbW9kaWZpZWQgbGF0ZXIuCiAgICAgICAgQ2FjaGVJbk1lbW9yeSA9PiAwLAogICAgKTsKCiAgICByZXR1cm4gXCVTdGF0Owp9Cgo9aXRlbSBTdGF0c1VwZGF0ZSgpCgp1cGRhdGUgYSBzdGF0CgogICAgJFN0YXRzT2JqZWN0LT5TdGF0c1VwZGF0ZSgKICAgICAgICBTdGF0SUQgPT4gJzEyMycsCiAgICAgICAgSGFzaCAgID0+IFwlSGFzaCwKICAgICAgICBVc2VySUQgPT4gJFVzZXJJRCwKICAgICk7Cgo9Y3V0CgpzdWIgU3RhdHNVcGRhdGUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoVXNlcklEKSkgewogICAgICAgIGlmICggISRQYXJhbXskTmVlZGVkfSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAiZXJyb3IiLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5lZWQgJE5lZWRlZC4iLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgZGVjbGFyYXRpb24gb2YgdGhlIGhhc2gKICAgIG15ICVTdGF0WE1MOwoKICAgICMgY2hlY2sgbmVjZXNzYXJ5IGRhdGEKICAgIGlmICggISRQYXJhbXtTdGF0SUR9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnTmVlZCBTdGF0SUQhJwogICAgICAgICk7CiAgICB9CgogICAgIyByZXF1ZXN0aW5nIHN0YXRzIHJlZmVyZW5jZQogICAgbXkgJFN0YXRPbGQgPSAkU2VsZi0+U3RhdHNHZXQoIFN0YXRJRCA9PiAkUGFyYW17U3RhdElEfSApOwogICAgaWYgKCAhJFN0YXRPbGQgKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgPT4KICAgICAgICAgICAgICAgICJDYW4ndCBnZXQgc3RhdHMsIHBlcmhhcHMgeW91IGhhdmUgYW4gaW52YWxpZCBzdGF0cyBpZCEgKFN0YXRzSUQgPT4gJFBhcmFte1N0YXRJRH0pIgogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgZGVjbGFyZSB2YXJpYWJsZQogICAgbXkgJFN0YXROZXcgPSAkUGFyYW17SGFzaH07CgogICAgIyBhIGRlbGV0ZSBmdW5jdGlvbiBjYW4gYmUgdGhlIGJldHRlciBzb2x1dGlvbgogICAgZm9yIG15ICRLZXkgKHF3KFVzZUFzWHZhbHVlIFVzZUFzVmFsdWVTZXJpZXMgVXNlQXNSZXN0cmljdGlvbikpIHsKICAgICAgICBmb3IgKCBAeyAkU3RhdE9sZC0+eyRLZXl9IH0gKSB7CiAgICAgICAgICAgIGlmICggISRfLT57U2VsZWN0ZWR9ICkgewogICAgICAgICAgICAgICAgJF8gPSB1bmRlZjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAjIGFkb3B0IGNoYW5nZXMKICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICV7JFN0YXROZXd9ICkgewogICAgICAgICRTdGF0T2xkLT57JEtleX0gPSAkU3RhdE5ldy0+eyRLZXl9OwogICAgfQoKICAgIEtFWToKICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICV7JFN0YXRPbGR9ICkgewoKICAgICAgICAjIERvbid0IHN0b3JlIHRoZSBiZWhhdmlvdXIgZGF0YQogICAgICAgIG5leHQgS0VZIGlmICRLZXkgZXEgJ09iamVjdEJlaGF2aW91cnMnOwoKICAgICAgICBpZiAoICRLZXkgZXEgJ1VzZUFzWHZhbHVlJyB8fCAkS2V5IGVxICdVc2VBc1ZhbHVlU2VyaWVzJyB8fCAkS2V5IGVxICdVc2VBc1Jlc3RyaWN0aW9uJyApIHsKICAgICAgICAgICAgbXkgJEluZGV4ID0gMDsKICAgICAgICAgICAgUkVGOgogICAgICAgICAgICBmb3IgbXkgJFJlZiAoIEB7ICRTdGF0T2xkLT57JEtleX0gfSApIHsKICAgICAgICAgICAgICAgIG5leHQgUkVGIGlmICEkUmVmOwoKICAgICAgICAgICAgICAgICRJbmRleCsrOwogICAgICAgICAgICAgICAgJFN0YXRYTUx7JEtleX0tPlskSW5kZXhdLT57RWxlbWVudH0gPSAkUmVmLT57RWxlbWVudH07CiAgICAgICAgICAgICAgICAkU3RhdFhNTHskS2V5fS0+WyRJbmRleF0tPntGaXhlZH0gICA9ICRSZWYtPntGaXhlZH07CiAgICAgICAgICAgICAgICBteSAkU3ViSW5kZXggPSAwOwogICAgICAgICAgICAgICAgZm9yIG15ICRWYWx1ZSAoIEB7ICRSZWYtPntTZWxlY3RlZFZhbHVlc30gfSApIHsKICAgICAgICAgICAgICAgICAgICAkU3ViSW5kZXgrKzsKICAgICAgICAgICAgICAgICAgICAkU3RhdFhNTHskS2V5fS0+WyRJbmRleF0tPntTZWxlY3RlZFZhbHVlc30tPlskU3ViSW5kZXhdLT57Q29udGVudH0gPSAkVmFsdWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBzdGV0dGluZyBmb3Igd29ya2luZyB3aXRoIHRpbWUgZWxlbWVudHMKICAgICAgICAgICAgICAgIGZvciAocXcoVGltZVN0b3AgVGltZVN0YXJ0IFRpbWVSZWxhdGl2ZVVuaXQgVGltZVJlbGF0aXZlQ291bnQgVGltZVJlbGF0aXZlVXBjb21pbmdDb3VudCBUaW1lU2NhbGVDb3VudCkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCBkZWZpbmVkICRSZWYtPnskX30gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRTdGF0WE1MeyRLZXl9LT5bJEluZGV4XS0+eyRffSA9ICRSZWYtPnskX307CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2lmICggcmVmICRTdGF0T2xkLT57JEtleX0gZXEgJ0FSUkFZJyApIHsKICAgICAgICAgICAgZm9yIG15ICRJbmRleCAoIDAgLi4gJCN7ICRTdGF0T2xkLT57JEtleX0gfSApIHsKICAgICAgICAgICAgICAgICRTdGF0WE1MeyRLZXl9LT5bJEluZGV4XS0+e0NvbnRlbnR9ID0gJFN0YXRPbGQtPnskS2V5fS0+WyRJbmRleF07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmICggZGVmaW5lZCAkU3RhdE9sZC0+eyRLZXl9ICkgewogICAgICAgICAgICAgICAgJFN0YXRYTUx7JEtleX0tPlsxXS0+e0NvbnRlbnR9ID0gJFN0YXRPbGQtPnskS2V5fTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCB0aW1lIG9iamVjdAogICAgbXkgJFRpbWVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGltZScpOwoKICAgICMgbWV0YSB0YWdzCiAgICBteSAkVGltZVN0YW1wID0gJFRpbWVPYmplY3QtPlN5c3RlbVRpbWUyVGltZVN0YW1wKAogICAgICAgIFN5c3RlbVRpbWUgPT4gJFRpbWVPYmplY3QtPlN5c3RlbVRpbWUoKSwKICAgICk7CiAgICAkU3RhdFhNTHtDaGFuZ2VkfS0+WzFdLT57Q29udGVudH0gICA9ICRUaW1lU3RhbXA7CiAgICAkU3RhdFhNTHtDaGFuZ2VkQnl9LT5bMV0tPntDb250ZW50fSA9ICRQYXJhbXtVc2VySUR9OwoKICAgICMgZ2V0IHhtbCBvYmplY3QKICAgIG15ICRYTUxPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6WE1MJyk7CgogICAgIyBwbGVhc2UgZG9uJ3QgY2hhbmdlIHRoZSBmdW5jdGlvbmFsaXR5IG9mIFhNTEhhc2hEZWxldGUgYW5kIFhNTEhhc2hBZGQKICAgICMgaW50byB0aGUgbmV3IGZ1bmN0aW9uIFhNTEhhc2hVcGRhdGUsIHRoZXJlIGlzIGFuIGluY29tcGF0aWJpbGl0eS4KICAgICMgUGVyaGFwcyB0aGVyZSBhcmUgaW50cmljYWNpZXMgYmVjYXVzZSBvZiB0aGUgJ0FycmF5WzBdID0gdW5kZWYnIGRlZmluaXRpb24KCiAgICAjIGRlbGV0ZSB0aGUgb2xkIHJlY29yZAogICAgbXkgJFN1Y2Nlc3MgPSAkWE1MT2JqZWN0LT5YTUxIYXNoRGVsZXRlKAogICAgICAgIFR5cGUgPT4gJ1N0YXRzJywKICAgICAgICBLZXkgID0+ICRQYXJhbXtTdGF0SUR9LAogICAgKTsKICAgIGlmICggISRTdWNjZXNzICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiQ2FuJ3QgZGVsZXRlIFhNTEhhc2ghIgogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgZGVsZXRlIGNhY2hlCiAgICAkU2VsZi0+X0RlbGV0ZUNhY2hlKCBTdGF0SUQgPT4gJFBhcmFte1N0YXRJRH0gKTsKCiAgICBteSBAQXJyYXkgPSAoCiAgICAgICAgewogICAgICAgICAgICBvdHJzX3N0YXRzID0+IFsgXCVTdGF0WE1MIF0sCiAgICAgICAgfSwKICAgICk7CgogICAgIyBhZGQgdGhlIHJldmlzZWQgcmVjb3JkCiAgICAkU3VjY2VzcyA9ICRYTUxPYmplY3QtPlhNTEhhc2hBZGQoCiAgICAgICAgVHlwZSAgICA9PiAnU3RhdHMnLAogICAgICAgIEtleSAgICAgPT4gJFBhcmFte1N0YXRJRH0sCiAgICAgICAgWE1MSGFzaCA9PiBcQEFycmF5CiAgICApOwogICAgaWYgKCAhJFN1Y2Nlc3MgKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDYW4ndCBhZGQgWE1MSGFzaCEiCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyktPkNsZWFuVXAoCiAgICAgICAgVHlwZSA9PiAnU3RhdHMnLAogICAgKTsKCiAgICByZXR1cm4gMTsKfQoKPWl0ZW0gU3RhdHNEZWxldGUoKQoKZGVsZXRlIGEgc3RhdHMKCiAgICAkU3RhdHNPYmplY3QtPlN0YXRzRGVsZXRlKCBTdGF0SUQgPT4gJzEyMycgKTsKCj1jdXQKCnN1YiBTdGF0c0RlbGV0ZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVjZXNzYXJ5IGRhdGEKICAgIGlmICggISRQYXJhbXtTdGF0SUR9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnTmVlZCBTdGF0SUQhJwogICAgICAgICk7CiAgICB9CgogICAgIyBkZWxldGUgdGhlIHJlY29yZAogICAgbXkgJFN1Y2Nlc3MgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6WE1MJyktPlhNTEhhc2hEZWxldGUoCiAgICAgICAgVHlwZSA9PiAnU3RhdHMnLAogICAgICAgIEtleSAgPT4gJFBhcmFte1N0YXRJRH0sCiAgICApOwoKICAgICMgZXJyb3IgaGFuZGxpbmcKICAgIGlmICggISRTdWNjZXNzICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiQ2FuJ3QgZGVsZXRlIFhNTEhhc2ghIiwKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGRlbGV0ZSBjYWNoZQogICAgJFNlbGYtPl9EZWxldGVDYWNoZSggU3RhdElEID0+ICRQYXJhbXtTdGF0SUR9ICk7CgogICAgIyBnZXQgbWFpbiBvYmplY3QKICAgIG15ICRNYWluT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKTsKCiAgICAjIGdldCBsaXN0IG9mIGluc3RhbGxlZCBzdGF0cyBmaWxlcwogICAgbXkgQFN0YXRzRmlsZUxpc3QgPSAkTWFpbk9iamVjdC0+RGlyZWN0b3J5UmVhZCgKICAgICAgICBEaXJlY3RvcnkgPT4gJFNlbGYtPntTdGF0c1RlbXBEaXJ9LAogICAgICAgIEZpbHRlciAgICA9PiAnKi54bWwuaW5zdGFsbGVkJywKICAgICk7CgogICAgIyBkZWxldGUgdGhlIC5pbnN0YWxsZWQgZmlsZSBpbiB0ZW1wIGRpcgogICAgRklMRToKICAgIGZvciBteSAkRmlsZSAoIHNvcnQgQFN0YXRzRmlsZUxpc3QgKSB7CgogICAgICAgICMgcmVhZCBmaWxlIGNvbnRlbnQKICAgICAgICBteSAkU3RhdHNJRFJlZiA9ICRNYWluT2JqZWN0LT5GaWxlUmVhZCgKICAgICAgICAgICAgTG9jYXRpb24gPT4gJEZpbGUsCiAgICAgICAgKTsKCiAgICAgICAgbmV4dCBGSUxFIGlmICEkU3RhdHNJRFJlZjsKICAgICAgICBuZXh0IEZJTEUgaWYgcmVmICRTdGF0c0lEUmVmIG5lICdTQ0FMQVInOwogICAgICAgIG5leHQgRklMRSBpZiAhJHskU3RhdHNJRFJlZn07CgogICAgICAgIG5leHQgRklMRSBpZiAkeyRTdGF0c0lEUmVmfSBuZSAkUGFyYW17U3RhdElEfTsKCiAgICAgICAgIyBkZWxldGUgLmluc3RhbGxlZCBmaWxlCiAgICAgICAgJE1haW5PYmplY3QtPkZpbGVEZWxldGUoCiAgICAgICAgICAgIExvY2F0aW9uID0+ICRGaWxlLAogICAgICAgICk7CiAgICB9CgogICAgIyBhZGQgbG9nIG1lc3NhZ2UKICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgIFByaW9yaXR5ID0+ICdub3RpY2UnLAogICAgICAgIE1lc3NhZ2UgID0+ICJEZWxldGUgc3RhdHMgKFN0YXRzSUQgPSAkUGFyYW17U3RhdElEfSkiLAogICAgKTsKCiAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKS0+Q2xlYW5VcCgKICAgICAgICBUeXBlID0+ICdTdGF0cycsCiAgICApOwoKICAgIHJldHVybiAxOwp9Cgo9aXRlbSBTdGF0c0xpc3RHZXQoKQoKZmV0Y2hlcyBhbGwgc3RhdGlzdGljcyB0aGF0IHRoZSBjdXJyZW50IHVzZXIgbWF5IHNlZQoKICAgIG15ICRTdGF0c1JlZiA9ICRTdGF0c09iamVjdC0+U3RhdHNMaXN0R2V0KAogICAgICAgIEFjY2Vzc1J3ID0+IDEsICMgT3B0aW9uYWwsIGluZGljYXRlcyB0aGF0IHVzZXIgbWF5IHNlZSBhbGwgc3RhdGlzdGljcwogICAgICAgIFVzZXJJRCAgID0+ICRVc2VySUQsCiAgICApOwoKICAgIFJldHVybnMKCiAgICB7CiAgICAgICAgNiA9PiB7CiAgICAgICAgICAgIFRpdGxlID0+ICJUaXRsZSBvZiBzdGF0IiwKICAgICAgICAgICAgLi4uCiAgICAgICAgfQogICAgfQoKPWN1dAoKc3ViIFN0YXRzTGlzdEdldCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIGZvciBteSAkTmVlZGVkIChxdyhVc2VySUQpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICJlcnJvciIsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkTmVlZGVkLiIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgbXkgQFNlYXJjaFJlc3VsdDsKCiAgICAjIGdldCBjYWNoZSBvYmplY3QKICAgIG15ICRDYWNoZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpOwoKICAgICMgT25seSBjYWNoZSB0aGUgWE1MIHNlYXJjaCBhcyB3ZSBuZWVkIHRvIGZpbHRlciBiYXNlZCBvbiB1c2VyIHBlcm1pc3Npb25zIGxhdGVyCiAgICBteSAkQ2FjaGVLZXkgPSAnU3RhdHNMaXN0R2V0OjpYTUxTZWFyY2gnOwogICAgbXkgJENhY2hlICAgID0gJENhY2hlT2JqZWN0LT5HZXQoCiAgICAgICAgVHlwZSA9PiAnU3RhdHMnLAogICAgICAgIEtleSAgPT4gJENhY2hlS2V5LAoKICAgICAgICAjIERvbid0IHN0b3JlIGNvbXBsZXggc3RydWN0dXJlIGluIG1lbW9yeSBhcyBpdCB3aWxsIGJlIG1vZGlmaWVkIGxhdGVyLgogICAgICAgIENhY2hlSW5NZW1vcnkgPT4gMCwKICAgICk7CgogICAgIyBEbyB3ZSBoYXZlIGEgY2FjaGUgYXZhaWxhYmxlPwogICAgaWYgKCByZWYgJENhY2hlIGVxICdBUlJBWScgKSB7CiAgICAgICAgQFNlYXJjaFJlc3VsdCA9IEB7JENhY2hlfTsKICAgIH0KICAgIGVsc2UgewoKICAgICAgICAjIGdldCB4bWwgb2JqZWN0CiAgICAgICAgbXkgJFhNTE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpYTUwnKTsKCiAgICAgICAgIyBObyBjYWNoZS4gSXMgdGhlcmUgc3RhdHMgZGF0YSB5ZXQ/CiAgICAgICAgaWYgKCAhKCBAU2VhcmNoUmVzdWx0ID0gJFhNTE9iamVjdC0+WE1MSGFzaFNlYXJjaCggVHlwZSA9PiAnU3RhdHMnICkgKSApIHsKCiAgICAgICAgICAgICMgSW1wb3J0IHNhbXBsZSBzdGF0cwogICAgICAgICAgICAkU2VsZi0+X0F1dG9tYXRpY1NhbXBsZUltcG9ydCgKICAgICAgICAgICAgICAgIFVzZXJJRCA9PiAkUGFyYW17VXNlcklEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgTG9hZCBzdGF0cyBhZ2FpbgogICAgICAgICAgICByZXR1cm4gaWYgISggQFNlYXJjaFJlc3VsdCA9ICRYTUxPYmplY3QtPlhNTEhhc2hTZWFyY2goIFR5cGUgPT4gJ1N0YXRzJyApICk7CiAgICAgICAgfQogICAgICAgICRDYWNoZU9iamVjdC0+U2V0KAogICAgICAgICAgICBUeXBlICA9PiAnU3RhdHMnLAogICAgICAgICAgICBLZXkgICA9PiAkQ2FjaGVLZXksCiAgICAgICAgICAgIFZhbHVlID0+IFxAU2VhcmNoUmVzdWx0LAogICAgICAgICAgICBUVEwgICA9PiAyNCAqIDYwICogNjAsCgogICAgICAgICAgICAjIERvbid0IHN0b3JlIGNvbXBsZXggc3RydWN0dXJlIGluIG1lbW9yeSBhcyBpdCB3aWxsIGJlIG1vZGlmaWVkIGxhdGVyLgogICAgICAgICAgICBDYWNoZUluTWVtb3J5ID0+IDAsCiAgICAgICAgKTsKCiAgICB9CgogICAgIyBnZXQgdXNlciBncm91cHMKICAgIG15ICVHcm91cExpc3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6R3JvdXAnKS0+UGVybWlzc2lvblVzZXJHZXQoCiAgICAgICAgVXNlcklEID0+ICRQYXJhbXtVc2VySUR9LAogICAgICAgIFR5cGUgICA9PiAncm8nLAogICAgKTsKCiAgICBteSAlUmVzdWx0OwoKICAgIGZvciBteSAkU3RhdElEIChAU2VhcmNoUmVzdWx0KSB7CgogICAgICAgIG15ICRTdGF0ID0gJFNlbGYtPlN0YXRzR2V0KAogICAgICAgICAgICBTdGF0SUQgICAgICAgICAgICAgPT4gJFN0YXRJRCwKICAgICAgICAgICAgTm9PYmplY3RBdHRyaWJ1dGVzID0+IDEsCiAgICAgICAgKTsKCiAgICAgICAgbXkgJFVzZXJQZXJtaXNzaW9uID0gMDsKICAgICAgICBpZiAoICRQYXJhbXtBY2Nlc3NSd30gfHwgJFBhcmFte1VzZXJJRH0gPT0gMSApIHsKCiAgICAgICAgICAgICRVc2VyUGVybWlzc2lvbiA9IDE7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJFN0YXQtPntWYWxpZH0gKSB7CgogICAgICAgICAgICBHUk9VUElEOgogICAgICAgICAgICBmb3IgbXkgJEdyb3VwSUQgKCBAeyAkU3RhdC0+e1Blcm1pc3Npb259IH0gKSB7CgogICAgICAgICAgICAgICAgbmV4dCBHUk9VUElEIGlmICEkR3JvdXBJRDsKICAgICAgICAgICAgICAgIG5leHQgR1JPVVBJRCBpZiAhJEdyb3VwTGlzdHskR3JvdXBJRH07CgogICAgICAgICAgICAgICAgJFVzZXJQZXJtaXNzaW9uID0gMTsKCiAgICAgICAgICAgICAgICBsYXN0IEdST1VQSUQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICggJFVzZXJQZXJtaXNzaW9uID09IDEgKSB7CiAgICAgICAgICAgICRSZXN1bHR7JFN0YXRJRH0gPSAkU3RhdDsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIFwlUmVzdWx0Owp9Cgo9aXRlbSBHZXRTdGF0c0xpc3QoKQoKbGlzdHMgYWxsIHN0YXRzIGlkJ3MKCiAgICBteSAkQXJyYXlSZWYgPSAkU3RhdHNPYmplY3QtPkdldFN0YXRzTGlzdCgKICAgICAgICBBY2Nlc3NSdyAgPT4gMSwgIyBPcHRpb25hbCwgaW5kaWNhdGVzIHRoYXQgdXNlciBtYXkgc2VlIGFsbCBzdGF0aXN0aWNzCiAgICAgICAgT3JkZXJCeSAgID0+ICdJRCcgfHwgJ1RpdGxlJyB8fCAnT2JqZWN0JywgIyBvcHRpb25hbAogICAgICAgIERpcmVjdGlvbiA9PiAnQVNDJyB8fCAnREVTQycsICAgICAgICAgICAgICMgb3B0aW9uYWwKICAgICAgICBVc2VySUQgICAgPT4gJFVzZXJJRCwKICAgICk7Cgo9Y3V0CgpzdWIgR2V0U3RhdHNMaXN0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgZm9yIG15ICROZWVkZWQgKHF3KFVzZXJJRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gImVycm9yIiwKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQuIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAkUGFyYW17T3JkZXJCeX0gICB8fD0gJ0lEJzsKICAgICRQYXJhbXtEaXJlY3Rpb259IHx8PSAnQVNDJzsKCiAgICBteSAlUmVzdWx0SGFzaCA9ICV7ICRTZWxmLT5TdGF0c0xpc3RHZXQoJVBhcmFtKSB8fCB7fSB9OwoKICAgIG15IEBTb3J0QXJyYXk7CgogICAgaWYgKCAkUGFyYW17T3JkZXJCeX0gZXEgJ0lEJyApIHsKICAgICAgICBAU29ydEFycmF5ID0gc29ydCB7ICRhIDw9PiAkYiB9IGtleXMgJVJlc3VsdEhhc2g7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBAU29ydEFycmF5ID0gc29ydCB7ICRSZXN1bHRIYXNoeyRhfS0+eyAkUGFyYW17T3JkZXJCeX0gfSBjbXAgJFJlc3VsdEhhc2h7JGJ9LT57ICRQYXJhbXtPcmRlckJ5fSB9IH0KICAgICAgICAgICAga2V5cyAlUmVzdWx0SGFzaDsKICAgIH0KICAgIGlmICggJFBhcmFte0RpcmVjdGlvbn0gZXEgJ0RFU0MnICkgewogICAgICAgIEBTb3J0QXJyYXkgPSByZXZlcnNlIEBTb3J0QXJyYXk7CiAgICB9CgogICAgcmV0dXJuIFxAU29ydEFycmF5Owp9Cgo9aXRlbSBTdW1CdWlsZCgpCgpidWlsZCBzdW0gaW4geCBvci9hbmQgeSBheGlzCgogICAgJFN0YXRBcnJheSA9ICRTdGF0c09iamVjdC0+U3VtQnVpbGQoCiAgICAgICAgQXJyYXkgID0+IFxAUmVzdWx0LAogICAgICAgIFN1bVJvdyA9PiAxLAogICAgICAgIFN1bUNvbCA9PiAwLAogICAgKTsKCj1jdXQKCnN1YiBTdW1CdWlsZCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15IEBEYXRhID0gQHsgJFBhcmFte0FycmF5fSB9OwoKICAgICMgYWRkIHN1bSB5CiAgICBpZiAoICRQYXJhbXtTdW1Sb3d9ICkgewoKICAgICAgICBwdXNoIEB7ICREYXRhWzFdIH0sICdTdW0nOwoKICAgICAgICBmb3IgbXkgJEluZGV4MSAoIDIgLi4gJCNEYXRhICkgewoKICAgICAgICAgICAgbXkgJFN1bSA9IDA7CiAgICAgICAgICAgIElOREVYMjoKICAgICAgICAgICAgZm9yIG15ICRJbmRleDIgKCAxIC4uICQjeyAkRGF0YVskSW5kZXgxXSB9ICkgewoKICAgICAgICAgICAgICAgIG5leHQgSU5ERVgyIGlmICEkRGF0YVskSW5kZXgxXVskSW5kZXgyXTsKCiAgICAgICAgICAgICAgICAjIGV4dHJhY3QgdGhlIHZhbHVlCiAgICAgICAgICAgICAgICBteSAkVmFsdWUgPSAkRGF0YVskSW5kZXgxXVskSW5kZXgyXTsKCiAgICAgICAgICAgICAgICAjIGNsZWFuIHRoZSBzdHJpbmcKICAgICAgICAgICAgICAgICRWYWx1ZSA9fiBzeyBcQSBccysgfXt9eG1zOwogICAgICAgICAgICAgICAgJFZhbHVlID1+IHN7IFxzKyBceiB9e314bXM7CiAgICAgICAgICAgICAgICAkVmFsdWUgPX4gc3sgLCB9ey59eG1zOwoKICAgICAgICAgICAgICAgICMgYWRkIHZhbHVlIHRvIHN1bW1hcnkKICAgICAgICAgICAgICAgIGlmICggJFZhbHVlID1+IG17Xi0/XGQrKFwuXGQrKT8kfSApIHsKICAgICAgICAgICAgICAgICAgICAkU3VtICs9ICRWYWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVzaCBAeyAkRGF0YVskSW5kZXgxXSB9LCAkU3VtOwogICAgICAgIH0KICAgIH0KCiAgICAjIGFkZCBzdW0geAogICAgaWYgKCAkUGFyYW17U3VtQ29sfSApIHsKCiAgICAgICAgbXkgQFN1bVJvdyA9ICgpOwogICAgICAgICRTdW1Sb3dbMF0gPSAnU3VtJzsKCiAgICAgICAgZm9yIG15ICRJbmRleDEgKCAyIC4uICQjRGF0YSApIHsKCiAgICAgICAgICAgIElOREVYMjoKICAgICAgICAgICAgZm9yIG15ICRJbmRleDIgKCAxIC4uICQjeyAkRGF0YVskSW5kZXgxXSB9ICkgewoKICAgICAgICAgICAgICAgICMgbWFrZSBzdXJlIHdlIGhhdmUgYSB2YWx1ZSB0byBhZGQKICAgICAgICAgICAgICAgIGlmICggIWRlZmluZWQgJERhdGFbJEluZGV4MV1bJEluZGV4Ml0gKSB7CiAgICAgICAgICAgICAgICAgICAgJERhdGFbJEluZGV4MV1bJEluZGV4Ml0gPSAwOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgZXh0cmFjdCB0aGUgdmFsdWUKICAgICAgICAgICAgICAgIG15ICRWYWx1ZSA9ICREYXRhWyRJbmRleDFdWyRJbmRleDJdOwoKICAgICAgICAgICAgICAgICMgY2xlYW4gdGhlIHN0cmluZwogICAgICAgICAgICAgICAgJFZhbHVlID1+IHN7IFxBIFxzKyB9e314bXM7CiAgICAgICAgICAgICAgICAkVmFsdWUgPX4gc3sgXHMrIFx6IH17fXhtczsKICAgICAgICAgICAgICAgICRWYWx1ZSA9fiBzeyAsIH17Ln14bXM7CgogICAgICAgICAgICAgICAgIyBhZGQgdmFsdWUgdG8gc3VtbWFyeQogICAgICAgICAgICAgICAgaWYgKCAkVmFsdWUgPX4gbXteLT9cZCsoXC5cZCspPyR9ICkgewogICAgICAgICAgICAgICAgICAgICRTdW1Sb3dbJEluZGV4Ml0gKz0gJFZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdXNoIEBEYXRhLCBcQFN1bVJvdzsKICAgIH0KICAgIHJldHVybiBcQERhdGE7Cn0KCj1pdGVtIEdldFN0YXRzT2JqZWN0QXR0cmlidXRlcygpCgpHZXQgYWxsIGF0dHJpYnV0ZXMgZnJvbSB0aGUgb2JqZWN0IGluIGRlcGVuZGVuY2Ugb2YgdGhlIHVzZQoKICAgIG15ICVPYmplY3RBdHRyaWJ1dGVzID0gJFN0YXRzT2JqZWN0LT5HZXRTdGF0c09iamVjdEF0dHJpYnV0ZXMoCiAgICAgICAgT2JqZWN0TW9kdWxlID0+ICdUaWNrZXQnLAogICAgICAgIFVzZSAgICAgICAgICA9PiAnVXNlQXNYdmFsdWUnIHx8ICdVc2VBc1ZhbHVlU2VyaWVzJyB8fCAnVXNlQXNSZXN0cmljdGlvbicsCiAgICApOwoKPWN1dAoKc3ViIEdldFN0YXRzT2JqZWN0QXR0cmlidXRlcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHBhcmFtcwogICAgZm9yIChxdyhPYmplY3RNb2R1bGUgVXNlKSkgewogICAgICAgIGlmICggISRQYXJhbXskX30gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICRfISIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjIGxvYWQgbW9kdWxlCiAgICBteSAkT2JqZWN0TW9kdWxlID0gJFBhcmFte09iamVjdE1vZHVsZX07CiAgICByZXR1cm4gaWYgISRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyktPlJlcXVpcmUoJE9iamVjdE1vZHVsZSk7CiAgICBteSAkU3RhdE9iamVjdCA9ICRPYmplY3RNb2R1bGUtPm5ldyggJXskU2VsZn0gKTsKICAgIHJldHVybiBpZiAhJFN0YXRPYmplY3Q7CgogICAgIyBsb2FkIGF0dHJpYnV0ZXMKICAgIG15IEBPYmplY3RBdHRyaWJ1dGVzUmF3ID0gJFN0YXRPYmplY3QtPkdldE9iamVjdEF0dHJpYnV0ZXMoKTsKCiAgICAjIGJ1aWxkIHRoZSBvYmplY3RhdHRyaWJ1dGUgYXJyYXkKICAgIG15IEBPYmplY3RBdHRyaWJ1dGVzOwogICAgZm9yIG15ICRIYXNoUmVmIChAT2JqZWN0QXR0cmlidXRlc1JhdykgewogICAgICAgIGlmICggJEhhc2hSZWYtPnsgJFBhcmFte1VzZX0gfSApIHsKICAgICAgICAgICAgZGVsZXRlICRIYXNoUmVmLT57VXNlQXNYdmFsdWV9OwogICAgICAgICAgICBkZWxldGUgJEhhc2hSZWYtPntVc2VBc1ZhbHVlU2VyaWVzfTsKICAgICAgICAgICAgZGVsZXRlICRIYXNoUmVmLT57VXNlQXNSZXN0cmljdGlvbn07CgogICAgICAgICAgICBwdXNoIEBPYmplY3RBdHRyaWJ1dGVzLCAkSGFzaFJlZjsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIEBPYmplY3RBdHRyaWJ1dGVzOwp9Cgo9aXRlbSBHZXRTdGF0aWNGaWxlcygpCgpHZXQgYWxsIHN0YXRpYyBmaWxlcwoKICAgIG15ICRGaWxlSGFzaCA9ICRTdGF0c09iamVjdC0+R2V0U3RhdGljRmlsZXMoCiAgICAgICAgT25seVVudXNlZEZpbGVzID0+IDEgfCAwLCAjIG9wdGlvbmFsIGRlZmF1bHQgMAogICAgICAgIFVzZXJJRCA9PiAkVXNlcklELAogICAgKTsKCj1jdXQKCnN1YiBHZXRTdGF0aWNGaWxlcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIGZvciBteSAkTmVlZGVkIChxdyhVc2VySUQpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICJlcnJvciIsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkTmVlZGVkLiIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgbXkgJERpcmVjdG9yeSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnSG9tZScpOwogICAgaWYgKCAkRGlyZWN0b3J5ICF+IG17Xi4qXC8kfXggKSB7CiAgICAgICAgJERpcmVjdG9yeSAuPSAnLyc7CiAgICB9CiAgICAkRGlyZWN0b3J5IC49ICdLZXJuZWwvU3lzdGVtL1N0YXRzL1N0YXRpYy8nOwoKICAgIGlmICggIW9wZW5kaXIoIERJUiwgJERpcmVjdG9yeSApICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiQ2FuIG5vdCBvcGVuIERpcmVjdG9yeTogJERpcmVjdG9yeSIsCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gKCk7CiAgICB9CgogICAgbXkgJVN0YXRpY0ZpbGVzOwogICAgaWYgKCAkUGFyYW17T25seVVudXNlZEZpbGVzfSApIHsKCiAgICAgICAgIyBnZXQgYWxsIFN0YXRzIGZyb20gdGhlIGRiCiAgICAgICAgbXkgJFJlc3VsdCA9ICRTZWxmLT5HZXRTdGF0c0xpc3QoCiAgICAgICAgICAgIFVzZXJJRCA9PiAkUGFyYW17VXNlcklEfSwKICAgICAgICApOwoKICAgICAgICBpZiAoIGRlZmluZWQgJFJlc3VsdCApIHsKICAgICAgICAgICAgZm9yIG15ICRTdGF0SUQgKCBAeyRSZXN1bHR9ICkgewogICAgICAgICAgICAgICAgbXkgJERhdGEgPSAkU2VsZi0+U3RhdHNHZXQoCiAgICAgICAgICAgICAgICAgICAgU3RhdElEICAgICAgICAgICAgID0+ICRTdGF0SUQsCiAgICAgICAgICAgICAgICAgICAgVXNlcklEICAgICAgICAgICAgID0+ICRQYXJhbXtVc2VySUR9LAogICAgICAgICAgICAgICAgICAgIE5vT2JqZWN0QXR0cmlidXRlcyA9PiAxLAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAjIGNoZWNrIHdpdGNoIG9uZSBhcmUgc3RhdGljIHN0YXRpc3RpY3MKICAgICAgICAgICAgICAgIGlmICggJERhdGEtPntGaWxlfSAmJiAkRGF0YS0+e1N0YXRUeXBlfSBlcSAnc3RhdGljJyApIHsKICAgICAgICAgICAgICAgICAgICAkU3RhdGljRmlsZXN7ICREYXRhLT57RmlsZX0gfSA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyByZWFkIGZpbGVzCiAgICBteSAlRmlsZWxpc3Q7CgogICAgRElSRUNUT1JZOgogICAgd2hpbGUgKCBkZWZpbmVkKCBteSAkRmlsZW5hbWUgPSByZWFkZGlyIERJUiApICkgewogICAgICAgIG5leHQgRElSRUNUT1JZIGlmICRGaWxlbmFtZSBlcSAnLic7CiAgICAgICAgbmV4dCBESVJFQ1RPUlkgaWYgJEZpbGVuYW1lIGVxICcuLic7CiAgICAgICAgaWYgKCAkRmlsZW5hbWUgPX4gbXteKC4qKVwucG0kfXggKSB7CiAgICAgICAgICAgIGlmICggIWRlZmluZWQgJFN0YXRpY0ZpbGVzeyQxfSApIHsKICAgICAgICAgICAgICAgICRGaWxlbGlzdHskMX0gPSAkMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGNsb3NlZGlyKERJUik7CgogICAgIyBLSVhDb3JlLWNhcGVJVAogICAgbXkgJEhvbWUgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ0hvbWUnKTsKICAgIGlmICggJEhvbWUgIX4gbXteLipcLyR9eCApIHsKICAgICAgICAkSG9tZSAuPSAnLyc7CiAgICB9CiAgICBteSBAS0lYUGFja2FnZXMgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6S0lYVXRpbHMnKS0+R2V0UmVnaXN0ZXJlZEN1c3RvbVBhY2thZ2VzKCBSZXN1bHQgPT4gJ0FSUkFZJyApOwogICAgZm9yIG15ICRDdXJyUHJlZml4IChAS0lYUGFja2FnZXMpIHsKICAgICAgICAkRGlyZWN0b3J5ID0gJEhvbWUgLiAkQ3VyclByZWZpeCAuICcvS2VybmVsL1N5c3RlbS9TdGF0cy9TdGF0aWMvJzsKICAgICAgICBuZXh0IGlmICFvcGVuZGlyKCBESVIsICREaXJlY3RvcnkgKTsKCiAgICAgICAgIyByZWFkIGZpbGVzCiAgICAgICAgd2hpbGUgKCBkZWZpbmVkKCBteSAkRmlsZW5hbWUgPSByZWFkZGlyIERJUiApICkgewogICAgICAgICAgICBuZXh0IGlmICRGaWxlbmFtZSBlcSAnLic7CiAgICAgICAgICAgIG5leHQgaWYgJEZpbGVuYW1lIGVxICcuLic7CiAgICAgICAgICAgIG5leHQgaWYgJEZpbGVuYW1lICF+IG17XiguKilcLnBtJH14OwogICAgICAgICAgICBuZXh0IGlmIGRlZmluZWQgJFN0YXRpY0ZpbGVzeyQxfTsKCiAgICAgICAgICAgICRGaWxlbGlzdHskMX0gPSAkMTsKICAgICAgICB9CiAgICAgICAgY2xvc2VkaXIoRElSKTsKICAgIH0KCiAgICAjIEVPIEtJWENvcmUtY2FwZUlUCgogICAgcmV0dXJuIFwlRmlsZWxpc3Q7Cn0KCj1pdGVtIEdldER5bmFtaWNGaWxlcygpCgpHZXQgYWxsIHN0YXRpYyBvYmplY3RzCgogICAgbXkgJEZpbGVIYXNoID0gJFN0YXRzT2JqZWN0LT5HZXREeW5hbWljRmlsZXMoKTsKCj1jdXQKCnN1YiBHZXREeW5hbWljRmlsZXMgewogICAgbXkgJFNlbGYgPSBzaGlmdDsKCiAgICAjIGdldCBjb25maWcgb2JqZWN0CiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICBteSAlRmlsZWxpc3QgPSAleyAkQ29uZmlnT2JqZWN0LT5HZXQoJ1N0YXRzOjpEeW5hbWljT2JqZWN0UmVnaXN0cmF0aW9uJykgfTsKICAgIE9CSkVDVDoKICAgIGZvciBteSAkT2JqZWN0ICggc29ydCBrZXlzICVGaWxlbGlzdCApIHsKICAgICAgICBpZiAoICEkRmlsZWxpc3R7JE9iamVjdH0gKSB7CiAgICAgICAgICAgIGRlbGV0ZSAkRmlsZWxpc3R7JE9iamVjdH07CiAgICAgICAgICAgIG5leHQgT0JKRUNUOwogICAgICAgIH0KICAgICAgICAkRmlsZWxpc3R7JE9iamVjdH0gPSAkU2VsZi0+R2V0T2JqZWN0TmFtZSgKICAgICAgICAgICAgT2JqZWN0TW9kdWxlID0+ICRGaWxlbGlzdHskT2JqZWN0fXtNb2R1bGV9LAogICAgICAgICk7CiAgICB9CiAgICByZXR1cm4gaWYgISVGaWxlbGlzdDsKCiAgICByZXR1cm4gXCVGaWxlbGlzdDsKfQoKPWl0ZW0gR2V0T2JqZWN0TmFtZSgpCgpHZXQgdGhlIG5hbWUgb2YgYSBkeW5hbWljIG9iamVjdAoKICAgIG15ICRPYmplY3ROYW1lID0gJFN0YXRzT2JqZWN0LT5HZXRPYmplY3ROYW1lKAogICAgICAgIE9iamVjdE1vZHVsZSA9PiAnS2VybmVsOjpTeXN0ZW06OlN0YXRzOjpEeW5hbWljOjpUaWNrZXRMaXN0JywKICAgICk7Cgo9Y3V0CgpzdWIgR2V0T2JqZWN0TmFtZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwogICAgbXkgJE1vZHVsZSA9ICRQYXJhbXtPYmplY3RNb2R1bGV9OwoKICAgICMgY2hlY2sgaWYgaXQgaXMgY2FjaGVkCiAgICByZXR1cm4gJFNlbGYtPnsnQ2FjaGU6Ok9iamVjdE5hbWUnfS0+eyRNb2R1bGV9IGlmICRTZWxmLT57J0NhY2hlOjpPYmplY3ROYW1lJ30tPnskTW9kdWxlfTsKCiAgICAjIGxvYWQgbW9kdWxlLCByZXR1cm4gaWYgbW9kdWxlIGRvZXMgbm90IGV4aXN0CiAgICAjICh0aGlzIGlzIGltcG9ydGFudCB3aGVuIHN0YXRzIGFyZSB1bmluc3RhbGxlZCwgc2VlIGFsc28gYnVnIyA0MjY5KQogICAgcmV0dXJuIGlmICEkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpLT5SZXF1aXJlKCRNb2R1bGUpOwoKICAgICMgZ2V0IG5hbWUKICAgIG15ICRTdGF0T2JqZWN0ID0gJE1vZHVsZS0+bmV3KCAleyRTZWxmfSApOwogICAgcmV0dXJuIGlmICEkU3RhdE9iamVjdDsKICAgIG15ICROYW1lID0gJFN0YXRPYmplY3QtPkdldE9iamVjdE5hbWUoKTsKCiAgICAjIGNhY2hlIHRoZSByZXN1bHQKICAgICRTZWxmLT57J0NhY2hlOjpPYmplY3ROYW1lJ30tPnskTW9kdWxlfSA9ICROYW1lOwoKICAgIHJldHVybiAkTmFtZTsKfQoKPWl0ZW0gR2V0T2JqZWN0QmVoYXZpb3VycygpCgpnZXQgYmVoYXZpb3VycyB0aGF0IGEgc3RhdGlzdGljIHN1cHBvcnRzCgogICAgbXkgJEJlaGF2aW91cnMgPSAkU3RhdHNPYmplY3QtPkdldE9iamVjdEJlaGF2aW91cnMoCiAgICAgICAgT2JqZWN0TW9kdWxlID0+ICdLZXJuZWw6OlN5c3RlbTo6U3RhdHM6OkR5bmFtaWM6OlRpY2tldExpc3QnLAogICAgKTsKCiAgICByZXR1cm5zCgogICAgewogICAgICAgIFByb3ZpZGVzRGFzaGJvYXJkV2lkZ2V0ID0+IDEsCiAgICAgICAgLi4uCiAgICB9Cgo9Y3V0CgpzdWIgR2V0T2JqZWN0QmVoYXZpb3VycyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwogICAgbXkgJE1vZHVsZSA9ICRQYXJhbXtPYmplY3RNb2R1bGV9OwoKICAgICMgY2hlY2sgaWYgaXQgaXMgY2FjaGVkCiAgICBpZiAoICRTZWxmLT57J0NhY2hlOjpPYmplY3RCZWhhdmlvdXJzJ30tPnskTW9kdWxlfSApIHsKICAgICAgICByZXR1cm4gJFNlbGYtPnsnQ2FjaGU6Ok9iamVjdEJlaGF2aW91cnMnfS0+eyRNb2R1bGV9CiAgICB9CgogICAgIyBsb2FkIG1vZHVsZSwgcmV0dXJuIGlmIG1vZHVsZSBkb2VzIG5vdCBleGlzdAogICAgIyAodGhpcyBpcyBpbXBvcnRhbnQgd2hlbiBzdGF0cyBhcmUgdW5pbnN0YWxsZWQsIHNlZSBhbHNvIGJ1ZyMgNDI2OSkKICAgIHJldHVybiBpZiAhJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKS0+UmVxdWlyZSgkTW9kdWxlKTsKCiAgICBteSAkU3RhdE9iamVjdCA9ICRNb2R1bGUtPm5ldyggJXskU2VsZn0gKTsKICAgIHJldHVybiBpZiAhJFN0YXRPYmplY3Q7CgogICAgcmV0dXJuIGlmICEkU3RhdE9iamVjdC0+Y2FuKCdHZXRPYmplY3RCZWhhdmlvdXJzJyk7CiAgICBteSAlT2JqZWN0QmVoYXZpb3VycyA9ICRTdGF0T2JqZWN0LT5HZXRPYmplY3RCZWhhdmlvdXJzKCk7CgogICAgIyBjYWNoZSB0aGUgcmVzdWx0CiAgICAkU2VsZi0+eydDYWNoZTo6T2JqZWN0QmVoYXZpb3Vycyd9LT57JE1vZHVsZX0gPSBcJU9iamVjdEJlaGF2aW91cnM7CgogICAgcmV0dXJuIFwlT2JqZWN0QmVoYXZpb3VyczsKfQoKPWl0ZW0gT2JqZWN0RmlsZUNoZWNrKCkKCmNoZWNrIHJlYWRhYmxlIG9iamVjdCBmaWxlCgogICAgbXkgJE9iamVjdEZpbGVDaGVjayA9ICRTdGF0c09iamVjdC0+T2JqZWN0RmlsZUNoZWNrKAogICAgICAgIFR5cGUgPT4gJ3N0YXRpYycsCiAgICAgICAgTmFtZSA9PiAnTmV3VGlja2V0cycsCiAgICApOwoKPWN1dAoKc3ViIE9iamVjdEZpbGVDaGVjayB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICREaXJlY3RvcnkgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ0hvbWUnKTsKICAgIGlmICggJERpcmVjdG9yeSAhfiBte14uKlwvJH14ICkgewogICAgICAgICREaXJlY3RvcnkgLj0gJy8nOwogICAgfQogICAgaWYgKCAkUGFyYW17VHlwZX0gZXEgJ3N0YXRpYycgKSB7CiAgICAgICAgJERpcmVjdG9yeSAuPSAnS2VybmVsL1N5c3RlbS9TdGF0cy9TdGF0aWMvJyAuICRQYXJhbXtOYW1lfSAuICcucG0nOwogICAgfQogICAgZWxzaWYgKCAkUGFyYW17VHlwZX0gZXEgJ2R5bmFtaWMnICkgewogICAgICAgICREaXJlY3RvcnkgLj0gJ0tlcm5lbC9TeXN0ZW0vU3RhdHMvRHluYW1pYy8nIC4gJFBhcmFte05hbWV9IC4gJy5wbSc7CiAgICB9CgogICAgcmV0dXJuIDEgaWYgLXIgJERpcmVjdG9yeTsKICAgIHJldHVybjsKfQoKPWl0ZW0gRXhwb3J0KCkKCmdldCBjb250ZW50IGZyb20gc3RhdHMgZm9yIGV4cG9ydAoKICAgIG15ICRFeHBvcnRGaWxlID0gJFN0YXRzT2JqZWN0LT5FeHBvcnQoCiAgICAgICAgU3RhdElEID0+ICcxMjMnLAogICAgICAgIEV4cG9ydFN0YXROdW1iZXIgPT4gMSB8fCAwLCAjIG9wdGlvbmFsLCBvbmx5IHVzZWZ1bCBtb3ZlIHN0YXRpc3RpY3MgZnJvbSB0aGUgdGVzdCBzeXN0ZW0gdG8gdGhlIHByb2R1Y3RpdmUgc3lzdGVtCiAgICApOwoKPWN1dAoKc3ViIEV4cG9ydCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIGlmICggISRQYXJhbXtTdGF0SUR9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnRXhwb3J0OiBOZWVkIFN0YXRJRCEnCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBnZXQgeG1sIG9iamVjdAogICAgbXkgJFhNTE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpYTUwnKTsKCiAgICBteSBAWE1MSGFzaCA9ICRYTUxPYmplY3QtPlhNTEhhc2hHZXQoCiAgICAgICAgVHlwZSA9PiAnU3RhdHMnLAoKICAgICAgICAjQ2FjaGUgPT4gMCwKICAgICAgICBLZXkgPT4gJFBhcmFte1N0YXRJRH0KICAgICk7CiAgICBteSAkU3RhdHNYTUwgPSAkWE1MSGFzaFswXS0+e290cnNfc3RhdHN9LT5bMV07CgogICAgbXkgJUZpbGU7CiAgICAkRmlsZXtGaWxlbmFtZX0gPSAkU2VsZi0+U3RyaW5nQW5kVGltZXN0YW1wMkZpbGVuYW1lKAogICAgICAgIFN0cmluZyA9PiAkU3RhdHNYTUwtPntUaXRsZX0tPlsxXS0+e0NvbnRlbnR9LAogICAgKTsKICAgICRGaWxle0ZpbGVuYW1lfSAuPSAnLnhtbCc7CgogICAgIyBzZXR0aW5ncyBmb3Igc3RhdGljIGZpbGVzCiAgICBpZiAoCiAgICAgICAgJFN0YXRzWE1MLT57U3RhdFR5cGV9LT5bMV0tPntDb250ZW50fQogICAgICAgICYmICRTdGF0c1hNTC0+e1N0YXRUeXBlfS0+WzFdLT57Q29udGVudH0gZXEgJ3N0YXRpYycKICAgICAgICApCiAgICB7CiAgICAgICAgbXkgJEZpbGVMb2NhdGlvbiA9ICRTdGF0c1hNTC0+e09iamVjdE1vZHVsZX0tPlsxXS0+e0NvbnRlbnR9OwogICAgICAgICRGaWxlTG9jYXRpb24gPX4gc3s6On17XC99eGc7CiAgICAgICAgJEZpbGVMb2NhdGlvbiAuPSAnLnBtJzsKICAgICAgICBteSAkRmlsZSAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ0hvbWUnKSAuICIvJEZpbGVMb2NhdGlvbiI7CgogICAgICAgICMgS0lYQ29yZS1jYXBlSVQKICAgICAgICAjIG15ICRGaWxlICAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnSG9tZScpIC4gIi8kRmlsZUxvY2F0aW9uIjsKICAgICAgICAjIG15ICRGaWxlID0gJyc7CiAgICAgICAgbXkgJEtJWEZpbGUgPSAnJzsKICAgICAgICBteSAkSG9tZSAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnSG9tZScpOwogICAgICAgIGlmICggJEhvbWUgIX4gbXteLipcLyR9eCApIHsKICAgICAgICAgICAgJEhvbWUgLj0gJy8nOwogICAgICAgIH0KICAgICAgICBteSBAS0lYUGFja2FnZXMgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6S0lYVXRpbHMnKS0+R2V0UmVnaXN0ZXJlZEN1c3RvbVBhY2thZ2VzKCBSZXN1bHQgPT4gJ0FSUkFZJyApOwogICAgICAgIGZvciBteSAkQ3VyclByZWZpeCAoQEtJWFBhY2thZ2VzKSB7CgogICAgICAgICAgICAjICRGaWxlID0gJEhvbWUgLiAkQ3VyclByZWZpeCAuICcvJyAuICRGaWxlTG9jYXRpb247CiAgICAgICAgICAgICMgaWYgKCAtZSAkRmlsZSApIHsKICAgICAgICAgICAgJEtJWEZpbGUgPSAkSG9tZSAuICRDdXJyUHJlZml4IC4gJy8nIC4gJEZpbGVMb2NhdGlvbjsKICAgICAgICAgICAgaWYgKCAtZSAkS0lYRmlsZSApIHsKICAgICAgICAgICAgICAgICRGaWxlICAgICAgICAgPSAkS0lYRmlsZTsKICAgICAgICAgICAgICAgICRGaWxlTG9jYXRpb24gPSAkQ3VyclByZWZpeCAuICcvJyAuICRGaWxlTG9jYXRpb247CiAgICAgICAgICAgICAgICBsYXN0OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIEVPIEtJWENvcmUtY2FwZUlUCgogICAgICAgIG15ICRGaWxlQ29udGVudCA9ICcnOwoKICAgICAgICBvcGVuIG15ICRGaWxlaGFuZGxlLCAnPCcsICRGaWxlIHx8IGRpZSAiQ2FuJ3Qgb3BlbjogJEZpbGU6ICQhIjsgICAgIyMgbm8gY3JpdGljCgogICAgICAgICMgc2V0IGJpbiBtb2RlCiAgICAgICAgYmlubW9kZSAkRmlsZWhhbmRsZTsKICAgICAgICB3aGlsZSAoPCRGaWxlaGFuZGxlPikgewogICAgICAgICAgICAkRmlsZUNvbnRlbnQgLj0gJF87CiAgICAgICAgfQogICAgICAgIGNsb3NlICRGaWxlaGFuZGxlOwoKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RW5jb2RlJyktPkVuY29kZUlucHV0KCBcJEZpbGVDb250ZW50ICk7CiAgICAgICAgJFN0YXRzWE1MLT57RmlsZX0tPlsxXS0+e0ZpbGV9ICAgICAgID0gJFN0YXRzWE1MLT57RmlsZX0tPlsxXS0+e0NvbnRlbnR9OwogICAgICAgICRTdGF0c1hNTC0+e0ZpbGV9LT5bMV0tPntDb250ZW50fSAgICA9IGVuY29kZV9iYXNlNjQoICRGaWxlQ29udGVudCwgJycgKTsKICAgICAgICAkU3RhdHNYTUwtPntGaWxlfS0+WzFdLT57TG9jYXRpb259ICAgPSAkRmlsZUxvY2F0aW9uOwogICAgICAgICRTdGF0c1hNTC0+e0ZpbGV9LT5bMV0tPntQZXJtaXNzaW9ufSA9ICc2NDQnOwogICAgICAgICRTdGF0c1hNTC0+e0ZpbGV9LT5bMV0tPntFbmNvZGV9ICAgICA9ICdCYXNlNjQnOwogICAgfQoKICAgICMgZGVsZXRlIGNyZWF0ZSBhbmQgY2hhbmdlIGRhdGEKICAgIGZvciBteSAkS2V5IChxdyhDaGFuZ2VkIENoYW5nZWRCeSBDcmVhdGVkIENyZWF0ZWRCeSBTdGF0SUQpKSB7CiAgICAgICAgZGVsZXRlICRTdGF0c1hNTC0+eyRLZXl9OwogICAgfQogICAgaWYgKCAhJFBhcmFte0V4cG9ydFN0YXROdW1iZXJ9ICkgewogICAgICAgIGRlbGV0ZSAkU3RhdHNYTUwtPntTdGF0TnVtYmVyfTsKICAgIH0KCiAgICAjIHdyYXBwZXIgdG8gY2hhbmdlIGlkcyBpbiB1c2VkIHNwZWxsaW5nCiAgICAjIHdyYXAgcGVybWlzc2lvbnMKICAgIFBFUk1JU1NJT046CiAgICBmb3IgbXkgJElEICggQHsgJFN0YXRzWE1MLT57UGVybWlzc2lvbn0gfSApIHsKICAgICAgICBuZXh0IFBFUk1JU1NJT04gaWYgISRJRDsKICAgICAgICBteSAkTmFtZSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpHcm91cCcpLT5Hcm91cExvb2t1cCggR3JvdXBJRCA9PiAkSUQtPntDb250ZW50fSApOwogICAgICAgIG5leHQgUEVSTUlTU0lPTiBpZiAhJE5hbWU7CiAgICAgICAgJElELT57Q29udGVudH0gPSAkTmFtZTsKICAgIH0KCiAgICAjIHdyYXAgb2JqZWN0IGRlcGVuZGVuZCBpZHMKICAgIGlmICggJFN0YXRzWE1MLT57T2JqZWN0fS0+WzFdLT57Q29udGVudH0gKSB7CgogICAgICAgICMgbG9hZCBtb2R1bGUKICAgICAgICBteSAkT2JqZWN0TW9kdWxlID0gJFN0YXRzWE1MLT57T2JqZWN0TW9kdWxlfS0+WzFdLT57Q29udGVudH07CiAgICAgICAgcmV0dXJuIGlmICEkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpLT5SZXF1aXJlKCRPYmplY3RNb2R1bGUpOwogICAgICAgIG15ICRTdGF0T2JqZWN0ID0gJE9iamVjdE1vZHVsZS0+bmV3KCAleyRTZWxmfSApOwogICAgICAgIHJldHVybiBpZiAhJFN0YXRPYmplY3Q7CgogICAgICAgICMgbG9hZCBhdHRyaWJ1dGVzCiAgICAgICAgJFN0YXRzWE1MID0gJFN0YXRPYmplY3QtPkV4cG9ydFdyYXBwZXIoCiAgICAgICAgICAgICV7JFN0YXRzWE1MfSwKICAgICAgICApOwogICAgfQoKICAgICMgY29udmVydCBoYXNoIHRvIHN0cmluZwogICAgJEZpbGV7Q29udGVudH0gPSAkWE1MT2JqZWN0LT5YTUxIYXNoMlhNTCgKICAgICAgICB7CiAgICAgICAgICAgIG90cnNfc3RhdHMgPT4gWwogICAgICAgICAgICAgICAgdW5kZWYsCiAgICAgICAgICAgICAgICAkU3RhdHNYTUwsCiAgICAgICAgICAgIF0sCiAgICAgICAgfSwKICAgICk7CgogICAgcmV0dXJuIFwlRmlsZTsKfQoKPWl0ZW0gSW1wb3J0KCkKCmltcG9ydCBhIHN0YXRzIGZyb20geG1sIGZpbGUKCiAgICBteSAkU3RhdElEID0gJFN0YXRzT2JqZWN0LT5JbXBvcnQoCiAgICAgICAgVXNlcklEICA9PiAkVXNlcklELAogICAgICAgIENvbnRlbnQgPT4gJFVwbG9hZFN0dWZme0NvbnRlbnR9LAogICAgKTsKCj1jdXQKCnN1YiBJbXBvcnQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoVXNlcklEIENvbnRlbnQpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICJlcnJvciIsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkTmVlZGVkLiIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgIyBnZXQgeG1sIG9iamVjdAogICAgbXkgJFhNTE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpYTUwnKTsKCiAgICBteSBAWE1MSGFzaCA9ICRYTUxPYmplY3QtPlhNTFBhcnNlMlhNTEhhc2goIFN0cmluZyA9PiAkUGFyYW17Q29udGVudH0gKTsKCiAgICBpZiAoICEkWE1MSGFzaFswXSApIHsKICAgICAgICBzaGlmdCBAWE1MSGFzaDsKICAgIH0KICAgIG15ICRTdGF0c1hNTCA9ICRYTUxIYXNoWzBdLT57b3Ryc19zdGF0c30tPlsxXTsKCiAgICAjIEdldCBuZXcgU3RhdElECiAgICBteSBAS2V5cyA9ICRYTUxPYmplY3QtPlhNTEhhc2hTZWFyY2goCiAgICAgICAgVHlwZSA9PiAnU3RhdHMnLAogICAgKTsKCiAgICAjIGNoZWNrIGlmIHRoZSByZXF1aXJlZCBlbGVtZW50cyBhcmUgYXZhaWxhYmxlCiAgICBmb3IgbXkgJEVsZW1lbnQgKAogICAgICAgIHF3KCBEZXNjcmlwdGlvbiBGb3JtYXQgT2JqZWN0IE9iamVjdE1vZHVsZSBQZXJtaXNzaW9uIFN0YXRUeXBlIFN1bUNvbCBTdW1Sb3cgVGl0bGUgVmFsaWQpCiAgICAgICAgKQogICAgewogICAgICAgIGlmICggIWRlZmluZWQgJFN0YXRzWE1MLT57JEVsZW1lbnR9LT5bMV0tPntDb250ZW50fSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICJDYW4ndCBpbXBvcnQgU3RhdCwgYmVjYXVzZSB0aGUgcmVxdWlyZWQgZWxlbWVudCAkRWxlbWVudCBpcyBub3QgYXZhaWxhYmxlISIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCBjb25maWcgb2JqZWN0CiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICAjIGlmLWNsYXVzZSBpZiBhIHN0YXQteG1sIGluY2x1ZGVzIGEgU3RhdE51bWJlcgogICAgbXkgJFN0YXRJRCA9IDE7CiAgICBpZiAoICRTdGF0c1hNTC0+e1N0YXROdW1iZXJ9ICkgewogICAgICAgIG15ICRYTUxTdGF0c0lEID0gJFN0YXRzWE1MLT57U3RhdE51bWJlcn0tPlsxXS0+e0NvbnRlbnR9CiAgICAgICAgICAgIC0gJENvbmZpZ09iamVjdC0+R2V0KCdTdGF0czo6U3RhdHNTdGFydE51bWJlcicpOwogICAgICAgIGZvciBteSAkS2V5IChAS2V5cykgewogICAgICAgICAgICBpZiAoICRLZXkgZXEgJFhNTFN0YXRzSUQgKSB7CiAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4KICAgICAgICAgICAgICAgICAgICAgICAgIkNhbid0IGltcG9ydCBTdGF0TnVtYmVyICRLZXksIGJlY2F1c2UgdGhpcyBTdGF0TnVtYmVyIGlzIGFscmVhZHkgdXNlZCEiCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICRTdGF0SUQgPSAkWE1MU3RhdHNJRDsKICAgIH0KCiAgICAjIGlmIG5vIHN0YXRzIG51bWJlciBhdmFpbGFibGUgdXNlIHRoaXMgZnVuY3Rpb24KICAgIGVsc2UgewogICAgICAgIG15IEBTb3J0S2V5cyA9IHNvcnQgeyAkYSA8PT4gJGIgfSBAS2V5czsKICAgICAgICBpZiAoQFNvcnRLZXlzKSB7CiAgICAgICAgICAgICRTdGF0SUQgPSAkU29ydEtleXNbLTFdICsgMTsKICAgICAgICB9CiAgICB9CgogICAgIyBnZXQgdGltZSBvYmplY3QKICAgIG15ICRUaW1lT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpbWUnKTsKCiAgICAjIGdldCB0aW1lCiAgICBteSAkVGltZVN0YW1wID0gJFRpbWVPYmplY3QtPlN5c3RlbVRpbWUyVGltZVN0YW1wKAogICAgICAgIFN5c3RlbVRpbWUgPT4gJFRpbWVPYmplY3QtPlN5c3RlbVRpbWUoKSwKICAgICk7CgogICAgIyBtZXRhIHRhZ3MKICAgICRTdGF0c1hNTC0+e0NyZWF0ZWR9LT5bMV0tPntDb250ZW50fSAgICA9ICRUaW1lU3RhbXA7CiAgICAkU3RhdHNYTUwtPntDcmVhdGVkQnl9LT5bMV0tPntDb250ZW50fSAgPSAkUGFyYW17VXNlcklEfTsKICAgICRTdGF0c1hNTC0+e0NoYW5nZWR9LT5bMV0tPntDb250ZW50fSAgICA9ICRUaW1lU3RhbXA7CiAgICAkU3RhdHNYTUwtPntDaGFuZ2VkQnl9LT5bMV0tPntDb250ZW50fSAgPSAkUGFyYW17VXNlcklEfTsKICAgICRTdGF0c1hNTC0+e1N0YXROdW1iZXJ9LT5bMV0tPntDb250ZW50fSA9ICRTdGF0SUQgKyAkQ29uZmlnT2JqZWN0LT5HZXQoJ1N0YXRzOjpTdGF0c1N0YXJ0TnVtYmVyJyk7CgogICAgbXkgJER5bmFtaWNGaWxlcyA9ICRTZWxmLT5HZXREeW5hbWljRmlsZXMoKTsKCiAgICAjIEJlY2F1c2Ugc29tZSB4bWwtcGFyc2VyIGluc2VydCBcbiBpbnN0ZWFkIG9mIDxleGFtcGxlPjxleGFtcGxlPgogICAgaWYgKCAkU3RhdHNYTUwtPntPYmplY3R9LT5bMV0tPntDb250ZW50fSApIHsKICAgICAgICAkU3RhdHNYTUwtPntPYmplY3R9LT5bMV0tPntDb250ZW50fSA9fiBze1xufXt9eDsKICAgIH0KCiAgICBpZiAoCiAgICAgICAgJFN0YXRzWE1MLT57T2JqZWN0fS0+WzFdLT57Q29udGVudH0KICAgICAgICAmJiAhJER5bmFtaWNGaWxlcy0+eyAkU3RhdHNYTUwtPntPYmplY3R9LT5bMV0tPntDb250ZW50fSB9CiAgICAgICAgKQogICAgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiT2JqZWN0ICRTdGF0c1hNTC0+e09iamVjdH0tPlsxXS0+e0NvbnRlbnR9IGRvZXNuJ3QgZXhpc3QhIgogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgc3RhdGljIHN0YXRpc3RpYwogICAgaWYgKAogICAgICAgICRTdGF0c1hNTC0+e1N0YXRUeXBlfS0+WzFdLT57Q29udGVudH0KICAgICAgICAmJiAkU3RhdHNYTUwtPntTdGF0VHlwZX0tPlsxXS0+e0NvbnRlbnR9IGVxICdzdGF0aWMnCiAgICAgICAgKQogICAgewogICAgICAgIG15ICRGaWxlTG9jYXRpb24gPSAkU3RhdHNYTUwtPntPYmplY3RNb2R1bGV9WzFde0NvbnRlbnR9OwogICAgICAgICRGaWxlTG9jYXRpb24gPX4gc3s6On17XC99Z3g7CiAgICAgICAgJEZpbGVMb2NhdGlvbiA9ICRDb25maWdPYmplY3QtPkdldCgnSG9tZScpIC4gJy8nIC4gJEZpbGVMb2NhdGlvbiAuICcucG0nOwoKICAgICAgICAjIGlmIG5vIGlubGluZSBmaWxlIGlzIGdpdmVuIGluIHRoZSBzdGF0cyBkZWZpbml0aW9uCiAgICAgICAgaWYgKCAhJFN0YXRzWE1MLT57RmlsZX0tPlsxXS0+e0NvbnRlbnR9ICkgewoKICAgICAgICAgICAgIyBnZXQgdGhlIGZpbGUgbmFtZQogICAgICAgICAgICAkRmlsZUxvY2F0aW9uID1+IHN7IFxBIC4qPyAoIFteL10rICkgXC4gcG0gIFx6IH17JDF9eG1zOwoKICAgICAgICAgICAgIyBzZXQgdGhlIGZpbGUgbmFtZQogICAgICAgICAgICAkU3RhdHNYTUwtPntGaWxlfS0+WzFdLT57Q29udGVudH0gPSAkRmlsZUxvY2F0aW9uOwogICAgICAgIH0KCiAgICAgICAgIyB3cml0ZSBmaWxlIGlmIGl0IGlzIGluY2x1ZGVkIGluIHRoZSBzdGF0cyBkZWZpbml0aW9uCiAgICAgICAgIyMgbm8gY3JpdGljCiAgICAgICAgZWxzaWYgKCBvcGVuIG15ICRGaWxlaGFuZGxlLCAnPicsICRGaWxlTG9jYXRpb24gKSB7CiAgICAgICAgICAgICMjIHVzZSBjcml0aWMKCiAgICAgICAgICAgIHByaW50IFNUREVSUiAiTm90aWNlOiBJbnN0YWxsICRGaWxlTG9jYXRpb24gKCRTdGF0c1hNTC0+e0ZpbGV9WzFde1Blcm1pc3Npb259KSFcbiI7CiAgICAgICAgICAgIGlmICggJFN0YXRzWE1MLT57RmlsZX0tPlsxXS0+e0VuY29kZX0gJiYgJFN0YXRzWE1MLT57RmlsZX0tPlsxXS0+e0VuY29kZX0gZXEgJ0Jhc2U2NCcgKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkU3RhdHNYTUwtPntGaWxlfS0+WzFdLT57Q29udGVudH0gPSBkZWNvZGVfYmFzZTY0KCAkU3RhdHNYTUwtPntGaWxlfS0+WzFdLT57Q29udGVudH0gKTsKICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpFbmNvZGUnKS0+RW5jb2RlT3V0cHV0KAogICAgICAgICAgICAgICAgICAgIFwkU3RhdHNYTUwtPntGaWxlfS0+WzFdLT57Q29udGVudH0KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgc2V0IHV0Zjggb3IgYmluIG1vZGUKICAgICAgICAgICAgaWYgKCAkU3RhdHNYTUwtPntGaWxlfS0+WzFdLT57Q29udGVudH0gPX4gL3VzZVxzdXRmODsvICkgewogICAgICAgICAgICAgICAgb3BlbiAkRmlsZWhhbmRsZSwgJz46dXRmOCcsICRGaWxlTG9jYXRpb247ICAgICMjIG5vIGNyaXRpYwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgYmlubW9kZSAkRmlsZWhhbmRsZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwcmludCAkRmlsZWhhbmRsZSAkU3RhdHNYTUwtPntGaWxlfS0+WzFdLT57Q29udGVudH07CiAgICAgICAgICAgIGNsb3NlICRGaWxlaGFuZGxlOwoKICAgICAgICAgICAgIyBzZXQgcGVybWlzc2lvbgogICAgICAgICAgICBpZiAoIGxlbmd0aCggJFN0YXRzWE1MLT57RmlsZX0tPlsxXS0+e1Blcm1pc3Npb259ICkgPT0gMyApIHsKICAgICAgICAgICAgICAgICRTdGF0c1hNTC0+e0ZpbGV9LT5bMV0tPntQZXJtaXNzaW9ufSA9ICIwJFN0YXRzWE1MLT57RmlsZX0tPlsxXS0+e1Blcm1pc3Npb259IjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjaG1vZCggb2N0KCAkU3RhdHNYTUwtPntGaWxlfS0+WzFdLT57UGVybWlzc2lvbn0gKSwgJEZpbGVMb2NhdGlvbiApOwogICAgICAgICAgICAkU3RhdHNYTUwtPntGaWxlfS0+WzFdLT57Q29udGVudH0gPSAkU3RhdHNYTUwtPntGaWxlfS0+WzFdLT57RmlsZX07CgogICAgICAgICAgICBkZWxldGUgJFN0YXRzWE1MLT57RmlsZX0tPlsxXS0+e0ZpbGV9OwogICAgICAgICAgICBkZWxldGUgJFN0YXRzWE1MLT57RmlsZX0tPlsxXS0+e0xvY2F0aW9ufTsKICAgICAgICAgICAgZGVsZXRlICRTdGF0c1hNTC0+e0ZpbGV9LT5bMV0tPntQZXJtaXNzaW9ufTsKICAgICAgICAgICAgZGVsZXRlICRTdGF0c1hNTC0+e0ZpbGV9LT5bMV0tPntFbmNvZGV9OwogICAgICAgIH0KICAgIH0KCiAgICAjIHdyYXBwZXIgdG8gY2hhbmdlIHVzZWQgc3BlbGxpbmcgaW4gaWRzCiAgICAjIHdyYXAgcGVybWlzc2lvbnMKICAgIG15ICVHcm91cHMgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6R3JvdXAnKS0+R3JvdXBMaXN0KCBWYWxpZCA9PiAxICk7CgogICAgTkFNRToKICAgIGZvciBteSAkTmFtZSAoIEB7ICRTdGF0c1hNTC0+e1Blcm1pc3Npb259IH0gKSB7CiAgICAgICAgbmV4dCBOQU1FIGlmICEkTmFtZTsKCiAgICAgICAgbXkgJEZsYWcgPSAxOwogICAgICAgIElEOgogICAgICAgIGZvciBteSAkSUQgKCBzb3J0IGtleXMgJUdyb3VwcyApIHsKICAgICAgICAgICAgaWYgKCAkR3JvdXBzeyRJRH0gZXEgJE5hbWUtPntDb250ZW50fSApIHsKICAgICAgICAgICAgICAgICROYW1lLT57Q29udGVudH0gPSAkSUQ7CiAgICAgICAgICAgICAgICAkRmxhZyA9IDA7CiAgICAgICAgICAgICAgICBsYXN0IElEOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICgkRmxhZykgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiQ2FuJ3QgZmluZCB0aGUgcGVybWlzc2lvbiAoZ3JvdXApICROYW1lLT57Q29udGVudH0hIgogICAgICAgICAgICApOwogICAgICAgICAgICAkTmFtZSA9IHVuZGVmOwogICAgICAgIH0KICAgIH0KCiAgICAjIHdyYXAgb2JqZWN0IGRlcGVuZGVuZCBpZHMKICAgIGlmICggJFN0YXRzWE1MLT57T2JqZWN0fS0+WzFdLT57Q29udGVudH0gKSB7CgogICAgICAgICMgbG9hZCBtb2R1bGUKICAgICAgICBteSAkT2JqZWN0TW9kdWxlID0gJFN0YXRzWE1MLT57T2JqZWN0TW9kdWxlfS0+WzFdLT57Q29udGVudH07CiAgICAgICAgcmV0dXJuIGlmICEkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpLT5SZXF1aXJlKCRPYmplY3RNb2R1bGUpOwogICAgICAgIG15ICRTdGF0T2JqZWN0ID0gJE9iamVjdE1vZHVsZS0+bmV3KCAleyRTZWxmfSApOwogICAgICAgIHJldHVybiBpZiAhJFN0YXRPYmplY3Q7CgogICAgICAgICMgbG9hZCBhdHRyaWJ1dGVzCiAgICAgICAgJFN0YXRzWE1MID0gJFN0YXRPYmplY3QtPkltcG9ydFdyYXBwZXIoICV7JFN0YXRzWE1MfSApOwogICAgfQoKICAgICMgbmV3CiAgICByZXR1cm4gaWYgISRYTUxPYmplY3QtPlhNTEhhc2hBZGQoCiAgICAgICAgVHlwZSAgICA9PiAnU3RhdHMnLAogICAgICAgIEtleSAgICAgPT4gJFN0YXRJRCwKICAgICAgICBYTUxIYXNoID0+IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgb3Ryc19zdGF0cyA9PiBbCiAgICAgICAgICAgICAgICAgICAgdW5kZWYsCiAgICAgICAgICAgICAgICAgICAgJFN0YXRzWE1MLAogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgfSwKICAgICAgICBdLAogICAgKTsKCiAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKS0+Q2xlYW5VcCgKICAgICAgICBUeXBlID0+ICdTdGF0cycsCiAgICApOwoKICAgIHJldHVybiAkU3RhdElEOwp9Cgo9aXRlbSBHZXRQYXJhbXMoKQoKICAgIGdldCBhbGwgZWRpdCBwYXJhbXMgZnJvbSBzdGF0cyBmb3IgdmlldwoKICAgIG15ICRQYXJhbXMgPSAkU3RhdHNPYmplY3QtPkdldFBhcmFtcyggU3RhdElEID0+ICcxMjMnICk7Cgo9Y3V0CgpzdWIgR2V0UGFyYW1zIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgaWYgKCAhJFBhcmFte1N0YXRJRH0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdOZWVkIFN0YXRJRCEnCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbXkgJFN0YXQgPSAkU2VsZi0+U3RhdHNHZXQoIFN0YXRJRCA9PiAkUGFyYW17U3RhdElEfSApOwoKICAgICMgc3RhdGljCiAgICAjIGRvbid0IHJlbW92ZSB0aGlzIGlmIGNsYXVzZSwgYmVjYXVzZSBpcyByZXF1aXJlZCBmb3Igb3Rycy5HZW5lcmF0ZVN0YXRzLnBsCiAgICBteSBAUGFyYW1zOwogICAgaWYgKCAkU3RhdC0+e1N0YXRUeXBlfSBlcSAnc3RhdGljJyApIHsKCiAgICAgICAgIyBsb2FkIHN0YXRpYyBtb2R1bAogICAgICAgIG15ICRPYmplY3RNb2R1bGUgPSAkU3RhdC0+e09iamVjdE1vZHVsZX07CiAgICAgICAgcmV0dXJuIGlmICEkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpLT5SZXF1aXJlKCRPYmplY3RNb2R1bGUpOwogICAgICAgIG15ICRTdGF0T2JqZWN0ID0gJE9iamVjdE1vZHVsZS0+bmV3KCAleyRTZWxmfSApOwogICAgICAgIHJldHVybiBpZiAhJFN0YXRPYmplY3Q7CgogICAgICAgICMgZ2V0IHBhcmFtcwogICAgICAgIEBQYXJhbXMgPSAkU3RhdE9iamVjdC0+UGFyYW0oKTsKICAgIH0KCiAgICByZXR1cm4gXEBQYXJhbXM7Cn0KCj1pdGVtIFN0YXRzUnVuKCkKCnJ1biBhIHN0YXRpc3RpYy4KCiAgICBteSAkU3RhdEFycmF5ID0gJFN0YXRzT2JqZWN0LT5TdGF0c1J1bigKICAgICAgICBTdGF0SUQgICAgID0+ICcxMjMnLAogICAgICAgIEdldFBhcmFtICAgPT4gXCVHZXRQYXJhbSwKICAgICAgICBQcmV2aWV3ICAgID0+IDEsICAgICAgICAjIG9wdGlvbmFsLCByZXR1cm4gZmFrZSBkYXRhIGZvciBwcmV2aWV3IChvbmx5IGZvciBkeW5hbWljIHN0YXRzKQogICAgICAgIFVzZXJJRCAgICAgPT4gJFVzZXJJRCwKICAgICk7Cgo9Y3V0CgpzdWIgU3RhdHNSdW4gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBwYXJhbXMKICAgIGZvciBteSAkTmVlZGVkIChxdyhTdGF0SUQgR2V0UGFyYW0gVXNlcklEKSkgewogICAgICAgIGlmICggISRQYXJhbXskTmVlZGVkfSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5lZWQgJE5lZWRlZCEiCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgbXkgJFN0YXQgPSAkU2VsZi0+U3RhdHNHZXQoIFN0YXRJRCA9PiAkUGFyYW17U3RhdElEfSApOwogICAgbXkgJUdldFBhcmFtID0gJXsgJFBhcmFte0dldFBhcmFtfSB9OwogICAgbXkgQFJlc3VsdDsKCiAgICAjIFBlcmZvcm0gY2FsY3VsYXRpb25zIG9uIHRoZSBzbGF2ZSBEQiwgaWYgY29uZmlndXJlZC4KICAgIGxvY2FsICRLZXJuZWw6OlN5c3RlbTo6REI6OlVzZVNsYXZlREIgPSAxOwoKICAgICMgZ2V0IGRhdGEgaWYgaXQgaXMgYSBzdGF0aWMgc3RhdHMKICAgIGlmICggJFN0YXQtPntTdGF0VHlwZX0gZXEgJ3N0YXRpYycgKSB7CgogICAgICAgIHJldHVybiBpZiAkUGFyYW17UHJldmlld307ICAgICMgbm90IHN1cHBvcnRlZCBmb3Igc3RhdGljIHN0YXRzCgogICAgICAgIEBSZXN1bHQgPSAkU2VsZi0+X0dlbmVyYXRlU3RhdGljU3RhdHMoCiAgICAgICAgICAgIE9iamVjdE1vZHVsZSA9PiAkU3RhdC0+e09iamVjdE1vZHVsZX0sCiAgICAgICAgICAgIEdldFBhcmFtICAgICA9PiAkUGFyYW17R2V0UGFyYW19LAogICAgICAgICAgICBUaXRsZSAgICAgICAgPT4gJFN0YXQtPntUaXRsZX0sCiAgICAgICAgICAgIFN0YXRJRCAgICAgICA9PiAkU3RhdC0+e1N0YXRJRH0sCiAgICAgICAgICAgIENhY2hlICAgICAgICA9PiAkU3RhdC0+e0NhY2hlfSwKICAgICAgICAgICAgVXNlcklEICAgICAgID0+ICRQYXJhbXtVc2VySUR9LAogICAgICAgICk7CiAgICB9CgogICAgIyBnZXQgZGF0YSBpZiBpdCBpcyBhIGR5bmF5bWljIHN0YXRzCiAgICBlbHNpZiAoICRTdGF0LT57U3RhdFR5cGV9IGVxICdkeW5hbWljJyApIHsKICAgICAgICBAUmVzdWx0ID0gJFNlbGYtPl9HZW5lcmF0ZUR5bmFtaWNTdGF0cygKICAgICAgICAgICAgT2JqZWN0TW9kdWxlICAgICA9PiAkU3RhdC0+e09iamVjdE1vZHVsZX0sCiAgICAgICAgICAgIE9iamVjdCAgICAgICAgICAgPT4gJFN0YXQtPntPYmplY3R9LAogICAgICAgICAgICBVc2VBc1h2YWx1ZSAgICAgID0+ICRHZXRQYXJhbXtVc2VBc1h2YWx1ZX0sCiAgICAgICAgICAgIFVzZUFzVmFsdWVTZXJpZXMgPT4gJEdldFBhcmFte1VzZUFzVmFsdWVTZXJpZXN9IHx8IFtdLAogICAgICAgICAgICBVc2VBc1Jlc3RyaWN0aW9uID0+ICRHZXRQYXJhbXtVc2VBc1Jlc3RyaWN0aW9ufSB8fCBbXSwKICAgICAgICAgICAgVGl0bGUgICAgICAgICAgICA9PiAkU3RhdC0+e1RpdGxlfSwKICAgICAgICAgICAgU3RhdElEICAgICAgICAgICA9PiAkU3RhdC0+e1N0YXRJRH0sCiAgICAgICAgICAgIFRpbWVab25lICAgICAgICAgPT4gJEdldFBhcmFte1RpbWVab25lfSwKICAgICAgICAgICAgQ2FjaGUgICAgICAgICAgICA9PiAkU3RhdC0+e0NhY2hlfSwKICAgICAgICAgICAgUHJldmlldyAgICAgICAgICA9PiAkUGFyYW17UHJldmlld30sCiAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICAgPT4gJFBhcmFte1VzZXJJRH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGJ1aWxkIHN1bSBpbiByb3cgb3IgY29sCiAgICBpZiAoIEBSZXN1bHQgJiYgKCAkU3RhdC0+e1N1bVJvd30gfHwgJFN0YXQtPntTdW1Db2x9ICkgJiYgJFN0YXQtPntGb3JtYXR9ICF+IG17XkdEOjpHcmFwaFwuKn14ICkgewogICAgICAgIHJldHVybiAkU2VsZi0+U3VtQnVpbGQoCiAgICAgICAgICAgIEFycmF5ICA9PiBcQFJlc3VsdCwKICAgICAgICAgICAgU3VtUm93ID0+ICRTdGF0LT57U3VtUm93fSwKICAgICAgICAgICAgU3VtQ29sID0+ICRTdGF0LT57U3VtQ29sfSwKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiBcQFJlc3VsdDsKfQoKPWl0ZW0gU3RhdHNSZXN1bHRDYWNoZUNvbXB1dGUoKQoKY29tcHV0ZXMgc3RhdHMgcmVzdWx0cyBhbmQgYWRkcyB0aGVtIHRvIHRoZSBjYWNoZS4KVGhpcyBjYW4gYmUgdXNlZCB0byBwcmVjb21wdXRlIHN0YXRzIGRhdGEgZS4gZy4gZm9yIGRhc2hib2FyZCB3aWRnZXRzIGluIGEgY3JvbiBqb2IuCgogICAgbXkgJFN0YXRBcnJheSA9ICRTdGF0c09iamVjdC0+U3RhdHNSZXN1bHRDYWNoZUNvbXB1dGUoCiAgICAgICAgU3RhdElEICAgICAgID0+ICcxMjMnLAogICAgICAgIFVzZXJJRCAgICAgICA9PiAkVXNlcklELCAgICAgICAgIyB0YXJnZXQgVXNlcklECiAgICAgICAgVXNlckdldFBhcmFtID0+IFwlVXNlckdldFBhcmFtLCAjIHVzZXIgc2V0dGluZ3Mgb2Ygbm9uLWZpeGVkIGZpZWxkcwogICAgKTsKCj1jdXQKCnN1YiBTdGF0c1Jlc3VsdENhY2hlQ29tcHV0ZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIGZvciBteSAkTmVlZGVkIChxdyhTdGF0SUQgVXNlckdldFBhcmFtIFVzZXJJRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQhIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIG15ICRTdGF0ID0gJFNlbGYtPlN0YXRzR2V0KAogICAgICAgIFN0YXRJRCA9PiAkUGFyYW17U3RhdElEfSwKICAgICk7CgogICAgbXkgJFN0YXRzVmlld09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpTdGF0aXN0aWNzOjpWaWV3Jyk7CgogICAgbXkgJFN0YXRDb25maWd1cmF0aW9uVmFsaWQgPSAkU3RhdHNWaWV3T2JqZWN0LT5TdGF0c0NvbmZpZ3VyYXRpb25WYWxpZGF0ZSgKICAgICAgICBTdGF0ICAgPT4gJFN0YXQsCiAgICAgICAgRXJyb3JzID0+IHt9LAogICAgICAgIFVzZXJJRCA9PiAkUGFyYW17VXNlcklEfSwKICAgICk7CiAgICBpZiAoICEkU3RhdENvbmZpZ3VyYXRpb25WYWxpZCApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIlRoaXMgc3RhdGlzdGljIGNvbnRhaW5zIGNvbmZpZ3VyYXRpb24gZXJyb3JzLCBza2lwcGluZy4iLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIG15ICVHZXRQYXJhbSA9IGV2YWwgewogICAgICAgICRTdGF0c1ZpZXdPYmplY3QtPlN0YXRzUGFyYW1zR2V0KAogICAgICAgICAgICBTdGF0ICAgICAgICAgPT4gJFN0YXQsCiAgICAgICAgICAgIFVzZXJHZXRQYXJhbSA9PiAkUGFyYW17VXNlckdldFBhcmFtfSwKICAgICAgICApOwogICAgfTsKCiAgICBpZiAoICRAIHx8ICElR2V0UGFyYW0gKSB7CiAgICAgICAgbXkgJEVycm9ycyA9IHJlZiAkQCA/IGpvaW4oICJcbiIsIEB7JEB9ICkgOiAkQDsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIlRoZSBkYXNoYm9hcmQgd2lkZ2V0IGNvbmZpZ3VyYXRpb24gZm9yIHRoaXMgdXNlciBjb250YWlucyBlcnJvcnMsIHNraXBwaW5nOiAkRXJyb3JzIgogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgZ2V0IG1haW4gb2JqZWN0CiAgICBteSAkTWFpbk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyk7CgogICAgbXkgJER1bXBTdHJpbmcgPSAkTWFpbk9iamVjdC0+RHVtcCggXCVHZXRQYXJhbSApOwoKICAgIG15ICRNRDVTdW0gPSAkTWFpbk9iamVjdC0+TUQ1c3VtKAogICAgICAgIFN0cmluZyA9PiBcJER1bXBTdHJpbmcsCiAgICApOwoKICAgIG15ICRDYWNoZUtleSA9ICJTdGF0c1J1bkNhY2hlZDo6JFBhcmFte1VzZXJJRH06OiRQYXJhbXtTdGF0SUR9OjokTUQ1U3VtIjsKCiAgICBteSAkUmVzdWx0ID0gJFNlbGYtPlN0YXRzUnVuKAogICAgICAgIFN0YXRJRCAgID0+ICRQYXJhbXtTdGF0SUR9LAogICAgICAgIEdldFBhcmFtID0+IFwlR2V0UGFyYW0sCiAgICAgICAgVXNlcklEICAgPT4gJFBhcmFte1VzZXJJRH0sCiAgICApOwoKICAgICMgT25seSBzZXQvdXBkYXRlIHRoZSBjYWNoZSBhZnRlciBjb21wdXRpbmcgaXQsIG90aGVyd2lzZSBubyBjYWNoZSBkYXRhCiAgICAjICAgd291bGQgYmUgYXZhaWxhYmxlIGluIGJldHdlZW4uCiAgICByZXR1cm4gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyktPlNldCgKICAgICAgICBUeXBlICA9PiAnU3RhdHNSdW4nLAogICAgICAgIEtleSAgID0+ICRDYWNoZUtleSwKICAgICAgICBWYWx1ZSA9PiAkUmVzdWx0LAogICAgICAgIFRUTCAgID0+IDI0ICogNjAgKiA2MCwgICAgIyBjYWNoZSBpdCBmb3IgYSBkYXksIHdpbGwgYmUgb3ZlcndyaXR0ZW4gYnkgbmV4dCBmdW5jdGlvbiBjYWxsCgogICAgICAgICMgRG9uJ3Qgc3RvcmUgY29tcGxleCBzdHJ1Y3R1cmUgaW4gbWVtb3J5IGFzIGl0IHdpbGwgYmUgbW9kaWZpZWQgbGF0ZXIuCiAgICAgICAgQ2FjaGVJbk1lbW9yeSA9PiAwLAogICAgKTsKfQoKPWl0ZW0gU3RhdHNSZXN1bHRDYWNoZUdldCgpCgpnZXRzIGNhY2hlZCBzdGF0aXN0aWMgcmVzdWx0cy4gV2lsbCBuZXZlciBydW4gdGhlIHN0YXRpc3RpYy4KVGhpcyBjYW4gYmUgdXNlZCB0byBmZXRjaCBjYWNoZWQgc3RhdHMgZGF0YSBlLiBnLiBmb3Igc3RhdHMgd2lkZ2V0cyBpbiB0aGUgZGFzaGJvYXJkLgoKICAgIG15ICRTdGF0QXJyYXkgPSAkU3RhdHNPYmplY3QtPlN0YXRzUmVzdWx0Q2FjaGVHZXQoCiAgICAgICAgU3RhdElEICAgICAgID0+ICcxMjMnLAogICAgICAgIFVzZXJJRCAgICAgICA9PiAkVXNlcklELCAgICAjIHRhcmdldCBVc2VySUQKICAgICAgICBVc2VyR2V0UGFyYW0gPT4gXCVHZXRQYXJhbSwKICAgICk7Cgo9Y3V0CgpzdWIgU3RhdHNSZXN1bHRDYWNoZUdldCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIGZvciBteSAkTmVlZGVkIChxdyhTdGF0SUQgVXNlckdldFBhcmFtIFVzZXJJRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQhIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIG15ICRTdGF0ID0gJFNlbGYtPlN0YXRzR2V0KAogICAgICAgIFN0YXRJRCA9PiAkUGFyYW17U3RhdElEfSwKICAgICk7CgogICAgbXkgJFN0YXRzVmlld09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpTdGF0aXN0aWNzOjpWaWV3Jyk7CgogICAgbXkgJFN0YXRDb25maWd1cmF0aW9uVmFsaWQgPSAkU3RhdHNWaWV3T2JqZWN0LT5TdGF0c0NvbmZpZ3VyYXRpb25WYWxpZGF0ZSgKICAgICAgICBTdGF0ICAgPT4gJFN0YXQsCiAgICAgICAgRXJyb3JzID0+IHt9LAogICAgICAgIFVzZXJJRCA9PiAkUGFyYW17VXNlcklEfSwKICAgICk7CiAgICBpZiAoICEkU3RhdENvbmZpZ3VyYXRpb25WYWxpZCApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIlRoaXMgc3RhdGlzdGljIGNvbnRhaW5zIGNvbmZpZ3VyYXRpb24gZXJyb3JzLCBza2lwcGluZy4iLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIG15ICVHZXRQYXJhbSA9IGV2YWwgewogICAgICAgICRTdGF0c1ZpZXdPYmplY3QtPlN0YXRzUGFyYW1zR2V0KAogICAgICAgICAgICBTdGF0ICAgICAgICAgPT4gJFN0YXQsCiAgICAgICAgICAgIFVzZXJHZXRQYXJhbSA9PiAkUGFyYW17VXNlckdldFBhcmFtfSwKICAgICAgICAgICAgVXNlcklEICAgICAgID0+ICRQYXJhbXtVc2VySUR9LAogICAgICAgICk7CiAgICB9OwoKICAgIGlmICggJEAgfHwgISVHZXRQYXJhbSApIHsKICAgICAgICBteSAkRXJyb3JzID0gcmVmICRAID8gam9pbiggIlxuIiwgQHskQH0gKSA6ICRAOwogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiVGhlIGRhc2hib2FyZCB3aWRnZXQgY29uZmlndXJhdGlvbiBmb3IgdGhpcyB1c2VyIGNvbnRhaW5zIGVycm9ycywgc2tpcHBpbmc6ICRFcnJvcnMiCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBnZXQgbWFpbiBvYmplY3QKICAgIG15ICRNYWluT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKTsKCiAgICBteSAkRHVtcFN0cmluZyA9ICRNYWluT2JqZWN0LT5EdW1wKCBcJUdldFBhcmFtICk7CgogICAgbXkgJE1ENVN1bSA9ICRNYWluT2JqZWN0LT5NRDVzdW0oCiAgICAgICAgU3RyaW5nID0+IFwkRHVtcFN0cmluZywKICAgICk7CgogICAgbXkgJENhY2hlS2V5ID0gIlN0YXRzUnVuQ2FjaGVkOjokUGFyYW17VXNlcklEfTo6JFBhcmFte1N0YXRJRH06OiRNRDVTdW0iOwoKICAgIHJldHVybiAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKS0+R2V0KAogICAgICAgIFR5cGUgPT4gJ1N0YXRzUnVuJywKICAgICAgICBLZXkgID0+ICRDYWNoZUtleSwKCiAgICAgICAgIyBEb24ndCBzdG9yZSBjb21wbGV4IHN0cnVjdHVyZSBpbiBtZW1vcnkgYXMgaXQgd2lsbCBiZSBtb2RpZmllZCBsYXRlci4KICAgICAgICBDYWNoZUluTWVtb3J5ID0+IDAsCiAgICApOwp9Cgo9aXRlbSBTdHJpbmdBbmRUaW1lc3RhbXAyRmlsZW5hbWUoKQoKYnVpbGRzIGEgZmlsZW5hbWUgd2l0aCBhIHN0cmluZyBhbmQgYSB0aW1lc3RhbXAuCihzcGFjZSB3aWxsIGJlIHJlcGxhY2VkIHdpdGggXyBhbmQgLSBlLmcuIFRpdGxlLW9mLUZpbGVfMjAwNi0xMi0zMV8xMS01OSkKCiAgICBteSAkRmlsZW5hbWUgPSAkU3RhdHNPYmplY3QtPlN0cmluZ0FuZFRpbWVzdGFtcDJGaWxlbmFtZSgKICAgICAgICBTdHJpbmcgICA9PiAnVGl0bGUnLAogICAgICAgIFRpbWVab25lID0+ICcrMicsICAjIG9wdGlvbmFsCiAgICApOwoKPWN1dAoKc3ViIFN0cmluZ0FuZFRpbWVzdGFtcDJGaWxlbmFtZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIGlmICggISRQYXJhbXtTdHJpbmd9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnTmVlZCBTdHJpbmchJwogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgZ2V0IHRpbWUgb2JqZWN0CiAgICBteSAkVGltZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaW1lJyk7CgogICAgbXkgKCAkcywgJG0sICRoLCAkRCwgJE0sICRZICkgPSAkVGltZU9iamVjdC0+U3lzdGVtVGltZTJEYXRlKAogICAgICAgIFN5c3RlbVRpbWUgPT4gJFRpbWVPYmplY3QtPlN5c3RlbVRpbWUoKSwKICAgICk7CiAgICAkTSA9IHNwcmludGYoICIlMDJkIiwgJE0gKTsKICAgICREID0gc3ByaW50ZiggIiUwMmQiLCAkRCApOwogICAgJGggPSBzcHJpbnRmKCAiJTAyZCIsICRoICk7CiAgICAkbSA9IHNwcmludGYoICIlMDJkIiwgJG0gKTsKCiAgICAkUGFyYW17U3RyaW5nfSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyktPkZpbGVuYW1lQ2xlYW5VcCgKICAgICAgICBGaWxlbmFtZSA9PiAkUGFyYW17U3RyaW5nfSwKICAgICAgICBUeXBlICAgICA9PiAnQXR0YWNobWVudCcsCiAgICApOwoKICAgIG15ICRGaWxlbmFtZSA9ICRQYXJhbXtTdHJpbmd9IC4gJ18nIC4gIiRZLSRNLSREIiAuICdfJyAuICIkaC0kbSI7CgogICAgaWYgKCAkUGFyYW17VGltZVpvbmV9ICkgewogICAgICAgICRGaWxlbmFtZSAuPSAnX1RpbWVab25lXycgLiAkUGFyYW17VGltZVpvbmV9OwogICAgfQoKICAgIHJldHVybiAkRmlsZW5hbWU7Cn0KCj1pdGVtIFN0YXROdW1iZXIyU3RhdElEKCkKCmluc2VydCB0aGUgc3RhdCBudW1iZXIgZ2V0IHRoZSBzdGF0IGlkCgogICAgbXkgJFN0YXRJRCA9ICRTdGF0c09iamVjdC0+U3RhdE51bWJlcjJTdGF0SUQoCiAgICAgICAgU3RhdE51bWJlciA9PiAxMTIxMiwKICAgICk7Cgo9Y3V0CgpzdWIgU3RhdE51bWJlcjJTdGF0SUQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBpZiAoICEkUGFyYW17U3RhdE51bWJlcn0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdOZWVkIFN0YXROdW1iZXIhJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBteSBAS2V5ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlhNTCcpLT5YTUxIYXNoU2VhcmNoKAogICAgICAgIFR5cGUgPT4gJ1N0YXRzJywKICAgICAgICBXaGF0ID0+IFsgeyAiWyVdeydvdHJzX3N0YXRzJ31bJV17J1N0YXROdW1iZXInfVslXXsnQ29udGVudCd9IiA9PiAkUGFyYW17U3RhdE51bWJlcn0gfSBdLAogICAgKTsKICAgIGlmICggQEtleSAmJiAkI0tleSA8IDEgKSB7CiAgICAgICAgcmV0dXJuICRLZXlbMF07CiAgICB9CgogICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICBNZXNzYWdlICA9PiAnU3RhdE51bWJlciBpbnZhbGlkIScsCiAgICApOwogICAgcmV0dXJuOwp9Cgo9aXRlbSBTdGF0c0luc3RhbGwoKQoKaW5zdGFsbHMgc3RhdHMKCiAgICBteSAkUmVzdWx0ID0gJFN0YXRzT2JqZWN0LT5TdGF0c0luc3RhbGwoCiAgICAgICAgRmlsZVByZWZpeCA9PiAnRkFRJywgICMgKG9wdGlvbmFsKQogICAgICAgIFVzZXJJRCAgICAgPT4gJFVzZXJJRCwKICAgICk7Cgo9Y3V0CgpzdWIgU3RhdHNJbnN0YWxsIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgZm9yIG15ICROZWVkZWQgKHF3KFVzZXJJRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQhIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgcHJlcGFyZSBwcmVmaXgKICAgICRQYXJhbXtGaWxlUHJlZml4fSA9ICRQYXJhbXtGaWxlUHJlZml4fSA/ICRQYXJhbXtGaWxlUHJlZml4fSAuICctJyA6ICcnOwoKICAgICMgc3RhcnQgQXV0b21hdGljU2FtcGxlSW1wb3J0IGlmIG5vIHN0YXRzIGFyZSBpbnN0YWxsZWQKICAgICRTZWxmLT5HZXRTdGF0c0xpc3QoCiAgICAgICAgVXNlcklEID0+ICRQYXJhbXtVc2VySUR9LAogICAgKTsKCiAgICAjIGNsZWFudXAgc3RhdHMKICAgICRTZWxmLT5TdGF0c0NsZWFuVXAoCiAgICAgICAgVXNlcklEID0+ICRQYXJhbXtVc2VySUR9LAogICAgKTsKCiAgICAjIGdldCBtYWluIG9iamVjdAogICAgbXkgJE1haW5PYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpOwoKICAgICMgZ2V0IGxpc3Qgb2Ygc3RhdHMgZmlsZXMKICAgIG15IEBTdGF0c0ZpbGVMaXN0ID0gJE1haW5PYmplY3QtPkRpcmVjdG9yeVJlYWQoCiAgICAgICAgRGlyZWN0b3J5ID0+ICRTZWxmLT57U3RhdHNUZW1wRGlyfSwKICAgICAgICBGaWx0ZXIgICAgPT4gJFBhcmFte0ZpbGVQcmVmaXh9IC4gJyoueG1sJywKICAgICk7CgogICAgIyBpbXBvcnQgdGhlIHN0YXRzCiAgICBteSAkSW5zdGFsbGVkUG9zdGZpeCA9ICcuaW5zdGFsbGVkJzsKICAgIEZJTEU6CiAgICBmb3IgbXkgJEZpbGUgKCBzb3J0IEBTdGF0c0ZpbGVMaXN0ICkgewoKICAgICAgICBuZXh0IEZJTEUgaWYgIS1mICRGaWxlOwogICAgICAgIG5leHQgRklMRSBpZiAtZSAkRmlsZSAuICRJbnN0YWxsZWRQb3N0Zml4OwoKICAgICAgICAjIHJlYWQgZmlsZSBjb250ZW50CiAgICAgICAgbXkgJFhNTENvbnRlbnRSZWYgPSAkTWFpbk9iamVjdC0+RmlsZVJlYWQoCiAgICAgICAgICAgIExvY2F0aW9uID0+ICRGaWxlLAogICAgICAgICk7CgogICAgICAgICMgaW1wb3J0IHN0YXQKICAgICAgICBteSAkU3RhdElEID0gJFNlbGYtPkltcG9ydCgKICAgICAgICAgICAgQ29udGVudCA9PiAkeyRYTUxDb250ZW50UmVmfSwKICAgICAgICAgICAgVXNlcklEICA9PiAkUGFyYW17VXNlcklEfSwKICAgICAgICApOwoKICAgICAgICBuZXh0IEZJTEUgaWYgISRTdGF0SUQ7CgogICAgICAgICMgd3JpdGUgaW5zdGFsbGVkIGZpbGUgd2l0aCBzdGF0IGlkCiAgICAgICAgJE1haW5PYmplY3QtPkZpbGVXcml0ZSgKICAgICAgICAgICAgQ29udGVudCAgPT4gXCRTdGF0SUQsCiAgICAgICAgICAgIExvY2F0aW9uID0+ICRGaWxlIC4gJEluc3RhbGxlZFBvc3RmaXgsCiAgICAgICAgKTsKICAgIH0KCiAgICByZXR1cm4gMTsKfQoKPWl0ZW0gU3RhdHNVbmluc3RhbGwoKQoKdW5pbnN0YWxscyBzdGF0cwoKICAgIG15ICRSZXN1bHQgPSAkU3RhdHNPYmplY3QtPlN0YXRzVW5pbnN0YWxsKAogICAgICAgIEZpbGVQcmVmaXggPT4gJ0ZBUScsICAjIChvcHRpb25hbCkKICAgICAgICBVc2VySUQgICAgID0+ICRVc2VySUQsCiAgICApOwoKPWN1dAoKc3ViIFN0YXRzVW5pbnN0YWxsIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgZm9yIG15ICROZWVkZWQgKHF3KFVzZXJJRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQhIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgcHJlcGFyZSBwcmVmaXgKICAgICRQYXJhbXtGaWxlUHJlZml4fSA9ICRQYXJhbXtGaWxlUHJlZml4fSA/ICRQYXJhbXtGaWxlUHJlZml4fSAuICctJyA6ICcnOwoKICAgICMgZ2V0IG1haW4gb2JqZWN0CiAgICBteSAkTWFpbk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyk7CgogICAgIyBnZXQgbGlzdCBvZiBpbnN0YWxsZWQgc3RhdHMgZmlsZXMKICAgIG15IEBTdGF0c0ZpbGVMaXN0ID0gJE1haW5PYmplY3QtPkRpcmVjdG9yeVJlYWQoCiAgICAgICAgRGlyZWN0b3J5ID0+ICRTZWxmLT57U3RhdHNUZW1wRGlyfSwKICAgICAgICBGaWx0ZXIgICAgPT4gJFBhcmFte0ZpbGVQcmVmaXh9IC4gJyoueG1sLmluc3RhbGxlZCcsCiAgICApOwoKICAgICMgZGVsZXRlIHRoZSBzdGF0cwogICAgZm9yIG15ICRGaWxlICggc29ydCBAU3RhdHNGaWxlTGlzdCApIHsKCiAgICAgICAgIyByZWFkIGZpbGUgY29udGVudAogICAgICAgIG15ICRTdGF0c0lEUmVmID0gJE1haW5PYmplY3QtPkZpbGVSZWFkKAogICAgICAgICAgICBMb2NhdGlvbiA9PiAkRmlsZSwKICAgICAgICApOwoKICAgICAgICAjIGRlbGV0ZSBzdGF0cwogICAgICAgICRTZWxmLT5TdGF0c0RlbGV0ZSgKICAgICAgICAgICAgU3RhdElEID0+ICR7JFN0YXRzSURSZWZ9LAogICAgICAgICAgICBVc2VySUQgPT4gJFBhcmFte1VzZXJJRH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGNsZWFudXAgc3RhdHMKICAgICRTZWxmLT5TdGF0c0NsZWFuVXAoCiAgICAgICAgVXNlcklEID0+ICRQYXJhbXtVc2VySUR9LAogICAgKTsKCiAgICByZXR1cm4gMTsKfQoKPWl0ZW0gU3RhdHNDbGVhblVwKCkKCnJlbW92ZWQgc3RhdHMgd2l0aCBub3QgZXhpc3RpbmcgYmFja2VuZCBmaWxlCgogICAgbXkgJFJlc3VsdCA9ICRTdGF0c09iamVjdC0+U3RhdHNDbGVhblVwKCk7Cgo9Y3V0CgpzdWIgU3RhdHNDbGVhblVwIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgZm9yIG15ICROZWVkZWQgKHF3KFVzZXJJRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQhIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IGEgbGlzdCBvZiBhbGwgc3RhdHMKICAgIG15ICRMaXN0UmVmID0gJFNlbGYtPkdldFN0YXRzTGlzdCgKICAgICAgICBVc2VySUQgPT4gJFBhcmFte1VzZXJJRH0sCiAgICApOwoKICAgIHJldHVybiBpZiAhJExpc3RSZWY7CiAgICByZXR1cm4gaWYgcmVmICRMaXN0UmVmIG5lICdBUlJBWSc7CgogICAgIyBnZXQgbWFpbiBvYmplY3QKICAgIG15ICRNYWluT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKTsKCiAgICBTVEFUU0lEOgogICAgZm9yIG15ICRTdGF0c0lEICggQHskTGlzdFJlZn0gKSB7CgogICAgICAgICMgZ2V0IHN0YXRzCiAgICAgICAgbXkgJEhhc2hSZWYgPSAkU2VsZi0+U3RhdHNHZXQoCiAgICAgICAgICAgIFN0YXRJRCAgICAgICAgICAgICA9PiAkU3RhdHNJRCwKICAgICAgICAgICAgTm9PYmplY3RBdHRyaWJ1dGVzID0+IDEsCiAgICAgICAgKTsKCiAgICAgICAgbmV4dCBTVEFUU0lEIGlmICRIYXNoUmVmCiAgICAgICAgICAgICYmIHJlZiAkSGFzaFJlZiBlcSAnSEFTSCcKICAgICAgICAgICAgJiYgJEhhc2hSZWYtPntPYmplY3RNb2R1bGV9CiAgICAgICAgICAgICYmICRNYWluT2JqZWN0LT5SZXF1aXJlKCAkSGFzaFJlZi0+e09iamVjdE1vZHVsZX0gKTsKCiAgICAgICAgIyBkZWxldGUgc3RhdHMKICAgICAgICAkU2VsZi0+U3RhdHNEZWxldGUoCiAgICAgICAgICAgIFN0YXRJRCA9PiAkU3RhdHNJRCwKICAgICAgICAgICAgVXNlcklEID0+ICRQYXJhbXtVc2VySUR9LAogICAgICAgICk7CiAgICB9CgogICAgcmV0dXJuIDE7Cn0KCj1iZWdpbiBJbnRlcm5hbDoKCj1pdGVtIF9HZW5lcmF0ZVN0YXRpY1N0YXRzKCkKCiAgICB0YWtlIHRoZSBzdGF0IGNvbmZpZ3VyYXRpb24gYW5kIGdldCB0aGUgc3RhdCB0YWJsZQoKICAgIG15IEBTdGF0QXJyYXkgPSAkU3RhdHNPYmplY3QtPl9HZW5lcmF0ZVN0YXRpY1N0YXRzKAogICAgICAgIE9iamVjdE1vZHVsZSA9PiAkU3RhdC0+e09iamVjdE1vZHVsZX0sCiAgICAgICAgR2V0UGFyYW0gICAgID0+ICRQYXJhbXtHZXRQYXJhbX0sCiAgICAgICAgVGl0bGUgICAgICAgID0+ICRTdGF0LT57VGl0bGV9LAogICAgICAgIFN0YXRJRCAgICAgICA9PiAkU3RhdC0+e1N0YXRJRH0sCiAgICAgICAgQ2FjaGUgICAgICAgID0+ICRTdGF0LT57Q2FjaGV9LAogICAgICAgIFVzZXJJRCAgICAgICA9PiAkVXNlcklELAogICAgKTsKCj1jdXQKCnN1YiBfR2VuZXJhdGVTdGF0aWNTdGF0cyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHBhcmFtcwogICAgTkVFRDoKICAgIGZvciBteSAkTmVlZCAocXcoT2JqZWN0TW9kdWxlIEdldFBhcmFtIFRpdGxlIFN0YXRJRCBVc2VySUQpKSB7CiAgICAgICAgbmV4dCBORUVEIGlmICRQYXJhbXskTmVlZH07CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkISIKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGxvYWQgc3RhdGljIG1vZHVsZQogICAgbXkgJE9iamVjdE1vZHVsZSA9ICRQYXJhbXtPYmplY3RNb2R1bGV9OwogICAgcmV0dXJuIGlmICEkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpLT5SZXF1aXJlKCRPYmplY3RNb2R1bGUpOwogICAgbXkgJFN0YXRPYmplY3QgPSAkT2JqZWN0TW9kdWxlLT5uZXcoICV7JFNlbGZ9ICk7CiAgICByZXR1cm4gaWYgISRTdGF0T2JqZWN0OwoKICAgIG15IEBSZXN1bHQ7CiAgICBteSAlR2V0UGFyYW0gPSAleyAkUGFyYW17R2V0UGFyYW19IH07CgogICAgIyB1c2UgcmVzdWx0IGNhY2hlIGlmIGNvbmZpZ3VyZWQKICAgIGlmICggJFBhcmFte0NhY2hlfSApIHsKICAgICAgICBteSAkRmlsZW5hbWUgPSAkU2VsZi0+X0NyZWF0ZVN0YXRpY1Jlc3VsdENhY2hlRmlsZW5hbWUoCiAgICAgICAgICAgIEdldFBhcmFtID0+IFwlR2V0UGFyYW0sCiAgICAgICAgICAgIFN0YXRJRCAgID0+ICRQYXJhbXtTdGF0SUR9LAogICAgICAgICk7CgogICAgICAgIEBSZXN1bHQgPSAkU2VsZi0+X0dldFJlc3VsdENhY2hlKCBGaWxlbmFtZSA9PiAkRmlsZW5hbWUgKTsKICAgICAgICBpZiAoQFJlc3VsdCkgewogICAgICAgICAgICByZXR1cm4gQFJlc3VsdDsKICAgICAgICB9CiAgICB9CgogICAgIyBnZXQgdXNlciBvYmplY3QKICAgIG15ICRVc2VyT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlVzZXInKTsKCiAgICBteSAlVXNlciA9ICRVc2VyT2JqZWN0LT5HZXRVc2VyRGF0YSgKICAgICAgICBVc2VySUQgPT4gJFBhcmFte1VzZXJJRH0sCiAgICApOwoKICAgICMgcnVuIHN0YXRzIGZ1bmN0aW9uCiAgICBAUmVzdWx0ID0gJFN0YXRPYmplY3QtPlJ1bigKICAgICAgICAlR2V0UGFyYW0sCgogICAgICAgICMgdGhlc2UgdHdvIGxpbmVzIGFyZSByZXF1aXJlbWVudHMgb2YgbWUsIHBlcmhhcHMgdGhpcwogICAgICAgICMgaW5mb3JtYXRpb24gaXMgbmVlZGVkIGZvciBmb3JtZXIgc3RhdGljIHN0YXRzCiAgICAgICAgRm9ybWF0ID0+ICRQYXJhbXtGb3JtYXR9LT5bMF0sCiAgICAgICAgTW9kdWxlID0+ICRQYXJhbXtPYmplY3RNb2R1bGV9LAogICAgKTsKCiAgICAkUmVzdWx0WzBdLT5bMF0gPSAkUGFyYW17VGl0bGV9IC4gJyAnIC4gJFJlc3VsdFswXS0+WzBdOwoKICAgICMgd3JpdGUgY2FjaGUgaWYgY29uZmlndXJlZAogICAgaWYgKCAkUGFyYW17Q2FjaGV9ICkgewogICAgICAgICRTZWxmLT5fV3JpdGVSZXN1bHRDYWNoZSgKICAgICAgICAgICAgR2V0UGFyYW0gPT4gXCVHZXRQYXJhbSwKICAgICAgICAgICAgU3RhdElEICAgPT4gJFBhcmFte1N0YXRJRH0sCiAgICAgICAgICAgIERhdGEgICAgID0+IFxAUmVzdWx0LAogICAgICAgICk7CiAgICB9CgogICAgcmV0dXJuIEBSZXN1bHQ7Cn0KCj1pdGVtIF9HZW5lcmF0ZUR5bmFtaWNTdGF0cygpCgogICAgdGFrZSB0aGUgc3RhdCBjb25maWd1cmF0aW9uIGFuZCBnZXQgdGhlIHN0YXQgdGFibGUKCiAgICBteSBAU3RhdEFycmF5ID0gJFN0YXRzT2JqZWN0LT5fR2VuZXJhdGVEeW5hbWljU3RhdHMoCiAgICAgICAgT2JqZWN0TW9kdWxlICAgICA9PiAnS2VybmVsOjpTeXN0ZW06OlN0YXRzOjpEeW5hbWljOjpUaWNrZXQnLAogICAgICAgIE9iamVjdCAgICAgICAgICAgPT4gJ1RpY2tldCcsCiAgICAgICAgVXNlQXNYdmFsdWUgICAgICA9PiBcVXNlQXNYdmFsdWVFbGVtZW50cywKICAgICAgICBVc2VBc1ZhbHVlU2VyaWVzID0+IFxVc2VBc1ZhbHVlU2VyaWVzRWxlbWVudHMsCiAgICAgICAgVXNlQXNSZXN0cmljdGlvbiA9PiBcVXNlQXNSZXN0cmljdGlvbkVsZW1lbnRzLAogICAgICAgIFRpdGxlICAgICAgICAgICAgPT4gJ1RpY2tldFN0YXQnLAogICAgICAgIFN0YXRJRCAgICAgICAgICAgPT4gMTIzLAogICAgICAgIFRpbWVab25lICAgICAgICAgPT4gJysyJywgICAjIG9wdGlvbmFsLAogICAgICAgIENhY2hlICAgICAgICAgICAgPT4gMSwgICAgICAjIG9wdGlvbmFsLAogICAgICAgIFByZXZpZXcgICAgICAgICAgPT4gMSwgICAgICAjIG9wdGlvbmFsLCBnZW5lcmF0ZSBmYWtlIGRhdGEKICAgICAgICBVc2VySUQgICAgICAgICAgID0+ICRVc2VySUQsCiAgICApOwoKPWN1dAoKIyBzZWFyY2ggZm9yIGEgYmV0dGVyIHdheSB0byBjYWNoZSBzdGF0cyAoc2VlIGxpbmVzIGJlZm9yZSBTdGF0SUQgYW5kIENhY2hlKQoKc3ViIF9HZW5lcmF0ZUR5bmFtaWNTdGF0cyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15IEBIZWFkZXJMaW5lOwogICAgbXkgJFRpdGxlVGltZVN0YXJ0ID0gJyc7CiAgICBteSAkVGl0bGVUaW1lU3RvcCAgPSAnJzsKCiAgICBteSAkUHJldmlldyA9ICRQYXJhbXtQcmV2aWV3fTsKICAgIG15ICRVc2VySUQgID0gJFBhcmFte1VzZXJJRH07CgogICAgTkVFRDoKICAgIGZvciBteSAkTmVlZCAocXcoT2JqZWN0TW9kdWxlIFVzZUFzWHZhbHVlIFVzZUFzVmFsdWVTZXJpZXMgVGl0bGUgT2JqZWN0IFN0YXRJRCBVc2VySUQpKSB7CiAgICAgICAgbmV4dCBORUVEIGlmICRQYXJhbXskTmVlZH07CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkISIKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGluY2x1ZGUgdGhlIG5lZWRlZCBkeW5hbWljIG9iamVjdAogICAgbXkgJE9iamVjdE1vZHVsZSA9ICRQYXJhbXtPYmplY3RNb2R1bGV9OwogICAgcmV0dXJuIGlmICEkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpLT5SZXF1aXJlKCRPYmplY3RNb2R1bGUpOwogICAgbXkgJFN0YXRPYmplY3QgPSAkT2JqZWN0TW9kdWxlLT5uZXcoICV7JFNlbGZ9ICk7CiAgICByZXR1cm4gaWYgISRTdGF0T2JqZWN0OwoKICAgICMgZ2V0IHRpbWUgb2JqZWN0CiAgICBteSAkVGltZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaW1lJyk7CgogICAgIyBnZXQgdGhlIHNlbGVjdGVkIHZhbHVlcwogICAgIyBwZXJoYXBzIGkgY2FuIHNwbGl0IHRoZSBTdGF0R2V0IGZ1bmN0aW9uIHRvIG1ha2UgdGhpcyBuZWVkbGVzcwogICAgIyBQcm9ibGVtLCBpIG5lZWQgdGhlIGJsb2NrIGluZm9ybWF0aW9uCiAgICBteSAlTmV3UGFyYW07CgogICAgJE5ld1BhcmFte1RpdGxlfSAgICAgICAgPSAkUGFyYW17VGl0bGV9OwogICAgJE5ld1BhcmFte09iamVjdH0gICAgICAgPSAkUGFyYW17T2JqZWN0fTsKICAgICROZXdQYXJhbXtPYmplY3RNb2R1bGV9ID0gJFBhcmFte09iamVjdE1vZHVsZX07CgogICAgaWYgKCAkUGFyYW17VGltZVpvbmV9ICkgewogICAgICAgICROZXdQYXJhbXtUaW1lWm9uZX0gPSAkUGFyYW17VGltZVpvbmV9OwogICAgfQoKICAgICMgc2VhcmNoIGZvciBhIGJldHRlciB3YXkgdG8gY2FjaGUgc3RhdHMgKFN0YXRJRCBhbmQgQ2FjaGUpCiAgICAkTmV3UGFyYW17U3RhdElEfSA9ICRQYXJhbXtTdGF0SUR9OwogICAgJE5ld1BhcmFte0NhY2hlfSAgPSAkUGFyYW17Q2FjaGV9OwogICAgZm9yIG15ICRVc2UgKHF3KFVzZUFzUmVzdHJpY3Rpb24gVXNlQXNYdmFsdWUgVXNlQXNWYWx1ZVNlcmllcykpIHsKICAgICAgICBteSBAQXJyYXkgPSBAeyAkUGFyYW17JFVzZX0gfTsKICAgICAgICBFTEVNRU5UOgogICAgICAgIGZvciBteSAkRWxlbWVudCAoQEFycmF5KSB7CiAgICAgICAgICAgIG5leHQgRUxFTUVOVCBpZiAhJEVsZW1lbnQtPntTZWxlY3RlZH07CgogICAgICAgICAgICAjIENsb25lIHRoZSBlbGVtZW50IGFzIHdlIGFyZSBnb2luZyB0byBtb2RpZnkgaXQgLSBhdm9pZCBtb2RpZnlpbmcgdGhlIG9yaWdpbmFsIGRhdGEKICAgICAgICAgICAgJEVsZW1lbnQgPSAkeyBTdG9yYWJsZTo6ZGNsb25lKCBcJEVsZW1lbnQgKSB9OwoKICAgICAgICAgICAgZGVsZXRlICRFbGVtZW50LT57U2VsZWN0ZWR9OwogICAgICAgICAgICBkZWxldGUgJEVsZW1lbnQtPntGaXhlZH07CiAgICAgICAgICAgIGlmICggJEVsZW1lbnQtPntCbG9ja30gZXEgJ1RpbWUnICkgewogICAgICAgICAgICAgICAgZGVsZXRlICRFbGVtZW50LT57VGltZVBlcmlvZEZvcm1hdH07CiAgICAgICAgICAgICAgICBpZiAoICRFbGVtZW50LT57VGltZVJlbGF0aXZlVW5pdH0gKSB7CgogICAgICAgICAgICAgICAgICAgIG15ICRUaW1lU3RhbXAgPSAkVGltZU9iamVjdC0+Q3VycmVudFRpbWVzdGFtcCgpOwoKICAgICAgICAgICAjIGFkZCB0aGUgc2VsZWN0ZWQgdGltZXpvbmUgdG8gdGhlIGN1cnJlbnQgdGltZXN0YW1wIHRvIGdldCB0aGUgcmVhbCBzdGFydCB0aW1lc3RhbXAgZm9yIHRoZSBzZWxlY3RkIHRpbWV6b25lCiAgICAgICAgICAgICAgICAgICAgIyB0byBnZXQgdGhlIHJlYWwgc3RhcnQgdGltZXN0YW1wIGZvciB0aGUgc2VsZWN0ZCB0aW1lem9uZQogICAgICAgICAgICAgICAgICAgIGlmICggJFBhcmFte1RpbWVab25lfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFRpbWVTdGFtcCA9ICRTZWxmLT5fQWRkVGltZVpvbmUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaW1lU3RhbXAgPT4gJFRpbWVTdGFtcCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRpbWVab25lICA9PiAkUGFyYW17VGltZVpvbmV9LAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgbXkgJFN5c3RlbVRpbWUgPSAkVGltZU9iamVjdC0+VGltZVN0YW1wMlN5c3RlbVRpbWUoCiAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyA9PiAkVGltZVN0YW1wLAogICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgIG15ICggJHMsICRtLCAkaCwgJEQsICRNLCAkWSApID0gJFRpbWVPYmplY3QtPlN5c3RlbVRpbWUyRGF0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgU3lzdGVtVGltZSA9PiAkU3lzdGVtVGltZSwKICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAjIC0xIGJlY2F1c2UgdGhlIGN1cnJlbnQgdGltZSB3aWxsIGJlIGluY2x1ZGVkCiAgICAgICAgICAgICAgICAgICAgbXkgJENvdW50VXBjb21pbmcgPSAkRWxlbWVudC0+e1RpbWVSZWxhdGl2ZVVwY29taW5nQ291bnR9IC0gMTsKCiAgICAgICAgICAgICAgICAgICAgIyBhZGQgdGhlIHVwY29taW5nIGNvdW50IHRvIHRoZSBjb3VudCBwYXN0IGZvciB0aGUgY2FsY3VsYXRpb24KICAgICAgICAgICAgICAgICAgICBteSAkQ291bnRQYXN0ID0gJEVsZW1lbnQtPntUaW1lUmVsYXRpdmVDb3VudH0gKyAkQ291bnRVcGNvbWluZzsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCAkRWxlbWVudC0+e1RpbWVSZWxhdGl2ZVVuaXR9IGVxICdZZWFyJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgKCAkWSwgJE0sICREICkgPSBBZGRfRGVsdGFfWU1EKCAkWSwgJE0sICRELCAkQ291bnRVcGNvbWluZywgMCwgMCApOwogICAgICAgICAgICAgICAgICAgICAgICAkRWxlbWVudC0+e1RpbWVTdG9wfSA9IHNwcmludGYoICIlMDRkLSUwMmQtJTAyZCAlMDJkOiUwMmQ6JTAyZCIsICRZLCAxMiwgMzEsIDIzLCA1OSwgNTkgKTsKICAgICAgICAgICAgICAgICAgICAgICAgKCAkWSwgJE0sICREICkgPSBBZGRfRGVsdGFfWU1EKCAkWSwgJE0sICRELCAtJENvdW50UGFzdCwgMCwgMCApOwogICAgICAgICAgICAgICAgICAgICAgICAkRWxlbWVudC0+e1RpbWVTdGFydH0gPSBzcHJpbnRmKCAiJTA0ZC0lMDJkLSUwMmQgJTAyZDolMDJkOiUwMmQiLCAkWSwgMSwgMSwgMCwgMCwgMCApOwoKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzaWYgKCAkRWxlbWVudC0+e1RpbWVSZWxhdGl2ZVVuaXR9IGVxICdIYWxmWWVhcicgKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAjICRDb3VudFVwY29taW5nIHdhcyByZWR1Y2VkIGJ5IDEgYmVmb3JlLCB0aGlzIGhhcyB0byBiZSByZXZlcnRlZCBmb3IgaGFsZi15ZWFyCiAgICAgICAgICAgICAgICAgICAgICAgICRDb3VudFVwY29taW5nKys7CgogICAgICAgICAgICAgICAgICAgICAgICAoICRZLCAkTSwgJEQgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPSBBZGRfRGVsdGFfWU1EKCAkWSwgJE0sICRELCAwLCAoICRNID4gNiA/IDEgOiAwICkgKiA2IC0gJE0gKyAoIDYgKiAkQ291bnRVcGNvbWluZyApLCAwICk7CiAgICAgICAgICAgICAgICAgICAgICAgICRFbGVtZW50LT57VGltZVN0b3B9ID0gc3ByaW50ZigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICIlMDRkLSUwMmQtJTAyZCAlMDJkOiUwMmQ6JTAyZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkWSwgJE0sIERheXNfaW5fTW9udGgoICRZLCAkTSApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMjMsIDU5LCA1OQogICAgICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAgICAgIyAkQ291bnRQYXN0IHdhcyByZWR1Y2VkIGJ5IDEgYmVmb3JlLCB0aGlzIGhhcyB0byBiZSByZXZlcnRlZCBmb3IgaGFsZi15ZWFyCiAgICAgICAgICAgICAgICAgICAgICAgICMgICAgIEV4YW1wbGVzOgogICAgICAgICAgICAgICAgICAgICAgICAjICAgICBIYWxmLXllYXIgc2V0IHRvIDEsICRDb3VudFBhc3Qgd2lsbCBiZSAwIHRoZW4gLSAwICogNiA9IDAgKG1lYW5zIHRoaXMgaGFsZi15ZWFyKQogICAgICAgICAgICAgICAgICAgICAgICAjICAgICBIYWxmLXllYXIgc2V0IHRvIDIsICRDb3VudFBhc3Qgd2lsbCBiZSAxIHRoZW4gLSAxICogNiA9IDYgKG1lYW5zIGxhc3QgaGFsZi15ZWFyKQogICAgICAgICAgICAgICAgICAgICAgICAjICAgICBXaXRoIHRoZSBmaXgsIGV4YW1wbGUgMSB3aWxsIG1lYW4gbGFzdCBoYWxmLXllYXIgYW5kIGV4YW1wbGUgMiB3aWxsIG1lYW4KICAgICAgICAgICAgICAgICAgICAgICAgIyAgICAgbGFzdCB0d28gaGFsZi15ZWFycwogICAgICAgICAgICAgICAgICAgICAgICAkQ291bnRQYXN0Kys7CiAgICAgICAgICAgICAgICAgICAgICAgICggJFksICRNLCAkRCApID0gQWRkX0RlbHRhX1lNRCggJFksICRNLCAkRCwgMCwgLSRDb3VudFBhc3QgKiA2ICsgMSwgMCApOwogICAgICAgICAgICAgICAgICAgICAgICAkRWxlbWVudC0+e1RpbWVTdGFydH0gPSBzcHJpbnRmKCAiJTA0ZC0lMDJkLSUwMmQgJTAyZDolMDJkOiUwMmQiLCAkWSwgJE0sIDEsIDAsIDAsIDAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzaWYgKCAkRWxlbWVudC0+e1RpbWVSZWxhdGl2ZVVuaXR9IGVxICdRdWFydGVyJyApIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICMgJENvdW50VXBjb21pbmcgd2FzIHJlZHVjZWQgYnkgMSBiZWZvcmUsIHRoaXMgaGFzIHRvIGJlIHJldmVydGVkIGZvciBxdWFydGVyCiAgICAgICAgICAgICAgICAgICAgICAgICRDb3VudFVwY29taW5nKys7CgogICAgICAgICAgICAgICAgICAgICAgICBteSAkTGFzdFF1YXJ0ZXIgPSBjZWlsKCAkTSAvIDMgKSAtIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICggJFksICRNLCAkRCApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA9IEFkZF9EZWx0YV9ZTUQoICRZLCAkTSwgJEQsIDAsICRMYXN0UXVhcnRlciAqIDMgLSAkTSArICggMyAqICRDb3VudFVwY29taW5nICksIDAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgJEVsZW1lbnQtPntUaW1lU3RvcH0gPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIiUwNGQtJTAyZC0lMDJkICUwMmQ6JTAyZDolMDJkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRZLCAkTSwgRGF5c19pbl9Nb250aCggJFksICRNICksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAyMywgNTksIDU5CiAgICAgICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgICAgICAjICRDb3VudFBhc3Qgd2FzIHJlZHVjZWQgYnkgMSBiZWZvcmUsIHRoaXMgaGFzIHRvIGJlIHJldmVydGVkIGZvciBxdWFydGVyCiAgICAgICAgICAgICAgICAgICAgICAgICMgICAgIEV4YW1wbGVzOgogICAgICAgICAgICAgICAgICAgICAgICAjICAgICBRdWFydGVyIHNldCB0byAxLCAkQ291bnRQYXN0IHdpbGwgYmUgMCB0aGVuIC0gMCAqIDMgPSAwIChtZWFucyB0aGlzIHF1YXJ0ZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICMgICAgIFF1YXJ0ZXIgc2V0IHRvIDIsICRDb3VudFBhc3Qgd2lsbCBiZSAxIHRoZW4gLSAxICogMyA9IDMgKG1lYW5zIGxhc3QgcXVhcnRlcikKICAgICAgICAgICAgICAgICAgICAgICAgIyAgICAgV2l0aCB0aGUgZml4LCBleGFtcGxlIDEgd2lsbCBtZWFuIGxhc3QgcXVhcnRlciBhbmQgZXhhbXBsZSAyIHdpbGwgbWVhbgogICAgICAgICAgICAgICAgICAgICAgICAjICAgICBsYXN0IHR3byBxdWFydGVycwogICAgICAgICAgICAgICAgICAgICAgICAkQ291bnRQYXN0Kys7CiAgICAgICAgICAgICAgICAgICAgICAgICggJFksICRNLCAkRCApID0gQWRkX0RlbHRhX1lNRCggJFksICRNLCAkRCwgMCwgLSRDb3VudFBhc3QgKiAzICsgMSwgMCApOwogICAgICAgICAgICAgICAgICAgICAgICAkRWxlbWVudC0+e1RpbWVTdGFydH0gPSBzcHJpbnRmKCAiJTA0ZC0lMDJkLSUwMmQgJTAyZDolMDJkOiUwMmQiLCAkWSwgJE0sIDEsIDAsIDAsIDAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzaWYgKCAkRWxlbWVudC0+e1RpbWVSZWxhdGl2ZVVuaXR9IGVxICdNb250aCcgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICggJFksICRNLCAkRCApID0gQWRkX0RlbHRhX1lNRCggJFksICRNLCAkRCwgMCwgJENvdW50VXBjb21pbmcsIDAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgJEVsZW1lbnQtPntUaW1lU3RvcH0gPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIiUwNGQtJTAyZC0lMDJkICUwMmQ6JTAyZDolMDJkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRZLCAkTSwgRGF5c19pbl9Nb250aCggJFksICRNICksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAyMywgNTksIDU5CiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICggJFksICRNLCAkRCApID0gQWRkX0RlbHRhX1lNRCggJFksICRNLCAkRCwgMCwgLSRDb3VudFBhc3QsIDAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgJEVsZW1lbnQtPntUaW1lU3RhcnR9ID0gc3ByaW50ZiggIiUwNGQtJTAyZC0lMDJkICUwMmQ6JTAyZDolMDJkIiwgJFksICRNLCAxLCAwLCAwLCAwICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2lmICggJEVsZW1lbnQtPntUaW1lUmVsYXRpdmVVbml0fSBlcSAnV2VlaycgKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAjICRDb3VudFVwY29taW5nIHdhcyByZWR1Y2VkIGJ5IDEgYmVmb3JlLCB0aGlzIGhhcyB0byBiZSByZXZlcnRlZCBmb3Igd2VlawogICAgICAgICAgICAgICAgICAgICAgICAkQ291bnRVcGNvbWluZysrOwoKICAgICAgICAgICAgICAgICAgICAgICAgKCAkWSwgJE0sICREICkgPSBBZGRfRGVsdGFfWU1EKCAkWSwgJE0sICRELCAwLCAwLCAoICRDb3VudFVwY29taW5nICogNyApIC0gMSApOwogICAgICAgICAgICAgICAgICAgICAgICAkRWxlbWVudC0+e1RpbWVTdG9wfSA9IHNwcmludGYoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiJTA0ZC0lMDJkLSUwMmQgJTAyZDolMDJkOiUwMmQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFksICRNLCAkRCwgMjMsIDU5LCA1OQogICAgICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAgICAgIyAkQ291bnRQYXN0IHdhcyByZWR1Y2VkIGJ5IDEgYmVmb3JlLCB0aGlzIGhhcyB0byBiZSByZXZlcnRlZCBmb3IgV2VlawogICAgICAgICAgICAgICAgICAgICAgICAjICAgICBFeGFtcGxlczoKICAgICAgICAgICAgICAgICAgICAgICAgIyAgICAgV2VlayBzZXQgdG8gMSwgJENvdW50UGFzdCB3aWxsIGJlIDAgdGhlbiAtIDAgKiA3ID0gMCAobWVhbnMgdG9kYXkpCiAgICAgICAgICAgICAgICAgICAgICAgICMgICAgIFdlZWsgc2V0IHRvIDIsICRDb3VudFBhc3Qgd2lsbCBiZSAxIHRoZW4gLSAxICogNyA9IDcgKG1lYW5zIGxhc3Qgd2VlaykKICAgICAgICAgICAgICAgICAgICAgICAgIyAgICAgV2l0aCB0aGUgZml4LCBleGFtcGxlIDEgd2lsbCBtZWFuIGxhc3Qgd2VlayBhbmQgZXhhbXBsZSAyIHdpbGwgbWVhbgogICAgICAgICAgICAgICAgICAgICAgICAjICAgICBsYXN0IHR3byB3ZWVrcwogICAgICAgICAgICAgICAgICAgICAgICAkQ291bnRQYXN0Kys7CiAgICAgICAgICAgICAgICAgICAgICAgICggJFksICRNLCAkRCApID0gQWRkX0RlbHRhX0RheXMoICRZLCAkTSwgJEQsIC0kQ291bnRQYXN0ICogNyArIDEgKTsKICAgICAgICAgICAgICAgICAgICAgICAgJEVsZW1lbnQtPntUaW1lU3RhcnR9ID0gc3ByaW50ZiggIiUwNGQtJTAyZC0lMDJkICUwMmQ6JTAyZDolMDJkIiwgJFksICRNLCAkRCwgMCwgMCwgMCApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNpZiAoICRFbGVtZW50LT57VGltZVJlbGF0aXZlVW5pdH0gZXEgJ0RheScgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICggJFksICRNLCAkRCApID0gQWRkX0RlbHRhX1lNRCggJFksICRNLCAkRCwgMCwgMCwgJENvdW50VXBjb21pbmcgKTsKICAgICAgICAgICAgICAgICAgICAgICAgJEVsZW1lbnQtPntUaW1lU3RvcH0gPSBzcHJpbnRmKCAiJTA0ZC0lMDJkLSUwMmQgJTAyZDolMDJkOiUwMmQiLCAkWSwgJE0sICRELCAyMywgNTksIDU5ICk7CiAgICAgICAgICAgICAgICAgICAgICAgICggJFksICRNLCAkRCApID0gQWRkX0RlbHRhX1lNRCggJFksICRNLCAkRCwgMCwgMCwgLSRDb3VudFBhc3QgKTsKICAgICAgICAgICAgICAgICAgICAgICAgJEVsZW1lbnQtPntUaW1lU3RhcnR9ID0gc3ByaW50ZiggIiUwNGQtJTAyZC0lMDJkICUwMmQ6JTAyZDolMDJkIiwgJFksICRNLCAkRCwgMCwgMCwgMCApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNpZiAoICRFbGVtZW50LT57VGltZVJlbGF0aXZlVW5pdH0gZXEgJ0hvdXInICkgewogICAgICAgICAgICAgICAgICAgICAgICAoICRZLCAkTSwgJEQsICRoLCAkbSwgJHMgKSA9IEFkZF9EZWx0YV9ESE1TKCAkWSwgJE0sICRELCAkaCwgJG0sICRzLCAwLCAkQ291bnRVcGNvbWluZywgMCwgMCApOwogICAgICAgICAgICAgICAgICAgICAgICAkRWxlbWVudC0+e1RpbWVTdG9wfSA9IHNwcmludGYoICIlMDRkLSUwMmQtJTAyZCAlMDJkOiUwMmQ6JTAyZCIsICRZLCAkTSwgJEQsICRoLCA1OSwgNTkgKTsKICAgICAgICAgICAgICAgICAgICAgICAgKCAkWSwgJE0sICRELCAkaCwgJG0sICRzICkgPSBBZGRfRGVsdGFfREhNUyggJFksICRNLCAkRCwgJGgsICRtLCAkcywgMCwgLSRDb3VudFBhc3QsIDAsIDAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgJEVsZW1lbnQtPntUaW1lU3RhcnR9ID0gc3ByaW50ZiggIiUwNGQtJTAyZC0lMDJkICUwMmQ6JTAyZDolMDJkIiwgJFksICRNLCAkRCwgJGgsIDAsIDAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzaWYgKCAkRWxlbWVudC0+e1RpbWVSZWxhdGl2ZVVuaXR9IGVxICdNaW51dGUnICkgewogICAgICAgICAgICAgICAgICAgICAgICAoICRZLCAkTSwgJEQsICRoLCAkbSwgJHMgKSA9IEFkZF9EZWx0YV9ESE1TKCAkWSwgJE0sICRELCAkaCwgJG0sICRzLCAwLCAwLCAkQ291bnRVcGNvbWluZywgMCApOwogICAgICAgICAgICAgICAgICAgICAgICAkRWxlbWVudC0+e1RpbWVTdG9wfSA9IHNwcmludGYoICIlMDRkLSUwMmQtJTAyZCAlMDJkOiUwMmQ6JTAyZCIsICRZLCAkTSwgJEQsICRoLCAkbSwgNTkgKTsKICAgICAgICAgICAgICAgICAgICAgICAgKCAkWSwgJE0sICRELCAkaCwgJG0sICRzICkgPSBBZGRfRGVsdGFfREhNUyggJFksICRNLCAkRCwgJGgsICRtLCAkcywgMCwgMCwgLSRDb3VudFBhc3QsIDAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgJEVsZW1lbnQtPntUaW1lU3RhcnR9ID0gc3ByaW50ZiggIiUwNGQtJTAyZC0lMDJkICUwMmQ6JTAyZDolMDJkIiwgJFksICRNLCAkRCwgJGgsICRtLCAwICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2lmICggJEVsZW1lbnQtPntUaW1lUmVsYXRpdmVVbml0fSBlcSAnU2Vjb25kJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgKCAkWSwgJE0sICRELCAkaCwgJG0sICRzICkgPSBBZGRfRGVsdGFfREhNUyggJFksICRNLCAkRCwgJGgsICRtLCAkcywgMCwgMCwgMCwgJENvdW50VXBjb21pbmcgKTsKICAgICAgICAgICAgICAgICAgICAgICAgJEVsZW1lbnQtPntUaW1lU3RvcH0gPSBzcHJpbnRmKCAiJTA0ZC0lMDJkLSUwMmQgJTAyZDolMDJkOiUwMmQiLCAkWSwgJE0sICRELCAkaCwgJG0sICRzICk7CiAgICAgICAgICAgICAgICAgICAgICAgICggJFksICRNLCAkRCwgJGgsICRtLCAkcyApID0gQWRkX0RlbHRhX0RITVMoICRZLCAkTSwgJEQsICRoLCAkbSwgJHMsIDAsIDAsIDAsIC0kQ291bnRQYXN0ICk7CiAgICAgICAgICAgICAgICAgICAgICAgICRFbGVtZW50LT57VGltZVN0YXJ0fSA9IHNwcmludGYoICIlMDRkLSUwMmQtJTAyZCAlMDJkOiUwMmQ6JTAyZCIsICRZLCAkTSwgJEQsICRoLCAkbSwgJHMgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlICRFbGVtZW50LT57VGltZVJlbGF0aXZlVW5pdH07CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlICRFbGVtZW50LT57VGltZVJlbGF0aXZlQ291bnR9OwogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSAkRWxlbWVudC0+e1RpbWVSZWxhdGl2ZVVwY29taW5nQ291bnR9OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRUaXRsZVRpbWVTdGFydCA9ICRFbGVtZW50LT57VGltZVN0YXJ0fTsKICAgICAgICAgICAgICAgICRUaXRsZVRpbWVTdG9wICA9ICRFbGVtZW50LT57VGltZVN0b3B9OwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIFNlbGVjdCBBbGwgZnVuY3Rpb24gbmVlZGVkIGZyb20gb3Rycy5HZW5lcmF0ZVN0YXRzLnBsIGFuZCBmaXhlZCB2YWx1ZXMgb2YgdGhlIGZyb250ZW5kCiAgICAgICAgICAgIGVsc2lmICggISRFbGVtZW50LT57U2VsZWN0ZWRWYWx1ZXN9WzBdICkgewogICAgICAgICAgICAgICAgbXkgQFZhbHVlcyA9IGtleXMoICV7ICRFbGVtZW50LT57VmFsdWVzfSB9ICk7CiAgICAgICAgICAgICAgICAkRWxlbWVudC0+e1NlbGVjdGVkVmFsdWVzfSA9IFxAVmFsdWVzOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdXNoIEB7ICROZXdQYXJhbXskVXNlfSB9LCAkRWxlbWVudDsKICAgICAgICB9CiAgICB9CgogICAgJVBhcmFtID0gJU5ld1BhcmFtOwoKICAgICMgZ2V0IGFsbCByZXN0cmljdGlvbnMgZm9yIHRoZSBzZWFyY2gKICAgIG15ICVSZXN0cmljdGlvbkF0dHJpYnV0ZTsKICAgIGZvciBteSAkUmVzdHJpY3Rpb25QYXJ0ICggQHsgJFBhcmFte1VzZUFzUmVzdHJpY3Rpb259IH0gKSB7CiAgICAgICAgbXkgJEVsZW1lbnQgPSAkUmVzdHJpY3Rpb25QYXJ0LT57RWxlbWVudH07CiAgICAgICAgaWYgKCAkUmVzdHJpY3Rpb25QYXJ0LT57QmxvY2t9IGVxICdJbnB1dEZpZWxkJyApIHsKICAgICAgICAgICAgJFJlc3RyaWN0aW9uQXR0cmlidXRleyRFbGVtZW50fSA9ICRSZXN0cmljdGlvblBhcnQtPntTZWxlY3RlZFZhbHVlc31bMF07CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJFJlc3RyaWN0aW9uUGFydC0+e0Jsb2NrfSBlcSAnU2VsZWN0RmllbGQnICkgewogICAgICAgICAgICAkUmVzdHJpY3Rpb25BdHRyaWJ1dGV7JEVsZW1lbnR9ID0gJFJlc3RyaWN0aW9uUGFydC0+e1NlbGVjdGVkVmFsdWVzfVswXTsKICAgICAgICB9CiAgICAgICAgZWxzaWYgKCAkUmVzdHJpY3Rpb25QYXJ0LT57QmxvY2t9IGVxICdUaW1lJyApIHsKCiAgICAgICAgICAgICMgc3VidHJhY3QgdGhlIHNlbGVjdGVkIHRpbWV6b25lIChpZiB0aGUgdGltZXpvbmUgZXhpc3RzKSB0byBnZXQgdGhlIFVUQyB0aW1lIGZvciB0aGUgc2VhcmNoIHBhcmFtZXRlcgogICAgICAgICAgICAkUmVzdHJpY3Rpb25BdHRyaWJ1dGV7ICRSZXN0cmljdGlvblBhcnQtPntWYWx1ZXN9e1RpbWVTdG9wfSB9ID0gJFNlbGYtPl9TdWJ0cmFjdFRpbWVab25lKAogICAgICAgICAgICAgICAgVGltZVN0YW1wID0+ICRSZXN0cmljdGlvblBhcnQtPntUaW1lU3RvcH0sCiAgICAgICAgICAgICAgICBUaW1lWm9uZSAgPT4gJFBhcmFte1RpbWVab25lfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgc3VidHJhY3QgdGhlIHNlbGVjdGVkIHRpbWV6b25lIChpZiB0aGUgdGltZXpvbmUgZXhpc3RzKSB0byBnZXQgdGhlIFVUQyB0aW1lIGZvciB0aGUgc2VhcmNoIHBhcmFtZXRlcgogICAgICAgICAgICAkUmVzdHJpY3Rpb25BdHRyaWJ1dGV7ICRSZXN0cmljdGlvblBhcnQtPntWYWx1ZXN9e1RpbWVTdGFydH0gfSA9ICRTZWxmLT5fU3VidHJhY3RUaW1lWm9uZSgKICAgICAgICAgICAgICAgIFRpbWVTdGFtcCA9PiAkUmVzdHJpY3Rpb25QYXJ0LT57VGltZVN0YXJ0fSwKICAgICAgICAgICAgICAgIFRpbWVab25lICA9PiAkUGFyYW17VGltZVpvbmV9LAogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFJlc3RyaWN0aW9uQXR0cmlidXRleyRFbGVtZW50fSA9ICRSZXN0cmljdGlvblBhcnQtPntTZWxlY3RlZFZhbHVlc307CiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IG5lZWRlZCBvYmplY3RzCiAgICBteSAkTGFuZ3VhZ2VPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Okxhbmd1YWdlJyk7CiAgICBteSAkVXNlck9iamVjdCAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VXNlcicpOwoKICAgIG15ICVVc2VyID0gJFVzZXJPYmplY3QtPkdldFVzZXJEYXRhKAogICAgICAgIFVzZXJJRCA9PiAkVXNlcklELAogICAgKTsKCiAgICAjIGdldCB0aGUgc2VsZWN0ZWQgWHZhbHVlCiAgICBteSAkWHZhbHVlID0ge307CiAgICBteSAoCiAgICAgICAgJFZTWWVhciwgICAgICRWU01vbnRoLCAgICAgJFZTRGF5LCAgICAgJFZTSG91ciwgICAgICRWU01pbnV0ZSwgICAgICRWU1NlY29uZCwKICAgICAgICAkVlNTdG9wWWVhciwgJFZTU3RvcE1vbnRoLCAkVlNTdG9wRGF5LCAkVlNTdG9wSG91ciwgJFZTU3RvcE1pbnV0ZSwgJFZTU3RvcFNlY29uZAogICAgKTsKICAgIG15ICRUaW1lQWJzb2x1dFN0b3BVbml4VGltZSA9IDA7CiAgICBteSAkQ291bnQgICAgICAgICAgICAgICAgICAgPSAwOwogICAgbXkgJE1vbnRoQXJyYXlSZWYgICAgICAgICAgID0gX01vbnRoQXJyYXkoKTsKCiAgICBteSAkRWxlbWVudCA9ICRQYXJhbXtVc2VBc1h2YWx1ZX1bMF07CiAgICBpZiAoICRFbGVtZW50LT57QmxvY2t9IGVxICdUaW1lJyApIHsKICAgICAgICBteSAoCiAgICAgICAgICAgICRZZWFyLCAgICRNb250aCwgICAkRGF5LCAgICRIb3VyLCAgICRNaW51dGUsICAgJFNlY29uZCwKICAgICAgICAgICAgJFRvWWVhciwgJFRvTW9udGgsICRUb0RheSwgJFRvSG91ciwgJFRvTWludXRlLCAkVG9TZWNvbmQKICAgICAgICApOwogICAgICAgIGlmICggJEVsZW1lbnQtPntUaW1lU3RhcnR9ID1+IG17XihcZFxkXGRcZCktKFxkXGQpLShcZFxkKVxzKFxkXGQpOihcZFxkKTooXGRcZCkkfWl4ICkgewogICAgICAgICAgICAkWWVhciAgID0gJFZTWWVhciAgID0gJDE7CiAgICAgICAgICAgICRNb250aCAgPSAkVlNNb250aCAgPSBpbnQgJDI7CiAgICAgICAgICAgICREYXkgICAgPSAkVlNEYXkgICAgPSBpbnQgJDM7CiAgICAgICAgICAgICRIb3VyICAgPSAkVlNIb3VyICAgPSBpbnQgJDQ7CiAgICAgICAgICAgICRNaW51dGUgPSAkVlNNaW51dGUgPSBpbnQgJDU7CiAgICAgICAgICAgICRTZWNvbmQgPSAkVlNTZWNvbmQgPSBpbnQgJDY7CiAgICAgICAgfQoKICAgICAgICAkVGltZUFic29sdXRTdG9wVW5peFRpbWUgPSAkVGltZU9iamVjdC0+VGltZVN0YW1wMlN5c3RlbVRpbWUoCiAgICAgICAgICAgIFN0cmluZyA9PiAkRWxlbWVudC0+e1RpbWVTdG9wfSwKICAgICAgICApOwogICAgICAgIG15ICRUaW1lU3RhcnQgPSAwOwogICAgICAgIG15ICRUaW1lU3RvcCAgPSAwOwoKICAgICAgICAkQ291bnQgPSAkRWxlbWVudC0+e1RpbWVTY2FsZUNvdW50fSA/ICRFbGVtZW50LT57VGltZVNjYWxlQ291bnR9IDogMTsKCiAgICAgICAgIyBpbiB0aGVzZSBjb25zdGVsbGF0aW9uICRDb3VudCA+IDEgaXMgbm90IHVzZWZ1bCEhCiAgICAgICAgaWYgKAogICAgICAgICAgICAkUGFyYW17VXNlQXNWYWx1ZVNlcmllc30KICAgICAgICAgICAgJiYgJFBhcmFte1VzZUFzVmFsdWVTZXJpZXN9WzBde0Jsb2NrfQogICAgICAgICAgICAmJiAkUGFyYW17VXNlQXNWYWx1ZVNlcmllc31bMF17QmxvY2t9IGVxICdUaW1lJwogICAgICAgICAgICAmJiAkRWxlbWVudC0+e1NlbGVjdGVkVmFsdWVzfVswXSBlcSAnRGF5JwogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICAkQ291bnQgPSAxOwogICAgICAgIH0KCiAgICAgICAgaWYgKCAkRWxlbWVudC0+e1NlbGVjdGVkVmFsdWVzfVswXSBlcSAnTWludXRlJyApIHsKICAgICAgICAgICAgJFNlY29uZCA9IDA7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJEVsZW1lbnQtPntTZWxlY3RlZFZhbHVlc31bMF0gZXEgJ0hvdXInICkgewogICAgICAgICAgICAkU2Vjb25kID0gMDsKICAgICAgICAgICAgJE1pbnV0ZSA9IDA7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJEVsZW1lbnQtPntTZWxlY3RlZFZhbHVlc31bMF0gZXEgJ0RheScgKSB7CiAgICAgICAgICAgICRTZWNvbmQgPSAwOwogICAgICAgICAgICAkTWludXRlID0gMDsKICAgICAgICAgICAgJEhvdXIgICA9IDA7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJEVsZW1lbnQtPntTZWxlY3RlZFZhbHVlc31bMF0gZXEgJ1dlZWsnICkgewogICAgICAgICAgICAkU2Vjb25kID0gMDsKICAgICAgICAgICAgJE1pbnV0ZSA9IDA7CiAgICAgICAgICAgICRIb3VyICAgPSAwOwogICAgICAgICAgICAoICRZZWFyLCAkTW9udGgsICREYXkgKSA9IE1vbmRheV9vZl9XZWVrKCBXZWVrX29mX1llYXIoICRZZWFyLCAkTW9udGgsICREYXkgKSApCiAgICAgICAgfQogICAgICAgIGVsc2lmICggJEVsZW1lbnQtPntTZWxlY3RlZFZhbHVlc31bMF0gZXEgJ01vbnRoJyApIHsKICAgICAgICAgICAgJFNlY29uZCA9IDA7CiAgICAgICAgICAgICRNaW51dGUgPSAwOwogICAgICAgICAgICAkSG91ciAgID0gMDsKICAgICAgICAgICAgJERheSAgICA9IDE7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJEVsZW1lbnQtPntTZWxlY3RlZFZhbHVlc31bMF0gZXEgJ1F1YXJ0ZXInICkgewogICAgICAgICAgICAkU2Vjb25kID0gMDsKICAgICAgICAgICAgJE1pbnV0ZSA9IDA7CiAgICAgICAgICAgICRIb3VyICAgPSAwOwogICAgICAgICAgICAkRGF5ICAgID0gMTsKCiAgICAgICAgICAgICMgY2FsY3VsYXRlIHRoZSBzdGFydCBtb250aCBmb3IgdGhlIHF1YXJ0ZXIKICAgICAgICAgICAgbXkgJFF1YXJ0ZXJOdW0gPSBjZWlsKCAkTW9udGggLyAzICk7CiAgICAgICAgICAgICRNb250aCA9ICggJFF1YXJ0ZXJOdW0gKiAzICkgLSAyOwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRFbGVtZW50LT57U2VsZWN0ZWRWYWx1ZXN9WzBdIGVxICdIYWxmWWVhcicgKSB7CiAgICAgICAgICAgICRTZWNvbmQgPSAwOwogICAgICAgICAgICAkTWludXRlID0gMDsKICAgICAgICAgICAgJEhvdXIgICA9IDA7CiAgICAgICAgICAgICREYXkgICAgPSAxOwoKICAgICAgICAgICAgIyBjYWxjdWxhdGUgdGhlIHN0YXJ0IG1vbnRoIGZvciB0aGUgaGFsZi15ZWFyCiAgICAgICAgICAgIG15ICRIYWxmWWVhck51bSA9IGNlaWwoICRNb250aCAvIDYgKTsKICAgICAgICAgICAgJE1vbnRoID0gKCAkSGFsZlllYXJOdW0gKiA2ICkgLSA1OwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRFbGVtZW50LT57U2VsZWN0ZWRWYWx1ZXN9WzBdIGVxICdZZWFyJyApIHsKICAgICAgICAgICAgJFNlY29uZCA9IDA7CiAgICAgICAgICAgICRNaW51dGUgPSAwOwogICAgICAgICAgICAkSG91ciAgID0gMDsKICAgICAgICAgICAgJERheSAgICA9IDE7CiAgICAgICAgICAgICRNb250aCAgPSAxOwogICAgICAgIH0KCiAgICAgICAgIyBGSVhNRSBUaW1laGVhZGVyIHp1c2FtbWVuYmF1ZW4KICAgICAgICB3aGlsZSAoCiAgICAgICAgICAgICEkVGltZVN0b3AKICAgICAgICAgICAgfHwgJFRpbWVPYmplY3QtPlRpbWVTdGFtcDJTeXN0ZW1UaW1lKCBTdHJpbmcgPT4gJFRpbWVTdG9wICkKICAgICAgICAgICAgPCAkVGltZUFic29sdXRTdG9wVW5peFRpbWUKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgJFRpbWVTdGFydCA9IHNwcmludGYoCiAgICAgICAgICAgICAgICAiJTA0ZC0lMDJkLSUwMmQgJTAyZDolMDJkOiUwMmQiLAogICAgICAgICAgICAgICAgJFllYXIsICRNb250aCwgJERheSwgJEhvdXIsICRNaW51dGUsICRTZWNvbmQKICAgICAgICAgICAgKTsKICAgICAgICAgICAgaWYgKCAkRWxlbWVudC0+e1NlbGVjdGVkVmFsdWVzfVswXSBlcSAnU2Vjb25kJyApIHsKICAgICAgICAgICAgICAgICggJFRvWWVhciwgJFRvTW9udGgsICRUb0RheSwgJFRvSG91ciwgJFRvTWludXRlLCAkVG9TZWNvbmQgKSA9IEFkZF9EZWx0YV9ESE1TKAogICAgICAgICAgICAgICAgICAgICRZZWFyLCAkTW9udGgsICREYXksICRIb3VyLCAkTWludXRlLCAkU2Vjb25kLCAwLCAwLCAwLAogICAgICAgICAgICAgICAgICAgICRDb3VudCAtIDEKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgICAgIEBIZWFkZXJMaW5lLAogICAgICAgICAgICAgICAgICAgIHNwcmludGYoCiAgICAgICAgICAgICAgICAgICAgICAgICIlMDJkOiUwMmQ6JTAyZC0lMDJkOiUwMmQ6JTAyZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICRIb3VyLCAkTWludXRlLCAkU2Vjb25kLCAkVG9Ib3VyLCAkVG9NaW51dGUsICRUb1NlY29uZAogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2lmICggJEVsZW1lbnQtPntTZWxlY3RlZFZhbHVlc31bMF0gZXEgJ01pbnV0ZScgKSB7CiAgICAgICAgICAgICAgICAoICRUb1llYXIsICRUb01vbnRoLCAkVG9EYXksICRUb0hvdXIsICRUb01pbnV0ZSwgJFRvU2Vjb25kICkgPSBBZGRfRGVsdGFfREhNUygKICAgICAgICAgICAgICAgICAgICAkWWVhciwgJE1vbnRoLCAkRGF5LCAkSG91ciwgJE1pbnV0ZSwgJFNlY29uZCwgMCwgMCwgJENvdW50LAogICAgICAgICAgICAgICAgICAgIC0xCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgICAgICBASGVhZGVyTGluZSwKICAgICAgICAgICAgICAgICAgICBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAiJTAyZDolMDJkOiUwMmQtJTAyZDolMDJkOiUwMmQiLAogICAgICAgICAgICAgICAgICAgICAgICAkSG91ciwgJE1pbnV0ZSwgJFNlY29uZCwgJFRvSG91ciwgJFRvTWludXRlLCAkVG9TZWNvbmQKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNpZiAoICRFbGVtZW50LT57U2VsZWN0ZWRWYWx1ZXN9WzBdIGVxICdIb3VyJyApIHsKICAgICAgICAgICAgICAgICggJFRvWWVhciwgJFRvTW9udGgsICRUb0RheSwgJFRvSG91ciwgJFRvTWludXRlLCAkVG9TZWNvbmQgKSA9IEFkZF9EZWx0YV9ESE1TKAogICAgICAgICAgICAgICAgICAgICRZZWFyLCAkTW9udGgsICREYXksICRIb3VyLCAkTWludXRlLCAkU2Vjb25kLCAwLCAkQ291bnQsIDAsCiAgICAgICAgICAgICAgICAgICAgLTEKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgICAgIEBIZWFkZXJMaW5lLAogICAgICAgICAgICAgICAgICAgIHNwcmludGYoCiAgICAgICAgICAgICAgICAgICAgICAgICIlMDJkOiUwMmQ6JTAyZC0lMDJkOiUwMmQ6JTAyZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICRIb3VyLCAkTWludXRlLCAkU2Vjb25kLCAkVG9Ib3VyLCAkVG9NaW51dGUsICRUb1NlY29uZAogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2lmICggJEVsZW1lbnQtPntTZWxlY3RlZFZhbHVlc31bMF0gZXEgJ0RheScgKSB7CiAgICAgICAgICAgICAgICAoICRUb1llYXIsICRUb01vbnRoLCAkVG9EYXksICRUb0hvdXIsICRUb01pbnV0ZSwgJFRvU2Vjb25kICkgPSBBZGRfRGVsdGFfREhNUygKICAgICAgICAgICAgICAgICAgICAkWWVhciwgJE1vbnRoLCAkRGF5LCAkSG91ciwgJE1pbnV0ZSwgJFNlY29uZCwgJENvdW50LCAwLCAwLAogICAgICAgICAgICAgICAgICAgIC0xCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgbXkgJERvdyA9IERheV9vZl9XZWVrKCAkWWVhciwgJE1vbnRoLCAkRGF5ICk7CiAgICAgICAgICAgICAgICAkRG93ID0gJExhbmd1YWdlT2JqZWN0LT5UcmFuc2xhdGUoIERheV9vZl9XZWVrX0FiYnJldmlhdGlvbigkRG93KSApOwogICAgICAgICAgICAgICAgaWYgKCAkVG9EYXkgZXEgJERheSApIHsKICAgICAgICAgICAgICAgICAgICBwdXNoIEBIZWFkZXJMaW5lLCAiJERvdyAkRGF5IjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHB1c2goCiAgICAgICAgICAgICAgICAgICAgICAgIEBIZWFkZXJMaW5lLAogICAgICAgICAgICAgICAgICAgICAgICBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIiUwMmQuJTAyZC4lMDRkIC0gJTAyZC4lMDJkLiUwNGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERheSwgJE1vbnRoLCAkWWVhciwgJFRvRGF5LCAkVG9Nb250aCwgJFRvWWVhcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCAkRWxlbWVudC0+e1NlbGVjdGVkVmFsdWVzfVswXSBlcSAnV2VlaycgKSB7CiAgICAgICAgICAgICAgICAoICRUb1llYXIsICRUb01vbnRoLCAkVG9EYXkgKSA9IEFkZF9EZWx0YV9ZTUQoICRZZWFyLCAkTW9udGgsICREYXksIDAsIDAsICRDb3VudCAqIDcgKTsKICAgICAgICAgICAgICAgICggJFRvWWVhciwgJFRvTW9udGgsICRUb0RheSwgJFRvSG91ciwgJFRvTWludXRlLCAkVG9TZWNvbmQgKSA9IEFkZF9EZWx0YV9ESE1TKAogICAgICAgICAgICAgICAgICAgICRUb1llYXIsICRUb01vbnRoLCAkVG9EYXksICRIb3VyLCAkTWludXRlLCAkU2Vjb25kLCAwLCAwLCAwLAogICAgICAgICAgICAgICAgICAgIC0xCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgbXkgJVdlZWtOdW07CiAgICAgICAgICAgICAgICAoICRXZWVrTnVte1dlZWt9LCAkV2Vla051bXtZZWFyfSApID0gV2Vla19vZl9ZZWFyKCAkWWVhciwgJE1vbnRoLCAkRGF5ICk7CiAgICAgICAgICAgICAgICBteSAkVHJhbnNsYXRlV2VlayA9ICRMYW5ndWFnZU9iamVjdC0+VHJhbnNsYXRlKCd3ZWVrJyk7CiAgICAgICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgICAgIEBIZWFkZXJMaW5lLAogICAgICAgICAgICAgICAgICAgIHNwcmludGYoICIkVHJhbnNsYXRlV2VlayAlMDJkLSUwNGQgLSAiLCAkV2Vla051bXtXZWVrfSwgJFdlZWtOdW17WWVhcn0gKSAuCiAgICAgICAgICAgICAgICAgICAgICAgIHNwcmludGYoCiAgICAgICAgICAgICAgICAgICAgICAgICIlMDJkLiUwMmQuJTA0ZCAtICUwMmQuJTAyZC4lMDRkIiwKICAgICAgICAgICAgICAgICAgICAgICAgJERheSwgJE1vbnRoLCAkWWVhciwgJFRvRGF5LCAkVG9Nb250aCwgJFRvWWVhcgogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2lmICggJEVsZW1lbnQtPntTZWxlY3RlZFZhbHVlc31bMF0gZXEgJ01vbnRoJyApIHsKICAgICAgICAgICAgICAgICggJFRvWWVhciwgJFRvTW9udGgsICRUb0RheSApID0gQWRkX0RlbHRhX1lNRCggJFllYXIsICRNb250aCwgJERheSwgMCwgJENvdW50LCAwICk7CiAgICAgICAgICAgICAgICAoICRUb1llYXIsICRUb01vbnRoLCAkVG9EYXksICRUb0hvdXIsICRUb01pbnV0ZSwgJFRvU2Vjb25kICkgPSBBZGRfRGVsdGFfREhNUygKICAgICAgICAgICAgICAgICAgICAkVG9ZZWFyLCAkVG9Nb250aCwgJFRvRGF5LCAkSG91ciwgJE1pbnV0ZSwgJFNlY29uZCwgMCwgMCwgMCwKICAgICAgICAgICAgICAgICAgICAtMQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmICggJFRvTW9udGggZXEgJE1vbnRoICkgewogICAgICAgICAgICAgICAgICAgIG15ICRUcmFuc2xhdGVNb250aCA9ICRMYW5ndWFnZU9iamVjdC0+VHJhbnNsYXRlKCAkTW9udGhBcnJheVJlZi0+WyRNb250aF0gKTsKICAgICAgICAgICAgICAgICAgICBwdXNoIEBIZWFkZXJMaW5lLCAiJFRyYW5zbGF0ZU1vbnRoICRNb250aCI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgICAgICAgICBASGVhZGVyTGluZSwKICAgICAgICAgICAgICAgICAgICAgICAgc3ByaW50ZigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICIlMDJkLiUwMmQuJTA0ZCAtICUwMmQuJTAyZC4lMDRkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICREYXksICRNb250aCwgJFllYXIsICRUb0RheSwgJFRvTW9udGgsICRUb1llYXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2lmICggJEVsZW1lbnQtPntTZWxlY3RlZFZhbHVlc31bMF0gZXEgJ1F1YXJ0ZXInICkgewogICAgICAgICAgICAgICAgKCAkVG9ZZWFyLCAkVG9Nb250aCwgJFRvRGF5ICkgPSBBZGRfRGVsdGFfWU1EKCAkWWVhciwgJE1vbnRoLCAkRGF5LCAwLCAkQ291bnQgKiAzLCAwICk7CiAgICAgICAgICAgICAgICAoICRUb1llYXIsICRUb01vbnRoLCAkVG9EYXksICRUb0hvdXIsICRUb01pbnV0ZSwgJFRvU2Vjb25kICkgPSBBZGRfRGVsdGFfREhNUygKICAgICAgICAgICAgICAgICAgICAkVG9ZZWFyLCAkVG9Nb250aCwgJFRvRGF5LCAkSG91ciwgJE1pbnV0ZSwgJFNlY29uZCwgMCwgMCwgMCwKICAgICAgICAgICAgICAgICAgICAtMQogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBpZiAoICggJFRvTW9udGggLSAkTW9udGggKSA9PSAyICkgewogICAgICAgICAgICAgICAgICAgIG15ICRRdWFydGVyTnVtICAgICAgID0gY2VpbCggJE1vbnRoIC8gMyApOwogICAgICAgICAgICAgICAgICAgIG15ICRUcmFuc2xhdGVRdWFydGVyID0gJExhbmd1YWdlT2JqZWN0LT5UcmFuc2xhdGUoJ3F1YXJ0ZXInKTsKICAgICAgICAgICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgICAgICAgICBASGVhZGVyTGluZSwKICAgICAgICAgICAgICAgICAgICAgICAgc3ByaW50ZiggIiRUcmFuc2xhdGVRdWFydGVyICRRdWFydGVyTnVtLSUwNGQiLCAkWWVhciApCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHB1c2goCiAgICAgICAgICAgICAgICAgICAgICAgIEBIZWFkZXJMaW5lLAogICAgICAgICAgICAgICAgICAgICAgICBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIiUwMmQuJTAyZC4lMDRkIC0gJTAyZC4lMDJkLiUwNGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERheSwgJE1vbnRoLCAkWWVhciwgJFRvRGF5LCAkVG9Nb250aCwgJFRvWWVhcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCAkRWxlbWVudC0+e1NlbGVjdGVkVmFsdWVzfVswXSBlcSAnSGFsZlllYXInICkgewogICAgICAgICAgICAgICAgKCAkVG9ZZWFyLCAkVG9Nb250aCwgJFRvRGF5ICkgPSBBZGRfRGVsdGFfWU1EKCAkWWVhciwgJE1vbnRoLCAkRGF5LCAwLCAkQ291bnQgKiA2LCAwICk7CiAgICAgICAgICAgICAgICAoICRUb1llYXIsICRUb01vbnRoLCAkVG9EYXksICRUb0hvdXIsICRUb01pbnV0ZSwgJFRvU2Vjb25kICkgPSBBZGRfRGVsdGFfREhNUygKICAgICAgICAgICAgICAgICAgICAkVG9ZZWFyLCAkVG9Nb250aCwgJFRvRGF5LCAkSG91ciwgJE1pbnV0ZSwgJFNlY29uZCwgMCwgMCwgMCwKICAgICAgICAgICAgICAgICAgICAtMQogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBpZiAoICggJFRvTW9udGggLSAkTW9udGggKSA9PSA1ICkgewogICAgICAgICAgICAgICAgICAgIG15ICRIYWxmWWVhck51bSAgICAgICA9IGNlaWwoICRNb250aCAvIDYgKTsKICAgICAgICAgICAgICAgICAgICBteSAkVHJhbnNsYXRlSGFsZlllYXIgPSAkTGFuZ3VhZ2VPYmplY3QtPlRyYW5zbGF0ZSgnaGFsZi15ZWFyJyk7CiAgICAgICAgICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgICAgICAgICAgQEhlYWRlckxpbmUsCiAgICAgICAgICAgICAgICAgICAgICAgIHNwcmludGYoICIkVHJhbnNsYXRlSGFsZlllYXIgJEhhbGZZZWFyTnVtLSUwNGQiLCAkWWVhciApCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHB1c2goCiAgICAgICAgICAgICAgICAgICAgICAgIEBIZWFkZXJMaW5lLAogICAgICAgICAgICAgICAgICAgICAgICBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIiUwMmQuJTAyZC4lMDRkIC0gJTAyZC4lMDJkLiUwNGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERheSwgJE1vbnRoLCAkWWVhciwgJFRvRGF5LCAkVG9Nb250aCwgJFRvWWVhcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCAkRWxlbWVudC0+e1NlbGVjdGVkVmFsdWVzfVswXSBlcSAnWWVhcicgKSB7CiAgICAgICAgICAgICAgICAoICRUb1llYXIsICRUb01vbnRoLCAkVG9EYXkgKSA9IEFkZF9EZWx0YV9ZTUQoICRZZWFyLCAkTW9udGgsICREYXksICRDb3VudCwgMCwgMCApOwogICAgICAgICAgICAgICAgKCAkVG9ZZWFyLCAkVG9Nb250aCwgJFRvRGF5LCAkVG9Ib3VyLCAkVG9NaW51dGUsICRUb1NlY29uZCApID0gQWRkX0RlbHRhX0RITVMoCiAgICAgICAgICAgICAgICAgICAgJFRvWWVhciwgJFRvTW9udGgsICRUb0RheSwgJEhvdXIsICRNaW51dGUsICRTZWNvbmQsIDAsIDAsIDAsCiAgICAgICAgICAgICAgICAgICAgLTEKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBpZiAoICRUb1llYXIgZXEgJFllYXIgKSB7CiAgICAgICAgICAgICAgICAgICAgcHVzaCBASGVhZGVyTGluZSwgJFllYXI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgICAgICAgICBASGVhZGVyTGluZSwKICAgICAgICAgICAgICAgICAgICAgICAgc3ByaW50ZigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICIlMDJkLiUwMmQuJTA0ZCAtICUwMmQuJTAyZC4lMDRkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICREYXksICRNb250aCwgJFllYXIsICRUb0RheSwgJFRvTW9udGgsICRUb1llYXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICggJFllYXIsICRNb250aCwgJERheSwgJEhvdXIsICRNaW51dGUsICRTZWNvbmQgKSA9IEFkZF9EZWx0YV9ESE1TKAogICAgICAgICAgICAgICAgJFRvWWVhciwgJFRvTW9udGgsICRUb0RheSwgJFRvSG91ciwgJFRvTWludXRlLCAkVG9TZWNvbmQsIDAsIDAsIDAsCiAgICAgICAgICAgICAgICAxCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRUaW1lU3RvcCA9IHNwcmludGYoCiAgICAgICAgICAgICAgICAiJTA0ZC0lMDJkLSUwMmQgJTAyZDolMDJkOiUwMmQiLAogICAgICAgICAgICAgICAgJFRvWWVhciwgJFRvTW9udGgsICRUb0RheSwgJFRvSG91ciwgJFRvTWludXRlLCAkVG9TZWNvbmQKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgIEB7ICRYdmFsdWUtPntTZWxlY3RlZFZhbHVlc30gfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgIyBzdWJ0cmFjdCB0aGUgc2VsZWN0ZWQgdGltZXpvbmUgKGlmIHRoZSB0aW1lem9uZSBleGlzdHMpIHRvIGdldCB0aGUgVVRDIHRpbWUgZm9yIHRoZSBzZWFyY2ggcGFyYW1ldGVyCiAgICAgICAgICAgICAgICAgICAgVGltZVN0YXJ0ID0+ICRTZWxmLT5fU3VidHJhY3RUaW1lWm9uZSgKICAgICAgICAgICAgICAgICAgICAgICAgVGltZVN0YW1wID0+ICRUaW1lU3RhcnQsCiAgICAgICAgICAgICAgICAgICAgICAgIFRpbWVab25lICA9PiAkUGFyYW17VGltZVpvbmV9LAogICAgICAgICAgICAgICAgICAgICksCgogICAgICAgICAgICAgICAgICAjIHN1YnRyYWN0IHRoZSBzZWxlY3RlZCB0aW1lem9uZSAoaWYgdGhlIHRpbWV6b25lIGV4aXN0cykgdG8gZ2V0IHRoZSBVVEMgdGltZSBmb3IgdGhlIHNlYXJjaCBwYXJhbWV0ZXIKICAgICAgICAgICAgICAgICAgICBUaW1lU3RvcCA9PiAkU2VsZi0+X1N1YnRyYWN0VGltZVpvbmUoCiAgICAgICAgICAgICAgICAgICAgICAgIFRpbWVTdGFtcCA9PiAkVGltZVN0b3AsCiAgICAgICAgICAgICAgICAgICAgICAgIFRpbWVab25lICA9PiAkUGFyYW17VGltZVpvbmV9LAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAkWHZhbHVlLT57QmxvY2t9ICA9ICdUaW1lJzsKICAgICAgICAkWHZhbHVlLT57VmFsdWVzfSA9ICRFbGVtZW50LT57VmFsdWVzfTsKICAgIH0KCiAgICAjIGlmIEJsb2NrIGVxdWFsIE11bHRpU2VsZWN0RmllbGQsIFNlbGVjdGZpZWxkCiAgICBlbHNlIHsKICAgICAgICAkWHZhbHVlID0gJEVsZW1lbnQ7CgogICAgICAgICMgYnVpbGQgdGhlIGhlYWRlcmxpbmUKCiAgICAgICAgZm9yIG15ICRWYWx1ZW5hbWUgKCBAeyAkWHZhbHVlLT57U2VsZWN0ZWRWYWx1ZXN9IH0gKSB7CiAgICAgICAgICAgIHB1c2ggQEhlYWRlckxpbmUsICRMYW5ndWFnZU9iamVjdC0+VHJhbnNsYXRlKCAkWHZhbHVlLT57VmFsdWVzfXskVmFsdWVuYW1lfSApOwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCB0aGUgdmFsdWUgc2VyaWVzCiAgICBteSAlVmFsdWVTZXJpZXM7CiAgICBteSBAQXJyYXlTZWxlY3RlZDsKICAgIG15ICRDb2x1bW5OYW1lID0gJyc7CiAgICBteSAkSGVhZGVyTGluZVN0YXJ0OwoKICAgICMgZ2l2ZSBtZSBhbGwgcG9zc2libGUgZWxlbWVudHMgZm9yIFZhbHVlIFNlcmllcwogICAgUkVGMToKICAgIGZvciBteSAkUmVmMSAoIEB7ICRQYXJhbXtVc2VBc1ZhbHVlU2VyaWVzfSB9ICkgewoKICAgICAgICAjIGFsbCBlbGVtZW50cyB3aGljaCBhcmUgc2hvd24gd2l0aCBtdWx0aXNlbGVjdGZpZWxkcwogICAgICAgIGlmICggJFJlZjEtPntCbG9ja30gbmUgJ1RpbWUnICkgewogICAgICAgICAgICBteSAlU2VsZWN0ZWRWYWx1ZXM7CiAgICAgICAgICAgIGZvciBteSAkUmVmMiAoIEB7ICRSZWYxLT57U2VsZWN0ZWRWYWx1ZXN9IH0gKSB7CiAgICAgICAgICAgICAgICAkU2VsZWN0ZWRWYWx1ZXN7JFJlZjJ9ID0gJExhbmd1YWdlT2JqZWN0LT5UcmFuc2xhdGUoICRSZWYxLT57VmFsdWVzfXskUmVmMn0gKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgQEFycmF5U2VsZWN0ZWQsCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgVmFsdWVzICA9PiBcJVNlbGVjdGVkVmFsdWVzLAogICAgICAgICAgICAgICAgICAgIEVsZW1lbnQgPT4gJFJlZjEtPntFbGVtZW50fSwKICAgICAgICAgICAgICAgICAgICBOYW1lICAgID0+ICRSZWYxLT57TmFtZX0sCiAgICAgICAgICAgICAgICAgICAgQmxvY2sgICA9PiAkUmVmMS0+e0Jsb2NrfSwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgKTsKICAgICAgICAgICAgbmV4dCBSRUYxOwogICAgICAgIH0KCiAgICAgICAgIyB0aW1lc2NhbGUgZWxlbWVudHMgbmVlZCBhIHNwZWNpYWwgaGFuZGxpbmcKICAgICAgICAkSGVhZGVyTGluZVN0YXJ0ID0gJEhlYWRlckxpbmVbMF07CiAgICAgICAgQEhlYWRlckxpbmUgICAgICA9ICgpOwoKICAgICAgICAjIHRoZXNlIGFsbCBtYWtlcyBvbmx5IHNlbnNlLCBpZiB0aGUgY291bnQgb2YgeGF4aXMgaXMgMQogICAgICAgIGlmICggJFJlZjEtPntTZWxlY3RlZFZhbHVlc31bMF0gZXEgJ1llYXInICkgewoKICAgICAgICAgICAgaWYgKCAkRWxlbWVudC0+e1NlbGVjdGVkVmFsdWVzfVswXSBlcSAnTW9udGgnICkgewoKICAgICAgICAgICAgICAgIGlmICggJENvdW50ID09IDEgKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRNb250aCAoIDEgLi4gMTIgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHB1c2ggQEhlYWRlckxpbmUsICIkTW9udGhBcnJheVJlZi0+WyRNb250aF0gJE1vbnRoIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKCBteSAkTW9udGggPSAxOyAkTW9udGggPCAxMjsgJE1vbnRoICs9ICRDb3VudCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEBIZWFkZXJMaW5lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIiRNb250aEFycmF5UmVmLT5bJE1vbnRoXSAtICRNb250aEFycmF5UmVmLT5bJE1vbnRoICsgJENvdW50IC0gMV0iCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJFZTU2Vjb25kID0gMDsKICAgICAgICAgICAgICAgICRWU01pbnV0ZSA9IDA7CiAgICAgICAgICAgICAgICAkVlNIb3VyICAgPSAwOwogICAgICAgICAgICAgICAgJFZTRGF5ICAgID0gMTsKICAgICAgICAgICAgICAgICRWU01vbnRoICA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCAkRWxlbWVudC0+e1NlbGVjdGVkVmFsdWVzfVswXSBlcSAnUXVhcnRlcicgKSB7CgogICAgICAgICAgICAgICAgbXkgJFRyYW5zbGF0ZVF1YXJ0ZXIgPSAkTGFuZ3VhZ2VPYmplY3QtPlRyYW5zbGF0ZSgncXVhcnRlcicpOwogICAgICAgICAgICAgICAgZm9yIG15ICRRdWFydGVyICggMSAuLiA0ICkgewogICAgICAgICAgICAgICAgICAgIHB1c2ggQEhlYWRlckxpbmUsICIkVHJhbnNsYXRlUXVhcnRlciAkUXVhcnRlciI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkVlNTZWNvbmQgPSAwOwogICAgICAgICAgICAgICAgJFZTTWludXRlID0gMDsKICAgICAgICAgICAgICAgICRWU0hvdXIgICA9IDA7CiAgICAgICAgICAgICAgICAkVlNEYXkgICAgPSAxOwogICAgICAgICAgICAgICAgJFZTTW9udGggID0gMTsKCiAgICAgICAgICAgICAgICAjIHJlbW92ZSB0aGUgeWVhciBmcm9tIHRoZSBIZWFkZXJMaW5lU3RhcnQgdmFsdWUgdG8gaGF2ZSB0aGUgc2FtZSB2YWx1ZXMgYXMgdGhlIG5ldyBnZW5lcmF0ZWQgSGVhZGVyTGluZQogICAgICAgICAgICAgICAgJEhlYWRlckxpbmVTdGFydCA9fiBzeyAtXGRcZFxkXGQgfXt9eG1zOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2lmICggJEVsZW1lbnQtPntTZWxlY3RlZFZhbHVlc31bMF0gZXEgJ0hhbGZZZWFyJyApIHsKCiAgICAgICAgICAgICAgICBteSAkVHJhbnNsYXRlSGFsZlllYXIgPSAkTGFuZ3VhZ2VPYmplY3QtPlRyYW5zbGF0ZSgnaGFsZi15ZWFyJyk7CiAgICAgICAgICAgICAgICBmb3IgbXkgJEhhbGZZZWFyICggMSAuLiAyICkgewogICAgICAgICAgICAgICAgICAgIHB1c2ggQEhlYWRlckxpbmUsICIkVHJhbnNsYXRlSGFsZlllYXIgJEhhbGZZZWFyIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRWU1NlY29uZCA9IDA7CiAgICAgICAgICAgICAgICAkVlNNaW51dGUgPSAwOwogICAgICAgICAgICAgICAgJFZTSG91ciAgID0gMDsKICAgICAgICAgICAgICAgICRWU0RheSAgICA9IDE7CiAgICAgICAgICAgICAgICAkVlNNb250aCAgPSAxOwoKICAgICAgICAgICAgICAgICMgcmVtb3ZlIHRoZSB5ZWFyIGZyb20gdGhlIEhlYWRlckxpbmVTdGFydCB2YWx1ZSB0byBoYXZlIHRoZSBzYW1lIHZhbHVlcyBhcyB0aGUgbmV3IGdlbmVyYXRlZCBIZWFkZXJMaW5lCiAgICAgICAgICAgICAgICAkSGVhZGVyTGluZVN0YXJ0ID1+IHN7IC1cZFxkXGRcZCB9e314bXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRDb2x1bW5OYW1lID0gJ1llYXInOwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRSZWYxLT57U2VsZWN0ZWRWYWx1ZXN9WzBdIGVxICdNb250aCcgKSB7CgogICAgICAgICAgICBmb3IgbXkgJENvdW50ICggMSAuLiAzMSApIHsKICAgICAgICAgICAgICAgIHB1c2ggQEhlYWRlckxpbmUsICRDb3VudDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJFZTU2Vjb25kICAgPSAwOwogICAgICAgICAgICAkVlNNaW51dGUgICA9IDA7CiAgICAgICAgICAgICRWU0hvdXIgICAgID0gMDsKICAgICAgICAgICAgJFZTRGF5ICAgICAgPSAxOwogICAgICAgICAgICAkQ29sdW1uTmFtZSA9ICdNb250aCc7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJFJlZjEtPntTZWxlY3RlZFZhbHVlc31bMF0gZXEgJ1dlZWsnICkgewoKICAgICAgICAgICAgZm9yIG15ICRDb3VudCAoIDEgLi4gNyApIHsKICAgICAgICAgICAgICAgIHB1c2ggQEhlYWRlckxpbmUsIERheV9vZl9XZWVrX3RvX1RleHQoJENvdW50KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJFZTU2Vjb25kICAgPSAwOwogICAgICAgICAgICAkVlNNaW51dGUgICA9IDA7CiAgICAgICAgICAgICRWU0hvdXIgICAgID0gMDsKICAgICAgICAgICAgJENvbHVtbk5hbWUgPSAnV2Vlayc7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJFJlZjEtPntTZWxlY3RlZFZhbHVlc31bMF0gZXEgJ0RheScgKSB7CiAgICAgICAgICAgIGZvciAoIG15ICRIb3VyID0gMDsgJEhvdXIgPCAyNDsgJEhvdXIgKz0gJENvdW50ICkgewogICAgICAgICAgICAgICAgcHVzaCBASGVhZGVyTGluZSwgc3ByaW50ZiggIiUwMmQ6MDA6MDAtJTAyZDo1OTo1OSIsICRIb3VyLCAkSG91ciArICRDb3VudCAtIDEgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkVlNTZWNvbmQgICA9IDA7CiAgICAgICAgICAgICRWU01pbnV0ZSAgID0gMDsKICAgICAgICAgICAgJFZTSG91ciAgICAgPSAwOwogICAgICAgICAgICAkQ29sdW1uTmFtZSA9ICdEYXknOwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRSZWYxLT57U2VsZWN0ZWRWYWx1ZXN9WzBdIGVxICdIb3VyJyApIHsKICAgICAgICAgICAgZm9yICggbXkgJE1pbnV0ZSA9IDA7ICRNaW51dGUgPCA2MDsgJE1pbnV0ZSArPSAkQ291bnQgKSB7CiAgICAgICAgICAgICAgICBteSAkVGltZSA9ICdtaW4gJyAuICRNaW51dGUgLiAnIC0gJyAuICggJE1pbnV0ZSArICRDb3VudCApOwogICAgICAgICAgICAgICAgcHVzaCBASGVhZGVyTGluZSwgJFRpbWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJFZTU2Vjb25kICAgPSAwOwogICAgICAgICAgICAkVlNNaW51dGUgICA9IDA7CiAgICAgICAgICAgICRDb2x1bW5OYW1lID0gJ0hvdXInOwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRSZWYxLT57U2VsZWN0ZWRWYWx1ZXN9WzBdIGVxICdNaW51dGUnICkgewogICAgICAgICAgICBpZiAoICRDb3VudCA9PSAxICkgewogICAgICAgICAgICAgICAgZm9yICggMCAuLiA1OSApIHsKICAgICAgICAgICAgICAgICAgICBteSAkVGltZSA9ICdzZWMgJyAuICRfOwogICAgICAgICAgICAgICAgICAgIHB1c2ggQEhlYWRlckxpbmUsICRUaW1lOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgZm9yICggbXkgJFNlY29uZCA9IDA7ICRTZWNvbmQgPCA2MDsgJFNlY29uZCArPSAkQ291bnQgKSB7CiAgICAgICAgICAgICAgICAgICAgbXkgJFRpbWUgPSAnc2VjICcgLiAkU2Vjb25kIC4gJy0nIC4gKCAkU2Vjb25kICsgJENvdW50ICk7CiAgICAgICAgICAgICAgICAgICAgcHVzaCBASGVhZGVyTGluZSwgJFRpbWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJFZTU2Vjb25kICAgPSAwOwogICAgICAgICAgICAkQ29sdW1uTmFtZSA9ICdNaW51dGUnOwogICAgICAgIH0KCiAgICAgICAgbXkgJFRpbWVTdGFydCAgICAgPSAwOwogICAgICAgIG15ICRUaW1lU3RvcCAgICAgID0gMDsKICAgICAgICBteSAkTW9udGhBcnJheVJlZiA9IF9Nb250aEFycmF5KCk7CgogICAgICAgICRDb3VudCA9IDE7CgogICAgICAgICMgR2VuZXJhdGUgdGhlIHRpbWUgdmFsdWUgc2VyaWVzCiAgICAgICAgbXkgKCAkVG9ZZWFyLCAkVG9Nb250aCwgJFRvRGF5LCAkVG9Ib3VyLCAkVG9NaW51dGUsICRUb1NlY29uZCApOwoKICAgICAgICBpZiAoICRSZWYxLT57U2VsZWN0ZWRWYWx1ZXN9WzBdIGVxICdZZWFyJyApIHsKICAgICAgICAgICAgd2hpbGUgKAogICAgICAgICAgICAgICAgISRUaW1lU3RvcCB8fCAkVGltZU9iamVjdC0+VGltZVN0YW1wMlN5c3RlbVRpbWUoIFN0cmluZyA9PiAkVGltZVN0b3AgKQogICAgICAgICAgICAgICAgPCAkVGltZUFic29sdXRTdG9wVW5peFRpbWUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJFRpbWVTdGFydCA9IHNwcmludGYoICIlMDRkLTAxLTAxIDAwOjAwOjAwIiwgJFZTWWVhciApOwogICAgICAgICAgICAgICAgKCAkVG9ZZWFyLCAkVG9Nb250aCwgJFRvRGF5ICkgPSBBZGRfRGVsdGFfWU1EKCAkVlNZZWFyLCAkVlNNb250aCwgJFZTRGF5LCAkQ291bnQsIDAsIDAgKTsKICAgICAgICAgICAgICAgICggJFRvWWVhciwgJFRvTW9udGgsICRUb0RheSwgJFRvSG91ciwgJFRvTWludXRlLCAkVG9TZWNvbmQgKSA9IEFkZF9EZWx0YV9ESE1TKAogICAgICAgICAgICAgICAgICAgICRUb1llYXIsICRUb01vbnRoLCAkVG9EYXksICRWU0hvdXIsICRWU01pbnV0ZSwgJFZTU2Vjb25kLCAwLAogICAgICAgICAgICAgICAgICAgIDAsIDAsIC0xCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgJFRpbWVTdG9wID0gc3ByaW50ZiggIiUwNGQtMTItMzEgMjM6NTk6NTkiLCAkVG9ZZWFyICk7CgogICAgICAgICAgICAgICAgJFZhbHVlU2VyaWVzeyRWU1llYXJ9ID0gewogICAgICAgICAgICAgICAgICAgICRSZWYxLT57VmFsdWVzfXtUaW1lU3RvcH0gID0+ICRUaW1lU3RvcCwKICAgICAgICAgICAgICAgICAgICAkUmVmMS0+e1ZhbHVlc317VGltZVN0YXJ0fSA9PiAkVGltZVN0YXJ0CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICggJFZTWWVhciwgJFZTTW9udGgsICRWU0RheSwgJFZTSG91ciwgJFZTTWludXRlLCAkVlNTZWNvbmQgKSA9IEFkZF9EZWx0YV9ESE1TKAogICAgICAgICAgICAgICAgICAgICRUb1llYXIsICRUb01vbnRoLCAkVG9EYXksICRUb0hvdXIsICRUb01pbnV0ZSwgJFRvU2Vjb25kLCAwLAogICAgICAgICAgICAgICAgICAgIDAsIDAsIDEKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzaWYgKCAkUmVmMS0+e1NlbGVjdGVkVmFsdWVzfVswXSBlcSAnTW9udGgnICkgewogICAgICAgICAgICB3aGlsZSAoCiAgICAgICAgICAgICAgICAhJFRpbWVTdG9wIHx8ICRUaW1lT2JqZWN0LT5UaW1lU3RhbXAyU3lzdGVtVGltZSggU3RyaW5nID0+ICRUaW1lU3RvcCApCiAgICAgICAgICAgICAgICA8ICRUaW1lQWJzb2x1dFN0b3BVbml4VGltZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkVGltZVN0YXJ0ID0gc3ByaW50ZiggIiUwNGQtJTAyZC0wMSAwMDowMDowMCIsICRWU1llYXIsICRWU01vbnRoICk7CiAgICAgICAgICAgICAgICAoICRUb1llYXIsICRUb01vbnRoLCAkVG9EYXkgKSA9IEFkZF9EZWx0YV9ZTUQoICRWU1llYXIsICRWU01vbnRoLCAkVlNEYXksIDAsICRDb3VudCwgMCApOwogICAgICAgICAgICAgICAgKCAkVG9ZZWFyLCAkVG9Nb250aCwgJFRvRGF5LCAkVG9Ib3VyLCAkVG9NaW51dGUsICRUb1NlY29uZCApID0gQWRkX0RlbHRhX0RITVMoCiAgICAgICAgICAgICAgICAgICAgJFRvWWVhciwgJFRvTW9udGgsICRUb0RheSwgJFZTSG91ciwgJFZTTWludXRlLCAkVlNTZWNvbmQsIDAsCiAgICAgICAgICAgICAgICAgICAgMCwgMCwgLTEKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkVGltZVN0b3AgPSBzcHJpbnRmKCAiJTA0ZC0lMDJkLSUwMmQgMjM6NTk6NTkiLCAkVG9ZZWFyLCAkVG9Nb250aCwgJFRvRGF5ICk7CgogICAgICAgICAgICAgICAgbXkgJFRyYW5zbGF0ZU1vbnRoID0gJExhbmd1YWdlT2JqZWN0LT5UcmFuc2xhdGUoICRNb250aEFycmF5UmVmLT5bJFZTTW9udGhdICk7CgogICAgICAgICAgICAgICAgJFZhbHVlU2VyaWVzewogICAgICAgICAgICAgICAgICAgICRWU1llYXIgLiAnLScKICAgICAgICAgICAgICAgICAgICAgICAgLiBzcHJpbnRmKCAiJTAyZCIsICRWU01vbnRoICkgLiAnICcKICAgICAgICAgICAgICAgICAgICAgICAgLiAkVHJhbnNsYXRlTW9udGgKICAgICAgICAgICAgICAgICAgICB9ID0gewogICAgICAgICAgICAgICAgICAgICRSZWYxLT57VmFsdWVzfXtUaW1lU3RvcH0gID0+ICRUaW1lU3RvcCwKICAgICAgICAgICAgICAgICAgICAkUmVmMS0+e1ZhbHVlc317VGltZVN0YXJ0fSA9PiAkVGltZVN0YXJ0CiAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAoICRWU1llYXIsICRWU01vbnRoLCAkVlNEYXksICRWU0hvdXIsICRWU01pbnV0ZSwgJFZTU2Vjb25kICkgPSBBZGRfRGVsdGFfREhNUygKICAgICAgICAgICAgICAgICAgICAkVG9ZZWFyLCAkVG9Nb250aCwgJFRvRGF5LCAkVG9Ib3VyLCAkVG9NaW51dGUsICRUb1NlY29uZCwgMCwKICAgICAgICAgICAgICAgICAgICAwLCAwLCAxCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHJlbW92ZSB0aGUgdmFsdWUgZm9yIHRoaXMgc2VsZWN0ZWQgdmFsdWUKICAgICAgICAgICAgJEhlYWRlckxpbmVTdGFydCA9ICcnOwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRSZWYxLT57U2VsZWN0ZWRWYWx1ZXN9WzBdIGVxICdXZWVrJyApIHsKICAgICAgICAgICAgd2hpbGUgKAogICAgICAgICAgICAgICAgISRUaW1lU3RvcCB8fCAkVGltZU9iamVjdC0+VGltZVN0YW1wMlN5c3RlbVRpbWUoIFN0cmluZyA9PiAkVGltZVN0b3AgKQogICAgICAgICAgICAgICAgPCAkVGltZUFic29sdXRTdG9wVW5peFRpbWUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbXkgQE1vbmRheSA9IE1vbmRheV9vZl9XZWVrKCBXZWVrX29mX1llYXIoICRWU1llYXIsICRWU01vbnRoLCAkVlNEYXkgKSApOwoKICAgICAgICAgICAgICAgICRUaW1lU3RhcnQgPSBzcHJpbnRmKCAiJTA0ZC0lMDJkLSUwMmQgMDA6MDA6MDAiLCBATW9uZGF5ICk7CiAgICAgICAgICAgICAgICAoICRUb1llYXIsICRUb01vbnRoLCAkVG9EYXkgKSA9IEFkZF9EZWx0YV9EYXlzKCBATW9uZGF5LCAkQ291bnQgKiA3ICk7CiAgICAgICAgICAgICAgICAoICRUb1llYXIsICRUb01vbnRoLCAkVG9EYXksICRUb0hvdXIsICRUb01pbnV0ZSwgJFRvU2Vjb25kICkgPSBBZGRfRGVsdGFfREhNUygKICAgICAgICAgICAgICAgICAgICAkVG9ZZWFyLCAkVG9Nb250aCwgJFRvRGF5LCAkVlNIb3VyLCAkVlNNaW51dGUsICRWU1NlY29uZCwgMCwKICAgICAgICAgICAgICAgICAgICAwLCAwLCAtMQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICRUaW1lU3RvcCA9IHNwcmludGYoICIlMDRkLSUwMmQtJTAyZCAyMzo1OTo1OSIsICRUb1llYXIsICRUb01vbnRoLCAkVG9EYXkgKTsKCiAgICAgICAgICAgICAgICAkVmFsdWVTZXJpZXN7CiAgICAgICAgICAgICAgICAgICAgc3ByaW50ZiggIiUwNGQtJTAyZC0lMDJkIiwgQE1vbmRheSApIC4gJyAtICcKICAgICAgICAgICAgICAgICAgICAgICAgLiBzcHJpbnRmKCAiJTA0ZC0lMDJkLSUwMmQiLCAkVG9ZZWFyLCAkVG9Nb250aCwgJFRvRGF5ICkKICAgICAgICAgICAgICAgICAgICB9ID0gewogICAgICAgICAgICAgICAgICAgICRSZWYxLT57VmFsdWVzfXtUaW1lU3RvcH0gID0+ICRUaW1lU3RvcCwKICAgICAgICAgICAgICAgICAgICAkUmVmMS0+e1ZhbHVlc317VGltZVN0YXJ0fSA9PiAkVGltZVN0YXJ0CiAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAoICRWU1llYXIsICRWU01vbnRoLCAkVlNEYXksICRWU0hvdXIsICRWU01pbnV0ZSwgJFZTU2Vjb25kICkgPSBBZGRfRGVsdGFfREhNUygKICAgICAgICAgICAgICAgICAgICAkVG9ZZWFyLCAkVG9Nb250aCwgJFRvRGF5LCAkVG9Ib3VyLCAkVG9NaW51dGUsICRUb1NlY29uZCwgMCwKICAgICAgICAgICAgICAgICAgICAwLCAwLCAxCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHJlbW92ZSB0aGUgdmFsdWUgZm9yIHRoaXMgc2VsZWN0ZWQgdmFsdWUKICAgICAgICAgICAgJEhlYWRlckxpbmVTdGFydCA9ICcnOwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRSZWYxLT57U2VsZWN0ZWRWYWx1ZXN9WzBdIGVxICdEYXknICkgewogICAgICAgICAgICB3aGlsZSAoCiAgICAgICAgICAgICAgICAhJFRpbWVTdG9wIHx8ICRUaW1lT2JqZWN0LT5UaW1lU3RhbXAyU3lzdGVtVGltZSggU3RyaW5nID0+ICRUaW1lU3RvcCApCiAgICAgICAgICAgICAgICA8ICRUaW1lQWJzb2x1dFN0b3BVbml4VGltZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkVGltZVN0YXJ0ID0gc3ByaW50ZiggIiUwNGQtJTAyZC0lMDJkIDAwOjAwOjAwIiwgJFZTWWVhciwgJFZTTW9udGgsICRWU0RheSApOwogICAgICAgICAgICAgICAgKCAkVG9ZZWFyLCAkVG9Nb250aCwgJFRvRGF5LCAkVG9Ib3VyLCAkVG9NaW51dGUsICRUb1NlY29uZCApID0gQWRkX0RlbHRhX0RITVMoCiAgICAgICAgICAgICAgICAgICAgJFZTWWVhciwgJFZTTW9udGgsICRWU0RheSwgJFZTSG91ciwgJFZTTWludXRlLCAkVlNTZWNvbmQsCiAgICAgICAgICAgICAgICAgICAgJENvdW50LCAwLCAwLCAtMQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICRUaW1lU3RvcCA9IHNwcmludGYoICIlMDRkLSUwMmQtJTAyZCAyMzo1OTo1OSIsICRUb1llYXIsICRUb01vbnRoLCAkVG9EYXkgKTsKCiAgICAgICAgICAgICAgICAkVmFsdWVTZXJpZXN7IHNwcmludGYoICIlMDRkLSUwMmQtJTAyZCIsICRWU1llYXIsICRWU01vbnRoLCAkVlNEYXkgKSB9ID0gewogICAgICAgICAgICAgICAgICAgICRSZWYxLT57VmFsdWVzfXtUaW1lU3RvcH0gID0+ICRUaW1lU3RvcCwKICAgICAgICAgICAgICAgICAgICAkUmVmMS0+e1ZhbHVlc317VGltZVN0YXJ0fSA9PiAkVGltZVN0YXJ0CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICggJFZTWWVhciwgJFZTTW9udGgsICRWU0RheSwgJFZTSG91ciwgJFZTTWludXRlLCAkVlNTZWNvbmQgKSA9IEFkZF9EZWx0YV9ESE1TKAogICAgICAgICAgICAgICAgICAgICRUb1llYXIsICRUb01vbnRoLCAkVG9EYXksICRUb0hvdXIsICRUb01pbnV0ZSwgJFRvU2Vjb25kLCAwLAogICAgICAgICAgICAgICAgICAgIDAsIDAsIDEKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzaWYgKCAkUmVmMS0+e1NlbGVjdGVkVmFsdWVzfVswXSBlcSAnSG91cicgKSB7CiAgICAgICAgICAgIHdoaWxlICgKICAgICAgICAgICAgICAgICEkVGltZVN0b3AgfHwgJFRpbWVPYmplY3QtPlRpbWVTdGFtcDJTeXN0ZW1UaW1lKCBTdHJpbmcgPT4gJFRpbWVTdG9wICkKICAgICAgICAgICAgICAgIDwgJFRpbWVBYnNvbHV0U3RvcFVuaXhUaW1lCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRUaW1lU3RhcnQgPSBzcHJpbnRmKCAiJTA0ZC0lMDJkLSUwMmQgJTAyZDowMDowMCIsICRWU1llYXIsICRWU01vbnRoLCAkVlNEYXksICRWU0hvdXIgKTsKICAgICAgICAgICAgICAgICggJFRvWWVhciwgJFRvTW9udGgsICRUb0RheSwgJFRvSG91ciwgJFRvTWludXRlLCAkVG9TZWNvbmQgKSA9IEFkZF9EZWx0YV9ESE1TKAogICAgICAgICAgICAgICAgICAgICRWU1llYXIsICRWU01vbnRoLCAkVlNEYXksICRWU0hvdXIsICRWU01pbnV0ZSwgJFZTU2Vjb25kLCAwLAogICAgICAgICAgICAgICAgICAgICRDb3VudCwgMCwgLTEKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkVGltZVN0b3AgPSBzcHJpbnRmKCAiJTA0ZC0lMDJkLSUwMmQgJTAyZDo1OTo1OSIsICRUb1llYXIsICRUb01vbnRoLCAkVG9EYXksICRUb0hvdXIgKTsKICAgICAgICAgICAgICAgICRWYWx1ZVNlcmllc3sKICAgICAgICAgICAgICAgICAgICBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAiJTA0ZC0lMDJkLSUwMmQgJTAyZDowMDowMCAtICUwMmQ6NTk6NTkiLAogICAgICAgICAgICAgICAgICAgICAgICAkVlNZZWFyLCAkVlNNb250aCwgJFZTRGF5LCAkVlNIb3VyLCAkVG9Ib3VyCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICB9ID0gewogICAgICAgICAgICAgICAgICAgICRSZWYxLT57VmFsdWVzfXtUaW1lU3RvcH0gID0+ICRUaW1lU3RvcCwKICAgICAgICAgICAgICAgICAgICAkUmVmMS0+e1ZhbHVlc317VGltZVN0YXJ0fSA9PiAkVGltZVN0YXJ0CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICggJFZTWWVhciwgJFZTTW9udGgsICRWU0RheSwgJFZTSG91ciwgJFZTTWludXRlLCAkVlNTZWNvbmQgKSA9IEFkZF9EZWx0YV9ESE1TKAogICAgICAgICAgICAgICAgICAgICRUb1llYXIsICRUb01vbnRoLCAkVG9EYXksICRUb0hvdXIsICRUb01pbnV0ZSwgJFRvU2Vjb25kLCAwLAogICAgICAgICAgICAgICAgICAgIDAsIDAsIDEKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGVsc2lmICggJFJlZjEtPntTZWxlY3RlZFZhbHVlc31bMF0gZXEgJ01pbnV0ZScgKSB7CiAgICAgICAgICAgIHdoaWxlICgKICAgICAgICAgICAgICAgICEkVGltZVN0b3AgfHwgJFRpbWVPYmplY3QtPlRpbWVTdGFtcDJTeXN0ZW1UaW1lKCBTdHJpbmcgPT4gJFRpbWVTdG9wICkKICAgICAgICAgICAgICAgIDwgJFRpbWVBYnNvbHV0U3RvcFVuaXhUaW1lCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRUaW1lU3RhcnQgPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICIlMDRkLSUwMmQtJTAyZCAlMDJkOiUwMmQ6MDAiLAogICAgICAgICAgICAgICAgICAgICRWU1llYXIsICRWU01vbnRoLCAkVlNEYXksICRWU0hvdXIsICRWU01pbnV0ZQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICggJFRvWWVhciwgJFRvTW9udGgsICRUb0RheSwgJFRvSG91ciwgJFRvTWludXRlLCAkVG9TZWNvbmQgKSA9IEFkZF9EZWx0YV9ESE1TKAogICAgICAgICAgICAgICAgICAgICRWU1llYXIsICRWU01vbnRoLCAkVlNEYXksICRWU0hvdXIsICRWU01pbnV0ZSwgJFZTU2Vjb25kLCAwLAogICAgICAgICAgICAgICAgICAgIDAsICRDb3VudCwgLTEKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkVGltZVN0b3AgPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICIlMDRkLSUwMmQtJTAyZCAlMDJkOiUwMmQ6NTkiLAogICAgICAgICAgICAgICAgICAgICRUb1llYXIsICRUb01vbnRoLCAkVG9EYXksICRUb0hvdXIsICRUb01pbnV0ZQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICRWYWx1ZVNlcmllc3sKICAgICAgICAgICAgICAgICAgICBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAiJTA0ZC0lMDJkLSUwMmQgJTAyZDolMDJkOjAwIC0gJTAyZDolMDJkOjU5IiwKICAgICAgICAgICAgICAgICAgICAgICAgJFZTWWVhciwgJFZTTW9udGgsICRWU0RheSwgJFZTSG91ciwgJFZTTWludXRlLCAkVG9Ib3VyLCAkVG9NaW51dGUKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIH0gPSB7CiAgICAgICAgICAgICAgICAgICAgJFJlZjEtPntWYWx1ZXN9e1RpbWVTdG9wfSAgPT4gJFRpbWVTdG9wLAogICAgICAgICAgICAgICAgICAgICRSZWYxLT57VmFsdWVzfXtUaW1lU3RhcnR9ID0+ICRUaW1lU3RhcnQKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgKCAkVlNZZWFyLCAkVlNNb250aCwgJFZTRGF5LCAkVlNIb3VyLCAkVlNNaW51dGUsICRWU1NlY29uZCApID0gQWRkX0RlbHRhX0RITVMoCiAgICAgICAgICAgICAgICAgICAgJFRvWWVhciwgJFRvTW9udGgsICRUb0RheSwgJFRvSG91ciwgJFRvTWludXRlLCAkVG9TZWNvbmQsIDAsCiAgICAgICAgICAgICAgICAgICAgMCwgMCwgMQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICB9CiAgICB9CgogICAgIyBtZXJnZSB0aGUgYXJyYXkgaWYgdHdvIGVsZW1lbnRzIGZvciB0aGUgdmFsdWVzZXJpZXMgYXJlIGF2aWFsYWJsZQogICAgaWYgKCAkQXJyYXlTZWxlY3RlZFswXSApIHsKICAgICAgICBLRVk6CiAgICAgICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJXsgJEFycmF5U2VsZWN0ZWRbMF17VmFsdWVzfSB9ICkgewogICAgICAgICAgICBteSAkVmFsdWUwOwogICAgICAgICAgICBpZiAoICRBcnJheVNlbGVjdGVkWzBde0Jsb2NrfSBlcSAnU2VsZWN0RmllbGQnICkgewogICAgICAgICAgICAgICAgJFZhbHVlMCA9ICRLZXk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCAkQXJyYXlTZWxlY3RlZFswXXtCbG9ja30gZXEgJ011bHRpU2VsZWN0RmllbGQnICkgewogICAgICAgICAgICAgICAgJFZhbHVlMCA9IFskS2V5XTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCAhJEFycmF5U2VsZWN0ZWRbMV0gKSB7CiAgICAgICAgICAgICAgICAkVmFsdWVTZXJpZXN7ICRBcnJheVNlbGVjdGVkWzBde1ZhbHVlc317JEtleX0gfSA9IHsgJEFycmF5U2VsZWN0ZWRbMF17RWxlbWVudH0gPT4gJFZhbHVlMCB9OwogICAgICAgICAgICAgICAgbmV4dCBLRVk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciBteSAkU3ViS2V5ICggc29ydCBrZXlzICV7ICRBcnJheVNlbGVjdGVkWzFde1ZhbHVlc30gfSApIHsKICAgICAgICAgICAgICAgIG15ICRWYWx1ZTE7CiAgICAgICAgICAgICAgICBpZiAoICRBcnJheVNlbGVjdGVkWzFde0Jsb2NrfSBlcSAnU2VsZWN0RmllbGQnICkgewogICAgICAgICAgICAgICAgICAgICRWYWx1ZTEgPSAkU3ViS2V5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzaWYgKCAkQXJyYXlTZWxlY3RlZFsxXXtCbG9ja30gZXEgJ011bHRpU2VsZWN0RmllbGQnICkgewogICAgICAgICAgICAgICAgICAgICRWYWx1ZTEgPSBbJFN1YktleV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkVmFsdWVTZXJpZXN7CiAgICAgICAgICAgICAgICAgICAgJEFycmF5U2VsZWN0ZWRbMF17VmFsdWVzfXskS2V5fSAuICcgLSAnCiAgICAgICAgICAgICAgICAgICAgICAgIC4gJEFycmF5U2VsZWN0ZWRbMV17VmFsdWVzfXskU3ViS2V5fQogICAgICAgICAgICAgICAgICAgIH0gPSB7CiAgICAgICAgICAgICAgICAgICAgJEFycmF5U2VsZWN0ZWRbMF17RWxlbWVudH0gPT4gJFZhbHVlMCwKICAgICAgICAgICAgICAgICAgICAkQXJyYXlTZWxlY3RlZFsxXXtFbGVtZW50fSA9PiAkVmFsdWUxCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAjIFVzZSB0aGlzIGlmIG5vIHZhbHVlc2VyaWVzIGF2YWlsYWJsZQogICAgaWYgKCAhJVZhbHVlU2VyaWVzICkgewogICAgICAgICRWYWx1ZVNlcmllc3sgJFBhcmFte09iamVjdH0gLiAncycgfSA9IHVuZGVmOwogICAgfQoKICAgICMgZ2V0IHRoZSBmaXJzdCBjb2x1bW4gbmFtZSBpbiB0aGUgaGVhZGVybGluZQogICAgaWYgKCRDb2x1bW5OYW1lKSB7CiAgICAgICAgdW5zaGlmdCBASGVhZGVyTGluZSwgJExhbmd1YWdlT2JqZWN0LT5UcmFuc2xhdGUoJENvbHVtbk5hbWUpOwogICAgfQogICAgZWxzaWYgKCAkQXJyYXlTZWxlY3RlZFsxXSApIHsKICAgICAgICB1bnNoaWZ0KAogICAgICAgICAgICBASGVhZGVyTGluZSwKICAgICAgICAgICAgJExhbmd1YWdlT2JqZWN0LT5UcmFuc2xhdGUoICRBcnJheVNlbGVjdGVkWzBde05hbWV9ICkgLiAnIC0gJwogICAgICAgICAgICAgICAgLiAkTGFuZ3VhZ2VPYmplY3QtPlRyYW5zbGF0ZSggJEFycmF5U2VsZWN0ZWRbMV17TmFtZX0gKQogICAgICAgICk7CiAgICB9CiAgICBlbHNpZiAoICRBcnJheVNlbGVjdGVkWzBdICkgewogICAgICAgIHVuc2hpZnQoIEBIZWFkZXJMaW5lLCAkTGFuZ3VhZ2VPYmplY3QtPlRyYW5zbGF0ZSggJEFycmF5U2VsZWN0ZWRbMF17TmFtZX0gKSB8fCAnJyApOwogICAgfQogICAgZWxzZSB7CgogICAgICAgICMgaW4gY2FzZXMgd2hlcmUgdGhlcmUgaXMgbm8gdmFsdWUgc2V0LCB0aGVuIHRoZSBoZWFkZXJzIGdldCB3cm9uZyB1bmxlc3MgYSBlbXB0eSBlbGVtZW50CiAgICAgICAgIyAgICBpcyBhZGRlZCBpbiB0aGUgaGVhZGVyLCBidWcgOTc5NgogICAgICAgICMKICAgICAgICAjICAgZS5nLiBmcm9tOgogICAgICAgICMgICAgUmF3ICAgIHwgTWlzYyB8IFBvc3RNYXN0ZXIgfCAgICB8CiAgICAgICAgIyAgICBUaWNrZXQgfCAxMCAgIHwgMjAgICAgICAgICB8IDMwIHwKICAgICAgICAjCiAgICAgICAgIyAgICB0bzoKICAgICAgICAjICAgICAgICAgICB8IFJhdyB8IE1pc2MgfCBQb3N0TWFzdGVyIHwKICAgICAgICAjICAgIFRpY2tldCB8IDEwICB8IDIwICAgfCAzMCAgICAgICAgIHwKICAgICAgICB1bnNoaWZ0KCBASGVhZGVyTGluZSwgJycgKTsKICAgIH0KCiAgICAjIHB1c2ggdGhlIGZpcnN0IGFycmF5IGVsZW1lbnRzIGluIHRoZSBTdGF0c0FycmF5CiAgICBteSAkVGl0bGUgPSAkUGFyYW17VGl0bGV9OwogICAgaWYgKCAkVGl0bGVUaW1lU3RhcnQgJiYgJFRpdGxlVGltZVN0b3AgKSB7CiAgICAgICAgJFRpdGxlIC49ICIgJFRpdGxlVGltZVN0YXJ0LSRUaXRsZVRpbWVTdG9wIjsKICAgIH0KCiAgICAjIGNyZWF0ZSB0aGUgY2FjaGUgc3RyaW5nCiAgICBteSAkQ2FjaGVTdHJpbmcgPSAkU2VsZi0+X0dldENhY2hlU3RyaW5nKCVQYXJhbSk7CgogICAgIyB0YWtlIHRoZSBjYWNoZSB2YWx1ZSBpZiBjb25maWd1cmVkIGFuZCBhdmFpbGFibGUKICAgIGlmICggJFBhcmFte0NhY2hlfSAmJiAhJFByZXZpZXcgKSB7CiAgICAgICAgbXkgQFN0YXRBcnJheSA9ICRTZWxmLT5fR2V0UmVzdWx0Q2FjaGUoCiAgICAgICAgICAgIEZpbGVuYW1lID0+ICdTdGF0cycgLiAkUGFyYW17U3RhdElEfSAuICctJyAuICRDYWNoZVN0cmluZyAuICcuY2FjaGUnLAogICAgICAgICk7CgogICAgICAgIGlmIChAU3RhdEFycmF5KSB7CiAgICAgICAgICAgIHJldHVybiBAU3RhdEFycmF5OwogICAgICAgIH0KICAgIH0KCiAgICAjIGNyZWF0ZSB0aGUgdGFibGUgc3RydWN0dXJlCiAgICBteSAlVGFibGVTdHJ1Y3R1cmU7CiAgICBmb3IgbXkgJFJvdyAoIHNvcnQga2V5cyAlVmFsdWVTZXJpZXMgKSB7CiAgICAgICAgbXkgQENlbGxzOwogICAgICAgIENFTEw6CiAgICAgICAgZm9yIG15ICRDZWxsICggQHsgJFh2YWx1ZS0+e1NlbGVjdGVkVmFsdWVzfSB9ICkgeyAgICAjIGdldCBlYWNoIGNlbGwKICAgICAgICAgICAgJFZhbHVlU2VyaWVzeyRSb3d9IHx8PSB7fTsKICAgICAgICAgICAgbXkgJUF0dHJpYnV0ZXMgPSAoICV7ICRWYWx1ZVNlcmllc3skUm93fSB9LCAlUmVzdHJpY3Rpb25BdHRyaWJ1dGUgKTsKCiAgICAgICAgICAgICMgdGhlIGZvbGxvd2luZyBpcyBuZWNlc3NhcnkgaWYgYXMgeC1heGlzIGFuZCBhcyB2YWx1ZS1zZXJpZXMgdGltZSBpcyBzZWxlY3RlZAogICAgICAgICAgICBpZiAoICRYdmFsdWUtPntCbG9ja30gZXEgJ1RpbWUnICkgewogICAgICAgICAgICAgICAgbXkgJFRpbWVTdGFydCA9ICRYdmFsdWUtPntWYWx1ZXN9e1RpbWVTdGFydH07CiAgICAgICAgICAgICAgICBteSAkVGltZVN0b3AgID0gJFh2YWx1ZS0+e1ZhbHVlc317VGltZVN0b3B9OwogICAgICAgICAgICAgICAgaWYgKCAkVmFsdWVTZXJpZXN7JFJvd317JFRpbWVTdG9wfSAmJiAkVmFsdWVTZXJpZXN7JFJvd317JFRpbWVTdGFydH0gKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAkVGltZU9iamVjdC0+VGltZVN0YW1wMlN5c3RlbVRpbWUoIFN0cmluZyA9PiAkQ2VsbC0+e1RpbWVTdG9wfSApCiAgICAgICAgICAgICAgICAgICAgICAgID4gJFRpbWVPYmplY3QtPlRpbWVTdGFtcDJTeXN0ZW1UaW1lKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nID0+ICRWYWx1ZVNlcmllc3skUm93fXskVGltZVN0b3B9CiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgfHwgJFRpbWVPYmplY3QtPlRpbWVTdGFtcDJTeXN0ZW1UaW1lKCBTdHJpbmcgPT4gJENlbGwtPntUaW1lU3RhcnR9ICkKICAgICAgICAgICAgICAgICAgICAgICAgPCAkVGltZU9iamVjdC0+VGltZVN0YW1wMlN5c3RlbVRpbWUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcgPT4gJFZhbHVlU2VyaWVzeyRSb3d9eyRUaW1lU3RhcnR9CiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCBDRUxMOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRBdHRyaWJ1dGVzeyRUaW1lU3RvcH0gID0gJENlbGwtPntUaW1lU3RvcH07CiAgICAgICAgICAgICAgICAkQXR0cmlidXRlc3skVGltZVN0YXJ0fSA9ICRDZWxsLT57VGltZVN0YXJ0fTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNpZiAoICRYdmFsdWUtPntCbG9ja30gZXEgJ1NlbGVjdEZpZWxkJyApIHsKICAgICAgICAgICAgICAgICRBdHRyaWJ1dGVzeyAkWHZhbHVlLT57RWxlbWVudH0gfSA9ICRDZWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJEF0dHJpYnV0ZXN7ICRYdmFsdWUtPntFbGVtZW50fSB9ID0gWyRDZWxsXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdXNoIEBDZWxscywgXCVBdHRyaWJ1dGVzOwogICAgICAgIH0KICAgICAgICAkVGFibGVTdHJ1Y3R1cmV7JFJvd30gPSBcQENlbGxzOwogICAgfQoKICAgIG15IEBEYXRhQXJyYXk7CgogICAgIyBEeW5hbWljIExpc3QgU3RhdGlzdGljCiAgICBpZiAoICRTdGF0T2JqZWN0LT5jYW4oJ0dldFN0YXRUYWJsZScpICkgewogICAgICAgIGlmICgkUHJldmlldykgewogICAgICAgICAgICByZXR1cm4gaWYgISRTdGF0T2JqZWN0LT5jYW4oJ0dldFN0YXRUYWJsZVByZXZpZXcnKTsKCiAgICAgICAgICAgIEBEYXRhQXJyYXkgPSAkU3RhdE9iamVjdC0+R2V0U3RhdFRhYmxlUHJldmlldygKICAgICAgICAgICAgICAgIFZhbHVlU2VyaWVzICAgID0+ICRQYXJhbXtVc2VBc1ZhbHVlU2VyaWVzfSwgICAgI1wlVmFsdWVTZXJpZXMsCiAgICAgICAgICAgICAgICBYVmFsdWUgICAgICAgICA9PiAkWHZhbHVlLAogICAgICAgICAgICAgICAgUmVzdHJpY3Rpb25zICAgPT4gXCVSZXN0cmljdGlvbkF0dHJpYnV0ZSwKICAgICAgICAgICAgICAgIFRhYmxlU3RydWN0dXJlID0+IFwlVGFibGVTdHJ1Y3R1cmUsCiAgICAgICAgICAgICAgICBUaW1lWm9uZSAgICAgICA9PiAkUGFyYW17VGltZVpvbmV9LAogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgIyBnZXQgdGhlIHdob2xlIHN0YXRzIHRhYmxlCiAgICAgICAgICAgIEBEYXRhQXJyYXkgPSAkU3RhdE9iamVjdC0+R2V0U3RhdFRhYmxlKAogICAgICAgICAgICAgICAgVmFsdWVTZXJpZXMgICAgPT4gJFBhcmFte1VzZUFzVmFsdWVTZXJpZXN9LCAgICAjXCVWYWx1ZVNlcmllcywKICAgICAgICAgICAgICAgIFhWYWx1ZSAgICAgICAgID0+ICRYdmFsdWUsCiAgICAgICAgICAgICAgICBSZXN0cmljdGlvbnMgICA9PiBcJVJlc3RyaWN0aW9uQXR0cmlidXRlLAogICAgICAgICAgICAgICAgVGFibGVTdHJ1Y3R1cmUgPT4gXCVUYWJsZVN0cnVjdHVyZSwKICAgICAgICAgICAgICAgIFRpbWVab25lICAgICAgID0+ICRQYXJhbXtUaW1lWm9uZX0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgRHluYW1pYyBNYXRyaXggU3RhdGlzdGljCiAgICBlbHNlIHsKICAgICAgICBpZiAoJFByZXZpZXcpIHsKICAgICAgICAgICAgcmV0dXJuIGlmICEkU3RhdE9iamVjdC0+Y2FuKCdHZXRTdGF0RWxlbWVudFByZXZpZXcnKTsKICAgICAgICB9CgogICAgICAgIGZvciBteSAkUm93ICggc29ydCBrZXlzICVUYWJsZVN0cnVjdHVyZSApIHsKICAgICAgICAgICAgbXkgQFJlc3VsdFJvdyA9ICgkUm93KTsKICAgICAgICAgICAgZm9yIG15ICRDZWxsICggQHsgJFRhYmxlU3RydWN0dXJleyRSb3d9IH0gKSB7CiAgICAgICAgICAgICAgICBpZiAoJFByZXZpZXcpIHsKICAgICAgICAgICAgICAgICAgICBwdXNoIEBSZXN1bHRSb3csICRTdGF0T2JqZWN0LT5HZXRTdGF0RWxlbWVudFByZXZpZXcoICV7JENlbGx9ICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwdXNoIEBSZXN1bHRSb3csICRTdGF0T2JqZWN0LT5HZXRTdGF0RWxlbWVudCggJXskQ2VsbH0gKSB8fCAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1c2ggQERhdGFBcnJheSwgXEBSZXN1bHRSb3c7CiAgICAgICAgfQogICAgfQoKICAgIG15ICRSb3dDb3VudGVyID0gMDsKCiAgICAjIGZpbGwgdXAgZW1wdHkgYXJyYXkgZWxlbWVudHMsIGUuZyBtb250aCBhcyB2YWx1ZSBzZXJpZXMgKEZlYnJ1YXJ5IGhhcyAyOCBkYXkgYW5kIEphbnVhciAzMSkKICAgIGZvciBteSAkUm93IChARGF0YUFycmF5KSB7CgogICAgICAgICRSb3dDb3VudGVyKys7CgogICAgICAgIGlmICggJFJvd0NvdW50ZXIgPT0gMSAmJiAkSGVhZGVyTGluZVN0YXJ0ICkgewoKICAgICAgICAgICAgIyBkZXRlcm1pbmUgdGhlIHNraXBwaW5nIGNvdW50ZXIKICAgICAgICAgICAgbXkgJFNraXBwaW5nQ291bnRlciA9IDA7CgogICAgICAgICAgICBJTkRFWDoKICAgICAgICAgICAgZm9yIG15ICRJbmRleCAoIDEgLi4gJCNIZWFkZXJMaW5lICkgewoKICAgICAgICAgICAgICAgIGlmICggJEhlYWRlckxpbmVbJEluZGV4XSBlcSAkSGVhZGVyTGluZVN0YXJ0ICkgewogICAgICAgICAgICAgICAgICAgIGxhc3QgSU5ERVg7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJFNraXBwaW5nQ291bnRlcisrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3IgbXkgJEluZGV4ICggMSAuLiAkU2tpcHBpbmdDb3VudGVyICkgewogICAgICAgICAgICAgICAgc3BsaWNlIEB7JFJvd30sICRJbmRleCwgMCwgJyc7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZvciBteSAkSW5kZXggKCAxIC4uICQjSGVhZGVyTGluZSApIHsKICAgICAgICAgICAgaWYgKCAhZGVmaW5lZCAkUm93LT5bJEluZGV4XSApIHsKICAgICAgICAgICAgICAgICRSb3ctPlskSW5kZXhdID0gJyc7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBSRU1BUks6IGl0IGNvdWxkIGJlIGFsc28gdXNlZnVsIHRvIHVzZSB0aGUgaW5kaXZpdWFsIHNvcnQgaWYgZGlmaW5lZAogICAgIyBzbyB5b3UgZG9uJ3QgbmVlZCB0aGlzIGZ1bmN0aW9uCiAgICBpZiAoICRTdGF0T2JqZWN0LT5jYW4oJ0dldEhlYWRlckxpbmUnKSApIHsKICAgICAgICBteSAkSGVhZGVyUmVmID0gJFN0YXRPYmplY3QtPkdldEhlYWRlckxpbmUoCiAgICAgICAgICAgIFhWYWx1ZSA9PiAkWHZhbHVlLAogICAgICAgICk7CgogICAgICAgIGlmICgkSGVhZGVyUmVmKSB7CiAgICAgICAgICAgIEBIZWFkZXJMaW5lID0gQHskSGVhZGVyUmVmfTsKICAgICAgICB9CiAgICB9CgogICAgbXkgQFN0YXRBcnJheSA9ICggWyRUaXRsZV0sIFxASGVhZGVyTGluZSwgQERhdGFBcnJheSApOwoKICAgIGlmICggISRQYXJhbXtDYWNoZX0gfHwgJFByZXZpZXcgKSB7CiAgICAgICAgcmV0dXJuIEBTdGF0QXJyYXkKICAgIH0KCiAgICAjIGNoZWNrIGlmIHdlIHNob3VsZCBjYWNoZSB0aGlzIHJlc3VsdAogICAgaWYgKCAhJFRpdGxlVGltZVN0YXJ0IHx8ICEkVGl0bGVUaW1lU3RvcCApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgIkNhbid0IGNhY2hlOiBTdGF0SUQgJFBhcmFte1N0YXRJRH0gaGFzIG5vIHRpbWUgcGVyaW9kLCBzbyB5b3UgY2FuJ3QgY2FjaGUgdGhlIHN0YXQhIiwKICAgICAgICApOwogICAgICAgIHJldHVybiBAU3RhdEFycmF5OwogICAgfQoKICAgICMgc3VidHJhY3QgdGhlIHNlbGVjdGVkIHRpbWV6b25lIChpZiB0aGUgdGltZXpvbmUgZXhpc3RzKSB0byBnZXQgdGhlIFVUQyB0aW1lIGZvciB0aGUgY2hlY2sKICAgIG15ICRDaGVja1RpbWVTdG9wID0gJFNlbGYtPl9TdWJ0cmFjdFRpbWVab25lKAogICAgICAgIFRpbWVTdGFtcCA9PiAkVGl0bGVUaW1lU3RvcCwKICAgICAgICBUaW1lWm9uZSAgPT4gJFBhcmFte1RpbWVab25lfSwKICAgICk7CgogICAgaWYgKCAkVGltZU9iamVjdC0+VGltZVN0YW1wMlN5c3RlbVRpbWUoIFN0cmluZyA9PiAkQ2hlY2tUaW1lU3RvcCApID4gJFRpbWVPYmplY3QtPlN5c3RlbVRpbWUoKSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgIkNhbid0IGNhY2hlIFN0YXRJRCAkUGFyYW17U3RhdElEfTogVGhlIHNlbGVjdGVkIGVuZCB0aW1lIGlzIGluIHRoZSBmdXR1cmUhIiwKICAgICAgICApOwogICAgICAgIHJldHVybiBAU3RhdEFycmF5OwogICAgfQoKICAgICMgd3JpdGUgdGhlIHN0YXRzIGNhY2hlCiAgICAkU2VsZi0+X1NldFJlc3VsdENhY2hlKAogICAgICAgIEZpbGVuYW1lID0+ICdTdGF0cycgLiAkUGFyYW17U3RhdElEfSAuICctJyAuICRDYWNoZVN0cmluZyAuICcuY2FjaGUnLAogICAgICAgIFJlc3VsdCAgID0+IFxAU3RhdEFycmF5LAogICAgKTsKICAgIHJldHVybiBAU3RhdEFycmF5Owp9CgpzdWIgX1dyaXRlUmVzdWx0Q2FjaGUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAlR2V0UGFyYW0gPSAleyAkUGFyYW17R2V0UGFyYW19IH07CgogICAgIyBnZXQgdGltZSBvYmplY3QKICAgIG15ICRUaW1lT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpbWUnKTsKCiAgICAjIGNoZWNrIGlmIHdlIHNob3VsZCBjYWNoZSB0aGlzIHJlc3VsdAogICAgIyBnZXQgdGhlIGN1cnJlbnQgdGltZQogICAgbXkgKCAkcywgJG0sICRoLCAkRCwgJE0sICRZICkgPSAkVGltZU9iamVjdC0+U3lzdGVtVGltZTJEYXRlKAogICAgICAgIFN5c3RlbVRpbWUgPT4gJFRpbWVPYmplY3QtPlN5c3RlbVRpbWUoKSwKICAgICk7CgogICAgIyBpZiBnZXQgcGFyYW1zIGluIGZ1dHVyZSBkbyBub3QgY2FjaGUKICAgIGlmICggJEdldFBhcmFte1llYXJ9ICYmICRHZXRQYXJhbXtNb250aH0gKSB7CiAgICAgICAgcmV0dXJuIGlmICRHZXRQYXJhbXtZZWFyfSA+ICRZOwogICAgICAgIHJldHVybiBpZiAkR2V0UGFyYW17WWVhcn0gPT0gJFkgJiYgJEdldFBhcmFte01vbnRofSA+ICRNOwogICAgICAgIHJldHVybgogICAgICAgICAgICBpZiAkR2V0UGFyYW17WWVhcn0gPT0gJFkKICAgICAgICAgICAgJiYgJEdldFBhcmFte01vbnRofSA9PSAkTQogICAgICAgICAgICAmJiAkR2V0UGFyYW17RGF5fQogICAgICAgICAgICAmJiAkR2V0UGFyYW17RGF5fSA+PSAkRDsKICAgIH0KCiAgICAjIHdyaXRlIGNhY2hlIGZpbGUKICAgIG15ICRGaWxlbmFtZSA9ICRTZWxmLT5fQ3JlYXRlU3RhdGljUmVzdWx0Q2FjaGVGaWxlbmFtZSgKICAgICAgICBHZXRQYXJhbSA9PiAkUGFyYW17R2V0UGFyYW19LAogICAgICAgIFN0YXRJRCAgID0+ICRQYXJhbXtTdGF0SUR9LAogICAgKTsKCiAgICAkU2VsZi0+X1NldFJlc3VsdENhY2hlKAogICAgICAgIEZpbGVuYW1lID0+ICRGaWxlbmFtZSwKICAgICAgICBSZXN1bHQgICA9PiAkUGFyYW17RGF0YX0sCiAgICApOwoKICAgIHJldHVybiAxOwp9Cgo9aXRlbSBfQ3JlYXRlU3RhdGljUmVzdWx0Q2FjaGVGaWxlbmFtZSgpCgpjcmVhdGUgYSBmaWxlbmFtZSBvdXQgb2YgdGhlIEdldFBhcmFtIGluZm9ybWF0aW9uIGFuZCB0aGUgc3RhdCBpZAoKICAgIG15ICRGaWxlbmFtZSA9ICRTdGF0c09iamVjdC0+X0NyZWF0ZVN0YXRpY1Jlc3VsdENhY2hlRmlsZW5hbWUoCiAgICAgICAgR2V0UGFyYW0gPT4gewogICAgICAgICAgICBZZWFyICA9PiAyMDA4LAogICAgICAgICAgICBNb250aCA9PiAzLAogICAgICAgICAgICBEYXkgICA9PiA1CiAgICAgICAgfSwKICAgICAgICBTdGF0SUQgICA9PiAkUGFyYW17U3RhdElEfSwKICAgICk7Cgo9Y3V0CgpzdWIgX0NyZWF0ZVN0YXRpY1Jlc3VsdENhY2hlRmlsZW5hbWUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBwYXJhbXMKICAgIGZvciBteSAkTmVlZGVkUGFyYW0gKHF3KCBTdGF0SUQgR2V0UGFyYW0gKSkgewogICAgICAgIGlmICggISRQYXJhbXskTmVlZGVkUGFyYW19ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkTmVlZGVkUGFyYW0hIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIG15ICRHZXRQYXJhbVJlZiA9ICRQYXJhbXtHZXRQYXJhbX07CgogICAgIyBmb3JtYXQgbW9udGggYW5kIGRheSBwYXJhbXMKICAgIGZvciAocXcoTW9udGggRGF5KSkgewogICAgICAgIGlmICggJEdldFBhcmFtUmVmLT57JF99ICkgewogICAgICAgICAgICAkR2V0UGFyYW1SZWYtPnskX30gPSBzcHJpbnRmKCAiJTAyZCIsICRHZXRQYXJhbVJlZi0+eyRffSApOwogICAgICAgIH0KICAgIH0KCiAgICBteSAkS2V5ID0gJyc7CiAgICBpZiAoICRHZXRQYXJhbVJlZi0+e1llYXJ9ICkgewogICAgICAgICRLZXkgLj0gJEdldFBhcmFtUmVmLT57WWVhcn07CiAgICB9CiAgICBpZiAoICRHZXRQYXJhbVJlZi0+e01vbnRofSApIHsKICAgICAgICAkS2V5IC49ICItJEdldFBhcmFtUmVmLT57TW9udGh9IjsKICAgIH0KICAgIGlmICggJEdldFBhcmFtUmVmLT57RGF5fSApIHsKICAgICAgICAkS2V5IC49ICItJEdldFBhcmFtUmVmLT57RGF5fSI7CiAgICB9CgogICAgbXkgJE1ENUtleSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyktPkZpbGVuYW1lQ2xlYW5VcCgKICAgICAgICBGaWxlbmFtZSA9PiAkS2V5LAogICAgICAgIFR5cGUgICAgID0+ICdtZDUnLAogICAgKTsKCiAgICByZXR1cm4KICAgICAgICAnU3RhdHMnCiAgICAgICAgLiAkUGFyYW17U3RhdElEfSAuICctJwogICAgICAgIC4gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpMYW5ndWFnZScpLT57VXNlckxhbmd1YWdlfSAuICctJwogICAgICAgIC4gJE1ENUtleQogICAgICAgIC4gJy5jYWNoZSc7Cn0KCj1pdGVtIF9TZXRSZXN1bHRDYWNoZSgpCgpjYWNoZSB0aGUgc3RhdHMgcmVzdWx0IHdpdGggYSBnaXZlbiBjYWNoZSBrZXkgKEZpbGVuYW1lKS4KCiAgICAkU3RhdHNPYmplY3QtPl9TZXRSZXN1bHRDYWNoZSgKICAgICAgICBGaWxlbmFtZSA9PiAnU3RhdHMnIC4gJFBhcmFte1N0YXRJRH0gLiAnLScgLiAkTUQ1S2V5IC4gJy5jYWNoZScsCiAgICAgICAgUmVzdWx0ICAgPT4gJFBhcmFte0RhdGF9LAogICAgKTsKCj1jdXQKCnN1YiBfU2V0UmVzdWx0Q2FjaGUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBwYXJhbXMKICAgIGZvciBteSAkTmVlZGVkIChxdyhGaWxlbmFtZSBSZXN1bHQpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkTmVlZGVkISIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKS0+U2V0KAogICAgICAgIFR5cGUgID0+ICdTdGF0c1J1bicsCiAgICAgICAgS2V5ICAgPT4gJFBhcmFte0ZpbGVuYW1lfSwKICAgICAgICBWYWx1ZSA9PiAkUGFyYW17UmVzdWx0fSwKICAgICAgICBUVEwgICA9PiAyNCAqIDYwICogNjAsCgogICAgICAgICMgRG9uJ3Qgc3RvcmUgY29tcGxleCBzdHJ1Y3R1cmUgaW4gbWVtb3J5IGFzIGl0IHdpbGwgYmUgbW9kaWZpZWQgbGF0ZXIuCiAgICAgICAgQ2FjaGVJbk1lbW9yeSA9PiAwLAogICAgKTsKCiAgICByZXR1cm4gMTsKfQoKPWl0ZW0gX0dldFJlc3VsdENhY2hlKCkKCmdldCBzdGF0cyByZXN1bHQgZnJvbSBjYWNoZSwgaWYgYW55CgogICAgbXkgQFJlc3VsdCA9ICRTdGF0c09iamVjdC0+X0dldFJlc3VsdENhY2hlKAogICAgICAgIEZpbGVuYW1lID0+ICdTdGF0cycgLiAkUGFyYW17U3RhdElEfSAuICctJyAuICRNRDVLZXkgLiAnLmNhY2hlJywKICAgICk7Cgo9Y3V0CgpzdWIgX0dldFJlc3VsdENhY2hlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgcGFyYW1zCiAgICBpZiAoICEkUGFyYW17RmlsZW5hbWV9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnX0dldFJlc3VsdENhY2hlOiBOZWVkIEZpbGVuYW1lIScsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbXkgJENhY2hlID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyktPkdldCgKICAgICAgICBUeXBlID0+ICdTdGF0c1J1bicsCiAgICAgICAgS2V5ICA9PiAkUGFyYW17RmlsZW5hbWV9LAoKICAgICAgICAjIERvbid0IHN0b3JlIGNvbXBsZXggc3RydWN0dXJlIGluIG1lbW9yeSBhcyBpdCB3aWxsIGJlIG1vZGlmaWVkIGxhdGVyLgogICAgICAgIENhY2hlSW5NZW1vcnkgPT4gMCwKICAgICk7CgogICAgaWYgKCByZWYgJENhY2hlICkgewogICAgICAgIHJldHVybiBAeyRDYWNoZX07CiAgICB9CgogICAgcmV0dXJuOwp9Cgo9aXRlbSBfRGVsZXRlQ2FjaGUoKQoKY2xlYW4gdXAgc3RhdHMgcmVzdWx0IGNhY2hlLgoKPWN1dAoKc3ViIF9EZWxldGVDYWNoZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIHJldHVybiAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKS0+Q2xlYW5VcCgKICAgICAgICBUeXBlID0+ICdTdGF0cycsCiAgICApOwp9CgpzdWIgX01vbnRoQXJyYXkgewogICAgbXkgQE1vbnRoQXJyYXkgPSAoCiAgICAgICAgJycsICdKYW4nLCAnRmViJywgJ01hcicsICdBcHInLCAnTWF5JywgJ0p1bicsICdKdWwnLCAnQXVnJywgJ1NlcCcsICdPY3QnLCAnTm92JywgJ0RlYycsCiAgICApOwoKICAgIHJldHVybiBcQE1vbnRoQXJyYXk7Cn0KCnN1YiBfQXV0b21hdGljU2FtcGxlSW1wb3J0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgZm9yIG15ICROZWVkZWQgKHF3KFVzZXJJRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQhIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIG15ICRMYW5ndWFnZSAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ0RlZmF1bHRMYW5ndWFnZScpOwogICAgbXkgJERpcmVjdG9yeSA9ICRTZWxmLT57U3RhdHNUZW1wRGlyfTsKCiAgICBpZiAoICFvcGVuZGlyKCBESVJFLCAkRGlyZWN0b3J5ICkgKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDYW4gbm90IG9wZW4gRGlyZWN0b3J5OiAkRGlyZWN0b3J5IiwKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGNoZWNrIGlmIHN0YXRzIGluIHRoZSBkZWZhdWx0IGxhbmd1YWdlIGF2YWlsYWJsZSwgaWYgbm90IHVzZSBlbgogICAgbXkgJEZsYWcgPSAwOwogICAgd2hpbGUgKCBkZWZpbmVkKCBteSAkRmlsZW5hbWUgPSByZWFkZGlyIERJUkUgKSApIHsKICAgICAgICBpZiAoICRGaWxlbmFtZSA9fiBte14uKlwuJExhbmd1YWdlXC54bWwkfXggKSB7CiAgICAgICAgICAgICRGbGFnID0gMTsKICAgICAgICB9CiAgICB9CgogICAgcmV3aW5kZGlyKERJUkUpOwogICAgaWYgKCAhJEZsYWcgKSB7CiAgICAgICAgJExhbmd1YWdlID0gJ2VuJzsKICAgIH0KCiAgICB3aGlsZSAoIGRlZmluZWQoIG15ICRGaWxlbmFtZSA9IHJlYWRkaXIgRElSRSApICkgewogICAgICAgIGlmICggJEZpbGVuYW1lID1+IG17Xi4qXC4kTGFuZ3VhZ2VcLnhtbCR9eCApIHsKCiAgICAgICAgICAgIG15ICRGaWxlaGFuZGxlOwogICAgICAgICAgICBpZiAoICFvcGVuICRGaWxlaGFuZGxlLCAnPCcsICREaXJlY3RvcnkgLiAkRmlsZW5hbWUgKSB7ICAgICMjIG5vIGNyaXRpYwogICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiQ2FuIG5vdCBvcGVuIEZpbGU6ICIgLiAkRGlyZWN0b3J5IC4gJEZpbGVuYW1lLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGNsb3NlZGlyKERJUkUpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAkQ29udGVudCA9ICcnOwogICAgICAgICAgICB3aGlsZSAoPCRGaWxlaGFuZGxlPikgewogICAgICAgICAgICAgICAgJENvbnRlbnQgLj0gJF87CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2xvc2UgJEZpbGVoYW5kbGU7CgogICAgICAgICAgICBteSAkU3RhdElEID0gJFNlbGYtPkltcG9ydCgKICAgICAgICAgICAgICAgIENvbnRlbnQgPT4gJENvbnRlbnQsCiAgICAgICAgICAgICAgICBVc2VySUQgID0+ICRQYXJhbXtVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KICAgIGNsb3NlZGlyKERJUkUpOwoKICAgIHJldHVybiAxOwp9Cgo9aXRlbSBfQWRkVGltZVpvbmUoKQoKQWRkIHRoZSBnaXZlbiB0aW1lIHpvbmUgdG8gdGhlIGdpdmVuIHRpbWVzdGFtcC4KCiAgICBteSAkVGltZVN0YW1wID0gJFN0YXRzT2JqZWN0LT5fQWRkVGltZVpvbmUoCiAgICAgICAgVGltZVN0YW1wID0+ICcyMDE1LTA2LTIwIDIwOjAwOjAwJywKICAgICAgICBUaW1lWm9uZSAgPT4gJys2JywKICAgICk7CgpSZXR1cm5zIHRoZSBjYWxjdWxhdGVkIHRpbWVzdGFtcCBvciB0aGUgZ2l2ZW4gdGltZXN0YW1wLCBpZiBubyB0aW1lIHpvbmUgaXMgZ2l2ZW4uCgogICAgJFRpbWVTdGFtcCA9ICcyMDE1LTA2LTIxIDAyOjAwOjAwJywKCj1jdXQKCnN1YiBfQWRkVGltZVpvbmUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBwYXJhbXMKICAgIGlmICggISRQYXJhbXtUaW1lU3RhbXB9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnTmVlZCBUaW1lU3RhbXAhJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICByZXR1cm4gJFBhcmFte1RpbWVTdGFtcH0gaWYgISRQYXJhbXtUaW1lWm9uZX07CgogICAgIyBnZXQgdGltZSBvYmplY3QKICAgIG15ICRUaW1lT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpbWUnKTsKCiAgICBteSAkU3lzdGVtVGltZSA9ICRUaW1lT2JqZWN0LT5UaW1lU3RhbXAyU3lzdGVtVGltZSgKICAgICAgICBTdHJpbmcgPT4gJFBhcmFte1RpbWVTdGFtcH0sCiAgICApOwoKICAgICMgYWRkIHRoZSBzZWxlY3RlZCB0aW1lem9uZSBmcm9tIHRoZSBnZW5lcmFsIHNwZWNpZmljYXRpb24gdG8gdGhlIGdpdmVuIHRpbWVzdGFtcAogICAgbXkgJFNlbGVjdGVkVGltZVpvbmVTeXN0ZW1UaW1lID0gJFN5c3RlbVRpbWUgKyAoICRQYXJhbXtUaW1lWm9uZX0gKiAzNjAwICk7CgogICAgbXkgJFNlbGVjdGVkVGltZVpvbmVUaW1lU3RhbXAgPSAkVGltZU9iamVjdC0+U3lzdGVtVGltZTJUaW1lU3RhbXAoCiAgICAgICAgU3lzdGVtVGltZSA9PiAkU2VsZWN0ZWRUaW1lWm9uZVN5c3RlbVRpbWUsCiAgICApOwoKICAgIHJldHVybiAkU2VsZWN0ZWRUaW1lWm9uZVRpbWVTdGFtcDsKfQoKPWl0ZW0gX1N1YnRyYWN0VGltZVpvbmUoKQoKU3VidHJhY3QgdGhlIGdpdmVuIHRpbWUgem9uZSBmcm9tIHRoZSBnaXZlbiB0aW1lc3RhbXAuCgogICAgbXkgJFRpbWVTdGFtcCA9ICRTdGF0c09iamVjdC0+X1N1YnRyYWN0VGltZVpvbmUoCiAgICAgICAgVGltZVN0YW1wID0+ICcyMDE1LTA2LTIwIDE4OjAwOjAwJywKICAgICAgICBUaW1lWm9uZSAgPT4gJys2JywKICAgICk7CgpSZXR1cm5zIHRoZSBjYWxjdWxhdGVkIHRpbWVzdGFtcCBvciB0aGUgZ2l2ZW4gdGltZXN0YW1wLCBpZiBubyB0aW1lIHpvbmUgaXMgZ2l2ZW4uCgogICAgJFRpbWVTdGFtcCA9ICcyMDE1LTA2LTIwIDEyOjAwOjAwJywKCj1jdXQKCnN1YiBfU3VidHJhY3RUaW1lWm9uZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHBhcmFtcwogICAgaWYgKCAhJFBhcmFte1RpbWVTdGFtcH0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdOZWVkIFRpbWVTdGFtcCEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIHJldHVybiAkUGFyYW17VGltZVN0YW1wfSBpZiAhJFBhcmFte1RpbWVab25lfTsKCiAgICAjIGdldCB0aW1lIG9iamVjdAogICAgbXkgJFRpbWVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGltZScpOwoKICAgIG15ICRTeXN0ZW1UaW1lID0gJFRpbWVPYmplY3QtPlRpbWVTdGFtcDJTeXN0ZW1UaW1lKAogICAgICAgIFN0cmluZyA9PiAkUGFyYW17VGltZVN0YW1wfSwKICAgICk7CgogICAgIyBzdWJ0cmFjdCB0aGUgc2VsZWN0ZWQgdGltZXpvbmUgZnJvbSB0aGUgZ2VuZXJhbCBzcGVjaWZpY2F0aW9uIHRvIHRoZSBnaXZlbiB0aW1lc3RhbXAKICAgIG15ICRTZWxlY3RlZFRpbWVab25lU3lzdGVtVGltZSA9ICRTeXN0ZW1UaW1lIC0gKCAkUGFyYW17VGltZVpvbmV9ICogMzYwMCApOwoKICAgIG15ICRTZWxlY3RlZFRpbWVab25lVGltZVN0YW1wID0gJFRpbWVPYmplY3QtPlN5c3RlbVRpbWUyVGltZVN0YW1wKAogICAgICAgIFN5c3RlbVRpbWUgPT4gJFNlbGVjdGVkVGltZVpvbmVTeXN0ZW1UaW1lLAogICAgKTsKCiAgICByZXR1cm4gJFNlbGVjdGVkVGltZVpvbmVUaW1lU3RhbXA7Cn0KCj1pdGVtIF9HZXRDYWNoZVN0cmluZygpCgpyZXR1cm5zIGEgc3RyaW5nIHRoYXQgY2FuIGJlIHVzZWQgZm9yIGNhY2hpbmcgdGhpcyBwYXJ0aWN1bGFyIHN0YXRpc3RpYwp3aXRoIHRoZSBnaXZlbiBwYXJhbWV0ZXJzLgoKICAgIG15ICRSZXN1bHQgPSAkU3RhdHNPYmplY3QtPl9HZXRDYWNoZVN0cmluZygKICAgICAgICBVc2VBc1h2YWx1ZSAgICAgID0+ICRVc2VBc1h2YWx1ZVJlZgogICAgICAgIFVzZUFzVmFsdWVTZXJpZXMgPT4gJFVzZUFzVmFsdWVTZXJpZXNSZWYsCiAgICAgICAgVXNlQXNSZXN0cmljdGlvbiA9PiAkVXNlQXNSZXN0cmljdGlvblJlZiwKICAgICk7Cgo9Y3V0CgpzdWIgX0dldENhY2hlU3RyaW5nIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CiAgICBteSAkUmVzdWx0ID0gJyc7CgogICAgIyBhZGQgdGhlIExhbmd1YWdlIHRvIHRoZSBjYWNoZSBrZXkKICAgICRSZXN1bHQgLj0gJ0xhbmd1YWdlOicgLiAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Okxhbmd1YWdlJyktPntVc2VyTGFuZ3VhZ2V9OwoKICAgIGlmICggJFBhcmFte1RpbWVab25lfSApIHsKICAgICAgICAkUmVzdWx0IC49ICdUaW1lWm9uZTonIC4gJFBhcmFte1RpbWVab25lfTsKICAgIH0KCiAgICBmb3IgbXkgJFVzZSAocXcoVXNlQXNYdmFsdWUgVXNlQXNWYWx1ZVNlcmllcyBVc2VBc1Jlc3RyaWN0aW9uKSkgewogICAgICAgICRSZXN1bHQgLj0gIiRVc2U6IjsKICAgICAgICBmb3IgbXkgJEVsZW1lbnQgKCBAeyAkUGFyYW17JFVzZX0gfSApIHsKICAgICAgICAgICAgJFJlc3VsdCAuPSAiTmFtZTokRWxlbWVudC0+e05hbWV9OiI7CiAgICAgICAgICAgIGlmICggJEVsZW1lbnQtPntCbG9ja30gZXEgJ1RpbWUnICkgewogICAgICAgICAgICAgICAgaWYgKCAkRWxlbWVudC0+e1NlbGVjdGVkVmFsdWVzfVswXSAmJiAkRWxlbWVudC0+e1RpbWVTY2FsZUNvdW50fSApIHsKICAgICAgICAgICAgICAgICAgICAkUmVzdWx0IC49ICJUaW1lU2NhbGVVbml0OiRFbGVtZW50LT57U2VsZWN0ZWRWYWx1ZXN9WzBdOiI7CiAgICAgICAgICAgICAgICAgICAgJFJlc3VsdCAuPSAiVGltZVNjYWxlQ291bnQ6JEVsZW1lbnQtPntUaW1lU2NhbGVDb3VudH06IjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoICRFbGVtZW50LT57VGltZVN0YXJ0fSAmJiAkRWxlbWVudC0+e1RpbWVTdG9wfSApIHsKICAgICAgICAgICAgICAgICAgICAkUmVzdWx0IC49ICJUaW1lU3RhcnQ6JEVsZW1lbnQtPntUaW1lU3RhcnR9OlRpbWVTdG9wOiRFbGVtZW50LT57VGltZVN0b3B9OiI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCAkRWxlbWVudC0+e1NlbGVjdGVkVmFsdWVzfSApIHsKICAgICAgICAgICAgICAgICRSZXN1bHQgLj0gIlNlbGVjdGVkVmFsdWVzOiIgLiBqb2luKCAnLCcsIHNvcnQgQHsgJEVsZW1lbnQtPntTZWxlY3RlZFZhbHVlc30gfSApIC4gJzonOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgQ29udmVydCB0byBNRDUgKG5vdCBzdXJlIGlmIHRoaXMgaXMgbmVlZGVkIGFueSBtb3JlKS4KICAgICRSZXN1bHQgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpLT5GaWxlbmFtZUNsZWFuVXAoCiAgICAgICAgRmlsZW5hbWUgPT4gJFJlc3VsdCwKICAgICAgICBUeXBlICAgICA9PiAnbWQ1JywKICAgICk7CgogICAgcmV0dXJuICRSZXN1bHQ7Cn0KCjE7Cgo9ZW5kIEludGVybmFsOgoKPWJhY2sKCj1oZWFkMSBURVJNUyBBTkQgQ09ORElUSU9OUwoKVGhpcyBzb2Z0d2FyZSBpcyBwYXJ0IG9mIHRoZSBPVFJTIHByb2plY3QgKEw8aHR0cDovL290cnMub3JnLz4pLgoKVGhpcyBzb2Z0d2FyZSBjb21lcyB3aXRoIEFCU09MVVRFTFkgTk8gV0FSUkFOVFkuIEZvciBkZXRhaWxzLCBzZWUKdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoQUdQTCkuIElmIHlvdQpkaWQgbm90IHJlY2VpdmUgdGhpcyBmaWxlLCBzZWUgTDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvYWdwbC50eHQ+LgoKPWN1dAo=</File>
        <File Location="KIXCore/Kernel/System/SysConfig.pm" Permission="644" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDE2IE9UUlMgQUcsIGh0dHA6Ly9vdHJzLmNvbS8KIyBLSVhDb3JlLUV4dGVuc2lvbnMgQ29weXJpZ2h0IChDKSAyMDA2LTIwMTYgYy5hLnAuZS4gSVQgR21iSCwgaHR0cDovL3d3dy5jYXBlLWl0LmRlCiMKIyB3cml0dGVuL2VkaXRlZCBieToKIyAqIFJlbmUoZG90KUJvZWhtKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAqIFRvcnN0ZW4oZG90KVRoYXUoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojICogTWFydGluKGRvdClCYWx6YXJlayhhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMgKiBEb3JvdGhlYShkb3QpRG9lcmZmZWwoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojICogQW5uYShkb3QpTGl0dmlub3ZhKGF0KWNhcGUoZGFzaClpdChkb3QpZGUKIyAtLQojICRJZDogU3lzQ29uZmlnLnBtLHYgMS40MyAyMDE2LzAxLzIwIDEzOjQ0OjQwIGRkb2VyZmZlbCBFeHAgJAojIC0tCiMgVGhpcyBzb2Z0d2FyZSBjb21lcyB3aXRoIEFCU09MVVRFTFkgTk8gV0FSUkFOVFkuIEZvciBkZXRhaWxzLCBzZWUKIyB0aGUgZW5jbG9zZWQgZmlsZSBDT1BZSU5HIGZvciBsaWNlbnNlIGluZm9ybWF0aW9uIChBR1BMKS4gSWYgeW91CiMgZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9hZ3BsLnR4dC4KIyAtLQoKcGFja2FnZSBLZXJuZWw6OlN5c3RlbTo6U3lzQ29uZmlnOwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIFN0b3JhYmxlIHF3KCk7Cgp1c2UgdmFycyBxdyhASVNBKTsKdXNlIEtlcm5lbDo6Q29uZmlnOwoKdXNlIGJhc2UgcXcoS2VybmVsOjpTeXN0ZW06OkV2ZW50SGFuZGxlcik7CgpvdXIgQE9iamVjdERlcGVuZGVuY2llcyA9ICgKICAgICdLZXJuZWw6OkNvbmZpZycsCiAgICAnS2VybmVsOjpMYW5ndWFnZScsCiAgICAnS2VybmVsOjpTeXN0ZW06OkNhY2hlJywKICAgICdLZXJuZWw6OlN5c3RlbTo6TG9nJywKICAgICdLZXJuZWw6OlN5c3RlbTo6TWFpbicsCiAgICAnS2VybmVsOjpTeXN0ZW06OlhNTCcsCgogICAgIyBLSVhDb3JlLWNhcGVJVAogICAgJ0tlcm5lbDo6U3lzdGVtOjpFdmVudEhhbmRsZXInLAoKICAgICMgRU8gS0lYQ29yZS1jYXBlSVQKKTsKCj1oZWFkMSBOQU1FCgpLZXJuZWw6OlN5c3RlbTo6U3lzQ29uZmlnIC0gdG8gbWFuYWdlIHN5cyBjb25maWcgc2V0dGluZ3MKCj1oZWFkMSBTWU5PUFNJUwoKQWxsIGZ1bmN0aW9ucyB0byBtYW5hZ2Ugc3lzIGNvbmZpZyBzZXR0aW5ncy4KCj1oZWFkMSBQVUJMSUMgSU5URVJGQUNFCgo9b3ZlciA0Cgo9Y3V0Cgo9aXRlbSBuZXcoKQoKY3JlYXRlIGFuIG9iamVjdC4gRG8gbm90IHVzZSBpdCBkaXJlY3RseSwgaW5zdGVhZCB1c2U6CgogICAgdXNlIEtlcm5lbDo6U3lzdGVtOjpPYmplY3RNYW5hZ2VyOwogICAgbG9jYWwgJEtlcm5lbDo6T00gPSBLZXJuZWw6OlN5c3RlbTo6T2JqZWN0TWFuYWdlci0+bmV3KCk7CiAgICBteSAkU3lzQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlN5c0NvbmZpZycpOwoKPWN1dAoKIyMgbm8gY3JpdGljIChTdHJpbmd5RXZhbCkKCnN1YiBuZXcgewogICAgbXkgKCAkVHlwZSwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGFsbG9jYXRlIG5ldyBoYXNoIGZvciBvYmplY3QKICAgIG15ICRTZWxmID0ge307CiAgICBibGVzcyggJFNlbGYsICRUeXBlICk7CgogICAgIyBnZXQgZGF0YWJhc2Ugb2JqZWN0CiAgICAkU2VsZi0+e0NvbmZpZ09iamVjdH0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgICMgZ2V0IGhvbWUgZGlyZWN0b3J5CiAgICAkU2VsZi0+e0hvbWV9ID0gJFNlbGYtPntDb25maWdPYmplY3R9LT5HZXQoJ0hvbWUnKTsKCiAgICAjIHNldCB1dGY4IGlmIHVzZWQKICAgICRTZWxmLT57dXRmOH0gICAgID0gMTsKICAgICRTZWxmLT57RmlsZU1vZGV9ID0gJzp1dGY4JzsKCiAgICAkU2VsZi0+e0NvbmZpZ0RlZmF1bHRPYmplY3R9ID0gS2VybmVsOjpDb25maWctPm5ldyggTGV2ZWwgPT4gJ0RlZmF1bHQnICk7CiAgICAkU2VsZi0+e0NvbmZpZ09iamVjdH0gICAgICAgID0gS2VybmVsOjpDb25maWctPm5ldyggTGV2ZWwgPT4gJ0ZpcnN0JyApOwogICAgJFNlbGYtPntDb25maWdDbGVhck9iamVjdH0gICA9IEtlcm5lbDo6Q29uZmlnLT5uZXcoIExldmVsID0+ICdDbGVhcicgKTsKICAgICRTZWxmLT57Q29uZmlnQ291bnRlcn0gICAgICAgPSAkU2VsZi0+X0luaXQoKTsKCiAgICAjIEtJWENvcmUtY2FwZUlUCiAgICAjIHN0b3JlIFVzZXJJRCBmb3IgZXZlbnQgaGFuZGxpbmcKICAgICRTZWxmLT57VXNlcklEfSA9ICRQYXJhbXtVc2VySUR9OwoKICAgICMgaW5pdCBvZiBldmVudCBoYW5kbGVyCiAgICAkU2VsZi0+RXZlbnRIYW5kbGVySW5pdCgKICAgICAgICBDb25maWcgICAgID0+ICdTeXNDb25maWc6OkV2ZW50TW9kdWxlUG9zdCcsCiAgICAgICAgQmFzZU9iamVjdCA9PiAnU3lzQ29uZmlnT2JqZWN0JywKICAgICAgICBPYmplY3RzICAgID0+IHsKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgIH0sCiAgICApOwoKICAgICMgRU8gS0lYQ29yZS1jYXBlSVQKCiAgICByZXR1cm4gJFNlbGY7Cn0KCj1pdGVtIFdyaXRlRGVmYXVsdCgpCgp3cml0ZXMgdGhlIGRlZmF1bHQgY29uZmlndXJhdGlvbiBmaWxlIHBlcmwgY2FjaGUKKEtlcm5lbC9Db25maWcvRmlsZXMvWlpaQUF1dG8ucG0pLiBJdCBpcyB0aGUgUGVybCByZXByZXNlbnRhdGlvbgpvZiB0aGUgZGVmYXVsdCBYTUwgY29uZmlndXJhdGlvbiBkYXRhIChLZXJuZWwvQ29uZmlnL0ZpbGVzLyoueG1sKS4KCj1jdXQKCnN1YiBXcml0ZURlZmF1bHQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkRmlsZSA9ICcnOwogICAgbXkgJVVzZWRLZXlzOwoKICAgICMgcmVhZCBhbGwgY29uZmlnIGZpbGVzCiAgICBmb3IgbXkgJENvbmZpZ0l0ZW0gKCBAeyAkU2VsZi0+e1hNTENvbmZpZ30gfSApIHsKICAgICAgICBpZiAoICRDb25maWdJdGVtLT57TmFtZX0gJiYgISRVc2VkS2V5c3sgJENvbmZpZ0l0ZW0tPntOYW1lfSB9ICkgewoKICAgICAgICAgICAgJFVzZWRLZXlzeyAkQ29uZmlnSXRlbS0+e05hbWV9IH0gPSAxOwoKICAgICAgICAgICAgbXkgJUNvbmZpZyA9ICRTZWxmLT5Db25maWdJdGVtR2V0KAogICAgICAgICAgICAgICAgTmFtZSAgICA9PiAkQ29uZmlnSXRlbS0+e05hbWV9LAogICAgICAgICAgICAgICAgRGVmYXVsdCA9PiAxLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgbXkgJE5hbWUgPSAkQ29uZmlne05hbWV9OwogICAgICAgICAgICAkTmFtZSA9fiBzL1xcL1xcXFwvZzsKICAgICAgICAgICAgJE5hbWUgPX4gcy8nL1wnL2c7CiAgICAgICAgICAgICROYW1lID1+IHMvIyMjLyd9LT57Jy9nOwoKICAgICAgICAgICAgaWYgKCAkQ29uZmlne1ZhbGlkfSApIHsKICAgICAgICAgICAgICAgICRGaWxlIC49ICJcJFNlbGYtPnsnJE5hbWUnfSA9ICIgLiAkU2VsZi0+X1hNTDJQZXJsKCBEYXRhID0+IFwlQ29uZmlnICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCBldmFsKCAnJFNlbGYtPntDb25maWdEZWZhdWx0T2JqZWN0fS0+e1wnJyAuICROYW1lIC4gJ1wnfScgKSApIHsKICAgICAgICAgICAgICAgICRGaWxlIC49ICJkZWxldGUgXCRTZWxmLT57JyROYW1lJ307XG4iOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgd3JpdGUgZGVmYXVsdCBjb25maWcgZmlsZQogICAgbXkgJE91dDsKICAgICRPdXQgLj0gIiMgT1RSUyBjb25maWcgZmlsZSAoYXV0b21hdGljYWxseSBnZW5lcmF0ZWQpXG4iOwogICAgJE91dCAuPSAiIyBWRVJTSU9OOjEuMVxuIjsKICAgICRPdXQgLj0gInBhY2thZ2UgS2VybmVsOjpDb25maWc6OkZpbGVzOjpaWlpBQXV0bztcbiI7CiAgICAkT3V0IC49ICJ1c2Ugc3RyaWN0O1xuIjsKICAgICRPdXQgLj0gInVzZSB3YXJuaW5ncztcbiI7CiAgICAkT3V0IC49ICJubyB3YXJuaW5ncyAncmVkZWZpbmUnO1xuIjsKICAgIGlmICggJFNlbGYtPnt1dGY4fSApIHsKICAgICAgICAkT3V0IC49ICJ1c2UgdXRmODtcbiI7CiAgICB9CiAgICAkT3V0IC49ICJzdWIgTG9hZCB7XG4iOwogICAgJE91dCAuPSAiICAgIG15IChcJEZpbGUsIFwkU2VsZikgPSBcQF87XG4iOwogICAgJE91dCAuPSAkRmlsZTsKICAgICRPdXQgLj0gIn1cbiI7CiAgICAkT3V0IC49ICIxO1xuIjsKCiAgICByZXR1cm4gJFNlbGYtPl9GaWxlV3JpdGVBdG9taWMoCiAgICAgICAgRmlsZW5hbWUgPT4gIiRTZWxmLT57SG9tZX0vS2VybmVsL0NvbmZpZy9GaWxlcy9aWlpBQXV0by5wbSIsCiAgICAgICAgQ29udGVudCAgPT4gXCRPdXQsCiAgICApOwp9Cgo9aXRlbSBEb3dubG9hZCgpCgpkb3dubG9hZCBjb25maWcgY2hhbmdlcy4gVGhpcyB3aWxsIHJldHVybiB0aGUgY29udGVudCBvZgpLZXJuZWwvQ29uZmlnL0ZpbGVzL1paWkF1dG8ucG0sIHRoZSBmaWxlIHdoaWNoIGNvbnRhaW5zIGFsbApjb25maWd1cmF0aW9uIGNoYW5nZXMgdGhhdCB0aGUgdXNlcnMgbWFkZSB2aWEgQWRtaW5TeXNDb25maWcuCgogICAgbXkgJENvbmZpZ3VyYXRpb25EYXRhID0gJFN5c0NvbmZpZ09iamVjdC0+RG93bmxvYWQoKTsKCklmIHlvdSB3YW50IHRvIGNoZWNrIGlmIGl0IGV4aXN0cyAocmV0dXJucyB0cnVlIG9yIGZhbHNlKSwKY2FsbCBpdCBsaWtlIHRoaXM6CgogICAgbXkgJENvbmZpZ3VyYXRpb25FeGlzdHMgPSAkU3lzQ29uZmlnT2JqZWN0LT5Eb3dubG9hZCgKICAgICAgICBUeXBlID0+ICdDaGVjaycsCiAgICApOwoKPWN1dAoKc3ViIERvd25sb2FkIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJEhvbWUgPSAkU2VsZi0+e0hvbWV9OwoKICAgIG15ICRJbjsKICAgIGlmICggIS1lICIkSG9tZS9LZXJuZWwvQ29uZmlnL0ZpbGVzL1paWkF1dG8ucG0iICkgewogICAgICAgIHJldHVybiAnJzsKICAgIH0KICAgICMjIG5vIGNyaXRpYwogICAgZWxzaWYgKCAhb3BlbiggJEluLCAiPCRTZWxmLT57RmlsZU1vZGV9IiwgIiRIb21lL0tlcm5lbC9Db25maWcvRmlsZXMvWlpaQXV0by5wbSIgKSApIHsKICAgICAgICAjIyB1c2UgY3JpdGljCiAgICAgICAgcmV0dXJuIGlmICRQYXJhbXtUeXBlfTsKCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDYW4ndCBvcGVuICRIb21lL0tlcm5lbC9Db25maWcvRmlsZXMvWlpaQXV0by5wbTogJCEiCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gJyc7CiAgICB9CgogICAgIyByZWFkIGZpbGUKICAgIG15ICRGaWxlID0gJyc7CiAgICB3aGlsZSAoPCRJbj4pIHsKICAgICAgICAkRmlsZSAuPSAkXzsKICAgIH0KICAgIGNsb3NlKCRJbik7CgogICAgIyByZXR1cm4gdHJ1ZS9mYWxzZSBvbiBjaGVjawogICAgaWYgKCAkUGFyYW17VHlwZX0gKSB7CiAgICAgICAgbXkgJExlbmd0aCA9IGxlbmd0aCgkRmlsZSk7CiAgICAgICAgaWYgKCAkTGVuZ3RoID4gMjUgKSB7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KICAgICAgICByZXR1cm47CiAgICB9CgogICAgcmV0dXJuICRGaWxlOwp9Cgo9aXRlbSBVcGxvYWQoKQoKdXBsb2FkIG9mIGNvbmZpZyBjaGFuZ2VzLiBQYXNzIHRoZSBjb250ZW50cyBvZgp0aGUgZmlsZSBLZXJuZWwvQ29uZmlnL0ZpbGVzL1paWkF1dG8ucG0gaGVyZSwgYXMKcmVhZCBieSBMPC9Eb3dubG9hZCgpPi4KCldhcm5pbmc6IHRoaXMgd2lsbCByZXBsYWNlIHRoZSBleGlzdGluZyB1c2VyCmNvbmZpZ3VyYXRpb24gY2hhbmdlcy4KCiAgICAkU3lzQ29uZmlnT2JqZWN0LT5VcGxvYWQoCiAgICAgICAgQ29udGVudCA9PiAkQ29udGVudCwKICAgICk7Cgo9Y3V0CgpzdWIgVXBsb2FkIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJEhvbWUgPSAkU2VsZi0+e0hvbWV9OwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgKHF3KENvbnRlbnQpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyRffSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5lZWQgJF8hIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIG15ICRGaWxlTG9jYXRpb24gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpLT5GaWxlV3JpdGUoCiAgICAgICAgTG9jYXRpb24gPT4gIiRIb21lL0tlcm5lbC9Db25maWcvRmlsZXMvWlpaQXV0by5wbSIsCiAgICAgICAgQ29udGVudCAgPT4gXCRQYXJhbXtDb250ZW50fSwKICAgICAgICBNb2RlICAgICA9PiAnYmlubW9kZScsCiAgICApOwoKICAgIHJldHVybiAxOwp9Cgo9aXRlbSBDcmVhdGVDb25maWcoKQoKU3VibWl0IGNvbmZpZyBzZXR0aW5ncyB0byBhcHBsaWNhdGlvbi4gVGhpcyBmdW5jdGlvbiB3aWxsIHdyaXRlCnRoZSBpbnRlcm5hbCBzdGF0ZSBvZiB0aGUgY3VycmVudCBTeXNDb25maWcgb2JqZWN0IHRvIGRpc2ssIHNhdmluZwphbGwgY2hhbmdlcyB0aGF0IHdlcmUgbWFkZSBieSB0aGUgdXNlcnMgdG8gS2VybmVsL0NvbmZpZy9GaWxlcy9aWlpBdXRvLnBtLgpPbmx5IHZhbHVlcyB3aGljaCBkaWZmZXIgZnJvbSB0aGUgZGVmYXVsdCBjb25maWd1cmF0aW9uIGFyZSBzdG9yZWQgaW4gdGhpcyBmaWxlLgoKICAgICRTeXNDb25maWdPYmplY3QtPkNyZWF0ZUNvbmZpZygpOwoKaWYgeW91IHdhbnQgdG8gY3JlYXRlIGFuIGVtcHR5IGZpbGUsIGZvciBleGFtcGxlIG9uIGluaXRpYWwgY3JlYXRpb24sIHlvdSBjYW4KdXNlIHRoZSBFbXB0eUZpbGUgcGFyYW0uCgogICAgJFN5c0NvbmZpZ09iamVjdC0+Q3JlYXRlQ29uZmlnKCBFbXB0eUZpbGUgPT4gMSApOwoKPWN1dAoKc3ViIENyZWF0ZUNvbmZpZyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRGaWxlID0gJyc7CiAgICBteSAlVXNlZEtleXM7CiAgICBteSAkSG9tZSA9ICRTZWxmLT57SG9tZX07CgogICAgIyByZW1lbWJlciB0byB1cGRhdGUgWlpaQUF1dG8ucG0gYW5kIFpaWkF1dG8ucG0KICAgICRTZWxmLT57VXBkYXRlfSA9IDE7CgogICAgIyByZWFkIGFsbCBjb25maWcgZmlsZXMgYW5kIG9ubHkgc2F2ZSB0aGUgY2hhbmdlZCBjb25maWcgb3B0aW9ucwogICAgaWYgKCAhJFBhcmFte0VtcHR5RmlsZX0gKSB7CgogICAgICAgIGZvciBteSAkQ29uZmlnSXRlbSAoIEB7ICRTZWxmLT57WE1MQ29uZmlnfSB9ICkgewoKICAgICAgICAgICAgaWYgKCAkQ29uZmlnSXRlbS0+e05hbWV9ICYmICEkVXNlZEtleXN7ICRDb25maWdJdGVtLT57TmFtZX0gfSApIHsKCiAgICAgICAgICAgICAgICBteSAlQ29uZmlnID0gJFNlbGYtPkNvbmZpZ0l0ZW1HZXQoCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAkQ29uZmlnSXRlbS0+e05hbWV9CiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIG15ICVDb25maWdEZWZhdWx0ID0gJFNlbGYtPkNvbmZpZ0l0ZW1HZXQoCiAgICAgICAgICAgICAgICAgICAgTmFtZSAgICA9PiAkQ29uZmlnSXRlbS0+e05hbWV9LAogICAgICAgICAgICAgICAgICAgIERlZmF1bHQgPT4gMSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkVXNlZEtleXN7ICRDb25maWdJdGVtLT57TmFtZX0gfSA9IDE7CgogICAgICAgICAgICAgICAgbXkgJE5hbWUgPSAkQ29uZmlne05hbWV9OwogICAgICAgICAgICAgICAgJE5hbWUgPX4gcy9cXC9cXFxcL2c7CiAgICAgICAgICAgICAgICAkTmFtZSA9fiBzLycvXCcvZzsKICAgICAgICAgICAgICAgICROYW1lID1+IHMvIyMjLyd9LT57Jy9nOwoKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAkQ29uZmlne1ZhbGlkfQogICAgICAgICAgICAgICAgICAgIHx8ICggJENvbmZpZ3tSZWFkT25seX0gJiYgJENvbmZpZ0RlZmF1bHR7VmFsaWR9ICYmICRDb25maWdEZWZhdWx0e1JlcXVpcmVkfSApCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgewoKICAgICAgICAgICAgICAgICAgICBteSAkQyA9ICRTZWxmLT5fWE1MMlBlcmwoIERhdGEgPT4gXCVDb25maWcgKTsKICAgICAgICAgICAgICAgICAgICBteSAkRCA9ICRTZWxmLT5fWE1MMlBlcmwoIERhdGEgPT4gXCVDb25maWdEZWZhdWx0ICk7CiAgICAgICAgICAgICAgICAgICAgbXkgKCAkQTEsICRBMiApOwogICAgICAgICAgICAgICAgICAgIGV2YWwgIlwkQTEgPSAkQyI7CiAgICAgICAgICAgICAgICAgICAgZXZhbCAiXCRBMiA9ICREIjsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhZGVmaW5lZCAkQTEgJiYgIWRlZmluZWQgJEEyICkgewoKICAgICAgICAgICAgICAgICAgICAgICAgIyBkbyBub3RoaW5nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2lmICggJENvbmZpZ3tSZWFkT25seX0gKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAjIGRvIG5vdGhpbmcgKD0gcmVzZXQgdG8gcmVhZG9ubHkgdmFsdWUpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2lmICgKICAgICAgICAgICAgICAgICAgICAgICAgKCBkZWZpbmVkICRBMSAmJiAhZGVmaW5lZCAkQTIgKQogICAgICAgICAgICAgICAgICAgICAgICB8fCAoICFkZWZpbmVkICRBMSAmJiBkZWZpbmVkICRBMiApCiAgICAgICAgICAgICAgICAgICAgICAgIHx8ICRTZWxmLT5fRGF0YURpZmYoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhMSA9PiBcJEExLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0YTIgPT4gXCRBMgogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgIHx8ICggJENvbmZpZ3tWYWxpZH0gJiYgISRDb25maWdEZWZhdWx0e1ZhbGlkfSApCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICRGaWxlIC49ICJcJFNlbGYtPnsnJE5hbWUnfSA9ICRDIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgogICAgICAgICAgICAgICAgICAgICAgICAjIGRvIG5vdGhpbmcKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNpZiAoCiAgICAgICAgICAgICAgICAgICAgISRDb25maWd7VmFsaWR9CiAgICAgICAgICAgICAgICAgICAgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICAkQ29uZmlnRGVmYXVsdHtWYWxpZH0KICAgICAgICAgICAgICAgICAgICAgICAgfHwgZXZhbCggJyRTZWxmLT57Q29uZmlnRGVmYXVsdE9iamVjdH0tPntcJycgLiAkTmFtZSAuICdcJ30nICkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICRGaWxlIC49ICJkZWxldGUgXCRTZWxmLT57JyROYW1lJ307XG4iOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgd3JpdGUgbmV3IGNvbmZpZyBmaWxlCiAgICBteSAkT3V0OwogICAgJE91dCAuPSAiIyBPVFJTIGNvbmZpZyBmaWxlIChhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZClcbiI7CiAgICAkT3V0IC49ICIjIFZFUlNJT046MS4xXG4iOwogICAgJE91dCAuPSAicGFja2FnZSBLZXJuZWw6OkNvbmZpZzo6RmlsZXM6OlpaWkF1dG87XG4iOwogICAgJE91dCAuPSAidXNlIHN0cmljdDtcbiI7CiAgICAkT3V0IC49ICJ1c2Ugd2FybmluZ3M7XG4iOwogICAgJE91dCAuPSAibm8gd2FybmluZ3MgJ3JlZGVmaW5lJztcbiI7CiAgICBpZiAoICRTZWxmLT57dXRmOH0gKSB7CiAgICAgICAgJE91dCAuPSAidXNlIHV0Zjg7XG4iOwogICAgfQogICAgJE91dCAuPSAic3ViIExvYWQge1xuIjsKICAgICRPdXQgLj0gIiAgICBteSAoXCRGaWxlLCBcJFNlbGYpID0gXEBfO1xuIjsKICAgICRPdXQgLj0gJEZpbGU7CiAgICAkT3V0IC49ICJ9XG4iOwogICAgJE91dCAuPSAiMTtcbiI7CgogICAgcmV0dXJuICRTZWxmLT5fRmlsZVdyaXRlQXRvbWljKAogICAgICAgIEZpbGVuYW1lID0+ICIkU2VsZi0+e0hvbWV9L0tlcm5lbC9Db25maWcvRmlsZXMvWlpaQXV0by5wbSIsCiAgICAgICAgQ29udGVudCAgPT4gXCRPdXQsCiAgICApOwp9Cgo9aXRlbSBDb25maWdJdGVtVXBkYXRlKCkKCnN1Ym1pdCBjb25maWcgc2V0dGluZ3MgYW5kIHNhdmUgaXQuCgogICAgJFN5c0NvbmZpZ09iamVjdC0+Q29uZmlnSXRlbVVwZGF0ZSgKICAgICAgICBWYWxpZCAgICAgICAgPT4gMSwKICAgICAgICBLZXkgICAgICAgICAgPT4gJ1dlYlVwbG9hZENhY2hlTW9kdWxlJywKICAgICAgICBWYWx1ZSAgICAgICAgPT4gJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlVwbG9hZENhY2hlOjpEQicsCiAgICAgICAgTm9WYWxpZGF0aW9uID0+IDEsICAgICMgKG9wdGlvbmFsKSBubyB2YWxpZGF0aW9uIG9yIGF1dG8tY29ycmVjdGlvbiB3aWxsIGJlIGRvbmUsIHRvIHByZXZlbnQgbG9vcHMuCiAgICApOwoKPWN1dAoKc3ViIENvbmZpZ0l0ZW1VcGRhdGUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkSG9tZSA9ICRTZWxmLT57SG9tZX07CgogICAgIyByZW1lbWJlciB0byB1cGRhdGUgWlpaQUF1dG8ucG0gYW5kIFpaWkF1dG8ucG0KICAgICRTZWxmLT57VXBkYXRlfSA9IDE7CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGZvciAocXcoVmFsaWQgS2V5IFZhbHVlKSkgewogICAgICAgIGlmICggIWRlZmluZWQoICRQYXJhbXskX30gKSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5lZWQgJF8hIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgY2hlY2sgaWYgd2UgbmVlZCB0byBjcmVhdGUgY29uZmlnIGZpbGUKICAgIGlmICggIS1lICIkSG9tZS9LZXJuZWwvQ29uZmlnL0ZpbGVzL1paWkF1dG8ucG0iICYmICEkU2VsZi0+Q3JlYXRlQ29uZmlnKCBFbXB0eUZpbGUgPT4gMSApICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiQ2FuJ3QgY3JlYXRlIGVtcHR5ICRIb21lL0tlcm5lbC9Db25maWcvRmlsZXMvWlpaQXV0by5wbSEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgY2hlY2sgaWYgY29uZmlnIGZpbGUgaXMgd3JpdGFibGUKICAgIG15ICRPdXQ7CiAgICAjIyBubyBjcml0aWMKICAgIGlmICggIW9wZW4oICRPdXQsICI+PiRTZWxmLT57RmlsZU1vZGV9IiwgIiRIb21lL0tlcm5lbC9Db25maWcvRmlsZXMvWlpaQXV0by5wbSIgKSApIHsKICAgICAgICAjIyB1c2UgY3JpdGljCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDYW4ndCB3cml0ZSAkSG9tZS9LZXJuZWwvQ29uZmlnL0ZpbGVzL1paWkF1dG8ucG06ICQhIiwKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGNsb3NlKCRPdXQpOwoKICAgICMgb25seSB2YWxpZGF0ZSBhbmQgYXV0byBjb3JyZWN0IGlmIHBhcmFtIE5vVmFsaWRhdGlvbiBpcyB1bmRlZmluZWQgb3IgZmFsc2UKICAgIGlmICggISRQYXJhbXtOb1ZhbGlkYXRpb259ICkgewoKICAgICAgICAjIHZhbGlkYXRlIHRoZSB2YWx1ZSwgYW5kIGF1dG8tY29ycmVjdCBpdCBpZiBuZWNjZXNzYXJ5CiAgICAgICAgbXkgJFZhbGlkYXRlT2sgPSAkU2VsZi0+Q29uZmlnSXRlbVZhbGlkYXRlKAogICAgICAgICAgICBLZXkgICA9PiAkUGFyYW17S2V5fSwKICAgICAgICAgICAgVmFsdWUgPT4gJFBhcmFte1ZhbHVlfSwKICAgICAgICApOwoKICAgICAgICAjIGF1dG8gY29ycmVjdCB0aGUgdmFsdWUgaWYgdGhlIHZhbGlkYXRpb24gZmFpbGVkCiAgICAgICAgaWYgKCAhJFZhbGlkYXRlT2sgKSB7CgogICAgICAgICAgICBteSAkUmVzdWx0ID0gJFNlbGYtPkNvbmZpZ0l0ZW1WYWxpZGF0ZSgKICAgICAgICAgICAgICAgIEtleSAgICAgICAgID0+ICRQYXJhbXtLZXl9LAogICAgICAgICAgICAgICAgVmFsdWUgICAgICAgPT4gJFBhcmFte1ZhbHVlfSwKICAgICAgICAgICAgICAgIFZhbGlkICAgICAgID0+ICRQYXJhbXtWYWxpZH0sCiAgICAgICAgICAgICAgICBBdXRvQ29ycmVjdCA9PiAxLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBubyBuZWVkIHRvIGdvIGZ1cnRoZXIgYXMgdGhlIHVwZGF0ZSBvZiB0aGUgY29uZmlnIGl0ZW0KICAgICAgICAgICAgIyBpcyBkb25lIGZyb20gd2l0aGluIENvbmZpZ0l0ZW1WYWxpZGF0ZSgpIGR1cmluZyBhdXRvLWNvcnJlY3Rpb24KICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgfQoKICAgICMgS0lYQ29yZS1jYXBlSVQKICAgICMgd2Ugd2lsbCBuZWVkIHRoZSBvcmlnaW5hbCBrZXkgbGF0ZXIKICAgICRQYXJhbXtPcmdLZXl9ID0gJFBhcmFte0tleX07CgogICAgIyBFTyBLSVhDb3JlLWNhcGVJVAoKICAgICRQYXJhbXtLZXl9ID1+IHMvXFwvXFxcXC9nOwogICAgJFBhcmFte0tleX0gPX4gcy8nL1wnL2c7CiAgICAkUGFyYW17S2V5fSA9fiBzLyMjIy8nfS0+eycvZzsKCiAgICAjIGdldCBvcHRpb24gdG8gc3RvcmUgaXQKICAgIG15ICRPcHRpb24gPSAnJzsKICAgIGlmICggISRQYXJhbXtWYWxpZH0gKSB7CiAgICAgICAgJE9wdGlvbiA9ICJkZWxldGUgXCRTZWxmLT57JyRQYXJhbXtLZXl9J307XG4iOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJE9wdGlvbiA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyktPkR1bXAoICRQYXJhbXtWYWx1ZX0gKTsKICAgICAgICAkT3B0aW9uID1+IHMvXCRWQVIxL1wkU2VsZi0+eyckUGFyYW17S2V5fSd9LzsKICAgIH0KCiAgICAjIEtJWENvcmUtY2FwZUlUCiAgICAjIGdldCBvbGQgdmFsdWUKICAgIG15ICRPbGRWYWx1ZSA9IGV2YWwoIlwkU2VsZi0+e0NvbmZpZ09iamVjdH0tPnsnJFBhcmFte0tleX0nfSIpOwoKICAgICMgZ2V0IG9sZCBjb25maWcgaXRlbQogICAgbXkgJU9sZENvbmZpZyA9ICRTZWxmLT5Db25maWdJdGVtR2V0KCBOYW1lID0+ICRQYXJhbXtPcmdLZXl9ICk7CgogICAgIyBFTyBLSVhDb3JlLWNhcGVJVAoKICAgICMgc2V0IG9wdGlvbiBpbiBydW50aW1lCiAgICBteSAkT3B0aW9uUnVudGltZSA9ICRPcHRpb247CiAgICAkT3B0aW9uUnVudGltZSA9fiBzL1NlbGYtPi9TZWxmLT5ce0NvbmZpZ09iamVjdFx9LT4vOwogICAgZXZhbCAkT3B0aW9uUnVudGltZTsKCiAgICAjIEtJWENvcmUtY2FwZUlUCiAgICAjIGdldCBuZXcgdmFsdWUKICAgIG15ICROZXdWYWx1ZSA9ICRQYXJhbXtWYWx1ZX07CgogICAgbXkgJENoYW5nZVR5cGUgPSAwOwogICAgaWYgKCAkU2VsZi0+e0NvbmZpZ09iamVjdH0tPkdldCgnU3lzQ29uZmlnOjpFdmVudE1vZHVsZVBvc3QnKSApCiAgICB7CiAgICAgICAgaWYgKCAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpLT5SZXF1aXJlKCdEYXRhOjpDb21wYXJlJykgKSB7CiAgICAgICAgICAgIG15ICRDb21wYXJhdG9yID0gRGF0YTo6Q29tcGFyZS0+bmV3KCk7CiAgICAgICAgICAgIGlmICggKCAoICRPbGRDb25maWd7VmFsaWR9IHx8IDAgKSArICggJFBhcmFte1ZhbGlkfSB8fCAwICkgKSA9PSAxICkgewogICAgICAgICAgICAgICAgaWYgKCAkUGFyYW17VmFsaWR9ICkgewogICAgICAgICAgICAgICAgICAgICRDaGFuZ2VUeXBlID0gMTsgICAgIyBlbmFibGVkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkQ2hhbmdlVHlwZSA9IDI7ICAgICMgZGlzYWJsZWQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNpZiAoICEoICRDb21wYXJhdG9yLT5DbXAoICRPbGRWYWx1ZSwgJE5ld1ZhbHVlICkgKSAmJiAkUGFyYW17VmFsaWR9ICkgewogICAgICAgICAgICAgICAgJENoYW5nZVR5cGUgPSAzOyAgICAgICAgIyBjaGFuZ2VkCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ25vdGljZScsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiS2VybmVsOjpTeXN0ZW06OlN5c0NvbmZpZyAtIERhdGE6OkNvbXBhcmUgbm90IGF2YWlsYWJsZSIKICAgICAgICAgICAgICAgICAgICAuICIgd2lsbCBub3QgdHJhY2sgU3lzQ29uZmlnIGNoYW5nZXMiLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIEVPIEtJWENvcmUtY2FwZUlUCgogICAgIyBnZXQgY29uZmlnIGZpbGUgYW5kIGluc2VydCBpdAogICAgbXkgJEluOwogICAgIyMgbm8gY3JpdGljCiAgICBpZiAoICFvcGVuKCAkSW4sICI8JFNlbGYtPntGaWxlTW9kZX0iLCAiJEhvbWUvS2VybmVsL0NvbmZpZy9GaWxlcy9aWlpBdXRvLnBtIiApICkgewogICAgICAgICMjIHVzZSBjcml0aWMKCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDYW4ndCByZWFkICRIb21lL0tlcm5lbC9Db25maWcvRmlsZXMvWlpaQXV0by5wbTogJCEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgdXBkYXRlIGNvbnRlbnQKICAgIG15IEBGaWxlT2xkID0gPCRJbj47CiAgICBteSBARmlsZU5ldzsKICAgIG15ICRJbnNlcnQgPSAwOwogICAgZm9yIG15ICRMaW5lICggcmV2ZXJzZSBARmlsZU9sZCApIHsKICAgICAgICBwdXNoKCBARmlsZU5ldywgJExpbmUgKTsKICAgICAgICBpZiAoICEkSW5zZXJ0ICYmICggJExpbmUgPX4gL159LyB8fCAkTGluZSA9fiAvXlwkU2VsZi0+XHsnMSdcfSA9IDE7LyApICkgewogICAgICAgICAgICBwdXNoKCBARmlsZU5ldywgJE9wdGlvbiApOwogICAgICAgICAgICAkSW5zZXJ0ID0gMTsKICAgICAgICB9CiAgICB9CiAgICBjbG9zZSgkSW4pOwoKICAgIG15ICRDb250ZW50OwogICAgZm9yIG15ICRMaW5lICggcmV2ZXJzZSBARmlsZU5ldyApIHsKICAgICAgICAkQ29udGVudCAuPSAkTGluZTsKICAgIH0KCiAgICAjIEtJWENvcmUtY2FwZUlUCiAgICAjIHJldHVybiAkU2VsZi0+X0ZpbGVXcml0ZUF0b21pYygKICAgIG15ICRSZXN1bHQgPSAkU2VsZi0+X0ZpbGVXcml0ZUF0b21pYygKICAgICAgICBGaWxlbmFtZSA9PiAiJFNlbGYtPntIb21lfS9LZXJuZWwvQ29uZmlnL0ZpbGVzL1paWkF1dG8ucG0iLAogICAgICAgIENvbnRlbnQgID0+IFwkQ29udGVudCwKICAgICk7CgojIHRyaWdnZXIgZXZlbnQgaGFuZGxlciBvbmx5IGlmIHRoaXMga2V5IGhhcyBiZWVuIGNoYW5nZWQgaW4gc29tZSB3YXkgYW5kIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSB3cml0dGVuIHRvIHRoZSBmaWxlCiAgICBpZiAoICRDaGFuZ2VUeXBlICYmICRSZXN1bHQgKSB7CiAgICAgICAgJFNlbGYtPkV2ZW50SGFuZGxlcigKICAgICAgICAgICAgRXZlbnQgPT4gJ1N5c0NvbmZpZ0l0ZW1VcGRhdGUnLAogICAgICAgICAgICBEYXRhICA9PiB7CiAgICAgICAgICAgICAgICBLZXkgICAgICAgID0+ICRQYXJhbXtPcmdLZXl9LAogICAgICAgICAgICAgICAgQ2hhbmdlVHlwZSA9PiAkQ2hhbmdlVHlwZSwKICAgICAgICAgICAgICAgIE9sZFZhbHVlICAgPT4gJE9sZFZhbHVlLAogICAgICAgICAgICAgICAgTmV3VmFsdWUgICA9PiAkTmV3VmFsdWUsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0gfHwgMSwKICAgICAgICApOwogICAgfQogICAgcmV0dXJuICRSZXN1bHQ7CgogICAgIyBFTyBLSVhDb3JlLWNhcGVJVAoKfQoKPWl0ZW0gQ29uZmlnSXRlbUdldCgpCgpnZXQgYSBjdXJyZW50IGNvbmZpZ3VyYXRpb24gc2V0dGluZywgaW5jbHVkaW5nIGNoYW5nZXMKdGhhdCB0aGUgdXNlcnMgbWFkZToKCiAgICBteSAlQ29uZmlnID0gJFN5c0NvbmZpZ09iamVjdC0+Q29uZmlnSXRlbUdldCgKICAgICAgICBOYW1lID0+ICdUaWNrZXQ6Ok51bWJlckdlbmVyYXRvcicsCiAgICApOwoKVG8gZ2V0IHRoZSBkZWZhdWx0IHZhbHVlIG9mIGEgY29uZmlndXJhdGlvbiBzZXR0aW5nLCBwYXNzCnRoZSBEZWZhdWx0IGZsYWc6CgogICAgbXkgJUNvbmZpZyA9ICRTeXNDb25maWdPYmplY3QtPkNvbmZpZ0l0ZW1HZXQoCiAgICAgICAgTmFtZSAgICA9PiAnVGlja2V0OjpOdW1iZXJHZW5lcmF0b3InLAogICAgICAgIERlZmF1bHQgPT4gMSwKICAgICk7Cgo9Y3V0CgpzdWIgQ29uZmlnSXRlbUdldCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgKHF3KE5hbWUpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyRffSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5lZWQgJF8hIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQogICAgbXkgJExldmVsID0gJyc7CiAgICBpZiAoICRQYXJhbXtEZWZhdWx0fSApIHsKICAgICAgICAkTGV2ZWwgPSAnRGVmYXVsdCc7CiAgICB9CgogICAgIyByZXR1cm4gb24gaW52YWxpZCBjb25maWcgaXRlbQogICAgcmV0dXJuIGlmICEkU2VsZi0+e0NvbmZpZ30tPnsgJFBhcmFte05hbWV9IH07CgogICAgIyBnZXQgbWFpbiBvYmplY3QKICAgIG15ICRNYWluT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKTsKCiAgICAjIGNvcHkgY29uZmlnIGFuZCBzdG9yZSBpdCBhcyBkZWZhdWx0CiAgICBteSAkRHVtcCA9ICRNYWluT2JqZWN0LT5EdW1wKCAkU2VsZi0+e0NvbmZpZ30tPnsgJFBhcmFte05hbWV9IH0gKTsKICAgICREdW1wID1+IHMvXCRWQVIxID0vXCRDb25maWdJdGVtID0vOwoKICAgICMgcmggYXMgOCBidWcgZml4CiAgICAkRHVtcCA9fiBzL1wkXHtcXFwkVkFSMS0+XHsnLis/J31cWzBcXX0vXHtcfS9nOwogICAgbXkgJENvbmZpZ0l0ZW07CiAgICBpZiAoICFldmFsICREdW1wICkgewogICAgICAgIGRpZSAiRVJST1I6ICQhOiAkQCBpbiAkRHVtcCI7CiAgICB9CgogICAgIyBhZGQgY3VycmVudCB2YWxpZCBzdGF0ZQogICAgaWYgKCAhJFBhcmFte0RlZmF1bHR9ICYmICFkZWZpbmVkICRTZWxmLT5fTW9kR2V0KCBDb25maWdOYW1lID0+ICRDb25maWdJdGVtLT57TmFtZX0gKSApIHsKICAgICAgICAkQ29uZmlnSXRlbS0+e1ZhbGlkfSA9IDA7CiAgICB9CiAgICBlbHNpZiAoICEkUGFyYW17RGVmYXVsdH0gKSB7CiAgICAgICAgJENvbmZpZ0l0ZW0tPntWYWxpZH0gPSAxOwogICAgfQoKICAgICMgdXBkYXRlIHhtbCB3aXRoIGN1cnJlbnQgY29uZmlnIHNldHRpbmcKICAgIGlmICggJENvbmZpZ0l0ZW0tPntTZXR0aW5nfS0+WzFdLT57U3RyaW5nfSApIHsKCiAgICAgICAgIyBmaWxsIGRlZmF1bHQKICAgICAgICAkQ29uZmlnSXRlbS0+e1NldHRpbmd9LT5bMV0tPntTdHJpbmd9LT5bMV0tPntEZWZhdWx0fSA9ICRDb25maWdJdGVtLT57U2V0dGluZ30tPlsxXS0+e1N0cmluZ30tPlsxXS0+e0NvbnRlbnR9OwogICAgICAgIG15ICRTdHJpbmcgPSAkU2VsZi0+X01vZEdldCgKICAgICAgICAgICAgQ29uZmlnTmFtZSA9PiAkQ29uZmlnSXRlbS0+e05hbWV9LAogICAgICAgICAgICBMZXZlbCAgICAgID0+ICRMZXZlbAogICAgICAgICk7CiAgICAgICAgaWYgKCAhJFBhcmFte0RlZmF1bHR9ICYmIGRlZmluZWQoJFN0cmluZykgKSB7CiAgICAgICAgICAgICRDb25maWdJdGVtLT57U2V0dGluZ30tPlsxXS0+e1N0cmluZ30tPlsxXS0+e0NvbnRlbnR9ID0gJFN0cmluZzsKICAgICAgICB9CiAgICB9CiAgICBpZiAoICRDb25maWdJdGVtLT57U2V0dGluZ30tPlsxXS0+e1RleHRBcmVhfSApIHsKCiAgICAgICAgIyBmaWxsIGRlZmF1bHQKICAgICAgICAkQ29uZmlnSXRlbS0+e1NldHRpbmd9LT5bMV0tPntUZXh0QXJlYX0tPlsxXS0+e0RlZmF1bHR9CiAgICAgICAgICAgID0gJENvbmZpZ0l0ZW0tPntTZXR0aW5nfS0+WzFdLT57VGV4dEFyZWF9LT5bMV0tPntDb250ZW50fTsKICAgICAgICBteSAkVGV4dEFyZWEgPSAkU2VsZi0+X01vZEdldCgKICAgICAgICAgICAgQ29uZmlnTmFtZSA9PiAkQ29uZmlnSXRlbS0+e05hbWV9LAogICAgICAgICAgICBMZXZlbCAgICAgID0+ICRMZXZlbAogICAgICAgICk7CiAgICAgICAgaWYgKCAhJFBhcmFte0RlZmF1bHR9ICYmIGRlZmluZWQoJFRleHRBcmVhKSApIHsKICAgICAgICAgICAgJENvbmZpZ0l0ZW0tPntTZXR0aW5nfS0+WzFdLT57VGV4dEFyZWF9LT5bMV0tPntDb250ZW50fSA9ICRUZXh0QXJlYTsKICAgICAgICB9CiAgICB9CiAgICBpZiAoICRDb25maWdJdGVtLT57U2V0dGluZ30tPlsxXS0+e09wdGlvbn0gKSB7CgogICAgICAgICMgZmlsbCBkZWZhdWx0CiAgICAgICAgJENvbmZpZ0l0ZW0tPntTZXR0aW5nfS0+WzFdLT57T3B0aW9ufS0+WzFdLT57RGVmYXVsdH0KICAgICAgICAgICAgPSAkQ29uZmlnSXRlbS0+e1NldHRpbmd9LT5bMV0tPntPcHRpb259LT5bMV0tPntTZWxlY3RlZElEfTsKICAgICAgICBteSAkT3B0aW9uID0gJFNlbGYtPl9Nb2RHZXQoCiAgICAgICAgICAgIENvbmZpZ05hbWUgPT4gJENvbmZpZ0l0ZW0tPntOYW1lfSwKICAgICAgICAgICAgTGV2ZWwgICAgICA9PiAkTGV2ZWwKICAgICAgICApOwogICAgICAgIGlmICggISRQYXJhbXtEZWZhdWx0fSAmJiBkZWZpbmVkKCRPcHRpb24pICkgewogICAgICAgICAgICAkQ29uZmlnSXRlbS0+e1NldHRpbmd9LT5bMV0tPntPcHRpb259LT5bMV0tPntTZWxlY3RlZElEfSA9ICRPcHRpb247CiAgICAgICAgfQogICAgfQogICAgaWYgKCAkQ29uZmlnSXRlbS0+e1NldHRpbmd9LT5bMV0tPntIYXNofSApIHsKICAgICAgICBteSAkSGFzaFJlZiA9ICRTZWxmLT5fTW9kR2V0KAogICAgICAgICAgICBDb25maWdOYW1lID0+ICRDb25maWdJdGVtLT57TmFtZX0sCiAgICAgICAgICAgIExldmVsICAgICAgPT4gJExldmVsCiAgICAgICAgKTsKICAgICAgICBpZiAoICEkUGFyYW17RGVmYXVsdH0gJiYgZGVmaW5lZCgkSGFzaFJlZikgKSB7CiAgICAgICAgICAgIG15IEBBcnJheTsKICAgICAgICAgICAgaWYgKCByZWYgJENvbmZpZ0l0ZW0tPntTZXR0aW5nfS0+WzFdLT57SGFzaH0tPlsxXS0+e0l0ZW19IGVxICdBUlJBWScgKSB7CiAgICAgICAgICAgICAgICBAQXJyYXkgPSBAeyAkQ29uZmlnSXRlbS0+e1NldHRpbmd9LT5bMV0tPntIYXNofS0+WzFdLT57SXRlbX0gfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBAeyAkQ29uZmlnSXRlbS0+e1NldHRpbmd9LT5bMV0tPntIYXNofS0+WzFdLT57SXRlbX0gfSA9ICh1bmRlZik7CiAgICAgICAgICAgIG15ICVIYXNoOwogICAgICAgICAgICBpZiAoIHJlZiAkSGFzaFJlZiBlcSAnSEFTSCcgKSB7CiAgICAgICAgICAgICAgICAlSGFzaCA9ICV7JEhhc2hSZWZ9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICVIYXNoICkgewogICAgICAgICAgICAgICAgaWYgKCByZWYgJEhhc2h7JEtleX0gZXEgJ0FSUkFZJyApIHsKICAgICAgICAgICAgICAgICAgICBteSBAQXJyYXkgPSAoCiAgICAgICAgICAgICAgICAgICAgICAgIHVuZGVmLAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb250ZW50ID0+ICcnLAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBAeyAkQXJyYXlbMV17SXRlbX0gfSA9ICh1bmRlZik7CiAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRDb250ZW50ICggQHsgJEhhc2h7JEtleX0gfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCggQHsgJEFycmF5WzFde0l0ZW19IH0sIHsgQ29udGVudCA9PiAkQ29udGVudCB9ICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHB1c2goCiAgICAgICAgICAgICAgICAgICAgICAgIEB7ICRDb25maWdJdGVtLT57U2V0dGluZ30tPlsxXS0+e0hhc2h9LT5bMV0tPntJdGVtfSB9LAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBLZXkgICAgID0+ICRLZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb250ZW50ID0+ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXJyYXkgICA9PiBcQEFycmF5LAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNpZiAoIHJlZiAkSGFzaHskS2V5fSBlcSAnSEFTSCcgKSB7CiAgICAgICAgICAgICAgICAgICAgbXkgQEFycmF5ID0gKAogICAgICAgICAgICAgICAgICAgICAgICB1bmRlZiwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29udGVudCA9PiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgQHsgJEFycmF5WzFde0l0ZW19IH0gPSAodW5kZWYpOwogICAgICAgICAgICAgICAgICAgIGZvciBteSAkS2V5MiAoIHNvcnQga2V5cyAleyAkSGFzaHskS2V5fSB9ICkgewogICAgICAgICAgICAgICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQHsgJEFycmF5WzFde0l0ZW19IH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29udGVudCA9PiAkSGFzaHskS2V5fXskS2V5Mn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgS2V5ICAgICA9PiAkS2V5MgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgICAgICAgICBAeyAkQ29uZmlnSXRlbS0+e1NldHRpbmd9LT5bMV0tPntIYXNofS0+WzFdLT57SXRlbX0gfSwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgS2V5ICAgICA9PiAkS2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29udGVudCA9PiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhhc2ggICAgPT4gXEBBcnJheSwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbXkgJE9wdGlvbiA9IDA7CiAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRJbmRleCAoIDEgLi4gJCNBcnJheSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmaW5lZCggJEFycmF5WyRJbmRleF17S2V5fSApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiAkQXJyYXlbJEluZGV4XXtLZXl9IGVxICRLZXkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIGRlZmluZWQoICRBcnJheVskSW5kZXhde09wdGlvbn0gKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkT3B0aW9uID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRBcnJheVskSW5kZXhde09wdGlvbn1bMV17U2VsZWN0ZWRJRH0gPSAkSGFzaHskS2V5fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2goCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQHsgJENvbmZpZ0l0ZW0tPntTZXR0aW5nfS0+WzFdLT57SGFzaH0tPlsxXS0+e0l0ZW19IH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLZXkgICAgID0+ICRLZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnRlbnQgPT4gJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbiAgPT4gJEFycmF5WyRJbmRleF17T3B0aW9ufSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoICRPcHRpb24gPT0gMCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEB7ICRDb25maWdJdGVtLT57U2V0dGluZ30tPlsxXS0+e0hhc2h9LT5bMV0tPntJdGVtfSB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEtleSAgICAgPT4gJEtleSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb250ZW50ID0+ICRIYXNoeyRLZXl9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBpZiAoICRDb25maWdJdGVtLT57U2V0dGluZ30tPlsxXS0+e0FycmF5fSApIHsKICAgICAgICBteSAkQXJyYXlSZWYgPSAkU2VsZi0+X01vZEdldCgKICAgICAgICAgICAgQ29uZmlnTmFtZSA9PiAkQ29uZmlnSXRlbS0+e05hbWV9LAogICAgICAgICAgICBMZXZlbCAgICAgID0+ICRMZXZlbAogICAgICAgICk7CiAgICAgICAgaWYgKCAhJFBhcmFte0RlZmF1bHR9ICYmIGRlZmluZWQoJEFycmF5UmVmKSApIHsKICAgICAgICAgICAgQHsgJENvbmZpZ0l0ZW0tPntTZXR0aW5nfS0+WzFdLT57QXJyYXl9LT5bMV0tPntJdGVtfSB9ID0gKHVuZGVmKTsKICAgICAgICAgICAgbXkgQEFycmF5OwogICAgICAgICAgICBpZiAoIHJlZiAkQXJyYXlSZWYgZXEgJ0FSUkFZJyApIHsKICAgICAgICAgICAgICAgIEBBcnJheSA9IEB7JEFycmF5UmVmfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgbXkgJEtleSAoQEFycmF5KSB7CiAgICAgICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgICAgIEB7ICRDb25maWdJdGVtLT57U2V0dGluZ30tPlsxXS0+e0FycmF5fS0+WzFdLT57SXRlbX0gfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIENvbnRlbnQgPT4gJEtleSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGlmICggJENvbmZpZ0l0ZW0tPntTZXR0aW5nfS0+WzFdLT57RnJvbnRlbmRNb2R1bGVSZWd9ICkgewogICAgICAgIG15ICRIYXNoUmVmID0gJFNlbGYtPl9Nb2RHZXQoCiAgICAgICAgICAgIENvbmZpZ05hbWUgPT4gJENvbmZpZ0l0ZW0tPntOYW1lfSwKICAgICAgICAgICAgTGV2ZWwgICAgICA9PiAkTGV2ZWwKICAgICAgICApOwogICAgICAgIGlmICggISRQYXJhbXtEZWZhdWx0fSAmJiBkZWZpbmVkKCRIYXNoUmVmKSApIHsKICAgICAgICAgICAgQHsgJENvbmZpZ0l0ZW0tPntTZXR0aW5nfS0+WzFdLT57RnJvbnRlbmRNb2R1bGVSZWd9IH0gPSAodW5kZWYpOwogICAgICAgICAgICBteSAlSGFzaDsKICAgICAgICAgICAgaWYgKCByZWYgJEhhc2hSZWYgZXEgJ0hBU0gnICkgewogICAgICAgICAgICAgICAgJUhhc2ggPSAleyRIYXNoUmVmfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgbXkgJEtleSAoIHNvcnQga2V5cyAlSGFzaCApIHsKICAgICAgICAgICAgICAgIEB7ICRDb25maWdJdGVtLT57U2V0dGluZ30tPlsxXS0+e0Zyb250ZW5kTW9kdWxlUmVnfS0+WzFdLT57JEtleX0gfSA9ICh1bmRlZik7CiAgICAgICAgICAgICAgICBpZiAoICRLZXkgZXEgJ0dyb3VwJyB8fCAkS2V5IGVxICdHcm91cFJvJyApIHsKICAgICAgICAgICAgICAgICAgICBteSBAQXJyYXkgPSAodW5kZWYpOwogICAgICAgICAgICAgICAgICAgIGZvciBteSAkQ29udGVudCAoIEB7ICRIYXNoeyRLZXl9IH0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHB1c2goCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBAeyAkQ29uZmlnSXRlbS0+e1NldHRpbmd9LT5bMV0tPntGcm9udGVuZE1vZHVsZVJlZ30tPlsxXS0+eyRLZXl9IH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IENvbnRlbnQgPT4gJENvbnRlbnQgfQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2lmICggJEtleSBlcSAnTG9hZGVyJyApIHsKICAgICAgICAgICAgICAgICAgICBteSAlTG9hZGVyRmlsZXM7CiAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRLZXkyICggJXsgJEhhc2h7JEtleX0gfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEtleTIgZXEgJ0NTUycKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8ICRLZXkyIGVxICdKYXZhU2NyaXB0JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHJlZiAkS2V5MiBuZSAnQVJSQVknICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15IEBGaWxlcyA9ICh1bmRlZik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRJbmRleCAoIDAgLi4gJCN7ICRIYXNoeyRLZXl9LT57JEtleTJ9IH0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15ICRMb2FkZXJGaWxlID0gJEhhc2h7JEtleX0tPnskS2V5Mn1bJEluZGV4XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEBGaWxlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgQ29udGVudCA9PiAkTG9hZGVyRmlsZSB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTG9hZGVyRmlsZXN7JEtleTJ9ID0gXEBGaWxlczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgICAgICAgICBAeyAkQ29uZmlnSXRlbS0+e1NldHRpbmd9LT5bMV0tPntGcm9udGVuZE1vZHVsZVJlZ30tPlsxXS0+eyRLZXl9IH0sCiAgICAgICAgICAgICAgICAgICAgICAgIFwlTG9hZGVyRmlsZXMsCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2lmICggJEtleSBlcSAnTmF2QmFyJyB8fCAkS2V5IGVxICdOYXZCYXJNb2R1bGUnICkgewogICAgICAgICAgICAgICAgICAgIGlmICggcmVmICRIYXNoeyRLZXl9IGVxICdBUlJBWScgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBteSAkQ29udGVudCAoIEB7ICRIYXNoeyRLZXl9IH0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBteSAlTmF2QmFyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICggc29ydCBrZXlzICV7JENvbnRlbnR9ICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJF8gZXEgJ0dyb3VwJyB8fCAkXyBlcSAnR3JvdXBSbycgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEB7ICROYXZCYXJ7JF99IH0gPSAodW5kZWYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgbXkgJEdyb3VwICggQHsgJENvbnRlbnQtPnskX30gfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2goIEB7ICROYXZCYXJ7JF99IH0sIHsgQ29udGVudCA9PiAkR3JvdXAgfSApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQHsgJE5hdkJhcnskX30gfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICggdW5kZWYsIHsgQ29udGVudCA9PiAkQ29udGVudC0+eyRffSB9ICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRDb25maWdJdGVtLT57U2V0dGluZ30tPlsxXS0+e0Zyb250ZW5kTW9kdWxlUmVnfS0+WzFdLT57JEtleX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwlTmF2QmFyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBteSAlTmF2QmFyOwogICAgICAgICAgICAgICAgICAgICAgICBteSAkQ29udGVudCA9ICRIYXNoeyRLZXl9OwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCBzb3J0IGtleXMgJXskQ29udGVudH0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRfIGVxICdHcm91cCcgfHwgJF8gZXEgJ0dyb3VwUm8nICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEB7ICROYXZCYXJ7JF99IH0gPSAodW5kZWYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBteSAkR3JvdXAgKCBAeyAkQ29udGVudC0+eyRffSB9ICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKCBAeyAkTmF2QmFyeyRffSB9LCB7IENvbnRlbnQgPT4gJEdyb3VwIH0gKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBAeyAkTmF2QmFyeyRffSB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoIHVuZGVmLCB7IENvbnRlbnQgPT4gJENvbnRlbnQtPnskX30gfSApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkQ29uZmlnSXRlbS0+e1NldHRpbmd9LT5bMV0tPntGcm9udGVuZE1vZHVsZVJlZ30tPlsxXS0+eyRLZXl9ID0gXCVOYXZCYXI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgICAgICAgICAgQHsgJENvbmZpZ0l0ZW0tPntTZXR0aW5nfS0+WzFdLT57RnJvbnRlbmRNb2R1bGVSZWd9LT5bMV0tPnskS2V5fSB9LAogICAgICAgICAgICAgICAgICAgICAgICB7IENvbnRlbnQgPT4gJEhhc2h7JEtleX0gfQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBpZiAoICRDb25maWdJdGVtLT57U2V0dGluZ30tPlsxXS0+e1RpbWVXb3JraW5nSG91cnN9ICkgewogICAgICAgIG15ICREYXlzUmVmID0gJFNlbGYtPl9Nb2RHZXQoCiAgICAgICAgICAgIENvbmZpZ05hbWUgPT4gJENvbmZpZ0l0ZW0tPntOYW1lfSwKICAgICAgICAgICAgTGV2ZWwgICAgICA9PiAkTGV2ZWwKICAgICAgICApOwogICAgICAgIGlmICggISRQYXJhbXtEZWZhdWx0fSAmJiBkZWZpbmVkKCREYXlzUmVmKSApIHsKICAgICAgICAgICAgQHsgJENvbmZpZ0l0ZW0tPntTZXR0aW5nfS0+WzFdLT57VGltZVdvcmtpbmdIb3Vyc30tPlsxXS0+e0RheX0gfSA9ICh1bmRlZik7CiAgICAgICAgICAgIG15ICVEYXlzOwogICAgICAgICAgICBpZiAoIHJlZiAkRGF5c1JlZiBlcSAnSEFTSCcgKSB7CiAgICAgICAgICAgICAgICAlRGF5cyA9ICV7JERheXNSZWZ9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciBteSAkRGF5ICggc29ydCBrZXlzICVEYXlzICkgewogICAgICAgICAgICAgICAgbXkgQEFycmF5ID0gKHVuZGVmKTsKICAgICAgICAgICAgICAgIGZvciBteSAkSG91ciAoIEB7ICREYXlzeyREYXl9IH0gKSB7CiAgICAgICAgICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgICAgICAgICAgQEFycmF5LAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb250ZW50ID0+ICRIb3VyLAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHB1c2goCiAgICAgICAgICAgICAgICAgICAgQHsgJENvbmZpZ0l0ZW0tPntTZXR0aW5nfS0+WzFdLT57VGltZVdvcmtpbmdIb3Vyc30tPlsxXS0+e0RheX0gfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJERheSwKICAgICAgICAgICAgICAgICAgICAgICAgSG91ciA9PiBcQEFycmF5LAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgaWYgKCAkQ29uZmlnSXRlbS0+e1NldHRpbmd9LT5bMV0tPntUaW1lVmFjYXRpb25EYXlzfSApIHsKICAgICAgICBteSAkSGFzaFJlZiA9ICRTZWxmLT5fTW9kR2V0KAogICAgICAgICAgICBDb25maWdOYW1lID0+ICRDb25maWdJdGVtLT57TmFtZX0sCiAgICAgICAgICAgIExldmVsICAgICAgPT4gJExldmVsCiAgICAgICAgKTsKICAgICAgICBpZiAoICEkUGFyYW17RGVmYXVsdH0gJiYgZGVmaW5lZCgkSGFzaFJlZikgKSB7CiAgICAgICAgICAgIEB7ICRDb25maWdJdGVtLT57U2V0dGluZ30tPlsxXS0+e1RpbWVWYWNhdGlvbkRheXN9LT5bMV0tPntJdGVtfSB9ID0gKHVuZGVmKTsKICAgICAgICAgICAgbXkgJUhhc2g7CiAgICAgICAgICAgIGlmICggcmVmICRIYXNoUmVmIGVxICdIQVNIJyApIHsKICAgICAgICAgICAgICAgICVIYXNoID0gJXskSGFzaFJlZn07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIG15ICRNb250aCAoIHNvcnQgeyAkYSA8PT4gJGIgfSBrZXlzICVIYXNoICkgewoKICAgICAgICAgICAgICAgIGlmICggJEhhc2h7JE1vbnRofSApIHsKICAgICAgICAgICAgICAgICAgICBteSAlRGF5cyA9ICV7ICRIYXNoeyRNb250aH0gfTsKICAgICAgICAgICAgICAgICAgICBmb3IgbXkgJERheSAoIHNvcnQgeyAkYSA8PT4gJGIgfSBrZXlzICVEYXlzICkgewogICAgICAgICAgICAgICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQHsgJENvbmZpZ0l0ZW0tPntTZXR0aW5nfS0+WzFdLT57VGltZVZhY2F0aW9uRGF5c30tPlsxXS0+e0l0ZW19IH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9udGggICA9PiAkTW9udGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF5ICAgICA9PiAkRGF5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnRlbnQgPT4gJEhhc2h7JE1vbnRofS0+eyREYXl9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBpZiAoICRDb25maWdJdGVtLT57U2V0dGluZ30tPlsxXS0+e1RpbWVWYWNhdGlvbkRheXNPbmVUaW1lfSApIHsKICAgICAgICBteSAkSGFzaFJlZiA9ICRTZWxmLT5fTW9kR2V0KAogICAgICAgICAgICBDb25maWdOYW1lID0+ICRDb25maWdJdGVtLT57TmFtZX0sCiAgICAgICAgICAgIExldmVsICAgICAgPT4gJExldmVsCiAgICAgICAgKTsKICAgICAgICBpZiAoICEkUGFyYW17RGVmYXVsdH0gJiYgZGVmaW5lZCgkSGFzaFJlZikgKSB7CiAgICAgICAgICAgIEB7ICRDb25maWdJdGVtLT57U2V0dGluZ30tPlsxXS0+e1RpbWVWYWNhdGlvbkRheXNPbmVUaW1lfS0+WzFdLT57SXRlbX0gfSA9ICh1bmRlZik7CiAgICAgICAgICAgIG15ICVIYXNoOwogICAgICAgICAgICBpZiAoIHJlZiAkSGFzaFJlZiBlcSAnSEFTSCcgKSB7CiAgICAgICAgICAgICAgICAlSGFzaCA9ICV7JEhhc2hSZWZ9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciBteSAkWWVhciAoIHNvcnQgeyAkYSA8PT4gJGIgfSBrZXlzICVIYXNoICkgewogICAgICAgICAgICAgICAgbXkgJU1vbnRocyA9ICV7ICRIYXNoeyRZZWFyfSB9OwogICAgICAgICAgICAgICAgaWYgKCVNb250aHMpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgbXkgJE1vbnRoICggc29ydCB7ICRhIDw9PiAkYiB9IGtleXMgJU1vbnRocyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIG15ICREYXkgKCBzb3J0IHsgJGEgPD0+ICRiIH0ga2V5cyAleyAkSGFzaHskWWVhcn0tPnskTW9udGh9IH0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRDb25maWdJdGVtLT57U2V0dGluZ30tPlsxXS0+e1RpbWVWYWNhdGlvbkRheXNPbmVUaW1lfS0+WzFdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPntJdGVtfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBZZWFyICAgID0+ICRZZWFyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb250aCAgID0+ICRNb250aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF5ICAgICA9PiAkRGF5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb250ZW50ID0+ICRIYXNoeyRZZWFyfS0+eyRNb250aH0tPnskRGF5fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGlmICggJENvbmZpZ0l0ZW0tPntTZXR0aW5nfS0+WzFdLT57RGF0ZVRpbWV9ICkgewoKICAgICAgICAjIGdldCBkYXRhIGludG8gYSBwZXJsIEhhc2gKICAgICAgICBteSAkSGFzaFJlZiA9ICRTZWxmLT5fTW9kR2V0KAogICAgICAgICAgICBDb25maWdOYW1lID0+ICRDb25maWdJdGVtLT57TmFtZX0sCiAgICAgICAgICAgIExldmVsICAgICAgPT4gJExldmVsCiAgICAgICAgKTsKICAgICAgICBpZiAoICEkUGFyYW17RGVmYXVsdH0gJiYgZGVmaW5lZCgkSGFzaFJlZikgKSB7CgogICAgICAgICAgICAjIHNldCBwZXJsIGhhc2ggaW50byB0aGUgY29ycmVjdCBYTUwgc3RydWN0dXJlIGZvciBhIERhdGVUaW1lIHNldHRpbmcKICAgICAgICAgICAgIyBTZXR0aW5nID0+IFsKICAgICAgICAgICAgIyAgICB1bmRlZiwKICAgICAgICAgICAgIyAgICB7CiAgICAgICAgICAgICMgICAgICAgIFllYXIgPT4gWwogICAgICAgICAgICAjICAgICAgICAgICAgdW5kZWYsCiAgICAgICAgICAgICMgICAgICAgICAgICB7CiAgICAgICAgICAgICMgICAgICAgICAgICAgICAgQ29udGVudCA9PiAnMjAxMicsCiAgICAgICAgICAgICMgICAgICAgICAgICB9LAogICAgICAgICAgICAjICAgICAgICBdLAogICAgICAgICAgICAjICAgICAgICAuLi4KICAgICAgICAgICAgIyAgICB9LAogICAgICAgICAgICAjIF0sCiAgICAgICAgICAgIGZvciBteSAkUGFydCAocXcoWWVhciBNb250aCBEYXkgSG91ciBNaW51dGUpKSB7CiAgICAgICAgICAgICAgICAkQ29uZmlnSXRlbS0+e1NldHRpbmd9LT5bMV0tPntEYXRlVGltZX0tPlsxXS0+eyRQYXJ0fS0+WzFdLT57Q29udGVudH0gPSAkSGFzaFJlZi0+eyRQYXJ0fTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBpZiAoICEkUGFyYW17RGVmYXVsdH0gKSB7CiAgICAgICAgbXkgJUNvbmZpZ0l0ZW1EZWZhdWx0ID0gJFNlbGYtPkNvbmZpZ0l0ZW1HZXQoCiAgICAgICAgICAgIE5hbWUgICAgPT4gJFBhcmFte05hbWV9LAogICAgICAgICAgICBEZWZhdWx0ID0+IDEsCiAgICAgICAgKTsKICAgICAgICBteSAkQyA9ICRTZWxmLT5fWE1MMlBlcmwoIERhdGEgPT4gJENvbmZpZ0l0ZW0gKTsKICAgICAgICBteSAkRCA9ICRTZWxmLT5fWE1MMlBlcmwoIERhdGEgPT4gXCVDb25maWdJdGVtRGVmYXVsdCApOwogICAgICAgIG15ICggJEExLCAkQTIgKTsKICAgICAgICBldmFsICJcJEExID0gJEMiOwogICAgICAgIGV2YWwgIlwkQTIgPSAkRCI7CiAgICAgICAgaWYgKCAkQ29uZmlnSXRlbURlZmF1bHR7VmFsaWR9IG5lICRDb25maWdJdGVtLT57VmFsaWR9ICkgewogICAgICAgICAgICAkQ29uZmlnSXRlbS0+e0RpZmZ9ID0gMTsKICAgICAgICB9CiAgICAgICAgZWxzaWYgKCAhZGVmaW5lZCAkQTEgJiYgIWRlZmluZWQgJEEyICkgewogICAgICAgICAgICAkQ29uZmlnSXRlbS0+e0RpZmZ9ID0gMDsKICAgICAgICB9CiAgICAgICAgZWxzaWYgKAogICAgICAgICAgICAoIGRlZmluZWQgJEExICYmICFkZWZpbmVkICRBMiApCiAgICAgICAgICAgIHx8ICggIWRlZmluZWQgJEExICYmIGRlZmluZWQgJEEyICkKICAgICAgICAgICAgfHwgJFNlbGYtPl9EYXRhRGlmZigKICAgICAgICAgICAgICAgIERhdGExID0+IFwkQTEsCiAgICAgICAgICAgICAgICBEYXRhMiA9PiBcJEEyCiAgICAgICAgICAgICkKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgJENvbmZpZ0l0ZW0tPntEaWZmfSA9IDE7CiAgICAgICAgfQogICAgfQogICAgaWYgKAogICAgICAgICRDb25maWdJdGVtLT57U2V0dGluZ30tPlsxXS0+e09wdGlvbn0KICAgICAgICAmJiAkQ29uZmlnSXRlbS0+e1NldHRpbmd9LT5bMV0tPntPcHRpb259LT5bMV0tPntMb2NhdGlvbn0KICAgICAgICApCiAgICB7CiAgICAgICAgbXkgJEhvbWUgPSAkU2VsZi0+e0hvbWV9OwogICAgICAgIG15IEBMaXN0ID0gJE1haW5PYmplY3QtPkRpcmVjdG9yeVJlYWQoCiAgICAgICAgICAgIERpcmVjdG9yeSA9PiAkSG9tZSwKICAgICAgICAgICAgRmlsdGVyICAgID0+ICIkQ29uZmlnSXRlbS0+e1NldHRpbmd9LT5bMV0tPntPcHRpb259LT5bMV0tPntMb2NhdGlvbn0iLAogICAgICAgICk7CgogICAgICAgICMgS0lYQ29yZS1jYXBlSVQKICAgICAgICBmb3IgbXkgJERpciAoQElOQykgewogICAgICAgICAgICBsYXN0IGlmICggJERpciA9fiBtLyRTZWxmLT57SG9tZX1cL0N1c3RvbS8gKTsKICAgICAgICAgICAgaWYgKCAtZSAiJERpciIgKSB7CiAgICAgICAgICAgICAgICBteSBAS0lYTGlzdCA9ICRNYWluT2JqZWN0LT5EaXJlY3RvcnlSZWFkKAogICAgICAgICAgICAgICAgICAgIERpcmVjdG9yeSA9PiAkRGlyLAogICAgICAgICAgICAgICAgICAgIEZpbHRlciAgICA9PiAiJENvbmZpZ0l0ZW0tPntTZXR0aW5nfS0+WzFdLT57T3B0aW9ufS0+WzFdLT57TG9jYXRpb259IiwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBmb3IgbXkgJEZpbGUgKEBLSVhMaXN0KSB7CiAgICAgICAgICAgICAgICAgICAgJEZpbGUgPX4gcy9cUSREaXJcRS8vZzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHB1c2ggQExpc3QsIEBLSVhMaXN0OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIEVPIEtJWENvcmUtY2FwZUlUCgogICAgICAgIGZvciBteSAkSXRlbSAoQExpc3QpIHsKICAgICAgICAgICAgJEl0ZW0gPX4gcy9cUSRIb21lXEUvL2c7CiAgICAgICAgICAgICRJdGVtID1+IHMvXltBLXpdOi8vZzsKICAgICAgICAgICAgJEl0ZW0gPX4gcy9cXC9cLy9nOwogICAgICAgICAgICAkSXRlbSA9fiBzL1wvXC8vXC8vZzsKICAgICAgICAgICAgJEl0ZW0gPX4gcy9eXC8vL2c7CiAgICAgICAgICAgICRJdGVtID1+IHMvXiguKilcLnBtLyQxL2c7CiAgICAgICAgICAgICRJdGVtID1+IHMvXC8vOjovZzsKICAgICAgICAgICAgJEl0ZW0gPX4gcy9cLy86Oi9nOwogICAgICAgICAgICBteSAkVmFsdWUgPSAkSXRlbTsKICAgICAgICAgICAgbXkgJEtleSAgID0gJEl0ZW07CiAgICAgICAgICAgICRWYWx1ZSA9fiBzL14uKjo6KC4rPykkLyQxL2c7CgogICAgICAgICAgICBpZiAoICEkQ29uZmlnSXRlbS0+e1NldHRpbmd9LT5bMV0tPntPcHRpb259LT5bMV0tPntJdGVtfSApIHsKICAgICAgICAgICAgICAgIHB1c2goIEB7ICRDb25maWdJdGVtLT57U2V0dGluZ30tPlsxXS0+e09wdGlvbn0tPlsxXS0+e0l0ZW19IH0sIHVuZGVmICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgIEB7ICRDb25maWdJdGVtLT57U2V0dGluZ30tPlsxXS0+e09wdGlvbn0tPlsxXS0+e0l0ZW19IH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgS2V5ICAgICA9PiAkS2V5LAogICAgICAgICAgICAgICAgICAgIENvbnRlbnQgPT4gJFZhbHVlLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gJXskQ29uZmlnSXRlbX07Cn0KCj1pdGVtIENvbmZpZ0l0ZW1SZXNldCgpCgpyZXNldCBhIGNvbmZpZ3VyYXRpb24gc2V0dGluZyB0byBpdHMgZGVmYXVsdCB2YWx1ZS4KCiAgICAkU3lzQ29uZmlnT2JqZWN0LT5Db25maWdJdGVtUmVzZXQoCiAgICAgICAgTmFtZSA9PiAnVGlja2V0OjpOdW1iZXJHZW5lcmF0b3InLAogICAgKTsKCj1jdXQKCnN1YiBDb25maWdJdGVtUmVzZXQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgZm9yIChxdyhOYW1lKSkgewogICAgICAgIGlmICggISRQYXJhbXskX30gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICRfISIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KICAgIG15ICVDb25maWdJdGVtRGVmYXVsdCA9ICRTZWxmLT5Db25maWdJdGVtR2V0KAogICAgICAgIE5hbWUgICAgPT4gJFBhcmFte05hbWV9LAogICAgICAgIERlZmF1bHQgPT4gMSwKICAgICk7CiAgICBteSAkQSA9ICRTZWxmLT5fWE1MMlBlcmwoIERhdGEgPT4gXCVDb25maWdJdGVtRGVmYXVsdCApOwogICAgbXkgKCRCKTsKICAgIGV2YWwgIlwkQiA9ICRBIjsKCiAgICAkU2VsZi0+Q29uZmlnSXRlbVVwZGF0ZSgKICAgICAgICBLZXkgICA9PiAkUGFyYW17TmFtZX0sCiAgICAgICAgVmFsdWUgPT4gJEIsCiAgICAgICAgVmFsaWQgPT4gJENvbmZpZ0l0ZW1EZWZhdWx0e1ZhbGlkfQogICAgKTsKICAgIHJldHVybiAxOwp9Cgo9aXRlbSBDb25maWdJdGVtVmFsaWRpdHlVcGRhdGUoKQoKdXBkYXRlcyB0aGUgdmFsaWRpdHkgb2YgYSBjb25maWd1cmF0aW9uIHNldHRpbmcuCgogICAgJFN5c0NvbmZpZ09iamVjdC0+Q29uZmlnSXRlbVZhbGlkaXR5VXBkYXRlKAogICAgICAgIE5hbWUgID0+ICdUaWNrZXQ6Ok51bWJlckdlbmVyYXRvcicsCiAgICAgICAgVmFsaWQgPT4gMSwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgb3IgMAogICAgKTsKCj1jdXQKCnN1YiBDb25maWdJdGVtVmFsaWRpdHlVcGRhdGUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgZm9yIG15ICROZWVkZWQgKHF3KE5hbWUgVmFsaWQpKSB7CiAgICAgICAgaWYgKCAhZGVmaW5lZCAkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQhIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQogICAgbXkgJUNvbmZpZ0l0ZW1EZWZhdWx0ID0gJFNlbGYtPkNvbmZpZ0l0ZW1HZXQoCiAgICAgICAgTmFtZSAgICA9PiAkUGFyYW17TmFtZX0sCiAgICAgICAgRGVmYXVsdCA9PiAxLAogICAgKTsKCiAgICByZXR1cm4gMSBpZiAkUGFyYW17VmFsaWR9ID09ICRDb25maWdJdGVtRGVmYXVsdHtWYWxpZH07CgogICAgbXkgJEEgPSAkU2VsZi0+X1hNTDJQZXJsKCBEYXRhID0+IFwlQ29uZmlnSXRlbURlZmF1bHQgKTsKICAgIG15ICgkQik7CiAgICBldmFsICJcJEIgPSAkQSI7CgogICAgJFNlbGYtPkNvbmZpZ0l0ZW1VcGRhdGUoCiAgICAgICAgS2V5ICAgPT4gJFBhcmFte05hbWV9LAogICAgICAgIFZhbHVlID0+ICRCLAogICAgICAgIFZhbGlkID0+ICRQYXJhbXtWYWxpZH0KICAgICk7CiAgICByZXR1cm4gMTsKfQoKPWl0ZW0gQ29uZmlnR3JvdXBMaXN0KCkKCmdldCB0aGUgbGlzdCBvZiBhbGwgYXZhaWxhYmxlIGNvbmZpZyBncm91cHMuCgogICAgbXkgJUNvbmZpZ0dyb3VwTGlzdCA9ICRTeXNDb25maWdPYmplY3QtPkNvbmZpZ0dyb3VwTGlzdCgpOwoKPWN1dAoKc3ViIENvbmZpZ0dyb3VwTGlzdCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICVMaXN0OwogICAgbXkgJUNvdW50OwogICAgZm9yIG15ICRDb25maWdJdGVtICggQHsgJFNlbGYtPntYTUxDb25maWd9IH0gKSB7CiAgICAgICAgaWYgKCAkQ29uZmlnSXRlbS0+e0dyb3VwfSAmJiByZWYgJENvbmZpZ0l0ZW0tPntHcm91cH0gZXEgJ0FSUkFZJyApIHsKICAgICAgICAgICAgZm9yIG15ICRHcm91cCAoIEB7ICRDb25maWdJdGVtLT57R3JvdXB9IH0gKSB7CiAgICAgICAgICAgICAgICBpZiAoICRHcm91cC0+e0NvbnRlbnR9ICkgewogICAgICAgICAgICAgICAgICAgICRDb3VudHsgJEdyb3VwLT57Q29udGVudH0gfSsrOwogICAgICAgICAgICAgICAgICAgICRMaXN0eyAkR3JvdXAtPntDb250ZW50fSB9ID0gIiRHcm91cC0+e0NvbnRlbnR9ICgkQ291bnR7JEdyb3VwLT57Q29udGVudH19KSI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gJUxpc3Q7Cn0KCj1pdGVtIENvbmZpZ1N1Ykdyb3VwTGlzdCgpCgpnZXQgdGhlIGxpc3Qgb2YgYWxsIGNvbmZpZyBzdWIgZ3JvdXBzIG9mIGEgZ2l2ZW4gZ3JvdXAuCgogICAgbXkgJUNvbmZpZ0dyb3VwTGlzdCA9ICRTeXNDb25maWdPYmplY3QtPkNvbmZpZ1N1Ykdyb3VwTGlzdCgKICAgICAgICBOYW1lID0+ICdGcmFtZXdvcmsnLAogICAgKTsKCj1jdXQKCnN1YiBDb25maWdTdWJHcm91cExpc3QgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgZm9yIChxdyhOYW1lKSkgewogICAgICAgIGlmICggISRQYXJhbXskX30gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICRfISIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KICAgIG15ICVMaXN0OwogICAgZm9yIG15ICRDb25maWdJdGVtICggQHsgJFNlbGYtPntYTUxDb25maWd9IH0gKSB7CiAgICAgICAgaWYgKCAkQ29uZmlnSXRlbS0+e0dyb3VwfSAmJiByZWYgJENvbmZpZ0l0ZW0tPntHcm91cH0gZXEgJ0FSUkFZJyApIHsKICAgICAgICAgICAgbXkgJEhpdCA9IDA7CiAgICAgICAgICAgIGZvciBteSAkR3JvdXAgKCBAeyAkQ29uZmlnSXRlbS0+e0dyb3VwfSB9ICkgewogICAgICAgICAgICAgICAgaWYgKCAkR3JvdXAtPntDb250ZW50fSAmJiAkR3JvdXAtPntDb250ZW50fSBlcSAkUGFyYW17TmFtZX0gKSB7CiAgICAgICAgICAgICAgICAgICAgJEhpdCA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCRIaXQpIHsKICAgICAgICAgICAgICAgIGZvciBteSAkU3ViR3JvdXAgKCBAeyAkQ29uZmlnSXRlbS0+e1N1Ykdyb3VwfSB9ICkgewogICAgICAgICAgICAgICAgICAgIGlmICggJFN1Ykdyb3VwLT57Q29udGVudH0gKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAjIGdldCBzdWIgY291bnQKICAgICAgICAgICAgICAgICAgICAgICAgbXkgQExpc3QgPSAkU2VsZi0+Q29uZmlnU3ViR3JvdXBDb25maWdJdGVtTGlzdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdyb3VwICAgID0+ICRQYXJhbXtOYW1lfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN1Ykdyb3VwID0+ICRTdWJHcm91cC0+e0NvbnRlbnR9LAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAkTGlzdHsgJFN1Ykdyb3VwLT57Q29udGVudH0gfSA9ICggJCNMaXN0ICsgMSApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIHJldHVybiAlTGlzdDsKfQoKPWl0ZW0gQ29uZmlnU3ViR3JvdXBDb25maWdJdGVtTGlzdCgpCgpnZXQgdGhlIGxpc3Qgb2YgY29uZmlnIGl0ZW1zIG9mIGEgY29uZmlnIHN1YiBncm91cAoKICAgIG15IEBDb25maWdJdGVtTGlzdCA9ICRTeXNDb25maWdPYmplY3QtPkNvbmZpZ1N1Ykdyb3VwQ29uZmlnSXRlbUxpc3QoCiAgICAgICAgR3JvdXAgICAgPT4gJ0ZyYW1ld29yaycsCiAgICAgICAgU3ViR3JvdXAgPT4gJ1dlYicsCiAgICApOwoKPWN1dAoKc3ViIENvbmZpZ1N1Ykdyb3VwQ29uZmlnSXRlbUxpc3QgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgZm9yIChxdyhHcm91cCBTdWJHcm91cCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JF99ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkXyEiCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CiAgICBteSAlRGF0YTsKICAgIGlmICggJFNlbGYtPnsnQ2FjaGU6OkNvbmZpZ1N1Ykdyb3VwQ29uZmlnSXRlbUxpc3QnfSApIHsKICAgICAgICAlRGF0YSA9ICV7ICRTZWxmLT57J0NhY2hlOjpDb25maWdTdWJHcm91cENvbmZpZ0l0ZW1MaXN0J30gfTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIG15ICVVc2VkOwogICAgICAgIGZvciBteSAkQ29uZmlnSXRlbSAoIEB7ICRTZWxmLT57WE1MQ29uZmlnfSB9ICkgewogICAgICAgICAgICBteSAkTmFtZSA9ICRDb25maWdJdGVtLT57TmFtZX07CiAgICAgICAgICAgIGlmICggJENvbmZpZ0l0ZW0tPntHcm91cH0gJiYgcmVmICRDb25maWdJdGVtLT57R3JvdXB9IGVxICdBUlJBWScgKSB7CiAgICAgICAgICAgICAgICBmb3IgbXkgJEdyb3VwICggQHsgJENvbmZpZ0l0ZW0tPntHcm91cH0gfSApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgICRHcm91cAogICAgICAgICAgICAgICAgICAgICAgICAmJiAkQ29uZmlnSXRlbS0+e1N1Ykdyb3VwfQogICAgICAgICAgICAgICAgICAgICAgICAmJiByZWYgJENvbmZpZ0l0ZW0tPntTdWJHcm91cH0gZXEgJ0FSUkFZJwogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgbXkgJFN1Ykdyb3VwICggQHsgJENvbmZpZ0l0ZW0tPntTdWJHcm91cH0gfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhJFVzZWR7ICRDb25maWdJdGVtLT57TmFtZX0gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmICRTdWJHcm91cC0+e0NvbnRlbnR9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgJEdyb3VwLT57Q29udGVudH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFVzZWR7ICRDb25maWdJdGVtLT57TmFtZX0gfSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICREYXRheyAkR3JvdXAtPntDb250ZW50fSAuICc6OicgLiAkU3ViR3JvdXAtPntDb250ZW50fSB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRDb25maWdJdGVtLT57TmFtZX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICRTZWxmLT57J0NhY2hlOjpDb25maWdTdWJHcm91cENvbmZpZ0l0ZW1MaXN0J30gPSBcJURhdGE7CiAgICB9CiAgICBpZiAoICREYXRheyAkUGFyYW17R3JvdXB9IC4gJzo6JyAuICRQYXJhbXtTdWJHcm91cH0gfSApIHsKICAgICAgICByZXR1cm4gcmV2ZXJzZSBAeyAkRGF0YXsgJFBhcmFte0dyb3VwfSAuICc6OicgLiAkUGFyYW17U3ViR3JvdXB9IH0gfTsKICAgIH0KICAgIHJldHVybiAoKTsKfQoKPWl0ZW0gQ29uZmlnSXRlbVNlYXJjaCgpCgpzZWFyY2ggZm9yIHN1YiBncm91cHMgb2YgY29uZmlnIGl0ZW1zLiBJdCB3aWxsIHJldHVybiBhbGwgc3ViZ3JvdXBzCndpdGggc2V0dGluZ3Mgd2hpY2ggY29udGFpbiB0aGUgc2VhcmNoIHRlcm0uCgogICAgbXkgQExpc3QgPSAkU3lzQ29uZmlnT2JqZWN0LT5Db25maWdJdGVtU2VhcmNoKAogICAgICAgIFNlYXJjaCA9PiAnc29tZSB0b3BpYycsCiAgICApOwoKPWN1dAoKc3ViIENvbmZpZ0l0ZW1TZWFyY2ggewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSBATGlzdDsKICAgIG15ICVVc2VkOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgKHF3KFNlYXJjaCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JF99ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkXyEiCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgIyBnZXQgbGFuZ3VhZ2Ugb2JqZWN0CiAgICBteSAkTGFuZ3VhZ2VPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Okxhbmd1YWdlJyk7CgogICAgJFBhcmFte1NlYXJjaH0gPX4gcy9cKi8vOwogICAgbXkgJUdyb3VwcyA9ICRTZWxmLT5Db25maWdHcm91cExpc3QoKTsKICAgIGZvciBteSAkR3JvdXAgKCBzb3J0IGtleXMoJUdyb3VwcykgKSB7CiAgICAgICAgbXkgJVN1Ykdyb3VwcyA9ICRTZWxmLT5Db25maWdTdWJHcm91cExpc3QoIE5hbWUgPT4gJEdyb3VwICk7CiAgICAgICAgZm9yIG15ICRTdWJHcm91cCAoIHNvcnQga2V5cyAlU3ViR3JvdXBzICkgewogICAgICAgICAgICBteSBASXRlbXMgPSAkU2VsZi0+Q29uZmlnU3ViR3JvdXBDb25maWdJdGVtTGlzdCgKICAgICAgICAgICAgICAgIEdyb3VwICAgID0+ICRHcm91cCwKICAgICAgICAgICAgICAgIFN1Ykdyb3VwID0+ICRTdWJHcm91cCwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgZm9yIG15ICRJdGVtIChASXRlbXMpIHsKICAgICAgICAgICAgICAgIG15ICRDb25maWcgPSAkU2VsZi0+X01vZEdldCggQ29uZmlnTmFtZSA9PiAkSXRlbSApOwogICAgICAgICAgICAgICAgaWYgKCAkQ29uZmlnICYmICEkVXNlZHsgJEdyb3VwIC4gJzo6JyAuICRTdWJHcm91cCB9ICkgewogICAgICAgICAgICAgICAgICAgIGlmICggcmVmICRDb25maWcgZXEgJ0FSUkFZJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICggQHskQ29uZmlnfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggISRVc2VkeyAkR3JvdXAgLiAnOjonIC4gJFN1Ykdyb3VwIH0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkXyAmJiAkXyA9fiAvXFEkUGFyYW17U2VhcmNofVxFL2kgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2goCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBATGlzdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdWJHcm91cCAgICAgID0+ICRTdWJHcm91cCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdWJHcm91cENvdW50ID0+ICRTdWJHcm91cHN7JFN1Ykdyb3VwfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHcm91cCAgICAgICAgID0+ICRHcm91cCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRVc2VkeyAkR3JvdXAgLiAnOjonIC4gJFN1Ykdyb3VwIH0gPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNpZiAoIHJlZiAkQ29uZmlnIGVxICdIQVNIJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJXskQ29uZmlnfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggISRVc2VkeyAkR3JvdXAgLiAnOjonIC4gJFN1Ykdyb3VwIH0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkQ29uZmlnLT57JEtleX0gJiYgJENvbmZpZy0+eyRLZXl9ID1+IC9cUSRQYXJhbXtTZWFyY2h9XEUvaSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEBMaXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN1Ykdyb3VwICAgICAgPT4gJFN1Ykdyb3VwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN1Ykdyb3VwQ291bnQgPT4gJFN1Ykdyb3Vwc3skU3ViR3JvdXB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdyb3VwICAgICAgICAgPT4gJEdyb3VwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFVzZWR7ICRHcm91cCAuICc6OicgLiAkU3ViR3JvdXAgfSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRDb25maWcgPX4gL1xRJFBhcmFte1NlYXJjaH1cRS9pICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBATGlzdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN1Ykdyb3VwICAgICAgPT4gJFN1Ykdyb3VwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdWJHcm91cENvdW50ID0+ICRTdWJHcm91cHN7JFN1Ykdyb3VwfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR3JvdXAgICAgICAgICA9PiAkR3JvdXAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVXNlZHsgJEdyb3VwIC4gJzo6JyAuICRTdWJHcm91cCB9ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICggJEl0ZW0gPX4gL1xRJFBhcmFte1NlYXJjaH1cRS9pICkgewogICAgICAgICAgICAgICAgICAgIGlmICggISRVc2VkeyAkR3JvdXAgLiAnOjonIC4gJFN1Ykdyb3VwIH0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHB1c2goCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBATGlzdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdWJHcm91cCAgICAgID0+ICRTdWJHcm91cCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdWJHcm91cENvdW50ID0+ICRTdWJHcm91cHN7JFN1Ykdyb3VwfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHcm91cCAgICAgICAgID0+ICRHcm91cCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICRVc2VkeyAkR3JvdXAgLiAnOjonIC4gJFN1Ykdyb3VwIH0gPSAxOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIG15ICVJdGVtSGFzaCA9ICRTZWxmLT5Db25maWdJdGVtR2V0KCBOYW1lID0+ICRJdGVtICk7CiAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRJbmRleCAoIDEgLi4gJCN7ICRJdGVtSGFzaHtEZXNjcmlwdGlvbn0gfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhJFVzZWR7ICRHcm91cCAuICc6OicgLiAkU3ViR3JvdXAgfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15ICREZXNjcmlwdGlvbiA9ICRJdGVtSGFzaHtEZXNjcmlwdGlvbn1bJEluZGV4XXtDb250ZW50fTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGNvbXBhcmUgd2l0aCB0aGUgRW5nbGlzaCBkZXNjcmlwdGlvbiBhbmQgYWxzbyB3aXRoIHRoZSB0cmFuc2xhdGVkIHNlbnRlbmNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCAkRGVzY3JpcHRpb24gPX4gL1xRJFBhcmFte1NlYXJjaH1cRS9pICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMYW5ndWFnZU9iamVjdC0+VHJhbnNsYXRlKCREZXNjcmlwdGlvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPX4gL1xRJFBhcmFte1NlYXJjaH1cRS9pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBATGlzdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3ViR3JvdXAgICAgICA9PiAkU3ViR3JvdXAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdWJHcm91cENvdW50ID0+ICRTdWJHcm91cHN7JFN1Ykdyb3VwfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdyb3VwICAgICAgICAgPT4gJEdyb3VwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFVzZWR7ICRHcm91cCAuICc6OicgLiAkU3ViR3JvdXAgfSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIEBMaXN0Owp9Cgo9aXRlbSBDb25maWdJdGVtVHJhbnNsYXRhYmxlU3RyaW5ncygpCgpyZXR1cm5zIGEgdW5pcXVlIGxpc3Qgb2YgYWxsIHRyYW5zbGF0YWJsZSBzdHJpbmdzIGluIHRoZQpYTUwgY29uZmlndXJhdGlvbi4KCj1jdXQKCnN1YiBDb25maWdJdGVtVHJhbnNsYXRhYmxlU3RyaW5ncyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZW1wdHkgdHJhbnNsYXRpb24gbGlzdAogICAgJFNlbGYtPntDb25maWdJdGVtVHJhbnNsYXRhYmxlU3RyaW5nc30gPSB7fTsKCiAgICAjIGdldCBhbGwgZ3JvdXBzCiAgICBteSAlQ29uZmlnR3JvdXBMaXN0ID0gJFNlbGYtPkNvbmZpZ0dyb3VwTGlzdCgpOwogICAgZm9yIG15ICRHcm91cCAoIHNvcnQga2V5cyAlQ29uZmlnR3JvdXBMaXN0ICkgewoKICAgICAgICAjIGdldCBhbGwgc3ViIGdyb3VwcwogICAgICAgIG15ICVDb25maWdTdWJHcm91cExpc3QgPSAkU2VsZi0+Q29uZmlnU3ViR3JvdXBMaXN0KAogICAgICAgICAgICBOYW1lID0+ICRHcm91cCwKICAgICAgICApOwogICAgICAgIGZvciBteSAkU3ViR3JvdXAgKCBzb3J0IGtleXMgJUNvbmZpZ1N1Ykdyb3VwTGlzdCApIHsKCiAgICAgICAgICAgICMgZ2V0IGl0ZW1zCiAgICAgICAgICAgIG15IEBDb25maWdJdGVtTGlzdCA9ICRTZWxmLT5Db25maWdTdWJHcm91cENvbmZpZ0l0ZW1MaXN0KAogICAgICAgICAgICAgICAgR3JvdXAgICAgPT4gJEdyb3VwLAogICAgICAgICAgICAgICAgU3ViR3JvdXAgPT4gJFN1Ykdyb3VwLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgQ09ORklHSVRFTToKICAgICAgICAgICAgZm9yIG15ICRDb25maWdJdGVtIChAQ29uZmlnSXRlbUxpc3QpIHsKCiAgICAgICAgICAgICAgICAjIGdldCBhdHRyaWJ1dGVzIG9mIGVhY2ggY29uZmlnIGl0ZW0KICAgICAgICAgICAgICAgIG15ICVDb25maWcgPSAkU2VsZi0+Q29uZmlnSXRlbUdldCgKICAgICAgICAgICAgICAgICAgICBOYW1lICAgID0+ICRDb25maWdJdGVtLAogICAgICAgICAgICAgICAgICAgIERlZmF1bHQgPT4gMSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBuZXh0IENPTkZJR0lURU0gaWYgISVDb25maWc7CgogICAgICAgICAgICAgICAgIyBnZXQgdHJhbnNsYXRhYmxlIHN0cmluZ3MKICAgICAgICAgICAgICAgICRTZWxmLT5fQ29uZmlnSXRlbVRyYW5zbGF0YWJsZVN0cmluZ3MoIERhdGEgPT4gXCVDb25maWcgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBteSBAU3RyaW5nczsKICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICV7ICRTZWxmLT57Q29uZmlnSXRlbVRyYW5zbGF0YWJsZVN0cmluZ3N9IH0gKSB7CiAgICAgICAgcHVzaCBAU3RyaW5ncywgJEtleTsKICAgIH0KICAgIHJldHVybiBAU3RyaW5nczsKfQoKPWl0ZW0gQ29uZmlnSXRlbVZhbGlkYXRlKCkKClZhbGlkYXRlcyBpZiB0aGUgZ2l2ZW4gdmFsdWUgZm9yIHRoaXMgY29uZmlnIGl0ZW0gaXMgY29ycmVjdC4KSWYgbm8gdmFsdWUgaXMgZ2l2ZW4sIHRoZSBjdXJyZW50IHZhbHVlIG9mIHRoZSBjb25maWcgaXRlbSB3aWxsIGJlIHZhbGlkYXRlZC4KUmV0dXJucyB0cnVlIGlmIGl0IGlzIHZhbGlkLCBmYWxzZSBvdGhlcndpc2UuCgogICAgbXkgJFJlc3VsdCA9ICRTeXNDb25maWdPYmplY3QtPkNvbmZpZ0l0ZW1WYWxpZGF0ZSgKICAgICAgICBLZXkgICAgICAgICA9PiAnVGlja2V0OjpGcm9udGVuZDo6QWdlbnRUaWNrZXRPd25lciMjI1ByaW9yaXR5RGVmYXVsdCcsCiAgICAgICAgVmFsdWUgICAgICAgPT4gJzMgbm9ybWFsJywgICMgKG9wdGlvbmFsKQogICAgICAgIFZhbGlkICAgICAgID0+IDEsICAgICAgICAgICAjIChvcHRpb25hbCkgb25seSB1c2VkIGlmIEF1dG9Db3JyZWN0IGlzIHNldAogICAgICAgIEF1dG9Db3JyZWN0ID0+IDEsICAgICAgICAgICAjIChvcHRpb25hbCkgYXV0by1jb3JyZWN0IHRoZSBjb25maWcgaXRlbQogICAgKTsKCj1jdXQKCnN1YiBDb25maWdJdGVtVmFsaWRhdGUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgaWYgKCAhJFBhcmFte0tleX0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkIEtleSEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgZ2V0IHRoZSBjdXJyZW50IGNvbmZpZyBpdGVtCiAgICBteSAlQ29uZmlnSXRlbSA9ICRTZWxmLT5Db25maWdJdGVtR2V0KAogICAgICAgIE5hbWUgPT4gJFBhcmFte0tleX0sCiAgICApOwoKICAgICMgY2hlY2sgaWYgYSB2YWxpZGF0ZSBtb2R1bGUgaXMgZGVmaW5lZCBmb3IgdGhpcyBjb25maWcgb3B0aW9uCiAgICByZXR1cm4gMSBpZiAhJENvbmZpZ0l0ZW17VmFsaWRhdGVNb2R1bGV9OwogICAgcmV0dXJuIDEgaWYgcmVmICRDb25maWdJdGVte1ZhbGlkYXRlTW9kdWxlfSBuZSAnQVJSQVknOwogICAgcmV0dXJuIDEgaWYgISRDb25maWdJdGVte1ZhbGlkYXRlTW9kdWxlfS0+WzFdLT57Q29udGVudH07CgogICAgIyBsb2FkIHRoZSB2YWxpZGF0ZSBtb2R1bGUKICAgIG15ICRWYWxpZGF0ZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoICRDb25maWdJdGVte1ZhbGlkYXRlTW9kdWxlfS0+WzFdLT57Q29udGVudH0gKTsKCiAgICAjIG1vZHVsZSBjb3VsZCBub3QgYmUgbG9hZGVkCiAgICByZXR1cm4gaWYgISRWYWxpZGF0ZU9iamVjdDsKCiAgICAjIHRha2UgdGhlIGdpdmVuIHZhbHVlCiAgICBteSAkVmFsdWUgPSAkUGFyYW17VmFsdWV9OwoKICAgICMgaWYgbm8gdmFsdWUgaXMgZ2l2ZW4sIHRha2UgdGhlIGFscmVhZHkgc3RvcmVkIHZhbHVlCiAgICBpZiAoICFkZWZpbmVkICRQYXJhbXtWYWx1ZX0gKSB7CgogICAgICAgICMgc3RyaW5nCiAgICAgICAgaWYgKCAkQ29uZmlnSXRlbXtTZXR0aW5nfS0+WzFdLT57U3RyaW5nfS0+WzFdLT57Q29udGVudH0gKSB7CiAgICAgICAgICAgICRWYWx1ZSA9ICRDb25maWdJdGVte1NldHRpbmd9LT5bMV0tPntTdHJpbmd9LT5bMV0tPntDb250ZW50fTsKICAgICAgICB9CgogICAgICAgICMgdGV4dGFyZWEKICAgICAgICBlbHNpZiAoICRDb25maWdJdGVte1NldHRpbmd9LT5bMV0tPntUZXh0QXJlYX0tPlsxXS0+e0NvbnRlbnR9ICkgewogICAgICAgICAgICAkVmFsdWUgPSAkQ29uZmlnSXRlbXtTZXR0aW5nfS0+WzFdLT57VGV4dEFyZWF9LT5bMV0tPntDb250ZW50fTsKICAgICAgICB9CgogICAgICAgICMgb3B0aW9uCiAgICAgICAgIyAobW9yZSBjb21wbGV4LCBzbyBnaXZlIHRoZSBjb21wbGV0ZSBkYXRhIHN0cnVjdHVyZSkKICAgICAgICBlbHNpZiAoICRDb25maWdJdGVte1NldHRpbmd9LT5bMV0tPntPcHRpb259LT5bMV0gKSB7CiAgICAgICAgICAgICRWYWx1ZSA9ICRDb25maWdJdGVte1NldHRpbmd9LT5bMV0tPntPcHRpb259LT5bMV07CiAgICAgICAgfQoKICAgICAgICAjIGhhc2gKICAgICAgICBlbHNpZiAoICRDb25maWdJdGVte1NldHRpbmd9LT5bMV0tPntIYXNofS0+WzFdLT57SXRlbX0gKSB7CiAgICAgICAgICAgICRWYWx1ZSA9ICRDb25maWdJdGVte1NldHRpbmd9LT5bMV0tPntIYXNofS0+WzFdLT57SXRlbX07CiAgICAgICAgfQoKICAgICAgICAjIGFycmF5CiAgICAgICAgZWxzaWYgKCAkQ29uZmlnSXRlbXtTZXR0aW5nfS0+WzFdLT57QXJyYXl9LT5bMV0tPntJdGVtfSApIHsKICAgICAgICAgICAgJFZhbHVlID0gJENvbmZpZ0l0ZW17U2V0dGluZ30tPlsxXS0+e0FycmF5fS0+WzFdLT57SXRlbX07CiAgICAgICAgfQoKICAgICAgICAjIEZyb250ZW5kTW9kdWxlUmVnCiAgICAgICAgIyAobW9yZSBjb21wbGV4LCBzbyBnaXZlIHRoZSBjb21wbGV0ZSBkYXRhIHN0cnVjdHVyZSkKICAgICAgICBlbHNpZiAoICRDb25maWdJdGVte1NldHRpbmd9LT5bMV0tPntGcm9udGVuZE1vZHVsZVJlZ30tPlsxXSApIHsKICAgICAgICAgICAgJFZhbHVlID0gJENvbmZpZ0l0ZW17U2V0dGluZ30tPlsxXS0+e0Zyb250ZW5kTW9kdWxlUmVnfS0+WzFdOwogICAgICAgIH0KCiAgICAgICAgIyBUaW1lV29ya2luZ0hvdXJzCiAgICAgICAgZWxzaWYgKCAkQ29uZmlnSXRlbXtTZXR0aW5nfS0+WzFdLT57VGltZVdvcmtpbmdIb3Vyc30tPlsxXS0+e0RheX0gKSB7CiAgICAgICAgICAgICRWYWx1ZSA9ICRDb25maWdJdGVte1NldHRpbmd9LT5bMV0tPntUaW1lV29ya2luZ0hvdXJzfS0+WzFdLT57RGF5fTsKICAgICAgICB9CgogICAgICAgICMgVGltZVZhY2F0aW9uRGF5cwogICAgICAgIGVsc2lmICggJENvbmZpZ0l0ZW17U2V0dGluZ30tPlsxXS0+e1RpbWVWYWNhdGlvbkRheXN9LT5bMV0tPntJdGVtfSApIHsKICAgICAgICAgICAgJFZhbHVlID0gJENvbmZpZ0l0ZW17U2V0dGluZ30tPlsxXS0+e1RpbWVWYWNhdGlvbkRheXN9LT5bMV0tPntJdGVtfTsKICAgICAgICB9CgogICAgICAgICMgVGltZVZhY2F0aW9uRGF5c09uZVRpbWUKICAgICAgICBlbHNpZiAoICRDb25maWdJdGVte1NldHRpbmd9LT5bMV0tPntUaW1lVmFjYXRpb25EYXlzT25lVGltZX0tPlsxXS0+e0l0ZW19ICkgewogICAgICAgICAgICAkVmFsdWUgPSAkQ29uZmlnSXRlbXtTZXR0aW5nfS0+WzFdLT57VGltZVZhY2F0aW9uRGF5c09uZVRpbWV9LT5bMV0tPntJdGVtfTsKICAgICAgICB9CgogICAgICAgICMgRGF0ZVRpbWUKICAgICAgICBlbHNpZiAoICRDb25maWdJdGVte1NldHRpbmd9LT5bMV0tPntEYXRlVGltZX0tPlsxXSApIHsKICAgICAgICAgICAgJFZhbHVlID0gJENvbmZpZ0l0ZW17U2V0dGluZ30tPlsxXS0+e0RhdGVUaW1lfS0+WzFdOwogICAgICAgIH0KCiAgICAgICAgIyB1bmtub3duIGNvbmZpZyBpdGVtIGNhbiBub3QgYmUgdmFsaWRhdGVkLCBzbyByZXR1cm4gdHJ1ZQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9CiAgICB9CgogICAgIyBpZiBhdXRvLWNvcnJlY3Rpb24gaXMgcmVxdWVzdGVkCiAgICBpZiAoICRQYXJhbXtBdXRvQ29ycmVjdH0gKSB7CgogICAgICAgICMgZ2V0IHRoZSBhdXRvLWNvcnJlY3QgdmFsdWUKICAgICAgICAkVmFsdWUgPSAkVmFsaWRhdGVPYmplY3QtPkdldEF1dG9Db3JyZWN0VmFsdWUoCiAgICAgICAgICAgIERhdGEgPT4gJFZhbHVlLAogICAgICAgICk7CgogICAgICAgICMgaWYgdGhlIHZhbGlkIHBhcmFtIGlzIGdpdmVuLCB1c2UgaXQsIG90aGVyd2lzZSB0YWtlIHZhbGlkIHNldHRpbmcgZnJvbSBjb25maWcgaXRlbQogICAgICAgIG15ICRWYWxpZCA9IGRlZmluZWQgJFBhcmFte1ZhbGlkfSA/ICRQYXJhbXtWYWxpZH0gOiAkQ29uZmlnSXRlbXtWYWxpZH07CgogICAgICAgICMgc2tpcCB2YWxpZGF0aW9uIG9mIGludmFsaWQgaXRlbXMKICAgICAgICByZXR1cm4gMSBpZiAhJFZhbGlkOwoKICAgICAgICAjIHVwZGF0ZSB0aGUgY29uZmlnIGl0ZW0gd2l0aCB0aGUgbmV3IHZhbHVlCiAgICAgICAgbXkgJFVwZGF0ZVN1Y2Nlc3MgPSAkU2VsZi0+Q29uZmlnSXRlbVVwZGF0ZSgKICAgICAgICAgICAgVmFsaWQgICAgICAgID0+ICRWYWxpZCwKICAgICAgICAgICAgS2V5ICAgICAgICAgID0+ICRQYXJhbXtLZXl9LAogICAgICAgICAgICBWYWx1ZSAgICAgICAgPT4gJFZhbHVlLAogICAgICAgICAgICBOb1ZhbGlkYXRpb24gPT4gMSwKICAgICAgICApOwoKICAgICAgICAjIHJldHVybiB0aGUgdXBkYXRlIHJlc3VsdAogICAgICAgIHJldHVybiAkVXBkYXRlU3VjY2VzczsKICAgIH0KCiAgICAjIG9ubHkgdmFsaWRhdGlvbiBpcyBuZWVkZWQKICAgIGVsc2UgewoKICAgICAgICAjIHZhbGlkYXRlIHRoZSB2YWx1ZQogICAgICAgIG15ICRWYWxpZGF0ZU9rID0gJFZhbGlkYXRlT2JqZWN0LT5WYWxpZGF0ZSgKICAgICAgICAgICAgRGF0YSA9PiAkVmFsdWUsCiAgICAgICAgKTsKCiAgICAgICAgIyByZXR1cm4gdGhlIHZhbGlkYXRpb24gcmVzdWx0CiAgICAgICAgcmV0dXJuICRWYWxpZGF0ZU9rOwogICAgfQp9Cgo9aXRlbSBDb25maWdJdGVtQ2hlY2tBbGwoKQoKVmFsaWRhdGVzIGFsbCBjb25maWcgaXRlbXMgd2hpY2ggaGF2ZSBhIHZhbGlkYXRpb24gbW9kdWxlLgpBdXRvbWF0aWNhbGx5IGNvcnJlY3RzIHdyb25nIHZhbHVlcy4KCiAgICBteSAkUmVzdWx0ID0gJFN5c0NvbmZpZ09iamVjdC0+Q29uZmlnSXRlbUNoZWNrQWxsKCk7Cgo9Y3V0CgpzdWIgQ29uZmlnSXRlbUNoZWNrQWxsIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgYWxsIGNvbmZpZyBncm91cHMKICAgIG15ICVHcm91cHMgPSAkU2VsZi0+Q29uZmlnR3JvdXBMaXN0KCk7CgogICAgZm9yIG15ICRHcm91cCAoIHNvcnQga2V5cyglR3JvdXBzKSApIHsKCiAgICAgICAgIyBnZXQgYWxsIHN1Ymdyb3VwcyBmb3IgdGhpcyBncm91cAogICAgICAgIG15ICVTdWJHcm91cHMgPSAkU2VsZi0+Q29uZmlnU3ViR3JvdXBMaXN0KCBOYW1lID0+ICRHcm91cCApOwoKICAgICAgICBmb3IgbXkgJFN1Ykdyb3VwICggc29ydCBrZXlzICVTdWJHcm91cHMgKSB7CgogICAgICAgICAgICAjIGdldCBhbGwgaXRlbXMgZm9yIHRoaXMgc3ViZ3JvdXAKICAgICAgICAgICAgbXkgQEl0ZW1zID0gJFNlbGYtPkNvbmZpZ1N1Ykdyb3VwQ29uZmlnSXRlbUxpc3QoCiAgICAgICAgICAgICAgICBHcm91cCAgICA9PiAkR3JvdXAsCiAgICAgICAgICAgICAgICBTdWJHcm91cCA9PiAkU3ViR3JvdXAsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAjIGNoZWNrIGVhY2ggaXRlbQogICAgICAgICAgICBJVEVNOgogICAgICAgICAgICBmb3IgbXkgJEl0ZW0gKEBJdGVtcykgewoKICAgICAgICAgICAgICAgICMgdmFsaWRhdGUgdGhlIHZhbHVlIG9mIHRoaXMgaXRlbQogICAgICAgICAgICAgICAgbXkgJFZhbGlkYXRlT2sgPSAkU2VsZi0+Q29uZmlnSXRlbVZhbGlkYXRlKAogICAgICAgICAgICAgICAgICAgIEtleSA9PiAkSXRlbSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgIyB2YWxpZGF0aW9uIGlzIG9rCiAgICAgICAgICAgICAgICBuZXh0IElURU0gaWYgJFZhbGlkYXRlT2s7CgogICAgICAgICAgICAgICAgIyB2YWxpZGF0aW9uIGlzIG5vdCBvaywgYXV0by1jb3JyZWN0IHRoZSB2YWx1ZQogICAgICAgICAgICAgICAgbXkgJEF1dG9Db3JyZWN0T2sgPSAkU2VsZi0+Q29uZmlnSXRlbVZhbGlkYXRlKAogICAgICAgICAgICAgICAgICAgIEtleSAgICAgICAgID0+ICRJdGVtLAogICAgICAgICAgICAgICAgICAgIEF1dG9Db3JyZWN0ID0+IDEsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAxOwp9Cgo9YmVnaW4gSW50ZXJuYWw6Cgo9Y3V0CgpzdWIgX0luaXQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkRGlyZWN0b3J5ID0gIiRTZWxmLT57SG9tZX0vS2VybmVsL0NvbmZpZy9GaWxlcy8iOwoKICAgIHJldHVybiBpZiAhLWUgJERpcmVjdG9yeTsKCiAgICAjIGdldCBtYWluIG9iamVjdAogICAgbXkgJE1haW5PYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpOwoKICAgICMgbG9hZCB4bWwgY29uZmlnIGZpbGVzCiAgICBteSBARmlsZXMgPSAkTWFpbk9iamVjdC0+RGlyZWN0b3J5UmVhZCgKICAgICAgICBEaXJlY3RvcnkgPT4gJERpcmVjdG9yeSwKICAgICAgICBGaWx0ZXIgICAgPT4gIioueG1sIiwKICAgICk7CgogICAgIyBLSVhDb3JlLWNhcGVJVAogICAgZm9yIG15ICREaXIgKEBJTkMpIHsKICAgICAgICBsYXN0IGlmICggJERpciA9fiBtLyRTZWxmLT57SG9tZX1cLyguKj8pXC9DdXN0b20vICk7CiAgICAgICAgbXkgJENvbmZEaXIgPSAiJERpci9LZXJuZWwvQ29uZmlnL0ZpbGVzIjsKICAgICAgICAkQ29uZkRpciA9fiBzJ1xzJ1xccydnOwogICAgICAgIGlmICggLWUgIiRDb25mRGlyIiApIHsKICAgICAgICAgICAgbXkgQEtJWEZpbGVzID0gJE1haW5PYmplY3QtPkRpcmVjdG9yeVJlYWQoCiAgICAgICAgICAgICAgICBEaXJlY3RvcnkgPT4gJENvbmZEaXIsCiAgICAgICAgICAgICAgICBGaWx0ZXIgICAgPT4gIioueG1sIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcHVzaCBARmlsZXMsIEBLSVhGaWxlczsKICAgICAgICB9CiAgICB9CgogICAgIyBFTyBLSVhDb3JlLWNhcGVJVAoKICAgICMgZ2V0IHRoZSBtZDUgcmVwcmVzZW50aW5nIHRoZSBjdXJyZW50IGNvbmZpZ3VyYXRpb24gc3RhdGUKICAgIG15ICRDb25maWdDaGVja3N1bSA9ICRTZWxmLT57Q29uZmlnT2JqZWN0fS0+Q29uZmlnQ2hlY2tzdW0oKTsKCiAgICAjIGdldCBjYWNoZSBvYmplY3QKICAgIG15ICRDYWNoZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpOwoKICAgIG15ICVEYXRhOwogICAgRklMRToKICAgIGZvciBteSAkRmlsZSAoQEZpbGVzKSB7CgogICAgICAgIG15ICRDYWNoZUtleSAgPSAiX0luaXQ6OiR7RmlsZX06OiR7Q29uZmlnQ2hlY2tzdW19IjsKICAgICAgICBteSAkQ2FjaGVEYXRhID0gJENhY2hlT2JqZWN0LT5HZXQoCiAgICAgICAgICAgIFR5cGUgPT4gJ1N5c0NvbmZpZycsCiAgICAgICAgICAgIEtleSAgPT4gJENhY2hlS2V5LAogICAgICAgICk7CgogICAgICAgIGlmICggcmVmICRDYWNoZURhdGEgZXEgJ1NDQUxBUicgKSB7CiAgICAgICAgICAgIG15ICRYTUxIYXNoUmVmOwogICAgICAgICAgICBpZiAoIGV2YWwgJHskQ2FjaGVEYXRhfSApIHsKICAgICAgICAgICAgICAgICREYXRheyRGaWxlfSA9ICRYTUxIYXNoUmVmOwogICAgICAgICAgICAgICAgbmV4dCBGSUxFOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBteSAkQ29uZmlnRmlsZSA9ICRNYWluT2JqZWN0LT5GaWxlUmVhZCgKICAgICAgICAgICAgTG9jYXRpb24gPT4gJEZpbGUsCiAgICAgICAgICAgIE1vZGUgICAgID0+ICdiaW5tb2RlJywKICAgICAgICAgICAgUmVzdWx0ICAgPT4gJ1NDQUxBUicsCiAgICAgICAgKTsKCiAgICAgICAgaWYgKCAhcmVmICRDb25maWdGaWxlIHx8ICEkeyRDb25maWdGaWxlfSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkNhbid0IG9wZW4gZmlsZSAkRmlsZTogJCEiLAogICAgICAgICAgICApOwogICAgICAgICAgICBuZXh0IEZJTEU7CiAgICAgICAgfQoKICAgICAgICAjIE9rLCBjYWNoZSB3YXMgbm90IHVzZWQsIHBhcnNlIHRoZSBjb25maWcgZmlsZXMKICAgICAgICBteSBAWE1MSGFzaCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpYTUwnKS0+WE1MUGFyc2UyWE1MSGFzaCgKICAgICAgICAgICAgU3RyaW5nICAgICA9PiAkQ29uZmlnRmlsZSwKICAgICAgICAgICAgU291cmNlbmFtZSA9PiAkRmlsZSwKICAgICAgICApOwoKICAgICAgICAkRGF0YXskRmlsZX0gPSBcQFhNTEhhc2g7CgogICAgICAgIG15ICREdW1wID0gJE1haW5PYmplY3QtPkR1bXAoIFxAWE1MSGFzaCApOwogICAgICAgICREdW1wID1+IHMvXCRWQVIxL1wkWE1MSGFzaFJlZi87CgogICAgICAgIG15ICRPdXQ7CiAgICAgICAgaWYgKCAkU2VsZi0+e3V0Zjh9ICkgewogICAgICAgICAgICAkT3V0IC49ICJ1c2UgdXRmODtcbiI7CiAgICAgICAgfQogICAgICAgICRPdXQgLj0gInVzZSB3YXJuaW5ncztcbiI7CiAgICAgICAgJE91dCAuPSAkRHVtcCAuICJcbjE7IjsKCiAgICAgICAgJENhY2hlT2JqZWN0LT5TZXQoCiAgICAgICAgICAgIFR5cGUgID0+ICdTeXNDb25maWcnLAogICAgICAgICAgICBLZXkgICA9PiAkQ2FjaGVLZXksCiAgICAgICAgICAgIFZhbHVlID0+IFwkT3V0LAogICAgICAgICAgICBUVEwgICA9PiAzMCAqIDI0ICogNjAgKiA2MCwKICAgICAgICApOwogICAgfQoKICAgICMgVGhpcyBpcyB0aGUgc29ydGVkIGNvbmZpZ3VyYXRpb24gWE1MIGVudHJ5IGxpc3QgdGhhdCB3ZSBtdXN0CiAgICAjICAgcG9wdWxhdGUgaGVyZS4KICAgICRTZWxmLT57WE1MQ29uZmlnfSA9IFtdOwoKICAgICMgVGhlc2UgYXJlIHRoZSB2YWxpZCAiaW5pdCIgdmFsdWVzIHRoYXQgdGhlIGNvbmZpZyBYTUwgbWF5IHVzZS4KICAgICMgICBTZXR0aW5ncyBtdXN0IGJlIHByb2Nlc3NlZCBpbiB0aGlzIG9yZGVyLCBhbmQgaW5zaWRlIGVhY2ggZ3JvdXAgYWxwaGFiZXRpY2FsbHkuCiAgICBteSAlVmFsaWRJbml0ID0gKAogICAgICAgIEZyYW1ld29yayAgID0+IDEsCiAgICAgICAgQXBwbGljYXRpb24gPT4gMSwKICAgICAgICBDb25maWcgICAgICA9PiAxLAogICAgICAgIENoYW5nZXMgICAgID0+IDEsCgogICAgICAgICMgS0lYQ29yZS1jYXBlSVQKICAgICAgICBLSVhGcmFtZXdvcmsgICA9PiAxLAogICAgICAgIEtJWEFwcGxpY2F0aW9uID0+IDEsCiAgICAgICAgS0lYQ29uZmlnICAgICAgPT4gMSwKICAgICAgICBLSVhDaGFuZ2VzICAgICA9PiAxLAoKICAgICAgICAjIEVPIEtJWENvcmUtY2FwZUlUCiAgICApOwoKICAgICMgVGVtcCBoYXNoIGZvciBzb3J0aW5nCiAgICBteSAlWE1MQ29uZmlnVE1QOwoKICAgICMgTG9vcCBvdmVyIHRoZSBzb3J0ZWQgZmlsZXMgYW5kIGFzc2lnbiBhbGwgY29uZmlncyB0byB0aGUgaW5pdCBzZWN0aW9uCiAgICBmb3IgbXkgJEZpbGUgKCBzb3J0IGtleXMgJURhdGEgKSB7CgogICAgICAgIG15ICRJbml0ID0gJERhdGF7JEZpbGV9LT5bMV0tPntvdHJzX2NvbmZpZ30tPlsxXS0+e2luaXR9IHx8ICcnOwogICAgICAgIGlmICggISRWYWxpZEluaXR7JEluaXR9ICkgewogICAgICAgICAgICAkSW5pdCA9ICdVbmtub3duJzsgICAgIyBGYWxsYmFjayBmb3IgdW5rbm93biBpbml0IHZhbHVlcwogICAgICAgIH0KCiAgICAgICAgIyBKdXN0IHVzZSB2YWxpZCBlbnRyaWVzLgogICAgICAgIGlmICggJERhdGF7JEZpbGV9LT5bMV0tPntvdHJzX2NvbmZpZ30tPlsxXS0+e0NvbmZpZ0l0ZW19ICkgewogICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgQHsgJFhNTENvbmZpZ1RNUHskSW5pdH0gfSwKICAgICAgICAgICAgICAgIEB7ICREYXRheyRGaWxlfS0+WzFdLT57b3Ryc19jb25maWd9LT5bMV0tPntDb25maWdJdGVtfSB9CiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgTm93IHByb2Nlc3MgdGhlIGVudHJpZXMgaW4gaW5pdCBvcmRlciBhbmQgYXNzaWduIHRoZW0gdG8gdGhlIHhtbCBlbnRyeSBsaXN0LgogICAgIyBLSVhDb3JlLWNhcGVJVAogICAgIyBmb3IgbXkgJEluaXQgKHF3KEZyYW1ld29yayBBcHBsaWNhdGlvbiBDb25maWcgQ2hhbmdlcyBVbmtvd24pKSB7CiAgICBmb3IgbXkgJEluaXQgKHF3KEZyYW1ld29yayBBcHBsaWNhdGlvbiBDb25maWcgQ2hhbmdlcyBLSVhGcmFtZXdvcmsgS0lYQXBwbGljYXRpb24gS0lYQ29uZmlnIEtJWENoYW5nZXMpKSB7CiAgICAgICAgIyBFTyBLSVhDb3JlLWNhcGVJVAogICAgICAgIGZvciBteSAkQ29uZmlnSXRlbSAoIEB7ICRYTUxDb25maWdUTVB7JEluaXR9IH0gKSB7CiAgICAgICAgICAgIHB1c2goCiAgICAgICAgICAgICAgICBAeyAkU2VsZi0+e1hNTENvbmZpZ30gfSwKICAgICAgICAgICAgICAgICRDb25maWdJdGVtCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgT25seSB0aGUgbGFzdCBjb25maWcgWE1MIGVudHJ5IHNob3VsZCBiZSB1c2VkLCByZW1vdmUgYW55IHByZXZpb3VzIG9uZXMuCiAgICBteSAlU2VlbjsKICAgIG15IEBYTUxDb25maWdUbXA7CgogICAgQ09ORklHSVRFTToKICAgIGZvciBteSAkQ29uZmlnSXRlbSAoIHJldmVyc2UgQHsgJFNlbGYtPntYTUxDb25maWd9IH0gKSB7CiAgICAgICAgbmV4dCBDT05GSUdJVEVNIGlmICEkQ29uZmlnSXRlbSB8fCAhJENvbmZpZ0l0ZW0tPntOYW1lfSB8fCAkU2VlbnsgJENvbmZpZ0l0ZW0tPntOYW1lfSB9Kys7CiAgICAgICAgcHVzaCBAWE1MQ29uZmlnVG1wLCAkQ29uZmlnSXRlbTsKICAgIH0KICAgICRTZWxmLT57WE1MQ29uZmlnfSA9IFxAWE1MQ29uZmlnVG1wOwoKICAgIG15ICRDb3VudGVyID0gMDsKICAgIGZvciBteSAkQ29uZmlnSXRlbSAoIHJldmVyc2UgQHsgJFNlbGYtPntYTUxDb25maWd9IH0gKSB7CgogICAgICAgICRDb3VudGVyKys7CgogICAgICAgIGlmICggJENvbmZpZ0l0ZW0tPntOYW1lfSAmJiAhJFNlbGYtPntDb25maWd9LT57ICRDb25maWdJdGVtLT57TmFtZX0gfSApIHsKICAgICAgICAgICAgJFNlbGYtPntDb25maWd9LT57ICRDb25maWdJdGVtLT57TmFtZX0gfSA9ICRDb25maWdJdGVtOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gJENvdW50ZXI7Cn0KCj1pdGVtIF9EYXRhRGlmZigpCgpjb21wYXJlcyB0d28gZGF0YSBzdHJ1Y3R1cmVzIHdpdGggZWFjaCBvdGhlci4gUmV0dXJucyAxIGlmCnRoZXkgYXJlIGRpZmZlcmVudCwgdW5kZWYgb3RoZXJ3aXNlLgoKRGF0YSBwYXJhbWV0ZXJzIG5lZWQgdG8gYmUgcGFzc2VkIGJ5IHJlZmVyZW5jZSBhbmQgY2FuIGJlIFNDQUxBUiwKQVJSQVkgb3IgSEFTSC4KCiAgICBteSAkRGF0YUlzRGlmZmVyZW50ID0gJFN5c0NvbmZpZ09iamVjdC0+X0RhdGFEaWZmKAogICAgICAgIERhdGExID0+IFwkRGF0YTEsCiAgICAgICAgRGF0YTIgPT4gXCREYXRhMiwKICAgICk7Cgo9Y3V0CgpzdWIgX0RhdGFEaWZmIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGZvciAocXcoRGF0YTEgRGF0YTIpKSB7CiAgICAgICAgaWYgKCAhZGVmaW5lZCAkUGFyYW17JF99ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkXyEiCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgIyAnJwogICAgaWYgKCByZWYgJFBhcmFte0RhdGExfSBlcSAnJyAmJiByZWYgJFBhcmFte0RhdGEyfSBlcSAnJyApIHsKCiAgICAgICAgIyBkbyBub3RoaW5nLCBpdCdzIG9rCiAgICAgICAgcmV0dXJuIGlmICFkZWZpbmVkICRQYXJhbXtEYXRhMX0gJiYgIWRlZmluZWQgJFBhcmFte0RhdGEyfTsKCiAgICAgICAgIyByZXR1cm4gZGlmZiwgYmVjYXVzZSBpdHMgZGlmZmVyZW50CiAgICAgICAgcmV0dXJuIDEgaWYgIWRlZmluZWQgJFBhcmFte0RhdGExfSB8fCAhZGVmaW5lZCAkUGFyYW17RGF0YTJ9OwoKICAgICAgICAjIHJldHVybiBkaWZmLCBiZWNhdXNlIGl0cyBkaWZmZXJlbnQKICAgICAgICByZXR1cm4gMSBpZiAkUGFyYW17RGF0YTF9IG5lICRQYXJhbXtEYXRhMn07CgogICAgICAgICMgcmV0dXJuLCBiZWNhdXNlIGl0cyBub3QgZGlmZmVyZW50CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgU0NBTEFSCiAgICBpZiAoIHJlZiAkUGFyYW17RGF0YTF9IGVxICdTQ0FMQVInICYmIHJlZiAkUGFyYW17RGF0YTJ9IGVxICdTQ0FMQVInICkgewoKICAgICAgICAjIGRvIG5vdGhpbmcsIGl0J3Mgb2sKICAgICAgICByZXR1cm4gaWYgIWRlZmluZWQgJHsgJFBhcmFte0RhdGExfSB9ICYmICFkZWZpbmVkICR7ICRQYXJhbXtEYXRhMn0gfTsKCiAgICAgICAgIyByZXR1cm4gZGlmZiwgYmVjYXVzZSBpdHMgZGlmZmVyZW50CiAgICAgICAgcmV0dXJuIDEgaWYgIWRlZmluZWQgJHsgJFBhcmFte0RhdGExfSB9IHx8ICFkZWZpbmVkICR7ICRQYXJhbXtEYXRhMn0gfTsKCiAgICAgICAgIyByZXR1cm4gZGlmZiwgYmVjYXVzZSBpdHMgZGlmZmVyZW50CiAgICAgICAgcmV0dXJuIDEgaWYgJHsgJFBhcmFte0RhdGExfSB9IG5lICR7ICRQYXJhbXtEYXRhMn0gfTsKCiAgICAgICAgIyByZXR1cm4sIGJlY2F1c2UgaXRzIG5vdCBkaWZmZXJlbnQKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBBUlJBWQogICAgaWYgKCByZWYgJFBhcmFte0RhdGExfSBlcSAnQVJSQVknICYmIHJlZiAkUGFyYW17RGF0YTJ9IGVxICdBUlJBWScgKSB7CiAgICAgICAgbXkgQEEgPSBAeyAkUGFyYW17RGF0YTF9IH07CiAgICAgICAgbXkgQEIgPSBAeyAkUGFyYW17RGF0YTJ9IH07CgogICAgICAgICMgY2hlY2sgaWYgdGhlIGNvdW50IGlzIGRpZmZlcmVudAogICAgICAgIHJldHVybiAxIGlmICQjQSBuZSAkI0I7CgogICAgICAgICMgY29tcGFyZSBhcnJheQogICAgICAgIENPVU5UOgogICAgICAgIGZvciBteSAkQ291bnQgKCAwIC4uICQjQSApIHsKCiAgICAgICAgICAgICMgZG8gbm90aGluZywgaXQncyBvawogICAgICAgICAgICBuZXh0IENPVU5UIGlmICFkZWZpbmVkICRBWyRDb3VudF0gJiYgIWRlZmluZWQgJEJbJENvdW50XTsKCiAgICAgICAgICAgICMgcmV0dXJuIGRpZmYsIGJlY2F1c2UgaXRzIGRpZmZlcmVudAogICAgICAgICAgICByZXR1cm4gMSBpZiAhZGVmaW5lZCAkQVskQ291bnRdIHx8ICFkZWZpbmVkICRCWyRDb3VudF07CgogICAgICAgICAgICBpZiAoICRBWyRDb3VudF0gbmUgJEJbJENvdW50XSApIHsKICAgICAgICAgICAgICAgIGlmICggcmVmICRBWyRDb3VudF0gZXEgJ0FSUkFZJyB8fCByZWYgJEFbJENvdW50XSBlcSAnSEFTSCcgKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEgaWYgJFNlbGYtPl9EYXRhRGlmZigKICAgICAgICAgICAgICAgICAgICAgICAgRGF0YTEgPT4gJEFbJENvdW50XSwKICAgICAgICAgICAgICAgICAgICAgICAgRGF0YTIgPT4gJEJbJENvdW50XQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgbmV4dCBDT1VOVDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIEhBU0gKICAgIGlmICggcmVmICRQYXJhbXtEYXRhMX0gZXEgJ0hBU0gnICYmIHJlZiAkUGFyYW17RGF0YTJ9IGVxICdIQVNIJyApIHsKICAgICAgICBteSAlQSA9ICV7ICRQYXJhbXtEYXRhMX0gfTsKICAgICAgICBteSAlQiA9ICV7ICRQYXJhbXtEYXRhMn0gfTsKCiAgICAgICAgIyBjb21wYXJlICVBIHdpdGggJUIgYW5kIHJlbW92ZSBpdCBpZiBjaGVja2VkCiAgICAgICAgS0VZOgogICAgICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICVBICkgewoKICAgICAgICAgICAgIyBDaGVjayBpZiBib3RoIGFyZSB1bmRlZmluZWQKICAgICAgICAgICAgaWYgKCAhZGVmaW5lZCAkQXskS2V5fSAmJiAhZGVmaW5lZCAkQnskS2V5fSApIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSAkQXskS2V5fTsKICAgICAgICAgICAgICAgIGRlbGV0ZSAkQnskS2V5fTsKICAgICAgICAgICAgICAgIG5leHQgS0VZOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHJldHVybiBkaWZmLCBiZWNhdXNlIGl0cyBkaWZmZXJlbnQKICAgICAgICAgICAgcmV0dXJuIDEgaWYgIWRlZmluZWQgJEF7JEtleX0gfHwgIWRlZmluZWQgJEJ7JEtleX07CgogICAgICAgICAgICBpZiAoICRBeyRLZXl9IGVxICRCeyRLZXl9ICkgewogICAgICAgICAgICAgICAgZGVsZXRlICRBeyRLZXl9OwogICAgICAgICAgICAgICAgZGVsZXRlICRCeyRLZXl9OwogICAgICAgICAgICAgICAgbmV4dCBLRVk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgcmV0dXJuIGlmIHZhbHVlcyBhcmUgZGlmZmVyZW50CiAgICAgICAgICAgIGlmICggcmVmICRBeyRLZXl9IGVxICdBUlJBWScgfHwgcmVmICRBeyRLZXl9IGVxICdIQVNIJyApIHsKICAgICAgICAgICAgICAgIHJldHVybiAxIGlmICRTZWxmLT5fRGF0YURpZmYoCiAgICAgICAgICAgICAgICAgICAgRGF0YTEgPT4gJEF7JEtleX0sCiAgICAgICAgICAgICAgICAgICAgRGF0YTIgPT4gJEJ7JEtleX0KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBkZWxldGUgJEF7JEtleX07CiAgICAgICAgICAgICAgICBkZWxldGUgJEJ7JEtleX07CiAgICAgICAgICAgICAgICBuZXh0IEtFWTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9CgogICAgICAgICMgY2hlY2sgcmVzdAogICAgICAgIHJldHVybiAxIGlmICVCOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoIHJlZiAkUGFyYW17RGF0YTF9IGVxICdSRUYnICYmIHJlZiAkUGFyYW17RGF0YTJ9IGVxICdSRUYnICkgewogICAgICAgIHJldHVybiAxIGlmICRTZWxmLT5fRGF0YURpZmYoCiAgICAgICAgICAgIERhdGExID0+ICR7ICRQYXJhbXtEYXRhMX0gfSwKICAgICAgICAgICAgRGF0YTIgPT4gJHsgJFBhcmFte0RhdGEyfSB9CiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgcmV0dXJuIDE7Cn0KCj1pdGVtIERFU1RST1koKQoKdGhpcyBkZXN0cnVjdG9yIHdpbGwgcmVjcmVhdGUgdGhlIGNvbmZpZ3VyYXRpb24gZmlsZSBhZnRlcgpjaGFuZ2VzIHdlcmUgZGV0ZWN0ZWQgZHVyaW5nIG1vZHVsZSBleGVjdXRpb24uCgo9Y3V0CgpzdWIgREVTVFJPWSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIGlmICggJFNlbGYtPntVcGRhdGV9ICkgewoKICAgICAgICAjIHdyaXRlIGRlZmF1bHQgZmlsZQogICAgICAgICRTZWxmLT5Xcml0ZURlZmF1bHQoKTsKICAgIH0KICAgIHJldHVybiAxOwp9Cgo9aXRlbSBfRmlsZVdyaXRlQXRvbWljKCkKCndyaXRlcyBhIGZpbGUgaW4gYW4gYXRvbWljIG9wZXJhdGlvbi4gVGhpcyBpcyBhY2hpZXZlZCBieSBjcmVhdGluZwphIHRlbXBvcmFyeSBmaWxlLCBmaWxsaW5nIGFuZCByZW5hbWluZyBpdC4gVGhpcyBhdm9pZHMgaW5jb25zaXN0ZW50IHN0YXRlcwp3aGVuIHRoZSBmaWxlIGlzIHVwZGF0ZWQuCgogICAgbXkgJFN1Y2Nlc3MgPSAkU3lzQ29uZmlnT2JqZWN0LT5fRmlsZVdyaXRlQXRvbWljKAogICAgICAgIEZpbGVuYW1lID0+ICIkU2VsZi0+e0hvbWV9L0tlcm5lbC9Db25maWcvRmlsZXMvWlpaQUF1dG8ucG0iLAogICAgICAgIENvbnRlbnQgID0+IFwkTmV3Q29udGVudCwKICAgICk7Cgo9Y3V0CgpzdWIgX0ZpbGVXcml0ZUF0b21pYyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIGZvciAocXcoRmlsZW5hbWUgQ29udGVudCkpIHsKICAgICAgICBpZiAoICFkZWZpbmVkICRQYXJhbXskX30gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICRfISIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICBteSAkVGVtcEZpbGVuYW1lID0gJFBhcmFte0ZpbGVuYW1lfSAuICcuJyAuICQkOwogICAgbXkgJEZIOwoKICAgICMjIG5vIGNyaXRpYwogICAgaWYgKCAhb3BlbiggJEZILCAiPiRTZWxmLT57RmlsZU1vZGV9IiwgJFRlbXBGaWxlbmFtZSApICkgewogICAgICAgICMjIHVzZSBjcml0aWMKCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDYW4ndCBvcGVuIGZpbGUgJFRlbXBGaWxlbmFtZTogJCEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIHByaW50ICRGSCAkeyAkUGFyYW17Q29udGVudH0gfTsKICAgIGNsb3NlICRGSDsKCiAgICBpZiAoICFyZW5hbWUgJFRlbXBGaWxlbmFtZSwgJFBhcmFte0ZpbGVuYW1lfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkNvdWxkIG5vdCByZW5hbWUgJFRlbXBGaWxlbmFtZSB0byAkUGFyYW17RmlsZW5hbWV9OiAkISIKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICByZXR1cm4gMTsKfQoKc3ViIF9Db25maWdJdGVtVHJhbnNsYXRhYmxlU3RyaW5ncyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgKHF3KERhdGEpKSB7CiAgICAgICAgaWYgKCAhZGVmaW5lZCAkUGFyYW17JF99ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkXyEiCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgIyBBUlJBWQogICAgaWYgKCByZWYgJFBhcmFte0RhdGF9IGVxICdBUlJBWScgKSB7CgogICAgICAgIEtFWToKICAgICAgICBmb3IgbXkgJEtleSAoIEB7ICRQYXJhbXtEYXRhfSB9ICkgewogICAgICAgICAgICBuZXh0IEtFWSBpZiAhJEtleTsKICAgICAgICAgICAgJFNlbGYtPl9Db25maWdJdGVtVHJhbnNsYXRhYmxlU3RyaW5ncyggRGF0YSA9PiAkS2V5ICk7CiAgICAgICAgfQogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIEhBU0gKICAgIGlmICggcmVmICRQYXJhbXtEYXRhfSBlcSAnSEFTSCcgKSB7CiAgICAgICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJXsgJFBhcmFte0RhdGF9IH0gKSB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIHJlZiAkUGFyYW17RGF0YX0tPnskS2V5fSBlcSAnJwogICAgICAgICAgICAgICAgJiYgJFBhcmFte0RhdGF9LT57VHJhbnNsYXRhYmxlfQogICAgICAgICAgICAgICAgJiYgJFBhcmFte0RhdGF9LT57Q29udGVudH0KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmV0dXJuIGlmICEkUGFyYW17RGF0YX0tPntDb250ZW50fTsKICAgICAgICAgICAgICAgIHJldHVybiBpZiAkUGFyYW17RGF0YX0tPntDb250ZW50fSA9fiAvXlxkKyQvOwogICAgICAgICAgICAgICAgJFNlbGYtPntDb25maWdJdGVtVHJhbnNsYXRhYmxlU3RyaW5nc30tPnsgJFBhcmFte0RhdGF9LT57Q29udGVudH0gfSA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJFNlbGYtPl9Db25maWdJdGVtVHJhbnNsYXRhYmxlU3RyaW5ncyggRGF0YSA9PiAkUGFyYW17RGF0YX0tPnskS2V5fSApOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybjsKfQoKc3ViIF9Nb2RHZXQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkQ29udGVudDsKICAgIG15ICRDb25maWdPYmplY3Q7CgogICAgIyBkbyBub3QgdXNlIFpaWiBmaWxlcwogICAgaWYgKCAkUGFyYW17TGV2ZWx9ICYmICRQYXJhbXtMZXZlbH0gZXEgJ0RlZmF1bHQnICkgewogICAgICAgICRDb25maWdPYmplY3QgPSAkU2VsZi0+e0NvbmZpZ0RlZmF1bHRPYmplY3R9OwogICAgfQogICAgZWxzaWYgKCAkUGFyYW17TGV2ZWx9ICYmICRQYXJhbXtMZXZlbH0gZXEgJ0NsZWFyJyApIHsKICAgICAgICAkQ29uZmlnT2JqZWN0ID0gJFNlbGYtPntDb25maWdDbGVhck9iamVjdH07CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkQ29uZmlnT2JqZWN0ID0gJFNlbGYtPntDb25maWdPYmplY3R9OwogICAgfQoKICAgICMgZ2V0IGNvbmZpZyB2YWx1ZSBvZiBIQVNILT5IQVNILT5IQVNICiAgICBpZiAoICRQYXJhbXtDb25maWdOYW1lfSA9fiAvXiguKikjIyMoLiopIyMjKC4qKSQvICkgewogICAgICAgIG15ICRDb25maWcgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJDEpOwogICAgICAgIGlmICggZGVmaW5lZCAkQ29uZmlnICYmIHJlZiAkQ29uZmlnIGVxICdIQVNIJyApIHsKICAgICAgICAgICAgbXkgJENvbmZpZ1N1YiA9ICRDb25maWctPnskMn07CiAgICAgICAgICAgIGlmICggZGVmaW5lZCAkQ29uZmlnU3ViICYmIHJlZiAkQ29uZmlnU3ViIGVxICdIQVNIJyApIHsKICAgICAgICAgICAgICAgICRDb250ZW50ID0gJENvbmZpZ1N1Yi0+eyQzfTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCBjb25maWcgdmFsdWUgb2YgSEFTSC0+SEFTSAogICAgZWxzaWYgKCAkUGFyYW17Q29uZmlnTmFtZX0gPX4gL14oLiopIyMjKC4qKSQvICkgewogICAgICAgIG15ICRDb25maWcgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJDEpOwogICAgICAgIGlmICggZGVmaW5lZCAkQ29uZmlnICYmIHJlZiAkQ29uZmlnIGVxICdIQVNIJyApIHsKICAgICAgICAgICAgJENvbnRlbnQgPSAkQ29uZmlnLT57JDJ9OwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCBjb25maWcgdmFsdWUKICAgIGVsc2UgewogICAgICAgIG15ICRDb25maWcgPSAkQ29uZmlnT2JqZWN0LT5HZXQoICRQYXJhbXtDb25maWdOYW1lfSApOwogICAgICAgIGlmICggZGVmaW5lZCAkQ29uZmlnICkgewogICAgICAgICAgICAkQ29udGVudCA9ICRDb25maWc7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuICRDb250ZW50Owp9CgpzdWIgX1hNTDJQZXJsIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGZvciAocXcoRGF0YSkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JF99ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkXyEiCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgIyBnZXQgbWFpbiBvYmplY3QKICAgIG15ICRNYWluT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKTsKCiAgICBteSAkQ29uZmlnSXRlbSA9ICRQYXJhbXtEYXRhfS0+e1NldHRpbmd9LT5bMV07CiAgICBteSAkRGF0YTsKICAgIGlmICggJENvbmZpZ0l0ZW0tPntTdHJpbmd9ICkgewogICAgICAgICREYXRhID0gJENvbmZpZ0l0ZW0tPntTdHJpbmd9LT5bMV0tPntDb250ZW50fTsKICAgICAgICBteSAkRCA9ICREYXRhOwogICAgICAgICREYXRhID0gJEQ7CgogICAgICAgICMgc3RvcmUgaW4gY29uZmlnCiAgICAgICAgbXkgJER1bXAgPSAkTWFpbk9iamVjdC0+RHVtcCgkRGF0YSk7CiAgICAgICAgJER1bXAgPX4gcy9cJFZBUjEgPS8vOwogICAgICAgICREYXRhID0gJER1bXA7CiAgICB9CiAgICBpZiAoICRDb25maWdJdGVtLT57T3B0aW9ufSApIHsKICAgICAgICAkRGF0YSA9ICRDb25maWdJdGVtLT57T3B0aW9ufS0+WzFdLT57U2VsZWN0ZWRJRH07CiAgICAgICAgbXkgJEQgPSAkRGF0YTsKICAgICAgICAkRGF0YSA9ICREOwoKICAgICAgICAjIHN0b3JlIGluIGNvbmZpZwogICAgICAgIG15ICREdW1wID0gJE1haW5PYmplY3QtPkR1bXAoJERhdGEpOwogICAgICAgICREdW1wID1+IHMvXCRWQVIxID0vLzsKICAgICAgICAkRGF0YSA9ICREdW1wOwogICAgfQogICAgaWYgKCAkQ29uZmlnSXRlbS0+e1RleHRBcmVhfSApIHsKICAgICAgICAkRGF0YSA9ICRDb25maWdJdGVtLT57VGV4dEFyZWF9LT5bMV0tPntDb250ZW50fTsKICAgICAgICAkRGF0YSA9fiBzLyhcblxyfFxyXHJcbnxcclxuKS9cbi9nOwogICAgICAgIG15ICREID0gJERhdGE7CiAgICAgICAgJERhdGEgPSAkRDsKCiAgICAgICAgIyBzdG9yZSBpbiBjb25maWcKICAgICAgICBteSAkRHVtcCA9ICRNYWluT2JqZWN0LT5EdW1wKCREYXRhKTsKICAgICAgICAkRHVtcCA9fiBzL1wkVkFSMSA9Ly87CiAgICAgICAgJERhdGEgPSAkRHVtcDsKICAgIH0KICAgIGlmICggJENvbmZpZ0l0ZW0tPntIYXNofSApIHsKICAgICAgICBteSAlSGFzaDsKICAgICAgICBteSBAQXJyYXk7CiAgICAgICAgaWYgKCByZWYgJENvbmZpZ0l0ZW0tPntIYXNofS0+WzFdLT57SXRlbX0gZXEgJ0FSUkFZJyApIHsKICAgICAgICAgICAgQEFycmF5ID0gQHsgJENvbmZpZ0l0ZW0tPntIYXNofS0+WzFdLT57SXRlbX0gfTsKICAgICAgICB9CiAgICAgICAgZm9yIG15ICRJdGVtICggMSAuLiAkI0FycmF5ICkgewogICAgICAgICAgICBpZiAoIGRlZmluZWQgJEFycmF5WyRJdGVtXS0+e0hhc2h9ICkgewogICAgICAgICAgICAgICAgbXkgJVN1Ykhhc2g7CiAgICAgICAgICAgICAgICBmb3IgbXkgJEluZGV4ICgKICAgICAgICAgICAgICAgICAgICAxIC4uICQjeyAkQ29uZmlnSXRlbS0+e0hhc2h9LT5bMV0tPntJdGVtfS0+WyRJdGVtXS0+e0hhc2h9LT5bMV0tPntJdGVtfSB9CiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICRTdWJIYXNoewogICAgICAgICAgICAgICAgICAgICAgICAkQ29uZmlnSXRlbS0+e0hhc2h9LT5bMV0tPntJdGVtfS0+WyRJdGVtXS0+e0hhc2h9LT5bMV0tPntJdGVtfS0+WyRJbmRleF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+e0tleX0KICAgICAgICAgICAgICAgICAgICAgICAgfSA9ICRDb25maWdJdGVtLT57SGFzaH0tPlsxXS0+e0l0ZW19LT5bJEl0ZW1dLT57SGFzaH0tPlsxXS0+e0l0ZW19LT5bJEluZGV4XQogICAgICAgICAgICAgICAgICAgICAgICAtPntDb250ZW50fTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRIYXNoeyAkQXJyYXlbJEl0ZW1dLT57S2V5fSB9ID0gXCVTdWJIYXNoOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2lmICggZGVmaW5lZCAkQXJyYXlbJEl0ZW1dLT57QXJyYXl9ICkgewogICAgICAgICAgICAgICAgbXkgQFN1YkFycmF5OwogICAgICAgICAgICAgICAgZm9yIG15ICRJbmRleCAoCiAgICAgICAgICAgICAgICAgICAgMSAuLiAkI3sgJENvbmZpZ0l0ZW0tPntIYXNofS0+WzFdLT57SXRlbX0tPlskSXRlbV0tPntBcnJheX0tPlsxXS0+e0l0ZW19IH0KICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgICAgICAgICAgQFN1YkFycmF5LAogICAgICAgICAgICAgICAgICAgICAgICAkQ29uZmlnSXRlbS0+e0hhc2h9LT5bMV0tPntJdGVtfS0+WyRJdGVtXS0+e0FycmF5fS0+WzFdLT57SXRlbX0tPlskSW5kZXhdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPntDb250ZW50fQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkSGFzaHsgJEFycmF5WyRJdGVtXS0+e0tleX0gfSA9IFxAU3ViQXJyYXk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkSGFzaHsgJEFycmF5WyRJdGVtXS0+e0tleX0gfSA9ICRBcnJheVskSXRlbV0tPntDb250ZW50fTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBzdG9yZSBpbiBjb25maWcKICAgICAgICBteSAkRHVtcCA9ICRNYWluT2JqZWN0LT5EdW1wKCBcJUhhc2ggKTsKICAgICAgICAkRHVtcCA9fiBzL1wkVkFSMSA9Ly87CiAgICAgICAgJERhdGEgPSAkRHVtcDsKICAgIH0KICAgIGlmICggJENvbmZpZ0l0ZW0tPntBcnJheX0gKSB7CiAgICAgICAgbXkgQEFycmF5TmV3OwogICAgICAgIG15IEBBcnJheTsKICAgICAgICBpZiAoIHJlZiAkQ29uZmlnSXRlbS0+e0FycmF5fS0+WzFdLT57SXRlbX0gZXEgJ0FSUkFZJyApIHsKICAgICAgICAgICAgQEFycmF5ID0gQHsgJENvbmZpZ0l0ZW0tPntBcnJheX0tPlsxXS0+e0l0ZW19IH07CiAgICAgICAgfQogICAgICAgIGZvciBteSAkSXRlbSAoIDEgLi4gJCNBcnJheSApIHsKICAgICAgICAgICAgcHVzaCBAQXJyYXlOZXcsICRBcnJheVskSXRlbV0tPntDb250ZW50fTsKICAgICAgICB9CgogICAgICAgICMgc3RvcmUgaW4gY29uZmlnCiAgICAgICAgbXkgJER1bXAgPSAkTWFpbk9iamVjdC0+RHVtcCggXEBBcnJheU5ldyApOwogICAgICAgICREdW1wID1+IHMvXCRWQVIxID0vLzsKICAgICAgICAkRGF0YSA9ICREdW1wOwogICAgfQogICAgaWYgKCAkQ29uZmlnSXRlbS0+e0Zyb250ZW5kTW9kdWxlUmVnfSApIHsKICAgICAgICBteSAlSGFzaDsKICAgICAgICBmb3IgbXkgJEtleSAoIHNvcnQga2V5cyAleyAkQ29uZmlnSXRlbS0+e0Zyb250ZW5kTW9kdWxlUmVnfS0+WzFdIH0gKSB7CiAgICAgICAgICAgIGlmICggJEtleSBlcSAnR3JvdXAnIHx8ICRLZXkgZXEgJ0dyb3VwUm8nICkgewogICAgICAgICAgICAgICAgbXkgQEFycmF5OwogICAgICAgICAgICAgICAgZm9yIG15ICRJbmRleCAoIDEgLi4gJCN7ICRDb25maWdJdGVtLT57RnJvbnRlbmRNb2R1bGVSZWd9LT5bMV0tPnskS2V5fSB9ICkgewogICAgICAgICAgICAgICAgICAgIHB1c2goCiAgICAgICAgICAgICAgICAgICAgICAgIEBBcnJheSwKICAgICAgICAgICAgICAgICAgICAgICAgJENvbmZpZ0l0ZW0tPntGcm9udGVuZE1vZHVsZVJlZ30tPlsxXS0+eyRLZXl9LT5bJEluZGV4XS0+e0NvbnRlbnR9CiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRIYXNoeyRLZXl9ID0gXEBBcnJheTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNpZiAoICRLZXkgZXEgJ05hdkJhcicgfHwgJEtleSBlcSAnTmF2QmFyTW9kdWxlJyApIHsKICAgICAgICAgICAgICAgIGlmICggcmVmICRDb25maWdJdGVtLT57RnJvbnRlbmRNb2R1bGVSZWd9LT5bMV0tPnskS2V5fSBlcSAnQVJSQVknICkgewogICAgICAgICAgICAgICAgICAgIGZvciBteSAkSW5kZXggKCAxIC4uICQjeyAkQ29uZmlnSXRlbS0+e0Zyb250ZW5kTW9kdWxlUmVnfS0+WzFdLT57JEtleX0gfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgbXkgJENvbnRlbnQgPSAkQ29uZmlnSXRlbS0+e0Zyb250ZW5kTW9kdWxlUmVnfS0+WzFdLT57JEtleX0tPlskSW5kZXhdOwogICAgICAgICAgICAgICAgICAgICAgICBteSAlTmF2QmFyOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgbXkgJEtleSAoIHNvcnQga2V5cyAleyRDb250ZW50fSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJEtleSBlcSAnR3JvdXAnIHx8ICRLZXkgZXEgJ0dyb3VwUm8nICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15IEBBcnJheTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgbXkgJEluZGV4ICggMSAuLiAkI3sgJENvbnRlbnQtPnskS2V5fSB9ICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoIEBBcnJheSwgJENvbnRlbnQtPnskS2V5fS0+WyRJbmRleF0tPntDb250ZW50fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE5hdkJhcnskS2V5fSA9IFxAQXJyYXk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRLZXkgbmUgJ0NvbnRlbnQnICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTmF2QmFyeyRLZXl9ID0gJENvbnRlbnQtPnskS2V5fS0+WzFdLT57Q29udGVudH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJEtleSBlcSAnTmF2QmFyJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2ggQHsgJEhhc2h7JEtleX0gfSwgXCVOYXZCYXI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkSGFzaHskS2V5fSA9IFwlTmF2QmFyOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbXkgJENvbnRlbnQgPSAkQ29uZmlnSXRlbS0+e0Zyb250ZW5kTW9kdWxlUmVnfS0+WzFdLT57JEtleX07CiAgICAgICAgICAgICAgICAgICAgbXkgJU5hdkJhcjsKICAgICAgICAgICAgICAgICAgICBmb3IgbXkgJEtleSAoIHNvcnQga2V5cyAleyRDb250ZW50fSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkS2V5IGVxICdHcm91cCcgfHwgJEtleSBlcSAnR3JvdXBSbycgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBteSBAQXJyYXk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgbXkgJEluZGV4ICggMSAuLiAkI3sgJENvbnRlbnQtPnskS2V5fSB9ICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2ggQEFycmF5LCAkQ29udGVudC0+eyRLZXl9LT5bJEluZGV4XS0+e0NvbnRlbnR9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE5hdkJhcnskS2V5fSA9IFxAQXJyYXk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRLZXkgbmUgJ0NvbnRlbnQnICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICROYXZCYXJ7JEtleX0gPSAkQ29udGVudC0+eyRLZXl9LT5bMV0tPntDb250ZW50fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkSGFzaHskS2V5fSA9IFwlTmF2QmFyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2lmICggJEtleSBlcSAnTG9hZGVyJyApIHsKICAgICAgICAgICAgICAgIG15ICRDb250ZW50ID0gJENvbmZpZ0l0ZW0tPntGcm9udGVuZE1vZHVsZVJlZ30tPlsxXS0+eyRLZXl9LT5bMV07CiAgICAgICAgICAgICAgICBteSAlTG9hZGVyOwogICAgICAgICAgICAgICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJXskQ29udGVudH0gKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAkS2V5IGVxICdDU1MnCiAgICAgICAgICAgICAgICAgICAgICAgIHx8ICRLZXkgZXEgJ0phdmFTY3JpcHQnCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG15IEBBcnJheTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRJbmRleCAoIDEgLi4gJCN7ICRDb250ZW50LT57JEtleX0gfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2ggQEFycmF5LCAkQ29udGVudC0+eyRLZXl9LT5bJEluZGV4XS0+e0NvbnRlbnR9OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICRMb2FkZXJ7JEtleX0gPSBcQEFycmF5OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkS2V5IG5lICdDb250ZW50JyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMb2FkZXJ7JEtleX0gPSAkQ29udGVudC0+eyRLZXl9LT5bMV0tPntDb250ZW50fTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICglTG9hZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgJEhhc2h7JEtleX0gPSBcJUxvYWRlcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICggJEtleSBuZSAnQ29udGVudCcgKSB7CiAgICAgICAgICAgICAgICAgICAgJEhhc2h7JEtleX0gPSAkQ29uZmlnSXRlbS0+e0Zyb250ZW5kTW9kdWxlUmVnfS0+WzFdLT57JEtleX0tPlsxXS0+e0NvbnRlbnR9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIHN0b3JlIGluIGNvbmZpZwogICAgICAgIG15ICREdW1wID0gJE1haW5PYmplY3QtPkR1bXAoIFwlSGFzaCApOwogICAgICAgICREdW1wID1+IHMvXCRWQVIxID0vLzsKICAgICAgICAkRGF0YSA9ICREdW1wOwogICAgfQogICAgaWYgKCAkQ29uZmlnSXRlbS0+e1RpbWVXb3JraW5nSG91cnN9ICkgewogICAgICAgIG15ICVEYXlzOwogICAgICAgIG15IEBBcnJheSA9IEB7ICRDb25maWdJdGVtLT57VGltZVdvcmtpbmdIb3Vyc30tPlsxXS0+e0RheX0gfTsKICAgICAgICBmb3IgbXkgJERheSAoIDEgLi4gJCNBcnJheSApIHsKICAgICAgICAgICAgbXkgQEFycmF5MjsKICAgICAgICAgICAgaWYgKCAkQXJyYXlbJERheV0tPntIb3VyfSApIHsKICAgICAgICAgICAgICAgIG15IEBIb3VycyA9IEB7ICRBcnJheVskRGF5XS0+e0hvdXJ9IH07CiAgICAgICAgICAgICAgICBmb3IgbXkgJEhvdXIgKCAxIC4uICQjSG91cnMgKSB7CiAgICAgICAgICAgICAgICAgICAgcHVzaCBAQXJyYXkyLCAkSG91cnNbJEhvdXJdLT57Q29udGVudH07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJERheXN7ICRBcnJheVskRGF5XS0+e05hbWV9IH0gPSBcQEFycmF5MjsKICAgICAgICB9CgogICAgICAgICMgc3RvcmUgaW4gY29uZmlnCiAgICAgICAgbXkgJER1bXAgPSAkTWFpbk9iamVjdC0+RHVtcCggXCVEYXlzICk7CiAgICAgICAgJER1bXAgPX4gcy9cJFZBUjEgPS8vOwogICAgICAgICREYXRhID0gJER1bXA7CiAgICB9CiAgICBpZiAoICRDb25maWdJdGVtLT57VGltZVZhY2F0aW9uRGF5c30gKSB7CiAgICAgICAgbXkgJUhhc2g7CiAgICAgICAgbXkgQEFycmF5ID0gQHsgJENvbmZpZ0l0ZW0tPntUaW1lVmFjYXRpb25EYXlzfS0+WzFdLT57SXRlbX0gfTsKICAgICAgICBmb3IgbXkgJEl0ZW0gKCAxIC4uICQjQXJyYXkgKSB7CiAgICAgICAgICAgICRIYXNoeyAkQXJyYXlbJEl0ZW1dLT57TW9udGh9IH0tPnsgJEFycmF5WyRJdGVtXS0+e0RheX0gfSA9ICRBcnJheVskSXRlbV0tPntDb250ZW50fTsKICAgICAgICB9CgogICAgICAgICMgc3RvcmUgaW4gY29uZmlnCiAgICAgICAgbXkgJER1bXAgPSAkTWFpbk9iamVjdC0+RHVtcCggXCVIYXNoICk7CiAgICAgICAgJER1bXAgPX4gcy9cJFZBUjEgPS8vOwogICAgICAgICREYXRhID0gJER1bXA7CiAgICB9CiAgICBpZiAoICRDb25maWdJdGVtLT57VGltZVZhY2F0aW9uRGF5c09uZVRpbWV9ICkgewogICAgICAgIG15ICVIYXNoOwogICAgICAgIG15IEBBcnJheSA9IEB7ICRDb25maWdJdGVtLT57VGltZVZhY2F0aW9uRGF5c09uZVRpbWV9LT5bMV0tPntJdGVtfSB9OwogICAgICAgIGZvciBteSAkSXRlbSAoIDEgLi4gJCNBcnJheSApIHsKICAgICAgICAgICAgJEhhc2h7ICRBcnJheVskSXRlbV0tPntZZWFyfSB9LT57ICRBcnJheVskSXRlbV0tPntNb250aH0gfS0+eyAkQXJyYXlbJEl0ZW1dLT57RGF5fSB9CiAgICAgICAgICAgICAgICA9ICRBcnJheVskSXRlbV0tPntDb250ZW50fTsKICAgICAgICB9CgogICAgICAgICMgc3RvcmUgaW4gY29uZmlnCiAgICAgICAgbXkgJER1bXAgPSAkTWFpbk9iamVjdC0+RHVtcCggXCVIYXNoICk7CiAgICAgICAgJER1bXAgPX4gcy9cJFZBUjEgPS8vOwogICAgICAgICREYXRhID0gJER1bXA7CiAgICB9CiAgICBpZiAoICRDb25maWdJdGVtLT57RGF0ZVRpbWV9ICkgewogICAgICAgIG15ICVIYXNoOwoKICAgICAgICAjIGdhdGhlciBkYXRhIGZyb20gdGhlIFhNTCBzdHJ1Y3R1cmUgYW5kIHNldCBpdCB0byBhIFBlcmwgaGFzaAogICAgICAgIGZvciBteSAkUGFydCAocXcoWWVhciBNb250aCBEYXkgSG91ciBNaW51dGUpKSB7CiAgICAgICAgICAgICRIYXNoeyRQYXJ0fSA9ICRDb25maWdJdGVtLT57RGF0ZVRpbWV9LT5bMV0tPnskUGFydH0tPlsxXS0+e0NvbnRlbnR9OwogICAgICAgIH0KCiAgICAgICAgIyBzdG9yZSBpbiBjb25maWcKICAgICAgICBteSAkRHVtcCA9ICRNYWluT2JqZWN0LT5EdW1wKCBcJUhhc2ggKTsKICAgICAgICAkRHVtcCA9fiBzL1wkVkFSMSA9Ly87CiAgICAgICAgJERhdGEgPSAkRHVtcDsKICAgIH0KCiAgICByZXR1cm4gJERhdGE7Cn0KCjE7Cgo9ZW5kIEludGVybmFsOgoKPWJhY2sKCj1oZWFkMSBURVJNUyBBTkQgQ09ORElUSU9OUwoKVGhpcyBzb2Z0d2FyZSBpcyBwYXJ0IG9mIHRoZSBPVFJTIHByb2plY3QgKEw8aHR0cDovL290cnMub3JnLz4pLgoKVGhpcyBzb2Z0d2FyZSBjb21lcyB3aXRoIEFCU09MVVRFTFkgTk8gV0FSUkFOVFkuIEZvciBkZXRhaWxzLCBzZWUKdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoQUdQTCkuIElmIHlvdQpkaWQgbm90IHJlY2VpdmUgdGhpcyBmaWxlLCBzZWUgTDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvYWdwbC50eHQ+LgoKPWN1dAo=</File>
        <File Location="var/packagesetup/KIXCore.pm" Permission="644" Encode="Base64">IyAtLQojIEtJWENvcmUucG0gLSBjb2RlIHJ1biBkdXJpbmcgcGFja2FnZSBkZS0vaW5zdGFsbGF0aW9uCiMgQ29weXJpZ2h0IChDKSAyMDA2LTIwMTYgYy5hLnAuZS4gSVQgR21iSCwgaHR0cDovL3d3dy5jYXBlLWl0LmRlCiMKIyB3cml0dGVuL2VkaXRlZCBieToKIyAqIFRvcnN0ZW4oZG90KVRoYXUoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojICogTWFydGluKGRvdClCYWx6YXJlayhhdCljYXBlKGRhc2gpaXQoZG90KWRlCiMgKiBEb3JvdGhlYShkb3QpRG9lcmZmZWwoYXQpY2FwZShkYXNoKWl0KGRvdClkZQojCiMgLS0KIyAkSWQ6IEtJWENvcmUucG0sdiAxLjggMjAxNi8wMS8yMCAxMzo0NDo0NyBkZG9lcmZmZWwgRXhwICQKIyAtLQojIFRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCiMgdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoQUdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvYWdwbC50eHQuCiMgLS0KcGFja2FnZSB2YXI6OnBhY2thZ2VzZXR1cDo6S0lYQ29yZTsKCnVzZSBzdHJpY3Q7CnVzZSB3YXJuaW5nczsKCm91ciBAT2JqZWN0RGVwZW5kZW5jaWVzID0gKAogICAgJ0tlcm5lbDo6Q29uZmlnJywKICAgICdLZXJuZWw6OlN5c3RlbTo6TWFpbicsCiAgICAnS2VybmVsOjpTeXN0ZW06OlN5c0NvbmZpZycsCik7Cgp1c2UgdmFycyBxdyhASVNBICRWRVJTSU9OKTsKJFZFUlNJT04gPSBxdygkUmV2aXNpb246IDEuOCAkKSBbMV07Cgo9aGVhZDEgTkFNRQoKS0lYQ29yZS5wbSAtIGNvZGUgdG8gZXhjZWN1dGUgZHVyaW5nIHBhY2thZ2UgaW5zdGFsbGF0aW9uCgo9aGVhZDEgU1lOT1BTSVMKCkFsbCBmdW5jdGlvbnMKCj1oZWFkMSBQVUJMSUMgSU5URVJGQUNFCgo9b3ZlciA0Cgo9Y3V0Cgo9aXRlbSBuZXcoKQoKY3JlYXRlIGFuIG9iamVjdAoKICAgIHVzZSBLZXJuZWw6OlN5c3RlbTo6T2JqZWN0TWFuYWdlcjsKICAgIGxvY2FsICRLZXJuZWw6Ok9NID0gS2VybmVsOjpTeXN0ZW06Ok9iamVjdE1hbmFnZXItPm5ldygpOwogICAgbXkgJENvZGVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCd2YXI6OnBhY2thZ2VzZXR1cDo6S0lYQ29yZScpOwoKPWN1dAoKc3ViIG5ldyB7CiAgICBteSAoICRUeXBlLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgYWxsb2NhdGUgbmV3IGhhc2ggZm9yIG9iamVjdAogICAgbXkgJFNlbGYgPSB7fTsKICAgIGJsZXNzKCAkU2VsZiwgJFR5cGUgKTsKCiAgICAjIGFsd2F5cyBkaXNjYXJkIHRoZSBjb25maWcgb2JqZWN0IGJlZm9yZSBwYWNrYWdlIGNvZGUgaXMgZXhlY3V0ZWQsCiAgICAjIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBjb25maWcgb2JqZWN0IHdpbGwgYmUgY3JlYXRlZCBuZXdseSwgc28gdGhhdCBpdAogICAgIyB3aWxsIHVzZSB0aGUgcmVjZW50bHkgd3JpdHRlbiBuZXcgY29uZmlnIGZyb20gdGhlIHBhY2thZ2UKICAgICRLZXJuZWw6Ok9NLT5PYmplY3RzRGlzY2FyZCgKICAgICAgICBPYmplY3RzID0+IFsnS2VybmVsOjpDb25maWcnXSwKICAgICk7CgogICAgIyBjcmVhdGUgYWRkaXRpb25hbCBvYmplY3RzLi4uCiAgICAkU2VsZi0+e0NvbmZpZ09iamVjdH0gICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwogICAgJFNlbGYtPntNYWluT2JqZWN0fSAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKTsKICAgICRTZWxmLT57U3lzQ29uZmlnT2JqZWN0fSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpTeXNDb25maWcnKTsKCiAgICAkU2VsZi0+e1N5c0NvbmZpZ09iamVjdH0tPldyaXRlRGVmYXVsdCgpOwogICAgbXkgQFpaWkZpbGVzID0gKAogICAgICAgICdaWlpBQXV0by5wbScsCiAgICAgICAgJ1paWkF1dG8ucG0nLAogICAgKTsKCiAgICAjIHJlbG9hZCB0aGUgWlpaIGZpbGVzIChtb2RfcGVybCB3b3JrYXJvdW5kKQogICAgZm9yIG15ICRaWlpGaWxlIChAWlpaRmlsZXMpIHsKICAgICAgICBQUkVGSVg6CiAgICAgICAgZm9yIG15ICRQcmVmaXggKEBJTkMpIHsKICAgICAgICAgICAgbXkgJEZpbGUgPSAkUHJlZml4IC4gJy9LZXJuZWwvQ29uZmlnL0ZpbGVzLycgLiAkWlpaRmlsZTsKICAgICAgICAgICAgaWYgKCAhLWYgJEZpbGUgKSB7CiAgICAgICAgICAgICAgICBuZXh0IFBSRUZJWAogICAgICAgICAgICB9CiAgICAgICAgICAgIGRvICRGaWxlOwogICAgICAgICAgICBsYXN0IFBSRUZJWDsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gJFNlbGY7Cn0KCj1pdGVtIENvZGVJbnN0YWxsKCkKCnJ1biB0aGUgY29kZSBpbnN0YWxsIHBhcnQKCiAgICBteSAkUmVzdWx0ID0gJENvZGVPYmplY3QtPkNvZGVJbnN0YWxsKCk7Cgo9Y3V0CgpzdWIgQ29kZUluc3RhbGwgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAkU2VsZi0+X1ByZXBhcmVLSVhDb3JlKCk7CgogICAgcmV0dXJuIDE7Cn0KCj1pdGVtIENvZGVSZWluc3RhbGwoKQoKcnVuIHRoZSBjb2RlIHJlaW5zdGFsbCBwYXJ0CgogICAgbXkgJFJlc3VsdCA9ICRDb2RlT2JqZWN0LT5Db2RlUmVpbnN0YWxsKCk7Cgo9Y3V0CgpzdWIgQ29kZVJlaW5zdGFsbCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICRTZWxmLT5fUHJlcGFyZUtJWENvcmUoKTsKCiAgICByZXR1cm4gMTsKfQoKPWl0ZW0gQ29kZVVwZ3JhZGUoKQoKcnVuIHRoZSBjb2RlIHVwZ3JhZGUgcGFydAoKICAgIG15ICRSZXN1bHQgPSAkQ29kZU9iamVjdC0+Q29kZVVwZ3JhZGUoKTsKCj1jdXQKCnN1YiBDb2RlVXBncmFkZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIHJldHVybiAxOwp9Cgo9aXRlbSBDb2RlVW5pbnN0YWxsKCkKCnJ1biB0aGUgY29kZSB1bmluc3RhbGwgcGFydAoKICAgIG15ICRSZXN1bHQgPSAkQ29kZU9iamVjdC0+Q29kZVVuaW5zdGFsbCgpOwoKPWN1dAoKc3ViIENvZGVVbmluc3RhbGwgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAkU2VsZi0+X1JlbW92ZUtJWENvcmUoKTsKCiAgICByZXR1cm4gMTsKCn0KCj1pdGVtIF9QcmVwYXJlS0lYQ29yZSgpCgpBdXRvbWF0aWNhbGx5IG9wZW4gZmlsZXMgd2hpY2ggbmVlZCB0byBiZSBlZGl0ZWQgZm9yIEtJWCB0c3VuYW1pIGZyYW1ld29yay4KCiAgICBteSAkUmVzdWx0ID0gJENvZGVPYmplY3QtPl9QcmVwYXJlS0lYQ29yZSgpOwoKPWN1dAoKc3ViIF9QcmVwYXJlS0lYQ29yZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgaW5pdGlhbGl6ZSBLSVhDb3JlOjpQYWNrYWdlcyBhcyByZXBvc2l0b3J5IGZvciByZWdpc3RlcmVkIHBhY2thZ2VzCgogICAgaWYgKCAkU2VsZi0+e01haW5PYmplY3R9LT5SZXF1aXJlKCdLZXJuZWw6OlN5c3RlbTo6S0lYVXRpbHMnKSApIHsKICAgICAgICAkU2VsZi0+e0tJWFV0aWxzT2JqZWN0fSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpLSVhVdGlscycpOwogICAgICAgICRTZWxmLT57S0lYVXRpbHNPYmplY3R9LT5SZWdpc3RlckN1c3RvbVBhY2thZ2UoCiAgICAgICAgICAgIFBhY2thZ2VOYW1lID0+ICdLSVhDb3JlJywKICAgICAgICAgICAgUHJpb3JpdHkgICAgPT4gJzAwMDAnLAogICAgICAgICk7CiAgICB9CgogICAgIyByZWxvYWQgY29uZmlndXJhdGlvbi4uLi4KICAgICRTZWxmLT57U3lzQ29uZmlnT2JqZWN0fS0+V3JpdGVEZWZhdWx0KCk7CiAgICBteSBAWlpaRmlsZXMgPSAoCiAgICAgICAgJ1paWkFBdXRvLnBtJywKICAgICAgICAnWlpaQXV0by5wbScsCiAgICApOwoKICAgICMgcmVsb2FkIHRoZSBaWlogZmlsZXMgKG1vZF9wZXJsIHdvcmthcm91bmQpCiAgICBmb3IgbXkgJFpaWkZpbGUgKEBaWlpGaWxlcykgewogICAgICAgIFBSRUZJWDoKICAgICAgICBmb3IgbXkgJFByZWZpeCAoQElOQykgewogICAgICAgICAgICBteSAkRmlsZSA9ICRQcmVmaXggLiAnL0tlcm5lbC9Db25maWcvRmlsZXMvJyAuICRaWlpGaWxlOwogICAgICAgICAgICBuZXh0IFBSRUZJWCBpZiAoICEtZiAkRmlsZSApOwogICAgICAgICAgICBkbyAkRmlsZTsKICAgICAgICAgICAgbGFzdCBQUkVGSVg7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIDE7Cn0KCj1pdGVtIF9SZW1vdmVLSVhDb3JlKCkKClJlc3RvcmVzIGZpbGVzIHdoaWNoIHdlcmUgbW9kaWZpZWQgYnkgdGhlIGluc3RhbGxhdGlvbiBvZiBLSVhDb3JlLgoKICAgIG15ICRSZXN1bHQgPSAkQ29kZU9iamVjdC0+X1JlbW92ZUtJWENvcmUoKTsKCj1jdXQKCnN1YiBfUmVtb3ZlS0lYQ29yZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIGlmICggJFNlbGYtPntNYWluT2JqZWN0fS0+UmVxdWlyZSgnS2VybmVsOjpTeXN0ZW06OktJWFV0aWxzJykgKSB7CiAgICAgICAgJFNlbGYtPntLSVhVdGlsc09iamVjdH0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6S0lYVXRpbHMnKTsKICAgICAgICAkU2VsZi0+e0tJWFV0aWxzT2JqZWN0fS0+Q2xlYW5VcENvbmZpZ1BtKCk7CiAgICB9CgogICAgIyByZWxvYWQgY29uZmlndXJhdGlvbi4uLi4KICAgICRTZWxmLT57U3lzQ29uZmlnT2JqZWN0fS0+V3JpdGVEZWZhdWx0KCk7CiAgICBteSBAWlpaRmlsZXMgPSAoCiAgICAgICAgJ1paWkFBdXRvLnBtJywKICAgICAgICAnWlpaQXV0by5wbScsCiAgICApOwoKICAgICMgcmVsb2FkIHRoZSBaWlogZmlsZXMgKG1vZF9wZXJsIHdvcmthcm91bmQpCiAgICBmb3IgbXkgJFpaWkZpbGUgKEBaWlpGaWxlcykgewogICAgICAgIFBSRUZJWDoKICAgICAgICBmb3IgbXkgJFByZWZpeCAoQElOQykgewogICAgICAgICAgICBteSAkRmlsZSA9ICRQcmVmaXggLiAnL0tlcm5lbC9Db25maWcvRmlsZXMvJyAuICRaWlpGaWxlOwogICAgICAgICAgICBuZXh0IFBSRUZJWCBpZiAoICEtZiAkRmlsZSApOwogICAgICAgICAgICBkbyAkRmlsZTsKICAgICAgICAgICAgbGFzdCBQUkVGSVg7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIDE7Cn0KCjE7Cgo9YmFjawoKPWhlYWQxIFRFUk1TIEFORCBDT05ESVRJT05TCgpUaGlzIFNvZnR3YXJlIGlzIHBhcnQgb2YgdGhlIE9UUlMgcHJvamVjdCAoaHR0cDovL290cnMub3JnLykuCgpUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQp0aGUgZW5jbG9zZWQgZmlsZSBDT1BZSU5HIGZvciBsaWNlbnNlIGluZm9ybWF0aW9uIChHUEwpLiBJZiB5b3UKZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9hZ3BsLnR4dC4KCj1jdXQKCj1oZWFkMSBWRVJTSU9OCiRSZXZpc2lvbjogMS44ICQgJERhdGU6IDIwMTYvMDEvMjAgMTM6NDQ6NDcgJAo9Y3V0Cg==</File>
    </Filelist>
    <DatabaseInstall>
    </DatabaseInstall>
    <DatabaseUpgrade>
    </DatabaseUpgrade>
    <DatabaseReinstall>
    </DatabaseReinstall>
    <DatabaseUninstall>
    </DatabaseUninstall>
</otrs_package>